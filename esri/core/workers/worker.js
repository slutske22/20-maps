var globalId=0,outgoing=new Map,configured=!1,HANDSHAKE=0,CONFIGURE=1,CONFIGURED=2,OPEN=3,OPENED=4,RESPONSE=5,INVOKE=6,ABORT=7;function createAbortError(){var e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,r,o){var t=o&&o.signal,n=globalId++;return new Promise((function(o,a){if(t){if(t.aborted)return a(createAbortError());t.addEventListener("abort",(function(){outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),a(createAbortError()))}))}outgoing.set(n,{resolve:o,reject:a}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:r})}))}function messageHandler(e){var r=receiveMessage(e);if(r){var o=r.jobId;switch(r.type){case CONFIGURE:var t=r.configure;if(configured)return;configured=!0,self.dojoConfig=t.loaderConfig,self.importScripts(t.loaderUrl),"function"==typeof require.config&&require.config(t.loaderConfig),self.esriConfig=t.esriConfig,self.postMessage({type:CONFIGURED});break;case OPEN:var n=r.modulePath;require(["esri/core/workers/RemoteClient"],(function(e){e.loadWorker(n).then((function(e){return e||new Promise((function(e){require([n],e)}))})).then((function(r){var t=e.connect(r);self.postMessage({type:OPENED,jobId:o,data:t},[t])}))}));break;case RESPONSE:if(outgoing.has(o)){var a=outgoing.get(o);outgoing.delete(o),r.error?a.reject(JSON.parse(r.error)):a.resolve(r.data)}}}}self.addEventListener("message",messageHandler),self.postMessage({type:HANDSHAKE});