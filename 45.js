(function(){var e={"esri/layers/support/PixelBlock":267,"esri/geometry/projection":291,"esri/geometry/pe":310,"esri/geometry/support/GeographicTransformation":311,"esri/geometry/support/GeographicTransformationStep":312,"esri/layers/support/RasterFunction":313,"esri/layers/support/rasterFunctions/pixelUtils":376,"esri/layers/support/DimensionalDefinition":421,"esri/layers/support/imageryRendererUtils":422,"esri/layers/support/RasterJobHandler":550,"esri/layers/support/rasterFunctions/rasterProjectionHelper":611,"esri/layers/ImageryTileLayer":744,"esri/layers/support/RasterStorageInfo":845,"esri/layers/support/rasterDatasets/BaseRaster":846,"esri/layers/support/rasterDatasets/RawBlockCache":1047,"esri/layers/support/rasterDatasets/EphemeralBlockCache":1048,"esri/layers/support/rasterDatasets/RasterFactory":2250,"esri/layers/support/rasterDatasets/CloudRaster":2251,"esri/layers/support/rasterDatasets/DBFParser":2252,"esri/layers/support/rasterDatasets/ImageServerRaster":2253,"esri/layers/support/rasterDatasets/MRFRaster":2254,"esri/layers/support/rasterDatasets/xmlUtilities":2255,"esri/layers/support/rasterDatasets/TIFFRaster":2256},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1047:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(159),r(1048),r(611)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=new Map,a=new n;t.register=function(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){var n=o.get(e);return n.push(r),n.length-1}return o.set(e,[r]),0},t.unregister=function(e,t){o.has(e)&&(o.get(e)[t]=null)},t.deleteRaster=function(e){o.delete(e)},t.decreaseRefCount=function(e,t,r){if(!o.has(e))return null==t?a.decreaseRefCount(e,r):0;var n=o.get(e);if(null==n[t])return a.decreaseRefCount(e,r);var i=n[t].cache;if(i.has(r)){var s=i.get(r);if(s.refCount--,0===s.refCount){i.delete(r);for(var l=0;l<n.length;l++)n[l]&&n[l].cache.has(r)&&n[l].cache.delete(r);s.controller&&s.controller.abort()}return s.refCount}return 0},t.getBlock=function(e,t,r){if(!o.has(e))return null==t?a.getBlock(e,r):null;var n=o.get(e);if(null==n[t]){for(var i=0;i<n.length;i++)if(n[i]&&n[i].cache.has(r))return(s=n[i].cache.get(r)).refCount++,s.block;return a.getBlock(e,r)}var s,l=n[t].cache;if(l.has(r))return(s=l.get(r)).refCount++,s.block;for(i=0;i<n.length;i++)if(i!==t&&n[i]&&n[i]&&n[i].cache.has(r)){var u=n[i].cache.get(r);return u.refCount++,l.set(r,u),u.block}return null},t.putBlock=function(e,t,r,n,i){if(void 0===i&&(i=null),o.has(e)){var s=o.get(e);null!=s[t]?s[t].cache.set(r,{refCount:1,block:n,controller:i}):a.putBlock(e,r,n,i)}else null==t&&a.putBlock(e,r,n,i)},t.deleteBlock=function(e,t,r){if(o.has(e)){var n=o.get(e);null!=n[t]?n[t].cache.delete(r):a.deleteBlock(e,r)}else null==t&&a.deleteBlock(e,r)},t.update=function(e,t,n,a,s,l,u){void 0===u&&(u=null);var p=function(e,t){if(!o.has(e))return null;var r=o.get(e);return null==r[t]?null:r[t]}(e,t),c=p.extent,f=p.cache,h=p.rasterInfo,d=n.clone().normalize();if(n=d[0],!c||c.xmin!==n.xmin||c.xmax!==n.xmax||c.ymin!==n.ymin||c.ymax!==n.ymax){var m=h.spatialReference,_=i.projectExtent(n,m,u),y=new r.Point({x:a,y:a,spatialReference:n.spatialReference});if(null!==s||(s=i.projectResolution(y,m,n,u))){var g=i.snapPyramid(s,h,l||"closest"),v=g.pyramidLevel,x=g.pyramidResolution;if(!g.excessiveReading){for(var w=Math.floor((_.xmin-h.storageInfo.origin.x)/x.x),P=Math.floor((h.storageInfo.origin.y-_.ymax)/x.y),b=Math.ceil((_.xmax-_.xmin)/x.x-.1),T=Math.ceil((_.ymax-_.ymin)/x.y-.1),S=v>0?h.storageInfo.pyramidBlockWidth:h.storageInfo.blockWidth,I=v>0?h.storageInfo.pyramidBlockHeight:h.storageInfo.blockHeight,R=Math.floor(w/S),E=Math.floor(P/I),k=Math.floor((w+b-1)/S),M=Math.floor((P+T-1)/I),A=new Set,C=E-1;C<=M+1;C++)for(var O=R-1;O<=k+1;O++)A.add(v+"/"+C+"/"+O);f.forEach((function(e,t){A.has(t)||f.delete(t)})),p.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}}}}}}.apply(null,n))||(e.exports=i)},1048:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(210)],void 0===(i=function(e,t,r){return function(){function e(e,t){void 0===e&&(e=15e3),void 0===t&&(t=5e3),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}return e.prototype.decreaseRefCount=function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0},e.prototype.getBlock=function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null},e.prototype.putBlock=function(e,t,r,n){void 0===n&&(n=null);var i=this._cachedBlocks,o=e+"/"+t;if(i.has(o)){var a=i.get(o);a.ts=Date.now(),a.refCount++}else i.set(o,{block:r,ts:Date.now(),refCount:1,controller:n});this.trim(),this.updateTimer()},e.prototype.deleteBlock=function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)},e.prototype.updateMaxSize=function(e){this._size=e,this.trim()},e.prototype.empty=function(){this._cachedBlocks.clear(),this.clearTimer()},e.prototype.getCurrentSize=function(){return this._cachedBlocks.size},e.prototype.updateTimer=function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var n=r.pairsOfMap(t),i=Date.now(),o=0;o<n.length&&n[o][1].ts<=i-e._duration;o++)t.delete(n[o][0]);0===t.size&&e.clearTimer()}),this._interval)}},e.prototype.trim=function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=r.pairsOfMap(e),n=0;n<t.length-this._size;n++)e.delete(t[n][0])},e.prototype.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)},e}()}.apply(null,n))||(e.exports=i)},2250:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(210),r(2251),r(2253),r(2254),r(2256)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=new Map;return u.set("CRF",{desc:"Cloud Raster Format",constructor:o}),u.set("MRF",{desc:"Meta Raster Format",constructor:s}),u.set("TIFF",{desc:"GeoTIFF",constructor:l}),u.set("RasterTileServer",{desc:"Raster Tile Server",constructor:a}),function(){function e(){}return Object.defineProperty(e,"supportedFormats",{get:function(){var e=new Set;return u.forEach((function(t,r){return e.add(r)})),e},enumerable:!0,configurable:!0}),e.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,s,l,p,c,f,h,d,m;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.url,o=e.ioConfig,a=e.sourceJSON,null==(s=e.datasetFormat)&&t.lastIndexOf(".")&&(s=t.slice(t.lastIndexOf(".")+1).toUpperCase()),"OVR"===s||"TIF"===s?s="TIFF":t.toLowerCase().indexOf("/imageserver")>-1&&(s="RasterTileServer"),l={bandIds:null,sampling:null},p={url:t,sourceJSON:a,datasetFormat:s,ioConfig:o||l},this.supportedFormats.has(s)?(c=u.get(s).constructor,[4,(f=new c(p)).open({signal:e.signal})]):[3,2];case 1:return r.sent(),[2,f];case 2:if(s)throw new n("rasterfactory:open","not a supported format "+s);return h=i.keysOfMap(u),d=0,[2,(m=function(){return(s=h[d++])?(c=u.get(s).constructor,(f=new c(p)).open({signal:e.signal}).then((function(){return f})).catch((function(){return m()}))):null})()]}}))}))},e.register=function(e,t,r){u.has(e.toUpperCase())||u.set(e.toUpperCase(),{desc:t,constructor:r})},e}()}.apply(null,n))||(e.exports=i)},2251:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(154),r(152),r(153),r(151),r(423),r(845),r(237),r(846),r(2252),r(187)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h){var d=new Map;return d.set("int16","esriFieldTypeSmallInteger"),d.set("int32","esriFieldTypeInteger"),d.set("int64","esriFieldTypeInteger"),d.set("float32","esriFieldTypeSingle"),d.set("float64","esriFieldTypeDouble"),d.set("text","esriFieldTypeString"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageInfo=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,l,u;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},t)];case 2:if(n=r.sent(),!this._validateHeader(n))throw new i("cloudraster:open","Invalid or unsupported conf.json.");return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),a=this._parseHeader(n),s=a.storageInfo,"thematic"!==(l=a.rasterInfo).dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:u=r.sent(),l.attributeTable=u,r.label=4;case 4:return this._set("storageInfo",s),this._set("rasterInfo",l),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=this.rasterInfo.storageInfo.maximumPyramidLevel-e)<0?[2,null]:(a=this._buildCacheFilePath(o,t,n,i.multidimensionalDefinition),s=this._getIndexRecordFromBundle(t,n),[4,this.request({url:a,range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},i.signal)]);case 1:return(l=r.sent())?(u=new Uint8Array(l),0===(p=this._getTileEndAndContentType(u,s)).recordSize?[2,null]:[4,this.request({url:a,range:{from:p.position,to:p.position+p.recordSize},responseType:"array-buffer"},i.signal)]):[2,null];case 2:return(c=r.sent())?[2,this.decodePixelBlock(c,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null})]:[2,null]}}))}))},t.prototype._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))},t.prototype._parseHeader=function(e){var t,r,i,o,a=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],s=e.bandCount,c=e.histograms,f=e.colormap,h=e.blockWidth,d=e.blockHeight,m=e.firstPyramidLevel,_=e.maximumPyramidLevel,y=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),g=new n.SpatialReference(e.extent.spatialReference||e.geodataXform.spatialReference),v=new n.Extent({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:g}),x=new n.Point({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:g}),w=e.properties,P=e.format.toLowerCase().replace("cache/",""),b=new n.Point(e.origin.x,e.origin.y,g);if(f&&f.colors)for(t=[],r=0;r<f.colors.length;r++)i=f.colors[r],o=f.values?f.values[r]:r,t.push([o,255&i,i<<16>>>24,i<<8>>>24,i>>>24]);var T=e.LODInfos,S=[];for(r=0;r<T.levels.length;r++)S.push({level:T.levels[r],resolution:T.resolutions[r],scale:96/.0254*T.resolutions[r]});var I=new p({dpi:96,lods:S,format:P,origin:b,size:[h,d],spatialReference:g}),R={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},E=Math.round((v.xmax-v.xmin)/x.x),k=Math.round((v.ymax-v.ymin)/x.y),M=[{maxCol:Math.ceil(E/h)-1,maxRow:Math.ceil(k/d)-1,minCol:0,minRow:0}],A=2;if(_>0)for(r=0;r<_;r++)M.push({maxCol:Math.ceil(E/A/h)-1,maxRow:Math.ceil(k/A/d)-1,minCol:0,minRow:0}),A*=2;var C=e.mdInfo;return{storageInfo:R,rasterInfo:new l({width:E,height:k,pixelType:a,bandCount:s,extent:v,spatialReference:g,pixelSize:x,keyProperties:w,statistics:y,histograms:c,multidimensionalInfo:C,colormap:t,storageInfo:new u({blockWidth:h,blockHeight:d,pyramidBlockWidth:h,pyramidBlockHeight:d,origin:b,tileInfo:I,firstPyramidLevel:m,maximumPyramidLevel:_,blockBoundary:M})})}},t.prototype._fetchAuxiliaryInformation=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,s,l,u,p;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.request({url:this.url+"/conf.vat.json",responseType:"json"},e).then((function(e){return e})).catch((function(){return null})),n=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},e).then((function(e){return e})).catch((function(){return null})),[4,a.all([t,n])];case 1:return(i=r.sent())[0]&&(s=i[0].fields,l=i[0].values,s&&l&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":d.get(e.type),name:e.name,alias:e.alias||e.name}})),u=l.map((function(e){return{attributes:e}})),s&&l&&(o={fields:s,features:u}))),!o&&i[1]&&(p=f.parse(i[1]),o=p.recordSet),[2,h.fromJSON(o)]}}))}))},t.prototype._buildCacheFilePath=function(e,t,r,n){var i=this.storageInfo.packetSize,o=Math.floor(t/i)*i,a=Math.floor(r/i)*i,s="R"+this._toHexString4(o)+"C"+this._toHexString4(a),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=n&&n[0];if(!u)return this.url+"/_alllayers/"+l+"/"+s+".bundle";for(var p=this.rasterInfo.multidimensionalInfo.variables.filter((function(e){return e.name===u.variableName}))[0].dimensions[0].values.indexOf(u.values[0]).toString(16),c=4-p.length,f=0;f<c;f++)p="0"+p;return p="S"+p,this.url+"/_alllayers/"+u.variableName+"/"+p+"/"+l+"/"+s+".bundle"},t.prototype._getIndexRecordFromBundle=function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44},t.prototype._getTileEndAndContentType=function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var o=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:o,recordSize:0xffffffffff&i}},t.prototype._toHexString4=function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t},r.__decorate([s.property({readOnly:!0})],t.prototype,"storageInfo",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(c)}.apply(null,n))||(e.exports=i)},2252:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(827)],void 0===(i=function(e,t,r){return function(){function e(){}return Object.defineProperty(e,"supportedVersions",{get:function(){return[5]},enumerable:!0,configurable:!0}),e.parse=function(e){var t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};var i,o=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),l={version:n,recordCount:o,headerByteCount:a,recordByteCount:s},u=32,p=[],c=[];if(3===n){for(;13!==t.getUint8(u);)i=String.fromCharCode(t.getUint8(u+11)).trim(),p.push({name:r.bytesToUTF8(new Uint8Array(e,u,11)),type:i,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(i)],length:t.getUint8(u+16)}),u+=32;if(u+=1,p.length>0)for(var f=function(){var n=[];32===t.getUint8(u)?(u+=1,p.forEach((function(t){if("C"===t.type)n.push(r.bytesToUTF8(new Uint8Array(e,u,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim()));else if("D"===t.type){var i=String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim();n.push(new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6,8),10)))}u+=t.length})),c.push(n)):u+=s};c.length<o&&e.byteLength-u>s;)f()}var h=function(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),o=i.map((function(e){return e.name})),a=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<o.length;l++)t[o[l]]=e[l-1];a.push({attributes:t})})),{displayFieldName:"",fields:i,features:a}}({fields:p,records:c});return{header:l,fields:p,records:c,recordSet:h}},e}()}.apply(null,n))||(e.exports=i)},2253:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(154),r(152),r(153),r(172),r(151),r(423),r(845),r(903),r(237),r(636),r(846),r(376),r(187)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,_,y){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._levelOffset=0,t._slices=null,t._tilemapCache=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,u,p,m,_,y,g,v,x,w,P,b,T,S,I,R,E,k,M,A,C,O,N;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e&&e.signal,this.sourceJSON?(s={data:this.sourceJSON},[3,4]):[3,2];case 2:return[4,i(this.url,{responseType:"json",query:{f:"json"},signal:t})];case 3:s=r.sent(),r.label=4;case 4:if((n=s).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),u=n.data,this.sourceJSON=u,p=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=u.cacheType,null===this.tileType&&(p.indexOf(u.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===u.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),!u)throw new o("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!u.tileInfo)throw new o("imageserverraster:open","use ImageryLayer to open non-tiled image services");return this.datasetName=u.name,[4,this._fetchRasterInfo({signal:t})];case 5:if(m=r.sent(),!a.isSome(m))throw new o("image-server-raster:open","cannot initialize image service");if(_="Map"===this.tileType?f.readServiceTileInfo(u.tileInfo,u,null):h.fromJSON(u.tileInfo),y=m.extent,g=m.pixelSize,v=.5/m.width*g.x,x=void 0,w=void 0,P=_.lodAt(Math.max.apply(null,_.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==u.maxScale&&("Raster"===this.tileType?(x=_.lods.filter((function(e){return e.resolution===g.x}))[0])||(x=_.lods.filter((function(e){return e.resolution>g.x})).sort((function(e,t){return e.resolution>t.resolution?1:-1}))[0]):(x=_.lods.filter((function(e){return Math.abs(e.scale-u.maxScale)<v}))[0])||(x=_.lods.filter((function(e){return e.scale>u.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),g.x=g.y=x.resolution,m.width=Math.ceil((y.xmax-y.xmin)/g.x-.1),m.height=Math.ceil((y.ymax-y.ymin)/g.y-.1)),x||(x=P),b=_.lodAt(Math.min.apply(null,_.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=_.lods[0].level:0!==u.minScale&&"Elevation"===this.tileType&&(w=_.lods.filter((function(e){return Math.abs(e.scale-u.minScale)<v}))[0],this._levelOffset=w.level-b.level),w||(w=b),T=Math.max(g.x,g.y),(Math.abs(g.x-g.y)>v||!_.lods.some((function(e){return Math.abs(e.resolution-T)<v})))&&(g.x=g.y=x.resolution,m.width=Math.ceil((y.xmax-y.xmin)/g.x-.1),m.height=Math.ceil((y.ymax-y.ymin)/g.y-.1)),S=x.level-w.level,I=_.size,R=I[0],E=I[1],k=_.origin,M=g.x,A=g.y,C=[{minCol:Math.floor((y.xmin-k.x+.1*M)/R/M),maxCol:Math.floor((y.xmax-k.x-.1*M)/R/M),minRow:Math.floor((k.y-y.ymax+.1*A)/E/A),maxRow:Math.floor((k.y-y.ymin-.1*A)/E/A)}],S>0)for(O=0;O<S;O++)M*=2,A*=2,C.push({minCol:Math.floor((y.xmin-k.x+.1*M)/R/M),maxCol:Math.floor((y.xmax-k.x-.1*M)/R/M),minRow:Math.floor((k.y-y.ymax+.1*A)/E/M),maxRow:Math.floor((k.y-y.ymin-.1*A)/E/M)});return m.storageInfo=new c({blockWidth:_.size[0],blockHeight:_.size[1],pyramidBlockWidth:_.size[0],pyramidBlockHeight:_.size[1],compression:_.format,origin:_.origin,firstPyramidLevel:1,maximumPyramidLevel:S,tileInfo:_,blockBoundary:C}),this._set("rasterInfo",m),u.capabilities.toLowerCase().indexOf("tilemap")>-1&&(N={tileInfo:m.storageInfo.tileInfo,parsedUrl:l.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new d.TilemapCache({layer:N})),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c,f,h,d,m,y,g,v,x,w,P,b,T,S,I,R;return r.__generator(this,(function(r){switch(r.label){case 0:return o=this.rasterInfo,a=o.storageInfo,s=o.extent,l=o.pixelSize,u=a.maximumPyramidLevel-e+this._levelOffset,p=this.url+"/tile/"+u+"/"+t+"/"+n,c=this._slices?{sliceId:i.sliceId||0}:null,[4,this.request({url:p,query:c,responseType:"array-buffer"},i.signal)];case 1:return(f=r.sent())?[4,this.decodePixelBlock(f,{width:a.tileInfo.size[0],height:a.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:return h=r.sent(),d=a.blockBoundary[e],"jpg"!==a.compression||n>d.minCol&&n<d.maxCol&&t>d.minRow&&t<d.maxRow||(m=a.origin,y=a.blockWidth,g=a.blockHeight,v=Math.pow(2,e),x=Math.round((s.xmin-m.x)/(l.x*v))%y,w=Math.round((s.xmax-m.x)/(l.x*v))%y,P=Math.round((m.y-s.ymax)/(l.x*v))%g,b=Math.round((m.y-s.ymin)/(l.x*v))%g,T=n===d.minCol?x:0,S=t===d.minRow?P:0,I=n===d.maxCol?w:y,R=t===d.maxRow?b:g,_.setValidBoundary(h,{x:T,y:S},{width:I-T,height:R-S})),[2,h]}}))}))},t.prototype.getSliceIndex=function(e){for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return r?(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0]):null})))return r}return null},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._tilemapCache)return[2,0];if(null===(n=this.identifyPixelLocation(e,0,t.datumTransformation)))return[2,null];i=0,o=this.rasterInfo.storageInfo.maximumPyramidLevel,a=o-i+this._levelOffset,s=n.srcLocation,r.label=1;case 1:if(!(a>=0))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(a,n.row,n.col,t)];case 3:return"available"===r.sent()?[3,6]:[3,5];case 4:return r.sent(),[3,5];case 5:return a--,i++,null===(n=this.identifyPixelLocation(s,i,t.datumTransformation))?[2,null]:[3,1];case 6:return-1===a||null==n?[2,null]:[2,i]}}))}))},t.prototype._fetchRasterInfo=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,l,u,c,f,h,d,m,_,g,v=this;return r.__generator(this,(function(r){return t=this.sourceJSON,o=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),a=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),l=n.SpatialReference.fromJSON(t.spatialReference||t.extent.spatialReference),"Map"===this.tileType?[2,new p({width:o,height:a,bandCount:3,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:"u8",statistics:null})]:(u=e.slice,c=e.signal,f=!!t.hasRasterAttributeTable&&i(this.url+"/rasterAttributeTable",{query:{slice:u,f:"json"},signal:c}).then((function(e){return y.fromJSON(e.data)})).catch((function(){return null})),h=!!t.hasColormap&&i(this.url+"/colormap",{query:{slice:u,f:"json"},signal:c}).then((function(e){return e.data&&e.data.colormap})),d=!!t.hasHistograms&&i(this.url+"/histograms",{query:{slice:u,f:"json"},signal:c}).then((function(e){return e.data&&e.data.histograms})),m=i(this.url+"/keyProperties",{query:{f:"json"},signal:c}).then((function(e){return e.data})).catch((function(){})),_=!!t.hasMultidimensions&&i(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:c}).then((function(e){return e.data&&e.data.multidimensionalInfo})),g=!!t.hasMultidimensions&&i(this.url+"/slices",{query:{f:"json"},signal:c}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),[2,s.all([f,h,d,m,_,g]).then((function(e){var r=null;if(t.minValues&&t.minValues.length===t.bandCount){r=[];for(var i=0;i<t.minValues.length;i++)r.push({min:t.minValues[i],max:t.maxValues[i],avg:t.meanValues[i],stddev:t.stdvValues[i]})}return v._slices=e[5]||null,new p({width:o,height:a,bandCount:t.bandCount,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:t.pixelType.toLowerCase(),statistics:r,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||null,multidimensionalInfo:e[4]||null})}))])}))}))},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([u.property()],t.prototype,"tileType",void 0),r.__decorate([u.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],t)}(m)}.apply(null,n))||(e.exports=i)},2254:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(154),r(152),r(153),r(151),r(267),r(423),r(845),r(846),r(2255)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f){var h,d,m=(h=new ArrayBuffer(4),d=new Uint8Array(h),new Uint32Array(h)[0]=1,1===d[0]),_=new Map;_.set("Int8","s8"),_.set("UInt8","u8"),_.set("Int16","s16"),_.set("UInt16","u16"),_.set("Int32","s32"),_.set("UInt32","u32"),_.set("Float32","f32"),_.set("Float64","f32"),_.set("Double64","f32");var y=new Map;return y.set("lerc",".lrc"),y.set("none",".til"),y.set("deflate",".pzp"),y.set("jpeg",".jzp"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._storageIndex=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a,s,l,u,p,c,f,h,d,m,_,y,g,v,x,w,P,b;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,responseType:"xml"},t)];case 2:return n=r.sent(),i=this._parseHeader(n),a=i.rasterInfo,s=i.files,this._set("rasterInfo",a),this._files=s,[4,this.request({url:s.index,responseType:"array-buffer"},t)];case 3:for(l=r.sent(),this._storageIndex=this._parseIndex(l),u=0,p=-1,h=this.rasterInfo.storageInfo,d=h.blockWidth,m=h.blockHeight,_=h.compression,y=this.rasterInfo.storageInfo.pyramidScalingFactor,g=this.rasterInfo,v=g.width,x=g.height,w=g.bandCount,P=[],b="none"===_?1:w;u<this._storageIndex.length;)p++,c=Math.ceil(v/d/Math.pow(y,p)),f=Math.ceil(x/m/Math.pow(y,p)),u+=c*f*b*4,P.push({maxRow:f,maxCol:c,minCol:0,minRow:0});return this.rasterInfo.storageInfo.blockBoundary=P,p>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=p),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s,u,p,c,f,h,d,m,_,y,g,v,x,w,P,b,T,S,I,R,E,k,M,A,C;return r.__generator(this,(function(r){switch(r.label){case 0:if(o=this.rasterInfo.storageInfo,s=o.blockWidth,u=o.blockHeight,p=o.blockBoundary,c=o.compression,!(f=p[e])||f.maxRow<t||f.maxCol<n||f.minRow>t||f.minCol>n)return[2,null];if(h=this.rasterInfo,d=h.bandCount,m=h.pixelType,_=this._getTileLocation(e,t,n),y=_.ranges,g=_.actualTileWidth,v=_.actualTileHeight,!y||0===y.length)return[2,null];if(0===y[0].from&&0===y[0].to)return C=new Uint8Array(s*u),[2,new l({width:s,height:u,pixels:null,mask:C,validPixelCount:0})];for(x=this.ioConfig.bandIds,w="none"===c?1:d,P=[],b=0,b=0;b<w;b++)(!x||x.indexOf[b]>-1)&&P.push(this.request({url:this._files.data,range:{from:y[b].from,to:y[b].to},responseType:"array-buffer"},i.signal));return[4,a.all(P)];case 1:for(T=r.sent(),S=T.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),I=new Uint8Array(S),R=0,b=0;b<w;b++)I.set(new Uint8Array(T[b]),R),R+=T[b].byteLength;return E="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",[4,this.decodePixelBlock(I.buffer,{width:s,height:u,format:E,pixelType:m})];case 2:if(k=r.sent(),M=0,A=0,g!==s||v!==u)if(C=k.mask)for(b=0;b<u;b++)if(A=b*s,b<v)for(M=g;M<s;M++)C[A+M]=0;else for(M=0;M<s;M++)C[A+M]=0;else for(C=new Uint8Array(s*u),k.mask=C,b=0;b<v;b++)for(A=b*s,M=0;M<g;M++)C[A+M]=1;return[2,k]}}))}))},t.prototype._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,o,a;if(m){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),o=0;o<e.byteLength/4;o++)for(a=0;a<4;a++)n[4*o+a]=r[4*o+3-a];t=new Uint32Array(i)}else t=new Uint32Array(e);return t},t.prototype._getTileLocation=function(e,t,r){var n,i,o,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.pyramidScalingFactor,p=a.compression,c=this.rasterInfo,f=c.width,h=c.height,d=c.bandCount,m="none"===p?1:d,_=0,y=0;for(o=0;o<e;o++)y=Math.pow(u,o),_+=(n=Math.ceil(f/s/y))*(i=Math.ceil(h/l/y));y=Math.pow(u,e),n=Math.ceil(f/s/y),i=Math.ceil(h/l/y),_+=t*n+r,_*=4*m;for(var g=this._storageIndex.subarray(_,_+4*m),v=0,x=0,w=[],P=0;P<m;P++)x=(v=g[4*P+0]*Math.pow(2,32)+g[4*P+1])+g[4*P+2]*Math.pow(2,32)+g[4*P+3],w.push({from:v,to:x});return{ranges:w,actualTileWidth:r<n-1?s:Math.ceil(f/y)-s*(n-1),actualTileHeight:t<i-1?l:Math.ceil(h/y)-l*(i-1)}},t.prototype._parseHeader=function(e){var t=f.getElement(e,"MRF_META/Raster");if(!t)throw new i("mrf:open","not a valid MRF format");var r=f.getElement(t,"Size"),o=parseInt(r.getAttribute("x"),10),a=parseInt(r.getAttribute("y"),10),s=parseInt(r.getAttribute("c"),10),l=(f.getElementValue(t,"Compression")||"none").toLowerCase();if(!l||-1===["none","lerc"].indexOf(l))throw new i("mrf:open","currently does not support compression "+l);var c=f.getElementValue(t,"DataType")||"UInt8",h=_.get(c);if(null==h)throw new i("mrf:open","currently does not support pixel type "+c);var d,m,g=f.getElement(t,"PageSize"),v=parseInt(g.getAttribute("x"),10),x=parseInt(g.getAttribute("y"),10),w=f.getElement(t,"DataValues");if(w&&null!=(m=w.getAttribute("NoData"))&&(d=m.trim().split(" ").map((function(e){return parseFloat(e)}))),f.getElement(e,"MRF_META/CachedSource"))throw new i("mrf:open","currently does not support MRF referencing other data files");var P=f.getElement(e,"MRF_META/GeoTags"),b=f.getElement(P,"BoundingBox");if(null==b)throw new i("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var T,S=parseFloat(b.getAttribute("minx")),I=parseFloat(b.getAttribute("miny")),R=parseFloat(b.getAttribute("maxx")),E=parseFloat(b.getAttribute("maxy")),k=f.getElementValue(P,"Projection"),M=f.getElementValue(e,"datafile"),A=f.getElementValue(e,"IndexFile");"LOCAL_CS[]"!==k&&(T=new n.SpatialReference({wkt:k}));var C=new n.Extent(S,I,R,E);C.spatialReference=T;var O=f.getElement(e,"MRF_META/Rsets"),N=parseInt(O&&O.getAttribute("scale")||"2",10),F=new p({origin:new n.Point({x:C.xmin,y:C.ymax,spatialReference:T}),blockWidth:v,blockHeight:x,pyramidBlockWidth:v,pyramidBlockHeight:x,compression:l,pyramidScalingFactor:N}),B=new n.Point({x:(R-S)/o,y:(E-I)/a,spatialReference:T});return{rasterInfo:new u({width:o,height:a,extent:C,spatialReference:T,bandCount:s,pixelType:h,pixelSize:B,noDataValue:d,storageInfo:F}),files:{mrf:this.url,index:A||this.url.replace(".mrf",".idx"),data:M||this.url.replace(".mrf",y.get(l))}}},r.__decorate([s.property()],t.prototype,"_files",void 0),r.__decorate([s.property()],t.prototype,"_storageIndex",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterIO.MRFRaster")],t)}(c)}.apply(null,n))||(e.exports=i)},2255:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(!e||!t)return[];var r,i=t;if(t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="",!(r=t?n(e,i).getElementsByTagNameNS("*",t):e.getElementsByTagNameNS("*",i))||0===r.length)return[];for(var o=[],a=0;a<r.length;a++)o.push(r[a]||r.item[a]);return o}function n(e,t){if(!e||!t)return null;var i=t;t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var o=r(e,i);return o.length>0?t?n(o[0],t):o[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getElements=r,t.getElement=n,t.getElementValue=function(e,t){var r,i=n(e,t);return i&&(r=i.textContent||i.nodeValue||i.innerText)?r.trim():null},t.getElementValues=function(e,t){for(var n,i=r(e,t),o=[],a=0;a<i.length;a++)(n=i[a].textContent||i[a].nodeValue||i[a].innerText)&&""!==(n=n.trim())&&o.push(n);return o}}.apply(null,n))||(e.exports=i)},2256:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(154),r(152),r(151),r(423),r(845),r(846),r(826),r(828)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c){var f=function(e,t){var r=e.get(t);return r&&r.values},h=function(e,t){var r=e.get(t);return r&&r.values[0]};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._headerInfo=null,t._bufferSize=1048576,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a,u,c,f,h,d,m,_,y,g,v,x,w,P,b,T,S,I,R,E,k,M,A,C,O,N;return r.__generator(this,(function(F){switch(F.label){case 0:return[4,this.init()];case 1:return F.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},t)];case 2:if(!(a=F.sent()))throw new i("tiffraster:open","failed to open url "+this.url);return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),u=p.parseSignature(a),c=u.littleEndian,f=u.firstIFD,h=[],[4,this.readIFDs(h,a,c,f,0,4,t)];case 3:if(F.sent(),d=p.getImageInfo(h),m=d.width,_=d.height,y=d.tileWidth,g=d.tileHeight,v=d.planes,x=d.pixelType,w=d.compression,P=d.firstPyramidLevel,b=d.maximumPyramidLevel,T=d.pyramidBlockWidth,S=d.pyramidBlockHeight,I=d.tileBoundary,R=d.metadata,E=n.Extent.fromJSON(d.extent),k=E.spatialReference,M=E?new n.Point({x:E.xmin,y:E.ymax,spatialReference:k}):new n.Point({x:0,y:0}),A=new l({blockWidth:y,blockHeight:g,pyramidBlockWidth:T,pyramidBlockHeight:S,compression:w,origin:M,firstPyramidLevel:P,maximumPyramidLevel:b,blockBoundary:I}),C=new n.Point({x:(E.xmax-E.xmin)/m,y:(E.ymax-E.ymin)/_,spatialReference:k}),O=R?{BandProperties:R.bandProperties,DataType:R.dataType}:null,N=new s({width:m,height:_,bandCount:v,pixelType:x,compression:w,pixelSize:C,storageInfo:A,spatialReference:k,keyProperties:O,extent:E,statistics:R?R.statistics:null}),this._set("rasterInfo",N),this._headerInfo=r.__assign({littleEndian:c,ifds:h},d),!this._headerInfo.isSupported)throw new i("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c,f,h,d,m,_,y,g,v;return r.__generator(this,(function(r){switch(r.label){case 0:return!this._headerInfo&&this._headerInfo.isSupported?[2,null]:(o=this.rasterInfo.storageInfo.blockBoundary,a=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,s=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,!(l=o[e])||l.maxRow<t||l.maxCol<n||l.minRow>t||l.minCol>n?[2,null]:(u=this.getTileLocation(e,t,n))?(p=u.range,c=u.actualTileWidth,f=u.actualTileHeight,h=u.ifd,[4,this.request({url:this.url,range:p,responseType:"array-buffer"},i.signal)]):[2,null]);case 1:return d=r.sent(),[4,this.decodePixelBlock(d,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:h,offset:0,size:0},width:a,height:s,planes:null,pixelType:null})];case 2:if(m=r.sent(),c!==a||f!==s)if(v=m.mask)for(_=0;_<s;_++)if(g=_*a,_<f)for(y=c;y<a;y++)v[g+y]=0;else for(y=0;y<a;y++)v[g+y]=0;else for(v=new Uint8Array(a*s),m.mask=v,_=0;_<f;_++)for(g=_*a,y=0;y<c;y++)v[g+y]=1;return[2,m]}}))}))},t.prototype.readIFDs=function(e,t,n,i,o,a,s){return void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l;return r.__generator(this,(function(r){switch(r.label){case 0:return i?i>=t.byteLength||i<0?[4,this.request({url:this.url,range:{from:i+o,to:i+o+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]:[2,null];case 1:t=r.sent(),o=i+o,i=0,r.label=2;case 2:return[4,this.readIFD(t,n,i,o,c.TIFF_TAGS,a,s)];case 3:return l=r.sent(),e.push(l.ifd),l.nextIFD?[4,this.readIFDs(e,t,n,l.nextIFD-o,o,a,s)]:[2,null];case 4:return r.sent(),[2]}}))}))},t.prototype.readIFD=function(e,t,n,i,o,a,s){return void 0===o&&(o=c.TIFF_TAGS),void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l,u,f,h,d,m,_,y;return r.__generator(this,(function(r){switch(r.label){case 0:return e?(l=p.parseIFD(e,t,n,i,o,a)).success?(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),u.length>0?(f=u.map((function(e){return e.offlineOffsetSize})),h=Math.min.apply(null,f.map((function(e){return e[0]}))),Math.min.apply(null,f.map((function(e){return e[0]+e[1]})))-h<=this._bufferSize?[4,this.request({url:this.url,range:{from:h,to:h+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]):[3,2]):[3,5]:[2,null];case 1:e=r.sent(),i=h,u.forEach((function(r){return p.parseFieldValues(e,t,r,i)})),r.label=2;case 2:return l.ifd.has("GEOKEYDIRECTORY")?(d=l.ifd.get("GEOKEYDIRECTORY"),(m=d.values)&&m.length>4?(_=m[0]+"."+m[1]+"."+m[2],[4,this.readIFD(e,t,d.valueOffset+6-i,i,c.GEO_KEYS,2,s)]):[3,4]):[3,4];case 3:y=r.sent(),d.data=y.ifd,d.data&&d.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[_]}),r.label=4;case 4:return[2,l];case 5:return l.requiredBufferSize&&l.requiredBufferSize!==e.byteLength?[4,this.request({url:this.url,range:{from:i,to:i+l.requiredBufferSize+4},responseType:"array-buffer"},s)]:[3,7];case 6:return(e=r.sent()).byteLength<l.requiredBufferSize?[2,null]:[2,this.readIFD(e,t,0,i,c.TIFF_TAGS,4,s)];case 7:return[2]}}))}))},t.prototype.getTileLocation=function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,o=n.blockBoundary,a=0===e?0:e-(i-1),s=this._headerInfo.ifds[a];if(!s)return null;var l=f(s,"TILEOFFSETS");if(void 0===l)return null;var u=f(s,"TILEBYTECOUNTS"),p=o[a],c=p.minRow,d=p.minCol,m=p.maxRow,_=p.maxCol;if(t>m||r>_||t<c||r<d)return null;var y=h(s,"IMAGEWIDTH"),g=h(s,"IMAGELENGTH"),v=h(s,"TILEWIDTH"),x=h(s,"TILELENGTH"),w=t*(_+1)+r,P=l[w],b=u[w];return null==P||null==b?null:{range:{from:P,to:P+b-1},ifd:s,actualTileWidth:r===_?y%v:v,actualTileHeight:t===m?g%x:x}},r.__decorate([a.property()],t.prototype,"_files",void 0),r.__decorate([a.property()],t.prototype,"_headerInfo",void 0),r.__decorate([a.property()],t.prototype,"_bufferSize",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([a.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(u)}.apply(null,n))||(e.exports=i)},267:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(154),r(155),r(118),r(156),r(152),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){var p=s.getLogger("esri.layers.support.PixelBlock");return function(e){function t(t){var r=e.call(this,t)||this;return r.width=null,r.height=null,r.pixelType="f32",r.validPixelCount=null,r.mask=null,r.maskIsAlpha=!1,r.pixels=null,r.statistics=null,r}var o;return r.__extends(t,e),o=t,t.createEmptyBand=function(e,t){return new(o.getPixelArrayConstructor(e))(t)},t.getPixelArrayConstructor=function(e){var t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"u32":t=Uint32Array;break;case"f32":t=Float32Array;break;case"f64":t=Float64Array;break;case"c64":case"c128":case"unknown":t=Float32Array;break;default:n.neverReached(e)}return t},t.prototype.castPixelType=function(e){if(!e)return"f32";var t=e.toLowerCase();return["u1","u2","u4"].indexOf(t)>-1?t="u8":-1===["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].indexOf(t)&&(t="f32"),t},t.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length},t.prototype.addData=function(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new i("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics||{minValue:null,maxValue:null})},t.prototype.getAsRGBA=function(){var e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)},t.prototype.getAsRGBAFloat=function(){var e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e},t.prototype.updateStatistics=function(){var e=this;this.statistics=this.pixels.map((function(t){return e._calculateBandStatistics(t,e.mask)}));var t=this.mask,r=0;if(t)for(var n=0;n<t.length;n++)t[n]&&r++;else r=this.width*this.height;this.validPixelCount=r},t.prototype.clamp=function(e){if(e&&"f64"!==e&&"f32"!==e){var t;switch(e){case"u8":t=[0,255];break;case"u16":t=[0,65535];break;case"u32":t=[0,4294967295];break;case"s8":t=[-128,127];break;case"s16":t=[-32768,32767];break;case"s32":t=[-2147483648,2147483647];break;default:t=[-34e38,34e38]}for(var r,n,i,a=t[0],s=t[1],l=this.pixels,u=this.width*this.height,p=l.length,c=[],f=0;f<p;f++){i=o.createEmptyBand(e,u),r=l[f];for(var h=0;h<u;h++)n=r[h],i[h]=n>s?s:n<a?a:n;c.push(i)}this.pixels=c,this.pixelType=e}},t.prototype.extractBands=function(e){var t=this;if(l.isNone(e)||0===e.length||null==this.pixels||0===this.pixels.length)return this;var r=this.pixels.length,n=e.some((function(e){return e>=t.pixels.length})),i=r===e.length&&!e.some((function(e,t){return e!==t}));return n||i?this:new o({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map((function(e){return t.pixels[e]})),statistics:this.statistics&&e.map((function(e){return t.statistics[e]}))})},t.prototype.clone=function(){var e,t=new o({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(this.mask instanceof Uint8Array?t.mask=new Uint8Array(this.mask):t.mask=this.mask.slice(0));var r=o.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];var n=this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=n?this.pixels[e].slice(0,this.pixels[e].length):new r(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=a.clone(this.statistics[e]);return t},t.prototype._fillFrom8Bit=function(e){var t=this.mask,r=this.maskIsAlpha,n=this.pixels;if(e&&n&&n.length){var i,o,a,s;i=o=a=n[0],n.length>=3?(o=n[1],a=n[2]):2===n.length&&(o=n[1]);var l=new Uint32Array(e),u=this.width*this.height;if(i.length===u)if(t&&t.length===u)if(r)for(s=0;s<u;s++)t[s]&&(l[s]=t[s]<<24|a[s]<<16|o[s]<<8|i[s]);else for(s=0;s<u;s++)t[s]&&(l[s]=255<<24|a[s]<<16|o[s]<<8|i[s]);else for(s=0;s<u;s++)l[s]=255<<24|a[s]<<16|o[s]<<8|i[s];else p.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}else p.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")},t.prototype._fillFromNon8Bit=function(e){var t=this.pixels,r=this.mask,n=this.statistics;if(e&&t&&t.length){var i=this.pixelType,o=1,a=0;if(n&&n.length>0)a=n.map((function(e){return e.minValue})).reduce((function(e,t){return Math.min(e,t)})),o=255/n.map((function(e){return e.maxValue-e.minValue})).reduce((function(e,t){return Math.max(e,t)}));else{var s=255;"s8"===i?(a=-128,s=127):"u16"===i?s=65535:"s16"===i?(a=-32768,s=32767):"u32"===i?s=4294967295:"s32"===i?(a=-2147483648,s=2147483647):"f32"===i?(a=-34e38,s=34e38):"f64"===i&&(a=-Number.MAX_VALUE,s=Number.MAX_VALUE),o=255/(s-a)}var l,u,c,f,h,d=new Uint32Array(e),m=this.width*this.height;if((l=u=c=t[0]).length!==m)return p.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(u=t[1],t.length>=3&&(c=t[2]),r&&r.length===m)for(f=0;f<m;f++)r[f]&&(d[f]=255<<24|(c[f]-a)*o<<16|(u[f]-a)*o<<8|(l[f]-a)*o);else for(f=0;f<m;f++)d[f]=255<<24|(c[f]-a)*o<<16|(u[f]-a)*o<<8|(l[f]-a)*o;else if(r&&r.length===m)for(f=0;f<m;f++)h=(l[f]-a)*o,r[f]&&(d[f]=255<<24|h<<16|h<<8|h);else for(f=0;f<m;f++)h=(l[f]-a)*o,d[f]=255<<24|h<<16|h<<8|h}else p.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")},t.prototype._fillFrom32Bit=function(e){var t,r,n,i,o=this.pixels,a=this.mask;if(!e||!o||!o.length)return p.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");t=r=n=o[0],o.length>=3?(r=o[1],n=o[2]):2===o.length&&(r=o[1]);var s=this.width*this.height;if(t.length!==s)return p.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(a&&a.length===s)for(i=0;i<s;i++)e[l++]=t[i],e[l++]=r[i],e[l++]=n[i],e[l++]=1&a[i];else for(i=0;i<s;i++)e[l++]=t[i],e[l++]=r[i],e[l++]=n[i],e[l++]=1},t.prototype._calculateBandStatistics=function(e,t){var r,n=1/0,i=-1/0,o=e.length,a=0;if(t)for(r=0;r<o;r++)t[r]&&(n=(a=e[r])<n?a:n,i=a>i?a:i);else for(r=0;r<o;r++)n=(a=e[r])<n?a:n,i=a>i?a:i;return{minValue:n,maxValue:i}},r.__decorate([u.property({json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"height",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"pixelType",void 0),r.__decorate([u.cast("pixelType")],t.prototype,"castPixelType",null),r.__decorate([u.property({json:{write:!0}})],t.prototype,"validPixelCount",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"mask",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"maskIsAlpha",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"pixels",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"statistics",void 0),o=r.__decorate([u.subclass("esri.layers.support.PixelBlock")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},291:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153),r(310),r(311),r(161)],void 0===(i=function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=null,s=null;t.isLoaded=function(){return!!a&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var l=null;t.load=function(){return l||(l=n.all([i.load(),new Promise((function(e,t){r.e(12).then(function(){var t=[r(381)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){r.e(140).then(function(){var t=[r(405)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]).then((function(e){var t=e[1],r=e[2].hydratedAdapter;s=r,(a=t)._enableProjection(i)})))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:p(s,e,e[0].spatialReference,t,r):p(s,[e],e.spatialReference,t,r)[0]};var u={};function p(e,t,r,n,i){if(void 0===i&&(i=null),null===i){var s=o.cacheKey(r,n);void 0!==u[s]?i=u[s]:(null===(i=c(r,n,null))&&(i=new o),u[s]=i)}return a._project(e,t,r,n,i)}function c(e,t,r){void 0===r&&(r=null);var n=a._getTransformation(s,e,t,r,null==r?void 0:r.spatialReference);return null!==n?o.fromGE(n):null}t.projectMany=p,t.getTransformation=c,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=a._getTransformationBySuitability(s,e,t,r,null==r?void 0:r.spatialReference);if(null!==n){for(var i=[],l=0,u=n;l<u.length;l++){var p=u[l];i.push(o.fromGE(p))}return i}return[]}}.apply(null,n))||(e.exports=i)},310:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(164),r(153),r(161)],void 0===(i=function(e,t,n,i,o,a){var s,l,u,p,c,f;function h(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,l.init(),u.init(),p.init(),c.init(),f.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++)r(o[i].prototype,"getName",(function(e){return function(){return e.call(this,new Array(l.PE_NAME_MAX))}}));for(var a=0,s=[t._pe.PeGeogtran,t._pe.PeProjcs];a<s.length;a++)r(s[a].prototype,"getParameters",(function(e){return function(){for(var r=new Array(l.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}}));r(t._pe.PeHorizon.prototype,"getCoord",(function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return y(r,t,e.call(this)),r}})),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",(function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+r*s,t._pe.PeGTlistExtendedGTs))}return n}}));var h=t._pe._pe_getPeHorizonSize(),d=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+h*s,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",d),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",d),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=l.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(l.PE_BUFFER_MAX));return t._pe.UTF8ToString(t._pe._pe_object_to_string_ext(r,e,n))}}function d(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function m(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function _(e){var t;return Array.isArray(e[0])?(t=[],e.forEach((function(e){t.push(e[0],e[1])}))):t=e,t}function y(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var a=0===e.length;for(o=0;o<r;o++)a&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!o("esri-wasm")},t.load=function(){return s||(s=a.create((function(e,t){new Promise((function(e,t){r.e(122).then(function(){var t=[r(474)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){r({locateFile:function(e){return i.getAssetUrl("esri/geometry/support/"+e)},onAbort:function(e){t(new Error(e))}}).then((function(t){h(t),e()}))}))})))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=_(n),o=n===i,a=t._pe.ensureFloat64(i),s=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,a);return s&&y(n,r,a,o),s}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=_(n),a=n===o,s=t._pe.ensureFloat64(o),l=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,s,i);return l&&y(n,r,s,a),l}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case l.PE_TRANSFORM_P_TO_G:return n(e,t,i);case l.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(l=t.PeDefs||(t.PeDefs={})),function(e){var r={},n={};function i(e,n){var i=null,a=r[e];if(a||(a={},r[e]=a),a.hasOwnProperty(String(n)))i=a[n];else{var s=t._pe.PeFactory.prototype.factoryByType(e,n);t._pe.compare(s,t._pe.NULL)||(i=s,a[n]=i)}return o(i)}function o(e){if(e){var r=e.getType();switch(r){case l.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case l.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case l.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&l.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return i(l.PE_TYPE_COORDSYS,e)},e.factoryByType=i,e.fromString=function(e,r){var i=null,a=n[e];if(a||(a={},n[e]=a),a.hasOwnProperty(r))i=a[r];else{var s=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(s,t._pe.NULL)||(i=s,a[r]=i)}return o(i)},e.geogcs=function(e){return i(l.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return i(l.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return i(l.PE_TYPE_PROJCS,e)},e.unit=function(e){return i(l.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,a,s){var l=null,u=new t._pe.PeInteger(s);try{var p=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,a,u);if((s=u.val)&&(l=[p],s>1))for(var c=t._pe.getPointer(p),f=1;f<s;f++)l.push(t._pe.wrapPointer(c+r*f,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(u)}return l}}(u=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){e.destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];d(i),i.getEntries().forEach((function(e){d(e);var t=e.getGeogtran();d(t),t.getParameters().forEach(d),[t.getGeogcs1(),t.getGeogcs2()].forEach((function(e){d(e);var t=e.getDatum();d(t),d(t.getSpheroid()),d(e.getPrimem()),d(e.getUnit())}))}))}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})),function(e){e.geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=_(n),s=n===a,l=t._pe.ensureFloat64(a),u=0;i&&(u=t._pe.ensureFloat64(i));var p=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,l,u,o);return p&&y(n,r,l,s),p}}(t.PeGTTransformations||(t.PeGTTransformations={})),function(e){function r(e,r,n,i,o,a){var s,u;switch(t._pe.ensureCache.prepare(),e){case"dd":s=t._pe._pe_geog_to_dd,u=l.PE_DD_MAX;break;case"ddm":s=t._pe._pe_geog_to_ddm,u=l.PE_DDM_MAX;break;case"dms":s=t._pe._pe_geog_to_dms,u=l.PE_DMS_MAX}var p=0;r&&(p=t._pe.getPointer(r));var c=_(i),f=t._pe.ensureFloat64(c),h=m(n,u),d=s(p,n,f,o,t._pe.ensureInt32(h));if(d)for(var y=0;y<n;y++)a[y]=t._pe.UTF8ToString(h[y]);return d}function n(e,r,n,i,o){var a;switch(t._pe.ensureCache.prepare(),e){case"dd":a=t._pe._pe_dd_to_geog;break;case"ddm":a=t._pe._pe_ddm_to_geog;break;case"dms":a=t._pe._pe_dms_to_geog}var s=0;r&&(s=t._pe.getPointer(r));var l=i.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(l),p=t._pe.ensureFloat64(new Array(2*n)),c=a(s,n,u,p);return c&&y(o,n,p),c}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,a,s){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=_(n),c=t._pe.ensureFloat64(p),f=m(r,l.PE_MGRS_MAX),h=t._pe.ensureInt32(f),d=t._pe._pe_geog_to_mgrs_extended(u,r,c,i,o,a,h);if(d)for(var y=0;y<r;y++)s[y]=t._pe.UTF8ToString(f[y]);return d},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_mgrs_to_geog_extended(a,r,l,i,u);return p&&y(o,r,u),p}}(p=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,a,s){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=_(n),c=t._pe.ensureFloat64(p),f=m(r,l.PE_MGRS_MAX),h=t._pe.ensureInt32(f),d=t._pe._pe_geog_to_usng(u,r,c,i,o,a,h);if(d)for(var y=0;y<r;y++)s[y]=t._pe.UTF8ToString(f[y]);return d},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),s=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),u=t._pe._pe_usng_to_geog(o,r,s,l);return u&&y(i,r,l),u}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=_(n),u=t._pe.ensureFloat64(s),p=m(r,l.PE_UTM_MAX),c=t._pe.ensureInt32(p),f=t._pe._pe_geog_to_utm(a,r,u,i,c);if(f)for(var h=0;h<r;h++)o[h]=t._pe.UTF8ToString(p[h]);return f},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_utm_to_geog(a,r,l,i,u);return p&&y(o,r,u),p}}(c=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,a;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(a=r.get(n))[i]&&(o=a[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),a||(a=[],r.set(n,a)),a[i]=o),o}}(f=t.PePCSInfo||(t.PePCSInfo={})),function(e){e.version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(t.PeVersion||(t.PeVersion={})),t._init=h}.apply(null,n))||(e.exports=i)},311:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(312)],void 0===(i=function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];i instanceof r?this.steps.push(i):this.steps.push(new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,a=t.steps;o<a.length;o++){var s=a[o],l=r.fromGE(s);n.steps.push(l),i+=l.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--){var n=this.steps[r];t.steps.push(n.getInverse())}return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var a=this._cached_projection[e.cacheKey(t,r)];return void 0===a?null:a},e}()}.apply(null,n))||(e.exports=i)},312:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}.apply(null,n))||(e.exports=i)},313:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(198),r(151)],void 0===(i=function(e,t,r,n,i,o,a){var s,l=o.SetFromValues(["Raster","Raster2","DEM","FillRaster"]),u=o.SetFromValues(["Rasters"]),p=function(e){return e&&e.rasterFunction?f.fromJSON(e):e},c=function(e){return e&&e instanceof f?e.toJSON():e};!function(e){e[e.MOSAIC=0]="MOSAIC",e[e.GROUP=1]="GROUP",e[e.ITEM=2]="ITEM"}(s||(s={}));var f=function(e){function t(t){var r=e.call(this,t)||this;return r.functionArguments=null,r.functionName=null,r.outputPixelType="unknown",r.variableName=null,r.description=null,r.functionDefinition=null,r.thumbnail=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readFunctionArguments=function(e,t){return function(e){if(null==e)return null;for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];l.has(i)?t[i]=p(e[i]):u.has(i)&&Array.isArray(e[i])?t[i]=e[i].map(p):t[i]=e[i]}return t}(t.arguments||t.rasterFunctionArguments)},t.prototype.writeFunctionArguments=function(e,t,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];l.has(a)?n[a]=c(e[a]):u.has(a)&&Array.isArray(e[a])?n[a]=e[a].map(c):n[a]=c(e[a])}this.functionDefinition?t.arguments=n:t[r]=n},t.prototype.readFunctionName=function(e,t){var r=t.rasterFunctionInfos;return t.name||(r&&r.length&&"None"!==r[0].name?r[0].name:t.rasterFunction)},t.prototype.writeFunctionName=function(e,t,r){this.functionDefinition?t.name=e:t[r]=e},t.prototype.readFunctionType=function(e){return s[e]},t.prototype.writeFunctionType=function(e,t,r){t[r]=s[e]},t.prototype.clone=function(){return new n({functionName:this.functionName,functionArguments:i.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})},r.__decorate([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],t.prototype,"functionArguments",void 0),r.__decorate([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],t.prototype,"readFunctionArguments",null),r.__decorate([a.writer("functionArguments")],t.prototype,"writeFunctionArguments",null),r.__decorate([a.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0),r.__decorate([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],t.prototype,"readFunctionName",null),r.__decorate([a.writer("functionName")],t.prototype,"writeFunctionName",null),r.__decorate([a.enumeration({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),a.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"description",void 0),r.__decorate([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionType",void 0),r.__decorate([a.reader("functionType")],t.prototype,"readFunctionType",null),r.__decorate([a.writer("functionType")],t.prototype,"writeFunctionType",null),r.__decorate([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionDefinition",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"thumbnail",void 0),n=r.__decorate([a.subclass("esri.layers.support.RasterFunction")],t)}(n.JSONSupport);return f}.apply(null,n))||(e.exports=i)},376:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(267)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function i(e,t){var r,n,i=Math.min(Math.max(e,-100),100),o=Math.min(Math.max(t,-100),100),a=new Uint8Array(256);for(r=0;r<256;r++)i>0&&i<100?n=(200*r-25500+510*o)/(2*(100-i))+128:i<=0&&i>-100?n=(200*r-25500+510*o)*(100+i)/2e4+128:100===i?n=(n=200*r-25500+256*(100-i)+510*o)>0?255:0:-100===i&&(n=128),a[r]=n>255?255:n<0?0:n;return a}function o(e,t,r,n,i,o,a,s){return{xmin:i<=r*e?0:i<r*e+e?i-r*e:e,ymin:o<=n*t?0:o<n*t+t?o-n*t:t,xmax:i+a<=r*e?0:i+a<r*e+e?i+a-r*e:e,ymax:o+s<=n*t?0:o+s<n*t+t?o+s-n*t:t}}function a(e,t,i,a){var s=e.filter((function(e){return n(e)}))[0];if(null==s)return null;var l,u,p,c,f,h,d,m,_,y,g,v,x,w=a?a.width:t.width,P=a?a.height:t.height,b=s.width,T=s.height,S=t.width/b,I=t.height/T,R=i?i.x:0,E=i?i.y:0,k=s.pixelType,M=r.getPixelArrayConstructor(k),A=s.pixels.length,C=[];for(h=0;h<A;h++){for(u=new M(w*P),d=0;d<I;d++)for(m=0;m<S;m++)if(p=e[d*S+m])for(l=p.pixels[h],_=(g=o(b,T,m,d,R,E,w,P)).ymin;_<g.ymax;_++)for(c=(d*T+_-E)*w+(m*b-R),f=_*b,y=g.xmin;y<g.xmax;y++)u[c+y]=l[f+y];C.push(u)}if(e.some((function(e){return null==e||e.mask&&e.mask.length>0})))for(v=new Uint8Array(w*P),d=0;d<I;d++)for(m=0;m<S;m++)if(x=(p=e[d*S+m])?p.mask:null,g=o(b,T,m,d,R,E,w,P),x)for(_=g.ymin;_<g.ymax;_++)for(c=(d*T+_-E)*w+(m*b-R),f=_*b,y=g.xmin;y<g.xmax;y++)v[c+y]=x[f+y];else if(p)for(_=g.ymin;_<g.ymax;_++)for(c=(d*T+_-E)*w+(m*b-R),f=_*b,y=g.xmin;y<g.xmax;y++)v[c+y]=1;else for(_=g.ymin;_<g.ymax;_++)for(c=(d*T+_-E)*w+(m*b-R),f=_*b,y=g.xmin;y<g.xmax;y++)v[c+y]=0;var O=new r({width:w,height:P,pixels:C,pixelType:k,mask:v});return O.updateStatistics(),O}t.extractBands=function(e,t){if(!t||!n(e))return e;var i=e.pixels.length;return t&&t.some((function(e){return e>=i}))||1===i&&1===t.length&&0===t[0]?e:i!==t.length||t.some((function(e,t){return e!==t}))?new r({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map((function(t){return e.pixels[t]})),statistics:e.statistics&&t.map((function(t){return e.statistics[t]}))}):e},t.createColormapLUT=function(e){if(e){var t=e.colormap;if(t&&0!==t.length){var r=t.sort((function(e,t){return e[0]-t[0]})),n=0;r[0][0]<0&&(n=r[0][0]);var i,o=Math.max(256,r[r.length-1][0]-n+1),a=new Uint8Array(4*o),s=[],l=0,u=0,p=5===r[0].length;if(o>65536)return r.forEach((function(e){s[e[0]-n]=p?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:s,offset:n,alphaSpecified:p};if(e.fillUnspecified)for(l=(i=r[u])[0]-n;l<o;l++)a[4*l]=i[1],a[4*l+1]=i[2],a[4*l+2]=i[3],a[4*l+3]=p?i[4]:255,l===i[0]-n&&(i=u===r.length-1?i:r[++u]);else for(l=0;l<r.length;l++)a[u=4*((i=r[l])[0]-n)]=i[1],a[u+1]=i[2],a[u+2]=i[3],a[u+3]=p?i[4]:255;return{indexedColormap:a,offset:n,alphaSpecified:p}}}},t.colorize=function(e,t){if(!n(e))return e;if(!t&&(t.indexedColormap||t.indexed2DColormap))return e;var r=e.clone(),i=r.pixels,o=r.mask,a=r.width*r.height;if(1!==i.length)return e;var s,l=t.indexedColormap,u=t.indexed2DColormap,p=t.offset,c=t.alphaSpecified,f=l.length-1,h=0,d=i[0],m=new Uint8Array(d.length),_=new Uint8Array(d.length),y=new Uint8Array(d.length),g=0;if(l)if(o)for(h=0;h<a;h++)o[h]&&((g=4*(d[h]-p))<p||g>f?o[h]=0:(m[h]=l[g],_[h]=l[g+1],y[h]=l[g+2],o[h]=l[g+3]));else{for(o=new Uint8Array(a),h=0;h<a;h++)(g=4*(d[h]-p))<p||g>f?o[h]=0:(m[h]=l[g],_[h]=l[g+1],y[h]=l[g+2],o[h]=l[g+3]);r.mask=o}else if(o)for(h=0;h<a;h++)o[h]&&(s=u[d[h]],m[h]=s[0],_[h]=s[1],y[h]=s[2],o[h]=s[3]);else{for(o=new Uint8Array(a),h=0;h<a;h++)s=u[d[h]],m[h]=s[0],_[h]=s[1],y[h]=s[2],o[h]=s[3];r.mask=o}return r.pixels=[m,_,y],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=c,r},t.estimateStatisticsHistograms=function(e){if(!n(e))return null;e.statistics||e.updateStatistics();var t,r,i,o,a,s,l,u,p,c,f,h,d,m,_=e.pixels,y=e.mask,g=e.pixelType,v=e.statistics,x=e.width*e.height,w=_.length,P=[],b=[];for(o=0;o<w;o++){if(s=new Uint32Array(256),u=_[o],"u8"===g)if(t=-.5,r=255.5,y)for(a=0;a<x;a++)y[a]&&s[u[a]]++;else for(a=0;a<x;a++)s[u[a]]++;else{if(t=v[o].minValue,i=((r=v[o].maxValue)-t)/256,l=new Uint32Array(257),y)for(a=0;a<x;a++)y[a]&&l[Math.floor((u[a]-t)/i)]++;else for(a=0;a<x;a++)l[Math.floor((u[a]-t)/i)]++;for(a=0;a<255;a++)s[a]=l[a];s[255]=l[255]+l[256]}for(P.push({min:t,max:r,size:256,counts:s}),p=0,c=0,d=0,a=0;a<256;a++)p+=s[a],c+=a*s[a];for(m=c/p,a=0;a<256;a++)d+=s[a]*Math.pow(a-m,2);f=(m+.5)*(i=(r-t)/256)+t,h=Math.sqrt(d/(p-1))*i,b.push({min:t,max:r,avg:f,stddev:h})}return{statistics:b,histograms:P}},t.createStretchLUT=function(e){var t=e.minCutOff,r=e.maxCutOff,n=e.gamma,o=e.pixelType,a=e.outMin||0,s=e.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(o))return null;var l,u,p=t.length,c=0;"s8"===o?c=-127:"s16"===o&&(c=-32767);var f=256;["u16","s16"].indexOf(o)>-1&&(f=65536);var h=[],d=[],m=s-a;for(l=0;l<p;l++)d[l]=r[l]-t[l],h[l]=m/(r[l]-t[l]);var _,y=n&&n.length>=p,g=[];if(y)for(l=0;l<p;l++)n[l]>1?n[l]>2?g[l]=6.5+Math.pow(n[l]-2,2.5):g[l]=6.5+100*Math.pow(2-n[l],4):g[l]=1;var v,x,w,P=[];if(y)for(l=0;l<p;l++){for(w=[],u=0;u<f;u++)_=((v=u+c)-t[l])/d[l],x=1,n[l]>1&&(x-=Math.pow(1/m,_*g[l])),v<r[l]&&v>t[l]?w[u]=Math.floor(x*m*Math.pow(_,1/n[l]))+a:v>=r[l]?w[u]=s:w[u]=a;P[l]=w}else for(l=0;l<p;l++){for(w=[],u=0;u<f;u++)(v=u+c)<=t[l]?w[u]=a:v>=r[l]?w[u]=s:w[u]=Math.floor((v-t[l])/d[l]*m)+a;P[l]=w}if(null!=e.contrastOffset){var b=i(e.contrastOffset,e.brightnessOffset);for(l=0;l<p;l++)for(w=P[l],u=0;u<f;u++)w[u]=b[w[u]]}return{lut:P,offset:c}},t.createContrastBrightnessLUT=i,t.stretch=function(e,t){if(!n(e))return null;var r,i,o,a,s,l=e.clone(),u=l.pixels,p=l.mask,c=t.minCutOff,f=t.maxCutOff,h=t.gamma,d=t.outMin||0,m=t.outMax||255,_=l.width*l.height,y=u.length,g=m-d,v=[],x=[];for(r=0;r<y;r++)x[r]=f[r]-c[r],v[r]=g/(f[r]-c[r]);var w=h&&h.length>=y,P=[];if(w)for(r=0;r<y;r++)h[r]>1?h[r]>2?P[r]=6.5+Math.pow(h[r]-2,2.5):P[r]=6.5+100*Math.pow(2-h[r],4):P[r]=1;if(w)if(null!=p){for(i=0;i<_;i++)if(p[i])for(r=0;r<y;r++)s=((o=u[r][i])-c[r])/x[r],a=1,h[r]>1&&(a-=Math.pow(1/g,s*P[r])),o<f[r]&&o>c[r]?u[r][i]=Math.floor(a*g*Math.pow(s,1/h[r]))+d:o>=f[r]?u[r][i]=m:u[r][i]=d}else for(i=0;i<_;i++)for(r=0;r<y;r++)s=((o=u[r][i])-c[r])/x[r],a=1,h[r]>1&&(a-=Math.pow(1/g,s*P[r])),o<f[r]&&o>c[r]?u[r][i]=Math.floor(a*g*Math.pow(s,1/h[r]))+d:o>=f[r]?u[r][i]=m:u[r][i]=d;else if(null!=p){for(i=0;i<_;i++)if(p[i])for(r=0;r<y;r++)(o=u[r][i])<f[r]&&o>c[r]?u[r][i]=Math.floor((o-c[r])/x[r]*g)+d:o>=f[r]?u[r][i]=m:u[r][i]=d}else for(i=0;i<_;i++)for(r=0;r<y;r++)(o=u[r][i])<f[r]&&o>c[r]?u[r][i]=Math.floor((o-c[r])/x[r]*g)+d:o>=f[r]?u[r][i]=m:u[r][i]=d;return l.pixelType="u8",l.updateStatistics(),l},t.lookupPixels=function(e,t){if(!n(e))return null;var i,o,a=e.pixels,s=e.mask,l=e.width*e.height,u=a.length,p=t.lut,c=t.offset;p&&1===p[0].length&&(p=a.map((function(){return p})));var f,h,d,m=[];if(c)if(null==s)for(i=0;i<u;i++){for(f=a[i],h=p[i],d=new Uint8Array(l),o=0;o<l;o++)d[o]=h[f[o]-c];m.push(d)}else for(i=0;i<u;i++){for(f=a[i],h=p[i],d=new Uint8Array(l),o=0;o<l;o++)s[o]&&(d[o]=h[f[o]-c]);m.push(d)}else if(null==s)for(i=0;i<u;i++){for(f=a[i],h=p[i],d=new Uint8Array(l),o=0;o<l;o++)d[o]=h[f[o]];m.push(d)}else for(i=0;i<u;i++){for(f=a[i],h=p[i],d=new Uint8Array(l),o=0;o<l;o++)s[o]&&(d[o]=h[f[o]]);m.push(d)}var _=new r({width:e.width,height:e.height,pixels:m,mask:s,pixelType:"u8"});return _.updateStatistics(),_},t.remapColor=function(e,t){if(!n(e))return null;var r,i,o,a,s,l,u=e.clone(),p=u.pixels,c=u.width*u.height,f=t.length,h=Math.floor(f/2),d=t[Math.floor(h)],m=p[0],_=!1,y=new Uint8Array(c),g=new Uint8Array(c),v=new Uint8Array(c),x=u.mask,w=4===t[0].mappedColor.length;for(x||((x=new Uint8Array(c)).fill(w?255:1),u.mask=x),s=0;s<c;s++)if(x[s]){for(r=m[s],_=!1,l=h,i=d,o=0,a=f-1;a-o>1;){if(r===i.value){_=!0;break}r>i.value?o=l:a=l,l=Math.floor((o+a)/2),i=t[Math.floor(l)]}_||(r===t[o].value?(i=t[o],_=!0):r===t[a].value?(i=t[a],_=!0):r<t[o].value?(_=!1,i=null):r>t[o].value&&(r<t[a].value?(i=t[o],_=!0):a===f-1?(_=!1,i=null):(i=t[a],_=!0))),_?(y[s]=i.mappedColor[0],g[s]=i.mappedColor[1],v[s]=i.mappedColor[2],x[s]=i.mappedColor[3]):y[s]=g[s]=v[s]=x[s]=0}return u.pixels=[y,g,v],u.mask=x,u.pixelType="u8",u.maskIsAlpha=w,u},t.getClipBounds=o,t.mosaicPixelData=function(e,t){if(!e||0===e.length)return null;var r=e.filter((function(e){return e.pixelBlock}))[0];if(!r)return null;var n=(r.extent.xmax-r.extent.xmin)/r.pixelBlock.width,i=(r.extent.ymax-r.extent.ymin)/r.pixelBlock.height,o=.01*Math.min(n,i),s=e.sort((function(e,t){return Math.abs(e.extent.ymax-t.extent.ymax)>o?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>o?e.extent.xmin-t.extent.xmin:0})),l=Math.min.apply(null,s.map((function(e){return e.extent.xmin}))),u=Math.min.apply(null,s.map((function(e){return e.extent.ymin}))),p=Math.max.apply(null,s.map((function(e){return e.extent.xmax}))),c=Math.max.apply(null,s.map((function(e){return e.extent.ymax}))),f={x:Math.round((t.xmin-l)/n),y:Math.round((c-t.ymax)/i)},h={width:Math.round((p-l)/n),height:Math.round((c-u)/i)},d={width:Math.round((t.xmax-t.xmin)/n),height:Math.round((t.ymax-t.ymin)/i)};return Math.round(h.width/r.pixelBlock.width)*Math.round(h.height/r.pixelBlock.height)!==s.length||f.x<0||f.y<0||h.width<d.width||h.height<d.height?null:{extent:t,pixelBlock:a(s.map((function(e){return e.pixelBlock})),h,f,d)}},t.mosaic=a,t.setValidBoundary=function(e,t,r){if(!n(e))return null;var i=e.width,o=e.height,a=t.x,s=t.y,l=r.width+a,u=r.height+s;if(a<0||s<0||l>i||u>o)return e;if(0===a&&0===s&&l===i&&u===o)return e;e.mask||(e.mask=new Uint8Array(i*o));for(var p=e.mask,c=0;c<o;c++)for(var f=c*i,h=0;h<i;h++)p[f+h]=c<s||c>=u||h<a||h>=l?0:1;return e.updateStatistics(),e},t.clip=function(e,t,i){if(!n(e))return null;var o=t.x,a=t.y,s=t.x+i.width,l=t.x+i.height;if(l===e.height&&s===e.width)return e;for(var u,p=e.pixels,c=e.mask,f=e.width,h=f*e.height,d=p.length,m=[],_=0;_<d;_++){for(var y=p[_],g=r.createEmptyBand(e.pixelType,h),v=0,x=a;x<=l;x++)for(var w=x*f,P=o;P<=s;P++)g[v++]=y[w+P];m.push(g)}if(c)for(u=new Uint8Array(i.width*i.height),v=0,x=a;x<=l;x++)for(w=x*f,P=o;P<=s;P++)u[v++]=c[w+P];var b=new r({width:i.width,height:i.height,pixels:m,mask:u});return b.updateStatistics(),b},t.approximateTransform=function(e,t,i,o){if(!n(e))return null;for(var a,s,l,u,p,c,f,h=e.pixels,d=e.mask,m=e.pixelType,_=e.width,y=e.height,g=r.getPixelArrayConstructor(m),v=h.length,x=t.width,w=t.height,P=o.cols,b=o.rows,T=Math.ceil(x/P),S=Math.ceil(w/b),I=!1,R=0;R<i.length;R+=3)-1===i[R]&&-1===i[R+1]&&-1===i[R+2]&&(I=!0);var E,k,M=new Float32Array(x*w),A=new Float32Array(x*w),C=0;for(R=0;R<S;R++)for(var O=0;O<T;O++){s=i[a=12*(R*T+O)],l=i[a+1],u=i[a+2],p=i[a+3],c=i[a+4],f=i[a+5];for(var N=0;N<b;N++){C=(R*b+N)*x+O*P,k=(N+.5)/b;for(var F=0;F<N;F++)E=(F+.5)/P,M[C+F]=Math.round((s*E+l*k+u)*_-.5),A[C+F]=Math.round((p*E+c*k+f)*y-.5)}for(s=i[a+=6],l=i[a+1],u=i[a+2],p=i[a+3],c=i[a+4],f=i[a+5],N=0;N<b;N++)for(C=(R*b+N)*x+O*P,k=(N+.5)/b,F=N;F<P;F++)E=(F+.5)/P,M[C+F]=Math.round((s*E+l*k+u)*_-.5),A[C+F]=Math.round((p*E+c*k+f)*y-.5)}for(var B,D=function(e,t){for(var r=0;r<w;r++){a=r*x;for(var n=0;n<x;n++)I&&(M[a]<0||A[a]<0)?e[a]=0:e[a]=t[M[a]+A[a]*_],a++}},j=[],L=0;L<v;L++)D(B=new g(x*w),h[L]),j.push(B);var U=new r({width:x,height:w,pixelType:m,pixels:j});if(d)U.mask=new Uint8Array(x*w),D(U.mask,d);else if(I)for(U.mask=new Uint8Array(x*w),R=0;R<x*w;R++)U.mask[R]=M[R]<0||A[R]<0?0:1;return U.updateStatistics(),U}}.apply(null,n))||(e.exports=i)},421:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.variableName=null,r.dimensionName=null,r.values=[],r.isSlice=!1,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:i.clone(this.values),isSlice:this.isSlice})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"variableName",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"dimensionName",void 0),r.__decorate([o.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],t.prototype,"values",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"isSlice",void 0),n=r.__decorate([o.subclass("esri.layers.support.DimensionalDefinition")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},422:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(399),r(180),r(118),r(313),r(461),r(549),r(630)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},p={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},c=l.fromJSON(a.PREDEFINED_JSON_COLOR_RAMPS[0]);t.isSupportedRendererType=function(e){return["raster-stretch","unique-value","class-breaks","raster-shaded-relief"].indexOf(e.type)>-1},t.combineRenderingRules=function(e,t){if(!e||!t)return i.clone(e||t);var r=i.clone(e);return"none"!==t.functionName.toLowerCase()&&((function e(t){var r=t.Raster;return r&&"esri.layers.support.RasterFunction"===r.declaredClass?e(r.functionArguments):t}(r.functionArguments)).Raster=t),r},t.convertRendererToRenderingRule=function(e,t){switch(t=t||{},e.type){case"raster-stretch":return function(e,t){var r=new o;r.functionName="Stretch";var n=f[s.stretchTypeJSONDict.toJSON(e.stretchType)],i={StretchType:n,Statistics:function(e){var t=[];return e.forEach((function(e){var r=e;if(Array.isArray(r))t.push(r);else{if(null==r.min||null==r.max)return;var n=[r.min,r.max,r.avg||0,r.stddev||0];t.push(n)}})),t}(e.statistics),DRA:e.dynamicRangeAdjustment,UseGamma:e.useGamma,Gamma:e.gamma,ComputeGamma:e.computeGamma};if(null!=e.outputMin&&(i.Min=e.outputMin),null!=e.outputMax&&(i.Max=e.outputMax),n===f.standardDeviation?(i.NumberOfStandardDeviations=e.numberOfStandardDeviations,r.outputPixelType="u8"):n===f.percentClip?(i.MinPercent=e.minPercent,i.MaxPercent=e.maxPercent,r.outputPixelType="u8"):n===f.minMax?r.outputPixelType="u8":n===f.sigmoid&&(i.SigmoidStrengthLevel=e.sigmoidStrengthLevel),r.functionArguments=i,r.variableName="Raster",e.colorRamp){var l=e.colorRamp,u=new o,p=a.getColorRampName(l);return p?u.functionArguments={colorRamp:p}:!t.convertColorRampToColormap||"algorithmic"!==l.type&&"multipart"!==l.type?u.functionArguments={colorRamp:e.colorRamp.toJSON()}:u.functionArguments={Colormap:a.convertColorRampToColormap(l,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=r,u}return r}(e,t);case"class-breaks":return function(e,t){var r=[],n=[],i=[],a=[],s=t.pixelType,l=t.rasterAttributeTable,u=l&&l.features,p=d(l);if(u&&Array.isArray(u)&&e.classBreakInfos){e.classBreakInfos.forEach((function(t,r){var n,i=t.symbol.color;i.a&&u.forEach((function(o){((n=o.attributes[e.field])>=t.minValue&&n<t.maxValue||r===e.classBreakInfos.length-1&&n>=t.minValue)&&a.push([o.attributes[p],i.r,i.g,i.b])}))}));var c=s?h(a,s):a,f=new o;return f.functionName="Colormap",f.functionArguments={},f.functionArguments.Colormap=c,f.variableName="Raster",f}e.classBreakInfos.forEach((function(e,t){var o=e.symbol&&e.symbol.color;o.a?(0===t?r.push(e.minValue,e.maxValue+1e-6):r.push(e.minValue+1e-6,e.maxValue+1e-6),n.push(t),a.push([t,o.r,o.g,o.b])):i.push(e.minValue,e.maxValue)}));var m=s?h(a,s):a,_=new o;_.functionName="Remap",_.functionArguments={InputRanges:r,OutputValues:n,NoDataRanges:i},_.variableName="Raster";var y=new o;return y.functionName="Colormap",y.functionArguments={Colormap:m,Raster:_},y}(e,t);case"unique-value":return function(e,t){var r=[],n=t.pixelType,i=t.rasterAttributeTable,a=i&&i.features,s=d(i),l=!1;if(e.uniqueValueInfos&&e.uniqueValueInfos.forEach((function(t){var n=t.symbol.color;n.a&&(e.field!==s&&a?a&&a.forEach((function(i){String(i.attributes[e.field])===String(t.value)&&r.push([i.attributes[s],n.r,n.g,n.b])})):isNaN(t.value)?l=!0:r.push([t.value,n.r,n.g,n.b]))})),l)return null;var u=n&&r.length>0?h(r,n):r,p=new o;return p.functionName="Colormap",p.functionArguments={},p.functionArguments.Colormap=u,p.variableName="Raster",p}(e,t);case"raster-colormap":return function(e,t){var r=e.extractColormap();if(r&&0!==r.length){var n=t.pixelType,i=n?h(r,n):r,a=new o;return a.functionName="Colormap",a.functionArguments={},a.functionArguments.Colormap=i,a}}(e,t);case"raster-shaded-relief":return function(e,t){if("elevation"!==t.dataType)return new o;var r=new o;r.functionName="Hillshade";var n="traditional"===e.hillshadeType?0:1,i="none"===e.scalingType?1:3,s={HillshadeType:n,SlopeType:i,ZFactor:e.zFactor};return 0===n&&(s.Azimuth=e.azimuth,s.Altitude=e.altitude),3===i&&(s.PSPower=e.pixelSizePower,s.PSZFactor=e.pixelSizeFactor),r.functionArguments=s,r.variableName="Raster",e.colorRamp&&(r.functionName="ShadedRelief",s.Colormap=a.convertColorRampToColormap(e.colorRamp,256)),r}(e,t)}},t.createDefaultRenderer=function(e,t){if(e){var n,i,o,s,l,u,f,h=e.attributeTable,d=e.dataType,m=e.bandCount,_=e.pixelType,y=e.colormap,g=e.statistics,v=e.histograms;if(t&&t.length>0&&(g=g?t.map((function(e){return g[e]})):null,v=v?t.map((function(e){return v[e]})):null),h&&(i=h.fields.filter((function(e){return"red"===e.name.toLowerCase()}))[0],o=h.fields.filter((function(e){return"green"===e.name.toLowerCase()}))[0],s=h.fields.filter((function(e){return"blue"===e.name.toLowerCase()}))[0],u=h.fields.filter((function(e){return"value"===e.name.toLowerCase()}))[0],(l=h.fields.filter((function(e){return"classname"===e.name.toLowerCase()||"class_name"===e.name.toLowerCase()}))[0])||(l=h.fields.filter((function(e){return"string"===e.type}))[0])||(l=u)),1===m&&(null==y?void 0:y.length)>0)h&&i&&o&&s&&(f={},h.features.forEach((function(e){var t=e.attributes;f[t[u.name]]=l?t[l.name]:t[u.name]}))),n=r.RasterColormapRenderer.createFromColormap(y,f);else if(1===m&&h){var x=void 0,w=h.features;if(i&&o&&s&&l)x=w.map((function(e){return{value:e.attributes[l.name],label:e.attributes[l.name],symbol:{type:"esriSFS",style:"esriSFSSolid",color:[e.attributes[i.name],e.attributes[o.name],e.attributes[s.name],255]}}}));else{var P=a.convertColorRampToColormap(c,w.length);x=w.map((function(e,t){return{value:e.attributes[u.name],label:e.attributes[u.name],symbol:{color:P[t].slice(1,4),type:"esriSFS",style:"esriSFSSolid"}}}))}x.sort((function(e,t){return e.value>t.value?1:-1})),n=r.UniqueValueRenderer.fromJSON({field1:l.name,uniqueValueInfos:x})}if(!n){var b=void 0,T=!1,S=void 0,I=void 0,R=void 0;"u8"===_&&"processed"===d?(b="none",g=1===m?[{min:0,max:255}]:[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===_||"elevation"===d?(b="min-max",T=!g):"scientific"===d?(b="min-max",T=!g,S=p):v&&v.length>0?(b="percent-clip",R=I=.25):g?b="min-max":(b="percent-clip",T=!0),n=r.RasterStretchRenderer.fromJSON({stretchType:b,dra:T,colorRamp:S,min:0,max:255,statistics:T?null:g,histograms:T?null:v,maxPercent:I,minPercent:R})}return n}},t.getDefaultBandCombination=function(e){var t=e.bandCount;if(1===t)return null;if(2===t)return[0];var r,n,i,o,a,s=e.keyProperties&&e.keyProperties.BandProperties;if(s&&s.length===t){for(var l=0;l<s.length;l++)s[l].BandName&&"red"===s[l].BandName.toLowerCase()&&(n=l),s[l].BandName&&"green"===s[l].BandName.toLowerCase()&&(i=l),s[l].BandName&&"blue"===s[l].BandName.toLowerCase()&&(o=l),s[l].BandName&&"nearinfrared"===s[l].BandName.toLowerCase()&&(a=l);void 0!==n&&void 0!==i&&void 0!==o?r=[n,i,o]:void 0!==n&&void 0!==i&&void 0!==a&&(r=[a,n,i])}return!r&&t>3&&(r=[0,1,2]),r};var f={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function h(e,t){var r=u[String(t).toLowerCase()];return r&&e.push([Math.floor(r[0]-1),0,0,0],[Math.ceil(r[1]+1),0,0,0]),e}function d(e){if(e){var t=e.fields,r=t&&n.find(t,(function(e){return e&&e.name&&"value"===e.name.toLowerCase()}));return r&&r.name}}}.apply(null,n))||(e.exports=i)},550:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(153),r(305),r(267)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(){this._workerThread=null,this._destroyed=!1}return e.prototype.initialize=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,o.open("RasterWorker")];case 1:return e=t.sent(),this._destroyed?e.close():this._workerThread=e,[2]}}))}))},e.prototype.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},e.prototype.decode=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",e,t)];case 1:return[2,(i=r.sent())?new a(i):null]}}))}))},e.prototype.symbolize=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return i={extent:e.extent&&e.extent.toJSON(),pixelBlock:e.pixelBlock.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},[4,this._workerThread.invoke("symbolize",i,t)];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.updateSymbolizer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return o=e&&e.renderer&&"raster-stretch"===e.renderer.type&&e.renderer.histograms,[4,i.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:o},t))];case 1:return r.sent(),[2]}}))}))},e.prototype.stretch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.pixelBlock?(i={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},[4,this._workerThread.invoke("stretch",i,t)]):[2,null];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.mosaicAndTransform=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(s){switch(s.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.srcPixelBlocks&&e.srcPixelBlocks.length>0?(i=r.__assign(r.__assign({},e),{srcPixelBlocks:e.srcPixelBlocks.map((function(e){return e?e.toJSON():null}))}),[4,this._workerThread.invoke("mosaicAndTransform",i,t)]):[2,null];case 1:return[2,(o=s.sent())?new a(o):null]}}))}))},e}()}.apply(null,n))||(e.exports=i)},611:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(154),r(291),r(178),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)};t.defaultGridSpacing=32,t.load=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return o.isLoaded()||!o.isSupported()?[2,null]:[4,o.load()];case 1:return e.sent(),[2]}}))}))},t.projectResolution=function(e,t,r,a){if(void 0===a&&(a=null),e.spatialReference.equals(t))return e;var u=l(e.spatialReference,t);if(u&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");var p=r.center,c=new n.Extent({xmin:p.x-e.x/2,xmax:p.x+e.x/2,ymin:p.y-e.y/2,ymax:p.y+e.y/2,spatialReference:e.spatialReference}),f=u?o.project(c,t,a):s.project(c,t);return null==f?null:new n.Point(f.xmax-f.xmin,f.ymax-f.ymin,t)},t.projectPoint=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=l(e.spatialReference,t);if(n&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");return n?o.project(e,t,r):s.project(e,t)},t.projectExtent=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=l(e.spatialReference,t);if(n&&!o.isLoaded())throw new i("rasterprojectionhelper-projectExtent","projection engine is not loaded");return n?o.project(e,t,r):s.project(e,t)},t.getProjectionOffsetGrid=function(e,r,u,p,c,f){void 0===p&&(p=null),void 0===c&&(c=!1),void 0===f&&(f=[t.defaultGridSpacing,t.defaultGridSpacing]);var h=r.spatialReference.equals(e.spatialReference),d=l(e.spatialReference,r.spatialReference);if(d&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&r&&u))return null;for(var m,_,y,g=e.xmin,v=e.ymin,x=e.xmax,w=e.ymax,P=e.spatialReference,b=r.spatialReference,T=a.getInfo(P),S=T&&T.valid[0],I=T&&T.valid[1],R={x:f[0]*u.x,y:f[1]*u.y},E={cols:Math.ceil((x-g)/R.x-.1)+1,rows:Math.ceil((w-v)/R.y-.1)+1},k=R.x,M=R.y,A=[],C=!1,O=0;O<E.cols;O++){for(var N=[],F=0;F<E.rows;F++)m=new n.Point({x:g+k*O,y:w-M*F,spatialReference:P}),_=h?m:d?o.project(m,b,p):s.project(m,b),N.push(_),O>0&&c&&_&&y[F]&&T&&_.x<y[F].x&&(_.x+=I-S),_?(A.push((_.x-r.xmin)/(r.xmax-r.xmin)),A.push((r.ymax-_.y)/(r.ymax-r.ymin))):(A.push(NaN),A.push(NaN),C=!0);y=N}var B=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,n=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(n-e[2*t.rows+3])]}(A,E),D=new Float32Array((E.cols-1)*(E.rows-1)*2*6),j=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),L=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(O=0;O<E.cols-1;O++){for(F=0;F<E.rows-1;F++){for(var U=O*E.rows*2+2*F,G=A[U],z=A[U+1],H=A[U+2],J=A[U+3],V=A[U+=2*E.rows],q=A[U+1],Y=A[U+2],W=A[U+3],X=0,Z=12*(F*(E.cols-1)+O),K=0;K<3;K++)D[Z++]=j[X++]*G+j[X++]*H+j[X++]*Y;for(X=0,K=0;K<3;K++)D[Z++]=j[X++]*z+j[X++]*J+j[X++]*W;for(X=0,K=0;K<3;K++)D[Z++]=L[X++]*G+L[X++]*V+L[X++]*Y;for(X=0,K=0;K<3;K++)D[Z++]=L[X++]*z+L[X++]*q+L[X++]*W}if(C)for(var $=0;$<D.length;$++)isNaN(D[$])&&(D[$]=-1)}return{offsets:A,error:B,coefficients:D,spacing:f,size:[E.cols-1,E.rows-1]}},t.snapPyramid=function(e,t,r){var i=Math.log(e.x/t.pixelSize.x)/Math.LN2,o=Math.log(e.y/t.pixelSize.y)/Math.LN2,a=t.storageInfo.maximumPyramidLevel||0,s="down"===r?Math.floor(Math.min(i,o)):"up"===r?Math.ceil(Math.max(i,o)):Math.round((i+o)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);var u=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new n.Point({x:u*t.pixelSize.x,y:u*t.pixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}}.apply(null,n))||(e.exports=i)},744:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(297),r(399),r(165),r(154),r(166),r(156),r(152),r(225),r(153),r(151),r(179),r(178),r(208),r(244),r(240),r(298),r(265),r(233),r(421),r(194),r(422),r(550),r(237),r(2250),r(604),r(411)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,_,y,g,v,x,w,P,b,T,S,I,R,E,k){var M=l.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"});function A(){return{enabled:!this.loaded||"RasterTileServer"===this.raster.datasetFormat&&"Raster"===this.raster.tileType}}var C=u.getLogger("esri.layers.ImageryTileLayer");return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},n.bandIds=null,n.copyright=null,n.fullExtent=null,n.interpolation="nearest",n.legendEnabled=!0,n.isReference=null,n.listMode="show",n.raster=null,n.rasterInfo=null,n.sourceJSON=null,n.spatialReference=null,n.tileInfo=null,n.version=null,n.title=null,n.type="imagery-tile",n.url=null,n.operationalLayerType="ArcGISTiledImageServiceLayer",n.popupEnabled=!0,n.popupTemplate=null,n.symbolizer=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r.__assign({url:e},t):e},t.prototype.load=function(e){var t=this,r=p.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((function(){return t._openRaster(r)}),(function(){return t._openRaster(r)}))),f.resolve(this)},Object.defineProperty(t.prototype,"multidimensionalDefinition",{set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){var e,t,r=[new b({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null===(t=null===(e=this.rasterInfo)||void 0===e?void 0:e.attributeTable)||void 0===t?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){this._set("renderer",e),this.updateRenderer()},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=o.read(n,r)||void 0;if(null!=i)return i},t.prototype.createPopupTemplate=function(e){return k.createPopupTemplate(this,e)},t.prototype.updateRenderer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.loaded?JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer)?[2]:(e=this._rasterJobHandler.instance)?(this.symbolizer.renderer=this.renderer,this.symbolizer.bind(),[4,e.updateSymbolizer(this.symbolizer)]):[2]:[2];case 1:return t.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}}))}))},t.prototype.applyRenderer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return(n=e&&e.pixelBlock)&&n.pixels&&n.pixels.length>0?(this.updateRenderer(),o=this._rasterJobHandler.instance,a=this.bandIds,o?[4,o.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a}))]:[3,2]):[2,null];case 1:return i=s.sent(),[3,3];case 2:i=this.symbolizer.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a})),s.label=3;case 3:return[2,i]}}))}))},t.prototype.getTileUrl=function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?this.url+"/tile/"+e+"/"+t+"/"+r:""},t.prototype.getCompatibleTileInfo=function(e,t){if(!this.loaded)return null;var r=m.getInfo(e);return I.create({size:256,spatialReference:e,origin:r?{x:r.origin[0],y:r.origin[1]}:{x:t.xmin,y:t.ymax}})},t.prototype.getCompatibleFullExtent=function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null},t.prototype.fetchTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s;return r.__generator(this,(function(l){switch(l.label){case 0:return i.requestAsImageElement?(o=this.getTileUrl(e,t,n),[2,a(o,{responseType:"image",query:{sliceId:this._sliceId,_ts:i.timestamp},signal:i.signal}).then((function(e){return e.data}))]):[4,this._initJobHandler()];case 1:return l.sent(),this.multidimensionalDefinition&&(s=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:s},i)),[2,this.raster.fetchTile(e,t,n,i)]}}))}))},t.prototype.fetchPixels=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,this._initJobHandler()];case 1:return a.sent(),this.multidimensionalDefinition&&(o=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:o},i)),[2,this.raster.fetchPixels(e,t,n,i)]}}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),this.raster.identify(e,t)},t.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},t.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},t.prototype.write=function(t,r){var n=this.raster;if(this.loaded?"RasterTileServer"===n.datasetFormat&&("Raster"===n.tileType||"Map"===n.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return e.prototype.write.call(this,t,r);if(r&&r.messages){var i=r.origin+"/"+(r.layerContainerType||"operational-layers");r.messages.push(new s("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+i+"'",{layer:this}))}return null},t.prototype._initJobHandler=function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new S;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise},t.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},t.prototype._openRaster=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,a,l,u,p,c,f,h;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,R.open(this.raster||{url:this.url,sourceJSON:this.sourceJSON,signal:e})];case 1:if(t=r.sent(),this.url||(this.url=t.url),this.raster=t,!(n=t.rasterInfo))throw new s("tile-imagery-layer:load","cannot load resources on "+this.url);if(this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText)),"Map"===this.raster.tileType&&(this.popupEnabled=!1),i=n.spatialReference,o=n.pixelSize,a=n.storageInfo,!(l=a.tileInfo)){for(u=[],p=a.maximumPyramidLevel||0,c=Math.max(o.x,o.y),f=1/.0254*96*c,h=0;h<=p;h++)u.push({level:p-h,resolution:c,scale:f}),c*=2,f*=2;l=new I({origin:a.origin,size:[a.blockWidth,a.blockHeight],spatialReference:i,lods:u}),a.tileInfo=l}return null==this.title&&(this.title=this.raster.datasetName),n.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)),this._configDefaultRenderer(),[2,t]}}))}))},t.prototype._configDefaultSlice=function(){var e=this.raster.rasterInfo.multidimensionalInfo.variables[0],t=[];e.dimensions.forEach((function(r){t.push(new P({variableName:e.name,dimensionName:r.name,values:r.values[0],isSlice:!0}))})),this.multidimensionalDefinition=t},t.prototype._configDefaultRenderer=function(){var e=this.raster.rasterInfo,t=e.pixelType;this.bandIds||(this.bandIds=T.getDefaultBandCombination(e)),this.renderer||(this.renderer=T.createDefaultRenderer(e,this.bandIds)),"u8"===t&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]),this.symbolizer?(this.symbolizer.renderer=this.renderer,this.symbolizer.rasterInfo=e):this.symbolizer=new E({renderer:this.renderer,rasterInfo:e}),this.symbolizer.bind()||C.warn("ImageryTileLayer","The given renderer is not supported by the layer.")},r.__decorate([h.property()],t.prototype,"_cachedRendererJson",void 0),r.__decorate([h.property()],t.prototype,"_sliceId",void 0),r.__decorate([h.property()],t.prototype,"_compatibleFullExtent",void 0),r.__decorate([h.property()],t.prototype,"_rasterJobHandler",void 0),r.__decorate([h.property({type:[d.Integer],json:{write:{overridePolicy:A}}})],t.prototype,"bandIds",void 0),r.__decorate([h.property()],t.prototype,"copyright",void 0),r.__decorate([h.property({type:n.Extent}),h.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),r.__decorate([h.property({type:String,json:{read:{reader:M.read},write:{writer:M.write,overridePolicy:A}}})],t.prototype,"interpolation",void 0),r.__decorate([h.property(w.legendEnabled)],t.prototype,"legendEnabled",void 0),r.__decorate([h.property({type:Boolean,json:{read:!1}})],t.prototype,"isReference",void 0),r.__decorate([h.property({type:["show","hide"]})],t.prototype,"listMode",void 0),r.__decorate([h.property({type:[P]})],t.prototype,"multidimensionalDefinition",null),r.__decorate([h.property()],t.prototype,"raster",void 0),r.__decorate([h.property({readOnly:!0}),h.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),r.__decorate([h.property()],t.prototype,"sourceJSON",void 0),r.__decorate([h.property({type:n.SpatialReference}),h.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),r.__decorate([h.property({type:I,dependsOn:["rasterInfo"]}),h.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"version",void 0),r.__decorate([h.property()],t.prototype,"title",void 0),r.__decorate([h.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),r.__decorate([h.property(w.url)],t.prototype,"url",void 0),r.__decorate([h.property({type:["ArcGISTiledImageServiceLayer"]})],t.prototype,"operationalLayerType",void 0),r.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:A,writer:function(e,t,r){t[r]=!e}}}})],t.prototype,"popupEnabled",void 0),r.__decorate([h.property({type:i,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:A}}})],t.prototype,"popupTemplate",void 0),r.__decorate([h.property({readOnly:!0,dependsOn:["title"]})],t.prototype,"defaultPopupTemplate",null),r.__decorate([h.property({readOnly:!0,type:[b],dependsOn:["rasterInfo"]})],t.prototype,"fields",null),r.__decorate([h.property({types:o.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:A}}})],t.prototype,"renderer",null),r.__decorate([h.reader("renderer")],t.prototype,"readRenderer",null),r.__decorate([h.property()],t.prototype,"symbolizer",void 0),r.__decorate([h.subclass("esri.layers.ImageryTileLayer")],t)}(x.ScaleRangeLayer(v.RefreshableLayer(y.OperationalLayer(g.PortalLayer(c.MultiOriginJSONMixin(_))))))}.apply(null,n))||(e.exports=i)},845:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(202)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockWidth=void 0,t.blockHeight=void 0,t.compression=null,t.origin=null,t.firstPyramidLevel=null,t.maximumPyramidLevel=null,t.pyramidScalingFactor=2,t.pyramidBlockWidth=null,t.pyramidBlockHeight=null,t.tileInfo=null,t.blockBoundary=null,t}return r.__extends(t,e),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockHeight",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"compression",void 0),r.__decorate([i.property({type:o,json:{write:!0}})],t.prototype,"origin",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"firstPyramidLevel",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maximumPyramidLevel",void 0),r.__decorate([i.property()],t.prototype,"pyramidScalingFactor",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockHeight",void 0),r.__decorate([i.property({json:{write:!0}})],t.prototype,"tileInfo",void 0),r.__decorate([i.property()],t.prototype,"blockBoundary",void 0),r.__decorate([i.subclass("esri.layers.support.RasterStorageInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},846:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(154),r(155),r(152),r(303),r(153),r(172),r(151),r(233),r(237),r(1047),r(603),r(376),r(611)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,h,d,m,_,y){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rasterJobHandler=null,t.datasetName=null,t.datasetFormat=null,t.rasterInfo=null,t.ioConfig={sampling:"closest"},t}return r.__extends(t,e),t.prototype.init=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=y.load(),this.addResolvingPromise(e),[4,this.when()];case 1:return t.sent(),[2]}}))}))},t.prototype.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e=r.__assign(r.__assign({},e),{ioConfig:r.__assign({resolution:null,bandIds:null,sampling:"closest",tileInfo:h.create()},e.ioConfig)})),e},Object.defineProperty(t.prototype,"url",{set:function(e){var t=p.urlToObject(e);this._set("url",t.path)},enumerable:!0,configurable:!0}),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:open-not-implemented","open() is not implemented")}))}))},t.prototype.fetchTile=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u;return r.__generator(this,(function(r){return a=o.tileInfo,s=a.lodAt(e),l=new n.Point({x:s.resolution,y:s.resolution,spatialReference:a.spatialReference}),u=this._getTileExtent(l,t,i,a),[2,this.fetchPixels(u,a.size[0],a.size[1],o)]}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,l,u,p,c,f,h,m,_,g,v,x,w,P,b;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.rasterInfo,i=n.spatialReference,o=n.extent,a=t.datumTransformation,l=y.projectPoint(e,i,a),o.intersects(l)?(u=0,t.srcResolution?(p=y.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling),u=p.pyramidLevel,[3,3]):[3,1]):[2,{location:l,value:null}];case 1:return[4,this.computeBestPyramidLevelForLocation(e,t)];case 2:if(null==(u=r.sent()))return[2,{location:l,value:null}];r.label=3;case 3:return null===(c=this.identifyPixelLocation(l,u,null))?[2,{location:l,value:null}]:(f=c.row,h=c.col,m=c.rowOffset,_=c.colOffset,g=this.url,v=u+"/"+f+"/"+h,x=d.getBlock(g,null,v),s.isSome(x)||(x=this.fetchRawTile(u,f,h,t),d.putBlock(g,null,v,x)),[4,x]);case 4:return(w=r.sent())&&w.pixels&&w.pixels.length>0?(P=m*this.rasterInfo.storageInfo.blockHeight+_,b=!w.mask||w.mask[P]?w.pixels.map((function(e){return e[P]})):null,[2,{location:l,value:b,pyramidLevel:u}]):[2,{location:l,value:null}]}}))}))},t.prototype.fetchPixels=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u,p,c,f,h,d,m,g,v,x,w,P,b,T,S,I,R,E,k,M,A,C;return r.__generator(this,(function(r){switch(r.label){case 0:return a=e.clone().normalize(),e=a[0],s=this.rasterInfo.spatialReference,l=!e.spatialReference.equals(s),u=o.datumTransformation,p=new n.Point({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/i,spatialReference:e.spatialReference}),(c=o.srcResolution||(l?y.projectResolution(p,s,e,u):p))?(f=y.snapPyramid(c,this.rasterInfo,this.ioConfig.sampling),h=f.pyramidLevel,d=f.pyramidResolution,f.excessiveReading?[2,null]:(m=this.rasterInfo.storageInfo,null==(g=l?y.projectExtent(e,s,u):e)?[2,null]:(v={x:Math.floor((g.xmin-m.origin.x)/d.x+.1),y:Math.floor((m.origin.y-g.ymax)/d.y+.1)},x=Math.ceil((g.xmax-g.xmin)/d.x-.1),w=Math.ceil((g.ymax-g.ymin)/d.y-.1),x/t>8||w/i>8?[2,null]:[4,this.fetchRawPixels(h,v,{width:x,height:w},o)]))):[2,null];case 1:return(P=r.sent())?(b=h>0?m.pyramidBlockWidth:m.blockWidth,T=h>0?m.pyramidBlockHeight:m.blockHeight,l||1!==P.pixelBlocks.length||b!==t||T!==i||c.x!==p.x||c.y!==p.y?(S=y.getProjectionOffsetGrid(e,P.extent,p,u),R=!o.requestRawData,E={rows:S.spacing[0],cols:S.spacing[1]},k=P.pixelBlocks,M=P.mosaicSize,A=P.isPartiallyFilled,this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:k,srcMosaicSize:M,destDimension:R?{width:t,height:i}:null,coefs:R?S.coefficients:null,sampleSpacing:R?E:null},o)]:[3,3]):[2,{extent:e,srcExtent:g,pixelBlock:P.pixelBlocks[0],transformGrid:null}]):[2,null];case 2:return I=r.sent(),[3,4];case 3:C=_.mosaic(k,M),I=R?_.approximateTransform(C,{width:t,height:i},S.coefficients,E):C,r.label=4;case 4:return[2,{srcExtent:g,pixelBlock:I,transformGrid:S,extent:e,isPartiallyFilled:A}]}}))}))},t.prototype.fetchRawPixels=function(e,t,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,p,c,f,h,d,m,_,y,g,v,x,w,P,b,T,S,I,R,E,k,M,A,C;return r.__generator(this,(function(r){switch(r.label){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,l=a.blockBoundary,p=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,c=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,f=Math.floor(t.x/p),h=Math.floor(t.y/c),d=Math.floor((t.x+i.width-1)/p),m=Math.floor((t.y+i.height-1)/c),_=this.rasterInfo,y=_.pixelSize,g=_.spatialReference,!(v=l[e]))return[2,null];if(x=v.minRow,w=v.minCol,P=v.maxCol,b=v.maxRow,m<x||d<w||h>b||f>P)return[2,null];for(T=[],I=!1,R=h;R<=m;R++)for(E=f;E<=d;E++)R>=x&&E>=w&&b>=R&&P>=E?(S=this._fetchRawTile(e,R,E,o),this.ioConfig.allowPartialFill&&(S=u.create((function(e){S.then((function(t){return e(t)})).catch((function(){I=!0,e(null)}))}))),T.push(S)):T.push(null);return 0===T.length?[2,null]:[4,u.all(T)];case 1:return k=r.sent(),M={height:(m-h+1)*p,width:(d-f+1)*c},A=y.x*Math.pow(2,e),C=y.y*Math.pow(2,e),[2,{extent:new n.Extent({xmin:s.x+f*p*A,xmax:s.x+(d+1)*p*A,ymin:s.y-(m+1)*c*C,ymax:s.y-h*c*C,spatialReference:g}),pixelBlocks:k,mosaicSize:M,isPartiallyFilled:I}]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}))}))},t.prototype.computeExtent=function(e){return y.projectExtent(this.rasterInfo.extent,e)},t.prototype.decodePixelBlock=function(e,t){return this.rasterJobHandler?this.rasterJobHandler.decode({data:e,options:t}):m.decode(e,t)},t.prototype.request=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,l,u,p;return r.__generator(this,(function(c){switch(c.label){case 0:n=this.ioConfig.customFetchParameters,o=e.url,a=e.range,s=e.query,l=e.responseType,null==e.retryCount&&this.ioConfig.retryCount&&(e.retryCount=this.ioConfig.retryCount),u=a?{Range:"bytes="+a.from+"-"+a.to}:null,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,i(o,{query:r.__assign(r.__assign({},s),n),headers:u,responseType:l,signal:t})];case 2:return[2,c.sent().data];case 3:if(p=c.sent(),e.retryCount>0)return e.retryCount--,[2,this.request(e,t)];throw p;case 4:return[2]}}))}))},t.prototype.getSliceIndex=function(e){var t=this.rasterInfo.multidimensionalInfo;if(!t||0===e.length)return null;for(var r=0,n=e[0].variableName,i=function(i){var o=t.variables[i],a=o.dimensions;if(o.name!==n)return r+=a.map((function(e){return e.values.length})).reduce((function(e,t){return e+t})),"break";for(var s=a.map((function(e){return e.values.length})),l=a.length,u=function(t){var n=e.filter((function(e){return e.dimensionName===a[t].name}))[0];if(null==n)return{value:null};var i=Array.isArray(n.values[0])?n.values[0][0]:n.values[0],o=a[t].values.indexOf(i);if(-1===o)return{value:null};s.shift(),r+=t===l-1?o:o*s.reduce((function(e,t){return e+t}))},p=0;p<l;p++){var c=u(p);if("object"==typeof c)return c}},o=0;o<t.variables.length;o++){var a=i(o);if("object"==typeof a)return a.value;if("break"===a)break}return r},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,0]}))}))},t.prototype.identifyPixelLocation=function(e,t,r){var n=this.rasterInfo,i=n.spatialReference,o=n.pixelSize,a=n.extent,s=this.rasterInfo.storageInfo,l=s.blockWidth,u=s.blockHeight,p=s.maximumPyramidLevel,c=s.pyramidScalingFactor,f=s.origin,h=y.projectPoint(e,i,r);if(!a.intersects(h))return null;if(t<0||t>p)return null;var d=Math.pow(c,t),m=d*o.x,_=d*o.y,g=(f.y-h.y)/_/u,v=(h.x-f.x)/m/l,x=Math.min(u-1,Math.floor((g-Math.floor(g))*u)),w=Math.min(l-1,Math.floor((v-Math.floor(v))*l));return{pyramidLevel:t,row:Math.floor(g),col:Math.floor(v),rowOffset:x,colOffset:w,srcLocation:h}},t.prototype._getTileExtent=function(e,t,r,i){var o=i.origin,a=i.spatialReference,s=i.size[0],l=i.size[1],u=o.x+r*s*e.x,p=u+s*e.x,c=o.y-t*l*e.y,f=c-l*e.y;return new n.Extent({xmin:u,xmax:p,ymin:f,ymax:c,spatialReference:a})},t.prototype._fetchRawTile=function(e,t,n,i){var o=this.url,a=e+"/"+t+"/"+n,l=d.getBlock(o,i.registryId,a);if(!s.isSome(l)){var p=u.createAbortController();l=this.fetchRawTile(e,t,n,r.__assign(r.__assign({},i),{signal:p.signal})),d.putBlock(o,i.registryId,a,l,p),l.catch((function(){d.deleteBlock(o,i.registryId,a)}))}return i.signal&&u.onAbort(i,(function(){d.decreaseRefCount(o,i.registryId,a)})),l},r.__decorate([c.property(f.url)],t.prototype,"url",null),r.__decorate([c.property({type:String,json:{write:!0}})],t.prototype,"datasetName",void 0),r.__decorate([c.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([c.property()],t.prototype,"rasterInfo",void 0),r.__decorate([c.property()],t.prototype,"ioConfig",void 0),r.__decorate([c.property()],t.prototype,"sourceJSON",void 0),r.__decorate([c.subclass("esri.layers.support.rasterDatasets.BaseRaster")],t)}(l.EsriPromiseMixin(a.JSONSupport))}.apply(null,n))||(e.exports=i)}}]);
//# sourceMappingURL=45.js.map