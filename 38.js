(function(){var e={"esri/tasks/support/FeatureSet":187,"esri/tasks/operations/zscale":248,"esri/core/pbf":268,"esri/views/layers/support/popupUtils":281,"esri/tasks/operations/urlUtils":314,"esri/tasks/operations/pbfQueryUtils":328,"esri/tasks/operations/pbfFeatureServiceParser":329,"esri/tasks/operations/pbfDehydratedFeatureSet":330,"esri/tasks/operations/pbfOptimizedFeatureSet":331,"esri/views/layers/support/FeatureFilter":334,"esri/tasks/operations/query":348,"esri/views/3d/layers/support/projectExtentUtils":364,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":468,"esri/views/3d/layers/graphics/ExtentSet":469,"esri/views/3d/layers/graphics/Graphics3DObjectStates":470,"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":471,"esri/views/3d/layers/support/attributeUtils":472,"esri/views/3d/layers/graphics/QueryEngine":514,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":567,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":725,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":726,"esri/views/layers/support/FeatureEffect":838,"esri/layers/graphics/controllers/FeatureTileController3D":840,"esri/views/3d/layers/support/FeatureTileFetcher3D":841,"esri/views/layers/FeatureLayerView":1041,"esri/views/layers/support/ParsedFeatureEffect":1042,"esri/views/layers/support/cssFilterParser":1043,"esri/views/layers/support/Transition":1044,"esri/views/3d/layers/support/featureReference":1058,"esri/views/3d/layers/support/FeatureTile":1059,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":1060,"esri/views/3d/layers/FeatureLikeLayerView3D":1061,"esri/views/3d/support/EventedSet":1062,"esri/views/3d/layers/FeatureLayerView3D":2130,"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":2131,"esri/views/3d/layers/support/featureTileQuery3D":2132,"esri/views/3d/support/PBFDecoder":2133},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[38,32,188],{1041:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(156),r(152),r(153),r(198),r(157),r(151),r(191),r(235),r(246),r(199),r(838),r(334),r(281)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,g){Object.defineProperty(t,"__esModule",{value:!0});var m=n.getLogger("esri.views.layers.FeatureLayerView");t.FeatureLayerView=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i._updatingRequiredFieldsPromise=null,i.effect=null,i.filter=null,i.layer=null,i.requiredFields=[],i.view=null,i}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;u.init(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0)},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this.layer,t=this.layer.fields,i=this.requiredFields;return"outFields"in e&&e.outFields?c.fixFields(t,r.__spreadArrays(c.unpackFieldNames(t,e.outFields),i)):c.fixFields(t,i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(e){m.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.highlight=function(e,t){throw void 0===t&&(t={}),new Error("missing implementation")},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=o.isSome(this.filter)?this.filter.createQuery(e):new h(e);return this.timeExtent&&(t.timeExtent=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t},t.prototype.queryFeatures=function(e,t){throw new Error("missing implementation")},t.prototype.queryObjectIds=function(e,t){throw new Error("missing implementation")},t.prototype.queryFeatureCount=function(e,t){throw new Error("missing implementation")},t.prototype.queryExtent=function(e,t){throw new Error("missing implementation")},t.prototype._loadArcadeModules=function(e){if(e.get("expressionInfos.length"))return d.loadArcade()},t.prototype._handleRequiredFieldsChange=function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))},t.prototype._updateRequiredFields=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,u,l,p,d,h,f,y,g,v,_,b;return r.__generator(this,(function(r){switch(r.label){case 0:return this.layer&&this.view?(e="3d"===this.view.type,i=(t=this).layer,n=t.layer,u=n.fields,l=n.objectIdField,p=n.renderer,d=n.displayField,h=i.featureReduction,f=new Set,[4,s.eachAlways([p?p.collectRequiredFields(f,u):null,c.collectLabelingFields(f,i),e?c.collectElevationFields(f,i):null,o.isSome(this.filter)?c.collectFilterFields(f,i,this.filter):null,this.effect?c.collectFilterFields(f,i,this.effect.filter):null,h?c.collectFeatureReductionFields(f,i,h):null])]):[2];case 1:for(y=r.sent(),i.timeInfo&&this.timeExtent&&c.collectFields(f,i.fields,[i.timeInfo.startField,i.timeInfo.endField]),g=0,v=y;g<v.length;g++)(_=v[g]).error&&m.error(_.error);return c.collectField(f,u,l),e&&d&&c.collectField(f,u,d),b=a.valuesOfSet(f).sort(),this._set("requiredFields",b),[2]}}))}))},t.prototype.validateFetchPopupFeatures=function(e){var t=this.layer;return this.layer.popupEnabled?g.getFetchPopupTemplate(this.layer,e)?void 0:new i("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new i("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchClientPopupFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,a,u,l,p,d,h,f,y,m;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=o.isSome(e)?e.clientGraphics:null)&&0!==t.length?(i=[],n=[],a=this.layer,u=g.getFetchPopupTemplate(a,e),o.isSome(u)?[4,this._loadArcadeModules(u)]:[2,s.resolve([])]):[2,s.resolve([])];case 1:return l=r.sent(),p=l&&l.arcadeUtils.hasGeometryOperations(u),[4,this.createPopupQuery(e)];case 2:for(d=r.sent(),h=c.unpackFieldNames(a.fields,d.outFields),f=0,y=t;f<y.length;f++)m=y[f],p||!c.featureHasFields(h,m)?n.push(m):i.push(m);return"stream"===a.type||0===n.length?[2,s.resolve(i)]:(d.objectIds=n.map((function(e){return e.attributes[a.objectIdField]})),[2,a.queryFeatures(d).then((function(e){return i.concat(e.features)})).catch((function(){return n}))])}}))}))},t.prototype.createPopupQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.layer,(i=t.createQuery()).returnGeometry=!0,i.returnZ=!0,i.returnM=!0,n=i,[4,g.getRequiredFields(this.layer,g.getFetchPopupTemplate(this.layer,e))];case 1:return n.outFields=r.sent(),i.outSpatialReference=this.view.spatialReference,[2,i]}}))}))},t.prototype.canResume=function(){var t;return!(!e.prototype.canResume.call(this)||null!==(t=this.timeExtent)&&void 0!==t&&t.isEmpty)},r.__decorate([l.property()],t.prototype,"_updatingRequiredFieldsPromise",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),r.__decorate([l.property({type:f})],t.prototype,"effect",void 0),r.__decorate([l.property({type:y})],t.prototype,"filter",void 0),r.__decorate([l.property(p.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),r.__decorate([l.property()],t.prototype,"layer",void 0),r.__decorate([l.property({type:Number})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([l.property({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([l.property({readOnly:!0})],t.prototype,"requiredFields",void 0),r.__decorate([l.property({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),r.__decorate([l.property()],t.prototype,"view",void 0),r.__decorate([l.subclass("esri.views.layers.FeatureLayerView")],t)}(e)}}.apply(null,i))||(e.exports=n)},1042:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(155),r(156),r(152),r(151),r(189),r(646),r(1043)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c){var p=o.getLogger("esri.views.layers.support.ParsedFeatureEffect"),d={grayscale:function(e){var t=1-e.amount,r=l.mat4f32.fromValues(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,1);return u.mat4.transpose(r,r)},sepia:function(e){var t=1-e.amount,r=l.mat4f32.fromValues(.393+.607*t,.769-.769*t,.189-.189*t,0,.349-.349*t,.686+.314*t,.168-.168*t,0,.272-.272*t,.534-.534*t,.131+.869*t,0,0,0,0,1);return u.mat4.transpose(r,r)},saturate:function(e){var t=e.amount,r=l.mat4f32.fromValues(.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return u.mat4.transpose(r,r)},"hue-rotate":function(e){var t=Math.sin(e.angle*Math.PI/180),r=Math.cos(e.angle*Math.PI/180),i=l.mat4f32.fromValues(.213+.787*r-.213*t,.715-.715*r-.715*t,.072-.072*r+.928*t,0,.213-.213*r+.143*t,.715+.285*r+.14*t,.072-.072*r-.283*t,0,.213-.213*r-.787*t,.715-.715*r+.715*t,.072+.928*r+.072*t,0,0,0,0,1);return u.mat4.transpose(i,i)},invert:function(e){var t=1-2*e.amount,r=e.amount,i=l.mat4f32.fromValues(t,0,0,r,0,t,0,r,0,0,t,r,0,0,0,1);return u.mat4.transpose(i,i)},brightness:function(e){var t=e.amount,r=l.mat4f32.fromValues(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return u.mat4.transpose(r,r)},contrast:function(e){var t=e.amount,r=l.mat4f32.fromValues(t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return u.mat4.transpose(r,r)}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customTransforms=null,t.done=!0,t}var n;return r.__extends(t,e),n=t,t.fromString=function(e){var t=[],r=null;try{for(var o=0,s=c.parse(e);o<s.length;o++){var a=s[o];"opacity"===a.type?r=a:t.push(a)}}catch(e){p.error(new i("invalid-type","Encountered an error when parsing css",e))}return new n({transforms:t,opacity:r})},t.prototype.getOpacity=function(){return s.isSome(this.opacity)?this.opacity.amount:1},t.prototype.getColorMatrix=function(){var e=this;return(this.transforms||[]).map((function(e){return r.__assign({},e)})).reverse().reduce((function(t,r){return u.mat4.multiply(t,t,e._getFactory(r)(r))}),l.mat4f32.create())},t.prototype.clone=function(){return new n({transforms:this.transforms&&this.transforms.map((function(e){return r.__assign({},e)})),customTransforms:this.customTransforms&&this.customTransforms.map((function(e){return r.__assign({},e)}))})},t.prototype._getFactory=function(e){var t=d[e.type];if(t)return t;if(this.customTransforms)for(var r=function(t){if(t.type===e.type){var r=l.mat4f32.fromValues.apply(l.mat4f32,t.matrix),i=u.mat4.transpose(r,r);return{value:function(){return i}}}},i=0,n=this.customTransforms;i<n.length;i++){var o=r(n[i]);if("object"==typeof o)return o.value}return p.error("invalid-type","No effect "+e.type+" exists"),function(){return l.mat4f32.create()}},r.__decorate([a.property()],t.prototype,"opacity",void 0),r.__decorate([a.property()],t.prototype,"transforms",void 0),r.__decorate([a.property()],t.prototype,"customTransforms",void 0),n=r.__decorate([a.subclass("esri.views.layers.support.ParsedFeatureEffect")],t)}(n.JSONSupport)}.apply(null,i))||(e.exports=n)},1043:function(e,t,r){var i,n,o;n=[],void 0===(o="function"==typeof(i=function(){"use strict";function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?o(e.parts[t][0])+"-"+o(e.parts[t][1]):o(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=(n=e[t],r[n.type](n));if(o.sort(),o.length>0){for(t=1,i=1;t<o.length;t++)o[t-1]!==o[t]&&(o[i]=o[t],i++);o.length=i}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,n={},o={start:je},s=je,a=Ce("none"),u=Se("none",!1),l=Ce("blur()"),c=Se("blur(",!1),p=Se(")",!1),d=Ce("brightness()"),h=Se("brightness(",!1),f=Ce("contrast()"),y=Se("contrast(",!1),g=Ce("drop-shadow()"),m=Se("drop-shadow(",!1),v=Ce("grayscale()"),_=Se("grayscale(",!1),b=Ce("hue-rotate()"),F=Se("hue-rotate(",!1),x=Ce("invert()"),w=Se("invert(",!1),E=Ce("opacity()"),S=Se("opacity(",!1),T=Ce("saturate()"),C=Se("saturate(",!1),O=Ce("sepia()"),R=Se("sepia(",!1),P=Ce("<number-percentage>"),j=Ce("<integer>"),V=/^[0-9]/,I=Te([["0","9"]],!1,!1),D=Ce("<number>"),M=Se(".",!1),k=function(){return parseFloat(Ee())},A=Ce("<signedNumber>"),q=/^[+\-]/,N=Te(["+","-"],!1,!1),U=Se("%",!1),L=Ce("<angle>"),G=function(e,t){return e*t},Q=Se("0",!1),z=Ce("<unit>"),B=Se("deg",!1),J=Se("grad",!1),H=Se("rad",!1),Z=Se("turn",!1),W=Ce("<length>"),X=Se("px",!1),Y=Se("cm",!1),K=Se("mm",!1),$=Se("Q",!1),ee=Se("in",!1),te=Se("pc",!1),re=Se("pt",!1),ie=Se("#",!1),ne=Se("rgba(",!1),oe=Se(",",!1),se=function(e,t,r){return[255*e,255*t,255*r,1]},ae=function(e,t,r){return[e,t,r,1]},ue=Se("rgb(",!1),le=/^[0-9a-fA-F]/,ce=Te([["0","9"],["a","f"],["A","F"]],!1,!1),pe=Ce("whitespace"),de=/^[ \t\n\r]/,he=Te([" ","\t","\n","\r"],!1,!1),fe=Ce("<named-color>"),ye=/^[a-z]/,ge=Te([["a","z"]],!1,!1),me=function(){var t=Ee();return Ge.has(t)||function(t,r){throw function(t,r){return new e(t,null,null,r)}(t,r=void 0!==r?r:Re(_e,ve))}('unknown color "'+t+'"'),Le[t].concat(1)},ve=0,_e=0,be=[{line:1,column:1}],Fe=0,xe=[],we=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=o[r.startRule]}function Ee(){return t.substring(_e,ve)}function Se(e,t){return{type:"literal",text:e,ignoreCase:t}}function Te(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ce(e){return{type:"other",description:e}}function Oe(e){var r,i=be[e];if(i)return i;for(r=e-1;!be[r];)r--;for(i={line:(i=be[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return be[e]=i,i}function Re(e,t){var r=Oe(e),i=Oe(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function Pe(e){ve<Fe||(ve>Fe&&(Fe=ve,xe=[]),xe.push(e))}function je(){var e;return(e=function(){var e,r;return we++,e=ve,Ue()!==n?("none"===t.substr(ve,4)?(r="none",ve+=4):(r=n,0===we&&Pe(u)),r!==n&&Ue()!==n?(_e=e,e=null):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(a),e}())===n&&(e=function(){var e,t;if(e=[],(t=Ve())!==n)for(;t!==n;)e.push(t),t=Ve();else e=n;return e}()),e}function Ve(){var e;return(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("blur("===t.substr(ve,5)?(r="blur(",ve+=5):(r=n,0===we&&Pe(c)),r!==n&&Ue()!==n&&(i=Ae())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"blur",radius:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(l),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("brightness("===t.substr(ve,11)?(r="brightness(",ve+=11):(r=n,0===we&&Pe(h)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"brightness",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(d),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("contrast("===t.substr(ve,9)?(r="contrast(",ve+=9):(r=n,0===we&&Pe(y)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"contrast",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(f),e}())===n&&(e=function(){var e,r,i,o,s,a,u;return we++,e=ve,Ue()!==n?("drop-shadow("===t.substr(ve,12)?(r="drop-shadow(",ve+=12):(r=n,0===we&&Pe(m)),r!==n&&Ue()!==n&&(i=Ae())!==n&&Ue()!==n&&(o=Ae())!==n&&Ue()!==n?((s=Ae())===n&&(s=null),s!==n&&Ue()!==n?((a=function(){var e,r,i,o,s,a,u,l,c,d,h,f,y,g,m,v,_;return e=ve,35===t.charCodeAt(ve)?(r="#",ve++):(r=n,0===we&&Pe(ie)),r!==n?(i=ve,(o=Ne())!==n&&(s=Ne())!==n?i=o=[o,s]:(ve=i,i=n),i!==n?(o=ve,(s=Ne())!==n&&(a=Ne())!==n?o=s=[s,a]:(ve=o,o=n),o!==n?(s=ve,(a=Ne())!==n&&(u=Ne())!==n?s=a=[a,u]:(ve=s,s=n),s!==n?(_e=e,v=o,_=s,e=r=[parseInt(i.join(""),16),parseInt(v.join(""),16),parseInt(_.join(""),16)]):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,35===t.charCodeAt(ve)?(r="#",ve++):(r=n,0===we&&Pe(ie)),r!==n&&(i=Ne())!==n&&(o=Ne())!==n&&(s=Ne())!==n?(_e=e,r=function(e,t,r){return[parseInt([e,e].join(""),16),parseInt([t,t].join(""),16),parseInt([r,r].join(""),16)]}(i,o,s),e=r):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Pe(ne)),r!==n&&(i=Ue())!==n&&(o=Me())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=Me())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=Me())!==n&&(h=Ue())!==n?(44===t.charCodeAt(ve)?(f=",",ve++):(f=n,0===we&&Pe(oe)),f!==n&&(y=Ue())!==n&&(g=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(m=")",ve++):(m=n,0===we&&Pe(p)),m!==n?(_e=e,e=r=function(e,t,r,i){return[255*e,255*t,255*r,i]}(o,l,d,g)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Pe(ne)),r!==n&&(i=Ue())!==n&&(o=De())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=De())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=De())!==n?(44===t.charCodeAt(ve)?(h=",",ve++):(h=n,0===we&&Pe(oe)),h!==n&&(f=Ue())!==n&&(y=Ie())!==n?(41===t.charCodeAt(ve)?(g=")",ve++):(g=n,0===we&&Pe(p)),g!==n?(_e=e,e=r=function(e,t,r,i){return[e,t,r,i]}(o,l,d,y)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Pe(ne)),r!==n&&(i=Ue())!==n&&(o=Me())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=Me())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=Me())!==n&&(h=Ue())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Pe(p)),f!==n?(_e=e,e=r=se(o,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Pe(ne)),r!==n&&(i=Ue())!==n&&(o=De())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=De())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=De())!==n?(41===t.charCodeAt(ve)?(h=")",ve++):(h=n,0===we&&Pe(p)),h!==n?(_e=e,e=r=ae(o,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgb("===t.substr(ve,4)?(r="rgb(",ve+=4):(r=n,0===we&&Pe(ue)),r!==n&&(i=Ue())!==n&&(o=Me())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=Me())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=Me())!==n&&(h=Ue())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Pe(p)),f!==n?(_e=e,e=r=se(o,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgb("===t.substr(ve,4)?(r="rgb(",ve+=4):(r=n,0===we&&Pe(ue)),r!==n&&(i=Ue())!==n&&(o=De())!==n&&(s=Ue())!==n?(44===t.charCodeAt(ve)?(a=",",ve++):(a=n,0===we&&Pe(oe)),a!==n&&(u=Ue())!==n&&(l=De())!==n&&Ue()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Pe(oe)),c!==n&&Ue()!==n&&(d=De())!==n&&(h=Ue())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Pe(p)),f!==n?(_e=e,e=r=ae(o,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=function(){var e,r,i;if(we++,e=ve,r=[],ye.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(ge)),i!==n)for(;i!==n;)r.push(i),ye.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(ge));else r=n;return r!==n&&(_e=e,r=me()),we--,(e=r)===n&&(r=n,0===we&&Pe(fe)),e}())))))))),e}())===n&&(a=null),a!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(u=")",ve++):(u=n,0===we&&Pe(p)),u!==n&&Ue()!==n?(_e=e,e={type:"drop-shadow",offsetX:i,offsetY:o,blurRadius:s,color:a}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(g),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("grayscale("===t.substr(ve,10)?(r="grayscale(",ve+=10):(r=n,0===we&&Pe(_)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"grayscale",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(v),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("hue-rotate("===t.substr(ve,11)?(r="hue-rotate(",ve+=11):(r=n,0===we&&Pe(F)),r!==n&&Ue()!==n&&(i=function(){var e,r,i;return we++,e=ve,(r=function(){var e,r;return we++,e=ve,q.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Pe(N)),r===n&&(r=null),r!==n&&De()!==n?(_e=e,e=r=k()):(ve=e,e=n),we--,e===n&&(r=n,0===we&&Pe(A)),e}())!==n&&(i=ke())!==n?(_e=e,e=r=G(r,i)):(ve=e,e=n),e===n&&(e=ve,48===t.charCodeAt(ve)?(r="0",ve++):(r=n,0===we&&Pe(Q)),r!==n?((i=ke())===n&&(i=null),i!==n?(_e=e,e=r=0):(ve=e,e=n)):(ve=e,e=n)),we--,e===n&&(r=n,0===we&&Pe(L)),e}())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"hue-rotate",angle:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(b),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("invert("===t.substr(ve,7)?(r="invert(",ve+=7):(r=n,0===we&&Pe(w)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"invert",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(x),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("opacity("===t.substr(ve,8)?(r="opacity(",ve+=8):(r=n,0===we&&Pe(S)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"opacity",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(E),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("saturate("===t.substr(ve,9)?(r="saturate(",ve+=9):(r=n,0===we&&Pe(C)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"saturate",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(T),e}())===n&&(e=function(){var e,r,i,o;return we++,e=ve,Ue()!==n?("sepia("===t.substr(ve,6)?(r="sepia(",ve+=6):(r=n,0===we&&Pe(R)),r!==n&&Ue()!==n&&(i=Ie())!==n&&Ue()!==n?(41===t.charCodeAt(ve)?(o=")",ve++):(o=n,0===we&&Pe(p)),o!==n&&Ue()!==n?(_e=e,e={type:"sepia",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Pe(O),e}()),e}function Ie(){var e;return we++,(e=Me())===n&&(e=De()),we--,e===n&&0===we&&Pe(P),e}function De(){var e,r,i,o,s;if(we++,e=ve,r=[],V.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(I)),i!==n)for(;i!==n;)r.push(i),V.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(I));else r=n;if(r!==n)if(46===t.charCodeAt(ve)?(i=".",ve++):(i=n,0===we&&Pe(M)),i!==n){if(o=[],V.test(t.charAt(ve))?(s=t.charAt(ve),ve++):(s=n,0===we&&Pe(I)),s!==n)for(;s!==n;)o.push(s),V.test(t.charAt(ve))?(s=t.charAt(ve),ve++):(s=n,0===we&&Pe(I));else o=n;o!==n?(_e=e,e=r=k()):(ve=e,e=n)}else ve=e,e=n;else ve=e,e=n;return e===n&&(e=function(){var e,r,i;if(we++,e=ve,r=[],V.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(I)),i!==n)for(;i!==n;)r.push(i),V.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Pe(I));else r=n;return r!==n&&(_e=e,r=parseInt(Ee(),10)),we--,(e=r)===n&&(r=n,0===we&&Pe(j)),e}()),we--,e===n&&(r=n,0===we&&Pe(D)),e}function Me(){var e,r,i;return e=ve,(r=De())!==n?(37===t.charCodeAt(ve)?(i="%",ve++):(i=n,0===we&&Pe(U)),i!==n?(_e=e,e=r/=100):(ve=e,e=n)):(ve=e,e=n),e}function ke(){var e,r;return we++,e=ve,"deg"===t.substr(ve,3)?(r="deg",ve+=3):(r=n,0===we&&Pe(B)),r!==n&&(_e=e,r=1),(e=r)===n&&(e=ve,"grad"===t.substr(ve,4)?(r="grad",ve+=4):(r=n,0===we&&Pe(J)),r!==n&&(_e=e,r=.9),(e=r)===n&&(e=ve,"rad"===t.substr(ve,3)?(r="rad",ve+=3):(r=n,0===we&&Pe(H)),r!==n&&(_e=e,r=180/Math.PI),(e=r)===n&&(e=ve,"turn"===t.substr(ve,4)?(r="turn",ve+=4):(r=n,0===we&&Pe(Z)),r!==n&&(_e=e,r=1/360),e=r))),we--,e===n&&(r=n,0===we&&Pe(z)),e}function Ae(){var e,r,i;return we++,e=ve,(r=De())!==n&&(i=qe())!==n?(_e=e,e=r=G(r,i)):(ve=e,e=n),e===n&&(e=ve,48===t.charCodeAt(ve)?(r="0",ve++):(r=n,0===we&&Pe(Q)),r!==n?((i=qe())===n&&(i=null),i!==n?(_e=e,e=r=0):(ve=e,e=n)):(ve=e,e=n)),we--,e===n&&(r=n,0===we&&Pe(W)),e}function qe(){var e,r;return e=ve,"px"===t.substr(ve,2)?(r="px",ve+=2):(r=n,0===we&&Pe(X)),r!==n&&(_e=e,r=1),(e=r)===n&&(e=ve,"cm"===t.substr(ve,2)?(r="cm",ve+=2):(r=n,0===we&&Pe(Y)),r!==n&&(_e=e,r=96/2.54),(e=r)===n&&(e=ve,"mm"===t.substr(ve,2)?(r="mm",ve+=2):(r=n,0===we&&Pe(K)),r!==n&&(_e=e,r=96/2.54/10),(e=r)===n&&(e=ve,81===t.charCodeAt(ve)?(r="Q",ve++):(r=n,0===we&&Pe($)),r!==n&&(_e=e,r=96/2.54/40),(e=r)===n&&(e=ve,"in"===t.substr(ve,2)?(r="in",ve+=2):(r=n,0===we&&Pe(ee)),r!==n&&(_e=e,r=96),(e=r)===n&&(e=ve,"pc"===t.substr(ve,2)?(r="pc",ve+=2):(r=n,0===we&&Pe(te)),r!==n&&(_e=e,r=16),(e=r)===n&&(e=ve,"pt"===t.substr(ve,2)?(r="pt",ve+=2):(r=n,0===we&&Pe(re)),r!==n&&(_e=e,r=96/73),e=r)))))),e}function Ne(){var e;return le.test(t.charAt(ve))?(e=t.charAt(ve),ve++):(e=n,0===we&&Pe(ce)),e}function Ue(){var e,r;for(we++,e=[],de.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Pe(he));r!==n;)e.push(r),de.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Pe(he));return we--,e===n&&(r=n,0===we&&Pe(pe)),e}var Le={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},Ge=new Set(Object.keys(Le));if((i=s())!==n&&ve===t.length)return i;throw i!==n&&ve<t.length&&Pe({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(xe,Fe<t.length?t.charAt(Fe):null,Fe<t.length?Re(Fe,Fe+1):Re(Fe,Fe))}}})?i.apply(null,n):i)||(e.exports=o)},1044:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(151),r(189)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from=null,t.to=null,t.duration=4e3,t.repeat=!0,t.done=!1,t}var i;return r.__extends(t,e),i=t,t.prototype.getColorMatrix=function(){if(this.done=!1,null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var e=this._lastTime,t=Date.now(),r=t-e;this._currentStep=this._currentStep+r,this._currentStep>=2147483647&&(this._currentStep=0),this._lastTime=t}var i=this._currentStep%this.duration/(this.duration/2),n=i<=1?i:2-i,s=this.from.getColorMatrix(),a=this.to.getColorMatrix();return o.mat4.multiplyScalar(s,s,1-n),o.mat4.multiplyScalar(a,a,n),!this.repeat&&this._currentStep>=this.duration&&(this.done=!0),o.mat4.add(s,s,a)},t.prototype.getOpacity=function(){throw new Error("No getOpacity definition for Transition")},t.prototype.clone=function(){var e=new i({from:this.from.clone(),to:this.to.clone(),duration:this.duration});return e._lastTime=this._lastTime,e._currentStep=this._currentStep,e},r.__decorate([n.property()],t.prototype,"from",void 0),r.__decorate([n.property()],t.prototype,"to",void 0),r.__decorate([n.property({type:Number})],t.prototype,"duration",void 0),r.__decorate([n.property({type:Boolean})],t.prototype,"repeat",void 0),i=r.__decorate([n.subclass("esri.views.layers.support.Transition")],t)}(i)}.apply(null,i))||(e.exports=n)},1058:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(207)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;o.oldVersion=i,this.feature&&(e.uid=this.feature.uid);for(var n=0,s=this.versions;n<s.length;n++){var a=s[n];if(a.resolution===t){a.refCount++;var u=this.highestResolutionVersion===a&&!r.equals(e,a.feature);return(u||this.highestResolutionVersion!==a)&&(a.feature=e),o.newVersion=u?e:i,o}}var l={feature:e,resolution:t,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(o.newVersion=e,this.highestResolutionVersion=l):o.newVersion=i,o},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,o.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),o.oldVersion=r.feature)),o.newVersion=this.feature,o}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var n=function(){function e(e){this._feature=e,this.refCount=1}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return++this.refCount,o.oldVersion=this._feature,this.feature&&(e.uid=this.feature.uid),r.equals(this._feature,e)||(this._feature=e),o.newVersion=this._feature,o},e.prototype.unref=function(){return o.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(o.newVersion=null,o):(o.newVersion=this._feature,o)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var o={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=n)},1059:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(180),r(152),r(173),r(207)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var s=new Set,a=function(){function e(e){this.descriptor=e,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=u,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=s,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t,r){this._availableFields=i.unwrapOr(r,s),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+o.numVertices(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=o.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=o.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),e.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0},Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(n.fromExtent(e,l),n.intersects(this.descriptor.extent,l))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(n.fromExtent(e,t),this.descriptor.extent&&n.intersection(t,this.descriptor.extent,t)):n.set(t,this.descriptor.extent),t):(n.set(t,n.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort((function(t,r){return o.getObjectId(t,e)-o.getObjectId(r,e)})),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t,r){if(e<=0)return!1;var i=!1;if(this._features){this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,i=!0)),!this._shuffled&&e<1&&this._shuffle(r);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))}else this.featureLimit=0;return i},Object.defineProperty(e.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},enumerable:!0,configurable:!0}),e}();t.FeatureTile=a;var u=-1;t.FAILED_FEATURE_COUNT=-2;var l=n.create()}.apply(null,i))||(e.exports=n)},1060:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(174),r(232),r(430),r(522),r(523),r(432),r(588)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map((function(e){return new s(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new s(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new s(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new s(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,n=[];e.forEach((function(e,r){var o=i.tileFetcher.test.getFeatureTileById(r);o&&t.filter(o)||(i.view.graphics.removeMany(e),n.push(r))})),n.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(n){if(t.filter(n)&&!e.has(n.id)){var s=n.descriptor.lij,u=s[0],l=s[1],c=s[2];i.tilingScheme.ensureMaxLod(u);var p=i.tilingScheme.getExtentGeometry(u,l,c),d=[new r({geometry:p,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:p.center,symbol:new o({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new a({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,d),i.view.graphics.addMany(d)}}))},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,i))||(e.exports=n)},1061:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(152),r(153),r(157),r(151),r(207),r(840),r(656),r(199),r(725),r(514),r(364),r(211)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLikeLayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.asyncGraphicsUpdates=!1,t.suspendResumeExtentMode="computed",t.slicePlaneEnabled=!1,t.drapeSourceType=1,t.fullExtentInLocalViewSpatialReference=null,t.suspendResumeExtent=null,t._controllerCreated=!1,t.clippingExtent=null,t.supportsHeightUnitConversion=!0,t.pendingController=null,t.queryEngine=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(o.reject(new i("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this._set("graphics3d",new d.default({owner:this,layer:t,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",(function(t){e.graphics3d.graphicsCore.preferredUpdatePolicy=t?1:0})),this.updatingHandles.add(this,"suspendResumeExtentMode",(function(t){e.graphics3d.suspendResumeExtentMode=t})),this.addResolvingPromise(this.graphics3d.setup().then((function(){return e.validateGeometryType()})).then((function(){return e.queryEngine=new h.default({layerView:e,task:y.Task.FEATURE_QUERY_ENGINE})})).then((function(){return f.toViewIfLocal(e)})).then((function(t){return e.fullExtentInLocalViewSpatialReference=t})).then((function(){return e.initializeController()}))),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},t.prototype.notifyGraphicUpdate=function(e,t){this.graphics3d.graphicsCore.notifyGraphicUpdate(e,t)},t.prototype.getRenderingInfo=function(e,t,r){var i=c.getRenderingInfo(e,{renderer:t,arcade:r});if(i&&i.color){var n=i.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return i},t.prototype.getRenderingInfoAsync=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(o){return[2,c.getRenderingInfoAsync(e,r.__assign({renderer:t,arcade:i},n))]}))}))},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach((function(i){i.uid===e&&(r=u.hydrateGraphic(i,t.layer))})),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.computeAttachmentOrigin=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null},t.prototype.getSymbolLayerSize=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null},t.prototype.queryFeatures=function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryObjectIds=function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryFeatureCount=function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryExtent=function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),n.get(t,"signal"))},t.prototype._ensureQuery=function(e){return n.isNone(e)?this.createQuery():p.from(e)},t.prototype.highlight=function(e){return this.graphics3d.highlight(e,this.layer.objectIdField)},t.prototype.canResume=function(){return!(!e.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.getSuspendInfo=function(){var t=e.prototype.getSuspendInfo.call(this);return this.graphics3d?r.__assign(r.__assign({},t),this.graphics3d.suspendInfo):t},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed||!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)},t.prototype.initializeController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}}))}))},t.prototype.setControllerWhenInitialized=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,s.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}}))}))},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return o.reject(new i("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}},t.prototype._getResourceInfo=function(){var e=this.controller&&this.controller instanceof l?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},enumerable:!0,configurable:!0}),r.__decorate([a.property()],t.prototype,"loadedGraphics",void 0),r.__decorate([a.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),r.__decorate([a.property({dependsOn:["graphics3d.updating","controller.updating"]})],t.prototype,"updating",void 0),r.__decorate([a.property()],t.prototype,"controller",void 0),r.__decorate([a.property()],t.prototype,"graphics3d",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([a.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],t.prototype,"suspendInfo",void 0),r.__decorate([a.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r.__decorate([a.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(e)}}.apply(null,i))||(e.exports=n)},1062:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(190),r(198)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new Set,t}return r.__extends(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._set.add(i)}this.emit("after-changes",{type:1}),this.emit("change",{added:e,removed:[]})}},t.prototype.remove=function(e){this._set.delete(e)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[e]}))},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this._set.delete(n)&&t.push(n)}t.length>0&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:t}))},t.prototype.toArray=function(){return n.valuesOfSet(this._set)},t.prototype.find=function(e){var t;return n.someSet(this._set,(function(r){return!!e(r)&&(t=r,!0)})),t},t.prototype.forEach=function(e){this._set.forEach((function(t){return e(t)}))},t}(i);t.EventedSet=o}.apply(null,i))||(e.exports=n)},187:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(174),r(166),r(155),r(152),r(151),r(170),r(163),r(194)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p){var d=new o.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),h=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return r.__extends(t,e),t.prototype.readFeatures=function(e,t){for(var r=l.fromJSON(t.spatialReference),i=[],o=0;o<e.length;o++){var s=e[o],u=n.fromJSON(s),c=s.geometry&&s.geometry.spatialReference;a.isSome(u.geometry)&&!c&&(u.geometry.spatialReference=r),i.push(u)}return i},t.prototype.writeGeometryType=function(e,t,r,i){if(e)d.write(e,t,r,i);else{var n=this.features;if(n)for(var o=0,s=n;o<s.length;o++){var u=s[o];if(u&&a.isSome(u.geometry))return void d.write(u.geometry.type,t,r,i)}}},t.prototype.writeSpatialReference=function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r)for(var i=0,n=r;i<n.length;i++){var o=n[i];o&&a.isSome(o.geometry)&&o.geometry.spatialReference&&(t.spatialReference=o.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var i=t.features[r];if(i.geometry){var n=e&&e[r];i.geometry=n&&n.toJSON()||i.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],i=t[1],n=e.translate,o=n[0],s=n[1],u=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-o)/r)}),(function(e){return Math.round((s-e)/i)})),c=0,p=u.length;c<p;c++)l(a.unwrap(u[c].geometry))||(u.splice(c,1),c--,p--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;for(var i=r.translate,n=i[0],o=i[1],s=r.scale,u=s[0],l=s[1],c=this._getHydrationFunction(e,(function(e){return e*u+n}),(function(e){return o-e*l})),p=0,d=t;p<d.length;p++){var h=d[p].geometry;a.isSome(h)&&c(h)}return this},t.prototype._quantizePoints=function(e,t,r){for(var i,n,o=[],s=0,a=e.length;s<a;s++){var u=e[s];if(s>0){var l=t(u[0]),c=r(u[1]);l===i&&c===n||(o.push([l-i,c-n]),i=l,n=c)}else i=t(u[0]),n=r(u[1]),o.push([i,n])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var i=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var n=c.isPolygon(e)?e.rings:e.paths,o=[],s=0,a=n.length;s<a;s++){var u=n[s],l=i._quantizePoints(u,t,r);l&&o.push(l)}return o.length>0?(c.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var n;return(n=i._quantizePoints(e.points,t,r)).length>0?(e.points=n,e):null}:"extent"===e?function(e){return e}:null},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var i,n,o=c.isPolygon(e)?e.rings:e.paths,s=0,a=o.length;s<a;s++)for(var u=o[s],l=0,p=u.length;l<p;l++){var d=u[l];l>0?(i+=d[0],n+=d[1]):(i=d[0],n=d[1]),d[0]=t(i),d[1]=r(n)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var i,n,o=e.points,s=0,a=o.length;s<a;s++){var u=o[s];s>0?(i+=u[0],n+=u[1]):(i=u[0],n=u[1]),u[0]=t(i),u[1]=r(n)}}:void 0},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r.__decorate([u.property({type:[n],json:{write:!0}})],t.prototype,"features",void 0),r.__decorate([u.reader("features")],t.prototype,"readFeatures",null),r.__decorate([u.property({type:[p],json:{write:!0}})],t.prototype,"fields",void 0),r.__decorate([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:d.read}}})],t.prototype,"geometryType",void 0),r.__decorate([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r.__decorate([u.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r.__decorate([u.property({type:l,json:{write:!0}})],t.prototype,"spatialReference",void 0),r.__decorate([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r.__decorate([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r.__decorate([u.subclass("esri.tasks.support.FeatureSet")],t)}(s.JSONSupport);return h.prototype.toJSON.isDefaultToJSON=!0,h||(h={}),h}.apply(null,i))||(e.exports=n)},2130:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(177),r(154),r(153),r(157),r(151),r(207),r(840),r(1061),r(308),r(2131),r(453),r(1062),r(1041),r(218),r(285)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,g,m){var v=function(e){function t(t){var r=e.call(this,t)||this;return r._controllerTotal=0,r._graphicsCoreTotal=0,r.suspendResumeExtentMode="data",r}return r.__extends(t,e),t.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)},Object.defineProperty(t.prototype,"updatingProgressValue",{get:function(){var e=1;if(this.controller&&this.controller.updating){var t=this.controller.updatingRemaining;(r=this.controller.updatingTotal)>0&&(this._controllerTotal=Math.max(r,this._controllerTotal),e=(r-t)/r)}var r,i=1;this.graphics3d&&this.graphics3d.graphicsCore&&(t=this.graphics3d.graphicsCore.updatingRemaining,(r=this.graphics3d.graphicsCore.updatingTotal)>0&&(this._graphicsCoreTotal=Math.max(r,this._graphicsCoreTotal),i=(r-t)/r));return 1===e&&1===i&&(this._controllerTotal=0,this._graphicsCoreTotal=0),.5*(e+i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case"snapshot":return this.controller.serviceDataCount>_;case"tiles":return!0;default:i.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:t.supportsZ)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM},enumerable:!0,configurable:!0}),t.prototype.fetchPopupFeatures=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){return(e=this.validateFetchPopupFeatures(t))?[2,o.reject(e)]:[2,this.fetchClientPopupFeatures(t)]}))}))},t.prototype.setVisibility=function(e,t){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(e,t)},t.prototype.createQuery=function(){return e.prototype.createQuery.call(this)},t.prototype.queryFeatures=function(t,r){var i=this,n=function(){return e.prototype.queryFeatures.call(i,t,r)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(t),n):n()},t.prototype.createController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(r){return this.fetcherContext=new d.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM}),e=new l({layerView:this,context:this.fetcherContext,graphics:new f.EventedSet,extent:this.clippingExtent}),this.updatingHandles.add(e,"serviceDataExtent",(function(e){t.graphics3d&&(t.graphics3d.dataExtent=e)}),2),this.handles.add(s.init(this,"suspended",(function(t){t?e.suspend():e.resume()}),!0)),this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",(function(){return t.updateDisplayFeatureLimit(e)}),2),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",(function(){return t.updateDisplayFeatureLimit()}))),[2,e]}))}))},t.prototype.doRefresh=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return!this.suspended&&this.controller&&this.controller.refetch(),[2]}))}))},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)},t.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride},t.prototype.updateDisplayFeatureLimit=function(e){if(void 0===e&&(e=this.controller),e&&this.graphics3d&&this.graphics3d.graphicsCore){var t=this.graphics3d.graphicsCore.displayFeatureLimit,i=this.view.resourceController.memoryController.memoryFactor;if(1===i)e.displayFeatureLimit=t;else{var n=Math.ceil(t.maximumNumberOfFeatures*i),o=Math.ceil(t.maximumTotalNumberOfFeatures*i),s=Math.ceil(t.minimumTotalNumberOfFeatures*i);e.displayFeatureLimit=r.__assign(r.__assign({},t),{maximumNumberOfFeatures:n,maximumTotalNumberOfFeatures:o,minimumTotalNumberOfFeatures:s})}}},t.prototype._queryFeaturesMesh=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s,a,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._validateQueryFeaturesMesh(e)];case 1:return r.sent(),[4,t()];case 2:if(i=r.sent(),e&&e.outStatistics)return[2,i];for(n=this.layer.objectIdField,o=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,s=[],a=0,l=i.features;a<l.length;a++)(c=l[a]).geometry?(p=o.get(c.attributes[n]))&&(c.geometry=u.hydrateGeometry(p.graphic.geometry),s.push(c)):s.push(c);return i.features=s,[2,i]}}))}))},t.prototype._validateQueryFeaturesMesh=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s;return r.__generator(this,(function(r){if(!e)return[2];for(t=function(e){throw new n("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+e+"'")},i=0,o=["quantizationParameters","geometryPrecision","maxAllowableOffset"];i<o.length;i++)null!=e[s=o[i]]&&t(s);return"returnM"in e&&e.returnM&&t("returnM"),"returnCentroid"in e&&e.returnCentroid&&t("returnCentroid"),e.outSpatialReference&&!e.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference"),[2]}))}))},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){var e=this.controller&&this.controller.displayFeatureLimit,t=e&&e.maximumSymbolComplexity,i=t?"f:"+t.primitivesPerFeature+",v:"+t.primitivesPerCoordinate:"n/a",n=r.__assign(r.__assign({},this._getResourceInfo()),{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:i,nodes:this.controller?this.controller.tileDescriptors.length:0});if(this.controller&&n.displayedNumberOfFeatures){var o=this.controller.debug;n.storedFeatures=o.storedFeatures,n.totalVertices=o.totalVertices}return n},enumerable:!0,configurable:!0}),r.__decorate([a.property()],t.prototype,"layer",void 0),r.__decorate([a.property()],t.prototype,"controller",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],t.prototype,"updatingProgressValue",null),r.__decorate([a.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],t.prototype,"maximumNumberOfFeatures",void 0),r.__decorate([a.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([a.property(h.updatingProgress)],t.prototype,"updatingProgress",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["controller.mode"]})],t.prototype,"asyncGraphicsUpdates",null),r.__decorate([a.property({readOnly:!0})],t.prototype,"hasZ",null),r.__decorate([a.property({readOnly:!0})],t.prototype,"hasM",null),r.__decorate([a.property()],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([a.subclass("esri.views.3d.layers.FeatureLayerView3D")],t)}(m.RefreshableLayerView(c.FeatureLikeLayerView3D(y.FeatureLayerView(p.LayerView3D(g))))),_=5e3;return v}.apply(null,i))||(e.exports=n)},2131:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(152),r(841),r(2132)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.memoryCache=null,this._capabilities=null;var t=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=t.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM;var r=this.layerView.view.resourceController;this.query=n.createFeatureTileQuery3D(t,r.scheduler),"hasService"in t&&t.hasService&&r&&(this.memoryCache=r.memoryController.getMemCache(t.uid))}return e.prototype.destroy=function(){r.isSome(this.memoryCache)&&this.memoryCache.destroy(),this.query.destroy()},e.prototype.createQuery=function(){var e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e},Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scheduler",{get:function(){var e=this.layerView.view.resourceController;return e?e.scheduler:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileMaxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.maxRecordCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capabilities",{get:function(){return r.isSome(this._capabilities)||(this._capabilities=i.contextCapabilitiesFromLayer(this.layerView.layer)),this._capabilities},enumerable:!0,configurable:!0}),e.prototype.logFetchError=function(e,t){e.error("#fetchTile()",this.layerView.layer,t&&t.message?t.message:t)},e}();t.FeatureTileFetcher3DLayerViewContext=o}.apply(null,i))||(e.exports=n)},2132:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(152),r(153),r(151),r(207),r(348),r(2133)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"queryFeaturesDehydrated",{get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){n.isNone(this._decoder)&&(this._decoder=new l.PBFDecoder(this.scheduler));var i={type:"dehydrated",sourceSpatialReference:this.layer.spatialReference?this.layer.spatialReference.toJSON():null,applyTransform:!0,maxStringAttributeLength:1024};return function(t,r){return u.runQuery(e.layer.parsedUrl,t,"pbf",r).then((function(t){return o.throwIfAborted(r),n.isSome(e._decoder)?e._decoder.invoke({buffer:t.data,options:i}):o.reject(o.createAbortError())}))}}return function(t,r){return u.executeQuery(e.layer.parsedUrl,t,e.layer.spatialReference,r).then((function(e){return a.fromFeatureSetJSON(e.data)}))}},enumerable:!0,configurable:!0}),t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},t.prototype.destroy=function(){this._decoder=n.destroyMaybe(this._decoder)},r.__decorate([s.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],t.prototype,"queryFeaturesDehydrated",null),r.__decorate([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(i),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.queryFeaturesDehydrated=function(e,t){return this.layer.queryFeatures(e,t)},r.__decorate([s.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(i),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.destroy=function(){},t.prototype.queryFeaturesDehydrated=function(e,t){var r=this;return this.source.queryFeaturesJSON(e,t).then(a.fromFeatureSetJSON,(function(i){if(i&&"query-features-json:unsupported"===i.name)return r.layer.queryFeatures(e,t);throw i}))},t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},r.__decorate([s.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([s.aliasOf("layer.source")],t.prototype,"source",void 0),r.__decorate([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],t)}(i);t.createFeatureTileQuery3D=function(e,t){switch(e.source.type){case"feature-layer":return new c({layer:e,scheduler:t});case"memory":case"csv":case"geojson":return new d({layer:e});case"ogc-feature":return new p({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}}.apply(null,i))||(e.exports=n)},2133:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(174),r(153),r(170),r(194),r(662)],void 0===(n=function(e,t,r,i,n,o,s,a){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this._handle=new l(e)}return e.prototype.destroy=function(){this._handle.destroy()},e.prototype.invoke=function(e,t){return void 0===t&&(t=null),e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof o&&(e.options=r.__assign(r.__assign({},e.options),{sourceSpatialReference:e.options.sourceSpatialReference.toJSON()})),this._handle.invoke(e,t).then((function(e){if(e.spatialReference=o.fromJSON(e.spatialReference),e.fields)for(var t=0;t<e.fields.length;t++)e.fields[t]=s.fromJSON(e.fields[t]);for(var r=e.spatialReference,n=0,a=e.features;n<a.length;n++){var u=a[n];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=r)}return e}))):n.resolve(null)},e}();t.PBFDecoder=u;var l=function(e){function t(t){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",t,{strategy:"dedicated"})||this}return r.__extends(t,e),t.prototype.getTransferList=function(e){return[e.buffer]},t}(a.WorkerHandle)}.apply(null,i))||(e.exports=n)},248:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(200),r(178)],void 0===(n=function(e,t,r,i){function n(e,t,n){if(!t||!n||n.vcsWkid||i.equals(t,n))return null;var o=r.getMetersPerVerticalUnitForSR(t)/r.getMetersPerVerticalUnitForSR(n);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return r=o,void((t=e)&&null!=t.z&&(t.z*=r));var t,r};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e)for(var r=0,i=e.paths;r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){var s=o[n];s.length>2&&(s[2]*=t)}}(e,o)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e)for(var r=0,i=e.rings;r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){var s=o[n];s.length>2&&(s[2]*=t)}}(e,o)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e)for(var r=0,i=e.points;r<i.length;r++){var n=i[r];n.length>2&&(n[2]*=t)}}(e,o)};default:return null}}function o(e,t,r){if(null==e.hasM||e.hasZ)for(var i=0,n=t;i<n.length;i++)for(var o=0,s=n[i];o<s.length;o++){var a=s[o];a.length>2&&(a[2]*=r)}}function s(e,t,r){if(e)for(var i=0,n=e;i<n.length;i++)a(n[i].geometry,t,r)}function a(e,t,n){if(e&&e.spatialReference&&!i.equals(e.spatialReference,t)){var s=r.getMetersPerVerticalUnitForSR(e.spatialReference)/n;if(1!==s)if("x"in e)null!=e.z&&(e.z*=s);else if("rings"in e)o(e,e.rings,s);else if("paths"in e)o(e,e.paths,s);else if("points"in e&&(null==e.hasM||e.hasZ))for(var a=0,u=e.points;a<u.length;a++){var l=u[a];l.length>2&&(l[2]*=s)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGeometryZScaler=n,t.applyFeatureSetZUnitScaling=function(e,t,r){if(r&&r.features&&r.hasZ){var i=n(r.geometryType,t,e.outSpatialReference);if(i)for(var o=0,s=r.features;o<s.length;o++)i(s[o].geometry)}},t.unapplyEditsZUnitScaling=function(e,t,i){if((e||t)&&i){var n=r.getMetersPerVerticalUnitForSR(i);s(e,i,n),s(t,i,n)}}}.apply(null,i))||(e.exports=n)},268:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(164),r(230)],void 0===(n=function(e,t,r,i){var n=r("esri-text-decoder")?new TextDecoder("utf-8"):null,o=r("safari")||r("ios")?6:r("ff")?12:32;return function(){function e(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=e?e.byteLength:0),this._tag=0,this._dataType=99,this.init(e,t,r,i)}return e.prototype.init=function(e,t,r,i){this._data=e,this._dataView=t,this._pos=r,this._end=i},e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.processMessageWithArgs=function(e,t,r,i){var n=this.getMessage(),o=e(n,t,r,i);return n.release(),o},e.prototype.processMessage=function(e){var t=this.getMessage(),r=e(t);return t.release(),r},e.prototype.getMessage=function(){var t=this._getLength(),r=e.pool.acquire();return r.init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r},e.prototype.release=function(){e.pool.release(this)},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if((r=Math.min(this._end,r))-t>o&&n){var i=e.subarray(t,r);return n.decode(i)}for(var s="",a="",u=t;u<r;++u){var l=e[u];128&l?a+="%"+l.toString(16):(s+=decodeURIComponent(a)+String.fromCharCode(l),a="")}return a.length&&(s+=decodeURIComponent(a)),s},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e.pool=new i(e,null,(function(e){e._data=null,e._dataView=null})),e}()}.apply(null,i))||(e.exports=n)},281:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(296),r(152),r(191)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),r.__awaiter(this,void 0,void 0,(function(){var s,a,u,l,c,p,d,h,f;return r.__generator(this,(function(y){switch(y.label){case 0:return n.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return s=y.sent(),a=t.lastEditInfoEnabled,u=e.objectIdField,l=e.typeIdField,c=e.globalIdField,p=e.relationships,i.includes(s,"*")?[2,["*"]]:a?[4,o.getFeatureEditFields(e)]:[3,3];case 2:return h=y.sent(),[3,4];case 3:h=[],y.label=4;case 4:return d=h,f=o.fixFields(e.fields,r.__spreadArrays(s,d)),l&&f.push(l),f&&u&&o.hasField(e.fields,u)&&-1===f.indexOf(u)&&f.push(u),f&&c&&o.hasField(e.fields,c)&&-1===f.indexOf(c)&&f.push(c),p&&p.forEach((function(t){var r=t.keyField;f&&r&&o.hasField(e.fields,r)&&-1===f.indexOf(r)&&f.push(r)})),[2,f]}}))}))},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:n.isSome(t)&&t.defaultPopupTemplateEnabled&&n.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,i))||(e.exports=n)},314:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},328:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(329)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,o=0,s=i.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},329:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(154),r(156),r(268),r(330),r(331)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function p(e){return e>=u.length?null:u[e]}function d(e){return e>=c.length?null:c[e]}function h(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function f(e,t,r){for(var i=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),o=e.pos()+n,s=0;e.pos()<o;)t.addCoordinatePoint(i,e.getSInt64(),0,s++);break;case 1:case 2:default:e.skip()}return i}function y(e,t,r){for(var i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),s=e.pos()+o,a=0;e.pos()<s;)t.addLength(i,e.getUInt32(),a++);break;case 3:for(var u=e.getUInt32(),l=(s=e.pos()+u,0),c=0;e.pos()<s;)t.addCoordinate(i,e.getSInt64(),c,l),++l===n&&(c++,l=0);break;case 1:default:e.skip()}return i}function g(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function m(e){for(var t,r={type:p(0)};e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.type=p(e.getEnum());break;case 3:r.alias=e.getString();break;case 4:r.sqlType=(t=e.getEnum())>=l.length?null:l[t];break;case 5:case 6:default:e.skip()}return r}function v(e,t,r,i){for(var n=t.createFeature(r),o=0;e.next();)switch(e.tag()){case 1:var s=i[o++].name;n.attributes[s]=e.processMessage(g);break;case 2:n.geometry=e.processMessageWithArgs(y,t,r);break;case 4:n.centroid=e.processMessageWithArgs(f,t,r);break;default:e.skip()}return n}function _(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function b(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function F(e){for(var t={originPosition:d(0)};e.next();)switch(e.tag()){case 1:t.originPosition=d(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(b);break;default:e.skip()}return t}function x(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function w(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function E(e,t){var r=t.createFeatureResult();r.geometryType=h(t,0);for(var i=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(x);break;case 7:r.geometryType=h(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(w,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(F);break;case 9:var n=e.getBool();r.exceededTransferLimit=n;break;case 13:t.addField(r,e.processMessage(m));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,e.processMessageWithArgs(v,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function S(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(E,t);break;default:e.skip()}return r}t.parseFeatureQuery=function(e,t){var i=function(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}(t);try{for(var u=new n(new Uint8Array(e),new DataView(e)),l={};u.next();)switch(u.tag()){case 2:l.queryResult=u.processMessageWithArgs(S,i);break;default:u.skip()}return l}catch(e){var c=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(c),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},330:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(174),r(177),r(170),r(207),r(194),r(248)],void 0===(n=function(e,t,r,i,n,o,s,a){function u(e,t){return t}function l(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?h:f)(e,t+i,1)}}function c(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?h:f)(e,t+i,1);case 2:return h(e,t,2)}}function p(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?h:f)(e,t+i,1);case 2:return h(e,t,3)}}function d(e,t,r,i){switch(r){case 0:return h(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?h:f)(e,t+i,1);case 2:return h(e,t,2);case 3:return h(e,t,3)}}function h(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function f(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new o.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=a.getGeometryZScaler(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(var r=0,i=e.features;r<i.length;r++)t(i[r].geometry)}},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t));var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&(t.attributes[i]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){var t=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePoint(e,r,n)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePolygon(e,r,n)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePolyline(e,r,n)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,r,i,n){return t.addCoordinateMultipoint(e,r,n)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new o.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},e.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var i=this.lengths.reduce((function(e,t){return e+t}),0);this.coordinateBuffer=new Float64Array(i*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var n=this.transformPathLikeValue(t,r),o=e[e.length-1];0===r&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=n},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?d:t?c:r?p:l},e}();t.Context=y}.apply(null,i))||(e.exports=n)},331:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(200),r(178),r(274),r(304),r(224)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new o.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!i.equals(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=r.getMetersPerVerticalUnitForSR(this.options.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==t)for(var n=0,o=e.features;n<o.length;n++){var s=o[n];if(s.geometry&&s.geometry.coords)for(var a=s.geometry.coords,u=2;u<a.length;u+=3)a[u]*=t}}},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new n.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new s.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new s.default},e}();t.Context=a}.apply(null,i))||(e.exports=n)},334:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(282),r(166),r(155),r(118),r(198),r(151),r(163),r(199)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p){var d=new o.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),h=new o.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.where=null,r.geometry=null,r.spatialRelationship="intersects",r.hiddenIds=new Set,r.distance=void 0,r.objectIds=null,r.units=null,r.timeExtent=null,r.enabled=!1,r}var o;return r.__extends(t,e),o=t,t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.enable=function(){this._set("enabled",!0)},t.prototype.createQuery=function(e){void 0===e&&(e={});var t=this,i=t.where,n=t.geometry,o=t.spatialRelationship,s=t.timeExtent,u=t.objectIds,l=t.units,c=t.distance;return new p(r.__assign({geometry:a.clone(n),objectIds:a.clone(u),spatialRelationship:o,timeExtent:a.clone(s),where:i,units:l,distance:c},e))},t.prototype.clone=function(){var e=this,t=e.where,r=e.geometry,i=e.spatialRelationship,n=e.hiddenIds,s=e.timeExtent,u=e.objectIds,l=e.units,c=e.distance,p=new Set;return n.forEach((function(e){return p.add(e)})),new o({geometry:a.clone(r),hiddenIds:p,objectIds:a.clone(u),spatialRelationship:i,timeExtent:a.clone(s),where:t,units:l,distance:c})},r.__decorate([l.property({type:String})],t.prototype,"where",void 0),r.__decorate([l.writer("where")],t.prototype,"writeWhere",null),r.__decorate([l.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r.__decorate([l.property({type:String,json:{read:{source:"spatialRel",reader:d.read},write:{target:"spatialRel",writer:d.write}}})],t.prototype,"spatialRelationship",void 0),r.__decorate([l.property({json:{write:function(e,t,r){return t[r]=u.valuesOfSet(e)},read:function(e){return u.SetFromValues(e)}}})],t.prototype,"hiddenIds",void 0),r.__decorate([l.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),r.__decorate([l.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),r.__decorate([l.property({type:String,json:{read:h.read,write:{writer:h.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),r.__decorate([l.property({type:n,json:{write:!0}})],t.prototype,"timeExtent",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"enabled",void 0),o=r.__decorate([l.subclass("esri.views.layers.support.FeatureFilter")],t)}(s.JSONSupport)}.apply(null,i))||(e.exports=n)},348:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(165),r(152),r(153),r(172),r(163),r(234),r(304),r(328),r(314),r(248),r(161)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d){function h(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=a.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var o=i.timeExtent,s=o.start,u=o.end;null==s&&null==u||(n.time=s===u?s:(null==s?"null":s)+","+(null==u?"null":u)),delete i.timeExtent}return n}function f(e,t,o,a,l){void 0===a&&(a={});var c="string"==typeof e?s.urlToObject(e):e,d=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",u.normalizeCentralMeridian(d,null,a).then((function(e){var s=e&&e[0];n.isSome(s)&&((t=t.clone()).geometry=s);var u=p.mapParameters(r.__assign(r.__assign(r.__assign(r.__assign({},c.query),{f:o}),l),h(t,l)));return i(c.path+"/query",r.__assign(r.__assign({},a),{query:u}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.queryToQueryStringParameters=h,t.executeQuery=function(e,t,i,n){var o;return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(null===(o=t.timeExtent)||void 0===o?void 0:o.isEmpty)?(a={data:{features:[]}},[3,3]):[3,1];case 1:return[4,f(e,t,"json",n)];case 2:a=r.sent(),r.label=3;case 3:return s=a,d.applyFeatureSetZUnitScaling(t,i,s.data),[2,s]}}))}))},t.executeQueryPBF=function(e,t,r,i){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:new l.default}):f(e,t,"pbf",i).then((function(e){var t,i;return t=c.parsePBFFeatureQuery(e.data,r),(i=e).data=t,i}))},t.executeQueryForIds=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{count:0,extent:null}}):f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e}))},t.runQuery=f}.apply(null,i))||(e.exports=n)},364:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(153),r(197),r(359)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,o=e.layer.fullExtent,s=o&&o.spatialReference;return s?s.equals(t)?r.resolve(o.clone()):i.canProject(s,t)?r.resolve(i.project(o,t)):e.view.state.isLocal?n.projectGeometry(o,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},468:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(190),r(167),r(198),r(151),r(469),r(211)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new u.ExtentSet,t.globalDirty=!1,t.dirtyGraphicsSet=new Set,t.handles=new o,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new n,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var o=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",(function(e){return n.elevationUpdateHandler(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),o.registerTask(l.Task.ELEVATION_ALIGNMENT,(function(e){return n.update(e)}),(function(){return n.needsUpdate()}))])},t.prototype.destroy=function(){this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty},t.prototype.update=function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this,r=this.layerView.view,i=this.graphicsCore.stageLayer.id,n=this.layerView.labeling,o=function(){var o=Math.min(a.dirtyGraphicsSet.size,100);s.someSet(a.dirtyGraphicsSet,(function(i){var n=t.graphicsCore.getGraphics3DGraphicById(i);return t.dirtyGraphicsSet.delete(i),n&&n.alignWithElevation(t.elevationProvider,r.renderCoordsHelper,t.graphicsCore.asyncUpdates),e.madeProgress(),--o<=0||e.done})),r._stage.processDirtyLayer(i),n&&n.processStageDirty()},a=this;this.dirtyGraphicsSet.size>0&&!e.done;)o()},t.prototype._updateDirtyExtents=function(e){for(var t=this;!this.dirtyExtents.empty&&this.dirtyGraphicsSet.size<100&&!e.done;){var r=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",{extent:r,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(r,this.spatialReference,(function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,r){return e.dirtyGraphicsSet.add(r)}))},t.prototype.elevationUpdateHandler=function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent;if(this.spatialReference=e.spatialReference,this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:this.spatialReference})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}},r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([a.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(i);t.default=c}.apply(null,i))||(e.exports=n)},469:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(214),r(173),r(211)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.extents=new r({allocator:function(e){return e||i.create()}}),this.tempExtent=i.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),i.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&this.mergeTight(),this.extents.pop()},e.prototype.merge=function(e){return this.mergeTight(e),e.hasProgressed},e.prototype.mergeTight=function(e){var t=this;void 0===e&&(e=n.noBudget);for(var r=this.extents,o=new Set,s=0;s!==r.length;){r.sort((function(e,t){return e[0]-t[0]})),s=r.length,o.clear();for(var a=function(n){if(e.done)return{value:void 0};for(var s=r.getItemAt(n),a=n+1;a<r.length;++a){var u=r.getItemAt(a);if(u[0]>=s[2])break;o.add(u)}o.forEach((function(n){if(s!==n)if(n[2]<=s[0])o.delete(n);else{var a=i.area(s),u=i.area(n),l=t.tempExtent;i.expand(s,n,l);var c=a+u;(i.area(l)-c)/c<.05&&(i.set(s,l),o.delete(n),r.remove(n),e.madeProgress())}})),o.add(s)},u=0;u<r.length;++u){var l=a(u);if("object"==typeof l)return l.value}}this.dirty=!1},e.prototype.contains=function(e){return this.extents.some((function(t){return i.contains(t,e)}))},e.prototype.removeContained=function(e){this.extents.filterInPlace((function(t){return!i.contains(e,t)}))},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{containsPoint:function(t){return e.extents.some((function(e){return i.containsPoint(e,t)}))}}},enumerable:!0,configurable:!0}),e}();t.ExtentSet=o}.apply(null,i))||(e.exports=n)},470:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(471)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._graphicsCore=e,this._stateSets=new Array}return e.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null},e.prototype.acquireSet=function(e,t){var i=this,n=new r.Graphics3DObjectStateSet(e,t);this._stateSets.push(n);var o={remove:function(){return i.releaseSet(n)},pause:function(){n.objectStateSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,i.initializeSet(n)}};return{set:n,handle:o}},e.prototype.releaseSet=function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)},e.prototype._addObjectStateSet=function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)},e.prototype._removeObjectStateSet=function(e,t){e.removeObjectState(t.objectStateSet)},e.prototype.setUid=function(e,t){e.ids.add(t);var r=this._graphicsCore.graphics3DGraphics.get(t);r&&this._addObjectStateSet(r,e)},e.prototype.setUids=function(e,t){var r=this;t.forEach((function(t){return r.setUid(e,t)}))},e.prototype.setObjectIds=function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)},e.prototype.addGraphic=function(e){var t=this;this._stateSets.forEach((function(r){!r.paused&&r.hasGraphic(e)&&t._addObjectStateSet(e,r)}))},e.prototype.removeGraphic=function(e){var t=this;this._stateSets.forEach((function(r){r.hasGraphic(e)&&t._removeObjectStateSet(e,r)}))},e.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))},e.prototype.initializeSet=function(e){var t=this,r=this._graphicsCore.graphics3DGraphics;e.objectIdField?r.forEach((function(r){r&&e.hasGraphic(r)&&t._addObjectStateSet(r,e)})):e.ids.forEach((function(i){var n=r.get(i);n&&t._addObjectStateSet(n,e)}))},Object.defineProperty(e.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0}),e}();t.Graphics3DObjectStates=i}.apply(null,i))||(e.exports=n)},471:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(445)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new r.Object3DStateSet,this.ids=new Set,this.paused=!1}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}();t.Graphics3DObjectStateSet=i}.apply(null,i))||(e.exports=n)},472:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var o=n[i];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,i))||(e.exports=n)},514:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(158),r(152),r(151),r(184),r(302),r(187),r(199)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=u.default,d=function(e){function t(t){var r=e.call(this,t)||this;return r._dataQueryEngineInstance=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new c({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForExtent=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),n=i.count,o=i.extent,s=a.fromJSON(o),[2,{count:n,extent:s}]}}))}))},t.prototype.executeQueryForIds=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForLatestObservations=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=o.layer,e.sourceLayer=o.layer})),[2,n]}}))}))},t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=o.layer,e.sourceLayer=o.layer})),[2,n]}}))}))},t.prototype._ensureQueryJSON=function(e){return o.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,r=i.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),n=this.layer.fields.map((function(e){return e.toJSON()})),o=this.layerView.view.resourceController.scheduler,s=this.task,a=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,c=l.hasZ,d=l.hasM;return this._dataQueryEngineInstance=new p({hasZ:c,hasM:d,geometryType:r,fields:n,timeInfo:e,spatialReference:a,objectIdField:t,featureStore:u,scheduler:o,task:s}),this._dataQueryEngineInstance},r.__decorate([s.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"task",void 0),r.__decorate([s.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r.__decorate([s.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),r.__decorate([s.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r.__decorate([s.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(n);t.QueryEngine=d,t.default=d}.apply(null,i))||(e.exports=n)},567:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(238),r(661),r(211)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){var c=-.3*a.earthRadius;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suspended=!1,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new n,t.layerView=null,t.updating=!0,t}return r.__extends(t,e),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",(function(){return t.viewChange()})),r.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(l.Task.FRUSTUM_VISIBILITY,(function(){return t.update()}),(function(){return t.updating})),i.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([o.init(i,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),o.init(r,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype._setDirty=function(){this.updating||this._set("updating",!0)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()},t.prototype.viewChange=function(){this._setDirty()},t.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.updateIsVisibleBelowSurface=function(){var e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.isOpaque()||i},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=c;else{var r=t.basemapTerrain.elevationBounds,i=r.min,n=r.max;e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r.__decorate([s.property({readOnly:!0})],t.prototype,"suspended",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([s.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(i)}.apply(null,i))||(e.exports=n)},725:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(174),r(158),r(177),r(167),r(153),r(157),r(151),r(435),r(197),r(199),r(542),r(565),r(468),r(726),r(567),r(470),r(566),r(262),r(472),r(388)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,g,m,v,_,b,F,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new s,r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendInfo",{get:function(){var e={};return this.scaleVisibility&&this.scaleVisibility.suspended&&(e.outsideScaleRange=!0),this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new m:null,r=e.scaleVisibilityEnabled?new _:null,i=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new g.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new y.default:null;return{graphicsCore:new f.Graphics3DCore({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:r,filterVisibility:i,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,r){c.diff(t,r)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,r){c.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,i=function(e,t,r){return o.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(n=e.view.elevationProvider,this.elevationAlignment.setup(e,i,this.graphicsCore,n)),this._set("objectStates",new v.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,a.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return r.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return o.watchUpdatingTracking.addPromise(o.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(e,"fullOpacity",(function(){return o.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(e.view,"clippingArea",(function(){return o._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,a.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t){var r=this;if(e instanceof d){var n=this.objectStates.acquireSet(0,t),o=n.set,s=n.handle;return this.owner.queryObjectIds(e).then((function(e){return r.objectStates.setObjectIds(o,e)})),s}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof i)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof i){var a=e;if(!t||!a[0].attributes||null===F.attributeLookup(a[0].attributes,t)){var u=a.map((function(e){return e.uid})),l=this.objectStates.acquireSet(0,null),c=l.set;return s=l.handle,this.objectStates.setUids(c,u),s}e=a.map((function(e){return F.attributeLookup(e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var p=e,h=this.objectStates.acquireSet(0,t);return c=h.set,s=h.handle,this.objectStates.setObjectIds(c,p),s}}return S},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(u.init(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(E),e.suspendResumeExtentMode){case"computed":e._handles.add(u.init(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;case"data":e._handles.add(u.init(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;default:o.neverReached(e.suspendResumeExtentMode)}})))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!p.canProject(e,r))return;e=p.project(e,r)}return b.enlargeExtent(e,t,h.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r.__decorate([l.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r.__decorate([l.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"labeling",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"objectStates",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([l.property()],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([l.property()],t.prototype,"dataExtent",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspendInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(n);t.default=w;var E="suspendResumeExtentMode",S={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,i))||(e.exports=n)},726:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(167),r(156),r(152),r(153),r(157),r(151),r(514),r(334),r(211)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=o.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),f=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.filter=null,i._dirty=!1,i._querying=!1,i._handles=new n,i}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new c.default({layerView:this._layerView,task:d.Task.FILTER_VISIBILITY});var i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(d.Task.FILTER_VISIBILITY,(function(e){return r._update(e)}),(function(){return r._needsUpdate()}))),this._handles.add(u.on(t.owner,"loadedGraphics","after-changes",(function(e){return r._graphicsChanged(e)}),(function(){return r.dirty=!0}))),this.filterChanged()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var r=s.isSome(e)?e.clone():new p;return r.timeExtent=r.timeExtent?r.timeExtent.intersection(t):t,r},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){a.isAbortError(e)||(h.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),r.__decorate([l.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(i);t.Graphics3DFilterVisibility=f}.apply(null,i))||(e.exports=n)},838:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(155),r(156),r(152),r(151),r(334),r(1042),r(1044)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){var c=n.getLogger("esri.views.layers.support.FeatureEffect");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filter=null,t.includedEffect=null,t.excludedEffect=null,t.excludedLabelsVisible=!1,t}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"insideEffect",{get:function(){return c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect},set:function(e){c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outsideEffect",{get:function(){return c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect},set:function(e){c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedIncludedEffect",{get:function(){return o.isSome(this.includedEffect)?"string"==typeof this.includedEffect?u.fromString(this.includedEffect):new l({from:u.fromString(this.includedEffect.from),to:u.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedExcludedEffect",{get:function(){return o.isSome(this.excludedEffect)?"string"==typeof this.excludedEffect?u.fromString(this.excludedEffect):new l({from:u.fromString(this.excludedEffect.from),to:u.fromString(this.excludedEffect.to),duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"done",{get:function(){return(!o.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!o.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})},r.__decorate([s.property({type:a,json:{write:!0}})],t.prototype,"filter",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"includedEffect",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"excludedEffect",void 0),r.__decorate([s.property({type:Boolean,json:{write:!0}})],t.prototype,"excludedLabelsVisible",void 0),r.__decorate([s.property({dependsOn:["includedEffect"]})],t.prototype,"parsedIncludedEffect",null),r.__decorate([s.property({dependsOn:["excludedEffect"]})],t.prototype,"parsedExcludedEffect",null),r.__decorate([s.property({dependsOn:["includedEffect","excludedEffect"]})],t.prototype,"renderingHash",null),i=r.__decorate([s.subclass("esri.views.layers.support.FeatureEffect")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},840:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(226),r(169),r(177),r(154),r(167),r(118),r(156),r(152),r(303),r(153),r(157),r(151),r(324),r(359),r(485),r(841),r(1060),r(261),r(388)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,g,m,v,_,b,F,x){var w=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),E=function(e){function t(t){var r=e.call(this,t)||this;return r.type="feature-tile-3d",r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.serviceDataExtent=null,r.serviceDataCount=i.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new u,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=h.createAbortController(),r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else w.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===i.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,n=r&&r.featureTiles,o=n&&n.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&o){var s=this.approximateExtentSizeAtScale(t.minScale,o);if((this.serviceDataExtent.width/s+this.serviceDataExtent.height/s)/2>i.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new o([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new o},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add(this,"mode",(function(){return e.modeChanged()}),2);var t=h.resolve().then((function(){return e.verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())})).then((function(){return e.initializeTileFetcher()}));this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new a("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.restart=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.refetch=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,r=f.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then((function(){var r=e,i=r.layerView,n=r.tileDescriptors,o=i.layer;e.tileFetcher=new _.FeatureTileFetcher3D({context:e.context,filterExtent:e.filteredDataExtent,tileDescriptors:n,features:e.graphics}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var s=e.layerView.view.resourceController;s&&(e.handles.add(s.memoryController.events.on("quality-changed",(function(t){e.tileFetcher.memoryFactor=t}))),e.tileFetcher.memoryFactor=s.memoryController.memoryFactor);var a="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;a&&e.handles.add(f.init(e.layerView.view,"qualitySettings.graphics3D."+a,(function(t){e.tileFetcher.lodFactor=t||1}))),e.watchUpdatingTracking.add(o,"createQueryVersion",(function(){return e.dataFilterChanged()})),e.watchUpdatingTracking.add(i,"availableFields",(function(t,r){return e.availableFieldsChanged(r,t)})),e.watchUpdatingTracking.add(i,"requiredFields",(function(t,r){return e.requiredFieldsChanged(r,t)})),e.handles.add([o.on("apply-edits",(function(t){return e.applyEdits(t)})),e.watch("filteredDataExtent",(function(t){return e.tileFetcher.filterExtent=t}),!0),e.watch("tileDescriptors",(function(t){return e.tileFetcher.tileDescriptors=t}),!0),f.init(e,"maximumNumberOfFeatures",(function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t}),!0),f.init(e,"serviceDataCount",(function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures}),!0),f.init(F,"FEATURE_TILE_FETCH_SHOW_TILES",(function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new b.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)}))]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:w.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))}))},t.prototype.availableFieldsChanged=function(e,t){this.tileFetcher&&T(this.tileFetcher.availableFields,t)&&this.refetch()},t.prototype.requiredFieldsChanged=function(e,t){this.tileFetcher&&T(this.tileFetcher.availableFields,t)&&this.restart()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return g.isHostedAgolService(e.url);case"csv":case"geojson":case"ogc-feature":return!0;default:return void s.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),h.isAbortError(t)||this._set("serviceDataExtent",l.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}}))}))},t.prototype.tryUpdateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a,u,c,p,d,h,f;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.layerView,n=t.layer,o=n.capabilities.query.supportsExtent,s=l.clone(t.fullExtentInLocalViewSpatialReference),a=n.fullExtent,u=this.fullExtentIsAccurate(),c=this.serviceDataCount,o&&c<=i.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!s||!u)&&"queryExtent"in n?(p=this.createDataInfoQuery(),[4,n.queryExtent(p,{timeout:i.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return d=r.sent(),this._set("serviceDataExtent",d.extent),[3,6];case 2:return s?(this._set("serviceDataExtent",s),[3,6]):[3,3];case 3:return a?(h="portalItem"in n?n.portalItem:null,[4,m.projectGeometry(a,t.view.spatialReference,h,e)]):[3,5];case 4:return f=r.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),r.label=6;case 6:return[2]}}))}))},t.prototype.updateServiceDataCount=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return"queryFeatureCount"in(t=this.layerView.layer)?[4,n.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))]:(s=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",s),[2]);case 1:if(!0===(o=r.sent()).ok)this._set("serviceDataCount",o.value);else{if(h.isAbortError(o.error))throw o.error;s=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",s)}return[2]}}))}))},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,o=this._get("vertexLimitInfo");return p.isNone(o)||o.maximumTotalNumberOfPrimitives!==r||o.primitivesPerCoordinate!==i||o.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:o},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return s.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,l,c,d,f,y,g,m,v,_,b;return r.__generator(this,(function(r){switch(r.label){case 0:return o=p.isSome(this.vertexLimitInfo)&&this.vertexLimitInfo.primitivesPerFeature<=0,s=this.minimumNumberOfVerticesForGeometry>1,a=this.layerView.layer,u=this.supportsExceedsLimitQuery,p.isNone(this.vertexLimitInfo)||!o&&!s?(this._set("vertexLimitExceeded",!1),[2]):(l=this.vertexLimitInfo,c=l.primitivesPerFeature,d=l.primitivesPerCoordinate,f=l.maximumTotalNumberOfPrimitives,0!==c&&p.isSome(e)?[4,e]:[3,2]);case 1:r.sent(),r.label=2;case 2:return y=this.serviceDataCount,m=y!==i.constants.NO_SERVICE_DATA_COUNT,g=m?Math.ceil((f-y*c)/(d||1)):Math.ceil(f/(d||1)),s&&(g=Math.min(g,S)),m&&this.minimumNumberOfVerticesForGeometry*y>g?(this._set("vertexLimitExceeded",!0),[2]):u?[4,n.result(a.queryFeatures(this.createVertexLimitExceededQuery(g),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>g),[2]);case 3:if(!1===(v=r.sent()).ok){if(h.isAbortError(v.error))throw v.error;return this._set("vertexLimitExceeded",!1),[2]}return _=v.value,(b=_.features[0])&&b.attributes?this._set("vertexLimitExceeded",!!b.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}}))}))},t.prototype.fetchServiceDataInfo=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,o,s=this;return r.__generator(this,(function(r){return this.cancelFetchServiceDataInfo(),e=h.createAbortController(),t=e.signal,i=this.updateServiceDataCount(t),n=h.eachAlways([i,this.updateVertexLimitExceeded(i,t)]),o=n.then((function(){return s.updateServiceDataExtent(t)})).catch((function(e){h.isAbortError(e)||w.error("#fetchServiceDataInfo()",e)})).then((function(){o===s.fetchDataInfoPromise&&(s.fetchDataInfoPromise=null,s.fetchDataInfoAbortController=null),e=null})),e&&(this.fetchDataInfoPromise=o),this.fetchDataInfoAbortController=e,[2,n.then((function(){}),(function(){}))]}))}))},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),r.__decorate([y.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"graphics",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([y.property()],t.prototype,"extent",null),r.__decorate([y.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),r.__decorate([y.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([y.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),r.__decorate([y.property()],t.prototype,"displayFeatureLimit",void 0),r.__decorate([y.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([y.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),r.__decorate([y.property()],t.prototype,"tileFetcher",void 0),r.__decorate([y.property()],t.prototype,"fetchDataInfoPromise",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),i=r.__decorate([y.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(d.EsriPromiseMixin(i)),S=5e6;function T(e,t){if(!t)return!1;for(var r=0,i=t;r<i.length;r++){var n=i[r];if(!e.has(n))return!0}return!1}return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(E||(E={})),E.constants.reset(),E}.apply(null,i))||(e.exports=n)},841:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(180),r(167),r(156),r(152),r(153),r(231),r(198),r(157),r(151),r(173),r(207),r(528),r(199),r(1058),r(1059),r(454),r(211)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,g,m,v,_,b){Object.defineProperty(t,"__esModule",{value:!0});var F=s.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),x=function(e){function t(t){var r=e.call(this,t)||this;return r._useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r.handles=new o,r._dirty=!1,r.featureTiles=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryFactor",{set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodFactor",{set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTileCount",{get:function(){return this._useTileCount&&a.isSome(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))F.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add(p.on(this,"tileDescriptors","change",(function(){return e.setDirty()}),(function(){return e.setDirty()}))),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?m.MultiFeatureReference:m.SingleFeatureReference;var t=this.context.scheduler;a.isSome(t)&&this.handles.add(t.registerTask(b.Task.FEATURE_TILE_FETCHER,(function(t){return e.update(t)}),(function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0}))),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.restart=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.clearTile(t),e.resetFetchTile(t)})),a.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.refetch=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.resetFetchTile(t)})),a.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e.cancelFetchTile(t)})),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=null;return this.featureTiles.forEach((function(t){t.displayingFeatures&&0!==t.displayingFeatures.length&&(a.isNone(e)?e=c.SetFromValues(n.keysOfSet(t.availableFields)):e.forEach((function(r){t.availableFields.has(r)||a.unwrap(e).delete(r)})))})),a.isSome(e)?e:new Set},enumerable:!0,configurable:!0}),t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:u.resolve(),count:0,controller:u.createAbortController()},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then((function(){return e.result.catch((function(e){if(u.isAbortError(e))throw e;return null})).then((function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,a.isSome(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e}))}));return this.pendingEdits.edits=r,this.updated(),r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach((function(e){return r.add(e.objectId)})),this.featureTiles.forEach((function(e){if(e.features){var i=e.features.filter((function(e){return!r.has(f.getObjectId(e,t.objectIdField))}));i.length!==e.features.length&&(e.setFeatures(i,0,e.availableFields),t.invalidateCounts())}}))}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=[],o=new Set,e.forEach((function(e){return n.push(e.objectId)})),t.forEach((function(e){n.push(e.objectId),o.add(e.objectId)})),0===n.length?[2]:(s=[],this.featureTiles.forEach((function(e){var t=a.applyEditsAddUpdateTile(e,n,o,i);t&&s.push(t)})),[4,u.eachAlways(s)]);case 1:return r.sent(),[2]}}))}))},t.prototype.applyEditsAddUpdateTile=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,l,c,p,d=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e.features?((o=this.createQuery(e)).resultType=void 0,o.cacheHint=!1,o.objectIds=t,[4,this.queryFeatures(o,n)]):[2];case 1:if(s=r.sent(),a=null,i.size>0&&(u=e.features.filter((function(e){return!i.has(f.getObjectId(e,d.objectIdField))}))).length!==e.features.length&&(a=u),s.features.length>0)for(a||(a=e.features.slice()),l=0,c=s.features;l<c.length;l++)p=c[l],a.push(p);return a&&(e.setFeatures(a,0,C(e.availableFields,s.fields)),this.invalidateCounts()),[2]}}))}))},t.prototype.queryFeatures=function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:j})},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&performance.now()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();if(this.markTilesNotAlive(r),e.run((function(){return t.addTiles(r,e)}))&&e.run((function(){return t.filterExtentTiles(r,e)}))&&e.run((function(){return t.removeTiles(r,e)}))&&!e.done){var i=this.sortTiles(r);e.run((function(){return t.displayTiles(i,e)}))&&e.run((function(){return t.fetchTiles(i,e)}))&&e.run((function(){return t.updateMemoryEstimates(i,e)}))||this.setDirty(),this.updated()}else this.setDirty()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach((function(i){var n=r.featureTiles.get(i.id);n?n.alive=!0:t.done||(e.push(r.addTile(i)),t.madeProgress())})),t.hasProgressed)},t.prototype.filterExtentTiles=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this.clearTile(n),t.madeProgress()))}return t.hasProgressed},t.prototype.removeTiles=function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this.removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed},t.prototype.sortTiles=function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),n=function(e){if(!t.run((function(){return function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.memoryFactor,r.objectIdField)&&r.setDirty(),r.showTile(e)}(e)})))return o.setDirty(),"break"},o=this,s=0,a=e;s<a.length&&"break"!==n(a[s]);s++);return t.hasProgressed},t.prototype.fetchTiles=function(e,t){var r=this;if(this.paused)return!1;for(var i=!1,n=function(e){if(!e.needsFetching)return"continue";var r=a.isSome(o.context.memoryCache)?o.context.memoryCache.pop(e.id):null;if(a.isSome(r))return e.cache=r,o.setDirty(),o.scheduleUpdated(),t.madeProgress(),"continue";if(o.needsNumFeatures(e)){var n=u.createAbortController(),s=o.fetchTileCount(e,n.signal);o._handleRequest(e,s,n,(function(){return e.numFeatures=v.FAILED_FEATURE_COUNT})),i=!0,t.madeProgress()}return t.done?{value:!0}:void 0},o=this,s=0,l=e;s<l.length;s++){var c=n(l[s]);if("object"==typeof c)return c.value}if(i)return t.hasProgressed;for(var p=function(e){if(e.needsFetching){var i=u.createAbortController(),n=d.fetchTile(e,i.signal);if(d._handleRequest(e,n,i,(function(t){e.setFeatures([],0,null),r.invalidateCounts(),e.featuresMissing=!1,r.context.logFetchError(F,t)})),t.madeProgress(),t.done)return{value:!0}}},d=this,h=0,f=e;h<f.length;h++){var y=p(f[h]);if("object"==typeof y)return y.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var r=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(r.setDirty(),!0)})),t.hasProgressed},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.featureTiles.forEach((function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,R),i.intersection(e,P),h.equals(R,P)||r.hideTileFeatures(i))})),this.featureTiles.forEach((function(e){return r.showTile(e)})),this.updated())},t.prototype.updated=function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var r=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",r),r){var i=0,n=0,o=0,s=0,a=0,u=0,l=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++o,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),i=t.displayingFeatures?t.displayingFeatures.length*l:0;u+=r-i}t.needsFetching?++a:t.numFeatures>0&&(++s,n+=t.numFeatures)})),a+=t;var c=0;n?(i=n,c=Math.min(a*n/s,n)):(i=o,c=a),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",i),this._set("updatingRemaining",c),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.featureTiles.forEach((function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded})),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<Math.max(0,t-e.descriptor.lij[0]))},i=0,n=0,o=0,s=e;o<s.length;o++){var a=s[o],u=a.numFeatures;i+=u,n+=u*r(a)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}})),this.setDirty())},t.prototype.addTile=function(e){var t=new v.FeatureTile(e);return this.featureTiles.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.featureTiles.forEach((function(i){if(i.displayingFeatures&&e!==i&&(!e.descriptor.lij||!i.descriptor.lij||_.tilesAreRelated(e.descriptor.lij,i.descriptor.lij))){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,o=i.displayingFeatures;n<o.length;n++){var s=o[n];e.displayingFeatures.push(s);var a=t.displayingFeatureReferences.get(f.getObjectId(s,t.objectIdField));a.ref(a.feature,r),t.numDisplayingFeatureReferences++}}})),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.removeTile=function(e){this.clearTile(e),this.featureTiles.delete(e.id)},t.prototype.resetFetchTile=function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0},t.prototype.cancelFetchTile=function(e){var t=e.requestController;a.isSome(t)&&(e.requestController=null,e.resetFetching(),t.abort())},t.prototype.fetchTileCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return i=e,[4,this.fetchCount(e,t)];case 1:return i.numFeatures=r.sent(),this.updateRatio(this.getListOfTiles()),[2,3===e.fetchStatus?1:0]}}))}))},t.prototype.fetchTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s,a,u,l,c,p,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:return(i=this.maximumFeaturesForTile(e))<=0?[2,S(e)]:(n=this.getMaxRecordCount(e),o=Math.ceil(i/n),w(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=i&&o>g.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((s=this.createQuery(e)).maxRecordCountFactor=Math.ceil(i/n),e.isRefetching&&e.features&&e.features.length>0&&(a=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/n),s.maxRecordCountFactor=Math.max(a+1,s.maxRecordCountFactor)),[4,this.queryFeatures(s,t)]));case 1:return u=r.sent(),l=u.features,c=u.exceededTransferLimit,p=u.fields,d=c?s.maxRecordCountFactor>=g.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=l.length<e.numFeatures||c,h=this._removeEmptyFeatures(l),e.setFeatures(l,h,T(p)),this.invalidateCounts(),[2,d]}}))}))},t.prototype.fetchCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]}))}))},t.prototype.fetchPagedTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s,a,u,l,c,p,d,h,f,y;return r.__generator(this,(function(r){switch(r.label){case 0:i=0,n=0,s=0,a=this.maximumFeaturesForTile(e)-s,u=this.getMaxRecordCount(e),l=null,r.label=1;case 1:return c=this.createQuery(e),p=this.setPagingParameters(c,i,a,u),[4,this.queryFeatures(c,t)];case 2:return d=r.sent(),h=d.features,f=d.exceededTransferLimit,y=d.fields,p&&(i+=c.num),s+=h.length,n+=this._removeEmptyFeatures(h),e.featuresMissing=i<e.numFeatures||f,o=o?o.concat(h):h,l=C(l,y),e.setFeatures(o,n,l),this.invalidateCounts(),this.setDirty(),a=this.maximumFeaturesForTile(e)-s,!p||!f||a<=0?[2,f?4:5]:[3,1];case 3:return[2]}}))}))},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=h.toExtent(r,i)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor},Object.defineProperty(t.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0}),t.prototype.setResolutionParams=function(e,t){if(this.supportsResolution){var r=this.getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new y.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];f.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&e.needsFeatureCount&&!w(e)},t.prototype.getMaxRecordCount=function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this.useTileQuery(e)&&a.isSome(r)&&r>0&&this.context.capabilities.supportsResultType?r:a.isSome(i)&&i>0?i:O},t.prototype.useTileQuery=function(e){return(!w(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType},t.prototype._handleRequest=function(e,t,r,i){var n=this;e.fetchStatus=e.needsRefetching?3:2,e.requestController=r;var o=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===r&&(e.requestController=null,e.fetchStatus=4),u.isAbortError(t)?o=!0:i(t)})).then((function(){o||n.setDirty(),n.scheduleUpdated()}))},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(l.schedule((function(){e.handles.remove("scheduleUpdated"),e.updated()})),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,o=this.changes.adds,s=Math.min(e.featureLimit,t.length);e.featureLimit=s;for(var a=0;a<s;++a){var u=t[a],l=f.getObjectId(u,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var p=c.ref(u,i);p.oldVersion!==p.newVersion&&(n.removes.push(p.oldVersion),n.adds.push(p.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(u,i)),o.push(u);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,s),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,n=e.displayingFeatures;i<n.length;i++){var o=n[i],s=f.getObjectId(o,this.objectIdField),a=this.displayingFeatureReferences.get(s);if(a){var u=a.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(s),r.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var o=Math.min(n+V,i);this.features.addMany(t.slice(n,o)),this.features.removeMany(r.slice(n,o)),n=o}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&a.isSome(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.featureTiles.size),t=0;return this.featureTiles.forEach((function(r){return e[t++]=r})),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}},enumerable:!0,configurable:!0}),r.__decorate([d.property({constructOnly:!0})],t.prototype,"features",void 0),r.__decorate([d.property()],t.prototype,"tileDescriptors",void 0),r.__decorate([d.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([d.property({value:1})],t.prototype,"memoryFactor",null),r.__decorate([d.property({value:1})],t.prototype,"lodFactor",null),r.__decorate([d.property({dependsOn:["context"]})],t.prototype,"useTileCount",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),r.__decorate([d.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"totalVertices",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"totalFeatures",null),r.__decorate([d.property()],t.prototype,"filterExtent",null),r.__decorate([d.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([d.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(i);function w(e){return"dummy-tile-full-extent"===e.id}function E(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function S(e){return e.setFeatures([],0,null),e.featuresMissing=!1,4}function T(e){return a.isNone(e)?new Set:c.SetFromValues(e.map((function(e){return e.name})))}function C(e,t){if(a.isNone(e)||a.isNone(t))return T(t);for(var r=new Set,i=0,n=t;i<n.length;i++){var o=n[i].name;e.has(o)&&r.add(o)}return r}t.FeatureTileFetcher3D=x,t.contextCapabilitiesFromLayer=function(e){var t=e.capabilities.query;return{supportsMultipleResolutions:E(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}};var O=2e3,R=h.create(),P=h.create(),j=6e5,V=200;t.default=x}.apply(null,i))||(e.exports=n)}}]);
//# sourceMappingURL=38.js.map