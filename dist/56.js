(function(){var e={"esri/core/pbf":268,"esri/tasks/operations/urlUtils":314,"esri/tasks/operations/pbfQueryUtils":328,"esri/tasks/operations/pbfFeatureServiceParser":329,"esri/tasks/operations/pbfDehydratedFeatureSet":330,"esri/tasks/operations/pbfOptimizedFeatureSet":331,"esri/tasks/operations/query":348,"esri/core/CircularArray":601,"esri/views/3d/support/EventedSet":1062,"esri/layers/graphics/data/StreamFeatureManager":1083,"esri/layers/graphics/sources/connections/GeoEventConnection":1084,"esri/layers/graphics/sources/connections/StreamConnection":1085,"esri/layers/graphics/controllers/StreamController":2286},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{1062:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(198)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new Set,t}return r.__extends(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._set.add(n)}this.emit("after-changes",{type:1}),this.emit("change",{added:e,removed:[]})}},t.prototype.remove=function(e){this._set.delete(e)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[e]}))},t.prototype.removeMany=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this._set.delete(i)&&t.push(i)}t.length>0&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:t}))},t.prototype.toArray=function(){return i.valuesOfSet(this._set)},t.prototype.find=function(e){var t;return i.someSet(this._set,(function(r){return!!e(r)&&(t=r,!0)})),t},t.prototype.forEach=function(e){this._set.forEach((function(t){return e(t)}))},t}(n);t.EventedSet=o}.apply(null,n))||(e.exports=i)},1083:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(601),r(168),r(152)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__";var o=function(){function e(e,r,n,i,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=Date.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=n,this._purgeOptions=i,this.store=e,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===t.DEFAULT_STREAM_ID_FIELD}return e.prototype.add=function(e){if(this._useGeneratedIds&&(e.attributes[this.objectIdField]=this._nextId()),e.objectId=e.attributes[this.objectIdField],this.store.add(e),this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){var o=i.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,s=n.clamp(o,0,1e3);this._trackIdToObservations.set(t,new r.default(s))}var a=this._trackIdToObservations.get(t),u=e.attributes[this.objectIdField],c=a.enqueue(u);if(i.isSome(c)){var p=this.store.removeById(c);i.isSome(p)&&(this._addOrUpdated.has(c)?this._addOrUpdated.delete(c):this._removed.push(p))}}},e.prototype.checkForUpdates=function(){var e=this._getToAdd(),t=this._getToRemove(),r=Date.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=r),(e||t)&&this.store.update(e,t)},e.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e},e.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},e.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},e.prototype._purge=function(){var e=this._purgeOptions;i.isSome(e)&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeTracks())},e.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.store.size;r>e.displayCount&&this._trackIdToObservations.forEach((function(n){if(r>e.displayCount&&n.size){var o=t.store.removeById(i.unwrap(n.dequeue()));i.isSome(o)&&t._removed.push(o),r--}}))}},e.prototype._purgeByAge=function(e){var t=this;if(e.age){var r=60*e.age*1e3,n=this._maxAge-r,i=this._timeInfo.startTimeField;this.store.forEach((function(e){e.attributes[i]<n&&(t.store.removeById(e.objectId),t._removed.push(e))}))}},e.prototype._purgeTracks=function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))},e}();t.default=o}.apply(null,n))||(e.exports=i)},1084:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(154),r(156),r(152),r(153),r(151),r(222),r(1085),r(348),r(248),r(199)],void 0===(i=function(e,t,r,n,i,o,s,a,u,c,p,d,h,l,f){Object.defineProperty(t,"__esModule",{value:!0});var y,_=s.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(y=t.ReadyState||(t.ReadyState={}));var g=function(e){function t(t,r,n,i,o,s,a,u){void 0===s&&(s=5),void 0===a&&(a=3);var c=e.call(this)||this;return c._destroyed=!1,c.errorString=null,c._source=t,c._sourceSpatialReference=r,c._spatialReference=n,c._filter=o,c._outFields=u,c._maxQueryDepth=s,c._maxRecordCountFactor=a,c._featureZScaler=l.getGeometryZScaler(i,r,n),c._open(),c}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||_.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),n=this._filter,i=this._outFields,this._destroyed||this._setFilter(n,i),[2]}}))}))},t.prototype.destroy=function(){this._destroyed=!0,a.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(a.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case y.CONNECTING:case y.OPEN:return"connected";case y.CLOSING:case y.CLOSED:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),r.__awaiter(this,void 0,void 0,(function(){var n,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this._destroyed?[2]:(n=this,[4,this._createWebSocket(e)]);case 1:return n._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return i=r.sent(),s=t/1e3,_.error(new o("geoevent-connection","Failed to connect. Attempting to reconnect in "+s+"s",i)),[4,u.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),n=u.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return n.then((function(){if(t._destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),n},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void _.error(new o("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),_.error("geoevent-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&_.error("geoevent-connection","WebSocket closed unexpectedly with error code "+e.code),this._destroyed||this._open()},t.prototype._fetchServiceDefinition=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),n=t.data,this._serviceDefinition=n,[2,n]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){return n=e[0],i=n.urls,o=n.token,[2,this._inferWebSocketBaseUrl(i)+"/subscribe?outSR="+t.wkid+(o?"&token="+o:"")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var n=r[t];if(-1!==n.indexOf("wss"))return n}return _.error(new o("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,s,c,p,d,h=this;return r.__generator(this,(function(r){return n=this._websocket,this._filter=e,this._outFields=t,a.isNone(n)||a.isNone(e)&&a.isNone(t)?[2]:(i=JSON.stringify({filter:this._serializeFilter(e,t)}),s=!1,c=u.createResolver(),p=function(){s||(h._destroyed||h._websocket!==n||_.error(new o("geoevent-connection","Server timed out when setting filter")),c.reject())},d=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(_.error(new o("geoevent-connection","Failed to set service filter",t.error)),h._set("errorString","Could not set service filter - "+t.error),c.reject(t.error)),n.onmessage=h._onMessage.bind(h),s=!0,c.resolve())},n.onmessage=d,n.send(i),setTimeout(p,1e4),[2,c.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(a.isNone(e)&&a.isNone(t))return r;if(a.isSome(e)&&e.geometry)try{var i=n.fromJSON(e.geometry);if("extent"!==i.type)throw new o("Expected extent but found type "+i.type);r.geometry=JSON.stringify(i.shiftCentralMeridian())}catch(e){_.error(new o("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return a.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),a.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return _.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var n=this._relatedFeatures.get(r),i=n.attributes,s=n.geometry;for(var a in i)e.attributes[a]=i[a];return s&&(e.geometry=s),e.geometry||e.centroid||_.error(new o("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i,s,a,u,c,p,d;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,n=e.keepLatestArchive,i=this._queryRelatedFeatures(t),s=this._queryArchive(n),[4,i];case 1:return r.sent(),[4,s];case 2:if(!(a=r.sent()))return[2];for(u=0,c=a.features;u<c.length;u++)p=c[u],this.onFeature(this._enrich(p));return[3,4];case 3:return d=r.sent(),_.error(new o("geoevent-connection","Encountered an error when querying buddy services",{error:d})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,s,u,c,d,l,y;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,(t=new p({url:e})).load()];case 1:return n=r.sent().capabilities,i=n.query.supportsMaxRecordCountFactor,o=n.query.supportsPagination,s=n.query.supportsCentroid,u=this._maxRecordCountFactor,c=t.capabilities.query.maxRecordCount,d=i?c*u:c,(l=new f).outFields=a.unwrapOr(this._outFields,["*"]),l.where=a.unwrapOr(a.get(this._filter,"where"),"1=1"),l.returnGeometry=!0,l.returnExceededLimitFeatures=!0,l.outSpatialReference=this._spatialReference,s&&(l.returnCentroid=!0),i&&(l.maxRecordCountFactor=u),o?(l.num=d,t.destroy(),[2,this._queryPages(e,l)]):[4,h.executeQuery(e,l,this._sourceSpatialReference)];case 2:return y=r.sent(),t.destroy(),[2,y.data]}}))}))},t.prototype._queryPages=function(e,t,n,i){return void 0===n&&(n=[]),void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return t.start=i*t.num,[4,h.executeQuery(e,t,this._sourceSpatialReference)];case 1:return(o=r.sent().data).exceededTransferLimit&&i<this._maxQueryDepth?(o.features.forEach((function(e){return n.push(e)})),[2,this._queryPages(e,t,n,i+1)]):(n.forEach((function(e){return o.features.push(e)})),[2,o])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,n=this._serviceDefinition.relatedFeatures.joinField,i=0,o=r;i<o.length;i++){var s=o[i],a=s.attributes[n];t.set(a,s)}this._relatedFeatures=t},r.__decorate([c.property()],t.prototype,"connectionStatus",null),r.__decorate([c.property()],t.prototype,"errorString",void 0),r.__decorate([c.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(d.default);t.default=g}.apply(null,n))||(e.exports=i)},1085:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(236),r(151)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r.__decorate([o.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(n.EventedMixin(i.HandleOwner));t.default=s}.apply(null,n))||(e.exports=i)},2286:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(174),r(190),r(236),r(303),r(151),r(1083),r(1084),r(1062)],void 0===(i=function(e,t,r,n,i,o,s,a,u,c,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e,t){this.layer=e,this.collection=t,this._idToGraphic=new Map,this._idToFeature=new Map}return e.prototype.destroy=function(){this._idToGraphic.clear(),this._idToFeature.clear()},e.prototype.add=function(e){var t=i.fromJSON(e);t.sourceLayer=t.layer=this.layer,this._idToFeature.set(e.objectId,e),this._idToGraphic.set(e.objectId,t),this.collection.addMany([t])},e.prototype.forEach=function(e){this._idToFeature.forEach(e)},e.prototype.removeById=function(e){var t=this._idToFeature.get(e),r=this._idToGraphic.get(e);return t&&r?(r.sourceLayer=r.layer=null,this.collection.remove(r),this._idToFeature.delete(e),this._idToGraphic.delete(e),t):null},e.prototype.update=function(e,t){},Object.defineProperty(e.prototype,"size",{get:function(){return this.collection.length},enumerable:!0,configurable:!0}),e}(),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.graphics=new d.EventedSet,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer.when((function(){return e._startup()})))},t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.connection||"connected"===this.connection.connectionStatus},enumerable:!0,configurable:!0}),t.prototype._startup=function(){var e=this,t=this.layer,r=t.parsedUrl,i=t.spatialReference,o=t.definitionExpression,s=t.geometryDefinition,a=t.objectIdField,u=t.timeInfo,d=t.purgeOptions,l=n.featureGeometryTypeKebabDictionary.toJSON(this.layer.geometryType);this.clear(),this._set("connection",new p.default(r.path,i,this.layerView.view.spatialReference,l,{geometry:s,where:o})),this.store=new h(this.layer,this.graphics),this.featuresManager=new c.default(this.store,a,u.toJSON(),d),this.handles.add([this.connection.on("feature",(function(t){return e._onFeature(t)})),this.layer.watch("definitionExpression",(function(){return e._startup()})),this.layer.watch("geometryDefinition",(function(){return e._startup()})),this.layer.watch("purgeOptions",(function(){return e._startup()}))]),this._updateIntervalId=setInterval((function(){return e.featuresManager.checkForUpdates()}),64)},t.prototype._onFeature=function(e){this.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{this.featuresManager.add(e)}catch(e){}},r.__decorate([u.property()],t.prototype,"connection",void 0),r.__decorate([u.property()],t.prototype,"layer",void 0),r.__decorate([u.property()],t.prototype,"layerView",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["connection.connectionStatus"]})],t.prototype,"updating",null),r.__decorate([u.subclass("esri.layers.graphics.controllers.StreamController")],t)}(s.HandleOwnerMixin(a.EsriPromiseMixin(o.EventedAccessor)));t.default=l}.apply(null,n))||(e.exports=i)},268:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(230)],void 0===(i=function(e,t,r,n){var i=r("esri-text-decoder")?new TextDecoder("utf-8"):null,o=r("safari")||r("ios")?6:r("ff")?12:32;return function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=e?e.byteLength:0),this._tag=0,this._dataType=99,this.init(e,t,r,n)}return e.prototype.init=function(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n},e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.processMessageWithArgs=function(e,t,r,n){var i=this.getMessage(),o=e(i,t,r,n);return i.release(),o},e.prototype.processMessage=function(e){var t=this.getMessage(),r=e(t);return t.release(),r},e.prototype.getMessage=function(){var t=this._getLength(),r=e.pool.acquire();return r.init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r},e.prototype.release=function(){e.pool.release(this)},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var i=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*i,i*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*i}return this._pos=r,n},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if((r=Math.min(this._end,r))-t>o&&i){var n=e.subarray(t,r);return i.decode(n)}for(var s="",a="",u=t;u<r;++u){var c=e[u];128&c?a+="%"+c.toString(16):(s+=decodeURIComponent(a)+String.fromCharCode(c),a="")}return a.length&&(s+=decodeURIComponent(a)),s},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e.pool=new n(e,null,(function(e){e._data=null,e._dataView=null})),e}()}.apply(null,n))||(e.exports=i)},314:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var o=0;o<i.length;o++)r[n][o]=e(i[o])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},328:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(329)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var n=r.parseFeatureQuery(e,t).queryResult.featureResult;if(n&&n.features&&n.features.length&&n.objectIdFieldName)for(var i=n.objectIdFieldName,o=0,s=n.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[i])}return n}}.apply(null,n))||(e.exports=i)},329:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156),r(268),r(330),r(331)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],c=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],p=["upperLeft","lowerLeft"];function d(e){return e>=u.length?null:u[e]}function h(e){return e>=p.length?null:p[e]}function l(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function f(e,t,r){for(var n=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var i=e.getUInt32(),o=e.pos()+i,s=0;e.pos()<o;)t.addCoordinatePoint(n,e.getSInt64(),0,s++);break;case 1:case 2:default:e.skip()}return n}function y(e,t,r){for(var n=t.createGeometry(r),i=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),s=e.pos()+o,a=0;e.pos()<s;)t.addLength(n,e.getUInt32(),a++);break;case 3:for(var u=e.getUInt32(),c=(s=e.pos()+u,0),p=0;e.pos()<s;)t.addCoordinate(n,e.getSInt64(),p,c),++c===i&&(p++,c=0);break;case 1:default:e.skip()}return n}function _(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g(e){for(var t,r={type:d(0)};e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.type=d(e.getEnum());break;case 3:r.alias=e.getString();break;case 4:r.sqlType=(t=e.getEnum())>=c.length?null:c[t];break;case 5:case 6:default:e.skip()}return r}function v(e,t,r,n){for(var i=t.createFeature(r),o=0;e.next();)switch(e.tag()){case 1:var s=n[o++].name;i.attributes[s]=e.processMessage(_);break;case 2:i.geometry=e.processMessageWithArgs(y,t,r);break;case 4:i.centroid=e.processMessageWithArgs(f,t,r);break;default:e.skip()}return i}function m(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function b(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function w(e){for(var t={originPosition:h(0)};e.next();)switch(e.tag()){case 1:t.originPosition=h(e.getEnum());break;case 2:t.scale=e.processMessage(m);break;case 3:t.translate=e.processMessage(b);break;default:e.skip()}return t}function S(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function k(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function F(e,t){var r=t.createFeatureResult();r.geometryType=l(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(S);break;case 7:r.geometryType=l(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(k,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(w);break;case 9:var i=e.getBool();r.exceededTransferLimit=i;break;case 13:t.addField(r,e.processMessage(g));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(v,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function I(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(F,t);break;default:e.skip()}return r}t.parseFeatureQuery=function(e,t){var n=function(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}(t);try{for(var u=new i(new Uint8Array(e),new DataView(e)),c={};u.next();)switch(u.tag()){case 2:c.queryResult=u.processMessageWithArgs(I,n);break;default:u.skip()}return c}catch(e){var p=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(p),{queryResult:{featureResult:n.createFeatureResult()}}}}}.apply(null,n))||(e.exports=i)},330:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(174),r(177),r(170),r(207),r(194),r(248)],void 0===(i=function(e,t,r,n,i,o,s,a){function u(e,t){return t}function c(e,t,r,n){switch(r){case 0:return l(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?l:f)(e,t+n,1)}}function p(e,t,r,n){switch(r){case 0:return l(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?l:f)(e,t+n,1);case 2:return l(e,t,2)}}function d(e,t,r,n){switch(r){case 0:return l(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?l:f)(e,t+n,1);case 2:return l(e,t,3)}}function h(e,t,r,n){switch(r){case 0:return l(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?l:f)(e,t+n,1);case 2:return l(e,t,2);case 3:return l(e,t,3)}}function l(e,t,r){var n=e.translate,i=e.scale;return n[r]+t*i[r]}function f(e,t,r){var n=e.translate,i=e.scale;return n[r]-t*i[r]}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new o.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=a.getGeometryZScaler(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(var r=0,n=e.features;r<n.length;r++)t(n[r].geometry)}},e.prototype.createSpatialReference=function(){return new i},e.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t));var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var n in t.attributes){var i=t.attributes[n];"string"==typeof i&&i.length>r&&(t.attributes[n]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){var t=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePoint(e,r,i)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePolygon(e,r,i)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePolyline(e,r,i)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,r,n,i){return t.addCoordinateMultipoint(e,r,i)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:n.neverReached(e.geometryType)}},e.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new o.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},e.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var n=this.lengths.reduce((function(e,t){return e+t}),0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var i=this.transformPathLikeValue(t,r),o=e[e.length-1];0===r&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=i},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?h:t?p:r?d:c},e}();t.Context=y}.apply(null,n))||(e.exports=i)},331:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(200),r(178),r(274),r(304),r(224)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new o.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!n.equals(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=r.getMetersPerVerticalUnitForSR(this.options.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==t)for(var i=0,o=e.features;i<o.length;i++){var s=o[i];if(s.geometry&&s.geometry.coords)for(var a=s.geometry.coords,u=2;u<a.length;u+=3)a[u]*=t}}},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new i.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new s.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new s.default},e}();t.Context=a}.apply(null,n))||(e.exports=i)},348:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(152),r(153),r(172),r(163),r(234),r(304),r(328),r(314),r(248),r(161)],void 0===(i=function(e,t,r,n,i,o,s,a,u,c,p,d,h){function l(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=a.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var o=n.timeExtent,s=o.start,u=o.end;null==s&&null==u||(i.time=s===u?s:(null==s?"null":s)+","+(null==u?"null":u)),delete n.timeExtent}return i}function f(e,t,o,a,c){void 0===a&&(a={});var p="string"==typeof e?s.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",u.normalizeCentralMeridian(h,null,a).then((function(e){var s=e&&e[0];i.isSome(s)&&((t=t.clone()).geometry=s);var u=d.mapParameters(r.__assign(r.__assign(r.__assign(r.__assign({},p.query),{f:o}),c),l(t,c)));return n(p.path+"/query",r.__assign(r.__assign({},a),{query:u}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.queryToQueryStringParameters=l,t.executeQuery=function(e,t,n,i){var o;return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(null===(o=t.timeExtent)||void 0===o?void 0:o.isEmpty)?(a={data:{features:[]}},[3,3]):[3,1];case 1:return[4,f(e,t,"json",i)];case 2:a=r.sent(),r.label=3;case 3:return s=a,h.applyFeatureSetZUnitScaling(t,n,s.data),[2,s]}}))}))},t.executeQueryPBF=function(e,t,r,n){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:new c.default}):f(e,t,"pbf",n).then((function(e){var t,n;return t=p.parsePBFFeatureQuery(e.data,r),(n=e).data=t,n}))},t.executeQueryForIds=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{count:0,extent:null}}):f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e}))},t.runQuery=f}.apply(null,n))||(e.exports=i)},601:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}return Object.defineProperty(e.prototype,"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),e.prototype.enqueue=function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null},e.prototype.dequeue=function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e},e}();t.default=r}.apply(null,n))||(e.exports=i)}}]);
//# sourceMappingURL=56.js.map