(function(){var e={"esri/layers/graphics/data/QueryEngine":302,"esri/layers/support/PromiseQueue":383,"esri/layers/graphics/data/QueryEngineCapabilities":558,"esri/layers/graphics/data/QueryEngineResult":719,"esri/layers/graphics/data/AttributesBuilder":720},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{302:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(117),r(154),r(118),r(152),r(483),r(153),r(198),r(200),r(193),r(173),r(353),r(163),r(178),r(363),r(263),r(558),r(719),r(559),r(512),r(315),r(255),r(383)],void 0===(s=function(e,t,r,i,s,n,u,a,o,c,l,h,f,d,p,y,m,_,g,v,x,b,I,F){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,i,s){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=s,this.groupId=-1,this.localId=t};var S=new Set,Q=new u.MemCacheStorage(2e6),w=0,R=function(){function e(e){var t=this;this.capabilities={query:_.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new u.MemCache(w+++"$$",Q)),this.fieldsIndex=new I(e.fields),e.scheduler&&e.task&&(this._frameQueue=new F.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:b.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=x.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,n,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=s.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return b.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),[3,9];case 8:if((n=r.sent())!==b.QUERY_ENGINE_EMPTY_RESULT)throw n;return i=new g.default([],null,this),[3,9];case 9:return[2,i.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,n,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=s.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return b.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return[2,(i=r.sent()).size];case 8:if((n=r.sent())!==b.QUERY_ENGINE_EMPTY_RESULT)throw n;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,n,u,a,o,h,f,d=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=s.clone(e),n=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return b.normalizeQuery(t,d.definitionExpression,d.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return d._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return d._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),(u=i.size)?(l.set(T,l.NEGATIVE_INFINITY),this.featureStore.forEachBounds(i.items,(function(e){return l.expand(T,e)}),E),a={xmin:T[0],ymin:T[1],xmax:T[3],ymax:T[4],spatialReference:b.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(T[2])&&isFinite(T[5])&&(a.zmin=T[2],a.zmax=T[5]),(o=m.project(a,i.spatialReference,n)).spatialReference=b.cleanFromGeometryEngine(n||this.spatialReference),o.xmax-o.xmin==0&&(h=c.getMetersPerUnitForSR(o.spatialReference),o.xmin-=h,o.xmax+=h),o.ymax-o.ymin==0&&(h=c.getMetersPerUnitForSR(o.spatialReference),o.ymin-=h,o.ymax+=h),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(h=c.getMetersPerUnitForSR(o.spatialReference),o.zmin-=h,o.zmax+=h),[2,{count:u,extent:o}]):[2,{count:u,extent:null}];case 8:if((f=r.sent())===b.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw f;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return o.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,n,u,a,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=s.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return b.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),n=i.items,u=new Set,[4,this._reschedule((function(){for(var e=0,t=n;e<t.length;e++){var r=t[e];u.add(i.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,u];case 9:if((a=r.sent())===b.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw a;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,n,u,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=s.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return b.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return n=r.sent(),[4,this._reschedule((function(){return n.executeObjectIdsQuery(t)}))];case 5:return n=r.sent(),[4,this._reschedule((function(){return n.executeTimeQuery(t)}))];case 6:return n=r.sent(),[4,this._reschedule((function(){return n.executeAttributesQuery(t)}))];case 7:return n=r.sent(),[4,this._reschedule((function(){return n.filterLatest()}))];case 8:return n=r.sent(),[3,10];case 9:if((u=r.sent())!==b.QUERY_ENGINE_EMPTY_RESULT)throw u;return n=new g.default([],null,this),[3,10];case 10:return[2,n.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new g.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,s,u,a,o,c,l,h,f,d,y,m,_,x,b,I,F,S,Q=this;return r.__generator(this,(function(w){switch(w.label){case 0:if(t=e.geometry,i=e.outSR,s=e.spatialRel,u=p.isValid(i)&&!p.equals(this.spatialReference,i),(a=this._geometryQueryCache?u?JSON.stringify({geometry:t,spatialRelationship:s,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:s}):null)&&(o=this._geometryQueryCache.get(a),!n.isUndefined(o)))return[2,o];if(c=function(t){return r.__awaiter(Q,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return u&&(e.returnGeometry||e.returnCentroid)?[4,t.project(i)]:[3,2];case 1:return s=r.sent(),a&&this._geometryQueryCache.put(a,s,s.size||1),[2,s];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}}))}))},!t)return[2,c(this._getAll())];if(l=this.featureAdapter,"esriSpatialRelDisjoint"!==s)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,c(this._getAll())];for(y=new Set,m=0,_=h;m<_.length;m++)x=_[m],y.add(l.getObjectId(x));return[4,this._reschedule((function(){var e=0;f=new Array(y.size),Q.featureStore.forEach((function(t){return f[e++]=t})),d=y}))];case 1:return w.sent(),[4,this._reschedule((function(){return r.__awaiter(Q,void 0,void 0,(function(){var e,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v.getSpatialQueryOperator(s,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),i=function(t){return!d.has(l.getObjectId(t))||e(l.getGeometry(t))},n=g.default.bind,[4,this._runSpatialFilter(f,i)];case 2:return[2,new(n.apply(g.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return I=w.sent(),[2,c(I)];case 3:return(b=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,c(new g.default(b,t,this))]:[4,v.getSpatialQueryOperator(s,t,this.geometryType,this.hasZ,this.hasM)]:(I=new g.default([],t,this),a&&this._geometryQueryCache.put(a,I,I.size||1),[2,I]);case 4:return F=w.sent(),[4,this._runSpatialFilter(b,(function(e){return F(l.getGeometry(e))}))];case 5:return S=w.sent(),[2,c(new g.default(S,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,s,n,u=this;return r.__generator(this,(function(a){return t?this._budget?(i=0,s=new Array,n=function(){return r.__awaiter(u,void 0,void 0,(function(){var u;return r.__generator(this,(function(r){switch(r.label){case 0:return i<e.length?(u=e[i],t(u)&&s.push(u),this._budget.done?[4,this._reschedule((function(){return n()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++i,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return n()})).then((function(){return s}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return v.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(v.canQueryWithRBush(e)){if(d.isExtent(e))return[h.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(d.isPolygon(e))return e.rings.map((function(e){return h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[f.getBoundsXY(h.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,(function(e){S.add(e)}))}var s=new Array(S.size),n=0;return S.forEach((function(e){return s[n++]=e})),S.clear(),s},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,a.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),v.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),m.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,s=e.returnDistinctValues,n=e.outStatistics,u=n?n.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var a=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===u.indexOf(e)}));y.validateFields(this.fieldsIndex,a,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(s)throw new i("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,s,n,u,a,o,c,l,h,f,d;return r.__generator(this,(function(r){if(t=e.outStatistics,s=e.groupByFieldsForStatistics,n=e.having,u=s&&s.length,a=t&&t.length,n){if(!u||!a)throw new i("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,n,t)}if(a){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(o=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,o,"onStatisticFields contains missing fields"),u&&y.validateFields(this.fieldsIndex,s,"groupByFieldsForStatistics contains missing fields"),c=0,l=t;c<l.length;c++)if(h=l[c],f=h.onStatisticField,"percentile_disc"!==(d=h.statisticType)&&"percentile_cont"!==d||!("statisticParameters"in h)){if("count"!==d&&f&&y.hasInvalidFieldType(f,this.fieldsIndex))throw new i("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}else if(!h.statisticParameters)throw new i("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:h,query:e})}return[2]}))}))},e}();t.default=R;var E=l.create(),T=l.create()}.apply(null,i))||(e.exports=s)},383:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(153)],void 0===(s=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,i){return t._tasks.push(new s(r,i,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,i){return t._tasks.unshift(new s(r,i,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._tasks;t<i.length;t++)i[t].reject(e);this._tasks.length=0},e}();t.default=i;var s=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,i))||(e.exports=s)},558:function(e,t,r){var i,s;i=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=s)},719:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(117),r(210),r(152),r(153),r(198),r(521),r(178),r(243),r(720),r(363),r(263),r(512),r(315)],void 0===(s=function(e,t,r,i,s,n,u,a,o,c,l,h,f,d,p){function y(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function m(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function _(e,t,r){return r?t-e:e-t}function g(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var s=new Date(e).getTime(),n=new Date(t).getTime();if(!isNaN(s)&&!isNaN(n))return _(s,n,i)}return"number"==typeof e&&"number"==typeof t?_(e,t,i):"string"==typeof e&&"string"==typeof t?(s=e.toUpperCase(),n=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?m(s,n,i):m(y(s),y(n),i)):i?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(o.isValid(e.outSR)&&!o.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},f.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=h.getWhereClause(t.where,this.fieldsIndex);if(!r)return n.resolve(this);if(r.isStandardized){for(var i=0,s=[],u=0,a=this.items;u<a.length;u++){var o=a[u];r.testFeature(o,this.featureAdapter)&&(s[i++]=o)}var c=new e(s,this.queryGeometry,this);return c.definitionExpression=t.where,n.resolve(c)}return n.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return n.resolve(this);var r=u.SetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return n.resolve(new e(this.items.filter((function(e){return r.has(i(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=d.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!s.isSome(r))return n.resolve(this);var i=this.items.filter(r);return n.resolve(new e(i,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,s=t.startTimeField,u=t.endTimeField||s,a=new Map,o=this.featureAdapter.getAttribute,c=0,l=this.items;c<l.length;c++){var h=l[c],f=o(h,r),d=o(h,u),p=a.get(f);(!p||d>o(p,u))&&a.set(f,h)}var y=i.valuesOfMap(a);return n.resolve(new e(y,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var i,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||o.equals(this.spatialReference,t)?[2,this]:(i=this.featureAdapter,[4,f.projectMany(this.items.map((function(e){return p.getGeometry(s.geometryType,s.hasZ,s.hasM,i.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return i.cloneWithGeometry(s.items[t],c.convertFromGeometry(e,s.hasZ,s.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var i=function(t){var i=t.split(" "),n=i[0],u=s.fieldsIndex.get(n),a=i[1]&&"desc"===i[1].toLowerCase();e.sort((function(e,t){return g(r(e,n,u),r(t,n,u),u,a)}))},s=this,n=0,u=t.reverse();n<u.length;n++)i(u[n])},e.prototype._createFeatureQueryResponse=function(e){var t=this,i=this.items,s=this,n=s.geometryType,u=s.hasM,o=s.hasZ,c=s.objectIdField,l=s.spatialReference,h=e.outFields,f=e.outSR,d=e.quantizationParameters,y=e.resultRecordCount,m=e.resultOffset,_=e.returnZ,g=e.returnM,v=!1;if(null!=y&&null!=m){var x=m+y;v=i.length>x,i=i.slice(m,Math.min(i.length,x))}var b=h&&(h.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):h.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:v,features:this._createFeatures(e,i),fields:b,geometryType:n,hasM:u&&g,hasZ:o&&_,objectIdFieldName:c,spatialReference:p.cleanFromGeometryEngine(f||l),transform:d&&a.toQuantizationTransform(d)||null}},e.prototype._createFeatures=function(e,t){var r=new l.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,s=this.hasZ,n=e.orderByFields,u=e.quantizationParameters,o=e.returnGeometry,c=e.returnCentroid,h=e.maxAllowableOffset,f=e.returnZ,d=void 0!==f&&f,y=e.returnM,m=s&&d,_=i&&void 0!==y&&y,g=[],v=0;if(o||c){var x=a.toQuantizationTransform(u);if(o&&!c)for(var b=0,I=t;b<I.length;b++)T=I[b],g[v++]={attributes:r.getAttributes(T),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(T),h,x,m,_)};else if(!o&&c)for(var F=0,S=t;F<S.length;F++)T=S[F],g[v++]={attributes:r.getAttributes(T),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(T,this),x)};else for(var Q=0,w=t;Q<w.length;Q++)T=w[Q],g[v++]={attributes:r.getAttributes(T),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(T,this),x),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(T),h,x,m,_)}}else for(var R=0,E=t;R<E.length;R++){var T=E[R],A=r.getAttributes(T);A&&(g[v++]={attributes:A})}return this._sortFeatures(g,n,(function(e,t,i){return r.getFieldValue(e,t,i)})),g},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=0,u=e.outStatistics;n<u.length;n++){var a=u[n];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var o=this.hasZ?this.hasM?4:3:this.hasM?3:2,c=this.featureAdapter;t=this.items.reduce((function(e,t){var r=c.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/o>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},s=[],n=new Map,u=new Map,a=new Map,o=new Map,c=new l.default(e,this.featureAdapter,this.fieldsIndex),h=e.outStatistics,f=e.groupByFieldsForStatistics,d=e.having,p=e.orderByFields,y=f&&f.length,m=!!y,_=m&&f[0],g=m&&!this.fieldsIndex.get(_),v=0,x=h;v<x.length;v++){var b=x[v],I=b.outStatisticFieldName,F=b.statisticType,S=b,Q="exceedslimit"!==F?b.onStatisticField:void 0,w="percentile_disc"===F||"percentile_cont"===F,R=m&&1===y&&(Q===_||g)&&"count"===F;if(m){if(!a.has(Q)){for(var E=[],T=0,A=f;T<A.length;T++){var C=A[T],M=this._getAttributeValues(c,C,n);E.push(M)}a.set(Q,this._calculateUniqueValues(E))}var P=a.get(Q),G=function(e){var r=P[e],i=r.count,s=r.data,u=r.items,a=r.itemPositions,l=s.join(",");if(!d||c.validateItems(u,d)){var h=o.get(l)||{attributes:{}},p=null;if(R)p=i;else{var y=N._getAttributeValues(c,Q,n),m=a.map((function(e){return y[e]}));p=w&&"statisticParameters"in S?N._getPercentileValue(S,m):N._getStatisticValue(S,m)}h.attributes[I]=p,f.forEach((function(e,r){return h.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=s[r]})),o.set(l,h)}},N=this;for(var j in P)G(j)}else M=this._getAttributeValues(c,Q,n),r.attributes[I]=w&&"statisticParameters"in S?this._getPercentileValue(S,M):this._getStatisticValue(S,M,u);s.push({name:I,alias:I,type:"esriFieldTypeDouble"})}var O=m?i.valuesOfMap(o):[r];return this._sortFeatures(O,p,(function(e,t){return e.attributes[t]})),{fields:s,features:O}},e.prototype._getStatisticValue=function(e,t,r){var i=e.onStatisticField,s=e.statisticType,n=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,n),n["var"===s?"variance":s]},e.prototype._getPercentileValue=function(e,t){var i=e.onStatisticField,s=e.statisticParameters,n=e.statisticType,u=s.value,a="desc"===s.orderBy,o=this.fieldsIndex.get(i),c=r.__spreadArrays(t).sort((function(e,t){return g(e,t,o,a)}));return this._calculatePercentile(c,u,"percentile_disc"===n)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),s=this.items.map((function(r){return e.getFieldValue(r,t,i)}));return r.set(t,s),s},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,s=null,n=null,u=null,a=[],o=0,c=0,l=e;c<l.length;c++)"string"==typeof(p=l[c])?o++:null==p||isNaN(p)||(i+=p,t=Math.min(t,p),r=Math.max(r,p),a.push(p),o++);if(o){s=i/o;for(var h=0,f=0,d=a;f<d.length;f++){var p=d[f];h+=Math.pow(p-s,2)}u=o>1?h/(o-1):0,n=Math.sqrt(u)}else t=null,r=null;return{avg:s,count:o,max:r,min:t,stddev:n,sum:i,variance:u}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,i=r.length,s=0;s<i;s++){for(var n=r[s],u=[],a=0,o=e;a<o.length;a++){var c=o[a];u.push(c[s])}var l=u.join(",");null==t[l]?t[l]={count:1,data:u,items:[n],itemPositions:[s]}:(t[l].count++,t[l].items.push(n),t[l].itemPositions.push(s))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,s=Math.floor(i),n=s+1,u=i%1,a=e[s],o=e[n];return n>=e.length||r||"string"==typeof a||"string"==typeof o?a:a*(1-u)+o*u},e}();t.default=v}.apply(null,i))||(e.exports=s)},720:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(152),r(363)],void 0===(s=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var s=e.outFields;if(s&&-1===s.indexOf("*")){this.outFields=s;for(var n=0,u=0,a=s;u<a.length;u++){var o=a[u],c=i.getExpressionFromFieldName(o),l=this.fieldsIndex.get(c),h=l?null:i.getWhereClause(c,r),f=l?l.name:i.getAliasFromFieldName(o)||"FIELD_EXP_"+n++;this._fieldDataCache.set(o,{alias:f,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var s=r?r.name:t,n=null;return this._fieldDataCache.has(s)?n=this._fieldDataCache.get(s).clause:r||(n=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:n})),r?this.featureAdapter.getAttribute(e,s):n.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,s=t;i<s.length;i++){var n=s[i],u=this._fieldDataCache.get(n),a=u.alias,o=u.clause;r[a]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var s=0,n=t;s<n.length;s++){var u=n[s],a=this._fieldDataCache.get(u).alias;i.push(e[a])}else for(var a in e)i.push(e[a]);var o=(t||["*"]).join(",")+"="+i.join(","),c=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++c),c>1?null:e},e}();t.default=s}.apply(null,i))||(e.exports=s)}}]);
//# sourceMappingURL=10.js.map