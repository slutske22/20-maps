(function(){var e={"esri/tasks/support/FeatureSet":187,"esri/views/layers/support/FeatureFilter":334,"esri/views/3d/layers/support/projectExtentUtils":364,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":468,"esri/views/3d/layers/graphics/ExtentSet":469,"esri/views/3d/layers/graphics/Graphics3DObjectStates":470,"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":471,"esri/views/3d/layers/support/attributeUtils":472,"esri/views/3d/layers/graphics/QueryEngine":514,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":567,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":725,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":726,"esri/layers/graphics/controllers/FeatureTileController3D":840,"esri/views/3d/layers/support/FeatureTileFetcher3D":841,"esri/views/3d/layers/support/featureReference":1058,"esri/views/3d/layers/support/FeatureTile":1059,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":1060,"esri/views/3d/layers/FeatureLikeLayerView3D":1061,"esri/views/3d/layers/StreamLayerView3D":2156,"esri/views/layers/StreamLayerView":2157},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49,32,188],{1058:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(207)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;s.oldVersion=i,this.feature&&(e.uid=this.feature.uid);for(var n=0,a=this.versions;n<a.length;n++){var o=a[n];if(o.resolution===t){o.refCount++;var u=this.highestResolutionVersion===o&&!r.equals(e,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=e),s.newVersion=u?e:i,s}}var l={feature:e,resolution:t,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(s.newVersion=e,this.highestResolutionVersion=l):s.newVersion=i,s},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,s.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),s.oldVersion=r.feature)),s.newVersion=this.feature,s}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var n=function(){function e(e){this._feature=e,this.refCount=1}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return++this.refCount,s.oldVersion=this._feature,this.feature&&(e.uid=this.feature.uid),r.equals(this._feature,e)||(this._feature=e),s.newVersion=this._feature,s},e.prototype.unref=function(){return s.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(s.newVersion=null,s):(s.newVersion=this._feature,s)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var s={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=n)},1059:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(180),r(152),r(173),r(207)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new Set,o=function(){function e(e){this.descriptor=e,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=u,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=a,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t,r){this._availableFields=i.unwrapOr(r,a),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+s.numVertices(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=s.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=s.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),e.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0},Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(n.fromExtent(e,l),n.intersects(this.descriptor.extent,l))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(n.fromExtent(e,t),this.descriptor.extent&&n.intersection(t,this.descriptor.extent,t)):n.set(t,this.descriptor.extent),t):(n.set(t,n.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort((function(t,r){return s.getObjectId(t,e)-s.getObjectId(r,e)})),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t,r){if(e<=0)return!1;var i=!1;if(this._features){this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,i=!0)),!this._shuffled&&e<1&&this._shuffle(r);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))}else this.featureLimit=0;return i},Object.defineProperty(e.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},enumerable:!0,configurable:!0}),e}();t.FeatureTile=o;var u=-1;t.FAILED_FEATURE_COUNT=-2;var l=n.create()}.apply(null,i))||(e.exports=n)},1060:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(174),r(232),r(430),r(522),r(523),r(432),r(588)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map((function(e){return new a(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new a(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,n=[];e.forEach((function(e,r){var s=i.tileFetcher.test.getFeatureTileById(r);s&&t.filter(s)||(i.view.graphics.removeMany(e),n.push(r))})),n.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(n){if(t.filter(n)&&!e.has(n.id)){var a=n.descriptor.lij,u=a[0],l=a[1],c=a[2];i.tilingScheme.ensureMaxLod(u);var p=i.tilingScheme.getExtentGeometry(u,l,c),h=[new r({geometry:p,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:p.center,symbol:new s({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,h),i.view.graphics.addMany(h)}}))},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,i))||(e.exports=n)},1061:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(152),r(153),r(157),r(151),r(207),r(840),r(656),r(199),r(725),r(514),r(364),r(211)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLikeLayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.asyncGraphicsUpdates=!1,t.suspendResumeExtentMode="computed",t.slicePlaneEnabled=!1,t.drapeSourceType=1,t.fullExtentInLocalViewSpatialReference=null,t.suspendResumeExtent=null,t._controllerCreated=!1,t.clippingExtent=null,t.supportsHeightUnitConversion=!0,t.pendingController=null,t.queryEngine=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(s.reject(new i("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this._set("graphics3d",new h.default({owner:this,layer:t,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",(function(t){e.graphics3d.graphicsCore.preferredUpdatePolicy=t?1:0})),this.updatingHandles.add(this,"suspendResumeExtentMode",(function(t){e.graphics3d.suspendResumeExtentMode=t})),this.addResolvingPromise(this.graphics3d.setup().then((function(){return e.validateGeometryType()})).then((function(){return e.queryEngine=new d.default({layerView:e,task:y.Task.FEATURE_QUERY_ENGINE})})).then((function(){return f.toViewIfLocal(e)})).then((function(t){return e.fullExtentInLocalViewSpatialReference=t})).then((function(){return e.initializeController()}))),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},t.prototype.notifyGraphicUpdate=function(e,t){this.graphics3d.graphicsCore.notifyGraphicUpdate(e,t)},t.prototype.getRenderingInfo=function(e,t,r){var i=c.getRenderingInfo(e,{renderer:t,arcade:r});if(i&&i.color){var n=i.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return i},t.prototype.getRenderingInfoAsync=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(s){return[2,c.getRenderingInfoAsync(e,r.__assign({renderer:t,arcade:i},n))]}))}))},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach((function(i){i.uid===e&&(r=u.hydrateGraphic(i,t.layer))})),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.computeAttachmentOrigin=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null},t.prototype.getSymbolLayerSize=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null},t.prototype.queryFeatures=function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryObjectIds=function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryFeatureCount=function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryExtent=function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),n.get(t,"signal"))},t.prototype._ensureQuery=function(e){return n.isNone(e)?this.createQuery():p.from(e)},t.prototype.highlight=function(e){return this.graphics3d.highlight(e,this.layer.objectIdField)},t.prototype.canResume=function(){return!(!e.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.getSuspendInfo=function(){var t=e.prototype.getSuspendInfo.call(this);return this.graphics3d?r.__assign(r.__assign({},t),this.graphics3d.suspendInfo):t},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed||!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)},t.prototype.initializeController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}}))}))},t.prototype.setControllerWhenInitialized=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,a.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}}))}))},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return s.reject(new i("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}},t.prototype._getResourceInfo=function(){var e=this.controller&&this.controller instanceof l?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},enumerable:!0,configurable:!0}),r.__decorate([o.property()],t.prototype,"loadedGraphics",void 0),r.__decorate([o.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),r.__decorate([o.property({dependsOn:["graphics3d.updating","controller.updating"]})],t.prototype,"updating",void 0),r.__decorate([o.property()],t.prototype,"controller",void 0),r.__decorate([o.property()],t.prototype,"graphics3d",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([o.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],t.prototype,"suspendInfo",void 0),r.__decorate([o.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r.__decorate([o.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(e)}}.apply(null,i))||(e.exports=n)},187:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(174),r(166),r(155),r(152),r(151),r(170),r(163),r(194)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p){var h=new s.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),d=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return r.__extends(t,e),t.prototype.readFeatures=function(e,t){for(var r=l.fromJSON(t.spatialReference),i=[],s=0;s<e.length;s++){var a=e[s],u=n.fromJSON(a),c=a.geometry&&a.geometry.spatialReference;o.isSome(u.geometry)&&!c&&(u.geometry.spatialReference=r),i.push(u)}return i},t.prototype.writeGeometryType=function(e,t,r,i){if(e)h.write(e,t,r,i);else{var n=this.features;if(n)for(var s=0,a=n;s<a.length;s++){var u=a[s];if(u&&o.isSome(u.geometry))return void h.write(u.geometry.type,t,r,i)}}},t.prototype.writeSpatialReference=function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r)for(var i=0,n=r;i<n.length;i++){var s=n[i];s&&o.isSome(s.geometry)&&s.geometry.spatialReference&&(t.spatialReference=s.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var i=t.features[r];if(i.geometry){var n=e&&e[r];i.geometry=n&&n.toJSON()||i.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],i=t[1],n=e.translate,s=n[0],a=n[1],u=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-s)/r)}),(function(e){return Math.round((a-e)/i)})),c=0,p=u.length;c<p;c++)l(o.unwrap(u[c].geometry))||(u.splice(c,1),c--,p--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;for(var i=r.translate,n=i[0],s=i[1],a=r.scale,u=a[0],l=a[1],c=this._getHydrationFunction(e,(function(e){return e*u+n}),(function(e){return s-e*l})),p=0,h=t;p<h.length;p++){var d=h[p].geometry;o.isSome(d)&&c(d)}return this},t.prototype._quantizePoints=function(e,t,r){for(var i,n,s=[],a=0,o=e.length;a<o;a++){var u=e[a];if(a>0){var l=t(u[0]),c=r(u[1]);l===i&&c===n||(s.push([l-i,c-n]),i=l,n=c)}else i=t(u[0]),n=r(u[1]),s.push([i,n])}return s.length>0?s:null},t.prototype._getQuantizationFunction=function(e,t,r){var i=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var n=c.isPolygon(e)?e.rings:e.paths,s=[],a=0,o=n.length;a<o;a++){var u=n[a],l=i._quantizePoints(u,t,r);l&&s.push(l)}return s.length>0?(c.isPolygon(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?function(e){var n;return(n=i._quantizePoints(e.points,t,r)).length>0?(e.points=n,e):null}:"extent"===e?function(e){return e}:null},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var i,n,s=c.isPolygon(e)?e.rings:e.paths,a=0,o=s.length;a<o;a++)for(var u=s[a],l=0,p=u.length;l<p;l++){var h=u[l];l>0?(i+=h[0],n+=h[1]):(i=h[0],n=h[1]),h[0]=t(i),h[1]=r(n)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var i,n,s=e.points,a=0,o=s.length;a<o;a++){var u=s[a];a>0?(i+=u[0],n+=u[1]):(i=u[0],n=u[1]),u[0]=t(i),u[1]=r(n)}}:void 0},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r.__decorate([u.property({type:[n],json:{write:!0}})],t.prototype,"features",void 0),r.__decorate([u.reader("features")],t.prototype,"readFeatures",null),r.__decorate([u.property({type:[p],json:{write:!0}})],t.prototype,"fields",void 0),r.__decorate([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:h.read}}})],t.prototype,"geometryType",void 0),r.__decorate([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r.__decorate([u.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r.__decorate([u.property({type:l,json:{write:!0}})],t.prototype,"spatialReference",void 0),r.__decorate([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r.__decorate([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r.__decorate([u.subclass("esri.tasks.support.FeatureSet")],t)}(a.JSONSupport);return d.prototype.toJSON.isDefaultToJSON=!0,d||(d={}),d}.apply(null,i))||(e.exports=n)},2156:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(152),r(151),r(199),r(1061),r(308),r(218),r(2157),r(161)],void 0===(n=function(e,t,i,n,s,a,o,u,l,c,p){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.asyncGraphicsUpdates=!0,t.hasZ=!0,t.hasM=!1,t}return i.__extends(t,e),Object.defineProperty(t.prototype,"connectionError",{get:function(){var e=this.get("controller.connection.errorString");if(e)return new n("stream-controller",e)},enumerable:!0,configurable:!0}),t.prototype.createQuery=function(){return new o({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})},t.prototype.queryLatestObservations=function(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),s.get(t,"signal"))},t.prototype.createController=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(e,t){Promise.all([r.e(1),r.e(56)]).then(function(){var t=[r(2286)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return e=i.sent().default,[4,(t=new e({layer:this.layer,layerView:this})).when()];case 2:return i.sent(),[2,t]}}))}))},i.__decorate([a.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),i.__decorate([a.property({dependsOn:["controller.connection.errorString"],readOnly:!0})],t.prototype,"connectionError",null),i.__decorate([a.property()],t.prototype,"controller",void 0),i.__decorate([a.property({readOnly:!0})],t.prototype,"hasZ",void 0),i.__decorate([a.property({readOnly:!0})],t.prototype,"hasM",void 0),i.__decorate([a.subclass("esri.views.3d.layers.StreamLayerView3D")],t)}(p.StreamLayerView(u.FeatureLikeLayerView3D(l.LayerView3D(c))))}.apply(null,i))||(e.exports=n)},2157:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(151),r(334)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.StreamLayerView=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.connectionError=null,i.connectionStatus="disconnected",i.filter=null,i}return r.__extends(t,e),r.__decorate([i.property({readOnly:!0})],t.prototype,"connectionError",void 0),r.__decorate([i.property({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),r.__decorate([i.property({type:n})],t.prototype,"filter",void 0),r.__decorate([i.subclass("esri.layers.mixins.StreamLayerView")],t)}(e)}}.apply(null,i))||(e.exports=n)},334:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(282),r(166),r(155),r(118),r(198),r(151),r(163),r(199)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p){var h=new s.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),d=new s.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.where=null,r.geometry=null,r.spatialRelationship="intersects",r.hiddenIds=new Set,r.distance=void 0,r.objectIds=null,r.units=null,r.timeExtent=null,r.enabled=!1,r}var s;return r.__extends(t,e),s=t,t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.enable=function(){this._set("enabled",!0)},t.prototype.createQuery=function(e){void 0===e&&(e={});var t=this,i=t.where,n=t.geometry,s=t.spatialRelationship,a=t.timeExtent,u=t.objectIds,l=t.units,c=t.distance;return new p(r.__assign({geometry:o.clone(n),objectIds:o.clone(u),spatialRelationship:s,timeExtent:o.clone(a),where:i,units:l,distance:c},e))},t.prototype.clone=function(){var e=this,t=e.where,r=e.geometry,i=e.spatialRelationship,n=e.hiddenIds,a=e.timeExtent,u=e.objectIds,l=e.units,c=e.distance,p=new Set;return n.forEach((function(e){return p.add(e)})),new s({geometry:o.clone(r),hiddenIds:p,objectIds:o.clone(u),spatialRelationship:i,timeExtent:o.clone(a),where:t,units:l,distance:c})},r.__decorate([l.property({type:String})],t.prototype,"where",void 0),r.__decorate([l.writer("where")],t.prototype,"writeWhere",null),r.__decorate([l.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r.__decorate([l.property({type:String,json:{read:{source:"spatialRel",reader:h.read},write:{target:"spatialRel",writer:h.write}}})],t.prototype,"spatialRelationship",void 0),r.__decorate([l.property({json:{write:function(e,t,r){return t[r]=u.valuesOfSet(e)},read:function(e){return u.SetFromValues(e)}}})],t.prototype,"hiddenIds",void 0),r.__decorate([l.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),r.__decorate([l.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),r.__decorate([l.property({type:String,json:{read:d.read,write:{writer:d.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),r.__decorate([l.property({type:n,json:{write:!0}})],t.prototype,"timeExtent",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"enabled",void 0),s=r.__decorate([l.subclass("esri.views.layers.support.FeatureFilter")],t)}(a.JSONSupport)}.apply(null,i))||(e.exports=n)},364:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(153),r(197),r(359)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,s=e.layer.fullExtent,a=s&&s.spatialReference;return a?a.equals(t)?r.resolve(s.clone()):i.canProject(a,t)?r.resolve(i.project(s,t)):e.view.state.isLocal?n.projectGeometry(s,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},468:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(190),r(167),r(198),r(151),r(469),r(211)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new u.ExtentSet,t.globalDirty=!1,t.dirtyGraphicsSet=new Set,t.handles=new s,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new n,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var s=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",(function(e){return n.elevationUpdateHandler(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),s.registerTask(l.Task.ELEVATION_ALIGNMENT,(function(e){return n.update(e)}),(function(){return n.needsUpdate()}))])},t.prototype.destroy=function(){this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty},t.prototype.update=function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this,r=this.layerView.view,i=this.graphicsCore.stageLayer.id,n=this.layerView.labeling,s=function(){var s=Math.min(o.dirtyGraphicsSet.size,100);a.someSet(o.dirtyGraphicsSet,(function(i){var n=t.graphicsCore.getGraphics3DGraphicById(i);return t.dirtyGraphicsSet.delete(i),n&&n.alignWithElevation(t.elevationProvider,r.renderCoordsHelper,t.graphicsCore.asyncUpdates),e.madeProgress(),--s<=0||e.done})),r._stage.processDirtyLayer(i),n&&n.processStageDirty()},o=this;this.dirtyGraphicsSet.size>0&&!e.done;)s()},t.prototype._updateDirtyExtents=function(e){for(var t=this;!this.dirtyExtents.empty&&this.dirtyGraphicsSet.size<100&&!e.done;){var r=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",{extent:r,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(r,this.spatialReference,(function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,r){return e.dirtyGraphicsSet.add(r)}))},t.prototype.elevationUpdateHandler=function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent;if(this.spatialReference=e.spatialReference,this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:this.spatialReference})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}},r.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(i);t.default=c}.apply(null,i))||(e.exports=n)},469:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(214),r(173),r(211)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.extents=new r({allocator:function(e){return e||i.create()}}),this.tempExtent=i.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),i.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&this.mergeTight(),this.extents.pop()},e.prototype.merge=function(e){return this.mergeTight(e),e.hasProgressed},e.prototype.mergeTight=function(e){var t=this;void 0===e&&(e=n.noBudget);for(var r=this.extents,s=new Set,a=0;a!==r.length;){r.sort((function(e,t){return e[0]-t[0]})),a=r.length,s.clear();for(var o=function(n){if(e.done)return{value:void 0};for(var a=r.getItemAt(n),o=n+1;o<r.length;++o){var u=r.getItemAt(o);if(u[0]>=a[2])break;s.add(u)}s.forEach((function(n){if(a!==n)if(n[2]<=a[0])s.delete(n);else{var o=i.area(a),u=i.area(n),l=t.tempExtent;i.expand(a,n,l);var c=o+u;(i.area(l)-c)/c<.05&&(i.set(a,l),s.delete(n),r.remove(n),e.madeProgress())}})),s.add(a)},u=0;u<r.length;++u){var l=o(u);if("object"==typeof l)return l.value}}this.dirty=!1},e.prototype.contains=function(e){return this.extents.some((function(t){return i.contains(t,e)}))},e.prototype.removeContained=function(e){this.extents.filterInPlace((function(t){return!i.contains(e,t)}))},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{containsPoint:function(t){return e.extents.some((function(e){return i.containsPoint(e,t)}))}}},enumerable:!0,configurable:!0}),e}();t.ExtentSet=s}.apply(null,i))||(e.exports=n)},470:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(471)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._graphicsCore=e,this._stateSets=new Array}return e.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null},e.prototype.acquireSet=function(e,t){var i=this,n=new r.Graphics3DObjectStateSet(e,t);this._stateSets.push(n);var s={remove:function(){return i.releaseSet(n)},pause:function(){n.objectStateSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,i.initializeSet(n)}};return{set:n,handle:s}},e.prototype.releaseSet=function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)},e.prototype._addObjectStateSet=function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)},e.prototype._removeObjectStateSet=function(e,t){e.removeObjectState(t.objectStateSet)},e.prototype.setUid=function(e,t){e.ids.add(t);var r=this._graphicsCore.graphics3DGraphics.get(t);r&&this._addObjectStateSet(r,e)},e.prototype.setUids=function(e,t){var r=this;t.forEach((function(t){return r.setUid(e,t)}))},e.prototype.setObjectIds=function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)},e.prototype.addGraphic=function(e){var t=this;this._stateSets.forEach((function(r){!r.paused&&r.hasGraphic(e)&&t._addObjectStateSet(e,r)}))},e.prototype.removeGraphic=function(e){var t=this;this._stateSets.forEach((function(r){r.hasGraphic(e)&&t._removeObjectStateSet(e,r)}))},e.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))},e.prototype.initializeSet=function(e){var t=this,r=this._graphicsCore.graphics3DGraphics;e.objectIdField?r.forEach((function(r){r&&e.hasGraphic(r)&&t._addObjectStateSet(r,e)})):e.ids.forEach((function(i){var n=r.get(i);n&&t._addObjectStateSet(n,e)}))},Object.defineProperty(e.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0}),e}();t.Graphics3DObjectStates=i}.apply(null,i))||(e.exports=n)},471:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(445)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new r.Object3DStateSet,this.ids=new Set,this.paused=!1}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}();t.Graphics3DObjectStateSet=i}.apply(null,i))||(e.exports=n)},472:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(s.toLowerCase()===r)return e[s]}return null}}.apply(null,i))||(e.exports=n)},514:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(158),r(152),r(151),r(184),r(302),r(187),r(199)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=u.default,h=function(e){function t(t){var r=e.call(this,t)||this;return r._dataQueryEngineInstance=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new c({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForExtent=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),n=i.count,s=i.extent,a=o.fromJSON(s),[2,{count:n,extent:a}]}}))}))},t.prototype.executeQueryForIds=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForLatestObservations=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype._ensureQueryJSON=function(e){return s.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,r=i.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),n=this.layer.fields.map((function(e){return e.toJSON()})),s=this.layerView.view.resourceController.scheduler,a=this.task,o=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,c=l.hasZ,h=l.hasM;return this._dataQueryEngineInstance=new p({hasZ:c,hasM:h,geometryType:r,fields:n,timeInfo:e,spatialReference:o,objectIdField:t,featureStore:u,scheduler:s,task:a}),this._dataQueryEngineInstance},r.__decorate([a.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"task",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),r.__decorate([a.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r.__decorate([a.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(n);t.QueryEngine=h,t.default=h}.apply(null,i))||(e.exports=n)},567:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(238),r(661),r(211)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){var c=-.3*o.earthRadius;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suspended=!1,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new n,t.layerView=null,t.updating=!0,t}return r.__extends(t,e),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",(function(){return t.viewChange()})),r.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(l.Task.FRUSTUM_VISIBILITY,(function(){return t.update()}),(function(){return t.updating})),i.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([s.init(i,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),s.init(r,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype._setDirty=function(){this.updating||this._set("updating",!0)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()},t.prototype.viewChange=function(){this._setDirty()},t.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.updateIsVisibleBelowSurface=function(){var e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.isOpaque()||i},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=c;else{var r=t.basemapTerrain.elevationBounds,i=r.min,n=r.max;e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r.__decorate([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(i)}.apply(null,i))||(e.exports=n)},725:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(174),r(158),r(177),r(167),r(153),r(157),r(151),r(435),r(197),r(199),r(542),r(565),r(468),r(726),r(567),r(470),r(566),r(262),r(472),r(388)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b,F,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new a,r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendInfo",{get:function(){var e={};return this.scaleVisibility&&this.scaleVisibility.suspended&&(e.outsideScaleRange=!0),this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new m:null,r=e.scaleVisibilityEnabled?new _:null,i=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new g.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new y.default:null;return{graphicsCore:new f.Graphics3DCore({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:r,filterVisibility:i,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,r){c.diff(t,r)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,r){c.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,i=function(e,t,r){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(n=e.view.elevationProvider,this.elevationAlignment.setup(e,i,this.graphicsCore,n)),this._set("objectStates",new v.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,o.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return r.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return s.watchUpdatingTracking.addPromise(s.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(e,"fullOpacity",(function(){return s.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(e.view,"clippingArea",(function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,o.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t){var r=this;if(e instanceof h){var n=this.objectStates.acquireSet(0,t),s=n.set,a=n.handle;return this.owner.queryObjectIds(e).then((function(e){return r.objectStates.setObjectIds(s,e)})),a}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof i)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof i){var o=e;if(!t||!o[0].attributes||null===F.attributeLookup(o[0].attributes,t)){var u=o.map((function(e){return e.uid})),l=this.objectStates.acquireSet(0,null),c=l.set;return a=l.handle,this.objectStates.setUids(c,u),a}e=o.map((function(e){return F.attributeLookup(e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var p=e,d=this.objectStates.acquireSet(0,t);return c=d.set,a=d.handle,this.objectStates.setObjectIds(c,p),a}}return S},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(u.init(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(E),e.suspendResumeExtentMode){case"computed":e._handles.add(u.init(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;case"data":e._handles.add(u.init(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;default:s.neverReached(e.suspendResumeExtentMode)}})))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!p.canProject(e,r))return;e=p.project(e,r)}return b.enlargeExtent(e,t,d.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r.__decorate([l.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r.__decorate([l.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"labeling",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"objectStates",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([l.property()],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([l.property()],t.prototype,"dataExtent",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspendInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(n);t.default=w;var E="suspendResumeExtentMode",S={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,i))||(e.exports=n)},726:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(167),r(156),r(152),r(153),r(157),r(151),r(514),r(334),r(211)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h){Object.defineProperty(t,"__esModule",{value:!0});var d=s.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),f=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.filter=null,i._dirty=!1,i._querying=!1,i._handles=new n,i}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new c.default({layerView:this._layerView,task:h.Task.FILTER_VISIBILITY});var i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(h.Task.FILTER_VISIBILITY,(function(e){return r._update(e)}),(function(){return r._needsUpdate()}))),this._handles.add(u.on(t.owner,"loadedGraphics","after-changes",(function(e){return r._graphicsChanged(e)}),(function(){return r.dirty=!0}))),this.filterChanged()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var r=a.isSome(e)?e.clone():new p;return r.timeExtent=r.timeExtent?r.timeExtent.intersection(t):t,r},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){o.isAbortError(e)||(d.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),r.__decorate([l.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(i);t.Graphics3DFilterVisibility=f}.apply(null,i))||(e.exports=n)},840:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(226),r(169),r(177),r(154),r(167),r(118),r(156),r(152),r(303),r(153),r(157),r(151),r(324),r(359),r(485),r(841),r(1060),r(261),r(388)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b,F,x){var w=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),E=function(e){function t(t){var r=e.call(this,t)||this;return r.type="feature-tile-3d",r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.serviceDataExtent=null,r.serviceDataCount=i.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new u,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=d.createAbortController(),r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else w.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===i.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,n=r&&r.featureTiles,s=n&&n.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&s){var a=this.approximateExtentSizeAtScale(t.minScale,s);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>i.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new s([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add(this,"mode",(function(){return e.modeChanged()}),2);var t=d.resolve().then((function(){return e.verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())})).then((function(){return e.initializeTileFetcher()}));this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new o("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.restart=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.refetch=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,r=f.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then((function(){var r=e,i=r.layerView,n=r.tileDescriptors,s=i.layer;e.tileFetcher=new _.FeatureTileFetcher3D({context:e.context,filterExtent:e.filteredDataExtent,tileDescriptors:n,features:e.graphics}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var a=e.layerView.view.resourceController;a&&(e.handles.add(a.memoryController.events.on("quality-changed",(function(t){e.tileFetcher.memoryFactor=t}))),e.tileFetcher.memoryFactor=a.memoryController.memoryFactor);var o="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;o&&e.handles.add(f.init(e.layerView.view,"qualitySettings.graphics3D."+o,(function(t){e.tileFetcher.lodFactor=t||1}))),e.watchUpdatingTracking.add(s,"createQueryVersion",(function(){return e.dataFilterChanged()})),e.watchUpdatingTracking.add(i,"availableFields",(function(t,r){return e.availableFieldsChanged(r,t)})),e.watchUpdatingTracking.add(i,"requiredFields",(function(t,r){return e.requiredFieldsChanged(r,t)})),e.handles.add([s.on("apply-edits",(function(t){return e.applyEdits(t)})),e.watch("filteredDataExtent",(function(t){return e.tileFetcher.filterExtent=t}),!0),e.watch("tileDescriptors",(function(t){return e.tileFetcher.tileDescriptors=t}),!0),f.init(e,"maximumNumberOfFeatures",(function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t}),!0),f.init(e,"serviceDataCount",(function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures}),!0),f.init(F,"FEATURE_TILE_FETCH_SHOW_TILES",(function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new b.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)}))]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:w.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))}))},t.prototype.availableFieldsChanged=function(e,t){this.tileFetcher&&O(this.tileFetcher.availableFields,t)&&this.refetch()},t.prototype.requiredFieldsChanged=function(e,t){this.tileFetcher&&O(this.tileFetcher.availableFields,t)&&this.restart()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return g.isHostedAgolService(e.url);case"csv":case"geojson":case"ogc-feature":return!0;default:return void a.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),d.isAbortError(t)||this._set("serviceDataExtent",l.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}}))}))},t.prototype.tryUpdateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,a,o,u,c,p,h,d,f;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.layerView,n=t.layer,s=n.capabilities.query.supportsExtent,a=l.clone(t.fullExtentInLocalViewSpatialReference),o=n.fullExtent,u=this.fullExtentIsAccurate(),c=this.serviceDataCount,s&&c<=i.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!a||!u)&&"queryExtent"in n?(p=this.createDataInfoQuery(),[4,n.queryExtent(p,{timeout:i.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return h=r.sent(),this._set("serviceDataExtent",h.extent),[3,6];case 2:return a?(this._set("serviceDataExtent",a),[3,6]):[3,3];case 3:return o?(d="portalItem"in n?n.portalItem:null,[4,m.projectGeometry(o,t.view.spatialReference,d,e)]):[3,5];case 4:return f=r.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),r.label=6;case 6:return[2]}}))}))},t.prototype.updateServiceDataCount=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return"queryFeatureCount"in(t=this.layerView.layer)?[4,n.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))]:(a=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a),[2]);case 1:if(!0===(s=r.sent()).ok)this._set("serviceDataCount",s.value);else{if(d.isAbortError(s.error))throw s.error;a=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a)}return[2]}}))}))},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,s=this._get("vertexLimitInfo");return p.isNone(s)||s.maximumTotalNumberOfPrimitives!==r||s.primitivesPerCoordinate!==i||s.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return a.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,h,f,y,g,m,v,_,b;return r.__generator(this,(function(r){switch(r.label){case 0:return s=p.isSome(this.vertexLimitInfo)&&this.vertexLimitInfo.primitivesPerFeature<=0,a=this.minimumNumberOfVerticesForGeometry>1,o=this.layerView.layer,u=this.supportsExceedsLimitQuery,p.isNone(this.vertexLimitInfo)||!s&&!a?(this._set("vertexLimitExceeded",!1),[2]):(l=this.vertexLimitInfo,c=l.primitivesPerFeature,h=l.primitivesPerCoordinate,f=l.maximumTotalNumberOfPrimitives,0!==c&&p.isSome(e)?[4,e]:[3,2]);case 1:r.sent(),r.label=2;case 2:return y=this.serviceDataCount,m=y!==i.constants.NO_SERVICE_DATA_COUNT,g=m?Math.ceil((f-y*c)/(h||1)):Math.ceil(f/(h||1)),a&&(g=Math.min(g,S)),m&&this.minimumNumberOfVerticesForGeometry*y>g?(this._set("vertexLimitExceeded",!0),[2]):u?[4,n.result(o.queryFeatures(this.createVertexLimitExceededQuery(g),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>g),[2]);case 3:if(!1===(v=r.sent()).ok){if(d.isAbortError(v.error))throw v.error;return this._set("vertexLimitExceeded",!1),[2]}return _=v.value,(b=_.features[0])&&b.attributes?this._set("vertexLimitExceeded",!!b.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}}))}))},t.prototype.fetchServiceDataInfo=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s,a=this;return r.__generator(this,(function(r){return this.cancelFetchServiceDataInfo(),e=d.createAbortController(),t=e.signal,i=this.updateServiceDataCount(t),n=d.eachAlways([i,this.updateVertexLimitExceeded(i,t)]),s=n.then((function(){return a.updateServiceDataExtent(t)})).catch((function(e){d.isAbortError(e)||w.error("#fetchServiceDataInfo()",e)})).then((function(){s===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null,a.fetchDataInfoAbortController=null),e=null})),e&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=e,[2,n.then((function(){}),(function(){}))]}))}))},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),r.__decorate([y.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"graphics",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([y.property()],t.prototype,"extent",null),r.__decorate([y.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),r.__decorate([y.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([y.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),r.__decorate([y.property()],t.prototype,"displayFeatureLimit",void 0),r.__decorate([y.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([y.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),r.__decorate([y.property()],t.prototype,"tileFetcher",void 0),r.__decorate([y.property()],t.prototype,"fetchDataInfoPromise",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),i=r.__decorate([y.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(h.EsriPromiseMixin(i)),S=5e6;function O(e,t){if(!t)return!1;for(var r=0,i=t;r<i.length;r++){var n=i[r];if(!e.has(n))return!0}return!1}return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(E||(E={})),E.constants.reset(),E}.apply(null,i))||(e.exports=n)},841:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(180),r(167),r(156),r(152),r(153),r(231),r(198),r(157),r(151),r(173),r(207),r(528),r(199),r(1058),r(1059),r(454),r(211)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b){Object.defineProperty(t,"__esModule",{value:!0});var F=a.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),x=function(e){function t(t){var r=e.call(this,t)||this;return r._useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r.handles=new s,r._dirty=!1,r.featureTiles=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryFactor",{set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodFactor",{set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTileCount",{get:function(){return this._useTileCount&&o.isSome(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))F.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add(p.on(this,"tileDescriptors","change",(function(){return e.setDirty()}),(function(){return e.setDirty()}))),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?m.MultiFeatureReference:m.SingleFeatureReference;var t=this.context.scheduler;o.isSome(t)&&this.handles.add(t.registerTask(b.Task.FEATURE_TILE_FETCHER,(function(t){return e.update(t)}),(function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0}))),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.restart=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.clearTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.refetch=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e.cancelFetchTile(t)})),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=null;return this.featureTiles.forEach((function(t){t.displayingFeatures&&0!==t.displayingFeatures.length&&(o.isNone(e)?e=c.SetFromValues(n.keysOfSet(t.availableFields)):e.forEach((function(r){t.availableFields.has(r)||o.unwrap(e).delete(r)})))})),o.isSome(e)?e:new Set},enumerable:!0,configurable:!0}),t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:u.resolve(),count:0,controller:u.createAbortController()},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then((function(){return e.result.catch((function(e){if(u.isAbortError(e))throw e;return null})).then((function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,o.isSome(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e}))}));return this.pendingEdits.edits=r,this.updated(),r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach((function(e){return r.add(e.objectId)})),this.featureTiles.forEach((function(e){if(e.features){var i=e.features.filter((function(e){return!r.has(f.getObjectId(e,t.objectIdField))}));i.length!==e.features.length&&(e.setFeatures(i,0,e.availableFields),t.invalidateCounts())}}))}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=[],s=new Set,e.forEach((function(e){return n.push(e.objectId)})),t.forEach((function(e){n.push(e.objectId),s.add(e.objectId)})),0===n.length?[2]:(a=[],this.featureTiles.forEach((function(e){var t=o.applyEditsAddUpdateTile(e,n,s,i);t&&a.push(t)})),[4,u.eachAlways(a)]);case 1:return r.sent(),[2]}}))}))},t.prototype.applyEditsAddUpdateTile=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,p,h=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e.features?((s=this.createQuery(e)).resultType=void 0,s.cacheHint=!1,s.objectIds=t,[4,this.queryFeatures(s,n)]):[2];case 1:if(a=r.sent(),o=null,i.size>0&&(u=e.features.filter((function(e){return!i.has(f.getObjectId(e,h.objectIdField))}))).length!==e.features.length&&(o=u),a.features.length>0)for(o||(o=e.features.slice()),l=0,c=a.features;l<c.length;l++)p=c[l],o.push(p);return o&&(e.setFeatures(o,0,T(e.availableFields,a.fields)),this.invalidateCounts()),[2]}}))}))},t.prototype.queryFeatures=function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:j})},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&performance.now()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();if(this.markTilesNotAlive(r),e.run((function(){return t.addTiles(r,e)}))&&e.run((function(){return t.filterExtentTiles(r,e)}))&&e.run((function(){return t.removeTiles(r,e)}))&&!e.done){var i=this.sortTiles(r);e.run((function(){return t.displayTiles(i,e)}))&&e.run((function(){return t.fetchTiles(i,e)}))&&e.run((function(){return t.updateMemoryEstimates(i,e)}))||this.setDirty(),this.updated()}else this.setDirty()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach((function(i){var n=r.featureTiles.get(i.id);n?n.alive=!0:t.done||(e.push(r.addTile(i)),t.madeProgress())})),t.hasProgressed)},t.prototype.filterExtentTiles=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this.clearTile(n),t.madeProgress()))}return t.hasProgressed},t.prototype.removeTiles=function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this.removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed},t.prototype.sortTiles=function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),n=function(e){if(!t.run((function(){return function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.memoryFactor,r.objectIdField)&&r.setDirty(),r.showTile(e)}(e)})))return s.setDirty(),"break"},s=this,a=0,o=e;a<o.length&&"break"!==n(o[a]);a++);return t.hasProgressed},t.prototype.fetchTiles=function(e,t){var r=this;if(this.paused)return!1;for(var i=!1,n=function(e){if(!e.needsFetching)return"continue";var r=o.isSome(s.context.memoryCache)?s.context.memoryCache.pop(e.id):null;if(o.isSome(r))return e.cache=r,s.setDirty(),s.scheduleUpdated(),t.madeProgress(),"continue";if(s.needsNumFeatures(e)){var n=u.createAbortController(),a=s.fetchTileCount(e,n.signal);s._handleRequest(e,a,n,(function(){return e.numFeatures=v.FAILED_FEATURE_COUNT})),i=!0,t.madeProgress()}return t.done?{value:!0}:void 0},s=this,a=0,l=e;a<l.length;a++){var c=n(l[a]);if("object"==typeof c)return c.value}if(i)return t.hasProgressed;for(var p=function(e){if(e.needsFetching){var i=u.createAbortController(),n=h.fetchTile(e,i.signal);if(h._handleRequest(e,n,i,(function(t){e.setFeatures([],0,null),r.invalidateCounts(),e.featuresMissing=!1,r.context.logFetchError(F,t)})),t.madeProgress(),t.done)return{value:!0}}},h=this,d=0,f=e;d<f.length;d++){var y=p(f[d]);if("object"==typeof y)return y.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var r=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(r.setDirty(),!0)})),t.hasProgressed},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.featureTiles.forEach((function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,R),i.intersection(e,V),d.equals(R,V)||r.hideTileFeatures(i))})),this.featureTiles.forEach((function(e){return r.showTile(e)})),this.updated())},t.prototype.updated=function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var r=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",r),r){var i=0,n=0,s=0,a=0,o=0,u=0,l=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++s,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),i=t.displayingFeatures?t.displayingFeatures.length*l:0;u+=r-i}t.needsFetching?++o:t.numFeatures>0&&(++a,n+=t.numFeatures)})),o+=t;var c=0;n?(i=n,c=Math.min(o*n/a,n)):(i=s,c=o),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",i),this._set("updatingRemaining",c),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.featureTiles.forEach((function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded})),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<Math.max(0,t-e.descriptor.lij[0]))},i=0,n=0,s=0,a=e;s<a.length;s++){var o=a[s],u=o.numFeatures;i+=u,n+=u*r(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}})),this.setDirty())},t.prototype.addTile=function(e){var t=new v.FeatureTile(e);return this.featureTiles.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.featureTiles.forEach((function(i){if(i.displayingFeatures&&e!==i&&(!e.descriptor.lij||!i.descriptor.lij||_.tilesAreRelated(e.descriptor.lij,i.descriptor.lij))){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,s=i.displayingFeatures;n<s.length;n++){var a=s[n];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(f.getObjectId(a,t.objectIdField));o.ref(o.feature,r),t.numDisplayingFeatureReferences++}}})),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.removeTile=function(e){this.clearTile(e),this.featureTiles.delete(e.id)},t.prototype.resetFetchTile=function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0},t.prototype.cancelFetchTile=function(e){var t=e.requestController;o.isSome(t)&&(e.requestController=null,e.resetFetching(),t.abort())},t.prototype.fetchTileCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return i=e,[4,this.fetchCount(e,t)];case 1:return i.numFeatures=r.sent(),this.updateRatio(this.getListOfTiles()),[2,3===e.fetchStatus?1:0]}}))}))},t.prototype.fetchTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,l,c,p,h,d;return r.__generator(this,(function(r){switch(r.label){case 0:return(i=this.maximumFeaturesForTile(e))<=0?[2,S(e)]:(n=this.getMaxRecordCount(e),s=Math.ceil(i/n),w(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=i&&s>g.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((a=this.createQuery(e)).maxRecordCountFactor=Math.ceil(i/n),e.isRefetching&&e.features&&e.features.length>0&&(o=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/n),a.maxRecordCountFactor=Math.max(o+1,a.maxRecordCountFactor)),[4,this.queryFeatures(a,t)]));case 1:return u=r.sent(),l=u.features,c=u.exceededTransferLimit,p=u.fields,h=c?a.maxRecordCountFactor>=g.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=l.length<e.numFeatures||c,d=this._removeEmptyFeatures(l),e.setFeatures(l,d,O(p)),this.invalidateCounts(),[2,h]}}))}))},t.prototype.fetchCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]}))}))},t.prototype.fetchPagedTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,l,c,p,h,d,f,y;return r.__generator(this,(function(r){switch(r.label){case 0:i=0,n=0,a=0,o=this.maximumFeaturesForTile(e)-a,u=this.getMaxRecordCount(e),l=null,r.label=1;case 1:return c=this.createQuery(e),p=this.setPagingParameters(c,i,o,u),[4,this.queryFeatures(c,t)];case 2:return h=r.sent(),d=h.features,f=h.exceededTransferLimit,y=h.fields,p&&(i+=c.num),a+=d.length,n+=this._removeEmptyFeatures(d),e.featuresMissing=i<e.numFeatures||f,s=s?s.concat(d):d,l=T(l,y),e.setFeatures(s,n,l),this.invalidateCounts(),this.setDirty(),o=this.maximumFeaturesForTile(e)-a,!p||!f||o<=0?[2,f?4:5]:[3,1];case 3:return[2]}}))}))},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=d.toExtent(r,i)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor},Object.defineProperty(t.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0}),t.prototype.setResolutionParams=function(e,t){if(this.supportsResolution){var r=this.getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new y.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];f.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&e.needsFeatureCount&&!w(e)},t.prototype.getMaxRecordCount=function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this.useTileQuery(e)&&o.isSome(r)&&r>0&&this.context.capabilities.supportsResultType?r:o.isSome(i)&&i>0?i:C},t.prototype.useTileQuery=function(e){return(!w(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType},t.prototype._handleRequest=function(e,t,r,i){var n=this;e.fetchStatus=e.needsRefetching?3:2,e.requestController=r;var s=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===r&&(e.requestController=null,e.fetchStatus=4),u.isAbortError(t)?s=!0:i(t)})).then((function(){s||n.setDirty(),n.scheduleUpdated()}))},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(l.schedule((function(){e.handles.remove("scheduleUpdated"),e.updated()})),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,s=this.changes.adds,a=Math.min(e.featureLimit,t.length);e.featureLimit=a;for(var o=0;o<a;++o){var u=t[o],l=f.getObjectId(u,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var p=c.ref(u,i);p.oldVersion!==p.newVersion&&(n.removes.push(p.oldVersion),n.adds.push(p.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(u,i)),s.push(u);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,a),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,n=e.displayingFeatures;i<n.length;i++){var s=n[i],a=f.getObjectId(s,this.objectIdField),o=this.displayingFeatureReferences.get(a);if(o){var u=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(a),r.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var s=Math.min(n+I,i);this.features.addMany(t.slice(n,s)),this.features.removeMany(r.slice(n,s)),n=s}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&o.isSome(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.featureTiles.size),t=0;return this.featureTiles.forEach((function(r){return e[t++]=r})),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}},enumerable:!0,configurable:!0}),r.__decorate([h.property({constructOnly:!0})],t.prototype,"features",void 0),r.__decorate([h.property()],t.prototype,"tileDescriptors",void 0),r.__decorate([h.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([h.property({value:1})],t.prototype,"memoryFactor",null),r.__decorate([h.property({value:1})],t.prototype,"lodFactor",null),r.__decorate([h.property({dependsOn:["context"]})],t.prototype,"useTileCount",null),r.__decorate([h.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([h.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),r.__decorate([h.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),r.__decorate([h.property({readOnly:!0})],t.prototype,"totalVertices",null),r.__decorate([h.property({readOnly:!0})],t.prototype,"totalFeatures",null),r.__decorate([h.property()],t.prototype,"filterExtent",null),r.__decorate([h.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([h.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(i);function w(e){return"dummy-tile-full-extent"===e.id}function E(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function S(e){return e.setFeatures([],0,null),e.featuresMissing=!1,4}function O(e){return o.isNone(e)?new Set:c.SetFromValues(e.map((function(e){return e.name})))}function T(e,t){if(o.isNone(e)||o.isNone(t))return O(t);for(var r=new Set,i=0,n=t;i<n.length;i++){var s=n[i].name;e.has(s)&&r.add(s)}return r}t.FeatureTileFetcher3D=x,t.contextCapabilitiesFromLayer=function(e){var t=e.capabilities.query;return{supportsMultipleResolutions:E(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}};var C=2e3,R=d.create(),V=d.create(),j=6e5,I=200;t.default=x}.apply(null,i))||(e.exports=n)}}]);
//# sourceMappingURL=49.js.map