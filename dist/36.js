(function(){var e={"esri/tasks/support/FeatureSet":187,"esri/geometry/support/normalizeUtils":234,"esri/layers/graphics/data/projectionSupport":263,"esri/tasks/geometry/cut":279,"esri/tasks/geometry/simplify":280,"esri/geometry/projection":291,"esri/layers/graphics/data/QueryEngine":302,"esri/geometry/pe":310,"esri/geometry/support/GeographicTransformation":311,"esri/geometry/support/GeographicTransformationStep":312,"esri/tasks/operations/urlUtils":314,"esri/layers/graphics/data/utils":315,"esri/tasks/operations/pbfQueryUtils":328,"esri/tasks/operations/pbfFeatureServiceParser":329,"esri/tasks/operations/pbfDehydratedFeatureSet":330,"esri/tasks/operations/pbfOptimizedFeatureSet":331,"esri/tasks/operations/query":348,"esri/layers/graphics/centroid":349,"esri/geometry/geometryAdapters/json":361,"esri/layers/graphics/data/attributeSupport":363,"esri/layers/support/PromiseQueue":383,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":384,"esri/layers/graphics/data/FeatureStore":402,"esri/layers/graphics/data/executeTileQuery":424,"esri/layers/graphics/data/BoundsStore":466,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":467,"esri/layers/graphics/data/timeSupport":512,"esri/layers/graphics/data/QueryEngineCapabilities":558,"esri/layers/graphics/data/spatialQuerySupport":559,"esri/views/2d/layers/features/support/AttributeStore":561,"esri/views/2d/layers/graphics/graphicsUtils":562,"esri/layers/graphics/data/QueryEngineResult":719,"esri/layers/graphics/data/AttributesBuilder":720,"esri/geohash/geohashUtils":756,"esri/core/sql/WhereClauseCache":1031,"esri/layers/graphics/contains":1032,"esri/views/2d/layers/features/controllers/BaseController":1079,"esri/views/2d/layers/features/support/ClusterStore":1080,"esri/geohash/GeohashTree":1081,"esri/views/2d/layers/features/support/pixelBuffering":1082,"esri/layers/graphics/data/StreamFeatureManager":1083,"esri/layers/graphics/sources/connections/GeoEventConnection":1084,"esri/layers/graphics/sources/connections/StreamConnection":1085,"esri/views/2d/layers/features/controllers/StreamController":2275,"esri/views/2d/layers/features/controllers/support/DispatchQueue":2276},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[36,7,10,32,188],{1031:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(595),r(301)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._cache=new r(e),this._invalidCache=new r(t)}return e.prototype.get=function(e,t){var r=t.uid+":"+e,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var o=n.WhereClause.create(e,t);return this._cache.put(r,o),o}catch(e){return this._invalidCache.put(r,null),null}},e}();t.WhereClauseCache=i}.apply(null,n))||(e.exports=i)},1032:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,o,s){if(!e)return!1;for(var a=r(t,n),u=e.coords,l=!1,c=0,p=0,h=e.lengths;p<h.length;p++){var f=h[p];l=i(l,u,a,c,f,o,s),c+=f*a}return l}function i(e,t,r,n,i,o,s){for(var a=e,u=n,l=n,c=n+i*r;l<c;l+=r){(u=l+r)===c&&(u=n);var p=t[l],h=t[l+1],f=t[u],d=t[u+1];(h<s&&d>=s||d<s&&h>=s)&&p+(s-h)/(d-h)*(f-p)<o&&(a=!a)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,i){return n(e,t,r,i.coords[0],i.coords[1])},t.polygonContainsMultipoint=function(e,t,i,o,s,a){var u=r(s,a),l=o.coords,c=o.lengths;if(!c)return!1;for(var p=0,h=0;p<c.length;p++,h+=u)if(!n(e,t,i,l[h],l[h+1]))return!1;return!0},t.polygonContainsCoords=n}.apply(null,n))||(e.exports=i)},1079:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(236),r(164),r(156),r(152),r(153),r(151),r(363),r(302),r(255),r(316),r(199),r(186),r(561),r(1080),r(1082)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d,_,y,g,v){Object.defineProperty(t,"__esModule",{value:!0});var m=s.getLogger("esri.views.2d.layers.features.controllers.BaseController"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(_.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return r.__extends(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,u.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new h(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function n(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return n(r.symbol);case"unique-value":return n(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return n(e.symbol)}));case"class-breaks":return n(r.defaultSymbol)||r.classBreakInfos.some((function(e){return n(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?f.fromJSON(this.config.renderer):(m.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=r.__spreadArrays(this._availableFields,t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,v.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var i=r[t];if(a.isSome(i)&&i.where)try{c.validateWhere(this.fieldsIndex,i.where)}catch(e){throw new n("mapview-bad-filter",e.message,{filter:i,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&o("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new y.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new p.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new g.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new d,r=e.outFields,n=this.config,i=n.gdbVersion,o=n.historicMoment,s=n.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=i,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return a.isSome(e)&&!!e.geometry}))},r.__decorate([l.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r.__decorate([l.property()],t.prototype,"config",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r.__decorate([l.property()],t.prototype,"filters",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r.__decorate([l.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r.__decorate([l.property()],t.prototype,"processor",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([l.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"viewState",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r.__decorate([l.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(i.HandleOwner);t.default=b}.apply(null,n))||(e.exports=i)},1080:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(164),r(152),r(153),r(171),r(1081),r(756),r(178),r(197),r(274),r(224),r(402),r(263),r(302),r(315),r(246),r(408),r(206)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d,_,y,g,v,m,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){return o.andThen(e,(function(e){return"cluster"!==e.type?null:r.__assign(r.__assign({},e),{clusterRadius:a.pt2px(e.clusterRadius/2)})}))};function S(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a,u;return r.__generator(this,(function(r){for(i=[],o=0,a=e;o<a.length;o++)u=a[o],i.push(I(u,t,n));return[2,s.all(i)]}))}))}function I(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(o=(i=e).outStatistic.onStatisticValueExpression,s=i,[4,v.createRendererExpression(o,t,n)]):[3,2];case 1:return s.expression=r.sent(),[2,i];case 2:return[2,e]}}))}))}var P=function(e){function t(t,r,n,i,o){var s=this,a=new f.default([],[r,n]);return(s=e.call(this,a,i,null,t)||this).invalid=!1,s.canDelete=!1,s.geohashBoundsInfo=o,s}return r.__extends(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,n,i,o,s,a){var u=new t(r,n,i,s,a);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=o,u},t.prototype.update=function(e,t,r,n,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=n,this.geohashBoundsInfo=i,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(h.default),w=function(e){function t(t,r,i,o){var s=e.call(this,t)||this;return s._deferredDeletionQueue=[],s._invalidated=!1,s._aggregateFieldsHash=null,s._geohashLevel=0,s._aggregateValueRanges={},s._aggregateValueRangesChanged=!1,s._aggregateFields=[],s._hasAggregateValueExpression=!1,s._hasViewExpression=!1,s._$view={scale:0,viewingMode:"none"},s._clusters=new Map,s._tiles=new Map,s._spatialReference=r,s._attributeStore=i,s._featureReduction=x(o),s._projectionSupportCheck=_.checkProjectionSupport(r,n.SpatialReference.WGS84),s}return r.__extends(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,o.isSome(r)&&t&&(this._tree=new u.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,s,a,l,c,p,h,f,d,_,y,g=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=this._featureReduction,s=o.andThen(t.featureReduction,x),a=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),l=null===i&&t.featureReduction,c=a!==this._aggregateFieldsHash,p=l||c,c?(h=this,[4,S(t.aggregateFields,this._spatialReference,n)]):[3,2];case 1:for(h._aggregateFields=r.sent(),this._hasViewExpression=!1,f=0,d=this._aggregateFields;f<d.length;f++)"onStatisticValueExpression"in(_=d[f]).outStatistic&&(y=_,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||y.expression.referencesScale());r.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return r.sent(),this._featureReduction=s,this._aggregateFieldsHash=a,this._aggregateValueRanges={},this._invalidated=!0,o.isNone(s)?(this._tree=null,[2]):(o.isSome(i)&&i.clusterRadius!==s.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),p&&(this._tree=new u.GeohashTree(t.aggregateFields),this._unindexFeatures()),(p||e)&&this._reindexFeatures(c),this._handleClusterUpdates(),this._tiles.forEach((function(e){return g._getClustersForTile(e,0,s.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,n=this._aggregateFields;r<n.length;r++){var i=n[r];if("onStatisticValueExpression"in i.outStatistic){var o=i,s=o.expression,a=o.outStatistic.onStatisticField;e.attributes[a]=m.callWithOptimizedFeature(s,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,n=e.removed;if(r.length){var i=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(i),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!o.isNone(this._featureReduction)){var s=this._featureReduction.clusterRadius;n.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,s)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var n=r[t];this._attributeStore.addLocalId(n)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var s,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return o.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,n,i)]:[4,this._projectionSupportCheck];case 1:return r.sent(),this._handleClusterUpdates(),s=this._featureReduction.clusterRadius,a=this._getTransforms(t,n),u=this._getClustersForTile(t,i.pixelBuffer,s,a),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,u]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,s,a,u){var l=this;void 0===u&&(u=!0),t=Math.max(t,50);for(var c=2*s,h=new Set,f=this._getGeohashLevel(e.key.level),d=Math.pow(2,e.key.level)*Math.ceil(b.TILE_SIZE/c),v=Math.ceil(t/c)+2,m=Math.ceil(b.TILE_SIZE/c)+2*v,x=e.key,S=x.row,I=x.col*b.TILE_SIZE,P=S*b.TILE_SIZE,w=Math.floor(I/c)-v,T=Math.floor(P/c)-v,E=w+m,M=T+m,F=new Array,R=e.tileInfoView.getLODInfoAt(e.key.level),O=w;O<=E;O++)for(var A=function(t){var s,c,v=O;R.wrap&&(v=O<0?O+d:O%d);var m=R.wrap&&O<0,b=R.wrap&&O%d!==O,x=N._lookupCluster(R,e.key.level,v,t,f);if(o.isSome(x)){var S=o.andThen(a,(function(e){return m?e.left:b?e.right:e.tile}));if(u&&o.isNone(S))return"continue";if(!x.count)return"continue";if(u&&1===x.count){var I=x.geohashBoundsInfo,P=I.xLL,w=I.yLL,T=I.xTR,E=I.yTR,M=I.level,A=o.unwrap(N._tree).findSingleOccupancyNode(P,w,T,E,M),C=o.unwrap(A).getLngLatBounds(),k={x:C[0],y:C[1]},G={x:C[2],y:C[3]},j=0,D=0,L=0,B=0;if(N._spatialReference.isWebMercator)j=(s=p.lngLatToXY(k.x,k.y))[0],D=s[1],L=(c=p.lngLatToXY(G.x,G.y))[0],B=c[1];else{var z=_.project(k,n.SpatialReference.WGS84,N._spatialReference),q=_.project(G,n.SpatialReference.WGS84,N._spatialReference);if(!z||!q)return i("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";j=z.x,D=z.y,L=q.x,B=q.y}var V=[j,D,L,B],U=null;if(N.forEachInBounds(V,(function(e){l._attributeStore.isVisible(e)&&(U&&i("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),U=e)})),!U)return i("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var Q=g.getGeometry(N.geometryInfo.geometryType,N.geometryInfo.hasZ,N.geometryInfo.hasM,U.geometry,0,o.unwrap(S)),Y=r.__assign(r.__assign({},U.attributes),x.attributes);x.referenceId=U.localId,h.add(x.objectId),F.push(new y.Feature(Y,x.localId,Q))}else u&&(h.add(x.objectId),Q=g.getGeometry(N.geometryInfo.geometryType,N.geometryInfo.hasZ,N.geometryInfo.hasM,x.geometry,0,o.unwrap(S)),F.push(new y.Feature(x.attributes,x.localId,Q)))}},N=this,C=T;C<=M;C++)A(C);return{features:F,objectIds:h}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,n=this._getGeohashLevel(e),i=2*(Math.floor(n/2)+1)-1,s=this._tree;this._geohashLevel=i,o.isNone(s)||(i>r?(s.dropLevels(0),this._featuresById.forEach((function(e){e.geohashIndexed&&(t._setGeohash(e),s.insert(e,t._geohashLevel),e.geohashIndexed=!0)}))):i<r&&s.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,o.unwrap(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,o.unwrap(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){o.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var n={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=c.getInfo(t);if(!i)return{tile:n,left:null,right:null};var o=i.valid,s=o[0],a=o[1];return{tile:n,left:r.__assign(r.__assign({},n),{translate:[a,e.bounds[3]]}),right:r.__assign(r.__assign({},n),{translate:[s-a+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var n=this._getClusterId(e,t,r);if(this._clusters.has(n)){var i=this._clusters.get(n);o.isSome(i)?i.canDelete=!0:this._clusters.delete(n)}},t.prototype._getClusterBounds=function(e,t,r){if(o.isNone(this._featureReduction))return null;var n=this._featureReduction.clusterRadius,i=2*n,s=r%2?t*i:t*i+n,a=r*i,u=s/b.TILE_SIZE,l=a/b.TILE_SIZE,c=(s+i)/b.TILE_SIZE,p=(a-i)/b.TILE_SIZE;return[e.getXForColumn(u),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(p)]},t.prototype._lookupCluster=function(e,t,i,s,a){var u,c;if(o.isNone(this._featureReduction)||o.isNone(this._tree))return null;var h=this._getClusterId(t,i,s),f=this._clusters.get(h);if(f&&o.isSome(f)&&!f.invalid&&!f.canDelete)return f;var d=this._getClusterBounds(e,i,s),y=d[0],g=d[1],v=d[2],m=d[3],b={x:y,y:g},x={x:v,y:m},S=0,I=0,w=0,T=0;if(this._spatialReference.isWebMercator)S=(u=p.xyToLngLat(b.x,b.y))[0],I=u[1],w=(c=p.xyToLngLat(x.x,x.y))[0],T=c[1];else{var E=_.project(b,this._spatialReference,n.SpatialReference.WGS84),M=_.project(x,this._spatialReference,n.SpatialReference.WGS84);if(!E||!M)return null;S=E.x,I=E.y,w=M.x,T=M.y}S>w&&(w=180);var F={geohashX:0,geohashY:0},R={geohashX:0,geohashY:0};l.setGeohashXY(F,I,S,a),l.setGeohashXY(R,T,w,a);var O=F.geohashX,A=F.geohashY,N=R.geohashX,C=R.geohashY,k={xLL:O,yLL:A,xTR:N,yTR:C,level:a},G=this._tree.getRegionStatistics(O,A,N,C,a),j=G.count,D=G.xTotal,L=G.yTotal,B=j?D/j:0,z=j?L/j:0;if(o.isSome(f)&&f.canDelete){var q=this._attributeStore.removeLocalId(f.objectId);this._deferredDeletionQueue.push(q)}var V=o.isSome(f)&&!f.canDelete&&f.invalid,U=r.__assign({cluster_count:j},G.attributes),Q=this._attributeStore,Y=V?f.update(B,z,t,U,k):P.create(Q,h,B,z,t,U,k);return 0===j&&(Y.geometry.coords[0]=(y+v)/2,Y.geometry.coords[1]=(g+m)/2),this._attributeStore.setAttributeData(Y.localId,Y,this.geometryInfo,null),this._clusters.set(h,Y),this._updateAggregateValueRangeForCluster(Y,Y.tileLevel),Y},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},n=r.minValue,i=r.maxValue;r.minValue=Math.min(n,e.count),r.maxValue=Math.max(i,e.count),this._aggregateValueRanges[t]=r,n===r.minValue&&i===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,n=Math.ceil(b.TILE_SIZE/r),i=e.key,o=i.row,s=i.col*b.TILE_SIZE,a=o*b.TILE_SIZE,u=Math.floor(s/r),l=Math.floor(a/r),c=u;c<u+n;c++)for(var p=l;p<l+n;p++)this._markForDeletion(e.key.level,c,p)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},o=_.project(r,this._spatialReference,n.SpatialReference.WGS84);o?l.setGeohashXY(e,o.y,o.x,12):i("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),o.isSome(this._featureReduction)&&o.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return o.isSome(this._featureReduction)&&o.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(d.default);t.ClusterStore=w}.apply(null,n))||(e.exports=i)},1081:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(601),r(152),r(756)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new s(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var i=this._pool.dequeue();return this._nodes++,n.isSome(i)?i.realloc(e,t,r):new s(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var n=0;n<r.children.length;n++){var i=r.children[n];r.children[n]=null,i&&t._release(i)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var n=this._root,i=0,o=0,s=0;null!==n;){if(n.depth>=r&&(n.count+=1,n.xTotal+=e.geometry.coords[0],n.yTotal+=e.geometry.coords[1],n.xGeohashTotal+=e.geohashX,n.yGeohashTotal+=e.geohashY,this._updateStatistics(e,n,1)),i>=t)return;var a=Math.ceil((i+1)/2),u=Math.floor((i+1)/2),l=1-i%2,c=30-(3*a+2*u),p=30-(2*a+3*u),h=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<p,d=8*l+4*(1-l),_=(e.geohashX&h)>>c,y=(e.geohashY&f)>>p,g=_+y*d;o=o<<3*l+2*(1-l)|_,s=s<<2*l+3*(1-l)|y,null==n.children[g]&&(n.children[g]=this._acquire(o,s,i+1)),i+=1,n=n.children[g]}},e.prototype.remove=function(e,t){for(var r=this._root,n=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),n>=t)return;var i=Math.ceil((n+1)/2),o=Math.floor((n+1)/2),s=1-n%2,a=30-(3*i+2*o),u=30-(2*i+3*o),l=7*s+3*(1-s)<<a,c=3*s+7*(1-s)<<u,p=8*s+4*(1-s),h=((e.geohashX&l)>>a)+((e.geohashY&c)>>u)*p,f=r.children[h];1===f.count&&(this._release(f),r.children[h]=null),n+=1,r=f}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,n,i){for(var o=this._root;null!==o;){var s=o.depth,a=o.xNode,u=o.yNode,l=1-s%2,c=o.xGeohashTotal/o.count,p=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<p&&p<=n)return o;if(s>=i)o=o.next;else{for(var h=Math.ceil((s+1)/2),f=Math.floor((s+1)/2),d=30-(3*h+2*f),_=30-(2*h+3*f),y=~((1<<d)-1),g=~((1<<_)-1),v=(e&y)>>d,m=(t&g)>>_,b=(r&y)>>d,x=(n&g)>>_,S=a<<3*l+2*(1-l),I=u<<2*l+3*(1-l),P=S+8*l+4*(1-l),w=I+4*l+8*(1-l),T=Math.max(S,v),E=Math.max(I,m),M=Math.min(P,b),F=Math.min(w,x),R=null,O=null,A=E;A<=F;A++)for(var N=T;N<=M;N++){var C=N-S+(A-I)*(8*l+4*(1-l)),k=o.children[C];k&&(R||((R=k).next=o.next),O&&(O.next=k),O=k,k.next=o.next)}o=R||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,n,i){for(var o=this._root,s=0,a=0,u=0,l={};null!==o;){var c=o.depth,p=o.xNode,h=o.yNode;if(c>=i){var f=o.xGeohashTotal/o.count,d=o.yGeohashTotal/o.count;e<f&&f<=r&&t<d&&d<=n&&(s+=o.count,a+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var _=Math.ceil((c+1)/2),y=Math.floor((c+1)/2),g=1-c%2,v=30-(3*_+2*y),m=30-(2*_+3*y),b=~((1<<v)-1),x=~((1<<m)-1),S=(e&b)>>v,I=(t&x)>>m,P=(r&b)>>v,w=(n&x)>>m,T=p<<3*g+2*(1-g),E=h<<2*g+3*(1-g),M=T+8*g+4*(1-g),F=E+4*g+8*(1-g),R=Math.max(T,S),O=Math.max(E,I),A=Math.min(M,P),N=Math.min(F,w),C=null,k=null,G=O;G<=N;G++)for(var j=R;j<=A;j++){var D=j-T+(G-E)*(8*g+4*(1-g)),L=o.children[D];if(L){if(G!==O&&G!==N&&j!==R&&j!==A){f=L.xGeohashTotal/L.count,d=L.yGeohashTotal/L.count,e<f&&f<=r&&t<d&&d<=n&&(s+=L.count,a+=L.xTotal,u+=L.yTotal,this._aggregateStatistics(l,L.statistics));continue}C||((C=L).next=o.next),k&&(k.next=L),k=L,L.next=o.next}}o=C||o.next}}return{count:s,attributes:this._normalizeStatistics(l,s),xTotal:a,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,n=0;n<=e.children.length;n++){var i=e.children[n];i&&(t||((t=i).next=e.next),r&&(r.next=i),r=i,i.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var n=0,i=this._fields;n<i.length;n++){var o=i[n],s=o.name,a=o.outStatistic.onStatisticField,u=e.attributes[a];switch(o.outStatistic.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],p=t.statistics[s].onStatisticField||0,h=t.statistics[s].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[s].onStatisticField=p+r*u,t.statistics[s].onStatisticNormalizationField=h+r*c);break;case"sum":case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var f=t.statistics[s].value,d=t.statistics[s].nanCount;null==u||isNaN(u)?t.statistics[s].nanCount=d+r:t.statistics[s].value=f+r*u;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var _=t.statistics[s].x,y=t.statistics[s].y,g=(d=t.statistics[s].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[s].nanCount=d+r:(t.statistics[s].x=_+r*Math.cos(u*g),t.statistics[s].y=y+r*Math.sin(u*g));break;case"mode":t.statistics[s]||(t.statistics[s]={}),f=t.statistics[s][u]||0,t.statistics[s][u]=f+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,n=this._fields;r<n.length;r++){var i=n[r],o=i.name;switch(i.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[o]||(e[o]={}),t[o]){var a=e[o][s]||0;e[o][s]=a+t[o][s]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},n=0,i=this._fields;n<i.length;n++){var o=i[n],s=o.name;switch(o.outStatistic.statisticType){case"norm":var a=e[s];if(t&&null==a.onStatisticNormalizationField)break;if(t&&a.onStatisticNormalizationField){r[s]=a.onStatisticField/a.onStatisticNormalizationField;break}r[s]=0;break;case"sum":if(!t)break;var u=e[s],l=u.value;if(!(t-(p=u.nanCount)))break;r[s]=l;break;case"avg":if(!t)break;var c=e[s];if(l=c.value,!(t-(p=c.nanCount)))break;r[s]=l/(t-p);break;case"avg_angle":if(!t)break;var p,h=e[s],f=h.x,d=h.y;if(!(t-(p=h.nanCount)))break;var _=f/(t-p),y=d/(t-p),g=180/Math.PI,v=Math.atan2(y,_)*g;r[s]=v;break;case"mode":var m=e[s],b=0,x=null;for(var S in m){var I=m[S];I>b&&(b=I,x=S)}r[s]="null"===x?null:x}}return r},e}();t.GeohashTree=o;var s=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var n=0;n<this.children.length;n++)this.children[n]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var n=0;n<this.children.length;n++)this.children[n]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),o=30-(2*t+3*r),s=this.xNode<<n,a=this.yNode<<o;return i.decodeGeohashXY({geohashX:s,geohashY:a},this.depth)},e.prototype.find=function(e,t,r,n,i,o){if(n>=r)return this;var s=1-n%2,a=3*s+2*(1-s),u=2*s+3*(1-s),l=30-i-a,c=30-o-u,p=((e&7*s+3*(1-s)<<l)>>l)+((t&3*s+7*(1-s)<<c)>>c)*(8*s+4*(1-s)),h=this.children[p];return null==h?null:h.find(e,t,r,n+1,i+a,o+u)},e}()}.apply(null,n))||(e.exports=i)},1082:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(171),r(625),r(186),r(206),r(562)],void 0===(i=function(e,t,r,n,i,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(o=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(g,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(g,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=o;u<l.length;u++)c=l[u],a.push(_(c,s));return[4,n.all(a)];case 1:return p=r.sent(),[2,i.pt2px(p.reduce(g,0))]}}))}))};var c=[0,0,0,0];function p(e,t){return null==e?t:e}function h(e,t){return null==e.outline?t:p(e.outline.width,t)}var f={sdf:!0,code:99,metrics:a.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new o.default(0,0,24,24),page:0,textureBinding:2};function d(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,l,_,g,v,m,b,x,S,I,P;return r.__generator(this,(function(w){switch(w.label){case 0:return"simple-marker"===e.type?(n=Math.max(p(e.size,12),t),[2,y(e)+.707*n]):"picture-marker"===e.type?(i=Math.max(p(e.height,12),t),o=p(e.width,12)*(i/p(e.height,12)),a=o/2,l=i/2,[2,y(e)+Math.sqrt(a*a+l*l)]):"text"===e.type?(_=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[f]};for(var n=[],i=0;i<t;i++)n.push(r.__assign(r.__assign({},f),{code:e.text.charCodeAt(i)}));return{glyphMosaicItems:n}}(e),u.getTextSymbolSize(c,e,_),g=Math.abs(c[0]),v=Math.abs(c[1]),m=c[2],b=c[3],[2,Math.max(g,v)+Math.max(m,b)]):"simple-line"===e.type?(x=e,S=Math.max(p(x.width,.75),t)/2,x.marker?[2,Math.max(6*x.width,2*t)]:[2,S]):"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(h(e,0),t)/2]:"cim"===e.type?(I=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(I.width*I.width+I.height*I.height)]:[2,0]:"web-style"!==e.type?[3,2]:(P=d,[4,e.fetchCIMSymbol()]);case 1:return[2,P.apply(void 0,[w.sent(),t])];case 2:return[2,0]}}))}))}function _(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return function(e){return e.type in l}(e)?(i=(n=Math).min,[4,d(e,t)]):[2,0];case 1:return[2,i.apply(n,[r.sent(),75])]}}))}))}function y(e){var t=p(e.xoffset,0),r=p(e.yoffset,0);return Math.sqrt(t*t+r*r)}function g(e,t){return Math.max(e,t)}}.apply(null,n))||(e.exports=i)},1083:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(601),r(168),r(152)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__";var o=function(){function e(e,r,n,i,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=Date.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=n,this._purgeOptions=i,this.store=e,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===t.DEFAULT_STREAM_ID_FIELD}return e.prototype.add=function(e){if(this._useGeneratedIds&&(e.attributes[this.objectIdField]=this._nextId()),e.objectId=e.attributes[this.objectIdField],this.store.add(e),this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){var o=i.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,s=n.clamp(o,0,1e3);this._trackIdToObservations.set(t,new r.default(s))}var a=this._trackIdToObservations.get(t),u=e.attributes[this.objectIdField],l=a.enqueue(u);if(i.isSome(l)){var c=this.store.removeById(l);i.isSome(c)&&(this._addOrUpdated.has(l)?this._addOrUpdated.delete(l):this._removed.push(c))}}},e.prototype.checkForUpdates=function(){var e=this._getToAdd(),t=this._getToRemove(),r=Date.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=r),(e||t)&&this.store.update(e,t)},e.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e},e.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},e.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},e.prototype._purge=function(){var e=this._purgeOptions;i.isSome(e)&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeTracks())},e.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.store.size;r>e.displayCount&&this._trackIdToObservations.forEach((function(n){if(r>e.displayCount&&n.size){var o=t.store.removeById(i.unwrap(n.dequeue()));i.isSome(o)&&t._removed.push(o),r--}}))}},e.prototype._purgeByAge=function(e){var t=this;if(e.age){var r=60*e.age*1e3,n=this._maxAge-r,i=this._timeInfo.startTimeField;this.store.forEach((function(e){e.attributes[i]<n&&(t.store.removeById(e.objectId),t._removed.push(e))}))}},e.prototype._purgeTracks=function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))},e}();t.default=o}.apply(null,n))||(e.exports=i)},1084:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(154),r(156),r(152),r(153),r(151),r(222),r(1085),r(348),r(248),r(199)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var _,y=s.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(_=t.ReadyState||(t.ReadyState={}));var g=function(e){function t(t,r,n,i,o,s,a,u){void 0===s&&(s=5),void 0===a&&(a=3);var l=e.call(this)||this;return l._destroyed=!1,l.errorString=null,l._source=t,l._sourceSpatialReference=r,l._spatialReference=n,l._filter=o,l._outFields=u,l._maxQueryDepth=s,l._maxRecordCountFactor=a,l._featureZScaler=f.getGeometryZScaler(i,r,n),l._open(),l}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||y.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),n=this._filter,i=this._outFields,this._destroyed||this._setFilter(n,i),[2]}}))}))},t.prototype.destroy=function(){this._destroyed=!0,a.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(a.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case _.CONNECTING:case _.OPEN:return"connected";case _.CLOSING:case _.CLOSED:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),r.__awaiter(this,void 0,void 0,(function(){var n,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this._destroyed?[2]:(n=this,[4,this._createWebSocket(e)]);case 1:return n._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return i=r.sent(),s=t/1e3,y.error(new o("geoevent-connection","Failed to connect. Attempting to reconnect in "+s+"s",i)),[4,u.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),n=u.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return n.then((function(){if(t._destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),n},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void y.error(new o("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),y.error("geoevent-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&y.error("geoevent-connection","WebSocket closed unexpectedly with error code "+e.code),this._destroyed||this._open()},t.prototype._fetchServiceDefinition=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),n=t.data,this._serviceDefinition=n,[2,n]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){return n=e[0],i=n.urls,o=n.token,[2,this._inferWebSocketBaseUrl(i)+"/subscribe?outSR="+t.wkid+(o?"&token="+o:"")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var n=r[t];if(-1!==n.indexOf("wss"))return n}return y.error(new o("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,s,l,c,p,h=this;return r.__generator(this,(function(r){return n=this._websocket,this._filter=e,this._outFields=t,a.isNone(n)||a.isNone(e)&&a.isNone(t)?[2]:(i=JSON.stringify({filter:this._serializeFilter(e,t)}),s=!1,l=u.createResolver(),c=function(){s||(h._destroyed||h._websocket!==n||y.error(new o("geoevent-connection","Server timed out when setting filter")),l.reject())},p=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(y.error(new o("geoevent-connection","Failed to set service filter",t.error)),h._set("errorString","Could not set service filter - "+t.error),l.reject(t.error)),n.onmessage=h._onMessage.bind(h),s=!0,l.resolve())},n.onmessage=p,n.send(i),setTimeout(c,1e4),[2,l.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(a.isNone(e)&&a.isNone(t))return r;if(a.isSome(e)&&e.geometry)try{var i=n.fromJSON(e.geometry);if("extent"!==i.type)throw new o("Expected extent but found type "+i.type);r.geometry=JSON.stringify(i.shiftCentralMeridian())}catch(e){y.error(new o("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return a.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),a.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return y.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var n=this._relatedFeatures.get(r),i=n.attributes,s=n.geometry;for(var a in i)e.attributes[a]=i[a];return s&&(e.geometry=s),e.geometry||e.centroid||y.error(new o("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i,s,a,u,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,n=e.keepLatestArchive,i=this._queryRelatedFeatures(t),s=this._queryArchive(n),[4,i];case 1:return r.sent(),[4,s];case 2:if(!(a=r.sent()))return[2];for(u=0,l=a.features;u<l.length;u++)c=l[u],this.onFeature(this._enrich(c));return[3,4];case 3:return p=r.sent(),y.error(new o("geoevent-connection","Encountered an error when querying buddy services",{error:p})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,s,u,l,p,f,_;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,(t=new c({url:e})).load()];case 1:return n=r.sent().capabilities,i=n.query.supportsMaxRecordCountFactor,o=n.query.supportsPagination,s=n.query.supportsCentroid,u=this._maxRecordCountFactor,l=t.capabilities.query.maxRecordCount,p=i?l*u:l,(f=new d).outFields=a.unwrapOr(this._outFields,["*"]),f.where=a.unwrapOr(a.get(this._filter,"where"),"1=1"),f.returnGeometry=!0,f.returnExceededLimitFeatures=!0,f.outSpatialReference=this._spatialReference,s&&(f.returnCentroid=!0),i&&(f.maxRecordCountFactor=u),o?(f.num=p,t.destroy(),[2,this._queryPages(e,f)]):[4,h.executeQuery(e,f,this._sourceSpatialReference)];case 2:return _=r.sent(),t.destroy(),[2,_.data]}}))}))},t.prototype._queryPages=function(e,t,n,i){return void 0===n&&(n=[]),void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return t.start=i*t.num,[4,h.executeQuery(e,t,this._sourceSpatialReference)];case 1:return(o=r.sent().data).exceededTransferLimit&&i<this._maxQueryDepth?(o.features.forEach((function(e){return n.push(e)})),[2,this._queryPages(e,t,n,i+1)]):(n.forEach((function(e){return o.features.push(e)})),[2,o])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,n=this._serviceDefinition.relatedFeatures.joinField,i=0,o=r;i<o.length;i++){var s=o[i],a=s.attributes[n];t.set(a,s)}this._relatedFeatures=t},r.__decorate([l.property()],t.prototype,"connectionStatus",null),r.__decorate([l.property()],t.prototype,"errorString",void 0),r.__decorate([l.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(p.default);t.default=g}.apply(null,n))||(e.exports=i)},1085:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(236),r(151)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r.__decorate([o.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(n.EventedMixin(i.HandleOwner));t.default=s}.apply(null,n))||(e.exports=i)},187:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(174),r(166),r(155),r(152),r(151),r(170),r(163),r(194)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p){var h=new o.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),f=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return r.__extends(t,e),t.prototype.readFeatures=function(e,t){for(var r=l.fromJSON(t.spatialReference),n=[],o=0;o<e.length;o++){var s=e[o],u=i.fromJSON(s),c=s.geometry&&s.geometry.spatialReference;a.isSome(u.geometry)&&!c&&(u.geometry.spatialReference=r),n.push(u)}return n},t.prototype.writeGeometryType=function(e,t,r,n){if(e)h.write(e,t,r,n);else{var i=this.features;if(i)for(var o=0,s=i;o<s.length;o++){var u=s[o];if(u&&a.isSome(u.geometry))return void h.write(u.geometry.type,t,r,n)}}},t.prototype.writeSpatialReference=function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n];o&&a.isSome(o.geometry)&&o.geometry.spatialReference&&(t.spatialReference=o.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],n=t[1],i=e.translate,o=i[0],s=i[1],u=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-o)/r)}),(function(e){return Math.round((s-e)/n)})),c=0,p=u.length;c<p;c++)l(a.unwrap(u[c].geometry))||(u.splice(c,1),c--,p--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;for(var n=r.translate,i=n[0],o=n[1],s=r.scale,u=s[0],l=s[1],c=this._getHydrationFunction(e,(function(e){return e*u+i}),(function(e){return o-e*l})),p=0,h=t;p<h.length;p++){var f=h[p].geometry;a.isSome(f)&&c(f)}return this},t.prototype._quantizePoints=function(e,t,r){for(var n,i,o=[],s=0,a=e.length;s<a;s++){var u=e[s];if(s>0){var l=t(u[0]),c=r(u[1]);l===n&&c===i||(o.push([l-n,c-i]),n=l,i=c)}else n=t(u[0]),i=r(u[1]),o.push([n,i])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=c.isPolygon(e)?e.rings:e.paths,o=[],s=0,a=i.length;s<a;s++){var u=i[s],l=n._quantizePoints(u,t,r);l&&o.push(l)}return o.length>0?(c.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var i;return(i=n._quantizePoints(e.points,t,r)).length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:null},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,i,o=c.isPolygon(e)?e.rings:e.paths,s=0,a=o.length;s<a;s++)for(var u=o[s],l=0,p=u.length;l<p;l++){var h=u[l];l>0?(n+=h[0],i+=h[1]):(n=h[0],i=h[1]),h[0]=t(n),h[1]=r(i)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,i,o=e.points,s=0,a=o.length;s<a;s++){var u=o[s];s>0?(n+=u[0],i+=u[1]):(n=u[0],i=u[1]),u[0]=t(n),u[1]=r(i)}}:void 0},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r.__decorate([u.property({type:[i],json:{write:!0}})],t.prototype,"features",void 0),r.__decorate([u.reader("features")],t.prototype,"readFeatures",null),r.__decorate([u.property({type:[p],json:{write:!0}})],t.prototype,"fields",void 0),r.__decorate([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:h.read}}})],t.prototype,"geometryType",void 0),r.__decorate([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r.__decorate([u.property({types:n.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r.__decorate([u.property({type:l,json:{write:!0}})],t.prototype,"spatialReference",void 0),r.__decorate([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r.__decorate([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r.__decorate([u.subclass("esri.tasks.support.FeatureSet")],t)}(s.JSONSupport);return f.prototype.toJSON.isDefaultToJSON=!0,f||(f={}),f}.apply(null,n))||(e.exports=i)},2275:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(164),r(210),r(152),r(153),r(151),r(243),r(424),r(402),r(1083),r(1084),r(1079),r(2276)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d,_){Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e,t){this.store=e,this.onUpdate=t}return e.prototype.add=function(e){this.store.add(e)},e.prototype.forEach=function(e){this.store.forEach(e)},e.prototype.removeById=function(e){return this.store.removeById(e)},e.prototype.update=function(e,t){this.onUpdate(e,t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.store.numFeatures},enumerable:!0,configurable:!0}),e}(),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="stream",t._tileDispatchMap=new Map,t._updateIntervalId=0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.service,r=t.source,n=t.objectIdField,i=t.timeInfo,o=t.purgeOptions,s=t.serviceFilter,a=t.geometryType,u=t.spatialReference;this.connection=new f.default(r,u,this.spatialReference,a,s),this._set("store",new p.default(this.geometryInfo)),this._set("streamFeatureManager",new h.default(new y(this.store,(function(t,r){return e._onUpdate(t,r)})),n,i,o)),this.connection.on("feature",(function(t){return e._onFeature(t)})),["connectionStatus","errorString"].forEach((function(t){e.watch("connection."+t,(function(r){return e.remoteClient.invoke("setProperty",{propertyName:t,value:r})}))})),this._updateIntervalId=setInterval((function(){return e.streamFeatureManager.checkForUpdates()}),64),this._shouldPushDataReceived=this.service.enableDataReceived},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this.connection.destroy(),this.queryEngine.destroy(),this._tileDispatchMap.forEach((function(e){return e.destroy()}))},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.store)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),JSON.stringify(this.service.serviceFilter),t=this.renderer.getAttributeHash(),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return r.sent(),JSON.stringify(this.service.serviceFilter),"heatmap"===this.renderer.type?[2]:t===this.renderer.getAttributeHash()?[3,3]:(n=this.queryEngine.featureStore,[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]);case 2:r.sent(),n.forEach((function(e){return i.attributeStore.setAttributeData(e.localId,e,i.geometryInfo,i.viewParams)})),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.attributeStore.sendUpdates()];case 5:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){this._repushActiveTiles()},t.prototype.onEdits=function(){},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryLatestObservations=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(!this.service.timeInfo.trackIdField)throw new n("mapview-no-trackIdField","queryLatestObservation can only be used with services that define a TrackIdField");return[2,this.queryEngine.executeQueryForLatestObservations(e)]}))}))},t.prototype.queryStatistics=function(){throw new n("Method not implemented.")},t.prototype.refresh=function(){},t.prototype.setViewState=function(t){var r=this,n=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),n!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.queryEngine.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){var t=this,r=e.added;e.removed.forEach((function(e){return t._handleTileRemove(e)})),r.forEach((function(e){return t._handleTileAdd(e)}))},t.prototype.enableEvent=function(e){"data-received"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._onFeature=function(e){this._shouldPushDataReceived&&this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}});try{var t=this.geometryInfo,r=t.geometryType,n=t.hasM,o=t.hasZ,s=l.convertFromFeature(e,r,o,n,this.service.objectIdField);this.streamFeatureManager.add(s)}catch(e){i("esri-2d-debug")&&console.debug(e)}},t.prototype._createStoreWithFeatures=function(e){if(s.isNone(e))return null;var t=this._createFeatureStore();return t.addMany(e),t},t.prototype._onUpdate=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return s.isSome(e)&&e.forEach((function(e){return o.onFeatureAdd(e)})),n=this._createStoreWithFeatures(e),i=this._createStoreWithFeatures(t),this.attributeStore.sendUpdates(),this.processor.supportsTileUpdates?[4,this._updateActiveTiles(n,i)]:[3,2];case 1:return r.sent(),[3,3];case 2:this._repushActiveTiles(),r.label=3;case 3:return s.isSome(t)&&t.forEach((function(e){return o.onFeatureRemove(e)})),[2]}}))}))},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id))(t=this._tileDispatchMap.get(e.id)).up();else{var t=new _.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){var t=this._tileDispatchMap.get(e.id);t&&(t.destroy(),this._tileDispatchMap.delete(e.id))},t.prototype._anyUpdatesQueued=function(){return o.valuesOfMap(this._tileDispatchMap).some((function(e){return e.hasAction()}))},t.prototype._updateActiveTiles=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=s.applySome(e,(function(e){return o._createQueryEngine(e)})),i=s.applySome(t,(function(e){return o._createQueryEngine(e)})),[4,a.all(this.tileStore.tiles.map((function(e){return o._queryTileFeatures(e,!1,n,i)})))];case 1:return r.sent(),[2]}}))}))},t.prototype._repushActiveTiles=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._queryTileFeatures(r,!0,this.queryEngine)}},t.prototype._queryTileFeatures=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,u,l,p,h,f,d,_,y,g,v,m,b=this;return r.__generator(this,(function(x){switch(x.label){case 0:return o={hasZ:!1,hasM:!1,transform:{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},u=this.queryInfo,l=u.returnCentroid,p=u.returnGeometry,h=this._pixelBuffer,f={returnCentroid:l,returnGeometry:p,pixelBuffer:h,returnOutline:this.returnOutline},this._tileDispatchMap.has(e.id)?(d=this._tileDispatchMap.get(e.id),[4,s.applySome(n,(function(t){return t.featureStore.executeTileQuery(e,b.spatialReference,f)}))]):[2];case 1:return _=x.sent(),y=s.mapOr(_,[],(function(e){return e.features})),g=s.mapOr(i,[],(function(t){return c.executeTileQueryForIds(t,e,f)})).map((function(e){return b.attributeStore.getLocalId(e)})),v=a.createResolver(),m=function(n){return r.__awaiter(b,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.processor.onTileData(e,{addOrUpdate:y,remove:g,clear:t,transformParams:o},{signal:n})];case 1:return r.sent(),[3,3];case 2:return i=r.sent(),a.throwIfNotAbortError(i),[3,3];case 3:return v.resolve(),[2]}}))}))},d.enqueue(m),[2,v.promise]}}))}))},r.__decorate([u.property()],t.prototype,"connection",void 0),r.__decorate([u.property()],t.prototype,"service",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"store",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"streamFeatureManager",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["store","service","config"]})],t.prototype,"queryEngine",null),r.__decorate([u.property()],t.prototype,"updating",null),r.__decorate([u.subclass("esri.views.2d.layers.features.controllers.StreamController")],t)}(d.default);t.default=g}.apply(null,n))||(e.exports=i)},2276:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._action=null,this._queue=[],this._abortController=n.createAbortController(),this._refs=1}return e.prototype.up=function(){this._refs++},e.prototype.down=function(){return this._refs--,0===this._refs},e.prototype.clear=function(){this._abortController.abort(),this._abortController=n.createAbortController()},e.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action=null)},e.prototype.enqueue=function(e){this._action?this._queue.push(e):this._setAction(e)},e.prototype.flush=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i;return r.__generator(this,(function(r){return(e=this._action)?(t=this._abortController.signal,i=this._queue.reduce((function(e,r){return e.then((function(){return r(t)}))}),e).catch(n.throwIfNotAbortError),this._action=i.then(this._handleNext.bind(this)).catch(n.throwIfNotAbortError),this._queue.length=0,[2,i]):[2]}))}))},e.prototype.hasAction=function(){return!!this._action},e.prototype._setAction=function(e){var t=this._abortController.signal;this._action=e(t).then(this._handleNext.bind(this)).catch(n.throwIfNotAbortError)},e.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},e}();t.default=i}.apply(null,n))||(e.exports=i)},234:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(154),r(156),r(152),r(153),r(232),r(259),r(170),r(178),r(197),r(279),r(280)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var _=o.getLogger("esri.geometry.support.normalizeUtils"),y={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new l({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:c.WebMercator}),minus180Line:new l({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:c.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new l({paths:[[[180,-180],[180,180]]],spatialReference:c.WGS84}),minus180Line:new l({paths:[[[-180,-180],[-180,180]]],spatialReference:c.WGS84})}};function g(e){return"polygon"===e.type}function v(e){return g(e)?e.rings:e.paths}function m(e,t){return Math.ceil((e-t)/(2*t))}function b(e,t){for(var r=0,n=v(e);r<n.length;r++)for(var i=0,o=n[r];i<o.length;i++)o[i][0]+=t;return e}function x(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++){for(var o=e[i],s=null,a=0;a<o.length;a++)s=o[a],t.push(s),0===a?n=r=s[0]:(r=Math.min(r,s[0]),n=Math.max(n,s[0]));s&&t.push([(r+n)/2,0])}return t}function S(e,t){if(!(e instanceof l||e instanceof u)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw _.error(r),new i(r)}for(var n=[],o=0,s=v(e);o<s.length;o++){var a=s[o],c=[];n.push(c),c.push([a[0][0],a[0][1]]);for(var p=0;p<a.length-1;p++){var h=a[p][0],f=a[p][1],d=a[p+1][0],y=a[p+1][1],m=Math.sqrt((d-h)*(d-h)+(y-f)*(y-f)),b=(y-f)/m,x=(d-h)/m,S=m/t;if(S>1){for(var I=1;I<=S-1;I++){var P=I*t,w=x*P+h,T=b*P+f;c.push([w,T])}var E=(m+Math.floor(S-1)*t)/2,M=x*E+h,F=b*E+f;c.push([M,F])}c.push([d,y])}}return g(e)?new u({rings:n,spatialReference:e.spatialReference}):new l({paths:n,spatialReference:e.spatialReference})}function I(e,t,r){if(t){var n=S(e,1e6);e=h.webMercatorToGeographic(n,!0)}return r&&(e=b(e,r)),e}function P(e,t,r){var n;if(Array.isArray(e))if((n=e[0])>t){var i=m(n,t);e[0]=n+i*(-2*t)}else n<r&&(i=m(n,r),e[0]=n+i*(-2*r));else(n=e.x)>t?(i=m(n,t),e=e.clone().offset(i*(-2*t),0)):n<r&&(i=m(n,r),e=e.clone().offset(i*(-2*r),0));return e}t.straightLineDensify=S,t.normalizeCentralMeridian=function e(t,i,o){return r.__awaiter(this,void 0,void 0,(function(){var c,_,g,x,S,w,T,E,M,F,R,O,A,N,C,k,G,j,D,L,B,z,q,V,U,Q,Y,Z,X,W,J,H,$,K,ee,te,re;return r.__generator(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],i)];for(c=i?i.url:n.geometryServiceUrl,F=0,R=[],O=[],A=0,N=t;A<N.length;A++)C=N[A],s.isNone(C)?O.push(C):(_||(_=C.spatialReference,g=p.getInfo(_),x=_.isWebMercator,S=y[T=x?102100:4326].maxX,w=y[T].minX,E=y[T].plus180Line,M=y[T].minus180Line),g?"mesh"===C.type?O.push(C):"point"===C.type?O.push(P(C.clone(),S,w)):"multipoint"===C.type?((k=C.clone()).points=k.points.map((function(e){return P(e,S,w)})),O.push(k)):"extent"===C.type?(j=C.clone(),G=j._normalize(!1,!1,g),O.push(G.rings?new u(G):G)):C.extent?(j=C.extent,D=m(j.xmin,w),B=0==(L=D*(2*S))?C.clone():b(C.clone(),L),j.offset(L,0),j.intersects(E)&&j.xmax!==S?(F=j.xmax>F?j.xmax:F,B=I(B,x),R.push(B),O.push("cut")):j.intersects(M)&&j.xmin!==w?(F=j.xmax*(2*S)>F?j.xmax*(2*S):F,B=I(B,x,360),R.push(B),O.push("cut")):O.push(B)):O.push(C.clone()):O.push(C));for(z=m(F,S),q=-90,V=z,U=new l;z>0;)Q=360*z-180,U.addPath([[Q,q],[Q,-1*q]]),q*=-1,z--;return R.length>0&&V>0?[4,f.cut(c,R,U,o)]:[3,3];case 1:for(Y=r.sent(),Z=function(e,t){for(var r=-1,n=function(n){for(var i=t.cutIndexes[n],o=t.geometries[n],s=v(o),a=function(e){var t=s[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var s=t[i][0];n=s>n?s:n}for(var a=-360*m(n=Number(n.toFixed(9)),180),u=0;u<t.length;u++){var l=o.getPoint(e,u);o.setPoint(e,u,l.clone().offset(a,0))}return!0}))},u=0;u<s.length;u++)a(u);if(i===r){if("polygon"===e[0].type)for(var l=0,c=v(o);l<c.length;l++){var p=c[l];e[i]=e[i].addRing(p)}else if(function(e){return"polyline"===e[0].type}(e))for(var h=0,f=v(o);h<f.length;h++){var d=f[h];e[i]=e[i].addPath(d)}}else r=i,e[i]=o},i=0;i<t.cutIndexes.length;i++)n(i);return e}(R,Y),X=[],W=[],ee=0;ee<O.length;ee++)"cut"!==(te=O[ee])?W.push(te):(re=Z.shift(),J=t[ee],s.isSome(J)&&"polygon"===J.type&&J.rings&&J.rings.length>1&&re.rings.length>=J.rings.length?(X.push(re),W.push("simplify")):W.push(x?h.geographicToWebMercator(re):re));return X.length?[4,d.simplify(c,X,o)]:[2,W];case 2:for(H=r.sent(),$=[],ee=0;ee<W.length;ee++)"simplify"!==(te=W[ee])?$.push(te):$.push(x?h.geographicToWebMercator(H.shift()):H.shift());return[2,$];case 3:for(K=[],ee=0;ee<O.length;ee++)"cut"!==(te=O[ee])?K.push(te):(re=R.shift(),K.push(!0===x?h.geographicToWebMercator(re):re));return[2,a.resolve(K)]}}))}))},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&p.getInfo(e.spatialReference);if(!n)return r;var i,o=n.valid,s=o[0],a=o[1],u=2*a,l=r.width,c=r.xmin,h=r.xmax;if(c=(t=[h,c])[0],h=t[1],"extent"===e.type||0===l||l<=a||l>u||c<s||h>a)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;i=x(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;i=x(e.paths);break;case"multipoint":i=e.points}for(var f=r.clone(),d=0;d<i.length;d++){var _=i[d][0];_<0?(_+=a,h=Math.max(_,h)):(_-=a,c=Math.min(_,c))}return f.xmin=c,f.xmax=h,f.width<l?(f.xmin-=a,f.xmax-=a,f):r},t.normalizeMapX=function(e,t){var r=p.getInfo(t);if(r){var n=r.valid,i=n[0],o=n[1],s=o-i;if(e<i)for(;e<i;)e+=s;if(e>o)for(;e>o;)e-=s}return e}}.apply(null,n))||(e.exports=i)},263:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(153),r(291),r(361),r(178),r(197)],void 0===(i=function(e,t,r,n,i,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0];function c(e,t){var r,n,i;if(!t)return null;if("x"in t){var o={x:0,y:0};return r=e(t.x,t.y,l),o.x=r[0],o.y=r[1],null!=t.z&&(o.z=t.z),null!=t.m&&(o.m=t.m),o}return"xmin"in t?(o={xmin:0,ymin:0,xmax:0,ymax:0},n=e(t.xmin,t.ymin,l),o.xmin=n[0],o.ymin=n[1],i=e(t.xmax,t.ymax,l),o.xmax=i[0],o.ymax=i[1],t.hasZ&&(o.zmin=t.zmin,o.zmax=t.zmax,o.hasZ=!0),t.hasM&&(o.mmin=t.mmin,o.mmax=t.mmax,o.hasM=!0),o):"rings"in t?{rings:p(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:p(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function p(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];r.push(h(o,t))}return r}function h(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n],s=t(o[0],o[1],[0,0]);r.push(s),o.length>2&&s.push(o[2]),o.length>3&&s.push(o[3])}return r}function f(e,t){return!(!a.isValid(e)||!a.isValid(t)||a.equals(e,t)||u.canProject(e,t))}t.doesBrowserSupportProjection=function(e,t){return!f(e,t)||o.isSupported()},t.checkProjectionSupport=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,s,a;return r.__generator(this,(function(r){if(!t)return[2];if(Array.isArray(e)){for(i=0,s=e;i<s.length;i++)if(f((a=s[i]).geometry&&a.geometry.spatialReference,t)){if(o.isSupported())return[2,o.load()];throw new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}return[2]}if(!f(e,t))return[2];if(o.isSupported())return[2,o.load()];throw new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:e,outSpatialReference:t})}))}))};var d=c.bind(null,u.lngLatToXY),_=c.bind(null,u.xyToLngLat);t.project=function(e,t,r){return e?(r||(r=t,t=e.spatialReference),a.isValid(t)&&a.isValid(r)&&!a.equals(t,r)?u.canProject(t,r)?a.isWebMercator(r)?d(e):_(e):o.projectMany(s.jsonAdapter,[e],t,r,null)[0]:e):e};var y=new(function(){function e(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}return e.prototype.push=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o,s=this;return r.__generator(this,(function(r){return e&&e.length&&t&&n&&!a.equals(t,n)||i.resolve(e),o={geometries:e,inSpatialReference:t,outSpatialReference:n,resolve:null},this._jobs.push(o),[2,i.create((function(e){o.resolve=e,null===s._timer&&(s._timer=setTimeout(s._process,10))}))]}))}))},e.prototype._process=function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,n=e.outSpatialReference,i=e.resolve;u.canProject(r,n)?a.isWebMercator(n)?i(t.map(d)):i(t.map(_)):i(o.projectMany(s.jsonAdapter,t,r,n,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},e}());t.projectMany=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,y.push(e,t,n)]}))}))}}.apply(null,n))||(e.exports=i)},279:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(172),r(163)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,a,u){return r.__awaiter(this,void 0,void 0,(function(){var l,c,p,h,f,d,_;return r.__generator(this,(function(y){switch(y.label){case 0:return l="string"==typeof e?o.urlToObject(e):e,c=t[0].spatialReference,p=r.__assign(r.__assign({},u),{query:r.__assign(r.__assign({},l.query),{f:"json",sr:JSON.stringify(c),target:JSON.stringify({geometryType:s.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(a)})}),[4,i(l.path+"/cut",p)];case 1:return h=y.sent(),f=h.data,d=f.cutIndexes,_=f.geometries,[2,{cutIndexes:d,geometries:(void 0===_?[]:_).map((function(e){return n.fromJSON(e).set(c)}))}]}}))}))}}.apply(null,n))||(e.exports=i)},280:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(172),r(163)],void 0===(i=function(e,t,r,n,i,o){function s(e){return{geometryType:o.getJsonType(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}function a(e,t,r){var n=o.getGeometryType(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))}Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,u){return r.__awaiter(this,void 0,void 0,(function(){var l,c,p,h;return r.__generator(this,(function(f){switch(f.label){case 0:return l="string"==typeof e?i.urlToObject(e):e,c=t[0].spatialReference,p=o.getJsonType(t[0]),h=r.__assign(r.__assign({},u),{query:r.__assign(r.__assign({},l.query),{f:"json",sr:c.wkid?c.wkid:JSON.stringify(c),geometries:JSON.stringify(s(t))})}),[4,n(l.path+"/simplify",h)];case 1:return[2,a(f.sent().data,p,c)]}}))}))}}.apply(null,n))||(e.exports=i)},291:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153),r(310),r(311),r(161)],void 0===(i=function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var s=null,a=null;t.isLoaded=function(){return!!s&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var u=null;t.load=function(){return u||(u=n.all([i.load(),new Promise((function(e,t){r.e(12).then(function(){var t=[r(381)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){r.e(140).then(function(){var t=[r(405)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]).then((function(e){var t=e[1],r=e[2].hydratedAdapter;a=r,(s=t)._enableProjection(i)})))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:c(a,e,e[0].spatialReference,t,r):c(a,[e],e.spatialReference,t,r)[0]};var l={};function c(e,t,r,n,i){if(void 0===i&&(i=null),null===i){var a=o.cacheKey(r,n);void 0!==l[a]?i=l[a]:(null===(i=p(r,n,null))&&(i=new o),l[a]=i)}return s._project(e,t,r,n,i)}function p(e,t,r){void 0===r&&(r=null);var n=s._getTransformation(a,e,t,r,null==r?void 0:r.spatialReference);return null!==n?o.fromGE(n):null}t.projectMany=c,t.getTransformation=p,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=s._getTransformationBySuitability(a,e,t,r,null==r?void 0:r.spatialReference);if(null!==n){for(var i=[],u=0,l=n;u<l.length;u++){var c=l[u];i.push(o.fromGE(c))}return i}return[]}}.apply(null,n))||(e.exports=i)},302:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(118),r(152),r(483),r(153),r(198),r(200),r(193),r(173),r(353),r(163),r(178),r(363),r(263),r(558),r(719),r(559),r(512),r(315),r(255),r(383)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d,_,y,g,v,m,b,x,S,I){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,n,i){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=n,this.filterFlags=i,this.groupId=-1,this.localId=t};var P=new Set,w=new s.MemCacheStorage(2e6),T=0,E=function(){function e(e){var t=this;this.capabilities={query:g.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new s.MemCache(T+++"$$",w)),this.fieldsIndex=new S(e.fields),e.scheduler&&e.task&&(this._frameQueue=new I.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=b.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=i.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return n=r.sent(),[4,this._reschedule((function(){return n.executeObjectIdsQuery(t)}))];case 5:return n=r.sent(),[4,this._reschedule((function(){return n.executeTimeQuery(t)}))];case 6:return n=r.sent(),[4,this._reschedule((function(){return n.executeAttributesQuery(t)}))];case 7:return n=r.sent(),[3,9];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return n=new v.default([],null,this),[3,9];case 9:return[2,n.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=i.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return n=r.sent(),[4,this._reschedule((function(){return n.executeObjectIdsQuery(t)}))];case 5:return n=r.sent(),[4,this._reschedule((function(){return n.executeTimeQuery(t)}))];case 6:return n=r.sent(),[4,this._reschedule((function(){return n.executeAttributesQuery(t)}))];case 7:return[2,(n=r.sent()).size];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a,u,p,h,f=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=i.clone(e),o=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return n=r.sent(),[4,this._reschedule((function(){return n.executeObjectIdsQuery(t)}))];case 5:return n=r.sent(),[4,this._reschedule((function(){return n.executeTimeQuery(t)}))];case 6:return n=r.sent(),[4,this._reschedule((function(){return n.executeAttributesQuery(t)}))];case 7:return n=r.sent(),(s=n.size)?(c.set(F,c.NEGATIVE_INFINITY),this.featureStore.forEachBounds(n.items,(function(e){return c.expand(F,e)}),M),a={xmin:F[0],ymin:F[1],xmax:F[3],ymax:F[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(F[2])&&isFinite(F[5])&&(a.zmin=F[2],a.zmax=F[5]),(u=y.project(a,n.spatialReference,o)).spatialReference=x.cleanFromGeometryEngine(o||this.spatialReference),u.xmax-u.xmin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.xmin-=p,u.xmax+=p),u.ymax-u.ymin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.ymin-=p,u.ymax+=p),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.zmin-=p,u.zmax+=p),[2,{count:s,extent:u}]):[2,{count:s,extent:null}];case 8:if((h=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw h;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return u.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=i.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return n=r.sent(),[4,this._reschedule((function(){return n.executeObjectIdsQuery(t)}))];case 5:return n=r.sent(),[4,this._reschedule((function(){return n.executeTimeQuery(t)}))];case 6:return n=r.sent(),[4,this._reschedule((function(){return n.executeAttributesQuery(t)}))];case 7:return n=r.sent(),o=n.items,s=new Set,[4,this._reschedule((function(){for(var e=0,t=o;e<t.length;e++){var r=t[e];s.add(n.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,s];case 9:if((a=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw a;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,o,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new n("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=i.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return o=r.sent(),[4,this._reschedule((function(){return o.executeObjectIdsQuery(t)}))];case 5:return o=r.sent(),[4,this._reschedule((function(){return o.executeTimeQuery(t)}))];case 6:return o=r.sent(),[4,this._reschedule((function(){return o.executeAttributesQuery(t)}))];case 7:return o=r.sent(),[4,this._reschedule((function(){return o.filterLatest()}))];case 8:return o=r.sent(),[3,10];case 9:if((s=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw s;return o=new v.default([],null,this),[3,10];case 10:return[2,o.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new v.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,s,a,u,l,c,p,h,f,_,y,g,b,x,S,I,P,w=this;return r.__generator(this,(function(T){switch(T.label){case 0:if(t=e.geometry,n=e.outSR,i=e.spatialRel,s=d.isValid(n)&&!d.equals(this.spatialReference,n),(a=this._geometryQueryCache?s?JSON.stringify({geometry:t,spatialRelationship:i,outSpatialReference:n}):JSON.stringify({geometry:t,spatialRelationship:i}):null)&&(u=this._geometryQueryCache.get(a),!o.isUndefined(u)))return[2,u];if(l=function(t){return r.__awaiter(w,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return s&&(e.returnGeometry||e.returnCentroid)?[4,t.project(n)]:[3,2];case 1:return i=r.sent(),a&&this._geometryQueryCache.put(a,i,i.size||1),[2,i];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==i)return[3,3];if(!(p=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(_=new Set,y=0,g=p;y<g.length;y++)b=g[y],_.add(c.getObjectId(b));return[4,this._reschedule((function(){var e=0;h=new Array(_.size),w.featureStore.forEach((function(t){return h[e++]=t})),f=_}))];case 1:return T.sent(),[4,this._reschedule((function(){return r.__awaiter(w,void 0,void 0,(function(){var e,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m.getSpatialQueryOperator(i,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),n=function(t){return!f.has(c.getObjectId(t))||e(c.getGeometry(t))},o=v.default.bind,[4,this._runSpatialFilter(h,n)];case 2:return[2,new(o.apply(v.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return S=T.sent(),[2,l(S)];case 3:return(x=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new v.default(x,t,this))]:[4,m.getSpatialQueryOperator(i,t,this.geometryType,this.hasZ,this.hasM)]:(S=new v.default([],t,this),a&&this._geometryQueryCache.put(a,S,S.size||1),[2,S]);case 4:return I=T.sent(),[4,this._runSpatialFilter(x,(function(e){return I(c.getGeometry(e))}))];case 5:return P=T.sent(),[2,l(new v.default(P,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s=this;return r.__generator(this,(function(a){return t?this._budget?(n=0,i=new Array,o=function(){return r.__awaiter(s,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return n<e.length?(s=e[n],t(s)&&i.push(s),this._budget.done?[4,this._reschedule((function(){return o()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++n,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return o()})).then((function(){return i}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,n=t.spatialRel;return m.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))},e.prototype._getQueryBBoxes=function(e){if(m.canQueryWithRBush(e)){if(f.isExtent(e))return[p.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(f.isPolygon(e))return e.rings.map((function(e){return p.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[h.getBoundsXY(p.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this.featureStore.forEachInBounds(n,(function(e){P.add(e)}))}var i=new Array(P.size),o=0;return P.forEach((function(e){return i[o++]=e})),P.clear(),i},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new n("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,a.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),m.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),y.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,i=e.returnDistinctValues,o=e.outStatistics,s=o?o.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var a=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===s.indexOf(e)}));_.validateFields(this.fieldsIndex,a,"orderByFields contains missing fields")}if(t&&t.length>0)_.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new n("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});_.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,a,u,l,c,p,h,f;return r.__generator(this,(function(r){if(t=e.outStatistics,i=e.groupByFieldsForStatistics,o=e.having,s=i&&i.length,a=t&&t.length,o){if(!s||!a)throw new n("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});_.validateHaving(this.fieldsIndex,o,t)}if(a){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(u=t.map((function(e){return e.onStatisticField})),_.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),s&&_.validateFields(this.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(p=c[l],h=p.onStatisticField,"percentile_disc"!==(f=p.statisticType)&&"percentile_cont"!==f||!("statisticParameters"in p)){if("count"!==f&&h&&_.hasInvalidFieldType(h,this.fieldsIndex))throw new n("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:p,query:e})}else if(!p.statisticParameters)throw new n("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:p,query:e})}return[2]}))}))},e}();t.default=E;var M=c.create(),F=c.create()}.apply(null,n))||(e.exports=i)},310:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(164),r(153),r(161)],void 0===(i=function(e,t,n,i,o,s){var a,u,l,c,p,h;function f(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,u.init(),l.init(),c.init(),p.init(),h.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++)r(o[i].prototype,"getName",(function(e){return function(){return e.call(this,new Array(u.PE_NAME_MAX))}}));for(var s=0,a=[t._pe.PeGeogtran,t._pe.PeProjcs];s<a.length;s++)r(a[s].prototype,"getParameters",(function(e){return function(){for(var r=new Array(u.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}}));r(t._pe.PeHorizon.prototype,"getCoord",(function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return g(r,t,e.call(this)),r}})),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",(function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var s=t._pe.getPointer(i),a=1;a<o;a++)n.push(t._pe.wrapPointer(s+r*a,t._pe.PeGTlistExtendedGTs))}return n}}));var f=t._pe._pe_getPeHorizonSize(),d=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var s=t._pe.getPointer(i),a=1;a<o;a++)n.push(t._pe.wrapPointer(s+f*a,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",d),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",d),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=u.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(u.PE_BUFFER_MAX));return t._pe.UTF8ToString(t._pe._pe_object_to_string_ext(r,e,n))}}function d(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function _(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function y(e){var t;return Array.isArray(e[0])?(t=[],e.forEach((function(e){t.push(e[0],e[1])}))):t=e,t}function g(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var s=0===e.length;for(o=0;o<r;o++)s&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!o("esri-wasm")},t.load=function(){return a||(a=s.create((function(e,t){new Promise((function(e,t){r.e(122).then(function(){var t=[r(474)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){r({locateFile:function(e){return i.getAssetUrl("esri/geometry/support/"+e)},onAbort:function(e){t(new Error(e))}}).then((function(t){f(t),e()}))}))})))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=y(n),o=n===i,s=t._pe.ensureFloat64(i),a=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,s);return a&&g(n,r,s,o),a}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=y(n),s=n===o,a=t._pe.ensureFloat64(o),u=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,a,i);return u&&g(n,r,a,s),u}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case u.PE_TRANSFORM_P_TO_G:return n(e,t,i);case u.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(u=t.PeDefs||(t.PeDefs={})),function(e){var r={},n={};function i(e,n){var i=null,s=r[e];if(s||(s={},r[e]=s),s.hasOwnProperty(String(n)))i=s[n];else{var a=t._pe.PeFactory.prototype.factoryByType(e,n);t._pe.compare(a,t._pe.NULL)||(i=a,s[n]=i)}return o(i)}function o(e){if(e){var r=e.getType();switch(r){case u.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case u.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case u.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&u.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return i(u.PE_TYPE_COORDSYS,e)},e.factoryByType=i,e.fromString=function(e,r){var i=null,s=n[e];if(s||(s={},n[e]=s),s.hasOwnProperty(r))i=s[r];else{var a=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(a,t._pe.NULL)||(i=a,s[r]=i)}return o(i)},e.geogcs=function(e){return i(u.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return i(u.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return i(u.PE_TYPE_PROJCS,e)},e.unit=function(e){return i(u.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,s,a){var u=null,l=new t._pe.PeInteger(a);try{var c=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,s,l);if((a=l.val)&&(u=[c],a>1))for(var p=t._pe.getPointer(c),h=1;h<a;h++)u.push(t._pe.wrapPointer(p+r*h,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(l)}return u}}(l=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){e.destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];d(i),i.getEntries().forEach((function(e){d(e);var t=e.getGeogtran();d(t),t.getParameters().forEach(d),[t.getGeogcs1(),t.getGeogcs2()].forEach((function(e){d(e);var t=e.getDatum();d(t),d(t.getSpheroid()),d(e.getPrimem()),d(e.getUnit())}))}))}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})),function(e){e.geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=y(n),a=n===s,u=t._pe.ensureFloat64(s),l=0;i&&(l=t._pe.ensureFloat64(i));var c=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,u,l,o);return c&&g(n,r,u,a),c}}(t.PeGTTransformations||(t.PeGTTransformations={})),function(e){function r(e,r,n,i,o,s){var a,l;switch(t._pe.ensureCache.prepare(),e){case"dd":a=t._pe._pe_geog_to_dd,l=u.PE_DD_MAX;break;case"ddm":a=t._pe._pe_geog_to_ddm,l=u.PE_DDM_MAX;break;case"dms":a=t._pe._pe_geog_to_dms,l=u.PE_DMS_MAX}var c=0;r&&(c=t._pe.getPointer(r));var p=y(i),h=t._pe.ensureFloat64(p),f=_(n,l),d=a(c,n,h,o,t._pe.ensureInt32(f));if(d)for(var g=0;g<n;g++)s[g]=t._pe.UTF8ToString(f[g]);return d}function n(e,r,n,i,o){var s;switch(t._pe.ensureCache.prepare(),e){case"dd":s=t._pe._pe_dd_to_geog;break;case"ddm":s=t._pe._pe_ddm_to_geog;break;case"dms":s=t._pe._pe_dms_to_geog}var a=0;r&&(a=t._pe.getPointer(r));var u=i.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(u),c=t._pe.ensureFloat64(new Array(2*n)),p=s(a,n,l,c);return p&&g(o,n,c),p}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,s,a){t._pe.ensureCache.prepare();var l=0;e&&(l=t._pe.getPointer(e));var c=y(n),p=t._pe.ensureFloat64(c),h=_(r,u.PE_MGRS_MAX),f=t._pe.ensureInt32(h),d=t._pe._pe_geog_to_mgrs_extended(l,r,p,i,o,s,f);if(d)for(var g=0;g<r;g++)a[g]=t._pe.UTF8ToString(h[g]);return d},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),c=t._pe._pe_mgrs_to_geog_extended(s,r,u,i,l);return c&&g(o,r,l),c}}(c=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,s,a){t._pe.ensureCache.prepare();var l=0;e&&(l=t._pe.getPointer(e));var c=y(n),p=t._pe.ensureFloat64(c),h=_(r,u.PE_MGRS_MAX),f=t._pe.ensureInt32(h),d=t._pe._pe_geog_to_usng(l,r,p,i,o,s,f);if(d)for(var g=0;g<r;g++)a[g]=t._pe.UTF8ToString(h[g]);return d},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),a=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),l=t._pe._pe_usng_to_geog(o,r,a,u);return l&&g(i,r,u),l}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var a=y(n),l=t._pe.ensureFloat64(a),c=_(r,u.PE_UTM_MAX),p=t._pe.ensureInt32(c),h=t._pe._pe_geog_to_utm(s,r,l,i,p);if(h)for(var f=0;f<r;f++)o[f]=t._pe.UTF8ToString(c[f]);return h},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var s=0;e&&(s=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),c=t._pe._pe_utm_to_geog(s,r,u,i,l);return c&&g(o,r,l),c}}(p=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,s;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(s=r.get(n))[i]&&(o=s[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),s||(s=[],r.set(n,s)),s[i]=o),o}}(h=t.PePCSInfo||(t.PePCSInfo={})),function(e){e.version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(t.PeVersion||(t.PeVersion={})),t._init=f}.apply(null,n))||(e.exports=i)},311:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(312)],void 0===(i=function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];i instanceof r?this.steps.push(i):this.steps.push(new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,s=t.steps;o<s.length;o++){var a=s[o],u=r.fromGE(a);n.steps.push(u),i+=u.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--){var n=this.steps[r];t.steps.push(n.getInverse())}return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var s=this._cached_projection[e.cacheKey(t,r)];return void 0===s?null:s},e}()}.apply(null,n))||(e.exports=i)},312:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}.apply(null,n))||(e.exports=i)},314:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var o=0;o<i.length;o++)r[n][o]=e(i[o])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},315:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(152),r(200),r(623),r(163),r(234),r(178),r(349),r(243),r(224),r(263),r(559)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var _=new n.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});t.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var y=new h.default,g=new h.default,v=new h.default,m={esriGeometryPoint:p.convertToPoint,esriGeometryPolyline:p.convertToPolyline,esriGeometryPolygon:p.convertToPolygon,esriGeometryMultipoint:p.convertToMultipoint};function b(e,t,r,n,i){void 0===n&&(n=e.hasZ),void 0===i&&(i=e.hasM);var o=e.hasZ&&n,s=e.hasM&&i;if(r){var a=p.quantizeOptimizedGeometry(v,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return p.convertToPoint(a,o,s)}return p.convertToPoint(t,o,s)}function x(e,n,o){return r.__awaiter(this,void 0,void 0,(function(){var l,c,p,h,d,_;return r.__generator(this,(function(r){switch(r.label){case 0:return e?(l=e.where,e.where=l=l&&l.trim(),(!l||/^1 *= *1$/.test(l)||n&&n===l)&&(e.where=null),e.geometry?[4,S(e)]:[2,e]):[2,null];case 1:return c=r.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel&&(p=e.geometry.spatialReference,(c=s.getGeometryExtent(c)).spatialReference=p),e.geometry=c,[4,f.checkProjectionSupport(c.spatialReference,o)];case 2:return r.sent(),[4,u.normalizeCentralMeridian(a.fromJSON(c))];case 3:if(h=r.sent()[0],i.isNone(h))throw t.QUERY_ENGINE_EMPTY_RESULT;return d=h.toJSON(),[4,f.project(d,d.spatialReference,o)];case 4:if(!(_=r.sent()))throw t.QUERY_ENGINE_EMPTY_RESULT;return _.spatialReference=o,e.geometry=_,[2,e]}}))}))}function S(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,s,a,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.geometry,n=e.distance,i=e.units,null==n||"vertexAttributes"in t?[2,t]:(s=t.spatialReference,a=i?_.fromJSON(i):o.getUnitString(s),s&&(l.isGeographic(s)||l.isWebMercator(s))?(c=t,[3,3]):[3,1]);case 1:return[4,f.checkProjectionSupport(s,l.WGS84).then((function(){return f.project(t,l.WGS84)}))];case 2:c=r.sent(),r.label=3;case 3:return u=c,[4,d.getGeodesicBufferOperator()];case 4:return[2,r.sent()(u.spatialReference,u,n,a)]}}))}))}t.transformCentroid=b,t.getCentroid=function(e,t,r){return"esriGeometryPolygon"===e.geometryType&&t&&(t.centroid||t.geometry)?(t.centroid||(t.centroid=c.getCentroidOptimizedGeometry(new h.default,t.geometry,e.hasZ,e.hasM)),b(e,t.centroid,r)):null},t.getGeometry=function(e,t,r,n,i,o,s,a){void 0===s&&(s=t),void 0===a&&(a=r);var u=t&&s,l=r&&a,c=n?"coords"in n?n:n.geometry:null;if(!c)return null;if(i){var h=p.generalizeOptimizedGeometry(g,c,t,r,e,i,s,a);return o&&(h=p.quantizeOptimizedGeometry(v,h,u,l,e,o)),m[e](h,u,l)}return o?(h=p.quantizeOptimizedGeometry(v,c,t,r,e,o,s,a),m[e](h,u,l)):(p.removeZMValues(y,c,t,r,s,a),m[e](y,u,l))},t.normalizeQuery=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,a,u;return r.__generator(this,(function(r){if(i=e.outFields,o=e.orderByFields,s=e.groupByFieldsForStatistics,a=e.outStatistics,i)for(u=0;u<i.length;u++)i[u]=i[u].trim();if(o)for(u=0;u<o.length;u++)o[u]=o[u].trim();if(s)for(u=0;u<s.length;u++)s[u]=s[u].trim();if(a)for(u=0;u<a.length;u++)a[u].onStatisticField&&(a[u].onStatisticField=a[u].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),[2,x(e,t,n)]}))}))},t.normalizeFilter=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,x(e,t,n)]}))}))},t.normalizeQueryLike=x,t.cleanFromGeometryEngine=function(e){return e&&I in e?JSON.parse(JSON.stringify(e,P)):e};var I="_geVersion",P=function(e,t){return e!==I?t:void 0}}.apply(null,n))||(e.exports=i)},328:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(329)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var n=r.parseFeatureQuery(e,t).queryResult.featureResult;if(n&&n.features&&n.features.length&&n.objectIdFieldName)for(var i=n.objectIdFieldName,o=0,s=n.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[i])}return n}}.apply(null,n))||(e.exports=i)},329:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156),r(268),r(330),r(331)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function p(e){return e>=u.length?null:u[e]}function h(e){return e>=c.length?null:c[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function d(e,t,r){for(var n=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var i=e.getUInt32(),o=e.pos()+i,s=0;e.pos()<o;)t.addCoordinatePoint(n,e.getSInt64(),0,s++);break;case 1:case 2:default:e.skip()}return n}function _(e,t,r){for(var n=t.createGeometry(r),i=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),s=e.pos()+o,a=0;e.pos()<s;)t.addLength(n,e.getUInt32(),a++);break;case 3:for(var u=e.getUInt32(),l=(s=e.pos()+u,0),c=0;e.pos()<s;)t.addCoordinate(n,e.getSInt64(),c,l),++l===i&&(c++,l=0);break;case 1:default:e.skip()}return n}function y(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g(e){for(var t,r={type:p(0)};e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.type=p(e.getEnum());break;case 3:r.alias=e.getString();break;case 4:r.sqlType=(t=e.getEnum())>=l.length?null:l[t];break;case 5:case 6:default:e.skip()}return r}function v(e,t,r,n){for(var i=t.createFeature(r),o=0;e.next();)switch(e.tag()){case 1:var s=n[o++].name;i.attributes[s]=e.processMessage(y);break;case 2:i.geometry=e.processMessageWithArgs(_,t,r);break;case 4:i.centroid=e.processMessageWithArgs(d,t,r);break;default:e.skip()}return i}function m(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function b(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function x(e){for(var t={originPosition:h(0)};e.next();)switch(e.tag()){case 1:t.originPosition=h(e.getEnum());break;case 2:t.scale=e.processMessage(m);break;case 3:t.translate=e.processMessage(b);break;default:e.skip()}return t}function S(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function I(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function P(e,t){var r=t.createFeatureResult();r.geometryType=f(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(S);break;case 7:r.geometryType=f(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(I,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(x);break;case 9:var i=e.getBool();r.exceededTransferLimit=i;break;case 13:t.addField(r,e.processMessage(g));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(v,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function w(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(P,t);break;default:e.skip()}return r}t.parseFeatureQuery=function(e,t){var n=function(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}(t);try{for(var u=new i(new Uint8Array(e),new DataView(e)),l={};u.next();)switch(u.tag()){case 2:l.queryResult=u.processMessageWithArgs(w,n);break;default:u.skip()}return l}catch(e){var c=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(c),{queryResult:{featureResult:n.createFeatureResult()}}}}}.apply(null,n))||(e.exports=i)},330:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(174),r(177),r(170),r(207),r(194),r(248)],void 0===(i=function(e,t,r,n,i,o,s,a){function u(e,t){return t}function l(e,t,r,n){switch(r){case 0:return f(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?f:d)(e,t+n,1)}}function c(e,t,r,n){switch(r){case 0:return f(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?f:d)(e,t+n,1);case 2:return f(e,t,2)}}function p(e,t,r,n){switch(r){case 0:return f(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?f:d)(e,t+n,1);case 2:return f(e,t,3)}}function h(e,t,r,n){switch(r){case 0:return f(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?f:d)(e,t+n,1);case 2:return f(e,t,2);case 3:return f(e,t,3)}}function f(e,t,r){var n=e.translate,i=e.scale;return n[r]+t*i[r]}function d(e,t,r){var n=e.translate,i=e.scale;return n[r]-t*i[r]}Object.defineProperty(t,"__esModule",{value:!0});var _=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new o.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=a.getGeometryZScaler(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(var r=0,n=e.features;r<n.length;r++)t(n[r].geometry)}},e.prototype.createSpatialReference=function(){return new i},e.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t));var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var n in t.attributes){var i=t.attributes[n];"string"==typeof i&&i.length>r&&(t.attributes[n]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){var t=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePoint(e,r,i)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePolygon(e,r,i)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,r,n,i){return t.addCoordinatePolyline(e,r,i)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,r,n,i){return t.addCoordinateMultipoint(e,r,i)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:n.neverReached(e.geometryType)}},e.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new o.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},e.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var n=this.lengths.reduce((function(e,t){return e+t}),0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var i=this.transformPathLikeValue(t,r),o=e[e.length-1];0===r&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=i},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?h:t?c:r?p:l},e}();t.Context=_}.apply(null,n))||(e.exports=i)},331:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(200),r(178),r(274),r(304),r(224)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new o.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!n.equals(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=r.getMetersPerVerticalUnitForSR(this.options.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==t)for(var i=0,o=e.features;i<o.length;i++){var s=o[i];if(s.geometry&&s.geometry.coords)for(var a=s.geometry.coords,u=2;u<a.length;u+=3)a[u]*=t}}},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new i.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new s.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new s.default},e}();t.Context=a}.apply(null,n))||(e.exports=i)},348:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(152),r(153),r(172),r(163),r(234),r(304),r(328),r(314),r(248),r(161)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h){function f(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=a.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var o=n.timeExtent,s=o.start,u=o.end;null==s&&null==u||(i.time=s===u?s:(null==s?"null":s)+","+(null==u?"null":u)),delete n.timeExtent}return i}function d(e,t,o,a,l){void 0===a&&(a={});var c="string"==typeof e?s.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",u.normalizeCentralMeridian(h,null,a).then((function(e){var s=e&&e[0];i.isSome(s)&&((t=t.clone()).geometry=s);var u=p.mapParameters(r.__assign(r.__assign(r.__assign(r.__assign({},c.query),{f:o}),l),f(t,l)));return n(c.path+"/query",r.__assign(r.__assign({},a),{query:u}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.queryToQueryStringParameters=f,t.executeQuery=function(e,t,n,i){var o;return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(null===(o=t.timeExtent)||void 0===o?void 0:o.isEmpty)?(a={data:{features:[]}},[3,3]):[3,1];case 1:return[4,d(e,t,"json",i)];case 2:a=r.sent(),r.label=3;case 3:return s=a,h.applyFeatureSetZUnitScaling(t,n,s.data),[2,s]}}))}))},t.executeQueryPBF=function(e,t,r,n){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:new l.default}):d(e,t,"pbf",n).then((function(e){var t,n;return t=c.parsePBFFeatureQuery(e.data,r),(n=e).data=t,n}))},t.executeQueryForIds=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{objectIds:[]}}):d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{count:0}}):d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:{count:0,extent:null}}):d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e}))},t.runQuery=d}.apply(null,n))||(e.exports=i)},349:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function n(e,t,n,i,o,s){for(var a=r(o,s),u=n,l=n+a,c=0,p=0,h=0,f=0,d=0,_=0,y=i-1;_<y;_++,u+=a,l+=a){var g=t[u],v=t[u+1],m=t[u+2],b=t[l],x=t[l+1],S=t[l+2],I=g*x-b*v;f+=I,c+=(g+b)*I,p+=(v+x)*I,o&&(h+=(m+S)*(I=g*S-b*m),d+=I),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),v<e[2]&&(e[2]=v),v>e[3]&&(e[3]=v),o&&(m<e[4]&&(e[4]=m),m>e[5]&&(e[5]=m))}if(f>0&&(f*=-1),d>0&&(d*=-1),!f)return null;var P=[c,p,.5*f];return o&&(P[3]=h,P[4]=.5*d),P}function i(e,t,n,i,l){for(var c=r(i,l),p=t,h=t+c,f=0,d=0,_=0,y=0,g=0,v=n-1;g<v;g++,p+=c,h+=c){var m,b=e[p],x=e[p+1],S=e[p+2],I=e[h],P=e[h+1],w=e[h+2],T=i?s(b,x,S,I,P,w):o(b,x,I,P);T&&(f+=T,i?(d+=T*(m=u(b,x,S,I,P,w))[0],_+=T*m[1],y+=T*m[2]):(d+=T*(m=a(b,x,I,P))[0],_+=T*m[1]))}return f>0?i?[d/f,_/f,y/f]:[d/f,_/f]:n>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,n){var i=r-e,o=n-t;return Math.sqrt(i*i+o*o)}function s(e,t,r,n,i,o){var s=n-e,a=i-t,u=o-r;return Math.sqrt(s*s+a*a+u*u)}function a(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function u(e,t,r,n,i,o){return[e+.5*(n-e),t+.5*(i-t),r+.5*(o-r)]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,o,s){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var a=e.coords,u=[],l=o?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],c=t.lengths,p=t.coords,h=r(o,s),f=0,d=0,_=c;d<_.length;d++){var y=_[d],g=n(l,p,f,y,o,s);g&&u.push(g),f+=y*h}if(u.sort((function(e,t){var r=e[2]-t[2];return 0===r&&o&&(r=e[4]-t[4]),r})),u.length){var v=6*u[0][2];a[0]=u[0][0]/v,a[1]=u[0][1]/v,o&&(v=6*u[0][4],a[2]=0!==v?u[0][3]/v:0),(a[0]<l[0]||a[0]>l[1]||a[1]<l[2]||a[1]>l[3]||o&&(a[2]<l[4]||a[2]>l[5]))&&(a.length=0)}if(!a.length){var m=t.lengths[0]?i(p,0,c[0],o,s):null;if(!m)return null;a[0]=m[0],a[1]=m[1],o&&m.length>2&&(a[2]=m[2])}return e},t.lineCentroid=i}.apply(null,n))||(e.exports=i)},361:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.jsonAdapter={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,n){var i=new r(e.getPointX(t),e.getPointY(t),n),o=e.hasZ(t),s=e.hasM(t);return o&&(i.z=e.getPointZ(t)),s&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new n(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var n=e.hasZ(t),i=e.hasM(t),o=new s(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){var a=e.getZExtent(t);o.zmin=a.vmin,o.zmax=a.vmax}if(i){var u=e.getMExtent(t);o.mmin=u.vmin,o.mmax=u.vmax}return o}};var r=function(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0},n=function(e,t,r,n){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)},i=function(e,t,r,n){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)},o=function(e,t,r,n){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)},s=function(e,t,r,n,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=n,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}.apply(null,n))||(e.exports=i)},363:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(198),r(1031)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=new i.WhereClauseCache(50,500),s="feature-store:unsupported-query",a=n.SetFromValues(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function u(e,t){return e?o.get(e,t):null}function l(e,t,n,i){void 0===i&&(i=!0);for(var o=[],a=0,p=t;a<p.length;a++){var h=p[a];if("*"!==h&&!e.has(h))if(i){var f=c(h);try{var d=u(f,e);if(!d)throw new r(s,"invalid SQL expression",{where:f});if(!d.isStandardized)throw new r(s,"expression is not standard",{clause:d});l(e,d.fieldNames,"expression contains missing fields")}catch(e){var _=e&&e.details;if(_&&(_.clause||_.where))throw e;_&&_.missingFields?o.push.apply(o,_.missingFields):o.push(h)}}else o.push(h)}if(o.length)throw new r(s,n,{missingFields:o})}function c(e){return e.split(" as ")[0]}t.validateWhere=function(e,t){if(!t)return!0;var n=o.get(t,e);if(!n)throw new r(s,"invalid SQL expression",{where:t});if(!n.isStandardized)throw new r(s,"where clause is not standard",{where:t});return l(e,n.fieldNames,"where clause contains missing fields"),!0},t.validateHaving=function(e,t,n){if(!t)return!0;var i=o.get(t,e);if(!i)throw new r(s,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new r(s,"having does not contain a valid aggregate function",{having:t});var a=i.fieldNames;if(l(e,a,"having contains missing fields"),!i.getExpressions().every((function(t){var r=t.aggregateType,i=t.field,o=e.has(i)&&e.get(i).name;return n.some((function(t){var n=t.onStatisticField,i=t.statisticType;return(e.has(n)&&e.get(n).name)===o&&i.toLowerCase().trim()===r}))})))throw new r(s,"expressions in having should also exist in outStatistics",{having:t});return!0},t.getWhereClause=u,t.validateFields=l,t.getExpressionFromFieldName=c,t.getAliasFromFieldName=function(e){return e.split(" as ")[1]},t.hasInvalidFieldType=function(e,t){var r=t.get(e);return!!r&&!a.has(r.type)}}.apply(null,n))||(e.exports=i)},383:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,n){return t._tasks.push(new i(r,n,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,n){return t._tasks.unshift(new i(r,n,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,n=this._tasks;t<n.length;t++)n[t].reject(e);this._tasks.length=0},e}();t.default=n;var i=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,n))||(e.exports=i)},384:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349),r(274),r(224)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new n.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new i.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,n))||(e.exports=i)},402:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(190),r(156),r(152),r(193),r(173),r(178),r(243),r(466),r(424),r(384)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f){Object.defineProperty(t,"__esModule",{value:!0});var d=o.getLogger("esri.layers.graphics.data.FeatureStore"),_=function(){function e(e){this.geometryInfo=e,this._boundsStore=new p.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new i,this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=u.create(u.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var n=e._boundsStore.get(r.objectId);n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._add(n)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var n=r[t],i=this._featuresById.get(n);i&&this._remove(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n],s=this._boundsStore.get(o.objectId);s&&t(a.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,n){e._markedIds.has(n)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,a,c,p,f,d,_,y,g,v,m,b;return r.__generator(this,(function(r){return i=n.returnGeometry,o=n.returnCentroid,s=n.returnOutline,a=n.pixelBuffer,c=new Set,p=[],f=a*e.resolution,d=u.pad(e.bounds,f,u.create()),h.createTileFeatures(p,c,this.geometryInfo,this,d,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||o)&&(_=l.getInfo(t))&&(y=_.valid,g=y[0],v=y[1],d[0]<g&&(m=u.fromValues(v-f,d[1],v,d[3]),h.createTileFeatures(p,c,this.geometryInfo,this,m,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[v,e.bounds[3]]})),d[2]>v&&(b=u.fromValues(g,d[1],g+f,d[3]),h.createTileFeatures(p,c,this.geometryInfo,this,b,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g-v+e.bounds[0],e.bounds[3]]}))),p.sort((function(e,t){return e.localId-t.localId})),[2,{features:p,objectIds:c}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,i=this._featuresById.get(t);if(this._markedIds.add(t),i?(e.localId=i.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):s.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=c.getBoundsOptimizedGeometry(r||u.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else d.error(new n("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return s.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=_}.apply(null,n))||(e.exports=i)},424:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(173),r(243),r(224),r(302),r(315)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new i.default,u={esriGeometryPoint:n.convertToPoint,esriGeometryPolyline:n.convertToPolyline,esriGeometryPolygon:n.convertToPolygon,esriGeometryMultipoint:n.convertToMultipoint};t.executeTileQueryForIds=function(e,t,n){var i=n.pixelBuffer*t.resolution,o=r.pad(t.bounds,i,r.create()),s=[];return e.featureStore.forEachInBounds(o,(function(t){return s.push(e.featureAdapter.getObjectId(t))})),s},t.createTileFeatures=function(e,t,r,n,i,p,h,f,d){var _=u[r.geometryType],y=l[r.geometryType],g="esriGeometryPolygon"===r.geometryType&&!f,v=r.hasZ?r.hasM?4:3:r.hasM?3:2;h&&!p?n.forEachInBounds(i,(function(n){return function(e,t,r,n,i){if(!t.has(r.objectId)){var a=s.getCentroid(n,r,i),u=r.attributes;a&&(t.add(r.objectId),e.push(new o.Feature(u,r.localId,null,a)))}}(e,t,n,r,d)})):p&&!h?n.forEachInBounds(i,(function(r){return function(e,t,r,n,i,s,u,l){if(!t.has(r.objectId)){var p=r.attributes,h=n(c(a,r.geometry,i,s,l,u),!1,!1);h&&(t.add(r.objectId),e.push(new o.Feature(p,r.localId,h,null)))}}(e,t,r,_,v,y,d,g)})):n.forEachInBounds(i,(function(n){return function(e,t,r,n,i,u,l,p,h){if(!t.has(r.objectId)){var f=s.getCentroid(n,r,i),d=r.attributes,_=u(c(a,r.geometry,l,p,h,i),!1,!1);_&&f&&(t.add(r.objectId),e.push(new o.Feature(d,r.localId,_,f)))}}(e,t,n,r,d,_,v,y,g)}))};var l={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function c(e,t,r,i,o,s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var a,u,l,c,p=t.coords,h=t.lengths;if(!h.length)return e.coords[0]=n.quantizeX(s,p[0]),e.coords[1]=n.quantizeY(s,p[1]),e.coords.length=r,e;for(var f=0,d=0,_=d,y=0,g=h;y<g.length;y++){var v=g[y];if(!(v<i))if(d=_,l=a=n.quantizeX(s,p[f]),c=u=n.quantizeY(s,p[f+1]),e.coords[d]=l,e.coords[d+1]=c,f+=r,1!==v){var m=(l=n.quantizeX(s,p[f]))-a,b=(c=n.quantizeY(s,p[f+1]))-u,x=b/m;d+=2,e.coords[d]=m,e.coords[d+1]=b,a=l,u=c,f+=r;for(var S=2;S<v;S++){if(l=n.quantizeX(s,p[f]),c=n.quantizeY(s,p[f+1]),l!==a||c!==u){var I=l-a,P=c-u,w=P/I;x!==w&&(isFinite(x)||isFinite(w))||!(o||(b>=0&&P>=0||b<=0&&P<=0)&&(m>=0&&I>=0||m<=0&&I<=0))?(m=I,b=P,d+=2):(m+=I,b+=P),e.coords[d]=m,e.coords[d+1]=b,x=w,a=l,u=c}f+=r}var T=(d+2-_)/2;T>=i&&(e.lengths.push(T),_=d+2)}else e.lengths.push(1),_=d+2}return e.coords.length>_&&(e.coords.length=_),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=c}.apply(null,n))||(e.exports=i)},466:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(382),r(161)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={minX:0,minY:0,maxX:0,maxY:0},o=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=n(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,n){t[r++]=n})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,n=function(e,t){return i.minX=t[0],i.minY=t[1],i.maxX=t[2],i.maxY=t[3],e.search(i)}(this._index,e);r<n.length;r++){var o=n[r];t(this._idByBounds.get(o))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=o}.apply(null,n))||(e.exports=i)},467:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(186),r(206),r(450)],void 0===(i=function(e,t,r,n,i,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=i.enums.WGLVVFlag;function u(e){return{value:e.value,size:n.toPt(e.size)}}function l(e){return e.map((function(e){return u(e)}))}function c(e){if("string"==typeof e||"number"==typeof e)return n.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:l(t.stops)}}t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=u,t.normalizeSizeStops=l,t.normalizeSizeElement=c,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach((function(e){var r=e.type;e.field&&(t[r]=e.field)})),t};var p=function(e){for(var t=[],r=[],i=l(e),s=i.length,a=0;a<6;a++){var u=i[Math.min(a,s-1)];t.push(u.value),r.push(null==u.size?o.NAN_MAGIC_NUMBER:n.pt2px(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function h(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(i.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,n=0;n<8;++n){var o=r[Math.min(n,r.length-1)];t.values[n]=o.value,t.opacities[n]=o.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=s}return t}t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,n=t?{}:null;if(!t)return{vvFields:t,vvRanges:n};for(var o=0,u=e;o<u.length;o++){var f=u[o],d=f.type;if(f.field&&(t[d]=f.field),"size"===d){n.size||(n.size={});var _=f;switch(i.getTypeOfSizeVisualVariable(_)){case a.SIZE_MINMAX_VALUE:n.size.minMaxValue={minDataValue:_.minDataValue,maxDataValue:_.maxDataValue,minSize:c(_.minSize),maxSize:c(_.maxSize)};break;case a.SIZE_SCALE_STOPS:n.size.scaleStops={stops:l(_.stops)};break;case a.SIZE_FIELD_STOPS:if(_.levels){var y={};for(var g in _.levels)y[g]=p(_.levels[g]);n.size.fieldStops={type:"level-dependent",levels:y}}else n.size.fieldStops=r.__assign({type:"static"},p(_.stops));break;case a.SIZE_UNIT_VALUE:n.size.unitValue={unit:_.valueUnit,valueRepresentation:_.valueRepresentation}}}else if("color"===d){var v=s.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!v)continue;n.color=v.color;for(var m=0;m<32;m+=4)i.color.premultiplyAlpha(n.color.colors,m,!0)}else if("opacity"===d)n.opacity=h(f);else if("rotation"===d){var b=f;n.rotation={type:b.rotationType}}}return{vvFields:t,vvRanges:n}}}.apply(null,n))||(e.exports=i)},512:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),a=r.getAttribute(e,i);null==t||isNaN(t)||(o=Math.min(o,t)),null==a||isNaN(a)||(s=Math.max(s,a))}));else{var a=n||i;t.forEach((function(e){var t=r.getAttribute(e,a);null==t||isNaN(t)||(o=Math.min(o,t),s=Math.max(s,t))}))}return{start:o,end:s}},t.getTimeOperator=function(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var o=t.start,s=t.end;return null===o&&null===s?null:void 0===o&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){if(null!=n&&null!=i&&n===i){var o=n;return function(n){return o>=e.getAttribute(n,t)&&o<=e.getAttribute(n,r)}}return null!=n&&null!=i?function(o){return s=n,a=i,u=e.getAttribute(o,t),l=e.getAttribute(o,r),!(u>a||l<s);var s,a,u,l}:null!=n?function(t){return!(e.getAttribute(t,r)<n)}:null!=i?function(r){return!(e.getAttribute(r,t)>i)}:void 0}(r,n,i,o,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){return e.getAttribute(i,t)>=r&&e.getAttribute(i,t)<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,o,s)}}.apply(null,n))||(e.exports=i)},558:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,n))||(e.exports=i)},559:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(153),r(407),r(479),r(163),r(178),r(1032),r(243),r(224),r(263),r(315),r(161)],void 0===(i=function(e,t,n,i,o,s,a,u,l,c,p,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var _={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},g={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},v={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function m(){return new Promise((function(e,t){Promise.all([r.e(12),r.e(29)]).then(function(){var t=[r(609)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}t.importGeometryEngine=m,t.getGeodesicBufferOperator=function(){return m().then((function(e){return e.geodesicBuffer}))},t.getSpatialQueryOperator=function(e,t,r,n,i){if(u.isPolygon(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var l=p.convertFromPolygon(new h.default,t,!1,!1);return o.resolve((function(e){return c.polygonContainsPoint(l,!1,!1,e)}))}if(u.isPolygon(t)&&"esriGeometryMultipoint"===r){var f=p.convertFromPolygon(new h.default,t,!1,!1);if("esriSpatialRelContains"===e)return o.resolve((function(e){return c.polygonContainsMultipoint(f,!1,!1,e,n,i)}))}if(u.isExtent(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return o.resolve((function(e){return s.extentContainsPoint(t,d.getGeometry(r,n,i,e))}));if(u.isExtent(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return o.resolve((function(e){return s.extentContainsMultipoint(t,d.getGeometry(r,n,i,e))}));if(u.isExtent(t)&&"esriSpatialRelIntersects"===e){var y=a.getExtentIntersector(r);return o.resolve((function(e){return y(t,d.getGeometry(r,n,i,e))}))}return m().then((function(o){var s=o[_[e]].bind(null,t.spatialReference,t);return function(e){return s(d.getGeometry(r,n,i,e))}}))},t.checkSpatialQuerySupport=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var o,s;return n.__generator(this,(function(n){if(o=e.spatialRel,!(s=e.geometry))return[2];if(!0!==y[o])throw new i("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(!l.isValid(s.spatialReference)||!l.isValid(r))return[2];if(!function(e){return!0===g[u.getJsonType(e)]}(s))throw new i("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===v[e]}(t))throw new i("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});return e.outSR?[2,f.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSR)]:[2]}))}))},t.canQueryWithRBush=function(e){if(u.isExtent(e))return!0;if(u.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}return!0}return!1}}.apply(null,n))||(e.exports=i)},561:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(164),r(156),r(168),r(152),r(153),r(255),r(246),r(186),r(408),r(206),r(467),r(161)],void 0===(i=function(e,t,n,i,o,s,a,u,l,c,p,h,f,d,_){Object.defineProperty(t,"__esModule",{value:!0});var y=s.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=h.debug.createDebugLogger(h.debug.DEBUG_ATTR_UPDATES,y);t.LOCAL_ID_TYPE_AGGREGATE=1;var v=function(e){return(2147483648&e)>>>31},m=function(e){return 2147483647&e};t.isAggregateId=function(e){return v(e)===t.LOCAL_ID_TYPE_AGGREGATE};var b=function(e,t){return function(r,n,i){var o;try{o=t(r,n,i)}catch(e){o=NaN}return(null===o||isNaN(o)||o===1/0)&&e||o}},x={sharedArrayBuffer:o("esri-shared-array-buffer"),oesTextureFloat:o("esri-webgl-texture-float"),maxTextureSize:o("esri-webgl-max-texture-size"),atomics:o("esri-atomics")},S=function(){function e(e,t,r,n){this.texelSize=4;var i=n.pixelType,o=n.layout,s=n.textureOnly;this.textureOnly=s||!1,this.pixelType=i,this._ctype=t,this.layout=o,this._resetRange(),this._shared=e,s||(this.data=this._initData(i,r,e,t))}return Object.defineProperty(e.prototype,"buffer",{get:function(){return u.andThen(this.data,(function(e){return e.buffer}))},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){var r=m(e);return u.unwrap(this.data)[r*this.texelSize+t]},e.prototype.setData=function(e,t,r){var n=m(e),i=1<<t;0!=(this.layout&i)?(this.data[n*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)):y.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.lock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):o("esri-2d-debug")&&y.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.unlock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):o("esri-2d-debug")&&y.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=u.unwrap(this.data);t.set(r),this.data=t}},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var n=!(this._shared||"local"===this._ctype),i=this.pixelType,o=this.layout,s=u.unwrap(this.data);return s.slice?{start:e,end:t,data:n&&s.slice(e*r,(t+1)*r)||null,pixelType:i,layout:o}:n?{start:e,end:t,data:new(h.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:i,layout:o}:{start:e,end:t,data:null,pixelType:i,layout:o}},e.prototype._initData=function(e,t,r,n){for(var i=r&&"local"!==n?SharedArrayBuffer:ArrayBuffer,o=h.Utils.getPixelArrayCtor(e),s=new o(new i(t*t*4*o.BYTES_PER_ELEMENT)),a=0;a<s.length;a+=4)s[a+1]=255;return s},e.prototype._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},e}(),I=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(h.definitions.MAX_FILTERS),this._freeTexelsList=[],this._abortController=l.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=x.oesTextureFloat?5126:5121;g("Creating AttributeStore "+(x.sharedArrayBuffer?"with":"without")+" shared memory"),o("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&y.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map((function(){return null}))}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.invalidateResources=function(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=l.createAbortController()},e.prototype.createLocalId=function(e,t){if(void 0===t&&(t=!1),!this._idMap.has(e)){var r=function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeTexel(),t);this._idMap.set(e,-1===r?0:r),this._localToObjectId.set(r,e)}return this._idMap.get(e)},e.prototype.addLocalId=function(e){this._getBlock(0).setData(e,0,0),this._freeTexelsList.push(m(e))},e.prototype.removeLocalId=function(e){var t=this._idMap.get(e);return this._idMap.delete(e),this._localToObjectId.delete(t),t},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);o("esri-2d-debug")&&!t&&console.debug("Called freeLocalId for an invalid id"),this._getBlock(0).setData(t,0,0),this._idMap.delete(e),this._localToObjectId.delete(t),this._freeTexelsList.push(m(t))},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.setHighlight=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,o,s,a,u=this;return n.__generator(this,(function(n){switch(n.label){case 0:for(this._getBlock(0).lock(),this._idsToHighlight.forEach((function(e){var t=u.getLocalId(e);if(t){var r=u._getBlock(0).getData(t,0);u._getBlock(0).setData(t,0,-2&r)}})),this._idsToHighlight.clear(),t=0,r=e;t<r.length;t++)i=r[t],this._idsToHighlight.add(i);for(o=0;o<e.length;o++)null!=(s=this.getLocalId(e[o]))&&(a=this._getBlock(0).getData(s,0),this._getBlock(0).setData(s,0,1|a));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return n.sent(),[2]}}))}))},e.prototype.addHighlight=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){return[2]}))}))},e.prototype.removeHighlight=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){return[2]}))}))},e.prototype.updateFilters=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,o,s,a=this;return n.__generator(this,(function(n){switch(n.label){case 0:return t=e.config,r=e.service,i=e.spatialReference,o=t.filters,s=o.map((function(t,n){return a._updateFilter(e,t,n,r,i)})),[4,l.all(s)];case 1:return n.sent(),[2]}}))}))},e.prototype.setAttributeBindings=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:y.error(new i("attribute-store","Found invalid renderer type: "+e))}return[2]}))}))},e.prototype.setData=function(e,t,r,n){this._getBlock(t).setData(e,r,n)},e.prototype.getData=function(e,t,r){return this._getBlock(t).getData(e,r)},e.prototype.getHighlightFlag=function(e){return this._idsToHighlight.has(e)?d.HIGHLIGHT_FLAG:0},e.prototype.setAttributeData=function(e,t,r,n){var i=this,o=e;this._getBlock(0).setData(o,0,this.getFilterFlags(t));var s=this._attributeComputeMap,u=x.oesTextureFloat?1:2;s.forEach((function(e,s){var l=s*u%4,c=Math.floor(s*u/4),p=i._getBlock(c+d.ATTRIBUTE_DATA_VV),f=e(t,{$view:n},r);if(x.oesTextureFloat)p.setData(o,l,f);else if(f===h.definitions.NAN_MAGIC_NUMBER)p.setData(o,l,255),p.setData(o,l+1,255);else{var _=a.clamp(Math.round(f),-32767,32766)+32768,y=255&_,g=(65280&_)>>8;p.setData(o,l,y),p.setData(o,l+1,g)}}))},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map((function(e){return u.isSome(e)?e.toMessage():null}))};return this._currUpdate=this._createResources().then((function(){var r=function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then((function(){return t.resolve()}))}},n=e._client.update(t,e._signal).then(r).catch(r);return e._client.render(),n})).catch((function(t){return l.isAbortError(t)?(e._createResourcesPromise=null,e._createResources()):(y.error(new i("mapview-attribute-store","Encountered an error during client update",t)),l.resolve())})),this._currUpdate},e.prototype._createResources=function(){var e=this;if(u.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(d.ATTRIBUTE_DATA_ANIMATION),g("Initializing AttributeStore");var t={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:u.mapMany(this._blocks,(function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}}))},r=this._client.initialize(t,this._signal).catch((function(t){l.isAbortError(t)?e._createResourcesPromise=null:y.error(new i("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=r,r.then((function(){return u.isNone(e._createResourcesPromise)?e._createResources():void 0})),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(u.isSome(t))return t;g("Initializing AttributeBlock at index "+e);var r=x.sharedArrayBuffer,n=this._client.type,i=new S(r,n,this._size,this._blockDescriptors[e]);return this._blocks[e]=i,this._createResourcesPromise=null,i},e.prototype._expand=function(){if(this._size<x.maxTextureSize){var e=this._size<<=1;return g("Expanding block size to",e,this._blocks),u.forEachSome(this._blocks,(function(t){return t.expand(e)})),this._createResourcesPromise=null,this._size=e,0}return y.error(new i("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeTexel=function(){return this._freeTexelsList.length?this._freeTexelsList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,r,i,o,s){return n.__awaiter(this,void 0,void 0,(function(){var a,l,c,p,h,f,d,_=this;return n.__generator(this,(function(n){switch(n.label){case 0:return a=this._filters[i],(u.isSome(a)&&a.hash)===JSON.stringify(r)?[2]:(l=1<<i+1,u.isNone(r)?(this._filters[i]=null,this._idMap.forEach((function(e){var t=_._getBlock(0).getData(e,0);_._getBlock(0).setData(e,0,t|l)})),[2]):[4,e.queryObjectIds(r)]);case 1:return c=n.sent(),r.hiddenIds&&r.hiddenIds.length&&(c=c.filter((function(e){return-1===r.hiddenIds.indexOf(e)}))),p=c.map((function(e){return _._idMap.get(e)})),[4,this._getFilter(i,o)];case 2:for(n.sent().update(r,s),this._getBlock(0).lock(),this._idMap.forEach((function(e){if(v(e)!==t.LOCAL_ID_TYPE_AGGREGATE){var r=_._getBlock(0).getData(e,0);_._getBlock(0).setData(e,0,r&~l)}})),h=0;h<p.length;h++)null!=(f=p[h])&&(d=this._getBlock(0).getData(f,0),this._getBlock(0).setData(f,0,d|l));return this._getBlock(0).unlock(),[2]}}))}))},e.prototype._getFilter=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var i,o,s;return n.__generator(this,(function(n){switch(n.label){case 0:return i=this._filters[e],u.isSome(i)?[2,i]:[4,new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(144)]).then(function(){var t=[r(848)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return o=n.sent().default,s=new o({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=s,[2,s]}}))}))},e.prototype.isVisible=function(e){return!!(2&this._getBlock(0).getData(e.localId,0))},e.prototype.getFilterFlags=function(e){for(var r,n=0,i=(r=e.localId,v(r)===t.LOCAL_ID_TYPE_AGGREGATE?254:255),o=0;o<this._filters.length;o++){var s=!!(i&1<<o),a=this._filters[o];n|=(!s||u.isNone(a)||a.check(e)?1:0)<<o}var l=this.getFeatureId(e.localId);return n<<1|this.getHighlightFlag(l)},e.prototype._bindVVEvaluators=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r=this;return n.__generator(this,(function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),u.isSome(e)?[4,l.all(e.map((function(e){return n.__awaiter(r,void 0,void 0,(function(){var r,i;return n.__generator(this,(function(n){switch(n.label){case 0:return r=h.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return i=n.sent(),u.isSome(i)&&this._attributeComputeMap.set(r,i),[2]}}))}))})))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype._bindDDEvaluators=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,s=this;return n.__generator(this,(function(n){switch(n.label){case 0:return this._attributeComputeMap.clear(),e.length>h.definitions.DOT_DENSITY_MAX_FIELDS&&y.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+h.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,l.all(e.map((function(e){return s._createNormalizedFunction(e,t)})))];case 1:for(r=n.sent().map((function(e){return b(0,e)})),i=0;i<h.definitions.DOT_DENSITY_MAX_FIELDS;i++)(o=i<e.length&&r[i])?this._attributeComputeMap.set(i,o):this._attributeComputeMap.has(i)&&this._attributeComputeMap.delete(i);return[2]}}))}))},e.prototype._createGetValueFunction=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,s,a,u,l;return n.__generator(this,(function(n){switch(n.label){case 0:return"size"!==e.type?[3,2]:(r=h.getTypeOfSizeVisualVariable(e))===h.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(i=r===h.enums.WGLVVFlag.SIZE_UNIT_VALUE,o=i&&function(t){return _.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},s=b,a=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,o)]);case 1:return[2,s.apply(void 0,a.concat([n.sent()]))];case 2:return u=b,l=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([n.sent()]))]}}))}))},e.prototype._createNormalizedFunction=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var o,s,a;return n.__generator(this,(function(n){switch(n.label){case 0:return(o=e.field)?"string"==typeof o?(s=e.normalizationField)?[2,function(e){if(e.attributes[o]&&e.attributes[s]){var t=e.attributes[o]/e.attributes[s];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[o])}:function(e){return e.attributes[o]}]:(y.error(new i("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof o)),[2,function(){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,p.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return a=n.sent(),[2,f.callWithOptimizedFeature.bind(null,a)];case 2:return y.error("Unable to create a normalized function for visual variable: "+e),[2,function(){}]}}))}))},e}();t.default=I}.apply(null,n))||(e.exports=i)},562:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(171),r(441),r(370),r(205),r(306),r(170),r(173),r(353),r(479),r(163),r(234),r(178),r(178),r(186),r(186)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d,_,y,g){Object.defineProperty(t,"__esModule",{value:!0});var v=Math.PI/180,m=o.mat2df32.create(),b=a.vec2f32.create(),x=l.create();t.getBounds=function(e,t,r,n,i,o,s){if(!n||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var a=n;if(!h.isPoint(a)){c.getBoundsXY(e,a);var u=t[0];0===u&&(u=function(e){var t=0;switch(e.symbol.type){case"simple-fill":case"picture-fill":var r=e.symbol.outline;if(!r)return 0;t=r.width;break;case"simple-line":t=e.symbol.width;break;case"simple-marker":t=e.symbol.size;break;case"picture-marker":t=Math.max(e.symbol.width,e.symbol.height);break;case"text":var n=[0,0,0,0];A(n,e.symbol,e.mosaicItem);var i=Math.max(Math.abs(n[0]),Math.abs(n[1]));t=Math.max(n[2],n[3])+i;break;case"cim":case"expanded-cim":var o=y.CIMSymbolHelper.getEnvelope(e.symbol.data);t=Math.sqrt(o.width*o.width+o.height*o.height)}return t}(r),t[0]=u);var l=i*u/2;return e[0]-=l,e[1]-=l,e[2]+=l,e[3]+=l,e}var p=a.x,d=a.y;return"text"===r.symbol.type&&0===t[2]&&0===t[3]&&A(t,r.symbol,r.mosaicItem),function(e,t,r,n,i,o,s,a){var u;switch(n.type){case"simple-marker":case"picture-marker":u=F(t,r,n,o,s,0);break;case"text":u=O(t,r,n,i,o,0);break;case"cim":case"expanded-cim":u=R(t,r,n,o,s,0)}for(var l,c,p=0,h=0;h<u.rings[0].length-1;h++)l=(t-(c=u.rings[0][h])[0])*(t-c[0])+(r-c[1])*(r-c[1]),p=Math.max(p,l);p=Math.sqrt(p);var d=f.normalizeMapX(t-p,a),y=f.normalizeMapX(t+p,a);if(d>y){var g=_.getInfo(a);if(g){var v=g.valid;d=v[0],y=v[1]}}e[0]=d,e[1]=r-p,e[2]=y,e[3]=r+p}(e,p,d,r.symbol,t,i,o,s),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.unwrap(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var S=a.vec2f32.create(),I=a.vec2f32.create(),P=a.vec2f32.create(),w=a.vec2f32.create(),T=a.vec2f32.create(),E=a.vec2f32.create(),M=a.vec2f32.create();function F(e,t,r,o,a,u){var l,c,p=n.pt2px(r.xoffset),h=n.pt2px(r.yoffset),f=v*r.angle,d=v*u;switch(r.type){case"simple-marker":var _=r;l=c=n.pt2px(_.size);break;case"picture-marker":var y=r;l=n.pt2px(y.width),c=n.pt2px(y.height)}a<.04&&(o=.04*o/a);var g=i.mat2d.identity(m);i.mat2d.translate(g,g,s.vec2.set(b,e,t)),i.mat2d.rotate(g,g,d-f),i.mat2d.scale(g,g,s.vec2.set(b,o,-o)),i.mat2d.translate(g,g,s.vec2.set(b,p,-h));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,-.5*l,-.5*c),g);var S=[0,0];s.vec2.transformMat2d(S,s.vec2.set(b,-.5*l,.5*c),g);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,.5*l,-.5*c),g);var P=[0,0];return s.vec2.transformMat2d(P,s.vec2.set(b,.5*l,.5*c),g),{rings:[[x,I,P,S,x]]}}function R(e,t,r,o,a,u){var l=y.CIMSymbolHelper.getEnvelope(r.data);if(!l)return null;a<.04&&(o=.04*o/a);var c=n.pt2px(l.width),p=n.pt2px(l.height),h=n.pt2px(l.x),f=n.pt2px(l.y),d=0*v,_=v*u,g=i.mat2d.identity(m);i.mat2d.translate(g,g,s.vec2.set(b,e,t)),i.mat2d.rotate(g,g,_-d),i.mat2d.scale(g,g,s.vec2.set(b,o,o));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,h,f+p),g);var S=[0,0];s.vec2.transformMat2d(S,s.vec2.set(b,h,f),g);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,h+c,f+p),g);var P=[0,0];return s.vec2.transformMat2d(P,s.vec2.set(b,h+c,f),g),{rings:[[x,I,P,S,x]]}}function O(e,t,r,o,a,u){var l=n.pt2px(r.xoffset),c=n.pt2px(r.yoffset),p=v*r.angle,h=v*u,f=i.mat2d.identity(m);i.mat2d.translate(f,f,s.vec2.set(b,e,t)),i.mat2d.rotate(f,f,h),i.mat2d.scale(f,f,s.vec2.set(b,a,-a));var d=o[0]+o[2]/2,_=o[1]+o[3]/2;i.mat2d.translate(f,f,s.vec2.set(b,l,-c)),i.mat2d.translate(f,f,s.vec2.set(b,d,_)),i.mat2d.rotate(f,f,p),i.mat2d.translate(f,f,s.vec2.set(b,-d,-_));var y=[0,0];s.vec2.transformMat2d(y,s.vec2.set(b,o[0],o[1]),f);var g=[0,0];s.vec2.transformMat2d(g,s.vec2.set(b,o[0],o[1]+o[3]),f);var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,o[0]+o[2],o[1]),f);var S=[0,0];return s.vec2.transformMat2d(S,s.vec2.set(b,o[0]+o[2],o[1]+o[3]),f),{rings:[[y,x,S,g,y]]}}function A(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var i=y.bidiText(t.text)[1],o=r.glyphMosaicItems,s=g.shapeGlyphs(o,i,{scale:n.pt2px(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:g.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),vAlign:g.alignmentUtils.getYAnchorDirection(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=s.x-s.halfWidth,e[1]=s.y-s.halfHeight,e[2]=s.width,e[3]=s.height,e}t.isPointOnPolyline=function(e,t,r,n){s.vec2.set(P,t,r);for(var i,o,a,u,l,c,p,h,f,d=e.paths,_=1/0,y=0;y<d.length;y++){var g=d[y];if(!(g.length<2))for(var v=1;v<g.length;v++)i=g[v-1][0],a=g[v-1][1],o=g[v][0],u=g[v][1],l=Math.min(i,o)-n,c=Math.min(a,u)-n,p=Math.max(i,o)+n,h=Math.max(a,u)+n,t<l||t>p||r<c||r>h||(s.vec2.set(S,i,a),s.vec2.set(I,o,u),s.vec2.subtract(w,I,S),s.vec2.subtract(T,S,P),s.vec2.scale(E,w,s.vec2.dot(w,T)/s.vec2.dot(w,w)),s.vec2.subtract(M,T,E),_>(f=s.vec2.dot(M,M))&&(_=f))}return Math.sqrt(_)<=n},t.getMarkerSymbolBounds=F,t.getCIMMarkerBounds=R,t.getTextSymbolBounds=O,t.normalizeCentralMeridian=function(e){var t,r,n,i,o,s,a,u,l,f=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,!(r=d.getInfo(t)))return e.toJSON();n=t.isWebMercator,i=N[s=n?102100:4326].maxX,o=N[s].minX,a=N[s].plus180Line,u=N[s].minus180Line;var _=e.toJSON();if(h.isPoint(_))l=D(_,i,o);else if(h.isMultipoint(_))_.points=_.points.map((function(e){return D(e,i,o)})),l=_;else if(h.isExtent(_))l=function(e,t){if(!t)return e;var r=function(e,t){var r,n=[],i=e.ymin,o=e.ymax,s=e.xmax-e.xmin,a=e.xmin,u=e.xmax,l=t.valid,c=l[0],p=l[1],h=(r=k(e.xmin,t)).x,f=r.frameId,d=(r=k(e.xmax,t)).x,_=r.frameId,y=h===d&&s>0;if(s>2*p){var g={xmin:a<u?h:d,ymin:i,xmax:p,ymax:o},v={xmin:c,ymin:i,xmax:a<u?d:h,ymax:o},m={xmin:0,ymin:i,xmax:p,ymax:o},b={xmin:c,ymin:i,xmax:0,ymax:o},x=[],S=[];G(g,m)&&x.push(f),G(g,b)&&S.push(f),G(v,m)&&x.push(_),G(v,b)&&S.push(_);for(var I=f+1;I<_;I++)x.push(I),S.push(I);n.push({extent:g,frameIds:[f]},{extent:v,frameIds:[_]},{extent:m,frameIds:x},{extent:b,frameIds:S})}else h>d||y?n.push({extent:{xmin:h,ymin:i,xmax:p,ymax:o},frameIds:[f]},{extent:{xmin:c,ymin:i,xmax:d,ymax:o},frameIds:[_]}):n.push({extent:{xmin:h,ymin:i,xmax:d,ymax:o},frameIds:[f]});return n}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(_,r);else if(h.isPolygon(_)||h.isPolyline(_)){var y=x;c.getBoundsXY(y,_);var g={xmin:y[0],ymin:y[1],xmax:y[2],ymax:y[3]},v=C(g.xmin,o)*(2*i),m=0===v?_:function(e,t){for(var r=0,n=function(e){return h.isPolygon(e)?e.rings:e.paths}(e);r<n.length;r++)for(var i=0,o=n[r];i<o.length;i++)o[i][0]+=t;return e}(_,v);g.xmin+=v,g.xmax+=v,p.extentIntersectsPolyline(g,a)&&g.xmax!==i||p.extentIntersectsPolyline(g,u)&&g.xmin!==o?f=m:l=m}else l=e.clone();return null!==f?(new L).cut(f,i):l},t.getTextSymbolSize=A;var N={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}};function C(e,t){return Math.ceil((e-t)/(2*t))}function k(e,t){var r,n=t.valid,i=n[0],o=n[1],s=2*o,a=0;return e>o?(e-=(r=Math.ceil(Math.abs(e-o)/s))*s,a=r):e<i&&(e+=(r=Math.ceil(Math.abs(e-i)/s))*s,a=-r),{x:e,frameId:a}}function G(e,t){var r=t.xmin,n=t.ymin,i=t.xmax,o=t.ymax;return j(e,r,n)&&j(e,r,o)&&j(e,i,o)&&j(e,i,n)}function j(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function D(e,t,r){var n;if(Array.isArray(e))if((n=e[0])>t){var i=C(n,t);e[0]=n+i*(-2*t)}else n<r&&(i=C(n,r),e[0]=n+i*(-2*r));else(n=e.x)>t?(i=C(n,t),e.x+=i*(-2*t)):n<r&&(i=C(n,r),e.x+=i*(-2*r));return e}var L=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var n=r.length,i=-2*t,o=0;o<n;o++){var s=r[o];if(s&&s.length>=this.minPts){for(var a=[],u=0,l=s;u<l.length;u++){var c=l[u];a.push([c[0]+i,c[1]])}r.push(a)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,n))||(e.exports=i)},719:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(210),r(152),r(153),r(198),r(521),r(178),r(243),r(720),r(363),r(263),r(512),r(315)],void 0===(i=function(e,t,r,n,i,o,s,a,u,l,c,p,h,f,d){function _(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function y(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function g(e,t,r){return r?t-e:e-t}function v(e,t,r,n){if(r&&"esriFieldTypeDate"===r.type){var i=new Date(e).getTime(),o=new Date(t).getTime();if(!isNaN(i)&&!isNaN(o))return g(i,o,n)}return"number"==typeof e&&"number"==typeof t?g(e,t,n):"string"==typeof e&&"string"==typeof t?(i=e.toUpperCase(),o=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?y(i,o,n):y(_(i),_(o),n)):n?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(u.isValid(e.outSR)&&!u.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=d.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},h.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=d.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=p.getWhereClause(t.where,this.fieldsIndex);if(!r)return o.resolve(this);if(r.isStandardized){for(var n=0,i=[],s=0,a=this.items;s<a.length;s++){var u=a[s];r.testFeature(u,this.featureAdapter)&&(i[n++]=u)}var l=new e(i,this.queryGeometry,this);return l.definitionExpression=t.where,o.resolve(l)}return o.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return o.resolve(this);var r=s.SetFromValues(t.objectIds),n=this.featureAdapter.getObjectId;return o.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!i.isSome(r))return o.resolve(this);var n=this.items.filter(r);return o.resolve(new e(n,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,i=t.startTimeField,s=t.endTimeField||i,a=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var p=c[l],h=u(p,r),f=u(p,s),d=a.get(h);(!d||f>u(d,s))&&a.set(h,p)}var _=n.valuesOfMap(a);return o.resolve(new e(_,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||u.equals(this.spatialReference,t)?[2,this]:(n=this.featureAdapter,[4,h.projectMany(this.items.map((function(e){return d.getGeometry(i.geometryType,i.hasZ,i.hasM,n.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return n.cloneWithGeometry(i.items[t],l.convertFromGeometry(e,i.hasZ,i.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var n=function(t){var n=t.split(" "),o=n[0],s=i.fieldsIndex.get(o),a=n[1]&&"desc"===n[1].toLowerCase();e.sort((function(e,t){return v(r(e,o,s),r(t,o,s),s,a)}))},i=this,o=0,s=t.reverse();o<s.length;o++)n(s[o])},e.prototype._createFeatureQueryResponse=function(e){var t=this,n=this.items,i=this,o=i.geometryType,s=i.hasM,u=i.hasZ,l=i.objectIdField,c=i.spatialReference,p=e.outFields,h=e.outSR,f=e.quantizationParameters,_=e.resultRecordCount,y=e.resultOffset,g=e.returnZ,v=e.returnM,m=!1;if(null!=_&&null!=y){var b=y+_;m=n.length>b,n=n.slice(y,Math.min(n.length,b))}var x=p&&(p.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):p.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,n),fields:x,geometryType:o,hasM:s&&v,hasZ:u&&g,objectIdFieldName:l,spatialReference:d.cleanFromGeometryEngine(h||c),transform:f&&a.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new c.default(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,i=this.hasZ,o=e.orderByFields,s=e.quantizationParameters,u=e.returnGeometry,l=e.returnCentroid,p=e.maxAllowableOffset,h=e.returnZ,f=void 0!==h&&h,_=e.returnM,y=i&&f,g=n&&void 0!==_&&_,v=[],m=0;if(u||l){var b=a.toQuantizationTransform(s);if(u&&!l)for(var x=0,S=t;x<S.length;x++)F=S[x],v[m++]={attributes:r.getAttributes(F),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(F),p,b,y,g)};else if(!u&&l)for(var I=0,P=t;I<P.length;I++)F=P[I],v[m++]={attributes:r.getAttributes(F),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(F,this),b)};else for(var w=0,T=t;w<T.length;w++)F=T[w],v[m++]={attributes:r.getAttributes(F),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(F,this),b),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(F),p,b,y,g)}}else for(var E=0,M=t;E<M.length;E++){var F=M[E],R=r.getAttributes(F);R&&(v[m++]={attributes:R})}return this._sortFeatures(v,o,(function(e,t,n){return r.getFieldValue(e,t,n)})),v},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=0,s=e.outStatistics;o<s.length;o++){var a=s[o];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,n=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},i=[],o=new Map,s=new Map,a=new Map,u=new Map,l=new c.default(e,this.featureAdapter,this.fieldsIndex),p=e.outStatistics,h=e.groupByFieldsForStatistics,f=e.having,d=e.orderByFields,_=h&&h.length,y=!!_,g=y&&h[0],v=y&&!this.fieldsIndex.get(g),m=0,b=p;m<b.length;m++){var x=b[m],S=x.outStatisticFieldName,I=x.statisticType,P=x,w="exceedslimit"!==I?x.onStatisticField:void 0,T="percentile_disc"===I||"percentile_cont"===I,E=y&&1===_&&(w===g||v)&&"count"===I;if(y){if(!a.has(w)){for(var M=[],F=0,R=h;F<R.length;F++){var O=R[F],A=this._getAttributeValues(l,O,o);M.push(A)}a.set(w,this._calculateUniqueValues(M))}var N=a.get(w),C=function(e){var r=N[e],n=r.count,i=r.data,s=r.items,a=r.itemPositions,c=i.join(",");if(!f||l.validateItems(s,f)){var p=u.get(c)||{attributes:{}},d=null;if(E)d=n;else{var _=k._getAttributeValues(l,w,o),y=a.map((function(e){return _[e]}));d=T&&"statisticParameters"in P?k._getPercentileValue(P,y):k._getStatisticValue(P,y)}p.attributes[S]=d,h.forEach((function(e,r){return p.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=i[r]})),u.set(c,p)}},k=this;for(var G in N)C(G)}else A=this._getAttributeValues(l,w,o),r.attributes[S]=T&&"statisticParameters"in P?this._getPercentileValue(P,A):this._getStatisticValue(P,A,s);i.push({name:S,alias:S,type:"esriFieldTypeDouble"})}var j=y?n.valuesOfMap(u):[r];return this._sortFeatures(j,d,(function(e,t){return e.attributes[t]})),{fields:i,features:j}},e.prototype._getStatisticValue=function(e,t,r){var n=e.onStatisticField,i=e.statisticType,o=r&&r.has(n)?r.get(n):this._calculateStatistics(t);return r&&r.set(n,o),o["var"===i?"variance":i]},e.prototype._getPercentileValue=function(e,t){var n=e.onStatisticField,i=e.statisticParameters,o=e.statisticType,s=i.value,a="desc"===i.orderBy,u=this.fieldsIndex.get(n),l=r.__spreadArrays(t).sort((function(e,t){return v(e,t,u,a)}));return this._calculatePercentile(l,s,"percentile_disc"===o)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),i=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,i),i},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=null,i=null,o=null,s=null,a=[],u=0,l=0,c=e;l<c.length;l++)"string"==typeof(d=c[l])?u++:null==d||isNaN(d)||(n+=d,t=Math.min(t,d),r=Math.max(r,d),a.push(d),u++);if(u){i=n/u;for(var p=0,h=0,f=a;h<f.length;h++){var d=f[h];p+=Math.pow(d-i,2)}s=u>1?p/(u-1):0,o=Math.sqrt(s)}else t=null,r=null;return{avg:i,count:u,max:r,min:t,stddev:o,sum:n,variance:s}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,n=r.length,i=0;i<n;i++){for(var o=r[i],s=[],a=0,u=e;a<u.length;a++){var l=u[a];s.push(l[i])}var c=s.join(",");null==t[c]?t[c]={count:1,data:s,items:[o],itemPositions:[i]}:(t[c].count++,t[c].items.push(o),t[c].itemPositions.push(i))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var n=(e.length-1)*t,i=Math.floor(n),o=i+1,s=n%1,a=e[i],u=e[o];return o>=e.length||r||"string"==typeof a||"string"==typeof u?a:a*(1-s)+u*s},e}();t.default=m}.apply(null,n))||(e.exports=i)},720:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(363)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;for(var o=0,s=0,a=i;s<a.length;s++){var u=a[s],l=n.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),p=c?null:n.getWhereClause(l,r),h=c?c.name:n.getAliasFromFieldName(u)||"FIELD_EXP_"+o++;this._fieldDataCache.set(u,{alias:h,clause:p})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var i=r?r.name:t,o=null;return this._fieldDataCache.has(i)?o=this._fieldDataCache.get(i).clause:r||(o=n.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:o})),r?this.featureAdapter.getAttribute(e,i):o.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},n=0,i=t;n<i.length;n++){var o=i[n],s=this._fieldDataCache.get(o),a=s.alias,u=s.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,n=[];if(t)for(var i=0,o=t;i<o.length;i++){var s=o[i],a=this._fieldDataCache.get(s).alias;n.push(e[a])}else for(var a in e)n.push(e[a]);var u=(t||["*"]).join(",")+"="+n.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=i}.apply(null,n))||(e.exports=i)},756:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),n=new Float64Array(2);function i(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function s(e){return(e[0]+e[1])/2}function a(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=s(e),n=t,i=!t;e[0]=i*e[0]+n*r,e[1]=i*r+n*e[1]}function l(e,t){var r=t>s(e);return u(e,r),r}function c(e,t){for(var o=a(r,-90,90),l=a(n,-180,180),c=0;c<t.length;c++){var p=i(t.charCodeAt(c));c%2==0?(u(l,!!(16&p)),u(l,!!(4&p)),u(l,!!(1&p)),u(o,!!(8&p)),u(o,!!(2&p))):(u(o,!!(16&p)),u(o,!!(4&p)),u(o,!!(1&p)),u(l,!!(8&p)),u(l,!!(2&p)))}return e[0]=s(o),e[1]=s(l),e}function p(e,t,i){for(var s="",u=a(r,-90,90),c=a(n,-180,180),p=0;p<i;p++){var h=0;p%2?(h|=l(u,e)<<4,h|=l(c,t)<<3,h|=l(u,e)<<2,h|=l(c,t)<<1,h|=l(u,e)<<0):(h|=l(c,t)<<4,h|=l(u,e)<<3,h|=l(c,t)<<2,h|=l(u,e)<<1,h|=l(c,t)<<0),s+=o(h)}return s}function h(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function d(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function _(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function y(e,t,r){var n=!((e.length-1)%2),s=e.substring(0,e.length-1),a=i(e.charCodeAt(e.length-1)),u=0,l=0,c=0,p=0;n?(u=8,l=4,c=1&a|(4&a)>>1|(16&a)>>2,p=(2&a)>>1|(8&a)>>2):(u=4,l=8,p=1&a|(4&a)>>1|(16&a)>>2,c=(2&a)>>1|(8&a)>>2);var h=c+t,f=p+r,d=Math.floor(h/u),_=Math.floor(f/l),g=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(h-d*u,f-_*l,n));return e.length>1&&(d||_)?y(s,d,_)+g:s+g}t.decodeBase32Char=i,t.encodeBase32Char=o,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,n=0,o=30,s=30,a=0;a<t.length;a++){var u=i(t.charCodeAt(a)),l=a%2==0;r|=d(u,l)<<(o-=l?3:2),n|=_(u,l)<<(s-=l?2:3)}return{geohashX:r,geohashY:n}},t.decodeGeohashXY=function(e,t){for(var r=-90,n=90,i=-180,o=180,s=0;s<t;s++){for(var a=Math.ceil((s+1)/2),u=Math.floor((s+1)/2),l=1-s%2,c=30-(3*a+2*u),p=30-(2*a+3*u),h=3*l+2*(1-l),f=2*l+3*(1-l),d=3*l+7*(1-l)<<p,_=(7*l+3*(1-l)<<c&e.geohashX)>>c,y=(d&e.geohashY)>>p,g=h-1;g>=0;g--){var v=(i+o)/2,m=_&1<<g?1:0;i=(1-m)*i+m*v,o=(1-m)*v+m*o}for(g=f-1;g>=0;g--){var b=(r+n)/2,x=y&1<<g?1:0;r=(1-x)*r+x*b,n=(1-x)*b+x*n}}return[i,r,o,n]},t.setGeohashXY=function(e,t,r,n){n%2&&(n+=1);for(var i=0,o=0,s=-90,a=90,u=-180,l=180,c=0;c<n/2;c++){for(var p=0;p<5;p++){var h=(u+l)/2,f=r>h?1:0;i|=f<<29-(p+5*c),u=(1-f)*u+f*h,l=(1-f)*h+f*l}for(p=0;p<5;p++){var d=(s+a)/2,_=t>d?1:0;o|=_<<29-(p+5*c),s=(1-_)*s+_*d,a=(1-_)*d+_*a}}e.geohashX=i,e.geohashY=o},t.encodeGeohash=p,t.latDistPerGeohash=h,t.lonDistPerGeohash=f,t.unpackXBits=d,t.unpackYBits=_,t.getRelativeGeohash=y,t.getIntersectingGeohashes=function(e,t,r,n,i){for(var o=Math.abs(r-e),s=Math.abs(n-t),a=h(i),u=f(i),l=Math.ceil(s/u),c=Math.ceil(o/a),d=p(e,t,i),_=new Array,g=0;g<l;g++)for(var v=0;v<c;v++)_.push(y(d,g,v));return _},t.forEachIntersectingGeohash=function(e,t,r,n,i,o){for(var s=Math.abs(r-e),a=Math.abs(n-t),u=h(i),l=f(i),d=Math.ceil(a/l),_=Math.ceil(s/u),g=p(e,t,i),v=0;v<d;v++)for(var m=0;m<_;m++){var b=y(g,v,m),x=c([0,0],b),S=x[0],I=x[1],P=S-u/2,w=I-l/2,T=S+u/2,E=I+l/2,M=u*l,F=Math.max(e,P),R=Math.max(t,w),O=Math.min(r,T)-F,A=Math.min(n,E)-R;o(b,Math.abs(O*A)/M)}}}.apply(null,n))||(e.exports=i)}}]);
//# sourceMappingURL=36.js.map