(function(){var t={"esri/layers/graphics/centroid":349,"esri/views/3d/layers/support/projectExtentUtils":364,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":384,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":468,"esri/views/3d/layers/graphics/ExtentSet":469,"esri/views/3d/layers/graphics/Graphics3DObjectStates":470,"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":471,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":567,"esri/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView":1057,"esri/views/3d/layers/GraphicsLayerView3D":2138},e=this||window,i=e.webpackJsonp=e.webpackJsonp||[];i.registerAbsMids?i.registerAbsMids(t):(i.absMidsWaiting=i.absMidsWaiting||[]).push(t)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1057:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(117),i(174),i(158),i(169),i(167),i(153),i(157),i(151),i(435),i(208),i(207),i(199),i(542),i(565),i(468),i(470),i(566),i(262),i(388)],void 0===(n=function(t,e,i,r,n,s,a,o,p,c,u,h,l,d,y,f,g,v,b,m,_){var S=function(t){function e(e){var i=t.call(this,e)||this;return i.graphicsCore=null,i.elevationAlignment=new g.default,i.watchUpdatingTracking=new _.WatchUpdatingTracking,i.handles=new a,i.suspendResumeExtent=null,i}return i.__extends(e,t),e.prototype.normalizeCtorArgs=function(t){var e=null;t.scaleVisibilityEnabled&&(delete(t=i.__assign({},t)).scaleVisibilityEnabled,e=new b);var r=new f.Graphics3DCore({owner:t.owner,layer:t.layer,preferredUpdatePolicy:0,graphicSymbolSupported:!0});return i.__assign(i.__assign({},t),{graphicsCore:r,scaleVisibility:e})},e.prototype.initialize=function(){var t=this;this.scaleVisibility&&"minScale"in this.layer&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return t.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.elevationAlignment&&"elevationInfo"in this.layer&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(e,i){u.diff(e,i)&&t.watchUpdatingTracking.addPromise(t.graphicsCore.elevationInfoChange())}))},e.prototype.setup=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,r,n=this;return i.__generator(this,(function(i){switch(i.label){case 0:t=function(t,e,i){return n.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i)},this.elevationAlignment.setup(this.owner,t,this.graphicsCore,this.view.elevationProvider),this.scaleVisibility&&"minScale"in this.layer&&(e=this.owner.view.basemapTerrain,this.scaleVisibility.setup(this.owner,this.layer,t,this.graphicsCore,e)),this._set("objectStates",new v.Graphics3DObjectStates(this.graphicsCore)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})];case 2:return i.sent(),[3,4];case 3:if(r=i.sent(),o.isAbortError(r))return[2];throw r;case 4:return this.handles.add(this.view.watch("clippingArea",(function(){return n.updateClippingExtent()}),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics(),[2]}}))}))},e.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null),this.watchUpdatingTracking.destroy(),this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null)),this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null)),this.objectStates&&(this.objectStates.destroy(),this._set("objectStates",null)),this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null))},Object.defineProperty(e.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),e.prototype.getGraphicFromGraphicUid=function(t){if(this.owner.loadedGraphics){var e=this.owner.loadedGraphics.find((function(e){return e.uid===t}));if(e){var i=this.layer instanceof h?this.layer:null;return l.hydrateGraphic(e,i)}}},e.prototype.whenGraphicBounds=function(t,e){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,e):o.reject()},e.prototype.computeAttachmentOrigin=function(t,e){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,e):null},e.prototype.getSymbolLayerSize=function(t,e){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,e):null},e.prototype.occlude=function(t){var e=this.objectStates.acquireSet(1,null),i=e.set,r=e.handle;return this.objectStates.setUid(i,t.uid),r},e.prototype.highlight=function(t){if(t instanceof d)return w;if("number"==typeof t)return this.highlight([t]);if(t instanceof r)return this.highlight([t]);if(t instanceof s&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof r){var e=t.map((function(t){return t.uid})),i=this.objectStates.acquireSet(0,null),n=i.set,a=i.handle;return this.objectStates.setUids(n,e),a}if("number"==typeof t[0]){var o=t,p=this.objectStates.acquireSet(0,null);return n=p.set,a=p.handle,this.objectStates.setObjectIds(n,o),a}}return w},e.prototype.updateClippingExtent=function(){var t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()},e.prototype.setupSuspendResumeExtent=function(){var t=this;this.scaleVisibility&&p.init(this.graphicsCore,"computedExtent",(function(e){t.suspendResumeExtent=m.enlargeExtent(e,t.suspendResumeExtent,y.SUSPEND_RESUME_EXTENT_OPTIMISM),t.scaleVisibility.setExtent(t.suspendResumeExtent)}),!0)},i.__decorate([c.property({constructOnly:!0})],e.prototype,"owner",void 0),i.__decorate([c.property({constructOnly:!0})],e.prototype,"layer",void 0),i.__decorate([c.property({readOnly:!0,aliasOf:"owner.view"})],e.prototype,"view",void 0),i.__decorate([c.property({constructOnly:!0})],e.prototype,"graphicsCore",void 0),i.__decorate([c.property({constructOnly:!0})],e.prototype,"scaleVisibility",void 0),i.__decorate([c.property({readOnly:!0})],e.prototype,"elevationAlignment",void 0),i.__decorate([c.property({readOnly:!0})],e.prototype,"objectStates",void 0),i.__decorate([c.property({readOnly:!0})],e.prototype,"watchUpdatingTracking",void 0),i.__decorate([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],e.prototype,"suspended",null),i.__decorate([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating","watchUpdatingTracking.updating"]})],e.prototype,"updating",null),i.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],e)}(n),w={remove:function(){},pause:function(){},resume:function(){}};return S}.apply(null,r))||(t.exports=n)},2138:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(117),i(152),i(153),i(157),i(151),i(308),i(567),i(1057),i(262),i(364),i(218)],void 0===(n=function(t,e,i,r,n,s,a,o,p,c,u,h,l){return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frustumVisibility=new p,e.slicePlaneEnabled=!1,e.drapeSourceType=1,e.suspendResumeExtent=null,e.fullExtentInLocalViewSpatialReference=null,e}return i.__extends(e,t),e.prototype.initialize=function(){var t=this;this._set("graphics3d",new c({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(function(){return t.graphics3d.graphicsCore.opacityChange()})),this.handles.add(this.layer.on("graphic-update",(function(e){return t.graphics3d.graphicsCore.graphicUpdateHandler(e)})));var e=h.toViewIfLocal(this).then((function(e){t.fullExtentInLocalViewSpatialReference=e}));e&&this.addResolvingPromise(e),this.handles.add(s.whenTrueOnce(this.view,"basemapTerrain.ready",(function(){return t.notifyChange("updating")})))},e.prototype.destroy=function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))},e.prototype.fetchPopupFeatures=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,r.isSome(e)?e.clientGraphics:null]}))}))},e.prototype.notifyGraphicUpdate=function(t,e){this.graphics3d.graphicsCore.notifyGraphicUpdate(t,e)},Object.defineProperty(e.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0}),e.prototype.getGraphicFromGraphicUid=function(t){return this.graphics3d.getGraphicFromGraphicUid(t)},e.prototype.whenGraphicBounds=function(t,e){return this.graphics3d.whenGraphicBounds(t,e)},e.prototype.computeAttachmentOrigin=function(t,e){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(t,e):null},e.prototype.getSymbolLayerSize=function(t,e){return this.graphics3d.getSymbolLayerSize(t,e)},e.prototype.queryGraphics=function(){return n.resolve(this.loadedGraphics)},e.prototype.occlude=function(t){return this.graphics3d.occlude(t)},e.prototype.highlight=function(t){return this.graphics3d.highlight(t)},e.prototype.canResume=function(){return!(!t.prototype.canResume.call(this)||this.frustumVisibility&&this.frustumVisibility.suspended||this.graphics3d&&this.graphics3d.suspended)},e.prototype.isUpdating=function(){return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.ready)},e.prototype.setupSuspendResumeExtent=function(){var t=this;s.init(this.graphics3d.graphicsCore,"computedExtent",(function(e){t.suspendResumeExtent=u.enlargeExtent(e,t.suspendResumeExtent,1.2),t.frustumVisibility.setExtent(t.suspendResumeExtent)}),!0)},Object.defineProperty(e.prototype,"performanceInfo",{get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}},enumerable:!0,configurable:!0}),i.__decorate([a.property({aliasOf:"layer.graphics"})],e.prototype,"loadedGraphics",void 0),i.__decorate([a.property({dependsOn:["frustumVisibility.suspended","graphics3d.suspended"]})],e.prototype,"suspended",void 0),i.__decorate([a.property({dependsOn:["frustumVisibility.updating","graphics3d.updating"]})],e.prototype,"updating",void 0),i.__decorate([a.property()],e.prototype,"layer",void 0),i.__decorate([a.property({readOnly:!0})],e.prototype,"frustumVisibility",void 0),i.__decorate([a.property({readOnly:!0})],e.prototype,"graphics3d",void 0),i.__decorate([a.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0),i.__decorate([a.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],e.prototype,"hasDraped",void 0),i.__decorate([a.subclass("esri.views.3d.layers.GraphicsLayerView3D")],e)}(o.LayerView3D(l))}.apply(null,r))||(t.exports=n)},349:function(t,e,i){var r,n;r=[i.dj.c(t.i),e],void 0===(n=function(t,e){function i(t,e){return t?e?4:3:e?3:2}function r(t,e,r,n,s,a){for(var o=i(s,a),p=r,c=r+o,u=0,h=0,l=0,d=0,y=0,f=0,g=n-1;f<g;f++,p+=o,c+=o){var v=e[p],b=e[p+1],m=e[p+2],_=e[c],S=e[c+1],w=e[c+2],I=v*S-_*b;d+=I,u+=(v+_)*I,h+=(b+S)*I,s&&(l+=(m+w)*(I=v*w-_*m),y+=I),v<t[0]&&(t[0]=v),v>t[1]&&(t[1]=v),b<t[2]&&(t[2]=b),b>t[3]&&(t[3]=b),s&&(m<t[4]&&(t[4]=m),m>t[5]&&(t[5]=m))}if(d>0&&(d*=-1),y>0&&(y*=-1),!d)return null;var x=[u,h,.5*d];return s&&(x[3]=l,x[4]=.5*y),x}function n(t,e,r,n,c){for(var u=i(n,c),h=e,l=e+u,d=0,y=0,f=0,g=0,v=0,b=r-1;v<b;v++,h+=u,l+=u){var m,_=t[h],S=t[h+1],w=t[h+2],I=t[l],x=t[l+1],E=t[l+2],G=n?a(_,S,w,I,x,E):s(_,S,I,x);G&&(d+=G,n?(y+=G*(m=p(_,S,w,I,x,E))[0],f+=G*m[1],g+=G*m[2]):(y+=G*(m=o(_,S,I,x))[0],f+=G*m[1]))}return d>0?n?[y/d,f/d,g/d]:[y/d,f/d]:r>0?n?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function s(t,e,i,r){var n=i-t,s=r-e;return Math.sqrt(n*n+s*s)}function a(t,e,i,r,n,s){var a=r-t,o=n-e,p=s-i;return Math.sqrt(a*a+o*o+p*p)}function o(t,e,i,r){return[t+.5*(i-t),e+.5*(r-e)]}function p(t,e,i,r,n,s){return[t+.5*(r-t),e+.5*(n-e),i+.5*(s-i)]}Object.defineProperty(e,"__esModule",{value:!0}),e.getCentroidOptimizedGeometry=function(t,e,s,a){if(!e||!e.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);for(var o=t.coords,p=[],c=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],u=e.lengths,h=e.coords,l=i(s,a),d=0,y=0,f=u;y<f.length;y++){var g=f[y],v=r(c,h,d,g,s,a);v&&p.push(v),d+=g*l}if(p.sort((function(t,e){var i=t[2]-e[2];return 0===i&&s&&(i=t[4]-e[4]),i})),p.length){var b=6*p[0][2];o[0]=p[0][0]/b,o[1]=p[0][1]/b,s&&(b=6*p[0][4],o[2]=0!==b?p[0][3]/b:0),(o[0]<c[0]||o[0]>c[1]||o[1]<c[2]||o[1]>c[3]||s&&(o[2]<c[4]||o[2]>c[5]))&&(o.length=0)}if(!o.length){var m=e.lengths[0]?n(h,0,u[0],s,a):null;if(!m)return null;o[0]=m[0],o[1]=m[1],s&&m.length>2&&(o[2]=m[2])}return t},e.lineCentroid=n}.apply(null,r))||(t.exports=n)},364:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(153),i(197),i(359)],void 0===(n=function(t,e,i,r,n){Object.defineProperty(e,"__esModule",{value:!0}),e.toViewIfLocal=function(t){var e=t.view.spatialReference,s=t.layer.fullExtent,a=s&&s.spatialReference;return a?a.equals(e)?i.resolve(s.clone()):r.canProject(a,e)?i.resolve(r.project(s,e)):t.view.state.isLocal?n.projectGeometry(s,e,t.layer.portalItem).then((function(e){return!t.destroyed&&e?e:void 0})).catch((function(){return null})):i.resolve(null):i.resolve(null)}}.apply(null,r))||(t.exports=n)},384:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(349),i(274),i(224)],void 0===(n=function(t,e,i,r,n){Object.defineProperty(e,"__esModule",{value:!0}),e.optimizedFeatureQueryEngineAdapter={getObjectId:function(t){return t.objectId},getAttributes:function(t){return t.attributes},getAttribute:function(t,e){return t.attributes[e]},cloneWithGeometry:function(t,e){return new r.default(e,t.attributes,null,t.objectId)},getGeometry:function(t){return t.geometry},getCentroid:function(t,e){return t.centroid||(t.centroid=i.getCentroidOptimizedGeometry(new n.default,t.geometry,e.hasZ,e.hasM)),t.centroid}},e.default=e.optimizedFeatureQueryEngineAdapter}.apply(null,r))||(t.exports=n)},468:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(117),i(158),i(190),i(167),i(198),i(151),i(469),i(211)],void 0===(n=function(t,e,i,r,n,s,a,o,p,c){Object.defineProperty(e,"__esModule",{value:!0});var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dirtyExtents=new p.ExtentSet,e.globalDirty=!1,e.dirtyGraphicsSet=new Set,e.handles=new s,e.updateElevation=!1,e.layerView=null,e.graphicsCore=null,e.events=new n,e}return i.__extends(e,t),Object.defineProperty(e.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),e.prototype.setup=function(t,e,i,r){var n=this;this.layerView=t,this.queryGraphicUIDsInExtent=e,this.graphicsCore=i,this.elevationProvider=r;var s=this.layerView.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",(function(t){return n.elevationUpdateHandler(t)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),s.registerTask(c.Task.ELEVATION_ALIGNMENT,(function(t){return n.update(t)}),(function(){return n.needsUpdate()}))])},e.prototype.destroy=function(){this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},e.prototype.clear=function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},e.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},e.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},e.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty},e.prototype.update=function(t){var e=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,t.madeProgress()),t.run((function(){return e.dirtyExtents.merge(t)}));this.needsUpdate()&&!t.done;)this._updateDirtyGraphics(t),this._updateDirtyExtents(t);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},e.prototype._updateDirtyGraphics=function(t){for(var e=this,i=this.layerView.view,r=this.graphicsCore.stageLayer.id,n=this.layerView.labeling,s=function(){var s=Math.min(o.dirtyGraphicsSet.size,100);a.someSet(o.dirtyGraphicsSet,(function(r){var n=e.graphicsCore.getGraphics3DGraphicById(r);return e.dirtyGraphicsSet.delete(r),n&&n.alignWithElevation(e.elevationProvider,i.renderCoordsHelper,e.graphicsCore.asyncUpdates),t.madeProgress(),--s<=0||t.done})),i._stage.processDirtyLayer(r),n&&n.processStageDirty()},o=this;this.dirtyGraphicsSet.size>0&&!t.done;)s()},e.prototype._updateDirtyExtents=function(t){for(var e=this;!this.dirtyExtents.empty&&this.dirtyGraphicsSet.size<100&&!t.done;){var i=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",{extent:i,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(i,this.spatialReference,(function(t){var i=e.graphicsCore.getGraphics3DGraphicById(t);i&&i.needsElevationUpdates()&&e.dirtyGraphicsSet.add(t)})),t.madeProgress()}},e.prototype.markAllGraphicsElevationDirty=function(){var t=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(e,i){return t.dirtyGraphicsSet.add(i)}))},e.prototype.elevationUpdateHandler=function(t){if("scene"!==t.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var e=t.extent;if(this.spatialReference=t.spatialReference,this.layerView.suspended){if(!this.updateElevation){var i=this.graphicsCore.computedExtent;i&&e[2]>i.xmin&&e[0]<i.xmax&&e[3]>i.ymin&&e[1]<i.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:e,spatialReference:this.spatialReference})}else e[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(e),this.notifyChange("updating")}},i.__decorate([o.property({readOnly:!0})],e.prototype,"updating",null),i.__decorate([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],e)}(r);e.default=u}.apply(null,r))||(t.exports=n)},469:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(214),i(173),i(211)],void 0===(n=function(t,e,i,r,n){Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.extents=new i({allocator:function(t){return t||r.create()}}),this.tempExtent=r.create(),this.dirty=!1}return Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.extents.clear()},t.prototype.add=function(t){this.contains(t)||(this.removeContained(t),r.set(this.extents.pushNew(),t),this.dirty=!0)},t.prototype.pop=function(){return this.dirty&&this.mergeTight(),this.extents.pop()},t.prototype.merge=function(t){return this.mergeTight(t),t.hasProgressed},t.prototype.mergeTight=function(t){var e=this;void 0===t&&(t=n.noBudget);for(var i=this.extents,s=new Set,a=0;a!==i.length;){i.sort((function(t,e){return t[0]-e[0]})),a=i.length,s.clear();for(var o=function(n){if(t.done)return{value:void 0};for(var a=i.getItemAt(n),o=n+1;o<i.length;++o){var p=i.getItemAt(o);if(p[0]>=a[2])break;s.add(p)}s.forEach((function(n){if(a!==n)if(n[2]<=a[0])s.delete(n);else{var o=r.area(a),p=r.area(n),c=e.tempExtent;r.expand(a,n,c);var u=o+p;(r.area(c)-u)/u<.05&&(r.set(a,c),s.delete(n),i.remove(n),t.madeProgress())}})),s.add(a)},p=0;p<i.length;++p){var c=o(p);if("object"==typeof c)return c.value}}this.dirty=!1},t.prototype.contains=function(t){return this.extents.some((function(e){return r.contains(e,t)}))},t.prototype.removeContained=function(t){this.extents.filterInPlace((function(e){return!r.contains(t,e)}))},Object.defineProperty(t.prototype,"test",{get:function(){var t=this;return{containsPoint:function(e){return t.extents.some((function(t){return r.containsPoint(t,e)}))}}},enumerable:!0,configurable:!0}),t}();e.ExtentSet=s}.apply(null,r))||(t.exports=n)},470:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(471)],void 0===(n=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this._graphicsCore=t,this._stateSets=new Array}return t.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach((function(t){return t.objectStateSet.removeAll()})),this._stateSets=null},t.prototype.acquireSet=function(t,e){var r=this,n=new i.Graphics3DObjectStateSet(t,e);this._stateSets.push(n);var s={remove:function(){return r.releaseSet(n)},pause:function(){n.objectStateSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,r.initializeSet(n)}};return{set:n,handle:s}},t.prototype.releaseSet=function(t){t.objectStateSet.removeAll();var e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)},t.prototype._addObjectStateSet=function(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)},t.prototype._removeObjectStateSet=function(t,e){t.removeObjectState(e.objectStateSet)},t.prototype.setUid=function(t,e){t.ids.add(e);var i=this._graphicsCore.graphics3DGraphics.get(e);i&&this._addObjectStateSet(i,t)},t.prototype.setUids=function(t,e){var i=this;e.forEach((function(e){return i.setUid(t,e)}))},t.prototype.setObjectIds=function(t,e){e.forEach((function(e){return t.ids.add(e)})),this.initializeSet(t)},t.prototype.addGraphic=function(t){var e=this;this._stateSets.forEach((function(i){!i.paused&&i.hasGraphic(t)&&e._addObjectStateSet(t,i)}))},t.prototype.removeGraphic=function(t){var e=this;this._stateSets.forEach((function(i){i.hasGraphic(t)&&e._removeObjectStateSet(t,i)}))},t.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach((function(t){return t.objectStateSet.removeAll()}))},t.prototype.initializeSet=function(t){var e=this,i=this._graphicsCore.graphics3DGraphics;t.objectIdField?i.forEach((function(i){i&&t.hasGraphic(i)&&e._addObjectStateSet(i,t)})):t.ids.forEach((function(r){var n=i.get(r);n&&e._addObjectStateSet(n,t)}))},Object.defineProperty(t.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0}),t}();e.Graphics3DObjectStates=r}.apply(null,r))||(t.exports=n)},471:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(445)],void 0===(n=function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.stateType=t,this.objectIdField=e,this.objectStateSet=new i.Object3DStateSet,this.ids=new Set,this.paused=!1}return t.prototype.hasGraphic=function(t){if(this.objectIdField){var e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)},t}();e.Graphics3DObjectStateSet=r}.apply(null,r))||(t.exports=n)},567:function(t,e,i){var r,n;r=[i.dj.c(t.i),e,i(117),i(158),i(167),i(157),i(151),i(238),i(661),i(211)],void 0===(n=function(t,e,i,r,n,s,a,o,p,c){var u=-.3*o.earthRadius;return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.suspended=!1,e.extent=null,e.extentIntersectionDirty=!0,e._isVisibleBelowSurface=!1,e.handles=new n,e.layerView=null,e.updating=!0,e}return i.__extends(e,t),e.prototype.setup=function(t){var e=this;this.layerView=t,this.extentIntersection=new p.FrustumExtentIntersection({renderCoordsHelper:t.view.renderCoordsHelper});var i=t.view,r=i.basemapTerrain,n=i.resourceController.scheduler;this.handles.add([i.on("resize",(function(){return e.viewChange()})),i.state.watch("camera",(function(){return e.viewChange()}),!0),n.registerTask(c.Task.FRUSTUM_VISIBILITY,(function(){return e.update()}),(function(){return e.updating})),r.on("elevation-bounds-change",(function(){return e.elevationBoundsChange()}))]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([s.init(r,["opacity","wireframe"],(function(){return e.updateIsVisibleBelowSurface()})),s.init(i,"map.ground.navigationConstraint.type",(function(){return e.updateIsVisibleBelowSurface()}))])},e.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},e.prototype._setDirty=function(){this.updating||this._set("updating",!0)},e.prototype.setExtent=function(t){this.extent=t,this.extentIntersectionDirty=!0,this._setDirty()},e.prototype.viewChange=function(){this._setDirty()},e.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(e.prototype,"isVisibleBelowSurface",{set:function(t){this._isVisibleBelowSurface=t,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),e.prototype.updateIsVisibleBelowSurface=function(){var t=this.layerView.view,e=t.basemapTerrain,i="local"===t.viewingMode,r=t.map.ground&&t.map.ground.navigationConstraint&&"none"===t.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!e.isOpaque()||r},e.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var t,e=this.layerView.view;if(this._isVisibleBelowSurface)t=u;else{var i=e.basemapTerrain.elevationBounds,r=i.min,n=i.max;t=r-Math.max(1,(n-r)*(1.2-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}},e.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var t=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(t))}else this._set("suspended",!1)},i.__decorate([a.property({readOnly:!0})],e.prototype,"suspended",void 0),i.__decorate([a.property({readOnly:!0})],e.prototype,"updating",void 0),i.__decorate([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],e)}(r)}.apply(null,r))||(t.exports=n)}}]);
//# sourceMappingURL=69.js.map