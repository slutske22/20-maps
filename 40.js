(function(){var e={"esri/tasks/support/FeatureSet":187,"esri/tasks/operations/zscale":248,"esri/layers/graphics/data/QueryEngine":302,"esri/tasks/operations/urlUtils":314,"esri/tasks/operations/pbfQueryUtils":328,"esri/tasks/operations/pbfFeatureServiceParser":329,"esri/tasks/operations/pbfDehydratedFeatureSet":330,"esri/tasks/operations/pbfOptimizedFeatureSet":331,"esri/tasks/operations/query":348,"esri/layers/support/PromiseQueue":383,"esri/layers/graphics/data/FeatureStore":402,"esri/layers/graphics/data/executeTileQuery":424,"esri/layers/graphics/data/BoundsStore":466,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":467,"esri/layers/graphics/data/QueryEngineCapabilities":558,"esri/layers/graphics/sources/support/clientSideDefaults":560,"esri/views/2d/layers/features/support/AttributeStore":561,"esri/views/2d/layers/graphics/graphicsUtils":562,"esri/layers/graphics/data/QueryEngineResult":719,"esri/layers/graphics/data/AttributesBuilder":720,"esri/geohash/geohashUtils":756,"esri/layers/graphics/sources/geojson/geojson":1034,"esri/views/2d/layers/features/controllers/BaseController":1079,"esri/views/2d/layers/features/support/ClusterStore":1080,"esri/geohash/GeohashTree":1081,"esri/views/2d/layers/features/support/pixelBuffering":1082,"esri/views/2d/layers/features/controllers/OnDemandController":2268,"esri/layers/ogc/ogcFeatureUtils":2269,"esri/views/2d/layers/features/controllers/EditsQueue":2270,"esri/views/2d/layers/features/support/DataTile":2271,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2272,"esri/core/SetPool":2273,"esri/views/2d/layers/features/support/TileUpdateQueue":2274},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[40,10,32,188],{1034:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(274),r(224)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function a(e){var t,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:switch(e.type){case"Feature":return[3,1];case"FeatureCollection":return[3,3]}return[3,7];case 1:return[4,e];case 2:return r.sent(),[3,7];case 3:t=0,i=e.features,r.label=4;case 4:return t<i.length?(n=i[t])?[4,n]:[3,6]:[3,7];case 5:r.sent(),r.label=6;case 6:return t++,[3,4];case 7:return[2]}}))}function u(e){for(var t=0,r=0;r<e.length;r++){var i=e[r],n=e[(r+1)%e.length];t+=i[0]*n[1]-n[0]*i[1]}return t<=0}function l(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function c(e,t,r){var i=l(t);u(i)?d(e,i,r):f(e,i,r)}function h(e,t,r){var i=l(t);u(i)?f(e,i,r):d(e,i,r)}function d(e,t,r){for(var i=0,n=t;i<n.length;i++)p(e,n[i],r);e.lengths.push(t.length)}function f(e,t,r){for(var i=t.length-1;i>=0;i--)p(e,t[i],r);e.lengths.push(t.length)}function p(e,t,r){var i=t[0],n=t[1],o=t[2];e.coords.push(i,n),r.hasZ&&e.coords.push(o||0)}function y(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}t.validateGeoJSON=function(e){if(!e)throw new i("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});var t=e.crs;if(t){var r="string"==typeof t?t:"name"===t.type?t.properties.name:null,n=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!n.test(r))throw new i("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}},t.inferLayerProperties=function(e,t){void 0===t&&(t={});for(var i=a(e),n=[],o=new Set,u=new Set,l=!1,c=Number.NEGATIVE_INFINITY,h=null,d=!1,f=void 0,p=t.geometryType,g=void 0===p?null:p,_=!1,v=function(){var e,t,a=i.next(),p=a.value;if(a.done){var v=h&&1===h.length&&h[0]||null;if(v)for(var m=0,b=n;m<b.length;m++){var x=b[m];x.name===v&&(x.type="esriFieldTypeOID")}return{value:{fields:n,geometryType:g,hasZ:l,maxObjectId:Math.max(0,c),objectIdFieldName:v,objectIdFieldType:f,unknownFields:(e=u,t=[],e.forEach((function(e){return t.push(e)})),t)}}}var I=p.geometry,S=p.properties,w=p.id;if(I&&(g||(g=s[I.type]),s[I.type]!==g))return"continue";if(!l){var T=function(e){var t,i,n,o,s,a,u,l,c;return r.__generator(this,(function(h){switch(h.label){case 0:if(!e)return[2,null];switch(e.type){case"Point":return[3,1];case"LineString":case"MultiPoint":return[3,3];case"MultiLineString":case"Polygon":return[3,5];case"MultiPolygon":return[3,10]}return[3,17];case 1:return[4,e.coordinates];case 2:return h.sent(),[3,17];case 3:return[5,r.__values(e.coordinates)];case 4:return h.sent(),[3,17];case 5:t=0,i=e.coordinates,h.label=6;case 6:return t<i.length?(n=i[t],[5,r.__values(n)]):[3,9];case 7:h.sent(),h.label=8;case 8:return t++,[3,6];case 9:return[3,17];case 10:o=0,s=e.coordinates,h.label=11;case 11:if(!(o<s.length))return[3,16];a=s[o],u=0,l=a,h.label=12;case 12:return u<l.length?(c=l[u],[5,r.__values(c)]):[3,15];case 13:h.sent(),h.label=14;case 14:return u++,[3,12];case 15:return o++,[3,11];case 16:return[3,17];case 17:return[2]}}))}(I);l=function(e){for(;;){var t=e.next(),r=t.value;if(t.done)return!1;if(r.length>2)return!0}}(T)}if(d||(d=null!=w)&&"number"==(f=typeof w)&&(h=Object.keys(S).filter((function(e){return S[e]===w}))),d&&"number"===f&&null!=w&&(c=Math.max(c,w),h.length>1?h=h.filter((function(e){return S[e]===w})):1===h.length&&(h=S[h[0]]===w?h:[])),!_&&S){var F=!0;for(var M in S)if(!o.has(M)){var E=S[M];if(null!=E){var R=y(E);"unknown"!==R?(u.delete(M),o.add(M),n.push({name:M,alias:M,type:R})):u.add(M)}else F=!1,u.add(M)}_=F}};;){var m=v();if("object"==typeof m)return m.value}},t.createOptimizedFeatures=function(e,t){return function(e){for(var t=[];;){var r=e.next(),i=r.value;if(r.done)return t;t.push(i)}}(function(e,t){var i,a,u,l,f,y,g,_;return void 0===t&&(t={}),r.__generator(this,(function(r){switch(r.label){case 0:i=t.geometryType,a=t.objectIdFieldName,r.label=1;case 1:return u=e.next(),l=u.value,u.done?[2]:(f=l.geometry,y=l.properties,g=l.id,f&&s[f.type]!==i?[3,1]:(_=y||{},a&&null!=g&&!_[a]&&(_[a]=g),[4,new n.default(f?function(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return d(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(var i=0,n=t.coordinates;i<n.length;i++){d(e,n[i],r)}return e}(e,t,r);case"MultiPoint":return function(e,t,r){return d(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(var i=0,n=t.coordinates;i<n.length;i++){var o=n[i];c(e,o[0],r);for(var s=1;s<o.length;s++)h(e,o[s],r)}return e}(e,t,r);case"Point":return function(e,t,r){return p(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){var i=t.coordinates;c(e,i[0],r);for(var n=1;n<i.length;n++)h(e,i[n],r);return e}(e,t,r)}}(new o.default,f,t):null,_)]));case 2:return r.sent(),[3,1];case 3:return[2]}}))}(a(e),t))}}.apply(null,i))||(e.exports=n)},1079:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(236),r(164),r(156),r(152),r(153),r(151),r(363),r(302),r(255),r(316),r(199),r(186),r(561),r(1080),r(1082)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_,v){Object.defineProperty(t,"__esModule",{value:!0});var m=s.getLogger("esri.views.2d.layers.features.controllers.BaseController"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(y.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return r.__extends(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,u.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new d(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return i(e.symbol)}));case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some((function(e){return i(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?f.fromJSON(this.config.renderer):(m.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=r.__spreadArrays(this._availableFields,t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,v.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(a.isSome(n)&&n.where)try{c.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new i("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&o("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new g.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new h.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new _.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new p,r=e.outFields,i=this.config,n=i.gdbVersion,o=i.historicMoment,s=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=n,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return a.isSome(e)&&!!e.geometry}))},r.__decorate([l.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r.__decorate([l.property()],t.prototype,"config",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r.__decorate([l.property()],t.prototype,"filters",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r.__decorate([l.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r.__decorate([l.property()],t.prototype,"processor",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([l.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"viewState",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r.__decorate([l.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(n.HandleOwner);t.default=b}.apply(null,i))||(e.exports=n)},1080:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(164),r(152),r(153),r(171),r(1081),r(756),r(178),r(197),r(274),r(224),r(402),r(263),r(302),r(315),r(246),r(408),r(206)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_,v,m,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){return o.andThen(e,(function(e){return"cluster"!==e.type?null:r.__assign(r.__assign({},e),{clusterRadius:a.pt2px(e.clusterRadius/2)})}))};function I(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,u;return r.__generator(this,(function(r){for(n=[],o=0,a=e;o<a.length;o++)u=a[o],n.push(S(u,t,i));return[2,s.all(n)]}))}))}function S(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(o=(n=e).outStatistic.onStatisticValueExpression,s=n,[4,v.createRendererExpression(o,t,i)]):[3,2];case 1:return s.expression=r.sent(),[2,n];case 2:return[2,e]}}))}))}var w=function(e){function t(t,r,i,n,o){var s=this,a=new f.default([],[r,i]);return(s=e.call(this,a,n,null,t)||this).invalid=!1,s.canDelete=!1,s.geohashBoundsInfo=o,s}return r.__extends(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,i,n,o,s,a){var u=new t(r,i,n,s,a);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=o,u},t.prototype.update=function(e,t,r,i,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=n,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(d.default),T=function(e){function t(t,r,n,o){var s=e.call(this,t)||this;return s._deferredDeletionQueue=[],s._invalidated=!1,s._aggregateFieldsHash=null,s._geohashLevel=0,s._aggregateValueRanges={},s._aggregateValueRangesChanged=!1,s._aggregateFields=[],s._hasAggregateValueExpression=!1,s._hasViewExpression=!1,s._$view={scale:0,viewingMode:"none"},s._clusters=new Map,s._tiles=new Map,s._spatialReference=r,s._attributeStore=n,s._featureReduction=x(o),s._projectionSupportCheck=y.checkProjectionSupport(r,i.SpatialReference.WGS84),s}return r.__extends(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,o.isSome(r)&&t&&(this._tree=new u.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,l,c,h,d,f,p,y,g,_=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this._featureReduction,s=o.andThen(t.featureReduction,x),a=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),l=null===n&&t.featureReduction,c=a!==this._aggregateFieldsHash,h=l||c,c?(d=this,[4,I(t.aggregateFields,this._spatialReference,i)]):[3,2];case 1:for(d._aggregateFields=r.sent(),this._hasViewExpression=!1,f=0,p=this._aggregateFields;f<p.length;f++)"onStatisticValueExpression"in(y=p[f]).outStatistic&&(g=y,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||g.expression.referencesScale());r.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return r.sent(),this._featureReduction=s,this._aggregateFieldsHash=a,this._aggregateValueRanges={},this._invalidated=!0,o.isNone(s)?(this._tree=null,[2]):(o.isSome(n)&&n.clusterRadius!==s.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),h&&(this._tree=new u.GeohashTree(t.aggregateFields),this._unindexFeatures()),(h||e)&&this._reindexFeatures(c),this._handleClusterUpdates(),this._tiles.forEach((function(e){return _._getClustersForTile(e,0,s.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,i=this._aggregateFields;r<i.length;r++){var n=i[r];if("onStatisticValueExpression"in n.outStatistic){var o=n,s=o.expression,a=o.outStatistic.onStatisticField;e.attributes[a]=m.callWithOptimizedFeature(s,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length){var n=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(n),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!o.isNone(this._featureReduction)){var s=this._featureReduction.clusterRadius;i.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,s)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var i=r[t];this._attributeStore.addLocalId(i)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var s,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return o.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,i,n)]:[4,this._projectionSupportCheck];case 1:return r.sent(),this._handleClusterUpdates(),s=this._featureReduction.clusterRadius,a=this._getTransforms(t,i),u=this._getClustersForTile(t,n.pixelBuffer,s,a),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,u]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,s,a,u){var l=this;void 0===u&&(u=!0),t=Math.max(t,50);for(var c=2*s,d=new Set,f=this._getGeohashLevel(e.key.level),p=Math.pow(2,e.key.level)*Math.ceil(b.TILE_SIZE/c),v=Math.ceil(t/c)+2,m=Math.ceil(b.TILE_SIZE/c)+2*v,x=e.key,I=x.row,S=x.col*b.TILE_SIZE,w=I*b.TILE_SIZE,T=Math.floor(S/c)-v,F=Math.floor(w/c)-v,M=T+m,E=F+m,R=new Array,P=e.tileInfoView.getLODInfoAt(e.key.level),C=T;C<=M;C++)for(var O=function(t){var s,c,v=C;P.wrap&&(v=C<0?C+p:C%p);var m=P.wrap&&C<0,b=P.wrap&&C%p!==C,x=k._lookupCluster(P,e.key.level,v,t,f);if(o.isSome(x)){var I=o.andThen(a,(function(e){return m?e.left:b?e.right:e.tile}));if(u&&o.isNone(I))return"continue";if(!x.count)return"continue";if(u&&1===x.count){var S=x.geohashBoundsInfo,w=S.xLL,T=S.yLL,F=S.xTR,M=S.yTR,E=S.level,O=o.unwrap(k._tree).findSingleOccupancyNode(w,T,F,M,E),j=o.unwrap(O).getLngLatBounds(),A={x:j[0],y:j[1]},G={x:j[2],y:j[3]},B=0,N=0,Q=0,q=0;if(k._spatialReference.isWebMercator)B=(s=h.lngLatToXY(A.x,A.y))[0],N=s[1],Q=(c=h.lngLatToXY(G.x,G.y))[0],q=c[1];else{var D=y.project(A,i.SpatialReference.WGS84,k._spatialReference),L=y.project(G,i.SpatialReference.WGS84,k._spatialReference);if(!D||!L)return n("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";B=D.x,N=D.y,Q=L.x,q=L.y}var z=[B,N,Q,q],V=null;if(k.forEachInBounds(z,(function(e){l._attributeStore.isVisible(e)&&(V&&n("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),V=e)})),!V)return n("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var U=_.getGeometry(k.geometryInfo.geometryType,k.geometryInfo.hasZ,k.geometryInfo.hasM,V.geometry,0,o.unwrap(I)),Z=r.__assign(r.__assign({},V.attributes),x.attributes);x.referenceId=V.localId,d.add(x.objectId),R.push(new g.Feature(Z,x.localId,U))}else u&&(d.add(x.objectId),U=_.getGeometry(k.geometryInfo.geometryType,k.geometryInfo.hasZ,k.geometryInfo.hasM,x.geometry,0,o.unwrap(I)),R.push(new g.Feature(x.attributes,x.localId,U)))}},k=this,j=F;j<=E;j++)O(j);return{features:R,objectIds:d}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,i=this._getGeohashLevel(e),n=2*(Math.floor(i/2)+1)-1,s=this._tree;this._geohashLevel=n,o.isNone(s)||(n>r?(s.dropLevels(0),this._featuresById.forEach((function(e){e.geohashIndexed&&(t._setGeohash(e),s.insert(e,t._geohashLevel),e.geohashIndexed=!0)}))):n<r&&s.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,o.unwrap(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,o.unwrap(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){o.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=c.getInfo(t);if(!n)return{tile:i,left:null,right:null};var o=n.valid,s=o[0],a=o[1];return{tile:i,left:r.__assign(r.__assign({},i),{translate:[a,e.bounds[3]]}),right:r.__assign(r.__assign({},i),{translate:[s-a+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);if(this._clusters.has(i)){var n=this._clusters.get(i);o.isSome(n)?n.canDelete=!0:this._clusters.delete(i)}},t.prototype._getClusterBounds=function(e,t,r){if(o.isNone(this._featureReduction))return null;var i=this._featureReduction.clusterRadius,n=2*i,s=r%2?t*n:t*n+i,a=r*n,u=s/b.TILE_SIZE,l=a/b.TILE_SIZE,c=(s+n)/b.TILE_SIZE,h=(a-n)/b.TILE_SIZE;return[e.getXForColumn(u),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(h)]},t.prototype._lookupCluster=function(e,t,n,s,a){var u,c;if(o.isNone(this._featureReduction)||o.isNone(this._tree))return null;var d=this._getClusterId(t,n,s),f=this._clusters.get(d);if(f&&o.isSome(f)&&!f.invalid&&!f.canDelete)return f;var p=this._getClusterBounds(e,n,s),g=p[0],_=p[1],v=p[2],m=p[3],b={x:g,y:_},x={x:v,y:m},I=0,S=0,T=0,F=0;if(this._spatialReference.isWebMercator)I=(u=h.xyToLngLat(b.x,b.y))[0],S=u[1],T=(c=h.xyToLngLat(x.x,x.y))[0],F=c[1];else{var M=y.project(b,this._spatialReference,i.SpatialReference.WGS84),E=y.project(x,this._spatialReference,i.SpatialReference.WGS84);if(!M||!E)return null;I=M.x,S=M.y,T=E.x,F=E.y}I>T&&(T=180);var R={geohashX:0,geohashY:0},P={geohashX:0,geohashY:0};l.setGeohashXY(R,S,I,a),l.setGeohashXY(P,F,T,a);var C=R.geohashX,O=R.geohashY,k=P.geohashX,j=P.geohashY,A={xLL:C,yLL:O,xTR:k,yTR:j,level:a},G=this._tree.getRegionStatistics(C,O,k,j,a),B=G.count,N=G.xTotal,Q=G.yTotal,q=B?N/B:0,D=B?Q/B:0;if(o.isSome(f)&&f.canDelete){var L=this._attributeStore.removeLocalId(f.objectId);this._deferredDeletionQueue.push(L)}var z=o.isSome(f)&&!f.canDelete&&f.invalid,V=r.__assign({cluster_count:B},G.attributes),U=this._attributeStore,Z=z?f.update(q,D,t,V,A):w.create(U,d,q,D,t,V,A);return 0===B&&(Z.geometry.coords[0]=(g+v)/2,Z.geometry.coords[1]=(_+m)/2),this._attributeStore.setAttributeData(Z.localId,Z,this.geometryInfo,null),this._clusters.set(d,Z),this._updateAggregateValueRangeForCluster(Z,Z.tileLevel),Z},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,n=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(b.TILE_SIZE/r),n=e.key,o=n.row,s=n.col*b.TILE_SIZE,a=o*b.TILE_SIZE,u=Math.floor(s/r),l=Math.floor(a/r),c=u;c<u+i;c++)for(var h=l;h<l+i;h++)this._markForDeletion(e.key.level,c,h)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},o=y.project(r,this._spatialReference,i.SpatialReference.WGS84);o?l.setGeohashXY(e,o.y,o.x,12):n("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),o.isSome(this._featureReduction)&&o.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return o.isSome(this._featureReduction)&&o.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(p.default);t.ClusterStore=T}.apply(null,i))||(e.exports=n)},1081:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(601),r(152),r(756)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new s(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var n=this._pool.dequeue();return this._nodes++,i.isSome(n)?n.realloc(e,t,r):new s(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var n=r.children[i];r.children[i]=null,n&&t._release(n)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,n=0,o=0,s=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,this._updateStatistics(e,i,1)),n>=t)return;var a=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),l=1-n%2,c=30-(3*a+2*u),h=30-(2*a+3*u),d=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<h,p=8*l+4*(1-l),y=(e.geohashX&d)>>c,g=(e.geohashY&f)>>h,_=y+g*p;o=o<<3*l+2*(1-l)|y,s=s<<2*l+3*(1-l)|g,null==i.children[_]&&(i.children[_]=this._acquire(o,s,n+1)),n+=1,i=i.children[_]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var n=Math.ceil((i+1)/2),o=Math.floor((i+1)/2),s=1-i%2,a=30-(3*n+2*o),u=30-(2*n+3*o),l=7*s+3*(1-s)<<a,c=3*s+7*(1-s)<<u,h=8*s+4*(1-s),d=((e.geohashX&l)>>a)+((e.geohashY&c)>>u)*h,f=r.children[d];1===f.count&&(this._release(f),r.children[d]=null),i+=1,r=f}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,n){for(var o=this._root;null!==o;){var s=o.depth,a=o.xNode,u=o.yNode,l=1-s%2,c=o.xGeohashTotal/o.count,h=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<h&&h<=i)return o;if(s>=n)o=o.next;else{for(var d=Math.ceil((s+1)/2),f=Math.floor((s+1)/2),p=30-(3*d+2*f),y=30-(2*d+3*f),g=~((1<<p)-1),_=~((1<<y)-1),v=(e&g)>>p,m=(t&_)>>y,b=(r&g)>>p,x=(i&_)>>y,I=a<<3*l+2*(1-l),S=u<<2*l+3*(1-l),w=I+8*l+4*(1-l),T=S+4*l+8*(1-l),F=Math.max(I,v),M=Math.max(S,m),E=Math.min(w,b),R=Math.min(T,x),P=null,C=null,O=M;O<=R;O++)for(var k=F;k<=E;k++){var j=k-I+(O-S)*(8*l+4*(1-l)),A=o.children[j];A&&(P||((P=A).next=o.next),C&&(C.next=A),C=A,A.next=o.next)}o=P||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,n){for(var o=this._root,s=0,a=0,u=0,l={};null!==o;){var c=o.depth,h=o.xNode,d=o.yNode;if(c>=n){var f=o.xGeohashTotal/o.count,p=o.yGeohashTotal/o.count;e<f&&f<=r&&t<p&&p<=i&&(s+=o.count,a+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var y=Math.ceil((c+1)/2),g=Math.floor((c+1)/2),_=1-c%2,v=30-(3*y+2*g),m=30-(2*y+3*g),b=~((1<<v)-1),x=~((1<<m)-1),I=(e&b)>>v,S=(t&x)>>m,w=(r&b)>>v,T=(i&x)>>m,F=h<<3*_+2*(1-_),M=d<<2*_+3*(1-_),E=F+8*_+4*(1-_),R=M+4*_+8*(1-_),P=Math.max(F,I),C=Math.max(M,S),O=Math.min(E,w),k=Math.min(R,T),j=null,A=null,G=C;G<=k;G++)for(var B=P;B<=O;B++){var N=B-F+(G-M)*(8*_+4*(1-_)),Q=o.children[N];if(Q){if(G!==C&&G!==k&&B!==P&&B!==O){f=Q.xGeohashTotal/Q.count,p=Q.yGeohashTotal/Q.count,e<f&&f<=r&&t<p&&p<=i&&(s+=Q.count,a+=Q.xTotal,u+=Q.yTotal,this._aggregateStatistics(l,Q.statistics));continue}j||((j=Q).next=o.next),A&&(A.next=Q),A=Q,Q.next=o.next}}o=j||o.next}}return{count:s,attributes:this._normalizeStatistics(l,s),xTotal:a,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var n=e.children[i];n&&(t||((t=n).next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name,a=o.outStatistic.onStatisticField,u=e.attributes[a];switch(o.outStatistic.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],h=t.statistics[s].onStatisticField||0,d=t.statistics[s].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[s].onStatisticField=h+r*u,t.statistics[s].onStatisticNormalizationField=d+r*c);break;case"sum":case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var f=t.statistics[s].value,p=t.statistics[s].nanCount;null==u||isNaN(u)?t.statistics[s].nanCount=p+r:t.statistics[s].value=f+r*u;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var y=t.statistics[s].x,g=t.statistics[s].y,_=(p=t.statistics[s].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[s].nanCount=p+r:(t.statistics[s].x=y+r*Math.cos(u*_),t.statistics[s].y=g+r*Math.sin(u*_));break;case"mode":t.statistics[s]||(t.statistics[s]={}),f=t.statistics[s][u]||0,t.statistics[s][u]=f+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var n=i[r],o=n.name;switch(n.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[o]||(e[o]={}),t[o]){var a=e[o][s]||0;e[o][s]=a+t[o][s]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name;switch(o.outStatistic.statisticType){case"norm":var a=e[s];if(t&&null==a.onStatisticNormalizationField)break;if(t&&a.onStatisticNormalizationField){r[s]=a.onStatisticField/a.onStatisticNormalizationField;break}r[s]=0;break;case"sum":if(!t)break;var u=e[s],l=u.value;if(!(t-(h=u.nanCount)))break;r[s]=l;break;case"avg":if(!t)break;var c=e[s];if(l=c.value,!(t-(h=c.nanCount)))break;r[s]=l/(t-h);break;case"avg_angle":if(!t)break;var h,d=e[s],f=d.x,p=d.y;if(!(t-(h=d.nanCount)))break;var y=f/(t-h),g=p/(t-h),_=180/Math.PI,v=Math.atan2(g,y)*_;r[s]=v;break;case"mode":var m=e[s],b=0,x=null;for(var I in m){var S=m[I];S>b&&(b=S,x=I)}r[s]="null"===x?null:x}}return r},e}();t.GeohashTree=o;var s=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),o=30-(2*t+3*r),s=this.xNode<<i,a=this.yNode<<o;return n.decodeGeohashXY({geohashX:s,geohashY:a},this.depth)},e.prototype.find=function(e,t,r,i,n,o){if(i>=r)return this;var s=1-i%2,a=3*s+2*(1-s),u=2*s+3*(1-s),l=30-n-a,c=30-o-u,h=((e&7*s+3*(1-s)<<l)>>l)+((t&3*s+7*(1-s)<<c)>>c)*(8*s+4*(1-s)),d=this.children[h];return null==d?null:d.find(e,t,r,i+1,n+a,o+u)},e}()}.apply(null,i))||(e.exports=n)},1082:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(153),r(171),r(625),r(186),r(206),r(562)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,l,c,h;return r.__generator(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(o=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(_,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(_,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=o;u<l.length;u++)c=l[u],a.push(y(c,s));return[4,i.all(a)];case 1:return h=r.sent(),[2,n.pt2px(h.reduce(_,0))]}}))}))};var c=[0,0,0,0];function h(e,t){return null==e?t:e}function d(e,t){return null==e.outline?t:h(e.outline.width,t)}var f={sdf:!0,code:99,metrics:a.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new o.default(0,0,24,24),page:0,textureBinding:2};function p(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,a,l,y,_,v,m,b,x,I,S,w;return r.__generator(this,(function(T){switch(T.label){case 0:return"simple-marker"===e.type?(i=Math.max(h(e.size,12),t),[2,g(e)+.707*i]):"picture-marker"===e.type?(n=Math.max(h(e.height,12),t),o=h(e.width,12)*(n/h(e.height,12)),a=o/2,l=n/2,[2,g(e)+Math.sqrt(a*a+l*l)]):"text"===e.type?(y=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[f]};for(var i=[],n=0;n<t;n++)i.push(r.__assign(r.__assign({},f),{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:i}}(e),u.getTextSymbolSize(c,e,y),_=Math.abs(c[0]),v=Math.abs(c[1]),m=c[2],b=c[3],[2,Math.max(_,v)+Math.max(m,b)]):"simple-line"===e.type?(x=e,I=Math.max(h(x.width,.75),t)/2,x.marker?[2,Math.max(6*x.width,2*t)]:[2,I]):"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(d(e,0),t)/2]:"cim"===e.type?(S=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(S.width*S.width+S.height*S.height)]:[2,0]:"web-style"!==e.type?[3,2]:(w=p,[4,e.fetchCIMSymbol()]);case 1:return[2,w.apply(void 0,[T.sent(),t])];case 2:return[2,0]}}))}))}function y(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return function(e){return e.type in l}(e)?(n=(i=Math).min,[4,p(e,t)]):[2,0];case 1:return[2,n.apply(i,[r.sent(),75])]}}))}))}function g(e){var t=h(e.xoffset,0),r=h(e.yoffset,0);return Math.sqrt(t*t+r*r)}function _(e,t){return Math.max(e,t)}}.apply(null,i))||(e.exports=n)},187:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(159),r(174),r(166),r(155),r(152),r(151),r(170),r(163),r(194)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h){var d=new o.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),f=function(e){function t(t){var r=e.call(this,t)||this;return r.displayFieldName=null,r.exceededTransferLimit=!1,r.features=[],r.fields=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.queryGeometry=null,r.spatialReference=null,r}return r.__extends(t,e),t.prototype.readFeatures=function(e,t){for(var r=l.fromJSON(t.spatialReference),i=[],o=0;o<e.length;o++){var s=e[o],u=n.fromJSON(s),c=s.geometry&&s.geometry.spatialReference;a.isSome(u.geometry)&&!c&&(u.geometry.spatialReference=r),i.push(u)}return i},t.prototype.writeGeometryType=function(e,t,r,i){if(e)d.write(e,t,r,i);else{var n=this.features;if(n)for(var o=0,s=n;o<s.length;o++){var u=s[o];if(u&&a.isSome(u.geometry))return void d.write(u.geometry.type,t,r,i)}}},t.prototype.writeSpatialReference=function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r)for(var i=0,n=r;i<n.length;i++){var o=n[i];o&&a.isSome(o.geometry)&&o.geometry.spatialReference&&(t.spatialReference=o.geometry.spatialReference.toJSON())}}},t.prototype.toJSON=function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var i=t.features[r];if(i.geometry){var n=e&&e[r];i.geometry=n&&n.toJSON()||i.geometry}}return t},t.prototype.quantize=function(e){for(var t=e.scale,r=t[0],i=t[1],n=e.translate,o=n[0],s=n[1],u=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-o)/r)}),(function(e){return Math.round((s-e)/i)})),c=0,h=u.length;c<h;c++)l(a.unwrap(u[c].geometry))||(u.splice(c,1),c--,h--);return this.transform=e,this},t.prototype.unquantize=function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;for(var i=r.translate,n=i[0],o=i[1],s=r.scale,u=s[0],l=s[1],c=this._getHydrationFunction(e,(function(e){return e*u+n}),(function(e){return o-e*l})),h=0,d=t;h<d.length;h++){var f=d[h].geometry;a.isSome(f)&&c(f)}return this},t.prototype._quantizePoints=function(e,t,r){for(var i,n,o=[],s=0,a=e.length;s<a;s++){var u=e[s];if(s>0){var l=t(u[0]),c=r(u[1]);l===i&&c===n||(o.push([l-i,c-n]),i=l,n=c)}else i=t(u[0]),n=r(u[1]),o.push([i,n])}return o.length>0?o:null},t.prototype._getQuantizationFunction=function(e,t,r){var i=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var n=c.isPolygon(e)?e.rings:e.paths,o=[],s=0,a=n.length;s<a;s++){var u=n[s],l=i._quantizePoints(u,t,r);l&&o.push(l)}return o.length>0?(c.isPolygon(e)?e.rings=o:e.paths=o,e):null}:"multipoint"===e?function(e){var n;return(n=i._quantizePoints(e.points,t,r)).length>0?(e.points=n,e):null}:"extent"===e?function(e){return e}:null},t.prototype._getHydrationFunction=function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var i,n,o=c.isPolygon(e)?e.rings:e.paths,s=0,a=o.length;s<a;s++)for(var u=o[s],l=0,h=u.length;l<h;l++){var d=u[l];l>0?(i+=d[0],n+=d[1]):(i=d[0],n=d[1]),d[0]=t(i),d[1]=r(n)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var i,n,o=e.points,s=0,a=o.length;s<a;s++){var u=o[s];s>0?(i+=u[0],n+=u[1]):(i=u[0],n=u[1]),u[0]=t(i),u[1]=r(n)}}:void 0},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"displayFieldName",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"exceededTransferLimit",void 0),r.__decorate([u.property({type:[n],json:{write:!0}})],t.prototype,"features",void 0),r.__decorate([u.reader("features")],t.prototype,"readFeatures",null),r.__decorate([u.property({type:[h],json:{write:!0}})],t.prototype,"fields",void 0),r.__decorate([u.property({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:d.read}}})],t.prototype,"geometryType",void 0),r.__decorate([u.writer("geometryType")],t.prototype,"writeGeometryType",null),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r.__decorate([u.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"queryGeometry",void 0),r.__decorate([u.property({type:l,json:{write:!0}})],t.prototype,"spatialReference",void 0),r.__decorate([u.writer("spatialReference")],t.prototype,"writeSpatialReference",null),r.__decorate([u.property({json:{write:!0}})],t.prototype,"transform",void 0),r.__decorate([u.subclass("esri.tasks.support.FeatureSet")],t)}(s.JSONSupport);return f.prototype.toJSON.isDefaultToJSON=!0,f||(f={}),f}.apply(null,i))||(e.exports=n)},2268:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(476),r(154),r(164),r(156),r(153),r(157),r(305),r(151),r(184),r(163),r(243),r(2269),r(348),r(528),r(186),r(1079),r(2270),r(2271),r(2272),r(721),r(2274),r(587)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_,v,m,b,x,I,S,w){Object.defineProperty(t,"__esModule",{value:!0});var T=s.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),F=o("esri-featurelayer-webgl"),M=o("esri-mobile"),E={maxDrillLevel:F&&"object"==typeof F&&null!=F.maxDrillLevel?F.maxDrillLevel:M?1:4,maxRecordCountFactor:F&&"object"==typeof F&&null!=F.maxRecordCountFactor?F.maxRecordCountFactor:M?1:3,enablePBFQuery:!F||"object"!=typeof F||null==F.enablePBFQuery||F.enablePBFQuery},R=new Set,P=[],C=function(){function e(e,t){var r=this;this.objectIdField=t,l.openWithPorts(e).then((function(e){return r.client=e}))}return e.prototype.destroy=function(){this.client.close(),this.client=null},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.client.invoke("queryFeatures",e.toJSON(),t)];case 1:return i=r.sent(),[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),O=function(){function e(e,t){this.source=e,this.sourceSpatialReference=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,y.executeQueryPBF(this.source,e,{type:"optimized",sourceSpatialReference:this.sourceSpatialReference},t)];case 1:return[2,r.sent().data]}}))}))},e}(),k=function(){function e(e,t,r){this.source=e,this.objectIdField=t,this.sourceSpatialReference=r}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,y.executeQuery(this.source,e,this.sourceSpatialReference,t)];case 1:return i=r.sent().data,[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),j=function(){function e(e,t){this.source=e,this.objectIdField=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,p.queryOptimizedFeatureSet(this.source,e,t)]}))}))},e}(),A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._dataTileIndex=new x.default,t._editsQueue=new m.EditsQueue({processEdits:t._processEdits.bind(t)}),t._featuresInFlight=new Map,t.service=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this._createFeatureStore();t.onFeatureAdd=this.onFeatureAdd.bind(this),t.onFeatureRemove=this.onFeatureRemove.bind(this),this._set("featureStore",t),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach((function(e){return e.done=!1})),this._fetchQueue=new w({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchTile(t,this.queryInfo,i)];case 1:return e=r.sent(),[2,{dataTile:t,featureSet:e}]}}))}))}}),this._patchQueue=new w({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new S.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._updateTile(t,r,i)}});var i,n=this.service,o=n.capabilities,s=n.source,a=n.objectIdField,u=n.spatialReference;(i=s)&&i.capabilities&&i.collectionId&&i.layerDefinition&&i.url?this.sourceAdapter=new j(s,a):Array.isArray(s)?this.sourceAdapter=new C(s,a):E.enablePBFQuery&&o.query.supportsFormatPBF?this.sourceAdapter=new O(s,u):this.sourceAdapter=new k(s,a,u),this.handles.add([this.watch("updating",(function(t){return!t&&e.onIdle()}))]),this.featureStore.events.on("valueRangesChanged",(function(t){e.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:t.valueRanges}})}))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy(),this.sourceAdapter.destroy()},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.featureStore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.viewState||this._fetchQueue.updating||this._patchQueue.updating||this._updateQueue.updating||this._editsQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s,a,u,l=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),i=JSON.stringify(this.config.filters),n=this.renderer.getAttributeHash(),o=e.availableFields.filter((function(e){return-1===l.availableFields.indexOf(e)})),s=this.config.definitionExpression,this._set("config",e),s!==this.config.definitionExpression&&this._set("queryEngine",this._createQueryEngine(this.featureStore)),[4,this.updatePixelBuffer()];case 1:return r.sent(),a=i!==JSON.stringify(e.filters),u=n!==this.renderer.getAttributeHash(),t?u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,3]:[3,6];case 2:r.sent(),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.featureStore.update(a,e,this.service.fields)];case 5:return r.sent(),this.refresh(),[2];case 6:return o.length?[4,this._handleAttributeChange(o)]:[3,8];case 7:r.sent(),r.label=8;case 8:return"heatmap"===this.renderer.type?[2]:u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,10];case 9:r.sent(),this.featureStore.forEach((function(e){return l.attributeStore.setAttributeData(e.localId,e,l.geometryInfo,l.viewParams)})),r.label=10;case 10:return[4,this.attributeStore.updateFilters(this)];case 11:return r.sent(),[4,this.featureStore.update(a,e,this.service.fields)];case 12:return r.sent(),[4,this.attributeStore.sendUpdates()];case 13:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i;return r.__generator(this,(function(r){for(e=0,t=this.tileStore.tiles;e<t.length;e++)i=t[e],this._updateQueue.push(i.id,Date.now());return[2]}))}))},t.prototype.onIdle=function(){this.featureStore.sweepClusters()},t.prototype.onEdits=function(e){var t=this;return this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then((function(){t._editsQueue.updating||t._fetchQueue.resume()}))},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryStatistics=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n=this;return r.__generator(this,(function(o){switch(o.label){case 0:return e=0,t=0,i=0,[4,a.all(this.tileStore.tiles.map((function(o){return r.__awaiter(n,void 0,void 0,(function(){var n,s,a,u,l,c,h,f,p,y,g;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.queryInfo,s=n.returnCentroid,a=n.returnGeometry,u=this._pixelBuffer,l={pixelBuffer:u,returnGeometry:a,returnCentroid:s,returnOutline:this.returnOutline},c=performance.now(),[4,this.featureStore.executeTileQuery(o,this.spatialReference,l)];case 1:for(h=r.sent().features,f=performance.now(),i+=f-c,e+=h.length,p=0,y=h;p<y.length;p++)(g=y[p]).geometry&&(d.isPolygon(g.geometry)?t+=g.geometry.rings.reduce((function(e,t){return e+t.length}),0):d.isPolyline(g.geometry)&&(t+=g.geometry.paths.reduce((function(e,t){return e+t.length}),0)));return[2]}}))}))})))];case 1:return o.sent(),[2,r.__assign(r.__assign({},this.featureStore.storeStatistics),{displayedFeatureCount:e,displayedVertexCount:t,displayPreProcessTime:i})]}}))}))},t.prototype.refresh=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){switch(t.label){case 0:return this._queryInfoHash=Math.random().toString(),this._dataTileIndex.clear(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),[4,u.whenFalseOnce(this._fetchQueue,"updating")];case 1:return t.sent(),this._updateQueue.clear(),[4,u.whenFalseOnce(this._updateQueue,"updating")];case 2:return t.sent(),this.featureStore.startMarkingUsedFeatures(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),[4,u.whenFalseOnce(this._fetchQueue,"updating")];case 3:return t.sent(),this.featureStore.sweep(),this.featureStore.forEach((function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)})),this.attributeStore.sendUpdates(),this._updateQueue.resume(),[2]}}))}))},t.prototype.setViewState=function(t){var r=this,i=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),this._fetchQueue.state=t,this._updateQueue.state=t,i!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates()),this.featureStore.setScale(this.viewState.scale)},t.prototype.getAggregate=function(e){return this.featureStore.getAggregate(e)},t.prototype.getAggregateValueRanges=function(){return this.featureStore.getAggregateValueRanges()},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed),this.featureStore.onTileUpdate(e)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=r.__assign(r.__assign({},t),e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}}))}))},t.prototype._fetchChangedTileFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){return(i=this._dataTileIndex.get(e.id))?[2,this._fetchChangedTileFieldsDrill(i,t)]:[2]}))}))},t.prototype._fetchChangedTileFieldsDrill=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,o,s,u,l,c,h,d,f,p,y=this;return r.__generator(this,(function(g){switch(g.label){case 0:return n=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||i>=E.maxDrillLevel,o=e.key,s={key:o,dataTile:e,queryInfo:n},[4,this._patchQueue.push(s)];case 1:return(u=g.sent()).exceededTransferLimit&&i<E.maxDrillLevel?(l=e.tile.createChildTiles(),c=l.map((function(t){var r=new b.default;return r.tile=t,r.displayTile=e.displayTile,r})),[4,a.all(c.map((function(e){return y._fetchChangedTileFieldsDrill(e,t,i+1)})))]):[3,3];case 2:return g.sent(),[2];case 3:for(h=0,d=u.features;h<d.length;h++)f=d[h],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return[2]}}))}))},t.prototype._fetchChangedTileFieldsPaged=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,o,s,a,u,l,c,h,d,f,p;return r.__generator(this,(function(y){switch(y.label){case 0:return n=this.service.capabilities.query.supportsMaxRecordCountFactor,o=this.service.tileMaxRecordCount,s=o*(n?1:E.maxRecordCountFactor),a=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:i*s,num:s}),e.returnExceeded=!0,u=e.key,l={key:u,dataTile:e,queryInfo:a},[4,this._patchQueue.push(l)];case 1:for(c=y.sent(),h=0,d=c.features;h<d.length;h++)f=d[h],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return c.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,i+1)]:[2]}}))}))},t.prototype._fetchChangedFields=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.tileStore.tiles,i=t.map((function(t){return n._fetchChangedTileFields(t,e)})),[4,a.all(i)];case 1:return r.sent(),[2]}}))}))},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,o="esriGeometryPoint"===this.service.geometryType,s=function(e){var t=r.get(e.id);t?(t.displayTile=e,o?r.forEach((function(r){I.isChildOf(r,t)&&(r.displayTile=e)})):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),a._processDataTile(t)},a=this,u=0,l=e;u<l.length;u++)s(d=l[u]);if(t)for(var c=0,h=t;c<h.length;c++){var d=h[c];R.add(d),n.abort(d.id)}r.forEach((function(e){R.has(e.displayTile)&&P.push(e)}));for(var f=0,p=P;f<p.length;f++){var y=p[f];i.abort(y.id),r.delete(y)}P.length=0,R.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,o=this._dataTileIndex,s=this._fetchQueue,u=i.id,l=this._queryInfoHash,c=i.level-r.key.level>=E.maxDrillLevel;if(o.add(e),e.done||s.has(u)){if(e.queryInfoHash!==l||e.returnExceeded!==c)if(e.done)e.done=!1;else{if(!s.isOngoing(u))return e.queryInfoHash=l,void(e.returnExceeded=c);s.abort(u)}}else e.queryInfoHash=l,e.returnExceeded=c;e.done?this._invalidateTile(e.displayTile):s.has(u)||s.push(e).then((function(e){return t._handleResponse(e.dataTile,e.featureSet)})).catch((function(r){a.isAbortError(r)||(T.error(new n("featurelayer-controller:tile-error","Encountered an error when handling tile response",r)),e.done=!0,t._invalidateTile(e.displayTile))}))},t.prototype._handleResponse=function(e,t){if(e.done=!0,f.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else{for(var r=e.tile.createChildTiles(),n=0,o=r;n<o.length;n++){var s=o[n],a=new b.default;a.tile=s,a.displayTile=e.displayTile,this._processDataTile(a)}i.release(r)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach((function(t){I.isChildOf(t,e)&&P.push(t)}));for(var t=0,r=P;t<r.length;t++){var i=r[t];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}P.length=0},t.prototype._createQuery=function(e,t,r,i,n,o){var s=this.service.geometryType,a=this._createDefaultQuery(i);return a.maxRecordCountFactor=n,a.returnExceededLimitFeatures=o,a.resultType="tile",a.geometry=e,this.service.capabilities.query.supportsQuantization?(a.quantizationParameters=new g.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===s&&(a.maxAllowableOffset=r)):"esriGeometryPolyline"!==s&&"esriGeometryPolygon"!==s||(a.maxAllowableOffset=r),a},t.prototype._fetchTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,a,u,l,c,d,p,y,g;return r.__generator(this,(function(r){switch(r.label){case 0:return n=new h({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),o=this.service.geometryType,s="esriGeometryPoint"===o?e.tile:e.displayTile,a=s.extent,u=s.resolution,l=e.returnExceeded,c=this._createQuery(n,a,u,t,E.maxRecordCountFactor,l),[4,this.sourceAdapter.executeQuery(c,i)];case 1:if((d=r.sent()).transform&&"esriGeometryPolygon"===o)for(p=0,y=d.features;p<y.length;p++)(g=y[p]).geometry=f.removeCollinearVectices(g.geometry,g.geometry,o,!1,!1);return[2,d]}}))}))},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var o=n[i].tile;r.push(o.id,o.updateTimestamp)}},t.prototype._updateTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,u,l,c,h,d,f,p,y,g,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.tileStore.get(e),o=this.queryInfo,s=o.returnCentroid,u=o.returnGeometry,l=this._pixelBuffer,c={pixelBuffer:l,returnGeometry:u,returnCentroid:s,returnOutline:this.returnOutline},[4,this.featureStore.executeTileQuery(n,this.spatialReference,c)];case 1:return h=r.sent(),d=h.features,f=h.objectIds,[4,this.attributeStore.sendUpdates()];case 2:return r.sent(),p={geometryType:this.service.geometryType,features:d,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform},y=[],g=!0,this._dataTileIndex.forEach((function(e){n.id!==e.id&&I.isChildOf(e,n)&&g&&!e.done&&(g=!1)})),g&&n&&n.objectIds.forEach((function(e){if(!f.has(e)){var t=v.attributeStore.getLocalId(e);y.push(t)}})),f.forEach((function(e){n.objectIds.add(e)})),n.updateTimestamp=t,[2,this.processor.onTileData(n,{clear:!0,addOrUpdate:p.features,remove:y,transformParams:_.Utils.getTransformParams(p)},i).catch((function(e){a.isAbortError(e)||T.error("update-tile",e)}))]}}))}))},t.prototype._processEdits=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,u,l,c=this;return r.__generator(this,(function(h){switch(h.label){case 0:return n=this._createTempQueryEngine(),o=this._createObjectIdsQuery(e),e.length?[4,this.sourceAdapter.executeQuery(o)]:[3,2];case 1:s=h.sent(),f.hydrateOptimizedFeatureSet(s),this._dataTileIndex.addOrUpdateFeatures(s.features),n.featureStore.addMany(s.features),h.label=2;case 2:return u=t.concat(e).map((function(e){return c.attributeStore.getLocalId(e)})),this._dataTileIndex.deleteFeaturesById(t),this.attributeStore.sendUpdates(),l=r.__assign(r.__assign({},this.queryInfo),{pixelBuffer:this._pixelBuffer,returnOutline:this.returnOutline}),this.tileStore.tiles.map((function(e){return r.__awaiter(c,void 0,void 0,(function(){var t,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.featureStore.executeTileQuery(e,this.spatialReference,l)];case 1:return t=r.sent().features,o={transform:e.transform,hasZ:!1,hasM:!1},[2,this.processor.onTileData(e,{addOrUpdate:t,remove:u,transformParams:o},i).catch((function(e){a.isAbortError(e)||T.error("update-tile",e)}))]}}))}))})),n.destroy(),[2]}}))}))},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},r.__decorate([c.property()],t.prototype,"_fetchQueue",void 0),r.__decorate([c.property()],t.prototype,"_patchQueue",void 0),r.__decorate([c.property()],t.prototype,"_updateQueue",void 0),r.__decorate([c.property()],t.prototype,"_editsQueue",void 0),r.__decorate([c.property({readOnly:!0})],t.prototype,"featureStore",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([c.property()],t.prototype,"sourceAdapter",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["featureStore","service"]})],t.prototype,"queryEngine",null),r.__decorate([c.property({dependsOn:["viewState","_fetchQueue.updating","_updateQueue.updating","_patchQueue.updating","_editsQueue.updating"]})],t.prototype,"updating",null),r.__decorate([c.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],t)}(v.default);t.default=A}.apply(null,i))||(e.exports=n)},2269:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(165),r(180),r(154),r(156),r(178),r(243),r(304),r(263),r(263),r(1034),r(560),r(255),r(786),r(187)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g){Object.defineProperty(t,"__esModule",{value:!0});var _=s.getLogger("esri.layers.graphics.sources.ogcfeature");function v(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m(e,t,i)];case 1:return n=r.sent(),[2,u.convertToFeatureSet(n)]}}))}))}function m(e,t,n){var o;return r.__awaiter(this,void 0,void 0,(function(){var s,f,p,y,g,_,v,m,b,x,I,S,w,T,F,M,E,R,P,C,O,k,j,A,G,B,N,Q,q,D,L,z,V;return r.__generator(this,(function(U){switch(U.label){case 0:return s=e.capabilities.query.maxRecordCount,f=e.collectionId,p=e.layerDefinition,y=e.url,g=y+"/collections/"+f+"/items",_=t.geometry,v=t.num,m=t.outSpatialReference,b=t.start,x=t.timeExtent,I=t.where,S=h.project(_,a.WGS84),w=function(e){return e?e.xmin+","+e.ymin+","+e.xmax+","+e.ymax:null}(S),T=function(e){if(!e)return null;var t=e.start,r=e.end;return(t?t.toISOString():"..")+"/"+(r?r.toISOString():"..")}(x),F=function(e){return e&&"1=1"!==e?e:null}(I),M=null!=b?b:0,E=null!=v?v:null!=b&&void 0!==b?10:s,[4,i(g,r.__assign(r.__assign({},n),{query:{bbox:w,datetime:T,query:F,limit:E,startindex:M,f:"application/geo+json"}}))];case 1:if(R=U.sent().data,P=null===(o=R.links)||void 0===o?void 0:o.filter((function(e){return"next"===e.rel})),C=0!==(null==P?void 0:P.length),O=p.fields,k=p.globalIdField,j=p.hasM,A=p.hasZ,G=p.objectIdField,B=p.geometryType,N=d.createOptimizedFeatures(R,{geometryType:B,hasZ:A,objectIdFieldName:G}),!a.equals(m,a.WGS84))for(Q=0,q=N;Q<q.length;Q++)(z=q[Q]).geometry&&(z.geometry=u.convertFromGeometry(c.project(u.convertToGeometry(z.geometry,B,A,!1),a.WGS84,m)));for(D=0,L=N;D<L.length;D++)(z=L[D]).objectId=z.attributes[G];return(V=new l.default).exceededTransferLimit=C,V.features=N,V.fields=O,V.geometryType=B,V.globalIdFieldName=k,V.hasM=j,V.hasZ=A,V.objectIdFieldName=G,V.spatialReference=m||a.WGS84,[2,V]}}))}))}t.getCollectionDefinition=function(e,t,s,u,l){return void 0===l&&(l=5),r.__awaiter(this,void 0,void 0,(function(){var h,g,v,m,b,x,I,S,w,T,F,M,E,R,P;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c.checkProjectionSupport(a.WGS84,s.spatialReference)];case 1:return r.sent(),[3,3];case 2:throw r.sent(),new o("ogc-feature-layer:projection-not-supported","Projection not supported");case 3:return[4,i(e+"/collections/"+t+"/items",{signal:u,query:{limit:l,f:"application/geo+json"}})];case 4:return h=r.sent().data,[4,d.validateGeoJSON(h)];case 5:if(r.sent(),g=d.inferLayerProperties(h,{geometryType:s.geometryType}),v=s.fields||g.fields||[],m=null!=s.hasZ?s.hasZ:g.hasZ,b=g.geometryType,x=s.objectIdField||g.objectIdFieldName||"OBJECTID",I=s.timeInfo,S=n.find(v,(function(e){return e.name===x})))S.type="esriFieldTypeOID",S.editable=!1,S.nullable=!1;else{if(!g.objectIdFieldType)throw new o("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");v.unshift({name:x,alias:x,type:"esriFieldTypeOID",editable:!1,nullable:!1})}if(x!==g.objectIdFieldName&&(F=n.find(v,(function(e){return e.name===g.objectIdFieldName})))&&(F.type="esriFieldTypeInteger"),!b)throw new o("ogc-feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");for(v===g.fields&&g.unknownFields.length>0&&_.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:g.unknownFields}}),w=0,T=v;w<T.length;w++){if(null==(F=T[w]).name&&(F.name=F.alias),null==F.alias&&(F.alias=F.name),"esriFieldTypeOID"!==F.type&&"esriFieldTypeGlobalID"!==F.type&&(F.editable=null==F.editable||!!F.editable,F.nullable=null==F.nullable||!!F.nullable),!F.name)throw new o("ogc-feature-layer:invalid-field-name","field name is missing",{field:F});if(-1===y.kebabDict.jsonValues.indexOf(F.type))throw new o("ogc-feature-layer:invalid-field-type",'invalid type for field "'+F.name+'"',{field:F})}return I&&(M=new p(v),I.startTimeField&&((E=M.get(I.startTimeField))?(I.startTimeField=E.name,E.type="esriFieldTypeDate"):I.startTimeField=null),I.endTimeField&&((R=M.get(I.endTimeField))?(I.endTimeField=R.name,R.type="esriFieldTypeDate"):I.endTimeField=null),I.trackIdField&&((P=M.get(I.trackIdField))?I.trackIdField=P.name:(I.trackIdField=null,_.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:I}}))),I.startTimeField||I.endTimeField||(_.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:I}}),I=null)),[2,{drawingInfo:f.createDrawingInfo(b),geometryType:b,fields:v,hasZ:!!m,objectIdField:x,timeInfo:I}]}}))}))},t.getServerCollection=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections/"+t,{signal:o,query:{f:n}})];case 1:return[2,r.sent().data]}}))}))},t.getServerCollections=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerConformance=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/conformance",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerLandingPage=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.queryFeatureSet=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v(e,t,i)];case 1:return n=r.sent(),[2,g.fromJSON(n)]}}))}))},t.queryFeatureSetJSON=v,t.queryOptimizedFeatureSet=m}.apply(null,i))||(e.exports=n)},2270:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(153),r(151),r(161)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=[],r._onGoingRequest=null,r._abortController=n.createAbortController(),r}return r.__extends(t,e),t.prototype.destroy=function(){this.clear()},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.destroyed&&(this._queue.length>0||null!=this._onGoingRequest)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){if(this.destroyed)throw new Error("instance is already destroyed");for(var e=this._queue.pop();e;)e.resolver.reject(n.createAbortError()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=n.createAbortController()},t.prototype.push=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i=this;return r.__generator(this,(function(r){if(this.destroyed)throw new Error("instance is already destroyed");return t=n.createResolver(),this._queue.push({event:e,resolver:t}),this.notifyChange("updating"),Promise.resolve().then((function(){i._processNext()})),[2,t.promise]}))}))},t.prototype._processNext=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_,v,m,b,x,I,S=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(this._onGoingRequest)return[2];for(e=[],t=new Set,i=new Set,n=new Set,o=this._queue.shift();o;){for(s=o.event,a=s.addedFeatures,u=s.deletedFeatures,l=s.updatedFeatures,c=o.resolver,e.push(c),h=0,d=a;h<d.length;h++)f=d[h],b=f.objectId,f.error||(t.add(b),i.add(b),n.delete(b));for(p=0,y=l;p<y.length;p++)g=y[p],b=g.objectId,g.error||(i.add(b),n.delete(b));for(_=0,v=u;_<v.length;_++)m=v[_],b=m.objectId,m.error||(t.has(b)?t.delete(b):n.add(b),i.delete(b));o=this._queue.shift()}return i.size||n.size?(x=[],I=[],i.size&&i.forEach((function(e){x.push(e)})),n.size&&n.forEach((function(e){I.push(e)})),this._onGoingRequest=Promise.resolve().then((function(){return S.processEdits(x,I,{signal:S._abortController.signal})})).catch((function(){})),this.notifyChange("updating"),[4,this._onGoingRequest]):(this.notifyChange("updating"),e.forEach((function(e){return e()})),[2]);case 1:return r.sent(),this._onGoingRequest=null,this.notifyChange("updating"),e.forEach((function(e){return e()})),this._queue.length>0&&this._processNext(),[2]}}))}))},r.__decorate([o.property({constructOnly:!0})],t.prototype,"processEdits",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([o.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],t)}(i);t.EditsQueue=s}.apply(null,i))||(e.exports=n)},2271:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},2272:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2273),r(402),r(721)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=[],s=new Set,a=function(){function e(){this._tileById=new Map,this._tilesToFeatures=new Map,this._featureToTiles=new Map}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var i=e;this._tileById.set(i.id,i),this._tilesToFeatures.set(i,r.default.acquire()),this._tilesToFeatures.forEach((function(e,r){i!==r&&(n.isParentOf(i,r)?e.forEach((function(e){t._link(i,e)})):n.isChildOf(i,r)&&t.featureStore.forEachInBounds(i.bounds,(function(r){e.has(r.objectId)&&t._link(i,r.objectId)})))}))}},e.prototype.clear=function(){this._tilesToFeatures.forEach((function(e){return r.default.release(e)})),this._tilesToFeatures.clear(),this._featureToTiles.forEach((function(e){return r.default.release(e)})),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);o.length=0,this._tilesToFeatures.get(r).forEach((function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?o.push(e):t._unlink(r,e)}));for(var i=0,n=o;i<n.length;i++){var s=n[i];this._unlink(r,s)}this.featureStore.removeManyById(o),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),o.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var i=this,n=this.get(e.id);this._tilesToFeatures.has(n)||(this._tileById.set(n.id,n),this._tilesToFeatures.set(n,r.default.acquire()));for(var a=0,u=t;a<u.length;a++){var l=u[a];s.add(l.objectId)}o.length=0,this._tilesToFeatures.get(n).forEach((function(e){if(!s.has(e)){var t=i._featureToTiles.get(e);t.has(n)&&1===t.size?o.push(e):i._unlink(n,e)}}));for(var c=0,h=o;c<h.length;c++){var d=h[c];this._unlink(n,d)}this.featureStore.removeManyById(o),this.featureStore.addMany(t),s.forEach((function(e){i._link(n,e)})),s.clear(),o.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new Set,n=new i.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),o=0,s=this.deleteFeaturesById(e.map((function(e){return e.objectId})));o<s.length;o++){var a=s[o];r.add(a)}n.addMany(e),this._tileById.forEach((function(e){n.forEachInBounds(e.bounds,(function(i){t._link(e,i.objectId),r.add(e)}))})),this.featureStore.addMany(e);var u=[];return r.forEach((function(e){return u.push(e)})),u},e.prototype.deleteFeaturesById=function(e){for(var t=this,i=new Set,n=function(e){var n=o._featureToTiles.get(e);n&&(n.forEach((function(r){i.add(r),t._tilesToFeatures.get(r).delete(e)})),r.default.release(n),o._featureToTiles.delete(e))},o=this,s=0,a=e;s<a.length;s++)n(a[s]);this.featureStore.removeManyById(e);var u=[];return i.forEach((function(e){return u.push(e)})),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,r.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(r.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=a}.apply(null,i))||(e.exports=n)},2273:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._pool=[],this._set=new Set}return e.prototype.acquire=function(){if(0===this._pool.length)return new Set;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return i.acquire()},e.release=function(e){return i.release(e)},e}();t.default=r;var i=new r}.apply(null,i))||(e.exports=n)},2274:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(158),r(153),r(231),r(151),r(205),r(585)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0],c=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=n.createAbortController();this._queue.set(e,{tileId:e,key:u.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=o.schedule(this._next))},t.prototype._next=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,i=e.tileId,n=e.key,u.TileKey.pool.release(n),this._queue.delete(i),this._onGoingTile=e,o=this.process(i,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(o))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,o];case 2:case 3:return r.sent(),[3,4];case 4:return this._finalize(),[2]}}))}))},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=null;return this._queue.forEach((function(s){t.getTileCoords(l,s.key);var u=e._timestamp-s.timestamp;if(isNaN(u))(c=a.vec2.distance(l,r))<n&&(n=c,o=s);else if(u===i){var c;(c=a.vec2.distance(l,r))<n&&(n=c,o=s)}else u>i&&(i=u,n=Number.POSITIVE_INFINITY,o=s)})),o},r.__decorate([s.property({readOnly:!0})],t.prototype,"length",null),r.__decorate([s.property({constructOnly:!0})],t.prototype,"process",void 0),r.__decorate([s.property()],t.prototype,"state",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([s.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(i);t.default=c}.apply(null,i))||(e.exports=n)},248:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(200),r(178)],void 0===(n=function(e,t,r,i){function n(e,t,n){if(!t||!n||n.vcsWkid||i.equals(t,n))return null;var o=r.getMetersPerVerticalUnitForSR(t)/r.getMetersPerVerticalUnitForSR(n);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return r=o,void((t=e)&&null!=t.z&&(t.z*=r));var t,r};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e)for(var r=0,i=e.paths;r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){var s=o[n];s.length>2&&(s[2]*=t)}}(e,o)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e)for(var r=0,i=e.rings;r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){var s=o[n];s.length>2&&(s[2]*=t)}}(e,o)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e)for(var r=0,i=e.points;r<i.length;r++){var n=i[r];n.length>2&&(n[2]*=t)}}(e,o)};default:return null}}function o(e,t,r){if(null==e.hasM||e.hasZ)for(var i=0,n=t;i<n.length;i++)for(var o=0,s=n[i];o<s.length;o++){var a=s[o];a.length>2&&(a[2]*=r)}}function s(e,t,r){if(e)for(var i=0,n=e;i<n.length;i++)a(n[i].geometry,t,r)}function a(e,t,n){if(e&&e.spatialReference&&!i.equals(e.spatialReference,t)){var s=r.getMetersPerVerticalUnitForSR(e.spatialReference)/n;if(1!==s)if("x"in e)null!=e.z&&(e.z*=s);else if("rings"in e)o(e,e.rings,s);else if("paths"in e)o(e,e.paths,s);else if("points"in e&&(null==e.hasM||e.hasZ))for(var a=0,u=e.points;a<u.length;a++){var l=u[a];l.length>2&&(l[2]*=s)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGeometryZScaler=n,t.applyFeatureSetZUnitScaling=function(e,t,r){if(r&&r.features&&r.hasZ){var i=n(r.geometryType,t,e.outSpatialReference);if(i)for(var o=0,s=r.features;o<s.length;o++)i(s[o].geometry)}},t.unapplyEditsZUnitScaling=function(e,t,i){if((e||t)&&i){var n=r.getMetersPerVerticalUnitForSR(i);s(e,i,n),s(t,i,n)}}}.apply(null,i))||(e.exports=n)},302:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(118),r(152),r(483),r(153),r(198),r(200),r(193),r(173),r(353),r(163),r(178),r(363),r(263),r(558),r(719),r(559),r(512),r(315),r(255),r(383)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_,v,m,b,x,I,S){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t};var w=new Set,T=new s.MemCacheStorage(2e6),F=0,M=function(){function e(e){var t=this;this.capabilities={query:_.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new s.MemCache(F+++"$$",T)),this.fieldsIndex=new I(e.fields),e.scheduler&&e.task&&(this._frameQueue=new S.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=b.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),[3,9];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return i=new v.default([],null,this),[3,9];case 9:return[2,i.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return[2,(i=r.sent()).size];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,a,u,h,d,f=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),o=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),(s=i.size)?(c.set(R,c.NEGATIVE_INFINITY),this.featureStore.forEachBounds(i.items,(function(e){return c.expand(R,e)}),E),a={xmin:R[0],ymin:R[1],xmax:R[3],ymax:R[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(R[2])&&isFinite(R[5])&&(a.zmin=R[2],a.zmax=R[5]),(u=g.project(a,i.spatialReference,o)).spatialReference=x.cleanFromGeometryEngine(o||this.spatialReference),u.xmax-u.xmin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.xmin-=h,u.xmax+=h),u.ymax-u.ymin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.ymin-=h,u.ymax+=h),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.zmin-=h,u.zmax+=h),[2,{count:s,extent:u}]):[2,{count:s,extent:null}];case 8:if((d=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return u.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,a,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),o=i.items,s=new Set,[4,this._reschedule((function(){for(var e=0,t=o;e<t.length;e++){var r=t[e];s.add(i.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,s];case 9:if((a=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw a;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,o,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=n.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return o=r.sent(),[4,this._reschedule((function(){return o.executeObjectIdsQuery(t)}))];case 5:return o=r.sent(),[4,this._reschedule((function(){return o.executeTimeQuery(t)}))];case 6:return o=r.sent(),[4,this._reschedule((function(){return o.executeAttributesQuery(t)}))];case 7:return o=r.sent(),[4,this._reschedule((function(){return o.filterLatest()}))];case 8:return o=r.sent(),[3,10];case 9:if((s=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw s;return o=new v.default([],null,this),[3,10];case 10:return[2,o.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new v.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,s,a,u,l,c,h,d,f,y,g,_,b,x,I,S,w,T=this;return r.__generator(this,(function(F){switch(F.label){case 0:if(t=e.geometry,i=e.outSR,n=e.spatialRel,s=p.isValid(i)&&!p.equals(this.spatialReference,i),(a=this._geometryQueryCache?s?JSON.stringify({geometry:t,spatialRelationship:n,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:n}):null)&&(u=this._geometryQueryCache.get(a),!o.isUndefined(u)))return[2,u];if(l=function(t){return r.__awaiter(T,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return s&&(e.returnGeometry||e.returnCentroid)?[4,t.project(i)]:[3,2];case 1:return n=r.sent(),a&&this._geometryQueryCache.put(a,n,n.size||1),[2,n];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==n)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(y=new Set,g=0,_=h;g<_.length;g++)b=_[g],y.add(c.getObjectId(b));return[4,this._reschedule((function(){var e=0;d=new Array(y.size),T.featureStore.forEach((function(t){return d[e++]=t})),f=y}))];case 1:return F.sent(),[4,this._reschedule((function(){return r.__awaiter(T,void 0,void 0,(function(){var e,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),i=function(t){return!f.has(c.getObjectId(t))||e(c.getGeometry(t))},o=v.default.bind,[4,this._runSpatialFilter(d,i)];case 2:return[2,new(o.apply(v.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return I=F.sent(),[2,l(I)];case 3:return(x=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new v.default(x,t,this))]:[4,m.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)]:(I=new v.default([],t,this),a&&this._geometryQueryCache.put(a,I,I.size||1),[2,I]);case 4:return S=F.sent(),[4,this._runSpatialFilter(x,(function(e){return S(c.getGeometry(e))}))];case 5:return w=F.sent(),[2,l(new v.default(w,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s=this;return r.__generator(this,(function(a){return t?this._budget?(i=0,n=new Array,o=function(){return r.__awaiter(s,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return i<e.length?(s=e[i],t(s)&&n.push(s),this._budget.done?[4,this._reschedule((function(){return o()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++i,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return o()})).then((function(){return n}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return m.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(m.canQueryWithRBush(e)){if(f.isExtent(e))return[h.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(f.isPolygon(e))return e.rings.map((function(e){return h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[d.getBoundsXY(h.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,(function(e){w.add(e)}))}var n=new Array(w.size),o=0;return w.forEach((function(e){return n[o++]=e})),w.clear(),n},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,a.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),m.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,o=e.outStatistics,s=o?o.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var a=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===s.indexOf(e)}));y.validateFields(this.fieldsIndex,a,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new i("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a,u,l,c,h,d,f;return r.__generator(this,(function(r){if(t=e.outStatistics,n=e.groupByFieldsForStatistics,o=e.having,s=n&&n.length,a=t&&t.length,o){if(!s||!a)throw new i("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,o,t)}if(a){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),s&&y.validateFields(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(h=c[l],d=h.onStatisticField,"percentile_disc"!==(f=h.statisticType)&&"percentile_cont"!==f||!("statisticParameters"in h)){if("count"!==f&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new i("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}else if(!h.statisticParameters)throw new i("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:h,query:e})}return[2]}))}))},e}();t.default=M;var E=c.create(),R=c.create()}.apply(null,i))||(e.exports=n)},314:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},328:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(329)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,o=0,s=i.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},329:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(154),r(156),r(268),r(330),r(331)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function h(e){return e>=u.length?null:u[e]}function d(e){return e>=c.length?null:c[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){for(var i=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),o=e.pos()+n,s=0;e.pos()<o;)t.addCoordinatePoint(i,e.getSInt64(),0,s++);break;case 1:case 2:default:e.skip()}return i}function y(e,t,r){for(var i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),s=e.pos()+o,a=0;e.pos()<s;)t.addLength(i,e.getUInt32(),a++);break;case 3:for(var u=e.getUInt32(),l=(s=e.pos()+u,0),c=0;e.pos()<s;)t.addCoordinate(i,e.getSInt64(),c,l),++l===n&&(c++,l=0);break;case 1:default:e.skip()}return i}function g(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function _(e){for(var t,r={type:h(0)};e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.type=h(e.getEnum());break;case 3:r.alias=e.getString();break;case 4:r.sqlType=(t=e.getEnum())>=l.length?null:l[t];break;case 5:case 6:default:e.skip()}return r}function v(e,t,r,i){for(var n=t.createFeature(r),o=0;e.next();)switch(e.tag()){case 1:var s=i[o++].name;n.attributes[s]=e.processMessage(g);break;case 2:n.geometry=e.processMessageWithArgs(y,t,r);break;case 4:n.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return n}function m(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function b(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function x(e){for(var t={originPosition:d(0)};e.next();)switch(e.tag()){case 1:t.originPosition=d(e.getEnum());break;case 2:t.scale=e.processMessage(m);break;case 3:t.translate=e.processMessage(b);break;default:e.skip()}return t}function I(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function S(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function w(e,t){var r=t.createFeatureResult();r.geometryType=f(t,0);for(var i=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(I);break;case 7:r.geometryType=f(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(S,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(x);break;case 9:var n=e.getBool();r.exceededTransferLimit=n;break;case 13:t.addField(r,e.processMessage(_));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,e.processMessageWithArgs(v,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function T(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(w,t);break;default:e.skip()}return r}t.parseFeatureQuery=function(e,t){var i=function(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}(t);try{for(var u=new n(new Uint8Array(e),new DataView(e)),l={};u.next();)switch(u.tag()){case 2:l.queryResult=u.processMessageWithArgs(T,i);break;default:u.skip()}return l}catch(e){var c=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(c),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},330:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(174),r(177),r(170),r(207),r(194),r(248)],void 0===(n=function(e,t,r,i,n,o,s,a){function u(e,t){return t}function l(e,t,r,i){switch(r){case 0:return f(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?f:p)(e,t+i,1)}}function c(e,t,r,i){switch(r){case 0:return f(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?f:p)(e,t+i,1);case 2:return f(e,t,2)}}function h(e,t,r,i){switch(r){case 0:return f(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?f:p)(e,t+i,1);case 2:return f(e,t,3)}}function d(e,t,r,i){switch(r){case 0:return f(e,t+i,0);case 1:return("lowerLeft"===e.originPosition?f:p)(e,t+i,1);case 2:return f(e,t,2);case 3:return f(e,t,3)}}function f(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function p(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new o.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=a.getGeometryZScaler(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(var r=0,i=e.features;r<i.length;r++)t(i[r].geometry)}},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t));var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&(t.attributes[i]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){var t=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePoint(e,r,n)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePolygon(e,r,n)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,r,i,n){return t.addCoordinatePolyline(e,r,n)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,r,i,n){return t.addCoordinateMultipoint(e,r,n)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new o.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},e.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var i=this.lengths.reduce((function(e,t){return e+t}),0);this.coordinateBuffer=new Float64Array(i*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var n=this.transformPathLikeValue(t,r),o=e[e.length-1];0===r&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=n},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?d:t?c:r?h:l},e}();t.Context=y}.apply(null,i))||(e.exports=n)},331:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(200),r(178),r(274),r(304),r(224)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new o.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!i.equals(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=r.getMetersPerVerticalUnitForSR(this.options.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==t)for(var n=0,o=e.features;n<o.length;n++){var s=o[n];if(s.geometry&&s.geometry.coords)for(var a=s.geometry.coords,u=2;u<a.length;u+=3)a[u]*=t}}},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new n.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new s.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new s.default},e}();t.Context=a}.apply(null,i))||(e.exports=n)},348:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(165),r(152),r(153),r(172),r(163),r(234),r(304),r(328),r(314),r(248),r(161)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d){function f(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=a.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var o=i.timeExtent,s=o.start,u=o.end;null==s&&null==u||(n.time=s===u?s:(null==s?"null":s)+","+(null==u?"null":u)),delete i.timeExtent}return n}function p(e,t,o,a,l){void 0===a&&(a={});var c="string"==typeof e?s.urlToObject(e):e,d=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",u.normalizeCentralMeridian(d,null,a).then((function(e){var s=e&&e[0];n.isSome(s)&&((t=t.clone()).geometry=s);var u=h.mapParameters(r.__assign(r.__assign(r.__assign(r.__assign({},c.query),{f:o}),l),f(t,l)));return i(c.path+"/query",r.__assign(r.__assign({},a),{query:u}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.queryToQueryStringParameters=f,t.executeQuery=function(e,t,i,n){var o;return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(null===(o=t.timeExtent)||void 0===o?void 0:o.isEmpty)?(a={data:{features:[]}},[3,3]):[3,1];case 1:return[4,p(e,t,"json",n)];case 2:a=r.sent(),r.label=3;case 3:return s=a,d.applyFeatureSetZUnitScaling(t,i,s.data),[2,s]}}))}))},t.executeQueryPBF=function(e,t,r,i){var n;return(null===(n=t.timeExtent)||void 0===n?void 0:n.isEmpty)?o.resolve({data:new l.default}):p(e,t,"pbf",i).then((function(e){var t,i;return t=c.parsePBFFeatureQuery(e.data,r),(i=e).data=t,i}))},t.executeQueryForIds=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{objectIds:[]}}):p(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{count:0}}):p(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){var i;return(null===(i=t.timeExtent)||void 0===i?void 0:i.isEmpty)?o.resolve({data:{count:0,extent:null}}):p(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error("Layer does not support extent calculation.");if(t.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return e}))},t.runQuery=p}.apply(null,i))||(e.exports=n)},383:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(153)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,i){return t._tasks.push(new n(r,i,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,i){return t._tasks.unshift(new n(r,i,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._tasks;t<i.length;t++)i[t].reject(e);this._tasks.length=0},e}();t.default=i;var n=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,i))||(e.exports=n)},402:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(190),r(156),r(152),r(193),r(173),r(178),r(243),r(466),r(424),r(384)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f){Object.defineProperty(t,"__esModule",{value:!0});var p=o.getLogger("esri.layers.graphics.data.FeatureStore"),y=function(){function e(e){this.geometryInfo=e,this._boundsStore=new h.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new n,this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=u.create(u.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var i=e._boundsStore.get(r.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i],s=this._boundsStore.get(o.objectId);s&&t(a.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,a,c,h,f,p,y,g,_,v,m,b;return r.__generator(this,(function(r){return n=i.returnGeometry,o=i.returnCentroid,s=i.returnOutline,a=i.pixelBuffer,c=new Set,h=[],f=a*e.resolution,p=u.pad(e.bounds,f,u.create()),d.createTileFeatures(h,c,this.geometryInfo,this,p,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||o)&&(y=l.getInfo(t))&&(g=y.valid,_=g[0],v=g[1],p[0]<_&&(m=u.fromValues(v-f,p[1],v,p[3]),d.createTileFeatures(h,c,this.geometryInfo,this,m,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[v,e.bounds[3]]})),p[2]>v&&(b=u.fromValues(_,p[1],_+f,p[3]),d.createTileFeatures(h,c,this.geometryInfo,this,b,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[_-v+e.bounds[0],e.bounds[3]]}))),h.sort((function(e,t){return e.localId-t.localId})),[2,{features:h,objectIds:c}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):s.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=c.getBoundsOptimizedGeometry(r||u.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else p.error(new i("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return s.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=y}.apply(null,i))||(e.exports=n)},424:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(173),r(243),r(224),r(302),r(315)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new n.default,u={esriGeometryPoint:i.convertToPoint,esriGeometryPolyline:i.convertToPolyline,esriGeometryPolygon:i.convertToPolygon,esriGeometryMultipoint:i.convertToMultipoint};t.executeTileQueryForIds=function(e,t,i){var n=i.pixelBuffer*t.resolution,o=r.pad(t.bounds,n,r.create()),s=[];return e.featureStore.forEachInBounds(o,(function(t){return s.push(e.featureAdapter.getObjectId(t))})),s},t.createTileFeatures=function(e,t,r,i,n,h,d,f,p){var y=u[r.geometryType],g=l[r.geometryType],_="esriGeometryPolygon"===r.geometryType&&!f,v=r.hasZ?r.hasM?4:3:r.hasM?3:2;d&&!h?i.forEachInBounds(n,(function(i){return function(e,t,r,i,n){if(!t.has(r.objectId)){var a=s.getCentroid(i,r,n),u=r.attributes;a&&(t.add(r.objectId),e.push(new o.Feature(u,r.localId,null,a)))}}(e,t,i,r,p)})):h&&!d?i.forEachInBounds(n,(function(r){return function(e,t,r,i,n,s,u,l){if(!t.has(r.objectId)){var h=r.attributes,d=i(c(a,r.geometry,n,s,l,u),!1,!1);d&&(t.add(r.objectId),e.push(new o.Feature(h,r.localId,d,null)))}}(e,t,r,y,v,g,p,_)})):i.forEachInBounds(n,(function(i){return function(e,t,r,i,n,u,l,h,d){if(!t.has(r.objectId)){var f=s.getCentroid(i,r,n),p=r.attributes,y=u(c(a,r.geometry,l,h,d,n),!1,!1);y&&f&&(t.add(r.objectId),e.push(new o.Feature(p,r.localId,y,f)))}}(e,t,i,r,p,y,v,g,_)}))};var l={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function c(e,t,r,n,o,s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var a,u,l,c,h=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=i.quantizeX(s,h[0]),e.coords[1]=i.quantizeY(s,h[1]),e.coords.length=r,e;for(var f=0,p=0,y=p,g=0,_=d;g<_.length;g++){var v=_[g];if(!(v<n))if(p=y,l=a=i.quantizeX(s,h[f]),c=u=i.quantizeY(s,h[f+1]),e.coords[p]=l,e.coords[p+1]=c,f+=r,1!==v){var m=(l=i.quantizeX(s,h[f]))-a,b=(c=i.quantizeY(s,h[f+1]))-u,x=b/m;p+=2,e.coords[p]=m,e.coords[p+1]=b,a=l,u=c,f+=r;for(var I=2;I<v;I++){if(l=i.quantizeX(s,h[f]),c=i.quantizeY(s,h[f+1]),l!==a||c!==u){var S=l-a,w=c-u,T=w/S;x!==T&&(isFinite(x)||isFinite(T))||!(o||(b>=0&&w>=0||b<=0&&w<=0)&&(m>=0&&S>=0||m<=0&&S<=0))?(m=S,b=w,p+=2):(m+=S,b+=w),e.coords[p]=m,e.coords[p+1]=b,x=T,a=l,u=c}f+=r}var F=(p+2-y)/2;F>=n&&(e.lengths.push(F),y=p+2)}else e.lengths.push(1),y=p+2}return e.coords.length>y&&(e.coords.length=y),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=c}.apply(null,i))||(e.exports=n)},466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(164),r(382),r(161)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},o=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,i){t[r++]=i})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=function(e,t){return n.minX=t[0],n.minY=t[1],n.maxX=t[2],n.maxY=t[3],e.search(n)}(this._index,e);r<i.length;r++){var o=i[r];t(this._idByBounds.get(o))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=o}.apply(null,i))||(e.exports=n)},467:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(171),r(186),r(206),r(450)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.enums.WGLVVFlag;function u(e){return{value:e.value,size:i.toPt(e.size)}}function l(e){return e.map((function(e){return u(e)}))}function c(e){if("string"==typeof e||"number"==typeof e)return i.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:l(t.stops)}}t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=u,t.normalizeSizeStops=l,t.normalizeSizeElement=c,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach((function(e){var r=e.type;e.field&&(t[r]=e.field)})),t};var h=function(e){for(var t=[],r=[],n=l(e),s=n.length,a=0;a<6;a++){var u=n[Math.min(a,s-1)];t.push(u.value),r.push(null==u.size?o.NAN_MAGIC_NUMBER:i.pt2px(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function d(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(n.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,i=0;i<8;++i){var o=r[Math.min(i,r.length-1)];t.values[i]=o.value,t.opacities[i]=o.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(i=0;i<8;i++)t.values[i]=1/0,t.opacities[i]=s}return t}t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(var o=0,u=e;o<u.length;o++){var f=u[o],p=f.type;if(f.field&&(t[p]=f.field),"size"===p){i.size||(i.size={});var y=f;switch(n.getTypeOfSizeVisualVariable(y)){case a.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:y.minDataValue,maxDataValue:y.maxDataValue,minSize:c(y.minSize),maxSize:c(y.maxSize)};break;case a.SIZE_SCALE_STOPS:i.size.scaleStops={stops:l(y.stops)};break;case a.SIZE_FIELD_STOPS:if(y.levels){var g={};for(var _ in y.levels)g[_]=h(y.levels[_]);i.size.fieldStops={type:"level-dependent",levels:g}}else i.size.fieldStops=r.__assign({type:"static"},h(y.stops));break;case a.SIZE_UNIT_VALUE:i.size.unitValue={unit:y.valueUnit,valueRepresentation:y.valueRepresentation}}}else if("color"===p){var v=s.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!v)continue;i.color=v.color;for(var m=0;m<32;m+=4)n.color.premultiplyAlpha(i.color.colors,m,!0)}else if("opacity"===p)i.opacity=d(f);else if("rotation"===p){var b=f;i.rotation={type:b.rotationType}}}return{vvFields:t,vvRanges:i}}}.apply(null,i))||(e.exports=n)},558:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=n)},560:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(164),r(118),r(582)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.defaultPointSymbolJSON:"esriGeometryPolyline"===e?o.defaultPolylineSymbolJSON:o.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(i("csp-restrictions"))return function(){var i;return r.__assign(((i={})[t]=null,i),e)};try{var n="this."+t+" = null;";for(var o in e)n+="this."+o+" = "+JSON.stringify(e[o])+";";var s=new Function(n);return function(){return new s}}catch(i){return function(){var i;return r.__assign(((i={})[t]=null,i),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:"New Feature",description:"",prototype:{attributes:n.clone(e)}}]}}.apply(null,i))||(e.exports=n)},561:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(154),r(164),r(156),r(168),r(152),r(153),r(255),r(246),r(186),r(408),r(206),r(467),r(161)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c,h,d,f,p,y){Object.defineProperty(t,"__esModule",{value:!0});var g=s.getLogger("esri.views.layers.2d.features.support.AttributeStore"),_=d.debug.createDebugLogger(d.debug.DEBUG_ATTR_UPDATES,g);t.LOCAL_ID_TYPE_AGGREGATE=1;var v=function(e){return(2147483648&e)>>>31},m=function(e){return 2147483647&e};t.isAggregateId=function(e){return v(e)===t.LOCAL_ID_TYPE_AGGREGATE};var b=function(e,t){return function(r,i,n){var o;try{o=t(r,i,n)}catch(e){o=NaN}return(null===o||isNaN(o)||o===1/0)&&e||o}},x={sharedArrayBuffer:o("esri-shared-array-buffer"),oesTextureFloat:o("esri-webgl-texture-float"),maxTextureSize:o("esri-webgl-max-texture-size"),atomics:o("esri-atomics")},I=function(){function e(e,t,r,i){this.texelSize=4;var n=i.pixelType,o=i.layout,s=i.textureOnly;this.textureOnly=s||!1,this.pixelType=n,this._ctype=t,this.layout=o,this._resetRange(),this._shared=e,s||(this.data=this._initData(n,r,e,t))}return Object.defineProperty(e.prototype,"buffer",{get:function(){return u.andThen(this.data,(function(e){return e.buffer}))},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){var r=m(e);return u.unwrap(this.data)[r*this.texelSize+t]},e.prototype.setData=function(e,t,r){var i=m(e),n=1<<t;0!=(this.layout&n)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):g.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.lock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):o("esri-2d-debug")&&g.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.unlock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):o("esri-2d-debug")&&g.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=u.unwrap(this.data);t.set(r),this.data=t}},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,o=this.layout,s=u.unwrap(this.data);return s.slice?{start:e,end:t,data:i&&s.slice(e*r,(t+1)*r)||null,pixelType:n,layout:o}:i?{start:e,end:t,data:new(d.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:o}:{start:e,end:t,data:null,pixelType:n,layout:o}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,o=d.Utils.getPixelArrayCtor(e),s=new o(new n(t*t*4*o.BYTES_PER_ELEMENT)),a=0;a<s.length;a+=4)s[a+1]=255;return s},e.prototype._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},e}(),S=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(d.definitions.MAX_FILTERS),this._freeTexelsList=[],this._abortController=l.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=x.oesTextureFloat?5126:5121;_("Creating AttributeStore "+(x.sharedArrayBuffer?"with":"without")+" shared memory"),o("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&g.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map((function(){return null}))}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.invalidateResources=function(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=l.createAbortController()},e.prototype.createLocalId=function(e,t){if(void 0===t&&(t=!1),!this._idMap.has(e)){var r=function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeTexel(),t);this._idMap.set(e,-1===r?0:r),this._localToObjectId.set(r,e)}return this._idMap.get(e)},e.prototype.addLocalId=function(e){this._getBlock(0).setData(e,0,0),this._freeTexelsList.push(m(e))},e.prototype.removeLocalId=function(e){var t=this._idMap.get(e);return this._idMap.delete(e),this._localToObjectId.delete(t),t},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);o("esri-2d-debug")&&!t&&console.debug("Called freeLocalId for an invalid id"),this._getBlock(0).setData(t,0,0),this._idMap.delete(e),this._localToObjectId.delete(t),this._freeTexelsList.push(m(t))},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.setHighlight=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,o,s,a,u=this;return i.__generator(this,(function(i){switch(i.label){case 0:for(this._getBlock(0).lock(),this._idsToHighlight.forEach((function(e){var t=u.getLocalId(e);if(t){var r=u._getBlock(0).getData(t,0);u._getBlock(0).setData(t,0,-2&r)}})),this._idsToHighlight.clear(),t=0,r=e;t<r.length;t++)n=r[t],this._idsToHighlight.add(n);for(o=0;o<e.length;o++)null!=(s=this.getLocalId(e[o]))&&(a=this._getBlock(0).getData(s,0),this._getBlock(0).setData(s,0,1|a));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return i.sent(),[2]}}))}))},e.prototype.addHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.removeHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.updateFilters=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,o,s,a=this;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,o=t.filters,s=o.map((function(t,i){return a._updateFilter(e,t,i,r,n)})),[4,l.all(s)];case 1:return i.sent(),[2]}}))}))},e.prototype.setAttributeBindings=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:g.error(new n("attribute-store","Found invalid renderer type: "+e))}return[2]}))}))},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.getData=function(e,t,r){return this._getBlock(t).getData(e,r)},e.prototype.getHighlightFlag=function(e){return this._idsToHighlight.has(e)?p.HIGHLIGHT_FLAG:0},e.prototype.setAttributeData=function(e,t,r,i){var n=this,o=e;this._getBlock(0).setData(o,0,this.getFilterFlags(t));var s=this._attributeComputeMap,u=x.oesTextureFloat?1:2;s.forEach((function(e,s){var l=s*u%4,c=Math.floor(s*u/4),h=n._getBlock(c+p.ATTRIBUTE_DATA_VV),f=e(t,{$view:i},r);if(x.oesTextureFloat)h.setData(o,l,f);else if(f===d.definitions.NAN_MAGIC_NUMBER)h.setData(o,l,255),h.setData(o,l+1,255);else{var y=a.clamp(Math.round(f),-32767,32766)+32768,g=255&y,_=(65280&y)>>8;h.setData(o,l,g),h.setData(o,l+1,_)}}))},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map((function(e){return u.isSome(e)?e.toMessage():null}))};return this._currUpdate=this._createResources().then((function(){var r=function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then((function(){return t.resolve()}))}},i=e._client.update(t,e._signal).then(r).catch(r);return e._client.render(),i})).catch((function(t){return l.isAbortError(t)?(e._createResourcesPromise=null,e._createResources()):(g.error(new n("mapview-attribute-store","Encountered an error during client update",t)),l.resolve())})),this._currUpdate},e.prototype._createResources=function(){var e=this;if(u.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(p.ATTRIBUTE_DATA_ANIMATION),_("Initializing AttributeStore");var t={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:u.mapMany(this._blocks,(function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}}))},r=this._client.initialize(t,this._signal).catch((function(t){l.isAbortError(t)?e._createResourcesPromise=null:g.error(new n("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=r,r.then((function(){return u.isNone(e._createResourcesPromise)?e._createResources():void 0})),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(u.isSome(t))return t;_("Initializing AttributeBlock at index "+e);var r=x.sharedArrayBuffer,i=this._client.type,n=new I(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<x.maxTextureSize){var e=this._size<<=1;return _("Expanding block size to",e,this._blocks),u.forEachSome(this._blocks,(function(t){return t.expand(e)})),this._createResourcesPromise=null,this._size=e,0}return g.error(new n("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeTexel=function(){return this._freeTexelsList.length?this._freeTexelsList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,r,n,o,s){return i.__awaiter(this,void 0,void 0,(function(){var a,l,c,h,d,f,p,y=this;return i.__generator(this,(function(i){switch(i.label){case 0:return a=this._filters[n],(u.isSome(a)&&a.hash)===JSON.stringify(r)?[2]:(l=1<<n+1,u.isNone(r)?(this._filters[n]=null,this._idMap.forEach((function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|l)})),[2]):[4,e.queryObjectIds(r)]);case 1:return c=i.sent(),r.hiddenIds&&r.hiddenIds.length&&(c=c.filter((function(e){return-1===r.hiddenIds.indexOf(e)}))),h=c.map((function(e){return y._idMap.get(e)})),[4,this._getFilter(n,o)];case 2:for(i.sent().update(r,s),this._getBlock(0).lock(),this._idMap.forEach((function(e){if(v(e)!==t.LOCAL_ID_TYPE_AGGREGATE){var r=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,r&~l)}})),d=0;d<h.length;d++)null!=(f=h[d])&&(p=this._getBlock(0).getData(f,0),this._getBlock(0).setData(f,0,p|l));return this._getBlock(0).unlock(),[2]}}))}))},e.prototype._getFilter=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var n,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this._filters[e],u.isSome(n)?[2,n]:[4,new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(144)]).then(function(){var t=[r(848)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return o=i.sent().default,s=new o({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=s,[2,s]}}))}))},e.prototype.isVisible=function(e){return!!(2&this._getBlock(0).getData(e.localId,0))},e.prototype.getFilterFlags=function(e){for(var r,i=0,n=(r=e.localId,v(r)===t.LOCAL_ID_TYPE_AGGREGATE?254:255),o=0;o<this._filters.length;o++){var s=!!(n&1<<o),a=this._filters[o];i|=(!s||u.isNone(a)||a.check(e)?1:0)<<o}var l=this.getFeatureId(e.localId);return i<<1|this.getHighlightFlag(l)},e.prototype._bindVVEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r=this;return i.__generator(this,(function(n){switch(n.label){case 0:return this._attributeComputeMap.clear(),u.isSome(e)?[4,l.all(e.map((function(e){return i.__awaiter(r,void 0,void 0,(function(){var r,n;return i.__generator(this,(function(i){switch(i.label){case 0:return r=d.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),u.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._bindDDEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>d.definitions.DOT_DENSITY_MAX_FIELDS&&g.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+d.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,l.all(e.map((function(e){return s._createNormalizedFunction(e,t)})))];case 1:for(r=i.sent().map((function(e){return b(0,e)})),n=0;n<d.definitions.DOT_DENSITY_MAX_FIELDS;n++)(o=n<e.length&&r[n])?this._attributeComputeMap.set(n,o):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}}))}))},e.prototype._createGetValueFunction=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,o,s,a,u,l;return i.__generator(this,(function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=d.getTypeOfSizeVisualVariable(e))===d.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===d.enums.WGLVVFlag.SIZE_UNIT_VALUE,o=n&&function(t){return y.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},s=b,a=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,o)]);case 1:return[2,s.apply(void 0,a.concat([i.sent()]))];case 2:return u=b,l=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}}))}))},e.prototype._createNormalizedFunction=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return(o=e.field)?"string"==typeof o?(s=e.normalizationField)?[2,function(e){if(e.attributes[o]&&e.attributes[s]){var t=e.attributes[o]/e.attributes[s];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[o])}:function(e){return e.attributes[o]}]:(g.error(new n("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof o)),[2,function(){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,h.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return a=i.sent(),[2,f.callWithOptimizedFeature.bind(null,a)];case 2:return g.error("Unable to create a normalized function for visual variable: "+e),[2,function(){}]}}))}))},e}();t.default=S}.apply(null,i))||(e.exports=n)},562:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(152),r(171),r(441),r(370),r(205),r(306),r(170),r(173),r(353),r(479),r(163),r(234),r(178),r(178),r(186),r(186)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p,y,g,_){Object.defineProperty(t,"__esModule",{value:!0});var v=Math.PI/180,m=o.mat2df32.create(),b=a.vec2f32.create(),x=l.create();t.getBounds=function(e,t,r,i,n,o,s){if(!i||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var a=i;if(!d.isPoint(a)){c.getBoundsXY(e,a);var u=t[0];0===u&&(u=function(e){var t=0;switch(e.symbol.type){case"simple-fill":case"picture-fill":var r=e.symbol.outline;if(!r)return 0;t=r.width;break;case"simple-line":t=e.symbol.width;break;case"simple-marker":t=e.symbol.size;break;case"picture-marker":t=Math.max(e.symbol.width,e.symbol.height);break;case"text":var i=[0,0,0,0];O(i,e.symbol,e.mosaicItem);var n=Math.max(Math.abs(i[0]),Math.abs(i[1]));t=Math.max(i[2],i[3])+n;break;case"cim":case"expanded-cim":var o=g.CIMSymbolHelper.getEnvelope(e.symbol.data);t=Math.sqrt(o.width*o.width+o.height*o.height)}return t}(r),t[0]=u);var l=n*u/2;return e[0]-=l,e[1]-=l,e[2]+=l,e[3]+=l,e}var h=a.x,p=a.y;return"text"===r.symbol.type&&0===t[2]&&0===t[3]&&O(t,r.symbol,r.mosaicItem),function(e,t,r,i,n,o,s,a){var u;switch(i.type){case"simple-marker":case"picture-marker":u=R(t,r,i,o,s,0);break;case"text":u=C(t,r,i,n,o,0);break;case"cim":case"expanded-cim":u=P(t,r,i,o,s,0)}for(var l,c,h=0,d=0;d<u.rings[0].length-1;d++)l=(t-(c=u.rings[0][d])[0])*(t-c[0])+(r-c[1])*(r-c[1]),h=Math.max(h,l);h=Math.sqrt(h);var p=f.normalizeMapX(t-h,a),g=f.normalizeMapX(t+h,a);if(p>g){var _=y.getInfo(a);if(_){var v=_.valid;p=v[0],g=v[1]}}e[0]=p,e[1]=r-h,e[2]=g,e[3]=r+h}(e,h,p,r.symbol,t,n,o,s),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.unwrap(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var I=a.vec2f32.create(),S=a.vec2f32.create(),w=a.vec2f32.create(),T=a.vec2f32.create(),F=a.vec2f32.create(),M=a.vec2f32.create(),E=a.vec2f32.create();function R(e,t,r,o,a,u){var l,c,h=i.pt2px(r.xoffset),d=i.pt2px(r.yoffset),f=v*r.angle,p=v*u;switch(r.type){case"simple-marker":var y=r;l=c=i.pt2px(y.size);break;case"picture-marker":var g=r;l=i.pt2px(g.width),c=i.pt2px(g.height)}a<.04&&(o=.04*o/a);var _=n.mat2d.identity(m);n.mat2d.translate(_,_,s.vec2.set(b,e,t)),n.mat2d.rotate(_,_,p-f),n.mat2d.scale(_,_,s.vec2.set(b,o,-o)),n.mat2d.translate(_,_,s.vec2.set(b,h,-d));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,-.5*l,-.5*c),_);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,-.5*l,.5*c),_);var S=[0,0];s.vec2.transformMat2d(S,s.vec2.set(b,.5*l,-.5*c),_);var w=[0,0];return s.vec2.transformMat2d(w,s.vec2.set(b,.5*l,.5*c),_),{rings:[[x,S,w,I,x]]}}function P(e,t,r,o,a,u){var l=g.CIMSymbolHelper.getEnvelope(r.data);if(!l)return null;a<.04&&(o=.04*o/a);var c=i.pt2px(l.width),h=i.pt2px(l.height),d=i.pt2px(l.x),f=i.pt2px(l.y),p=0*v,y=v*u,_=n.mat2d.identity(m);n.mat2d.translate(_,_,s.vec2.set(b,e,t)),n.mat2d.rotate(_,_,y-p),n.mat2d.scale(_,_,s.vec2.set(b,o,o));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,d,f+h),_);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,d,f),_);var S=[0,0];s.vec2.transformMat2d(S,s.vec2.set(b,d+c,f+h),_);var w=[0,0];return s.vec2.transformMat2d(w,s.vec2.set(b,d+c,f),_),{rings:[[x,S,w,I,x]]}}function C(e,t,r,o,a,u){var l=i.pt2px(r.xoffset),c=i.pt2px(r.yoffset),h=v*r.angle,d=v*u,f=n.mat2d.identity(m);n.mat2d.translate(f,f,s.vec2.set(b,e,t)),n.mat2d.rotate(f,f,d),n.mat2d.scale(f,f,s.vec2.set(b,a,-a));var p=o[0]+o[2]/2,y=o[1]+o[3]/2;n.mat2d.translate(f,f,s.vec2.set(b,l,-c)),n.mat2d.translate(f,f,s.vec2.set(b,p,y)),n.mat2d.rotate(f,f,h),n.mat2d.translate(f,f,s.vec2.set(b,-p,-y));var g=[0,0];s.vec2.transformMat2d(g,s.vec2.set(b,o[0],o[1]),f);var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(b,o[0],o[1]+o[3]),f);var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,o[0]+o[2],o[1]),f);var I=[0,0];return s.vec2.transformMat2d(I,s.vec2.set(b,o[0]+o[2],o[1]+o[3]),f),{rings:[[g,x,I,_,g]]}}function O(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=g.bidiText(t.text)[1],o=r.glyphMosaicItems,s=_.shapeGlyphs(o,n,{scale:i.pt2px(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:_.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),vAlign:_.alignmentUtils.getYAnchorDirection(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=s.x-s.halfWidth,e[1]=s.y-s.halfHeight,e[2]=s.width,e[3]=s.height,e}t.isPointOnPolyline=function(e,t,r,i){s.vec2.set(w,t,r);for(var n,o,a,u,l,c,h,d,f,p=e.paths,y=1/0,g=0;g<p.length;g++){var _=p[g];if(!(_.length<2))for(var v=1;v<_.length;v++)n=_[v-1][0],a=_[v-1][1],o=_[v][0],u=_[v][1],l=Math.min(n,o)-i,c=Math.min(a,u)-i,h=Math.max(n,o)+i,d=Math.max(a,u)+i,t<l||t>h||r<c||r>d||(s.vec2.set(I,n,a),s.vec2.set(S,o,u),s.vec2.subtract(T,S,I),s.vec2.subtract(F,I,w),s.vec2.scale(M,T,s.vec2.dot(T,F)/s.vec2.dot(T,T)),s.vec2.subtract(E,F,M),y>(f=s.vec2.dot(E,E))&&(y=f))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=R,t.getCIMMarkerBounds=P,t.getTextSymbolBounds=C,t.normalizeCentralMeridian=function(e){var t,r,i,n,o,s,a,u,l,f=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,!(r=p.getInfo(t)))return e.toJSON();i=t.isWebMercator,n=k[s=i?102100:4326].maxX,o=k[s].minX,a=k[s].plus180Line,u=k[s].minus180Line;var y=e.toJSON();if(d.isPoint(y))l=N(y,n,o);else if(d.isMultipoint(y))y.points=y.points.map((function(e){return N(e,n,o)})),l=y;else if(d.isExtent(y))l=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,o=e.ymax,s=e.xmax-e.xmin,a=e.xmin,u=e.xmax,l=t.valid,c=l[0],h=l[1],d=(r=A(e.xmin,t)).x,f=r.frameId,p=(r=A(e.xmax,t)).x,y=r.frameId,g=d===p&&s>0;if(s>2*h){var _={xmin:a<u?d:p,ymin:n,xmax:h,ymax:o},v={xmin:c,ymin:n,xmax:a<u?p:d,ymax:o},m={xmin:0,ymin:n,xmax:h,ymax:o},b={xmin:c,ymin:n,xmax:0,ymax:o},x=[],I=[];G(_,m)&&x.push(f),G(_,b)&&I.push(f),G(v,m)&&x.push(y),G(v,b)&&I.push(y);for(var S=f+1;S<y;S++)x.push(S),I.push(S);i.push({extent:_,frameIds:[f]},{extent:v,frameIds:[y]},{extent:m,frameIds:x},{extent:b,frameIds:I})}else d>p||g?i.push({extent:{xmin:d,ymin:n,xmax:h,ymax:o},frameIds:[f]},{extent:{xmin:c,ymin:n,xmax:p,ymax:o},frameIds:[y]}):i.push({extent:{xmin:d,ymin:n,xmax:p,ymax:o},frameIds:[f]});return i}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(y,r);else if(d.isPolygon(y)||d.isPolyline(y)){var g=x;c.getBoundsXY(g,y);var _={xmin:g[0],ymin:g[1],xmax:g[2],ymax:g[3]},v=j(_.xmin,o)*(2*n),m=0===v?y:function(e,t){for(var r=0,i=function(e){return d.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++)o[n][0]+=t;return e}(y,v);_.xmin+=v,_.xmax+=v,h.extentIntersectsPolyline(_,a)&&_.xmax!==n||h.extentIntersectsPolyline(_,u)&&_.xmin!==o?f=m:l=m}else l=e.clone();return null!==f?(new Q).cut(f,n):l},t.getTextSymbolSize=O;var k={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}};function j(e,t){return Math.ceil((e-t)/(2*t))}function A(e,t){var r,i=t.valid,n=i[0],o=i[1],s=2*o,a=0;return e>o?(e-=(r=Math.ceil(Math.abs(e-o)/s))*s,a=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/s))*s,a=-r),{x:e,frameId:a}}function G(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,o=t.ymax;return B(e,r,i)&&B(e,r,o)&&B(e,n,o)&&B(e,n,i)}function B(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function N(e,t,r){var i;if(Array.isArray(e))if((i=e[0])>t){var n=j(i,t);e[0]=i+n*(-2*t)}else i<r&&(n=j(i,r),e[0]=i+n*(-2*r));else(i=e.x)>t?(n=j(i,t),e.x+=n*(-2*t)):i<r&&(n=j(i,r),e.x+=n*(-2*r));return e}var Q=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,o=0;o<i;o++){var s=r[o];if(s&&s.length>=this.minPts){for(var a=[],u=0,l=s;u<l.length;u++){var c=l[u];a.push([c[0]+n,c[1]])}r.push(a)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},719:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(117),r(210),r(152),r(153),r(198),r(521),r(178),r(243),r(720),r(363),r(263),r(512),r(315)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,h,d,f,p){function y(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function g(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function _(e,t,r){return r?t-e:e-t}function v(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var n=new Date(e).getTime(),o=new Date(t).getTime();if(!isNaN(n)&&!isNaN(o))return _(n,o,i)}return"number"==typeof e&&"number"==typeof t?_(e,t,i):"string"==typeof e&&"string"==typeof t?(n=e.toUpperCase(),o=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?g(n,o,i):g(y(n),y(o),i)):i?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(u.isValid(e.outSR)&&!u.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},d.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=h.getWhereClause(t.where,this.fieldsIndex);if(!r)return o.resolve(this);if(r.isStandardized){for(var i=0,n=[],s=0,a=this.items;s<a.length;s++){var u=a[s];r.testFeature(u,this.featureAdapter)&&(n[i++]=u)}var l=new e(n,this.queryGeometry,this);return l.definitionExpression=t.where,o.resolve(l)}return o.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return o.resolve(this);var r=s.SetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return o.resolve(new e(this.items.filter((function(e){return r.has(i(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!n.isSome(r))return o.resolve(this);var i=this.items.filter(r);return o.resolve(new e(i,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,s=t.endTimeField||n,a=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var h=c[l],d=u(h,r),f=u(h,s),p=a.get(d);(!p||f>u(p,s))&&a.set(d,h)}var y=i.valuesOfMap(a);return o.resolve(new e(y,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||u.equals(this.spatialReference,t)?[2,this]:(i=this.featureAdapter,[4,d.projectMany(this.items.map((function(e){return p.getGeometry(n.geometryType,n.hasZ,n.hasM,i.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return i.cloneWithGeometry(n.items[t],l.convertFromGeometry(e,n.hasZ,n.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var i=function(t){var i=t.split(" "),o=i[0],s=n.fieldsIndex.get(o),a=i[1]&&"desc"===i[1].toLowerCase();e.sort((function(e,t){return v(r(e,o,s),r(t,o,s),s,a)}))},n=this,o=0,s=t.reverse();o<s.length;o++)i(s[o])},e.prototype._createFeatureQueryResponse=function(e){var t=this,i=this.items,n=this,o=n.geometryType,s=n.hasM,u=n.hasZ,l=n.objectIdField,c=n.spatialReference,h=e.outFields,d=e.outSR,f=e.quantizationParameters,y=e.resultRecordCount,g=e.resultOffset,_=e.returnZ,v=e.returnM,m=!1;if(null!=y&&null!=g){var b=g+y;m=i.length>b,i=i.slice(g,Math.min(i.length,b))}var x=h&&(h.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):h.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,i),fields:x,geometryType:o,hasM:s&&v,hasZ:u&&_,objectIdFieldName:l,spatialReference:p.cleanFromGeometryEngine(d||c),transform:f&&a.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new c.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,n=this.hasZ,o=e.orderByFields,s=e.quantizationParameters,u=e.returnGeometry,l=e.returnCentroid,h=e.maxAllowableOffset,d=e.returnZ,f=void 0!==d&&d,y=e.returnM,g=n&&f,_=i&&void 0!==y&&y,v=[],m=0;if(u||l){var b=a.toQuantizationTransform(s);if(u&&!l)for(var x=0,I=t;x<I.length;x++)R=I[x],v[m++]={attributes:r.getAttributes(R),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),h,b,g,_)};else if(!u&&l)for(var S=0,w=t;S<w.length;S++)R=w[S],v[m++]={attributes:r.getAttributes(R),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(R,this),b)};else for(var T=0,F=t;T<F.length;T++)R=F[T],v[m++]={attributes:r.getAttributes(R),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(R,this),b),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),h,b,g,_)}}else for(var M=0,E=t;M<E.length;M++){var R=E[M],P=r.getAttributes(R);P&&(v[m++]={attributes:P})}return this._sortFeatures(v,o,(function(e,t,i){return r.getFieldValue(e,t,i)})),v},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=0,s=e.outStatistics;o<s.length;o++){var a=s[o];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},n=[],o=new Map,s=new Map,a=new Map,u=new Map,l=new c.default(e,this.featureAdapter,this.fieldsIndex),h=e.outStatistics,d=e.groupByFieldsForStatistics,f=e.having,p=e.orderByFields,y=d&&d.length,g=!!y,_=g&&d[0],v=g&&!this.fieldsIndex.get(_),m=0,b=h;m<b.length;m++){var x=b[m],I=x.outStatisticFieldName,S=x.statisticType,w=x,T="exceedslimit"!==S?x.onStatisticField:void 0,F="percentile_disc"===S||"percentile_cont"===S,M=g&&1===y&&(T===_||v)&&"count"===S;if(g){if(!a.has(T)){for(var E=[],R=0,P=d;R<P.length;R++){var C=P[R],O=this._getAttributeValues(l,C,o);E.push(O)}a.set(T,this._calculateUniqueValues(E))}var k=a.get(T),j=function(e){var r=k[e],i=r.count,n=r.data,s=r.items,a=r.itemPositions,c=n.join(",");if(!f||l.validateItems(s,f)){var h=u.get(c)||{attributes:{}},p=null;if(M)p=i;else{var y=A._getAttributeValues(l,T,o),g=a.map((function(e){return y[e]}));p=F&&"statisticParameters"in w?A._getPercentileValue(w,g):A._getStatisticValue(w,g)}h.attributes[I]=p,d.forEach((function(e,r){return h.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=n[r]})),u.set(c,h)}},A=this;for(var G in k)j(G)}else O=this._getAttributeValues(l,T,o),r.attributes[I]=F&&"statisticParameters"in w?this._getPercentileValue(w,O):this._getStatisticValue(w,O,s);n.push({name:I,alias:I,type:"esriFieldTypeDouble"})}var B=g?i.valuesOfMap(u):[r];return this._sortFeatures(B,p,(function(e,t){return e.attributes[t]})),{fields:n,features:B}},e.prototype._getStatisticValue=function(e,t,r){var i=e.onStatisticField,n=e.statisticType,o=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,o),o["var"===n?"variance":n]},e.prototype._getPercentileValue=function(e,t){var i=e.onStatisticField,n=e.statisticParameters,o=e.statisticType,s=n.value,a="desc"===n.orderBy,u=this.fieldsIndex.get(i),l=r.__spreadArrays(t).sort((function(e,t){return v(e,t,u,a)}));return this._calculatePercentile(l,s,"percentile_disc"===o)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),n=this.items.map((function(r){return e.getFieldValue(r,t,i)}));return r.set(t,n),n},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,n=null,o=null,s=null,a=[],u=0,l=0,c=e;l<c.length;l++)"string"==typeof(p=c[l])?u++:null==p||isNaN(p)||(i+=p,t=Math.min(t,p),r=Math.max(r,p),a.push(p),u++);if(u){n=i/u;for(var h=0,d=0,f=a;d<f.length;d++){var p=f[d];h+=Math.pow(p-n,2)}s=u>1?h/(u-1):0,o=Math.sqrt(s)}else t=null,r=null;return{avg:n,count:u,max:r,min:t,stddev:o,sum:i,variance:s}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,i=r.length,n=0;n<i;n++){for(var o=r[n],s=[],a=0,u=e;a<u.length;a++){var l=u[a];s.push(l[n])}var c=s.join(",");null==t[c]?t[c]={count:1,data:s,items:[o],itemPositions:[n]}:(t[c].count++,t[c].items.push(o),t[c].itemPositions.push(n))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,n=Math.floor(i),o=n+1,s=i%1,a=e[n],u=e[o];return o>=e.length||r||"string"==typeof a||"string"==typeof u?a:a*(1-s)+u*s},e}();t.default=m}.apply(null,i))||(e.exports=n)},720:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(152),r(363)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var o=0,s=0,a=n;s<a.length;s++){var u=a[s],l=i.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),h=c?null:i.getWhereClause(l,r),d=c?c.name:i.getAliasFromFieldName(u)||"FIELD_EXP_"+o++;this._fieldDataCache.set(u,{alias:d,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var n=r?r.name:t,o=null;return this._fieldDataCache.has(n)?o=this._fieldDataCache.get(n).clause:r||(o=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:o})),r?this.featureAdapter.getAttribute(e,n):o.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var o=n[i],s=this._fieldDataCache.get(o),a=s.alias,u=s.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var n=0,o=t;n<o.length;n++){var s=o[n],a=this._fieldDataCache.get(s).alias;i.push(e[a])}else for(var a in e)i.push(e[a]);var u=(t||["*"]).join(",")+"="+i.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},756:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),i=new Float64Array(2);function n(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function s(e){return(e[0]+e[1])/2}function a(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=s(e),i=t,n=!t;e[0]=n*e[0]+i*r,e[1]=n*r+i*e[1]}function l(e,t){var r=t>s(e);return u(e,r),r}function c(e,t){for(var o=a(r,-90,90),l=a(i,-180,180),c=0;c<t.length;c++){var h=n(t.charCodeAt(c));c%2==0?(u(l,!!(16&h)),u(l,!!(4&h)),u(l,!!(1&h)),u(o,!!(8&h)),u(o,!!(2&h))):(u(o,!!(16&h)),u(o,!!(4&h)),u(o,!!(1&h)),u(l,!!(8&h)),u(l,!!(2&h)))}return e[0]=s(o),e[1]=s(l),e}function h(e,t,n){for(var s="",u=a(r,-90,90),c=a(i,-180,180),h=0;h<n;h++){var d=0;h%2?(d|=l(u,e)<<4,d|=l(c,t)<<3,d|=l(u,e)<<2,d|=l(c,t)<<1,d|=l(u,e)<<0):(d|=l(c,t)<<4,d|=l(u,e)<<3,d|=l(c,t)<<2,d|=l(u,e)<<1,d|=l(c,t)<<0),s+=o(d)}return s}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function p(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function y(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function g(e,t,r){var i=!((e.length-1)%2),s=e.substring(0,e.length-1),a=n(e.charCodeAt(e.length-1)),u=0,l=0,c=0,h=0;i?(u=8,l=4,c=1&a|(4&a)>>1|(16&a)>>2,h=(2&a)>>1|(8&a)>>2):(u=4,l=8,h=1&a|(4&a)>>1|(16&a)>>2,c=(2&a)>>1|(8&a)>>2);var d=c+t,f=h+r,p=Math.floor(d/u),y=Math.floor(f/l),_=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-p*u,f-y*l,i));return e.length>1&&(p||y)?g(s,p,y)+_:s+_}t.decodeBase32Char=n,t.encodeBase32Char=o,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,i=0,o=30,s=30,a=0;a<t.length;a++){var u=n(t.charCodeAt(a)),l=a%2==0;r|=p(u,l)<<(o-=l?3:2),i|=y(u,l)<<(s-=l?2:3)}return{geohashX:r,geohashY:i}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,n=-180,o=180,s=0;s<t;s++){for(var a=Math.ceil((s+1)/2),u=Math.floor((s+1)/2),l=1-s%2,c=30-(3*a+2*u),h=30-(2*a+3*u),d=3*l+2*(1-l),f=2*l+3*(1-l),p=3*l+7*(1-l)<<h,y=(7*l+3*(1-l)<<c&e.geohashX)>>c,g=(p&e.geohashY)>>h,_=d-1;_>=0;_--){var v=(n+o)/2,m=y&1<<_?1:0;n=(1-m)*n+m*v,o=(1-m)*v+m*o}for(_=f-1;_>=0;_--){var b=(r+i)/2,x=g&1<<_?1:0;r=(1-x)*r+x*b,i=(1-x)*b+x*i}}return[n,r,o,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var n=0,o=0,s=-90,a=90,u=-180,l=180,c=0;c<i/2;c++){for(var h=0;h<5;h++){var d=(u+l)/2,f=r>d?1:0;n|=f<<29-(h+5*c),u=(1-f)*u+f*d,l=(1-f)*d+f*l}for(h=0;h<5;h++){var p=(s+a)/2,y=t>p?1:0;o|=y<<29-(h+5*c),s=(1-y)*s+y*p,a=(1-y)*p+y*a}}e.geohashX=n,e.geohashY=o},t.encodeGeohash=h,t.latDistPerGeohash=d,t.lonDistPerGeohash=f,t.unpackXBits=p,t.unpackYBits=y,t.getRelativeGeohash=g,t.getIntersectingGeohashes=function(e,t,r,i,n){for(var o=Math.abs(r-e),s=Math.abs(i-t),a=d(n),u=f(n),l=Math.ceil(s/u),c=Math.ceil(o/a),p=h(e,t,n),y=new Array,_=0;_<l;_++)for(var v=0;v<c;v++)y.push(g(p,_,v));return y},t.forEachIntersectingGeohash=function(e,t,r,i,n,o){for(var s=Math.abs(r-e),a=Math.abs(i-t),u=d(n),l=f(n),p=Math.ceil(a/l),y=Math.ceil(s/u),_=h(e,t,n),v=0;v<p;v++)for(var m=0;m<y;m++){var b=g(_,v,m),x=c([0,0],b),I=x[0],S=x[1],w=I-u/2,T=S-l/2,F=I+u/2,M=S+l/2,E=u*l,R=Math.max(e,w),P=Math.max(t,T),C=Math.min(r,F)-R,O=Math.min(i,M)-P;o(b,Math.abs(C*O)/E)}}}.apply(null,i))||(e.exports=n)}}]);
//# sourceMappingURL=40.js.map