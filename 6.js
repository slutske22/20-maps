(function(){var e={"esri/widgets/Legend":300,"esri/core/colorUtils":360,"esri/layers/support/ExportImageParameters":378,"esri/symbols/support/svgUtils":396,"esri/widgets/Legend/support/utils":397,"esri/symbols/support/previewUtils":501,"esri/symbols/support/renderUtils":502,"esri/symbols/support/previewSymbol3D":503,"esri/widgets/Legend/styles/support/utils":504,"esri/widgets/Legend/support/styleUtils":505,"esri/widgets/Legend/LegendViewModel":676,"esri/widgets/Legend/support/ActiveLayerInfo":677,"esri/symbols/support/symbolUtils":678,"esri/symbols/support/previewCIMSymbol":679,"esri/symbols/support/previewSymbol2D":680,"esri/symbols/support/previewWebStyleSymbol":681,"esri/widgets/Legend/support/clusterUtils":682,"esri/widgets/Legend/support/colorRampUtils":683,"esri/widgets/Legend/support/heatmapRampUtils":684,"esri/widgets/Legend/support/relationshipRampUtils":685,"esri/widgets/Legend/support/sizeRampUtils":686,"esri/widgets/Legend/styles/Card":687,"esri/widgets/Legend/styles/Classic":688},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{300:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(167),r(157),r(151),r(573),r(188),r(676),r(687),r(688),r(183)],void 0===(n=function(e,t,r,a,n,i,s,l,o,c,u,d){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._handles=new a,n.activeLayerInfos=null,n.basemapLegendVisible=!1,n.groundLegendVisible=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.iconClass="esri-icon-layer-list",n.label=void 0,n.layerInfos=null,n.messages=null,n.style=new u,n.view=null,n.viewModel=new o,n}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own(n.on(this,"activeLayerInfos","change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),n.init(this,"style",(function(t,r){r&&t!==r&&r.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view))})))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null},t.prototype.castStyle=function(e){if(e instanceof c||e instanceof u)return e;if("string"==typeof e)return"card"===e?new c:new u;if(e&&"string"==typeof e.type){var t=r.__assign({},e);return delete t.type,new("card"===e.type?c:u)(t)}return new u},t.prototype.render=function(){return d.tsx("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof u?"esri-widget--panel":null)},this.style.render())},t.prototype._refreshActiveLayerInfos=function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()},t.prototype._renderOnActiveLayerInfoChange=function(e){var t=this,r=n.init(e,"version",(function(){return t.scheduleRender()}));this._handles.add(r,"version_"+e.layer.uid),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))},r.__decorate([i.aliasOf("viewModel.activeLayerInfos"),d.renderable()],t.prototype,"activeLayerInfos",void 0),r.__decorate([i.aliasOf("viewModel.basemapLegendVisible"),d.renderable()],t.prototype,"basemapLegendVisible",void 0),r.__decorate([i.aliasOf("viewModel.groundLegendVisible"),d.renderable()],t.prototype,"groundLegendVisible",void 0),r.__decorate([i.aliasOf("viewModel.keepCacheOnDestroy")],t.prototype,"keepCacheOnDestroy",void 0),r.__decorate([i.aliasOf("viewModel.respectLayerVisibility"),d.renderable()],t.prototype,"respectLayerVisibility",void 0),r.__decorate([i.property()],t.prototype,"iconClass",void 0),r.__decorate([i.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([i.aliasOf("viewModel.layerInfos"),d.renderable()],t.prototype,"layerInfos",void 0),r.__decorate([i.property(),d.renderable(),d.messageBundle("esri/widgets/Legend/t9n/Legend")],t.prototype,"messages",void 0),r.__decorate([i.property(),d.renderable()],t.prototype,"style",void 0),r.__decorate([s.cast("style")],t.prototype,"castStyle",null),r.__decorate([i.aliasOf("viewModel.view"),d.renderable()],t.prototype,"view",void 0),r.__decorate([i.property(),d.renderable(["view.size"])],t.prototype,"viewModel",void 0),r.__decorate([i.subclass("esri.widgets.Legend")],t)}(l)}.apply(null,a))||(e.exports=n)},360:function(e,t,r){var a,n;a=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function n(e){return"l"in e&&"c"in e&&"h"in e}function i(e){return"x"in e&&"y"in e&&"z"in e}Object.defineProperty(t,"__esModule",{value:!0});var s=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function o(e,t){var r,a,n=[];if(e[0].length!==t.length)throw"dimensions do not match";var i=e.length,s=e[0].length,l=0;for(r=0;r<i;r++){for(l=0,a=0;a<s;a++)l+=e[r][a]*t[a];n.push(l)}return n}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),r=o(s,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function u(e){var t=o(l,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){var t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function h(e){return d(c(e))}function y(e){return u(p(e))}function m(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:n(e)?function(e){return u(p(function(e){var t=e.l,r=e.c,a=e.h;return{l:t,a:r*Math.cos(a),b:r*Math.sin(a)}}(e)))}(e):a(e)?y(e):i(e)?u(e):r(e)?function(e){var t,r=(e.h+360)%360/60,a=e.s/100,n=e.v/100*255,i=n*a,s=i*(1-Math.abs(r%2-1));switch(Math.floor(r)){case 0:t={r:i,g:s,b:0};break;case 1:t={r:s,g:i,b:0};break;case 2:t={r:0,g:i,b:s};break;case 3:t={r:0,g:s,b:i};break;case 4:t={r:s,g:0,b:i};break;case 5:case 6:t={r:i,g:0,b:s};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+n-i),t.g=Math.round(t.g+n-i),t.b=Math.round(t.b+n-i),t}(e):void 0}t.toRGB=m,t.toHSV=function(e){return r(e)?e:function(e){var t,r,a,n=e.r,i=e.g,s=e.b,l=Math.max(n,i,s),o=l-Math.min(n,i,s);return a=l,0===o?t=0:l===n?t=(i-s)/o%6:l===i?t=(s-n)/o+2:l===s&&(t=(n-i)/o+4),r=0===o?0:o/a,t<0&&(t+=6),{h:t*=60,s:r*=100,v:a*=100/255}}(m(e))},t.toLAB=function(e){return a(e)?e:h(m(e))},t.toLCH=function(e){return n(e)?e:function(e){return function(e){var t=e.l,r=e.a,a=e.b,n=Math.sqrt(r*r+a*a),i=Math.atan2(a,r);return{l:t,c:n,h:i=i>0?i:i+2*Math.PI}}(d(c(e)))}(m(e))},t.toXYZ=function(e){return i(e)?e:c(m(e))},t.darken=function(e,t){var r=h(e);return r.l*=1-t,y(r)}}.apply(null,a))||(e.exports=n)},378:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(158),r(151),r(439),r(235),r(490)],void 0===(n=function(e,t,r,a,n,i,s,l){Object.defineProperty(t,"__esModule",{value:!0});var o={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._scale=null,t.view=null,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map((function(e){return e.toExportImageJSON()}));return e.length?JSON.stringify(e):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasDynamicLayers",{get:function(){return this.layer&&i.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layer",{set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this._layerHandles&&(this._layerHandles.forEach((function(e){return e.remove()})),this._layerHandles.length=0),e&&(this._layerHandles=[e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(o[e.propertyName])}))]))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers",{get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerDefs",{get:function(){var e=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression}));return e.length?JSON.stringify(e.reduce((function(e,t){return e[t.id]=t.definitionExpression,e}),{})):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(e){this.view||(this._scale=e,this.notifyChange("scale"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){this.layers,this.layerDefs,this.dynamicLayers,this.timeExtent;var e=this.layer;return e&&(e.dpi,e.imageFormat,e.imageTransparency,e.gdbVersion),(this._get("version")||0)+1},set:function(e){this._set("version",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibleSublayers",{get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers,a=function(r){var n=e.scale,i=0===n,s=0===r.minScale||n<=r.minScale,l=0===r.maxScale||n>=r.maxScale;r.visible&&(i||s&&l)&&(r.sublayers?r.sublayers.forEach(a):t.unshift(r))};r&&r.forEach(a);var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=r.__assign(r.__assign({},t),{layers:this.layers,layerDefs:this.layerDefs}),t},r.__decorate([n.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],t.prototype,"dynamicLayers",null),r.__decorate([n.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],t.prototype,"hasDynamicLayers",null),r.__decorate([n.property()],t.prototype,"layer",null),r.__decorate([n.property({readOnly:!0,dependsOn:["visibleSublayers"]})],t.prototype,"layers",null),r.__decorate([n.property({readOnly:!0,dependsOn:["visibleSublayers"]})],t.prototype,"layerDefs",null),r.__decorate([n.property({type:Number,dependsOn:["view.scale"]})],t.prototype,"scale",null),r.__decorate([n.property(s.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),r.__decorate([n.property({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],t.prototype,"version",null),r.__decorate([n.property({type:l})],t.prototype,"view",void 0),r.__decorate([n.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],t.prototype,"visibleSublayers",null),r.__decorate([n.subclass("esri.layers.mixins.ExportImageParameters")],t)}(a);t.ExportImageParameters=c}.apply(null,a))||(e.exports=n)},396:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(182),r(164),r(370),r(792),r(183)],void 0===(n=function(e,t,r,a,n,i,s){Object.defineProperty(t,"__esModule",{value:!0});var l=0,o=0,c=a("android"),u=a("chrome")||c&&c>=4?"auto":"optimizeLegibility",d={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},p=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,h={},y={},m={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};function f(e){return e.map((function(e){return e.command+" "+e.values.join(" ")})).join(" ").trim()}function v(e,t,r,a){if(e){if("circle"===e.type)return s.tsx("circle",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if("ellipse"===e.type)return s.tsx("ellipse",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if("rect"===e.type)return s.tsx("rect",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if("image"===e.type)return s.tsx("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if("path"===e.type){var n="string"!=typeof e.path?f(e.path):e.path;return s.tsx("path",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",d:n})}if("text"===e.type)return s.tsx("text",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4","text-anchor":a.align,"text-decoration":a.decoration,kerning:a.kerning,rotate:a.rotate,"text-rendering":u,"font-style":a.font.style,"font-variant":a.font.variant,"font-weight":a.font.weight,"font-size":a.font.size,"font-family":a.font.family,x:e.x,y:e.y},e.text)}return null}function g(e){var t={fill:"none",pattern:null,linearGradient:null};if(e)if("type"in e&&"pattern"===e.type){var a="patternId-"+ ++l;t.fill="url(#"+a+")",t.pattern={id:a,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type)a="linearGradientId-"+ ++o,t.fill="url(#"+a+")",t.linearGradient={id:a,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((function(e){return{offset:e.offset,color:e.color&&new r(e.color).toString()}}))};else if(e){var n=new r(e);t.fill=n.toString()}return t}function b(e){var t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new r(e.color).toString()),e.style)){var a=null;if(e.style in m&&(a=m[e.style]),Array.isArray(a)){a=a.slice(0);for(var n=0;n<a.length;++n)a[n]*=e.width;if("butt"!==e.cap){for(n=0;n<a.length;n+=2)a[n]-=e.width,a[n]<1&&(a[n]=1);for(n=1;n<a.length;n+=2)a[n]+=e.width}a=a.join(",")}t.dashArray=a}return t}function _(e,t){var r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(r.align=e.align,r.decoration=e.decoration,r.kerning=e.kerning?"auto":"0",r.rotate=e.rotated?"90":"0",r.font.style=t.style||"normal",r.font.variant=t.variant||"normal",r.font.weight=t.weight||"normal",r.font.size=t.size&&t.size.toString()||"10pt",r.font.family=t.family||"serif"),r}function L(e){var t=e.pattern,r=e.linearGradient;if(t)return s.tsx("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},s.tsx("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(r){var a=r.stops.map((function(e,t){return s.tsx("stop",{key:t+"-stop",offset:e.offset,"stop-color":e.color})}));return s.tsx("linearGradient",{id:r.id,gradientUnits:"userSpaceOnUse",x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},a)}return null}function w(e,t,r,a,n){return i.scale(e,i.identity(e),[t,r]),e[4]=e[4]*t-a*t+a,e[5]=e[5]*r-n*r+n,e}function S(e,t){h&&"left"in h?(h.left>e&&(h.left=e),h.right<e&&(h.right=e),h.top>t&&(h.top=t),h.bottom<t&&(h.bottom=t)):h={left:e,bottom:t,right:e,top:t}}function x(e){var t,r=e.args,a=r.length;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(t=0;t<a;t+=2)S(r[t],r[t+1]);y.x=r[a-2],y.y=r[a-1];break;case"H":for(t=0;t<a;++t)S(r[t],y.y);y.x=r[a-1];break;case"V":for(t=0;t<a;++t)S(y.x,r[t]);y.y=r[a-1];break;case"m":var n=0;"x"in y||(S(y.x=r[0],y.y=r[1]),n=2);for(t=n;t<a;t+=2)S(y.x+=r[t],y.y+=r[t+1]);break;case"l":case"t":for(t=0;t<a;t+=2)S(y.x+=r[t],y.y+=r[t+1]);break;case"h":for(t=0;t<a;++t)S(y.x+=r[t],y.y);break;case"v":for(t=0;t<a;++t)S(y.x,y.y+=r[t]);break;case"c":for(t=0;t<a;t+=6)S(y.x+r[t],y.y+r[t+1]),S(y.x+r[t+2],y.y+r[t+3]),S(y.x+=r[t+4],y.y+=r[t+5]);break;case"s":case"q":for(t=0;t<a;t+=4)S(y.x+r[t],y.y+r[t+1]),S(y.x+=r[t+2],y.y+=r[t+3]);break;case"A":for(t=0;t<a;t+=7)S(r[t+5],r[t+6]);y.x=r[a-2],y.y=r[a-1];break;case"a":for(t=0;t<a;t+=7)S(y.x+=r[t+5],y.y+=r[t+6])}}function M(e,t,r){var a,n=d[e.toLowerCase()];"number"==typeof n&&(n?t.length>=n&&(a={action:e,args:t.slice(0,t.length-t.length%n)},r.push(a),x(a)):(a={action:e,args:[]},r.push(a),x(a)))}function I(e){var t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){var r=function(e){var t=("string"!=typeof e.path?f(e.path):e.path).match(p),r=[];if(h={},y={},!t)return null;for(var a="",n=[],i=t.length,s=0;s<i;++s){var l=t[s],o=parseFloat(l);isNaN(o)?(a&&M(a,n,r),n=[],a=l):n.push(o)}M(a,n,r);var c={x:0,y:0,width:0,height:0};return h&&"left"in h&&(c.x=h.left,c.y=h.top,c.width=h.right-h.left,c.height=h.bottom-h.top),c}(e);t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height}return t}function A(e){for(var t={x:0,y:0,width:0,height:0},r=null,a=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=0,s=e;i<s.length;i++){var l=s[i];r?(r.x=Math.min(r.x,l.x),r.y=Math.min(r.y,l.y),a=Math.max(a,l.x+l.width),n=Math.max(n,l.y+l.height)):((r=t).x=l.x,r.y=l.y,a=l.x+l.width,n=l.y+l.height)}return r&&(r.width=a-r.x,r.height=n-r.y),r}function k(e,t,r,a,s,l){var o=t/2,c=r/2,u=e.width+a,d=e.height+a,p=n.mat2df32.create(),h=n.mat2df32.create(),y=!1;if(s&&0!==u&&0!==d){var m=u/d,f=t>r?t:r,v=1,g=1;isNaN(f)||(m>1?(v=f/u,g=f/m/d):(g=f/d,v=f*m/u)),i.multiply(h,h,w(p,v,g,o,c)),y=!0}var b=e.x+(u-a)/2,_=e.y+(d-a)/2,L=o-b,S=c-_;if(i.multiply(h,h,function(e,t,r){return i.translate(e,i.identity(e),[t,r])}(p,L,S)),!y&&(u>t||d>r)){var x=u/t>d/r,M=(x?t:r)/(x?u:d);i.multiply(h,h,w(p,M,M,b,_))}return l&&i.multiply(h,h,function(e,t,r,a){var n=t%360*Math.PI/180;i.rotate(e,i.identity(e),n);var s=Math.cos(n),l=Math.sin(n),o=e[4],c=e[5];return e[4]=o*s-c*l+a*l-r*s+r,e[5]=c*s+o*l-r*l-a*s+a,e}(p,l,b,_)),"matrix("+h[0]+","+h[1]+","+h[2]+","+h[3]+","+h[4]+","+h[5]+")"}t.renderShape=v,t.generateFillAttributes=g,t.generateStrokeAttributes=b,t.generateTextAttributes=_,t.renderDef=L,t.getBoundingBox=I,t.computeBBox=A,t.getTransformMatrix=k,t.renderSVG=function(e,t,r,a){for(var n=[],i=[],l=0,o=e;l<o.length;l++){for(var c=[],u=[],d=0,p=0,h=o[l];p<h.length;p++){var y=h[p],m=y.shape,f=y.fill,w=y.stroke,S=y.font;d+=w&&w.width||0;var x=g(f),M=b(w),C="text"===m.type?_(m,S):null;n.push(L(x)),c.push(v(m,x.fill,M,C)),u.push(I(m))}var E=k(A(u),t,r,d,a&&a.scale,a&&a.rotation);i.push(s.tsx("g",{transform:E},c))}return s.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:r},s.tsx("defs",null,n),i)}}.apply(null,a))||(e.exports=n)},397:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(366),r(434)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0});var n=r.convertDateFormatToIntlOptions("short-date");t.createStopLabel=function(e,t,i,s){var l="";return 0===t?l="< ":t===i&&(l="> "),l+(s?r.formatDate(e,n):a.format(e))},t.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="]}.apply(null,a))||(e.exports=n)},501:function(e,t,r){var a,n;a=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]},t.getPathSymbolShapes=function(e){var t=22,r=22;return e<1?t*=.75:e>1&&(r*=1.25),[{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[19.25,0]},{command:"L",values:[0,r-11]},{command:"L",values:[t-11,r-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[22,2.75]},{command:"L",values:[t-11,22]},{command:"L",values:[t-11,r-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[t-11,r-11]},{command:"L",values:[0,r-11]},{command:"L",values:[0,22]},{command:"L",values:[t-11,22]},{command:"Z",values:[]}]}]},t.getExtrudeSymbolShapes=function(e){var t=.5*e;return[{type:"path",path:[{command:"M",values:[0,22*.7*.5]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+t]},{command:"L",values:[0,22*.7+t-22*.7*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+t]},{command:"L",values:[22,t]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,22*.7*.5]},{command:"Z",values:[]}]}]},t.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]},t.getCubeShapes=function(e,t){var r=t?20:e,a=t?4:6,n=(r-=r<=22?.5*a:a,t?.35*r:.5*r);return[{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,.5*n]},{command:"L",values:[.5*r,n]},{command:"L",values:[0,.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*r,n]},{command:"L",values:[.5*r,e]},{command:"L",values:[0,e-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*r,n]},{command:"L",values:[.5*r,e]},{command:"L",values:[r,e-.5*n]},{command:"L",values:[r,.5*n]},{command:"Z",values:[]}]}]},t.getCylinderShapes=function(e,t){var r=t?20:e,a=t?4:6,n=.5*(r-=r<=22?.5*a:a),i=.15*r,s=e-i;return[{type:"ellipse",cx:.5*r,cy:s,rx:n,ry:i},{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[0,s]},{command:"L",values:[r,s]},{command:"L",values:[r,i]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:i,rx:n,ry:i}]},t.getConeShapes=function(e,t){var r=t?20:e,a=t?4:6,n=.15*(r-=r<=22?.5*a:a),i=e-n;return[{type:"ellipse",cx:.5*r,cy:i,rx:.5*r,ry:n},{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]}]},t.getInvertedConeShapes=function(e){var t=e,r=.15*(t-=t<22?3:6);return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,e-r]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:r}]},t.getDiamondShapes=function(e){var t=e,r=e,a=t-=t<22?2:4,n=r,i=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[a,.5*n-i]},{command:"L",values:[.45*a-i,.5*n+i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[.45*a-i,.5*n+i]},{command:"L",values:[0,.5*n-i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n-i]},{command:"L",values:[.45*a-i,.5*n+i]},{command:"L",values:[.45*a,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,r]},{command:"L",values:[a,.5*n-i]},{command:"L",values:[.45*a-i,.5*n+i]},{command:"Z",values:[]}]}]},t.getTetrahedronShapes=function(e){var t=e;return[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t-=t<22?1:2]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]}}.apply(null,a))||(e.exports=n)},502:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(336),r(165),r(360),r(154),r(164),r(153),r(621),r(396)],void 0===(n=function(e,t,r,a,n,i,s,l,o,c){Object.defineProperty(t,"__esModule",{value:!0});var u=o.createProjector();function d(e,t,r,a,i){switch(i){case"multiply":e[t+0]*=r[0],e[t+1]*=r[1],e[t+2]*=r[2],e[t+3]*=r[3];break;default:var s=n.toHSV({r:e[t+0],g:e[t+1],b:e[t+2]});s.h=a.h,s.s=a.s,s.v=s.v/100*a.v;var l=n.toRGB(s);e[t+0]=l.r,e[t+1]=l.g,e[t+2]=l.b,e[t+3]*=r[3]}}t.renderSymbol=function(e,t,r){var a=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!e.some((function(e){return!!e.length})))return null;var i=r&&r.node||document.createElement("div");return null!=r.opacity&&(i.style.opacity=r.opacity.toString()),u.append(i,c.renderSVG.bind(null,e,a,n,r)),i},t.tintImageWithColor=function(e,t,o,c,u){return function(e,t,r){return e?a(e,{responseType:"image"}).then((function(e){var a=e.data,n=a.width,i=a.height,s=n/i,l=t;if(r){var o=Math.max(n,i);l=Math.min(l,o)}return{image:a,width:s<=1?Math.ceil(l*s):l,height:s<=1?l:Math.ceil(l/s)}})):l.reject(new i("renderUtils: imageDataSize","href not provided."))}(e,t,u).then((function(a){var i=a.width?a.width:t,l=a.height?a.height:t;if(a.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(o,c)){var u=a.image.width,p=a.image.height;(s("edge")||s("ie"))&&/\.svg$/i.test(e)&&(u-=1,p-=1);var h=function(e,t){e=Math.ceil(e),t=Math.ceil(t);var r=document.createElement("canvas");r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px";var a=r.getContext("2d");return a.clearRect(0,0,e,t),a}(i,l);h.drawImage(a.image,0,0,u,p,0,0,i,l);for(var y=h.getImageData(0,0,i,l),m=[o.r/255,o.g/255,o.b/255,o.a],f=n.toHSV(o),v=0;v<y.data.length;v+=4)d(y.data,v,m,f,c);h.putImageData(y,0,0),e=h.canvas.toDataURL("image/png")}else{var g=r.id&&r.id.findCredential(e);if(g&&g.token){var b=-1===e.indexOf("?")?"?":"&";e=""+e+b+"token="+g.token}}return{url:e,width:i,height:l}})).catch((function(){return{url:e,width:t,height:t}}))}}.apply(null,a))||(e.exports=n)},503:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(271),r(360),r(177),r(154),r(156),r(152),r(153),r(171),r(420),r(627),r(577),r(501),r(502),r(633),r(357)],void 0===(n=function(e,t,r,a,n,i,s,l,o,c,u,d,p,h,y,m,f,v){Object.defineProperty(t,"__esModule",{value:!0});var g=a.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png"),b=l.getLogger("esri.symbols.support.previewSymbol3D");function _(e){var t=e.outline,r=o.isSome(e.material)?e.material.color:null,a=o.isSome(r)?r.toRgba().toString():null;if(o.isNone(t))return"fill"===e.type&&"255,255,255,1"===a?{color:"#bdc3c7",width:.75}:null;var n=u.pt2px(t.size)||0;return{color:"rgba("+(o.isSome(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(n,80)}}function L(e,t){void 0===t&&(t=1);var r=e.a,a=n.toHSV(e),i=a.h,s=a.s/t,l=100-(100-a.v)/t,o=n.toRGB({h:i,s:s,v:l});return[o.r,o.g,o.b,r]}function w(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function S(e){return"water"===e.type?o.isNone(e.color)?null:e.color:o.isNone(e.material)||o.isNone(e.material.color)?null:e.material.color}function x(e,t){void 0===t&&(t=0);var r=S(e);if(!r){var a=w(d.defaultThematicColor.r,t);return[a,a,a,100]}for(var n=r.toRgba(),i=0;i<3;i++)n[i]=w(n[i],t);return n}function M(e){return e.outline?_(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function I(e,t){var r=S(e);if(!r)return null;var a="rgba(";return a+=w(r.r,t)+",",a+=w(r.g,t)+",",(a+=w(r.b,t)+",")+r.a+");"}function A(e,t){var r=I(e,t);return r?{color:r,width:Math.min(e.size?u.pt2px(e.size):.75,80)}:{}}function k(e,t,r){var a=.75*r;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}t.getSymbolLayerFill=x,t.previewSymbol3D=function(e,t){if(0===e.symbolLayers.length)return c.reject(new s("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var a=null;switch(e.type){case"point-3d":a=function(e,t){var r,a=t&&t.size?u.pt2px(t.size):null,n=t&&t.maxSize?u.pt2px(t.maxSize):null,s=t&&t.disableUpsampling,l=e.symbolLayers,o=[],d=0,L=0,w=l.getItemAt(l.length-1);return w&&"icon"===w.type&&(r=w.size&&u.pt2px(w.size)),l.forEach((function(l){if("icon"===l.type||"object"===l.type){var b="icon"===l.type?l.size&&u.pt2px(l.size):0,w=a||b?Math.ceil(Math.min(a||b,n||120)):22;if(l&&l.resource&&l.resource.href){var S=function(e,t){var r=t&&t.resource,a=r&&r.href;return e.thumbnail&&e.thumbnail.url?c.resolve(e.thumbnail.url):a&&"object"!==t.type?c.resolve(v.getIconHref(e,t)):e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?f.resolveWebStyleSymbol(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((function(e){return e})).then((function(e){return e&&e.thumbnail&&e.thumbnail.url||g})):c.resolve(g)}(e,l).then((function(e){var t=l.get("material.color"),r=function(e){return"icon"===e.type?"multiply":"tint"}(l);return m.tintImageWithColor(e,w,t,r,s)})).then((function(e){var t=e.width,r=e.height;return d=Math.max(d,t),L=Math.max(L,r),[{shape:{type:"image",x:0,y:0,width:t,height:r,src:e.url},fill:null,stroke:null}]}));o.push(S)}else{var I=w;"icon"===l.type&&r&&a&&(I=w*(b/r));var A=t&&"tall"===t.symbolConfig||"object"===l.type&&function(e){var t=e.depth,r=e.height,a=e.width;return a&&t&&r&&a===t&&a<r}(l);d=Math.max(d,A?20:I),L=Math.max(L,I),o.push(c.resolve(function(e,t,r){var a=[];if(!e)return a;switch(e.type){case"icon":var n=t,s=t;switch(l=e.resource&&e.resource.primitive||p.defaultPrimitive){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:x(e,0),stroke:_(e)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,s]},{command:"L",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,s]},{command:"Z",values:[]}]},fill:x(e,0),stroke:_(e)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,s]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,s]},{command:"Z",values:[]}]},fill:x(e,0),stroke:_(e)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,s]},{command:"M",values:[0,.5*s]},{command:"L",values:[n,.5*s]}]},stroke:M(e)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,s]},{command:"M",values:[n,0]},{command:"L",values:[0,s]}]},stroke:M(e)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*s]},{command:"L",values:[.5*n,s]},{command:"Z",values:[]}]},fill:x(e,0),stroke:_(e)});break;default:i.neverReached(l)}break;case"object":var l;switch(l=e.resource&&e.resource.primitive||h.defaultPrimitive){case"cone":var o=k(x(e,0),x(e,-.6),r?20:t),c=y.getConeShapes(t,r);a.push({shape:c[0],fill:o}),a.push({shape:c[1],fill:o});break;case"inverted-cone":var u=x(e,0),d=k(u,x(e,-.6),t),m=y.getInvertedConeShapes(t);a.push({shape:m[0],fill:d}),a.push({shape:m[1],fill:u});break;case"cube":var f=y.getCubeShapes(t,r);a.push({shape:f[0],fill:x(e,0)}),a.push({shape:f[1],fill:x(e,-.3)}),a.push({shape:f[2],fill:x(e,-.5)});break;case"cylinder":var v=k(x(e,0),x(e,-.6),r?20:t),g=y.getCylinderShapes(t,r);a.push({shape:g[0],fill:v}),a.push({shape:g[1],fill:v}),a.push({shape:g[2],fill:x(e,0)});break;case"diamond":var b=y.getDiamondShapes(t);a.push({shape:b[0],fill:x(e,-.3)}),a.push({shape:b[1],fill:x(e,0)}),a.push({shape:b[2],fill:x(e,-.3)}),a.push({shape:b[3],fill:x(e,-.7)});break;case"sphere":var L=k(x(e,0),x(e,-.6));L.x1=0,L.y1=0,L.x2=.25*t,L.y2=.25*t,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:L});break;case"tetrahedron":var w=y.getTetrahedronShapes(t);a.push({shape:w[0],fill:x(e,-.3)}),a.push({shape:w[1],fill:x(e,0)}),a.push({shape:w[2],fill:x(e,-.6)});break;default:i.neverReached(l)}}return a}(l,I,A)))}}})),c.eachAlways(o).then((function(e){var r=[];return e.forEach((function(e){e.value?r.push(e.value):e.error&&b.warn("error while building swatchInfo!",e.error)})),m.renderSymbol(r,[d,L],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}(e,t);break;case"line-3d":a=function(e,t){var a,n=e.symbolLayers,i=[],s=v.isVolumetricSymbol(e),l=t&&t.size?u.pt2px(t.size):null,o=(t&&t.maxSize?u.pt2px(t.maxSize):null)||80,d=0,p=0;return n.forEach((function(e,t){if(e&&("line"===e.type||"path"===e.type)){var n=[];switch(e.type){case"line":var s=(b=A(e,0))&&b.width||0;0===t&&(a=s);var c=Math.min(l||s,o),u=0===t?c:l?c*(s/a):c,h=u>20?2*u:40;p=Math.max(p,u),d=Math.max(d,h),b.width=u,n.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[d,.5*p]}]},stroke:b});break;case"path":var m=Math.min(l||22,o),f=x(e,0),v=x(e,-.2),g=I(e,-.4),b=g?{color:g,width:1}:{};if("quad"===e.profile){var _=e.width||e.size,L=e.height||e.size,w=_&&L?_/L:1,S=y.getPathSymbolShapes(w),M=r.__assign(r.__assign({},b),{join:"bevel"});n.push({shape:S[0],fill:v,stroke:M}),n.push({shape:S[1],fill:v,stroke:M}),n.push({shape:S[2],fill:f,stroke:M})}else n.push({shape:y.shapes.pathSymbol3DLayer[0],fill:v,stroke:b}),n.push({shape:y.shapes.pathSymbol3DLayer[1],fill:f,stroke:b});p=Math.max(p,m),d=p}i.push(n)}})),c.resolve(m.renderSymbol(i,[d,p],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}(e,t);break;case"polygon-3d":case"mesh-3d":a=function(e,t){for(var a="mesh-3d"===e.type,n=e.symbolLayers,i=t&&t.size?u.pt2px(t.size):null,s=t&&t.maxSize?u.pt2px(t.maxSize):null,l=i||22,o=[],d=0,p=0,h=!1,f=0;f<n.length;f++){var v=n.getItemAt(f),g=[];if(!a||"fill"===v.type){var b=y.shapes.fill[0];switch(v.type){case"fill":var w=_(v),M=Math.min(l,s||120);d=Math.max(d,M),p=Math.max(p,M),h=!0,g.push({shape:b,fill:x(v,0),stroke:w});break;case"line":var I={stroke:A(v,0),shape:b};d=Math.max(d,22),p=Math.max(p,22),g.push(I);break;case"extrude":var k=r.__assign({join:"round"},A(v,-.4)),C=x(v,0),E=x(v,-.2),R=Math.min(l,s||120),V=y.getExtrudeSymbolShapes(R);k.width=1,g.push({shape:V[0],fill:E,stroke:k}),g.push({shape:V[1],fill:E,stroke:k}),g.push({shape:V[2],fill:C,stroke:k});var z=22*.7+.5*R;d=Math.max(d,22),p=Math.max(p,z);break;case"water":var O=S(v),F=(C=L(O),L(O,2)),T=L(O,3),D=y.getWaterSymbolShapes();h=!0,g.push({shape:D[0],fill:C}),g.push({shape:D[1],fill:F}),g.push({shape:D[2],fill:T}),M=Math.min(l,s||120),d=Math.max(d,M),p=Math.max(p,M)}o.push(g)}}return c.resolve(m.renderSymbol(o,[d,p],{node:t&&t.node,scale:h,opacity:t&&t.opacity}))}(e,t)}return a||c.reject(new s("symbolPreview: swatchInfo3D","symbol not supported."))}}.apply(null,a))||(e.exports=n)},504:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(396),r(183)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0});var n="esri-relationship-ramp--diamond__middle-column--label",i="esri-relationship-ramp--square__table-row",s="esri-relationship-ramp--square__table-cell",l="esri-relationship-ramp--square__table-label";function o(e,t,r){var a=r+"_arrowStart",n=r+"_arrowEnd",i="left"===e,s={markerStart:null,markerEnd:null};switch(t){case"HL":i?s.markerStart="url(#"+n+")":s.markerEnd="url(#"+a+")";break;case"LL":s.markerStart="url(#"+n+")";break;case"LH":i?s.markerEnd="url(#"+a+")":s.markerStart="url(#"+n+")";break;default:s.markerEnd="url(#"+a+")"}return s}t.renderRelationshipRamp=function(e,t,c){var u=e.focus,d=e.labels,p=!!u,h=function(e,t,n,i){void 0===i&&(i=60);var l=e.focus,c=e.numClasses,u=e.colors,d=e.rotation,p=!!l,h=Math.sqrt(Math.pow(i,2)+Math.pow(i,2))+(p?0:5),y=null;null!=n&&(y="opacity: "+n);for(var m=[],f=[],v=[],g=(i||75)/c,b=0;b<c;b++)for(var _=b*g,L=0;L<c;L++){var w=L*g,S=r.generateFillAttributes(u[b][L]),x=r.generateStrokeAttributes(null),M={type:"rect",x:w,y:_,width:g,height:g};m.push(r.renderDef(S)),f.push(r.renderShape(M,S.fill,x,null)),v.push(r.getBoundingBox(M))}var I=null;p||(I="margin: -15px -15px -18px -15px");var A=o("left",l,t),k=o("right",l,t),C=r.computeBBox(v),E=r.getTransformMatrix(C,h,h,0,!1,d),R=r.getTransformMatrix(C,h,h,0,!1,p?-45:null);return a.tsx("div",{style:y,class:p?"esri-relationship-ramp--diamond__middle-column--ramp":s},a.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:h,height:h,style:I},a.tsx("defs",null,a.tsx("marker",{id:t+"_arrowStart",markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},a.tsx("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),a.tsx("marker",{id:t+"_arrowEnd",markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},a.tsx("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),m),a.tsx("g",{transform:E},f),a.tsx("g",{transform:R},a.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":A.markerStart,"marker-end":A.markerEnd,x1:-10,y1:i-15,x2:-10,y2:15}),a.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":k.markerStart,"marker-end":k.markerEnd,x1:15,y1:i+10,x2:i-15,y2:i+10}))))}(e,t,c);return p?a.tsx("div",{class:"esri-relationship-ramp--diamond__container"},a.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},d.left),a.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},a.tsx("div",{class:n},d.top),h,a.tsx("div",{class:n},d.bottom)),a.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},d.right)):a.tsx("div",{class:"esri-relationship-ramp--square__table"},a.tsx("div",{class:i},a.tsx("div",{class:a.classes(s,l,"esri-relationship-ramp--square__table-label--right-bottom")},d.left),a.tsx("div",{class:s}),a.tsx("div",{class:a.classes(s,l,"esri-relationship-ramp--square__table-label--left-bottom")},d.top)),a.tsx("div",{class:i},a.tsx("div",{class:s}),h,a.tsx("div",{class:s})),a.tsx("div",{class:i},a.tsx("div",{class:a.classes(s,l,"esri-relationship-ramp--square__table-label--right-top")},d.bottom),a.tsx("div",{class:s}),a.tsx("div",{class:a.classes(s,l,"esri-relationship-ramp--square__table-label--left-top")},d.right)))}}.apply(null,a))||(e.exports=n)},505:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(258)],void 0===(n=function(e,t,r){function a(e,t){return!t}Object.defineProperty(t,"__esModule",{value:!0}),t.attachToNode=function(e){e.appendChild(this)},t.getTitle=function(e,t,n){if(t){if("string"==typeof t)return t;if("value"in t||"unit"in t)return r.substitute(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var i=null;return function(e,t){return t}(0,n)?i=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:a(0,n)&&(i=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),i?r.substitute("showField"===i?"{field}":e[i],{field:t.field,normField:t.normField}):null}},t.isRendererTitle=a,t.isImageryStretchedLegend=function(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}}.apply(null,a))||(e.exports=n)},676:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(258),r(158),r(169),r(167),r(157),r(151),r(677)],void 0===(n=function(e,t,r,a,n,i,s,l,o,c){var u="state",d="all-layer-views",p="legend-properties",h=i.ofType(c),y=["esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer"],m=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new s,r._layerViewByLayerId={},r._layerInfosByLayerViewId={},r._activeLayerInfosByLayerViewId={},r.activeLayerInfos=new h,r.basemapLegendVisible=!1,r.groundLegendVisible=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.layerInfos=[],r.view=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add(l.init(this,"view",this._viewHandles),"view"),this._handles.add(a.onLocaleChange((function(){return e._refresh()})))},t.prototype.destroy=function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null},Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),t.prototype._viewHandles=function(){this._handles.remove(u),this.view&&this._handles.add(l.init(this,"state",this._stateHandles),u)},t.prototype._stateHandles=function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()},t.prototype._resetAll=function(){this._handles.remove([d,p]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()},t.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)},t.prototype._destroyViewActiveLayerInfo=function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)},t.prototype._watchPropertiesAndAllLayerViews=function(){var e=this.view.allLayerViews;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),d),this._handles.add(l.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),p)},t.prototype._allLayerViewsChangeHandle=function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()},t.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos(),this._refresh()},t.prototype._refresh=function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)},t.prototype._sortActiveLayerInfos=function(e){var t=this;if(!(e.length<2)){var r=[];e.forEach((function(a){if(!a.parent){var n=a.layer.parent,i=n&&"uid"in n&&t._layerViewByLayerId[n.uid],s=i&&t._activeLayerInfosByLayerViewId[i.uid];s&&-1!==e.indexOf(s)&&(r.push(a),a.parent=s,s.children.add(a),t._sortActiveLayerInfos(s.children))}})),e.removeMany(r);var a={};this.view.allLayerViews.forEach((function(e,t){return a[e.layer.uid]=t})),e.sort((function(e,t){var r=a[e.layer.uid]||0;return(a[t.layer.uid]||0)-r}))}},t.prototype._generateLayerViews=function(){var e=[];return m.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e},t.prototype._filterLayerViews=function(e){var t=!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===e||"view.basemapView.referenceLayerViews"===e),r=!this.groundLegendVisible&&"view.groundView.layerViews"===e;return!t&&!r},t.prototype._collectLayerViews=function(e,t){var r=function(a){return a&&a.forEach((function(a){t.push(a),r(a[e])})),t};return r},t.prototype._filterLayerViewsByLayerInfos=function(e){var t=this,r=this.layerInfos;return!r||!r.length||r.some((function(r){return t._hasLayerInfo(r,e)}))},t.prototype._hasLayerInfo=function(e,t){var r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r},t.prototype._isLayerUIDMatching=function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))},t.prototype._hasLayerUID=function(e,t){var r=this;return e&&e.some((function(e){return r._isLayerUIDMatching(e,t)}))},t.prototype._isLayerViewSupported=function(e){return y.indexOf(e.layer.declaredClass)>-1&&(this._layerViewByLayerId[e.layer.uid]=e,!0)},t.prototype._generateActiveLayerInfo=function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(l.watch(e,"suspended, layer.legendEnabled",(function(){return t._layerActiveHandle(e)})),e.uid))},t.prototype._layerActiveHandle=function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))},t.prototype._isLayerActive=function(e){return!this.respectLayerVisibility||!e.suspended&&e.get("layer.legendEnabled")},t.prototype._buildActiveLayerInfo=function(e){var t=this,r=e.layer,a=e.uid,n=this._layerInfosByLayerViewId[a],i=this._activeLayerInfosByLayerViewId[a];if(!i){var s=n&&void 0!==n.title;i=new c({layer:r,layerView:e,title:s?n.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:n&&n.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[a]=i}if(!i.parent){var o=r.parent,u=o&&this._layerViewByLayerId[o.uid];i.parent=u&&this._activeLayerInfosByLayerViewId[u.uid]}if(!this._handles.has(a)){var d=[l.watch(r,"title",(function(r){return t._titleHandle(r,i,e)})),l.watch(r,"renderer?, opacity",(function(){return t._constructLegendElements(i,e)})),l.whenTrue(this.view,"stationary",(function(){return t._scaleHandle(i,e)})),l.watch(e,"_effectiveRenderer",(function(){return t._constructLegendElements(i,e)}))];if(this.respectLayerVisibility){var p=l.watch(e,"suspended",(function(r){return t._suspendedHandle(r,i,e)})),h=l.watch(r,"legendEnabled",(function(r){return t._legendEnabledHandle(r,i,e)}));d.push(p,h)}this._handles.add(d,a)}i.isScaleDriven||this._constructLegendElements(i,e),this._addActiveLayerInfo(i,e)},t.prototype._titleHandle=function(e,t,r){t.title=e,this._constructLegendElements(t,r)},t.prototype._legendEnabledHandle=function(e,t,r){e?this._addActiveLayerInfo(t,r):this._removeActiveLayerInfo(t)},t.prototype._suspendedHandle=function(e,t,r){e?this._removeActiveLayerInfo(t):this._addActiveLayerInfo(t,r)},t.prototype._scaleHandle=function(e,t){e.isScaleDriven&&this._constructLegendElements(e,t)},t.prototype._addActiveLayerInfo=function(e,t){if(this._isLayerActive(t)&&-1===this.activeLayerInfos.indexOf(e)){var r=e.parent;r?(-1===r.children.indexOf(e)&&r.children.push(e),this._sortActiveLayerInfos(r.children)):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}},t.prototype._removeActiveLayerInfo=function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)},t.prototype._constructLegendElements=function(e,t){var r=t.layer;r.featureCollections?e.buildLegendElementsForFeatureCollections(r.featureCollections):r.renderer?e.buildLegendElementsForRenderer(r.renderer):r.url&&e.buildLegendElementsForTools()},r.__decorate([o.property({type:h})],t.prototype,"activeLayerInfos",void 0),r.__decorate([o.property()],t.prototype,"basemapLegendVisible",void 0),r.__decorate([o.property()],t.prototype,"groundLegendVisible",void 0),r.__decorate([o.property()],t.prototype,"keepCacheOnDestroy",void 0),r.__decorate([o.property()],t.prototype,"respectLayerVisibility",void 0),r.__decorate([o.property()],t.prototype,"layerInfos",void 0),r.__decorate([o.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null),r.__decorate([o.property()],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.widgets.Legend.LegendViewModel")],t)}(n)}.apply(null,a))||(e.exports=n)},677:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(182),r(165),r(239),r(158),r(180),r(169),r(167),r(156),r(152),r(153),r(172),r(157),r(151),r(378),r(191),r(316),r(781),r(678),r(357),r(266),r(682),r(683),r(684),r(685),r(686),r(397),r(161)],void 0===(n=function(e,t,a,n,i,s,l,o,c,u,d,p,h,y,m,f,v,g,b,_,L,w,S,x,M,I,A,k,C){var E=d.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),R=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,V=new s.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),z=new s.SimpleFillSymbol({style:"solid"});function O(e){return"raster-colormap"===e.type}function F(e){return"raster-stretch"===e.type}function T(e){return"raster-shaded-relief"===e.type}function D(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function P(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function N(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function j(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function H(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function B(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function U(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Z(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function W(e){return"esri.layers.MapImageLayer"===e.declaredClass}function q(e){return"esri.layers.ImageryLayer"===e.declaredClass}var G=new s.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),J={};return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new u,r._hasColorRamp=!1,r._hasOpacityRamp=!1,r._hasSizeRamp=!1,r._webStyleSymbolCache=new Map,r._dotDensityUrlCache=new Map,r._scaleDrivenSizeVariable=null,r._hasClusterSizeVariable=!1,r.children=new c,r.layerView=null,r.layer=null,r.legendElements=[],r.parent=null,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.sublayerIds=[],r.title=null,r.view=null,r}return a.__extends(t,e),t.prototype.initialize=function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([m.on(this,"children","change",(function(r){var a=r.added,n=r.removed,i=e._handles;a.map((function(e){var r="activeLayerInfo-ready-watcher-"+e.layer.uid;i.add(m.init(e,"ready",t),r)})),n.forEach((function(e){return i.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(J={})},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(J=null)},Object.defineProperty(t.prototype,"ready",{get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.view&&this.view.scale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isScaleDriven",{get:function(){var e=this,t=this.layer;if(null===t)return!1;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type)return!0;if("renderer"in t&&t.renderer){if("dot-density"===t.renderer.type)return!0;var r=t.get("renderer.valueExpression");if(R.test(r))return!0;var a=t.get("renderer.visualVariables");if(a)return a.some((function(t){return e._isScaleDrivenSizeVariable(t)}))}return this._isLayerScaleDriven(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0}),t.prototype.buildLegendElementsForFeatureCollections=function(e){return a.__awaiter(this,void 0,void 0,(function(){var t,r=this;return a.__generator(this,(function(a){return this.legendElements=[],t=e.map((function(e){if("esri.layers.FeatureLayer"===e.declaredClass)return r._buildRendererLegendElements(e.renderer,{title:e.title,mode:0});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,a=t&&t.drawingInfo,n=a&&b.fromJSON(a.renderer);return n?r._buildRendererLegendElements(n,{title:e.name,mode:0}):(E.warn("drawingInfo not available!"),null)}return null})),[2,h.eachAlways(t).then((function(){}))]}))}))},t.prototype.buildLegendElementsForRenderer=function(e){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(t){return[2,this._buildRendererLegendElements(e)]}))}))},t.prototype.buildLegendElementsForTools=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t=this;return a.__generator(this,(function(r){switch(r.label){case 0:return function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e=this.layer)?(this._constructLegendElementsForWMTSlayer(),[3,6]):[3,1];case 1:return function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e)?(this._constructLegendElementsForWMSSublayers(),[3,6]):[3,2];case 2:return W(e)||function(e){return"esri.layers.TileLayer"===e.declaredClass}(e)?[4,this._constructLegendElementsForSublayers()]:[3,4];case 3:return r.sent(),[3,6];case 4:return this._handles.remove("imageryLayers-watcher"),[4,this._getLegendLayers().then((function(r){t.legendElements=[],r.forEach((function(r){if(q(e)){var a=e.watch("renderingRule, bandIds",(function(){J.default=null,t.buildLegendElementsForTools()}));t._handles.add(a,"imageryLayers-watcher")}var n=t._generateSymbolTableElementForLegendLayer(r);n&&n.infos.length&&(q(e)&&(n.title=e.title),t.legendElements.push(n)),t.notifyChange("ready")})),t.notifyChange("ready")})).catch((function(e){E.warn("Request to server for legend has failed!",e)}))];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},t.prototype._isGroupActive=function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))},t.prototype._isScaleDrivenSizeVariable=function(e){if(e&&"size"!==e.type)return!1;var t=e,r=t.minSize,a=t.maxSize;return"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):"object"==typeof a&&a?this._isScaleDrivenSizeVariable(a):!!t.expression||R.test(t.valueExpression)},t.prototype._isLayerScaleDriven=function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var r=e.parent;if(!1===e.loaded&&W(r)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(var a=0,n=r.sourceJSON.layers;a<n.length;a++){var i=n[a];if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1},t.prototype._buildRendererLegendElements=function(e,t){return void 0===t&&(t={}),a.__awaiter(this,void 0,void 0,(function(){var r,n;return a.__generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._getRendererLegendElements(e,{title:t.title})];case 1:return r=a.sent(),0===t.mode?Array.prototype.push.apply(this.legendElements,r):this.legendElements=r,this.notifyChange("ready"),[3,3];case 2:return n=a.sent(),E.warn("error while building legend for layer!",n),[3,3];case 3:return[2]}}))}))},t.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var e=this.layer,t=e.activeLayer;if(this._handles.add(m.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var r=null;t.styles.some((function(e){return t.styleId===e.id&&(r=e.legendUrl,!0)})),r&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:r,opacity:e.opacity}]}])}this.notifyChange("ready")},t.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");var e=this.layer,t=null;(e.customParameters||e.customLayerParameters)&&(t=a.__assign(a.__assign({},e.customParameters),e.customLayerParameters)),this._handles.add(m.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher"),this.legendElements=this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")},t.prototype._generateLegendElementsForWMSSublayers=function(e,t){var r=this,a=[];return this._handles.add(e.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher"),e.forEach((function(e){var n=e.watch("title, visible, legendEnabled",(function(){return r._constructLegendElementsForWMSSublayers()}));if(r._handles.add(n,"wms-sublayers-watcher"),e.visible&&e.legendEnabled){var i=r._generateSymbolTableElementForWMSSublayer(e,t);i&&i.infos.length&&a.unshift(i)}})),a},t.prototype._generateSymbolTableElementForWMSSublayer=function(e,t){if(!e.legendUrl&&e.sublayers){var r=this._generateLegendElementsForWMSSublayers(e.sublayers,t).filter((function(e){return e}));return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendUrl(e,t)},t.prototype._generateSymbolTableElementForLegendUrl=function(e,t){var r=e.legendUrl;if(r){var a={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};return t&&(r+="?"+y.objectToQuery(t)),a.infos.push({src:r,opacity:e.layer&&e.layer.opacity}),a}},t.prototype._getLegendLayers=function(e){var t=e&&e.hasDynamicLayers?e.dynamicLayers:null,r=t||"default",a=J&&J[r];return a?h.resolve(a):this._legendRequest(t).then((function(e){var t=e.layers;return J[r]=t,t}))},t.prototype._legendRequest=function(e){var t=this.layer,r={f:"json",dynamicLayers:e};if(q(t)){var n=t;if(n.renderingRule&&(r.renderingRule=JSON.stringify(n.renderingRule.toJSON())),n.bandIds&&(r.bandIds=n.bandIds.join()),n.raster||n.viewId){var s=n.raster,l=n.viewId;r=a.__assign({raster:s,viewId:l},r)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var c=o.indexOf("?");c>-1?o=o.substring(0,c)+"/legend"+o.substring(c):o+="/legend"}else{var u=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,u)+o.substring(u+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return i(o,{query:r}).then((function(e){return e.data}))},t.prototype._constructLegendElementsForSublayers=function(){return a.__awaiter(this,void 0,void 0,(function(){var e,t,r;return a.__generator(this,(function(a){switch(a.label){case 0:this.legendElements=[],this._handles.remove("sublayers-watcher"),e=this.layer,this._handles.add(m.watch(e,"sublayers",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher"),a.label=1;case 1:return a.trys.push([1,3,,4]),t=this,[4,this._generateLegendElementsForSublayers(e.sublayers,e.opacity)];case 2:return t.legendElements=a.sent(),this.notifyChange("ready"),[3,4];case 3:return r=a.sent(),E.warn("Request to server for legend has failed!",r),[3,4];case 4:return[2]}}))}))},t.prototype._generateLegendElementsForSublayers=function(e,t,r){return a.__awaiter(this,void 0,void 0,(function(){var n,i,s,l,o,c,u,d,p,h,y,m=this;return a.__generator(this,(function(a){switch(a.label){case 0:n=[],this._handles.add(e.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher"),i=e.toArray(),!r&&this.sublayerIds&&this.sublayerIds.length&&(s=this.layer,i=this.sublayerIds.map((function(e){return s.findSublayerById(e)})).filter(Boolean)),l=0,o=i,a.label=1;case 1:return l<o.length?(c=o[l],u=c.watch("renderer, opacity, title, visible, legendEnabled",(function(){return m._constructLegendElementsForSublayers()})),this._handles.add(u,"sublayers-watcher"),c.visible&&c.legendEnabled?(d=c&&null!=c.opacity?c.opacity:null,p=null!=d?d*t:t,!c.renderer||c.sublayers?[3,5]:this.respectLayerVisibility&&!this._isSublayerInScale(c)?[3,4]:[4,c.load()]):[3,7]):[3,8];case 2:return a.sent(),[4,this._getRendererLegendElements(c.renderer,{title:c.title,opacity:p,sublayer:c})];case 3:h=a.sent(),Array.prototype.unshift.apply(n,h),a.label=4;case 4:return[3,7];case 5:return[4,this._generateSymbolTableElementForSublayer(c,p,r)];case 6:(y=a.sent())&&n.unshift(y),a.label=7;case 7:return l++,[3,1];case 8:return[2,n.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)}))]}}))}))},t.prototype._generateSymbolTableElementForSublayer=function(e,t,r){return a.__awaiter(this,void 0,void 0,(function(){var n,i,s;return a.__generator(this,(function(a){switch(a.label){case 0:if(r)return[3,4];r=new Map,n=new v.ExportImageParameters({layer:this.layer}),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._getLegendLayers(n)];case 2:return a.sent().forEach((function(e){return r.set(e.layerId,e)})),[3,4];case 3:return n.destroy(),[7];case 4:return(i=r.get(e.id))||!e.sublayers?[3,6]:[4,this._generateLegendElementsForSublayers(e.sublayers,t,r)];case 5:return s=a.sent(),[2,{type:"symbol-table",title:e.title,infos:s}];case 6:return[2,this._generateSymbolTableElementForLegendLayer(i,e,t)]}}))}))},t.prototype._generateSymbolTableElementForLegendLayer=function(e,t,r){var a=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var n=t&&t.renderer,i=t&&t.title||e.layerName;if(n){var s=t&&t.title||this._getRendererTitle(n,t);s&&(i&&(s.title=i),i=s)}var l={type:"symbol-table",title:i,infos:[]};e.legendType&&(l.legendType=e.legendType);var o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return l.infos=o.map((function(t){var n=t.url;if(t.imageData&&t.imageData.length>0)n="data:image/png;base64,"+t.imageData;else{if(0===n.indexOf("http"))return null;n=y.addTokenParameter(a.layer.url+"/"+e.layerId+"/images/"+n)}return{label:t.label,src:n,opacity:null==r?a.layer.opacity:r,width:t.width,height:t.height}})).filter((function(e){return!!e})),l.infos.length?l:null},t.prototype._isSublayerInScale=function(e){var t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)},t.prototype._isLegendLayerInScale=function(e,t){var r=t||this.layer,a=null,n=null,i=!0;return!r.minScale&&0!==r.minScale||!r.maxScale&&0!==r.maxScale?(0===e.minScale&&r.tileInfo&&(a=r.tileInfo.lods[0].scale),0===e.maxScale&&r.tileInfo&&(n=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(a=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,n=Math.max(r.maxScale,e.maxScale)),(a>0&&a<this.scale||n>this.scale)&&(i=!1),i},t.prototype._sanitizeLegendForSublayer=function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var r=t.renderer,a=e.some((function(e){return e.values})),n=null,i=null;return a&&e.some((function(e,t){return e.values||(n=t,(i=e).label||(i.label="others")),null!=i})),r?"unique-value"===r.type?i&&(e.splice(n,1),e.push(i)):"class-breaks"===r.type&&(i&&e.splice(n,1),e.reverse(),i&&e.push(i)):i&&(e.splice(n,1),e.push(i)),e},t.prototype._getRendererLegendElements=function(e,t){return void 0===t&&(t={}),a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(r){return function(e){return D(e)||P(e)||N(e)||F(e)||O(e)||j(e)||H(e)||B(e)||U(e)||Z(e)||T(e)}(e)?function(e){return H(e)||B(e)||U(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e)?[2,this._constructPointCloudRendererLegendElements(e,t)]:Z(e)?[2,this._constructDotDensityRendererLegendElements(e)]:[2,this._constructRendererLegendElements(e,t)]:(E.warn("Renderer not supported!"),[2,[]])}))}))},t.prototype._getPointCloudRendererTitle=function(e){return e.legendOptions&&e.legendOptions.title||e.field},t.prototype._constructPointCloudRendererLegendElements=function(e,t){var r=this;void 0===t&&(t={});var a=t.title,n=[],i=null,s=null;if(H(e))i={type:"symbol-table",title:a||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){i.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:r._getAppliedCloneSymbol(V,e.color)})}));else if(B(e)){var l=e.stops,o=null;if(l.length&&(1===l.length&&(o=l[0].color),!o)){var c=l[0].value,u=l[l.length-1].value;if(null!=c&&null!=u){var d=c+(u-c)/2;o=M.getColorFromPointCloudStops(d,l)}}i={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(V,o||V.color)}]};var p=M.getRampStopsForPointCloud(e.stops);s={type:"color-ramp",title:a||this._getPointCloudRendererTitle(e),infos:p,preview:L.renderColorRampPreviewHTML(p.map((function(e){return e.color})))}}else U(e)&&(i={type:"symbol-table",title:a||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){i.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:r._getAppliedCloneSymbol(V,e.color)})})));i&&i.infos.length&&n.push(i),s&&s.infos.length&&n.push(s);var y=n.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(e){return r._getSymbolPreview(e,r.layer.opacity)}));return h.eachAlways(y).then((function(){return n}))},t.prototype._getElementInfoForDotDensity=function(e,t){var r=e.backgroundColor,a=e.outline,n=e.dotSize+"-"+t+"-"+r+"-"+(a&&JSON.stringify(a.toJSON())),i=this._dotDensityUrlCache,s=i.has(n)?i.get(n):L.renderDotDensityPreviewHTML(e,t);return i.set(n,s),{opacity:1,src:s.src,preview:s,width:s.width,height:s.height}},t.prototype._constructDotDensityRendererLegendElements=function(e){var t=this,r=e.calculateDotValue(this.view.scale),a=e.legendOptions&&e.legendOptions.unit,n={type:"symbol-table",title:{value:r&&Math.round(r),unit:a||""},infos:[]};return e.attributes.forEach((function(r){var a=t._getElementInfoForDotDensity(e,r.color);a.label=r.label||r.valueExpressionTitle||r.field,n.infos.push(a)})),h.resolve([n])},t.prototype._constructRendererLegendElements=function(e,t){return void 0===t&&(t={}),a.__awaiter(this,void 0,void 0,(function(){var r,n,i,l,o,c,u,d,y,m,f,v,g,b,_,w,S,x,M,k,C,E,R,V,H,B,U,Z,W,J,Q,X,Y,K,$,ee,te,re,ae,ne,ie=this;return a.__generator(this,(function(a){switch(a.label){case 0:return r=t.title,n=t.sublayer,i=n||this.layer,[4,this._loadRenderer(e)];case 1:return l=a.sent(),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,[4,this._getVisualVariableLegendElements(l,i)];case 2:return o=a.sent()||[],c={type:"symbol-table",title:r||this._getRendererTitle(l,i),infos:[]},u=null,d=!1,y=new Set,j(l)?(m=I.getHeatmapRampStops(l),o.push({type:"heatmap-ramp",title:r,infos:m,preview:L.renderColorRampPreviewHTML(m.map((function(e){return e.color})))}),[3,12]):[3,3];case 3:if(!N(l))return[3,4];if((f=l&&l.authoringInfo)&&"relationship"===f.type){if(v=f.focus,g=f.numClasses,b=f.field1,_=f.field2,g&&b&&_){for(w=[b,_],S=A.getRotationAngleForFocus(v)||0,x=0,M=w;x<M.length;x++)C=(k=M[x]).field,E=k.normalizationField,R=k.label,V=R||{field:this._getFieldAlias(C,i),normField:E&&this._getFieldAlias(E,i)},(H=G.clone()).angle=S,c.infos.push({label:V,symbol:H}),y.add(H),S+=90;B=A.getRelationshipRampElement({focus:v,numClasses:g,infos:l.uniqueValueInfos}),o.unshift(B)}}else U=l.field,l.uniqueValueInfos.forEach((function(e){if(e.symbol){var t=e.symbol.clone();q(ie.layer)&&(t=s.SimpleMarkerSymbol.fromJSON({color:t.color,style:"square"})),c.infos.push({label:e.label||ie._getDomainName(U,e.value,i)||e.value,value:e.value,symbol:t})}}));return l.defaultSymbol&&(c.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0),[3,12];case 4:return P(l)?((!(u=this._isUnclassedRenderer(l))||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((function(e){if(e.symbol){var t=e.symbol.clone();q(ie.layer)&&(t=s.SimpleMarkerSymbol.fromJSON({color:t.color,style:"square"})),c.infos.unshift({label:e.label||(u?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:t})}})),u&&(c.title=null),this._updateInfosforClassedSizeRenderer(l,c.infos)),l.defaultSymbol&&!u&&(c.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0),[3,12]):[3,5];case 5:return F(l)?function(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}(this.layer)?("stretch-ramp"===(Z=this._constructTileImageryStretchRendererElements(l)).type?o.push(Z):c.infos=Z,[3,10]):[3,6]:[3,11];case 6:return W=this.layer,J=void 0,Q=void 0,l.statistics&&l.statistics.length&&(J=l.statistics[0].min||l.statistics[0][0],Q=l.statistics[0].max||l.statistics[0][1]),X=[],K=p.unwrap,W.renderingRule?[4,W.generateRasterInfo(W.renderingRule)]:[3,8];case 7:return $=a.sent(),[3,9];case 8:$=W.serviceRasterInfo,a.label=9;case 9:Y=K.apply(void 0,[$]),ee=Y.keyProperties.BandProperties,1===Y.bandCount?(J=J||Y.statistics&&Y.statistics[0].min,Q=Q||Y.statistics&&Y.statistics[0].max,J||Q?o.push(this._getStretchLegendElements(l,{min:J,max:Q})):this.buildLegendElementsForTools()):W.bandIds&&1===W.bandIds.length?(J=J||Y.statistics&&Y.statistics[W.bandIds[0]].min,Q=Q||Y.statistics&&Y.statistics[W.bandIds[0]].max,J||Q?o.push(this._getStretchLegendElements(l,{min:J,max:Q})):this.buildLegendElementsForTools()):Y.bandCount>=3?ee&&ee.length>=Y.bandCount?W.bandIds&&3===W.bandIds.length?(X=W.bandIds.map((function(e){return ee[e].BandName})),c.infos=this._createSymbolTableElementMultiBand(X)):"lerc"===W.format?(X=[0,1,2].map((function(e){return ee[e].BandName})),c.infos=this._createSymbolTableElementMultiBand(X)):this.buildLegendElementsForTools():"lerc"===W.format?(X=["band0","band1","band2"],c.infos=this._createSymbolTableElementMultiBand(X)):this.buildLegendElementsForTools():this.buildLegendElementsForTools(),a.label=10;case 10:return[3,12];case 11:O(l)?l.colormapInfos.forEach((function(e){c.infos.push({label:e.label,value:e.value,symbol:ie._getAppliedCloneSymbol(z,e.color)})})):D(l)?l.symbol&&!this._hasSizeRamp&&c.infos.push({label:l.label,symbol:l.symbol}):T(l)&&o.push(this._getStretchLegendElements(l,{min:0,max:255})),a.label=12;case 12:return!(te=l.defaultSymbol)||d||D(l)||u&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:te}]}),c.infos.length&&o.unshift(c),re=null==t.opacity?i.opacity:t.opacity,ae=this._getSymbolConfig("visualVariables"in l&&l.visualVariables),ne=o.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!(!e||!e.symbol)})).map((function(e){return ie._getSymbolPreview(e,re,{applyScaleDrivenSize:!y.has(e.symbol),symbolConfig:ae})})),l=null,[4,h.eachAlways(ne)];case 13:return a.sent(),[2,o]}}))}))},t.prototype._constructTileImageryStretchRendererElements=function(e){var t,r,a,n=this.layer,i=n.rasterInfo,s=i.bandCount||e.statistics.length,l=i.keyProperties&&i.keyProperties.BandProperties;if(e.statistics&&e.statistics.length&&(t=void 0!==e.statistics[0].min?e.statistics[0].min:e.statistics[0][0],r=e.statistics[0].max||e.statistics[0][1]),1===i.bandCount)return this._getStretchLegendElements(e,{min:t,max:r});function o(e){var t=(n.bandIds&&n.bandIds.length?n.bandIds:[0,1,2]).map((function(t){return e&&e[t]&&e[t].BandName||"band"+t}));return t.length<3?t.push(t[1]):t.length>3&&t.splice(3),t}return a=l&&l.length>=s?o(l):o(),this._createSymbolTableElementMultiBand(a)},t.prototype._getStretchLegendElements=function(e,t){var r=e.colorRamp,a=M.getStrectchRampStops(r,t);return{type:"stretch-ramp",title:"",infos:a,preview:L.renderColorRampPreviewHTML(a.map((function(e){return e.color})))}},t.prototype._createSymbolTableElementMultiBand=function(e){var t=[],r=["red","green","blue"];return e.forEach((function(e,a){t.push({label:{colorName:r[a],bandName:e},src:C.RGB_IMG_SOURCE[a],opacity:1})})),t},t.prototype._updateInfosforClassedSizeRenderer=function(e,t){var r=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,a=e.classBreakInfos.some((function(e){return w.isVolumetricSymbol(e.symbol)}));if(r&&a){var n=k.REAL_WORLD_MAX_SIZE,i=k.REAL_WORLD_MIN_SIZE,s=e.classBreakInfos.length,l=(n-i)/(s>1?s-1:s);t.forEach((function(e,t){e.size=n-l*t}))}},t.prototype._getSymbolConfig=function(e){var t=!1,r=!1;if(e)for(var a=0;a<e.length&&(!t||!r);a++){var n=e[a];"size"===n.type&&("height"===n.axis&&(t=!0),"width-and-depth"===n.axis&&(r=!0))}return t&&r?"tall":null},t.prototype._getSymbolPreview=function(e,t,n){return a.__awaiter(this,void 0,void 0,(function(){var i,s;return a.__generator(this,(function(a){switch(a.label){case 0:return i=e.size,this._scaleDrivenSizeVariable&&(null==n?void 0:n.applyScaleDrivenSize)?[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:[3,2];case 1:s=a.sent().getSize,i=s(this._scaleDrivenSizeVariable,null,{view:this.view,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null}),a.label=2;case 2:return[2,L.renderPreviewHTML(e.symbol,{size:i,opacity:t,symbolConfig:null==n?void 0:n.symbolConfig,rotation:e.symbol.angle}).then((function(t){return e.preview=t,e})).catch((function(){return e.preview=null,e}))]}}))}))},t.prototype._loadRenderer=function(e){var t,r;return a.__awaiter(this,void 0,void 0,(function(){var n,i,s,l,o,c,u,d,y,m,f,v,g=this;return a.__generator(this,(function(a){switch(a.label){case 0:return n=[],i=this.layer,e=e.clone(),this._hasClusterSizeVariable=!1,s="visualVariables"in e&&(null===(t=e.visualVariables)||void 0===t?void 0:t.some((function(e){return"size"===e.type&&"outline"!==e.target&&!R.test(e.valueExpression)}))),e&&"visualVariables"in e&&!s&&"featureReduction"in i&&"cluster"===(null===(r=i.featureReduction)||void 0===r?void 0:r.type)&&(l=this.layerView._effectiveRenderer,(o=p.unwrap(x.getClusterSizeVariable(l,this.view)))&&("clusterMinSize"in(c=i.featureReduction)&&"clusterMaxSize"in c&&(u=c.clusterMinSize,d=c.clusterMaxSize,o.legendOptions=new _({showLegend:u!==d})),y=e.visualVariables||[],e.visualVariables=y.concat([o]),this._hasClusterSizeVariable=!0)),[4,this._getMedianColor(e)];case 1:return m=a.sent(),(P(e)||N(e))&&(f=e.classBreakInfos||e.uniqueValueInfos,v=f.map((function(e){return g._fetchSymbol(e.symbol,m).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(n,v)),n.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:m).then((function(t){g._applySymbolToRenderer(e,t,D(e))})).catch((function(){g._applySymbolToRenderer(e,null,D(e))}))),[2,h.eachAlways(n).then((function(){return e}))]}}))}))},t.prototype._applySymbolToRenderer=function(e,t,r){r?e.symbol=t:e.defaultSymbol=t},t.prototype._getMedianColor=function(e){return a.__awaiter(this,void 0,void 0,(function(){var t,n,i,s;return a.__generator(this,(function(a){switch(a.label){case 0:if(!("visualVariables"in e)||!e.visualVariables)return[2,null];if(!(t=o.find(e.visualVariables,(function(e){return"color"===e.type}))))return[2,null];if(n=null,i=null,t.stops){if(1===t.stops.length)return[2,t.stops[0].color];n=t.stops[0].value,i=t.stops[t.stops.length-1].value}return s=n+(i-n)/2,[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,(0,a.sent().getColor)(t,s)]}}))}))},t.prototype._fetchSymbol=function(e,t){var r=this;if(!e)return h.reject();if("web-style"===e.type){var a=e.portal,n=a&&a.url,i=a&&a.user&&a.user.username,s=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+n+"-"+i,l=this._webStyleSymbolCache;return l.has(s)||(this.view instanceof S?l.set(s,e.fetchCIMSymbol()):l.set(s,e.fetchSymbol())),l.get(s).then((function(e){return r._getAppliedCloneSymbol(e,t)})).catch((function(){return E.warn("Fetching web-style failed!"),h.reject()}))}return h.resolve(this._getAppliedCloneSymbol(e,t))},t.prototype._getAppliedCloneSymbol=function(e,t){if(!e)return e;var r=e.clone(),a=r.type.indexOf("3d")>-1,i=t&&t.toRgba();return a?this._applyColorTo3dSymbol(r,i):r.color&&(r.color=new n(i||r.color)),r},t.prototype._applyColorTo3dSymbol=function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new n(t))}))},t.prototype._getVisualVariableLegendElements=function(e,t){return a.__awaiter(this,void 0,void 0,(function(){var r,n,i,s,l,o,c,u,d,y,m,f,v=this;return a.__generator(this,(function(b){switch(b.label){case 0:if(!("visualVariables"in e)||!e.visualVariables)return[2,null];for(r=e.visualVariables,n=[],i=[],s=[],l=0,o=r;l<o.length;l++)"color"===(c=o[l]).type?n.push(c):"size"===c.type?i.push(c):"opacity"===c.type&&s.push(c);return u=a.__spreadArrays(n,i,s),0===n.length&&P(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&(m=e.classBreakInfos[0],d=m&&m.symbol),0===n.length&&D(e)&&(d=e.symbol),d&&(d.type.indexOf("3d")>-1?"water"===(f=d.symbolLayers.getItemAt(0)).type?p.isSome(f.color)&&(y=f.color):p.isSome(f.material)&&p.isSome(f.material.color)&&(y=f.material.color):d.url||(y=d.color)),[4,h.all(u.map((function(r){return a.__awaiter(v,void 0,void 0,(function(){var n,i,s,l,o,c,u,d;return a.__generator(this,(function(a){switch(a.label){case 0:return r.legendOptions&&!1===r.legendOptions.showLegend?[3,10]:(n=this._getRampTitle(r,t),i=null,s="getField"in t&&t.getField&&t.getField(r.field),l=s&&g.isDateField(s),"color"!==r.type?[3,2]:[4,M.getRampStops(r,null,l)]);case 1:return d=a.sent(),i={type:"color-ramp",title:n,infos:d,preview:L.renderColorRampPreviewHTML(d.map((function(e){return e.color})))},this._hasColorRamp||(this._hasColorRamp=!(null==i.infos||!i.infos.length)),[3,9];case 2:return"size"!==r.type||"outline"===r.target?[3,7]:R.test(r.valueExpression)?(this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=r),[3,6]):[3,3];case 3:return o={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(r):n},c=k.getRampStops,u=[e,r],[4,this._getMedianColor(e)];case 4:return[4,c.apply(void 0,u.concat([a.sent(),this.scale,this.view,l]))];case 5:o.infos=a.sent(),i=o,this._hasSizeRamp||(this._hasSizeRamp=!(null==i.infos||!i.infos.length)),a.label=6;case 6:return[3,9];case 7:return"opacity"!==r.type?[3,9]:[4,M.getRampStops(r,y,l)];case 8:d=a.sent(),i={type:"opacity-ramp",title:n,infos:d,preview:L.renderColorRampPreviewHTML(d.map((function(e){return e.color})))},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==i.infos||!i.infos.length)),a.label=9;case 9:return[2,i&&i.infos?i:null];case 10:return[2,void 0]}}))}))})))];case 1:return[2,b.sent().filter((function(e){return!!e}))]}}))}))},t.prototype._getDomainName=function(e,t,r){if(e&&"function"!=typeof e){var a="getField"in r&&r.getField&&r.getField(e),n=a&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(a.name):null;return n&&"coded-value"===n.type?n.getName(t):null}return null},t.prototype._getClusterTitle=function(e){var t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var a=t.featureReduction,n="popupTemplate"in a&&a.popupTemplate,i=n&&n.fieldInfos;if(i)for(var s=0,l=i;s<l.length;s++){var o=l[s];if(o.fieldName===r)return"cluster_count"===r?o.label||{showCount:!0}:o.label}}return{showCount:!0}},t.prototype._getRampTitle=function(e,t){var r=e.field,a=e.normalizationField,n=!1,i=!1,s=!1,l=null;r="function"==typeof r?null:r,a="function"==typeof a?null:a;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)l=o;else if(e.valueExpressionTitle)l=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var c=t.renderer.authoringInfo.visualVariables,u=0;u<c.length;u++){var d=c[u];if("color"===d.type){if("ratio"===d.style){n=!0;break}if("percent"===d.style){i=!0;break}if("percent-of-total"===d.style){s=!0;break}}}l={field:r&&this._getFieldAlias(r,t),normField:a&&this._getFieldAlias(a,t),ratio:n,ratioPercent:i,ratioPercentTotal:s}}return l},t.prototype._getRendererTitle=function(e,t){var r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;var a=r.field,n=null,i=null;P(r)&&(n=r.normalizationField,i="percent-of-total"===r.normalizationType),n="function"==typeof n?null:n;var s=null;return((a="function"==typeof a?null:a)||n)&&(s={field:a&&this._getFieldAlias(a,t),normField:n&&this._getFieldAlias(n,t),normByPct:i}),s},t.prototype._getFieldAlias=function(e,t){var r="popupTemplate"in t&&t.popupTemplate,a=r&&r.fieldInfos,n=null;a&&a.some((function(t){return e===t.fieldName&&(n=t,!0)}));var i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));var s=n||i,l=null;return s&&(l=n&&n.label||i&&i.alias||"name"in s&&s.name||"fieldName"in s&&s.fieldName),l},t.prototype._isUnclassedRenderer=function(e){var t=e.visualVariables,r=!1;return P(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(r=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),r},a.__decorate([f.property()],t.prototype,"children",void 0),a.__decorate([f.property()],t.prototype,"layerView",void 0),a.__decorate([f.property()],t.prototype,"layer",void 0),a.__decorate([f.property()],t.prototype,"legendElements",void 0),a.__decorate([f.property()],t.prototype,"parent",void 0),a.__decorate([f.property({readOnly:!0})],t.prototype,"ready",null),a.__decorate([f.property()],t.prototype,"keepCacheOnDestroy",void 0),a.__decorate([f.property()],t.prototype,"respectLayerVisibility",void 0),a.__decorate([f.property({dependsOn:["view.scale"],readOnly:!0})],t.prototype,"scale",null),a.__decorate([f.property()],t.prototype,"sublayerIds",void 0),a.__decorate([f.property({dependsOn:["layer.renderer?.valueExpression?","layer.renderer?.visualVariables?","layer.featureReduction?","scale"],readOnly:!0})],t.prototype,"isScaleDriven",null),a.__decorate([f.property()],t.prototype,"title",void 0),a.__decorate([f.property({dependsOn:["ready"],readOnly:!0,value:0})],t.prototype,"version",null),a.__decorate([f.property()],t.prototype,"view",void 0),a.__decorate([f.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],t)}(l)}.apply(null,a))||(e.exports=n)},678:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(177),r(152),r(246),r(679),r(680),r(503),r(681),r(357),r(161)],void 0===(n=function(e,t,a,n,i,s,l,o,c,u,d){Object.defineProperty(t,"__esModule",{value:!0});var p=null;function h(e,t){return Math.floor(Math.random()*(t-e+1)+e)}t.renderDotDensityPreviewHTML=function(e,t,r){var a=e.backgroundColor,n=e.outline,i=e.dotSize,s=r&&r.swatchSize||22,l=Math.round(s*s/Math.pow(i,2)*.8),o=window.devicePixelRatio,c=document.createElement("canvas"),u=s*o;c.width=u,c.height=u,c.style.width=c.width/o+"px",c.style.height=c.height/o+"px";var d=c.getContext("2d");if(a&&(d.fillStyle=a.toCss(!0),d.fillRect(0,0,u,u),d.fill()),d.fillStyle=t.toCss(!0),p&&p.length/2===l)for(var y=0;y<2*l;y+=2){var m=p[y],f=p[y+1];d.fillRect(m,f,i*o,i*o),d.fill()}else for(p=[],y=0;y<2*l;y+=2)m=h(0,u),f=h(0,u),p.push(m,f),d.fillRect(m,f,i*o,i*o),d.fill();n&&(n.color&&(d.strokeStyle=n.color.toCss(!0)),d.lineWidth=n.width,d.strokeRect(0,0,u,u));var v=new Image(s,s);return v.src=c.toDataURL(),v},t.renderColorRampPreviewHTML=function(e,t){void 0===t&&(t={});var r="horizontal"===t.align,a=r?75:24,n=r?24:75,i=t.width,s=void 0===i?a:i,l=t.height,o=void 0===l?n:l,c=t.gradient,u=void 0===c||c,d=window.devicePixelRatio,p=s*d,h=o*d,y=document.createElement("canvas");y.width=p,y.height=h,y.style.width=s+"px",y.style.height=o+"px";var m=y.getContext("2d"),f=r?p:0,v=r?0:h;if(u){var g=m.createLinearGradient(0,0,f,v),b=1/(e.length-1);e.forEach((function(e,t){return g.addColorStop(t*b,e.toString())})),m.fillStyle=g,m.fillRect(0,0,p,h)}else for(var _=r?p/e.length:p,L=r?h:h/e.length,w=0,S=0,x=0,M=e;x<M.length;x++){var I=M[x];m.fillStyle=I.toString(),m.fillRect(w,S,_,L),w=r?w+_:0,S=r?0:S+L}var A=document.createElement("div");return A.style.width=s+"px",A.style.height=o+"px",A.appendChild(y),A},t.renderPreviewHTML=function e(t,r){switch(t.type){case"web-style":return u.previewWebStyleSymbol(t,e,r);case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return c.previewSymbol3D(t,r);case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":return o.previewSymbol2D(t,r);case"cim":return l.previewCIMSymbol(t,r);default:return void n.neverReached(t)}},t.getDisplayedSymbol=function(e,t){return a.__awaiter(this,void 0,void 0,(function(){var n,l,o,c,u,p,h,y,m,f,v,g,b,_,L,w,S,x,M,I,A,k,C;return a.__generator(this,(function(E){switch(E.label){case 0:return e?(n=function e(t){return t&&"opacity"in t?t.opacity*e(t.parent):1}(e.layer||e.sourceLayer),!i.isSome(e.symbol)||i.isSome(t)&&!0===t.ignoreGraphicSymbol?[3,4]:"web-style"!==e.symbol.type?[3,2]:[4,e.symbol.fetchSymbol(i.isSome(t)?t.abortOptions:null)]):[2,void 0];case 1:return o=E.sent(),[3,3];case 2:o=e.symbol.clone(),E.label=3;case 3:return l=o,d.applyColorToSymbol(l,null,n),[2,l];case 4:return[4,(c=i.isSome(t)&&t.renderer||e.get("layer.renderer")||e.get("sourceLayer.renderer")).getSymbolAsync(e)];case 5:return(u=E.sent())?"web-style"!==u.type?[3,7]:[4,u.fetchSymbol(i.isSome(t)?t.abortOptions:null)]:[2,void 0];case 6:return u=E.sent(),[3,8];case 7:u=u.clone(),E.label=8;case 8:return!("visualVariables"in c)||"visualVariables"in c&&!c.visualVariables||"visualVariables"in c&&c.visualVariables&&!c.visualVariables.length?[2,u]:c.arcadeRequiredForVisualVariables&&(i.isNone(t)||i.isNone(t.arcade))?(p=a.__assign({},i.unwrap(t)),h=p,[4,s.loadArcade()]):[3,10];case 9:h.arcade=E.sent(),t=p,E.label=10;case 10:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 11:for(y=E.sent(),m=[],f=[],v=[],g=[],b=0,_=c.visualVariables;b<_.length;b++)switch((L=_[b]).type){case"color":m.push(L);break;case"opacity":f.push(L);break;case"rotation":g.push(L);break;case"size":L.target||v.push(L)}return w=!!m.length&&m[m.length-1],S=w?y.getColor(w,e,t):null,x=!!f.length&&f[f.length-1],M=x?y.getOpacity(x,e,t):null,null!=n&&(M=null!=M?M*n:n),d.applyColorToSymbol(u,S,M),v.length?(I=y.getAllSizes(v,e,t),[4,d.applySizesToSymbol(u,I)]):[3,13];case 12:E.sent(),E.label=13;case 13:for(A=0,k=g;A<k.length;A++)C=k[A],d.applyRotationToSymbol(u,y.getRotationAngle(C,e,t),C.axis);return[2,u]}}))}))}}.apply(null,a))||(e.exports=n)},679:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(813)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0});var n=new a.CIMSymbolRasterizer(null,!0);t.previewCIMSymbol=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var a,i,s,l,o,c,u,d,p,h,y;return r.__generator(this,(function(r){switch(r.label){case 0:return a=t.size,i=t.maxSize,s=t.feature,l=t.fieldMap,o=t.geometryType,c=t.style,u=Math.min(a||22,i||120),d=3,e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(d=1),[4,n.rasterizeCIMSymbolAsync(e,s,l,o,{targetSize:u*d,style:c})];case 1:return p=r.sent(),(h=document.createElement("canvas")).width=p.imageData.width,h.height=p.imageData.height,h.getContext("2d").putImageData(p.imageData,0,0),(y=new Image(h.width/d,h.height/d)).src=h.toDataURL(),[2,y]}}))}))}}.apply(null,a))||(e.exports=n)},680:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(154),r(153),r(171),r(420),r(501),r(502)],void 0===(n=function(e,t,r,a,n,i,s,l){Object.defineProperty(t,"__esModule",{value:!0});var o=document.createElement("canvas");t.previewSymbol2D=function(e,t){var c=t&&t.size?n.pt2px(t.size):null,u=t&&t.maxSize?n.pt2px(t.maxSize):null,d=t&&null!=t.opacity?t.opacity:null,p=t&&null!=t.rotation?t.rotation:null,h=i.getStroke(e),y={shape:null,fill:null,stroke:h};h&&h.width&&(h.width=Math.min(h.width,80));var m=0,f=0;switch(e.type){case"simple-marker":var v=e.style,g=n.pt2px(e.size);switch(m=Math.min(c||g||22,u||120),f=Math.min(c||g||22,u||120),v){case"circle":y.shape={type:"circle",cx:.5*g,cy:.5*g,r:.5*g};break;case"cross":y.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[m,.5*f]},{command:"M",values:[.5*m,0]},{command:"L",values:[.5*m,f]}]};break;case"diamond":y.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[.5*m,0]},{command:"L",values:[m,.5*f]},{command:"L",values:[.5*m,f]},{command:"Z",values:[]}]};break;case"square":y.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};break;case"triangle":y.shape={type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};break;case"x":y.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,f]},{command:"M",values:[m,0]},{command:"L",values:[0,f]}]};break;case"path":y.shape={type:"path",path:e.path||""}}break;case"simple-line":var b=Math.min(c||h&&h.width||22,u||80),_=b>22?2*b:40;h.width=b,m=_,f=b,y.shape={type:"path",path:[{command:"M",values:[0,f]},{command:"L",values:[m,f]}]};break;case"picture-fill":case"simple-fill":m=Math.min(c||22,u||120),f=Math.min(c||22,u||120),y.shape=s.shapes.fill[0];break;case"picture-marker":var L=n.pt2px(e.width),w=n.pt2px(e.height),S=Math.max(L,w),x=L/w;L=x<=1?Math.ceil(S*x):S,w=x<=1?S:Math.ceil(S/x),m=Math.min(c||L||22,u||120),f=Math.min(c||w||22,u||120),y.shape={type:"image",x:-Math.round(m/2),y:-Math.round(f/2),width:m,height:f,src:e.url||""};break;case"text":var M=e,I=M.text||"Aa",A=M.font,k=Math.min(c||n.pt2px(A.size),u||120),C=function(e,t){var r=o.getContext("2d"),a=[];return t&&(t.weight&&a.push(t.weight),t.size&&a.push(t.size+"px"),t.family&&a.push(t.family)),r.font=a.join(" "),r.measureText(e).width}(I,{weight:A.weight,size:k,family:A.family}),E=/[\uE600-\uE6FF]/.test(I);m=E?k:C,f=k;var R=.25*function(e){if(0===e.length)return 0;if(e.length>2){var t=n.px2pt(1),r=parseFloat(e);switch(e.slice(-2)){case"px":return r;case"pt":return r*t;case"in":return 72*r*t;case"pc":return 12*r*t;case"mm":return r*(7.2/2.54)*t;case"cm":return r*(72/2.54)*t}}return parseFloat(e)}((A?k:0).toString());E&&(R+=5),y.shape={type:"text",text:I,x:0,y:R,align:"middle",decoration:A&&A.decoration,rotated:M.rotated,kerning:M.kerning},y.font=A&&{size:k,style:A.style,decoration:A.decoration,weight:A.weight,family:A.family}}if(!y.shape)return a.reject(new r("symbolPreview: renderPreviewHTML2D","symbol not supported."));var V=i.getFill(e),z=V,O=e.color,F=null;return z&&"pattern"===z.type&&O&&"picture-fill"!==e.type?F=i.getPatternUrlWithColor(z.src,O.toCss(!0)).then((function(e){return z.src=e,y.fill=z,y})):(y.fill=V,F=a.resolve(y)),F.then((function(e){return l.renderSymbol([[e]],[m,f],{node:t&&t.node,scale:!0,opacity:d,rotation:p})}))}}.apply(null,a))||(e.exports=n)},681:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(165),r(171)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.previewWebStyleSymbol=function(e,t,n){var i=e.thumbnail&&e.thumbnail.url;return i?r(i,{responseType:"image"}).then((function(e){var t=function(e,t){var r=!/\\.svg$/i.test(e.src)&&t&&t.disableUpsampling,n=Math.max(e.width,e.height),i=t&&null!=t.maxSize?a.pt2px(t.maxSize):120;r&&(i=Math.min(n,i));var s=Math.min(i,t&&null!=t.size?a.pt2px(t.size):n);if(s!==n){var l=0!==e.width&&0!==e.height?e.width/e.height:1;l>=1?(e.width=s,e.height=s/l):(e.width=s*l,e.height=s)}return e}(e.data,n);return n&&n.node?(n.node.appendChild(t),n.node):t})):e.fetchSymbol().then((function(e){return t(e,n)}))}}.apply(null,a))||(e.exports=n)},682:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(180),r(433)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getClusterSizeVariable=function(e,t){if(!(e&&"visualVariables"in e&&e.visualVariables))return null;var n=r.find(e.visualVariables,(function(e){return"size"===e.type})),i=function(e,t){var r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t.levels?t.levels[r]:null}(t,n);return i?new a({field:n.field,minSize:i[2].size,minDataValue:i[2].value,maxSize:i[3].size,maxDataValue:i[3].value}):null}}.apply(null,a))||(e.exports=n)},683:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(182),r(153),r(397),r(161)],void 0===(n=function(e,t,a,n,i,s){Object.defineProperty(t,"__esModule",{value:!0});var l=new n([64,64,64]);function o(e,t){var r=[],a=e.length-1;return 5===e.length?r.push(0,2,4):r.push(0,a),e.map((function(e,n){return r.indexOf(n)>-1?s.createStopLabel(e,n,a,t):null}))}function c(e,t,i){return void 0===i&&(i=l),a.__awaiter(this,void 0,void 0,(function(){var s,l;return a.__generator(this,(function(a){switch(a.label){case 0:return s=new n(i),[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return null!=(l=a.sent().getOpacity(t,e))&&(s.a=l),[2,s]}}))}))}function u(e,t){var r=function(e,t){var r=0,a=t.length-1;return t.some((function(t,n){return e<t.value?(a=n,!0):(r=n,!1)})),{startIndex:r,endIndex:a,weight:(e-t[r].value)/(t[a].value-t[r].value)}}(e,t),a=r.startIndex,i=r.endIndex,s=r.weight;if(a===i)return t[a].color;var l=n.blendColors(t[a].color,t[i].color,s);return new n(l)}t.getRampStops=function(e,t,n){return a.__awaiter(this,void 0,void 0,(function(){var s,l,u,d,p,h,y,m=this;return a.__generator(this,(function(f){switch(f.label){case 0:return s=!1,l=[],u=[],e.stops&&(d=e.stops,l=d.map((function(e){return e.value})),(s=d.some((function(e){return!!e.label})))&&(u=d.map((function(e){return e.label})))),p=l[0],h=l[l.length-1],null==p&&null==h?[2,null]:(y=s?null:o(l,n),[4,i.all(l.map((function(n,i){return a.__awaiter(m,void 0,void 0,(function(){var l,o,d;return a.__generator(this,(function(a){switch(a.label){case 0:return"opacity"!==e.type?[3,2]:[4,c(n,e,t)];case 1:return o=a.sent(),[3,4];case 2:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 3:o=a.sent().getColor(e,n),a.label=4;case 4:return l=o,d=s?u[i]:y[i],[2,{value:n,color:l,label:d}]}}))}))})))]);case 1:return[2,f.sent().reverse()]}}))}))},t.getRampStopsForPointCloud=function(e){var t,r=[],a=[];r=e.map((function(e){return e.value})),(t=e.some((function(e){return!!e.label})))&&(a=e.map((function(e){return e.label})));var n=r[0],i=r[r.length-1];if(null==n&&null==i)return null;var s=t?null:o(r,!1);return r.map((function(r,n){return{value:r,color:u(r,e),label:t?a[n]:s[n]}})).reverse()},t.getColorFromPointCloudStops=u,t.getStrectchRampStops=function(e,t){var r=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(a,i){0===i?r.push({value:t.max,color:new n(a.toColor),label:"high"}):r.push({value:null,color:new n(a.toColor),label:""}),i===e.colorRamps.length-1?r.push({value:t.min,color:new n(a.fromColor),label:"low"}):r.push({value:null,color:new n(a.fromColor),label:""})}));else{var a=void 0,i=void 0;e&&"algorithmic"===e.type?(a=e.fromColor,i=e.toColor):(a=[0,0,0,1],i=[255,255,255,1]),r=[{value:t.max,color:new n(i),label:"high"},{value:t.min,color:new n(a),label:"low"}]}return r}}.apply(null,a))||(e.exports=n)},684:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(783)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getHeatmapRampStops=function(e){var t=e.colorStops,a=t.length-1;if(t&&t[0]){var n=t[a];n&&1!==n.ratio&&((t=t.slice(0)).push(new r({ratio:1,color:n.color})),a++)}return t.map((function(e,t){var r="";return 0===t?r="low":t===a&&(r="high"),{color:e.color,label:r,ratio:e.ratio}})).reverse()}}.apply(null,a))||(e.exports=n)},685:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(420),r(503)],void 0===(n=function(e,t,r,a){Object.defineProperty(t,"__esModule",{value:!0});var n={HH:315,HL:45,LL:135,LH:225},i={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function s(e){if(e){var t,n=e.type;return n.indexOf("3d")>-1?a.getSymbolLayerFill(e.symbolLayers.getItemAt(0)):"simple-line"===n?(t=r.getStroke(e))&&t.color:"simple-marker"!==e.type||"x"!==e.style&&"cross"!==e.style?r.getFill(e):(t=r.getStroke(e))&&t.color}}function l(e){var t=n[e];return e&&null==t&&(t=n.HH),t||0}t.getRelationshipRampElement=function(e){var t=e.focus,r=e.infos,a=e.numClasses,n=i[a],o={};r.forEach((function(e){o[e.value]={label:e.label,fill:s(e.symbol)}}));for(var c=[],u=0;u<a;u++){for(var d=[],p=0;p<a;p++){var h=o[n[u][p]];d.push(h.fill)}c.push(d)}return{type:"relationship-ramp",numClasses:a,focus:t,colors:c,labels:function(e,t){var r=t.HH.label,a=t.LL.label,n=t.HL.label,i=t.LH.label;switch(e){case"HH":return{top:r,bottom:a,left:n,right:i};case"HL":return{top:n,bottom:i,left:a,right:r};case"LL":return{top:a,bottom:r,left:i,right:n};case"LH":return{top:i,bottom:n,left:r,right:a};default:return{top:r,bottom:a,left:n,right:i}}}(t,o),rotation:l(t)}},t.getRotationAngleForFocus=l}.apply(null,a))||(e.exports=n)},686:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(239),r(153),r(434),r(357),r(397),r(161)],void 0===(n=function(e,t,a,n,i,s,l,o){Object.defineProperty(t,"__esModule",{value:!0}),t.REAL_WORLD_MAX_SIZE=30,t.REAL_WORLD_MIN_SIZE=12;var c=[255,255,255],u=[200,200,200],d=[128,128,128];function p(e,t,n,i){return a.__awaiter(this,void 0,void 0,(function(){var l,o,c,u,d;return a.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:if(l=a.sent().getSizeRangeAtScale(e,n,i),o=l&&function(e){for(var t=e.minSize,r=(e.maxSize-t)/4,a=[],n=0;n<5;n++)a.push(t+r*n);return a}(l),!l&&!o)return[2,void 0];c=o.map((function(t){return function(e,t,r){var a=r.minSize,n=r.maxSize,i=t.minDataValue,s=t.maxDataValue;return e<=a?i:e>=n?s:(e-a)/(n-a)*(s-i)+i}(t,e,l)})),c=s.round(c),u=1,a.label=2;case 2:return u<c.length-1?[4,h(e,t,c[u],c[u-1],n,i)]:[3,5];case 3:(d=a.sent())&&(c[u]=d[0],o[u]=d[1]),a.label=4;case 4:return u++,[3,2];case 5:return[2,c]}}))}))}function h(e,t,r,n,i,l){return a.__awaiter(this,void 0,void 0,(function(){var o,c,u,d,p,h,m,f,v,g,b,_,L,w,S,x,M,I,A,k,C,E;return a.__generator(this,(function(a){switch(a.label){case 0:return[4,y(e,t,r,i,l)];case 1:return o=a.sent(),[4,y(e,t,n,i,l)];case 2:c=a.sent(),u=s.numDigits(r),d=u.fractional,p=20,h=u.integer,m=null,f=null,r>0&&r<1&&(m=Math.pow(10,d),r*=m,h=s.numDigits(r).integer),v=h-1,a.label=3;case 3:return v>=0?(g=Math.pow(10,v),b=Math.floor(r/g)*g,_=Math.ceil(r/g)*g,null!=m&&(b/=m,_/=m),L=(b+_)/2,E=s.round([b,L,_],{indexes:[1]}),L=E[1],[4,y(e,t,b,i,l)]):[3,8];case 4:return w=a.sent(),[4,y(e,t,_,i,l)];case 5:return S=a.sent(),[4,y(e,t,L,i,l)];case 6:if(x=a.sent(),M=s.percentChange(o,w,c,null),I=s.percentChange(o,S,c,null),A=s.percentChange(o,x,c,null),k=M.previous<=p,C=I.previous<=p,k&&C&&(M.previous<=I.previous?(k=!0,C=!1):(C=!0,k=!1)),k?f=[b,w]:C?f=[_,S]:A.previous<=p&&(f=[L,x]),f)return[3,8];a.label=7;case 7:return v--,[3,3];case 8:return[2,f]}}))}))}function y(e,t,n,i,s){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(247)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,(0,a.sent().getSize)(e,n,{scale:i,view:s,shape:"simple-marker"===t.type?t.style:null})]}}))}))}t.getRampStops=function(e,r,h,m,f,v){return a.__awaiter(this,void 0,void 0,(function(){var g,b,_,L,w,S,x,M,I,A,k,C,E,R,V,z,O=this;return a.__generator(this,(function(F){switch(F.label){case 0:return g=r.legendOptions,b=g&&g.customValues,_=function(e,t){var r=null,a=null;if("simple"===e.type)r=e.symbol;else if("class-breaks"===e.type){var i=e.classBreakInfos;r=i&&i[0]&&i[0].symbol,a=i.length>1}else"unique-value"===e.type&&(r=(i=e.uniqueValueInfos)&&i[0]&&i[0].symbol,a=i.length>1);return!r||function(e){return!!e&&(n.isSymbol3D(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):-1!==e.type.indexOf("fill"))}(r)?null:(r=r.clone(),(t||a)&&(r.type.indexOf("3d")>-1?function(e){l.isVolumetricSymbol(e)||("line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:d}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:u}:(e.material={color:c},e.outline={color:d,size:1.5})})))}(r):function(e){-1!==e.type.indexOf("line")?e.color=d:(e.color=c,"simple-marker"===e.type&&(e.outline={color:d,width:1.5}))}(r)),r)}(e,h),L=!!_,w=!!b,S=null!=r.minSize&&null!=r.maxSize,x=r.stops&&r.stops.length>1,M=!!r.target,L&&(w||S||x&&!M)?(I=l.isVolumetricSymbol(_),A=null,k=null,C=null,!I||x?[3,1]:(k=s.round([r.minDataValue,r.maxDataValue]),[3,4])):[2,void 0];case 1:return(E=b)?[3,3]:[4,p(r,_,m,f)];case 2:E=F.sent(),F.label=3;case 3:k=E,F.label=4;case 4:return!k&&x&&(k=r.stops.map((function(e){return e.value})),(A=r.stops.some((function(e){return!!e.label})))&&(C=r.stops.map((function(e){return e.label})))),I&&k&&k.length>2&&(k=[k[0],k[k.length-1]]),k?(R=[t.REAL_WORLD_MIN_SIZE,t.REAL_WORLD_MAX_SIZE],V=l.getSymbolOutlineSize(_),z=A?null:function(e,t){var r=e.length-1;return e.map((function(e,a){return o.createStopLabel(e,a,r,t)}))}(k,v),[4,i.all(k.map((function(e,t){return a.__awaiter(O,void 0,void 0,(function(){var i,s,o,c;return a.__generator(this,(function(a){switch(a.label){case 0:return I?(o=R[t],[3,3]):[3,1];case 1:return[4,y(r,_,e,m,f)];case 2:o=a.sent(),a.label=3;case 3:return s=function(e,t){var r=e.clone();if(n.isSymbol3D(r))l.isVolumetricSymbol(r)||r.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if("esri.symbols.SimpleMarkerSymbol"===r.declaredClass)r.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(r)){var a=r.width,i=r.height;r.height=t,r.width=t*(a/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(r)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)&&r.font&&(r.font.size=t):r.width=t;return r}(_,i=o),c=A?C[t]:z[t],[2,{value:e,symbol:s,label:c,size:i,outlineSize:V}]}}))}))})))]):[2,null];case 5:return[2,F.sent().reverse()]}}))}))}}.apply(null,a))||(e.exports=n)},687:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(258),r(167),r(171),r(151),r(396),r(188),r(504),r(505),r(183)],void 0===(n=function(e,t,r,a,n,i,s,l,o,c,u,d){var p="esri-legend--card__image-label",h="esri-legend--card__layer-caption",y="esri-legend--card__layer-row",m="esri-legend--card__ramp-label",f="esri-legend--card__section",v="esri-legend--card__service",g="esri-legend--card__symbol-row",b="esri-legend--card__service-caption-container",_="esri-legend--card__size-ramp-container",L="esri-widget__heading",w="esri-legend--card__",S=window.devicePixelRatio;return function(e){function t(t,r){var a=e.call(this,t,r)||this;return a._handles=new n,a._hasIndicators=!1,a._selectedSectionName=null,a._sectionNames=[],a._sectionMap=new Map,a.activeLayerInfos=null,a.layout="stack",a.messages=null,a.messagesCommon=null,a.type="card",a.view=null,a}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own([this.watch("activeLayerInfos",(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)}))])},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null},t.prototype.render=function(){var e,t=this;this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=768||"stack"===this.layout;var r=this.activeLayerInfos,n=r&&r.toArray().map((function(e){return t._renderLegendForLayer(e)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var i=this._sectionNames.length,s=this._sectionNames.map((function(e,r){var n,s=a.substitute(t.messagesCommon.pagination.pageText,{index:r+1,total:i});return d.tsx("div",{key:e,"aria-label":s,title:s,tabIndex:0,onclick:t._selectSection,onkeydown:t._selectSection,bind:t,class:t.classes("esri-legend--card__carousel-indicator",(n={},n["esri-legend--card__carousel-indicator--activated"]=t._selectedSectionName===e,n)),"data-section-name":e})})),l=this._hasIndicators&&i>1?d.tsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},s):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):n&&n.length?n:null,c=((e={})["esri-legend--stacked"]=this._hasIndicators,e);return d.tsx("div",{class:this.classes("esri-legend--card",c)},l,o||d.tsx("div",{class:"esri-legend--card__message"},this.messages.noLegend))},t.prototype._selectSection=function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)},t.prototype._watchForSectionChanges=function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var r="activeLayerInfo-"+e.layer.uid+"-version-change";t._handles.remove(r),t._watchForSectionChanges(e.children),t._handles.add(e.watch("version",(function(){return t._generateSectionNames()})),r)}));var r="activeLayerInfos-collection-change";this._handles.remove(r),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),r)}},t.prototype._generateSectionNames=function(){this._sectionNames.length=0,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)},t.prototype._generateSectionNamesForActiveLayerInfo=function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(r,a){t._sectionNames.push(""+w+e.layer.uid+"-type-"+r.type+"-"+a)}))},t.prototype._renderLegendForLayer=function(e){var t,r=this;if(!e.ready)return null;if(e.children.length){var a=e.children.map((function(e){return r._renderLegendForLayer(e)})).toArray();return d.tsx("div",{key:e.layer.uid,class:this.classes(v,"esri-legend--card__group-layer")},d.tsx("div",{class:b},e.title),a)}var n=e.legendElements;if(n&&!n.length)return null;var i=n.some((function(e){return"relationship-ramp"===e.type})),s=n.map((function(t,a){return r._renderLegendForElement(t,e,a,i)})).filter((function(e){return!!e}));if(!s.length)return null;var l=((t={})["esri-legend--card__group-layer-child"]=!!e.parent,t);return d.tsx("div",{key:e.layer.uid,class:this.classes(v,l)},d.tsx("div",{class:b},d.tsx("div",{class:"esri-legend--card__service-caption-text"},e.title)),d.tsx("div",{class:"esri-legend--card__service-content"},s))},t.prototype._renderLegendForElement=function(e,t,r,a){var n,i=this;void 0===a&&(a=!1);var s="color-ramp"===e.type,l="opacity-ramp"===e.type,o="size-ramp"===e.type,p=t.layer,y=e.title,m=null;if("string"==typeof y)m=y;else if(y){var v=u.getTitle(this.messages,y,s||l);m=y.title?y.title+" ("+v+")":v}var b=""+w+p.uid+"-type-"+e.type+"-"+r,_=this._hasIndicators?d.tsx("div",null,d.tsx("h3",{class:this.classes(L,"esri-legend--card__carousel-title")},t.title),d.tsx("h4",{class:this.classes(L,h)},m)):m?d.tsx("h4",{class:this.classes(L,h)},m):null,S=null;if("symbol-table"===e.type){var x=e.infos.map((function(r,a){return i._renderLegendForElementInfo(r,t,e.legendType,a)})).filter((function(e){return!!e}));if(x.length){var M=x[0].properties.classes&&x[0].properties.classes[g],I=((n={})["esri-legend--card__label-container"]=!M&&!a,n["esri-legend--card__relationship-label-container"]=a,n);S=d.tsx("div",{key:b,class:f},_,d.tsx("div",{class:this.classes(I)},x))}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?S=d.tsx("div",{key:b,class:f},_,this._renderLegendForRamp(e,p.opacity)):o?S=d.tsx("div",{key:b,class:f},_,this._renderSizeRamp(e,p.opacity)):"relationship-ramp"===e.type&&(S=d.tsx("div",{key:b,class:this.classes(f,"esri-legend--card__relationship-section")},_,c.renderRelationshipRamp(e,this.id,p.opacity)));return S?(this._sectionMap.set(b,S),S):null},t.prototype._renderLegendForElementInfo=function(e,t,r,a){var n,i,s,l,o,c=t.layer;if(e.type)return this._renderLegendForElement(e,t,a);var h=u.isImageryStretchedLegend(c,r);if(e.symbol&&e.preview){if(-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return d.tsx("div",{key:a,bind:e.preview,afterCreate:u.attachToNode});var m=((n={})["esri-legend--card__symbol-cell"]=this._hasIndicators,n);return d.tsx("div",{key:a,class:this.classes(y,(i={},i[g]=this._hasIndicators,i))},d.tsx("div",{class:this.classes(m),bind:e.preview,afterCreate:u.attachToNode}),d.tsx("div",{class:this.classes(p,(s={},s["esri-legend--card__label-cell"]=this._hasIndicators,s))},u.getTitle(this.messages,e.label,!1)||""))}var f=255,v=255,b=255,_=0,L=255,w=255,S=255,x=0,M=e.symbol.color&&e.symbol.color.a,I=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;M&&(f=e.symbol.color.r,v=e.symbol.color.g,b=e.symbol.color.b,_=e.symbol.color.a*c.opacity),I&&(L=e.symbol.outline.color.r,w=e.symbol.outline.color.g,S=e.symbol.outline.color.b,x=e.symbol.outline.color.a*c.opacity);var A=null===(o=null===(l=e.symbol.color)||void 0===l?void 0:l.isBright)||void 0===o||o,k=A?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",C={background:M?"rgba("+f+", "+v+", "+b+", "+_+")":"none",color:A?"black":"white",textShadow:"-1px -1px 0 "+k+",\n                                              1px -1px 0 "+k+",\n                                              -1px 1px 0 "+k+",\n                                              1px 1px 0 "+k,border:I?"1px solid rgba("+L+", "+w+", "+S+", "+x+")":"none"};return d.tsx("div",{key:a,class:y},d.tsx("div",{class:"esri-legend--card__label-element",styles:C}," ",e.label," "))}if(e.src){var E=this._renderImage(e,c,h);return d.tsx("div",{key:a,class:y},E,d.tsx("div",{class:p},e.label||""))}},t.prototype._renderImage=function(e,t,r){var a,n=e.label,i=e.src,s=e.opacity,l=((a={})["esri-legend--card__imagery-layer-image--stretched"]=r,a["esri-legend--card__symbol"]=!r,a),o={opacity:""+(null!=s?s:t.opacity)};return d.tsx("img",{alt:u.getTitle(this.messages,n,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(l),styles:o})},t.prototype._renderSizeRampLines=function(e){var t=e.infos,r=t[0],a=t[t.length-1],n=r.symbol,s=this._hasIndicators,l=i.pt2px(r.size+r.outlineSize)*S,o=i.pt2px(a.size+a.outlineSize)*S,c=s?l:l+50*S,p=s?l/2+50*S:l,h=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===r||"cone"===r||"tetrahedron"===r}return"triangle"===e.style}}(n),y=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1),a=r.resource&&r.resource.primitive;return"circle"===a||"cross"===a||"kite"===a||"sphere"===a||"cube"===a||"diamond"===a}var n=e.style;return"circle"===n||"diamond"===n||"cross"===n}}(n),m=document.createElement("canvas");m.width=c,m.height=p,m.style.width=m.width/S+"px",m.style.height=m.height/S+"px";var f=m.getContext("2d");if(s){f.beginPath();var v=c/2-o/2,g=p;f.moveTo(0,0),f.lineTo(v,g);var b=c,_=c/2+o/2,L=p;f.moveTo(b,0),f.lineTo(_,L)}else{f.beginPath();var w=p/2-o/2,x=c;f.moveTo(0,w),f.lineTo(x,0);var M=p/2+o/2,I=c,A=p;f.moveTo(0,M),f.lineTo(I,A)}return f.strokeStyle="#ddd",f.stroke(),d.tsx("div",{bind:m,afterCreate:u.attachToNode,styles:s?{display:"flex",marginTop:"-"+(h?0:y?l/2:0)+"px",marginBottom:"-"+(h?o:y?o/2:0)+"px"}:{display:"flex",marginRight:"-"+(h?0:y?l/2:0)+"px",marginLeft:"-"+(h?0:y?o/2:0)+"px"}})},t.prototype._renderSizeRamp=function(e,t){var r,a=e.infos,n=a[0].label,i=a[a.length-1].label,s=a[0].preview,l=a[a.length-1].preview,o=this._hasIndicators,c={"flex-direction":o?"column":"row-reverse"};s&&((s=s.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var p={opacity:null!=t?""+t:""};return d.tsx("div",{class:this.classes(y,(r={},r["esri-legend--card__size-ramp-row"]=o,r))},d.tsx("div",{class:m},o?n:i),d.tsx("div",{class:_,styles:c},d.tsx("div",{bind:s,afterCreate:u.attachToNode,class:"esri-legend--card__size-ramp-preview",styles:p}),this._renderSizeRampLines(e),d.tsx("div",{bind:l,afterCreate:u.attachToNode,class:_,styles:p})),d.tsx("div",{class:m},o?i:n))},t.prototype._renderLegendForRamp=function(e,t){var r=e.infos,a="heatmap-ramp"===e.type,n=r.length-1,i=n>2&&!a?25*n:100,s=i+20,o=r.slice(0).reverse();o.forEach((function(e,t){e.offset=a?e.ratio:t/n}));var c=o.length-1,u=o.length%2!=0&&o[o.length/2|0],p=u&&d.tsx("div",{class:"esri-legend--card__interval-separators-container"},d.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),d.tsx("div",{class:m},u.label)),h=r[r.length-1].label,f=r[0].label,v=null;null!=t&&(v="opacity: "+t);var g=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:o[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:i,height:25},fill:{type:"linear",x1:10,y1:0,x2:i+10,y2:0,colors:o},stroke:{width:0}},{shape:{type:"path",path:"M"+(i+10)+" 0 L"+s+" 12.5 L"+(i+10)+" 25 Z"},fill:o[c].color,stroke:{width:0}}]],b=l.renderSVG(g,s,25),_=this.messages;return d.tsx("div",{class:y},d.tsx("div",{class:m},a?_[h]:h),d.tsx("div",{class:"esri-legend--card__symbol-container"},d.tsx("div",{style:v},b),p),d.tsx("div",{class:m},a?_[f]:f))},r.__decorate([d.renderable(),s.property()],t.prototype,"activeLayerInfos",void 0),r.__decorate([s.property()],t.prototype,"layout",void 0),r.__decorate([s.property(),d.renderable(),d.messageBundle("esri/widgets/Legend/t9n/Legend")],t.prototype,"messages",void 0),r.__decorate([s.property(),d.renderable(),d.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([s.property()],t.prototype,"view",void 0),r.__decorate([d.accessibleHandler()],t.prototype,"_selectSection",null),r.__decorate([s.subclass("esri.widgets.Legend.styles.Card")],t)}(o)}.apply(null,a))||(e.exports=n)},688:function(e,t,r){var a,n;a=[r.dj.c(e.i),t,r(117),r(258),r(151),r(188),r(504),r(505),r(183)],void 0===(n=function(e,t,r,a,n,i,s,l,o){var c="esri-legend__service",u="esri-legend__layer-row",d="esri-legend__layer-cell esri-legend__layer-cell--info",p="esri-legend__imagery-layer-info--stretched",h="esri-legend__layer-cell esri-legend__layer-cell--symbols",y="esri-legend__symbol";return function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.activeLayerInfos=null,a.messages=null,a.type="classic",a}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return o.tsx("div",null,r&&r.length?r:o.tsx("div",{class:"esri-legend__message"},this.messages.noLegend))},t.prototype._renderLegendForLayer=function(e){var t,r=this;if(!e.ready)return null;var a=!!e.children.length,n="esri-legend__"+e.layer.uid+"-version-"+e.version,i=e.title?o.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},e.title):null;if(a){var s=e.children.map((function(e){return r._renderLegendForLayer(e)})).toArray();return o.tsx("div",{key:n,class:this.classes(c,"esri-legend__group-layer")},i,s)}var l=e.legendElements;if(l&&!l.length)return null;var u=l.map((function(t){return r._renderLegendForElement(t,e.layer)})).filter((function(e){return!!e}));if(!u.length)return null;var d=((t={})["esri-legend__group-layer-child"]=!!e.parent,t);return o.tsx("div",{key:n,class:this.classes(c,d)},i,o.tsx("div",{class:"esri-legend__layer"},u))},t.prototype._renderLegendForElement=function(e,t,r){var a,n=this,i="color-ramp"===e.type,c="opacity-ramp"===e.type,u="size-ramp"===e.type,d=null;if("symbol-table"===e.type||u){var p=e.infos.map((function(r){return n._renderLegendForElementInfo(r,t,u,e.legendType)})).filter((function(e){return!!e}));p.length&&(d=o.tsx("div",{class:"esri-legend__layer-body"},p))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?d=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type&&(d=s.renderRelationshipRamp(e,this.id,t.opacity));if(!d)return null;var h=e.title,y=null;if("string"==typeof h)y=h;else if(h){var m=l.getTitle(this.messages,h,i||c);y=l.isRendererTitle(h,i||c)&&h.title?h.title+" ("+m+")":m}var f=r?"esri-legend__layer-child-table":"esri-legend__layer-table",v=y?o.tsx("div",{class:"esri-legend__layer-caption"},y):null,g=((a={})["esri-legend__layer-table--size-ramp"]=u||!r,a);return o.tsx("div",{class:this.classes(f,g)},v,d)},t.prototype._renderLegendForRamp=function(e,t){var r=this,a=e.infos,n="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,s="stretch-ramp"===e.type,c=e.preview,p=n?"esri-legend__opacity-ramp":"";c.className="esri-legend__color-ramp "+p,null!=t&&(c.style.opacity=t.toString());var y=a.map((function(e){return o.tsx("div",{class:e.label?"esri-legend__ramp-label":null},i?r.messages[e.label]:s?r._getStretchStopLabel(e):e.label)})),m={height:c.style.height};return o.tsx("div",{class:u},o.tsx("div",{class:h,styles:{width:"24px"}},o.tsx("div",{class:"esri-legend__ramps",bind:c,afterCreate:l.attachToNode})),o.tsx("div",{class:d},o.tsx("div",{class:"esri-legend__ramp-labels",styles:m},y)))},t.prototype._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+a.formatNumber(e.value,{style:"decimal"}):""},t.prototype._renderLegendForElementInfo=function(e,t,r,a){var n,i;if(e.type)return this._renderLegendForElement(e,t,!0);var s=null,c=l.isImageryStretchedLegend(t,a);if(e.symbol&&e.preview?s=o.tsx("div",{class:y,bind:e.preview,afterCreate:l.attachToNode}):e.src&&(s=this._renderImage(e,t,c)),!s)return null;var m=((n={})[p]=c,n),f=((i={})[p]=c,i["esri-legend__size-ramp"]=!c&&r,i);return o.tsx("div",{class:u},o.tsx("div",{class:this.classes(h,f)},s),o.tsx("div",{class:this.classes(d,m)},l.getTitle(this.messages,e.label,!1)||""))},t.prototype._renderImage=function(e,t,r){var a,n=e.label,i=e.src,s=e.opacity,c=((a={})["esri-legend__imagery-layer-image--stretched"]=r,a[y]=!r,a),u={opacity:""+(null!=s?s:t.opacity)};return o.tsx("img",{alt:l.getTitle(this.messages,n,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(c),styles:u})},r.__decorate([o.renderable(),n.property()],t.prototype,"activeLayerInfos",void 0),r.__decorate([n.property(),o.renderable(),o.messageBundle("esri/widgets/Legend/t9n/Legend")],t.prototype,"messages",void 0),r.__decorate([n.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([n.subclass("esri.widgets.Legend.styles.Classic")],t)}(i)}.apply(null,a))||(e.exports=n)}}]);
//# sourceMappingURL=6.js.map