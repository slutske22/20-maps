(function(){var e={"esri/views/layers/support/popupUtils":281,"esri/renderers/support/clickToleranceUtils":321,"esri/views/3d/layers/support/projectExtentUtils":364,"esri/layers/support/ExportImageParameters":378,"esri/views/support/drapedUtils":385,"esri/views/3d/webgl-engine/shaders/ImageMaterial.glsl":404,"esri/views/3d/layers/DynamicLayerView3D":568,"esri/views/3d/layers/support/overlayImageUtils":569,"esri/views/3d/webgl-engine/materials/ImageMaterial":570,"esri/views/3d/webgl-engine/shaders/ImageMaterialTechnique":571,"esri/views/layers/MapImageLayerView":1049,"esri/views/3d/layers/MapImageLayerView3D":2141},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{1049:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(154),r(152),r(153),r(151),r(321),r(246),r(281)],void 0===(i=function(e,t,r,a,i,n,o,s,l,u){Object.defineProperty(t,"__esModule",{value:!0}),t.MapImageLayerView=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.fetchPopupFeatures=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,l,c,p,d,h,y=this;return r.__generator(this,(function(f){switch(f.label){case 0:return o=this.layer,e?(l=this.get("view.scale"),c=[],p=function(e){return r.__awaiter(y,void 0,void 0,(function(){var a,n,o;return r.__generator(this,(function(s){return a=0===e.minScale||l<=e.minScale,n=0===e.maxScale||l>=e.maxScale,e.visible&&a&&n&&(e.sublayers?e.sublayers.forEach(p):e.popupEnabled&&(o=u.getFetchPopupTemplate(e,r.__assign(r.__assign({},t),{defaultPopupTemplateEnabled:!1})),i.isSome(o)&&c.push({sublayer:e,popupTemplate:o}))),[2]}))}))},d=o.sublayers.toArray().map(p),[4,n.all(d)]):[2,n.reject(new a("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o}))];case 1:return f.sent(),h=c.map((function(a){var n=a.sublayer,o=a.popupTemplate;return r.__awaiter(y,void 0,void 0,(function(){var a,l,c,p,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.load().catch((function(){}))];case 1:return r.sent(),a=n.createQuery(),l=i.isSome(t)?t.event:null,c=s.calculateTolerance({renderer:n.renderer,event:l}),p=this.createFetchPopupFeaturesQueryGeometry(e,c),a.geometry=p,d=a,[4,u.getRequiredFields(n,o)];case 2:return d.outFields=r.sent(),[4,this._loadArcadeModules(o)];case 3:return(h=r.sent())&&h.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=p.width/c),[4,n.queryFeatures(a)];case 4:return[2,r.sent().features]}}))}))})),[4,n.eachAlways(h)];case 2:return[2,f.sent().reduce((function(e,t){return t.value?r.__spreadArrays(e,t.value):e}),[]).filter((function(e){return null!=e}))]}}))}))},t.prototype.canResume=function(){var t,r;return!(!e.prototype.canResume.call(this)||null!==(r=null===(t=this.imageParameters)||void 0===t?void 0:t.timeExtent)&&void 0!==r&&r.isEmpty)},t.prototype._loadArcadeModules=function(e){if(e.get("expressionInfos.length"))return l.loadArcade()},r.__decorate([o.property()],t.prototype,"imageParameters",void 0),r.__decorate([o.property()],t.prototype,"layer",void 0),r.__decorate([o.property({dependsOn:["imageParameters.timeExtent"]})],t.prototype,"suspended",void 0),r.__decorate([o.subclass("esri.views.layers.MapImageLayerView")],t)}(e)}}.apply(null,a))||(e.exports=i)},2141:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(151),r(378),r(568),r(1049),r(385)],void 0===(i=function(e,t,r,a,i,n,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateWhenStationary=!0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.imageParameters=new i.ExportImageParameters({view:this.view,layer:this.layer}),this.updatingHandles.add(this.imageParameters,"version",(function(){e.updatingHandles.addPromise(e.refreshDebounced())}))},t.prototype.destroy=function(){this.imageParameters&&(this.imageParameters.layer=null,this.imageParameters.destroy(),this.imageParameters=null)},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return s.createQueryGeometry(e,t,this.view)},t.prototype.getFetchOptions=function(){return{timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp}},r.__decorate([a.subclass("esri.views.3d.layers.MapImageLayerView3D")],t)}(o.MapImageLayerView(n))}.apply(null,a))||(e.exports=i)},281:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(296),r(152),r(191)],void 0===(i=function(e,t,r,a,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),r.__awaiter(this,void 0,void 0,(function(){var o,s,l,u,c,p,d,h,y;return r.__generator(this,(function(f){switch(f.label){case 0:return i.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return o=f.sent(),s=t.lastEditInfoEnabled,l=e.objectIdField,u=e.typeIdField,c=e.globalIdField,p=e.relationships,a.includes(o,"*")?[2,["*"]]:s?[4,n.getFeatureEditFields(e)]:[3,3];case 2:return h=f.sent(),[3,4];case 3:h=[],f.label=4;case 4:return d=h,y=n.fixFields(e.fields,r.__spreadArrays(o,d)),u&&y.push(u),y&&l&&n.hasField(e.fields,l)&&-1===y.indexOf(l)&&y.push(l),y&&c&&n.hasField(e.fields,c)&&-1===y.indexOf(c)&&y.push(c),p&&p.forEach((function(t){var r=t.keyField;y&&r&&n.hasField(e.fields,r)&&-1===y.indexOf(r)&&y.push(r)})),[2,y]}}))}))},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:i.isSome(t)&&t.defaultPopupTemplateEnabled&&i.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,a))||(e.exports=i)},321:function(e,t,r){var a,i;a=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,a=0;a<e.length;a++){var i=e[a].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var n="visualVariables"in t?function(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,i=t.minSize;return(a(r,e)+a(i,e))/2})),i=0,n=r.length;if(0===n)return e;for(var o=0;o<n;o++)i+=r[o];var s=Math.floor(i/n);return Math.max(s,e)}(i,t.visualVariables):i;if("simple"===t.type)return r(n,t.symbol);if("unique-value"===t.type){var o=n;return t.uniqueValueInfos.forEach((function(e){o=r(o,e.symbol)})),o}if("class-breaks"===t.type){var s=n;return t.classBreakInfos.forEach((function(e){s=r(s,e.symbol)})),s}return t.type,n}}.apply(null,a))||(e.exports=i)},364:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(153),r(197),r(359)],void 0===(i=function(e,t,r,a,i){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,n=e.layer.fullExtent,o=n&&n.spatialReference;return o?o.equals(t)?r.resolve(n.clone()):a.canProject(o,t)?r.resolve(a.project(n,t)):e.view.state.isLocal?i.projectGeometry(n,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,a))||(e.exports=i)},378:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(158),r(151),r(439),r(235),r(490)],void 0===(i=function(e,t,r,a,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._scale=null,t.view=null,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map((function(e){return e.toExportImageJSON()}));return e.length?JSON.stringify(e):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasDynamicLayers",{get:function(){return this.layer&&n.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layer",{set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this._layerHandles&&(this._layerHandles.forEach((function(e){return e.remove()})),this._layerHandles.length=0),e&&(this._layerHandles=[e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(l[e.propertyName])}))]))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layers",{get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerDefs",{get:function(){var e=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression}));return e.length?JSON.stringify(e.reduce((function(e,t){return e[t.id]=t.definitionExpression,e}),{})):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(e){this.view||(this._scale=e,this.notifyChange("scale"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){this.layers,this.layerDefs,this.dynamicLayers,this.timeExtent;var e=this.layer;return e&&(e.dpi,e.imageFormat,e.imageTransparency,e.gdbVersion),(this._get("version")||0)+1},set:function(e){this._set("version",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibleSublayers",{get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers,a=function(r){var i=e.scale,n=0===i,o=0===r.minScale||i<=r.minScale,s=0===r.maxScale||i>=r.maxScale;r.visible&&(n||o&&s)&&(r.sublayers?r.sublayers.forEach(a):t.unshift(r))};r&&r.forEach(a);var i=this._get("visibleSublayers");return!i||i.length!==t.length||i.some((function(e,r){return t[r]!==e}))?t:i},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=r.__assign(r.__assign({},t),{layers:this.layers,layerDefs:this.layerDefs}),t},r.__decorate([i.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],t.prototype,"dynamicLayers",null),r.__decorate([i.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],t.prototype,"hasDynamicLayers",null),r.__decorate([i.property()],t.prototype,"layer",null),r.__decorate([i.property({readOnly:!0,dependsOn:["visibleSublayers"]})],t.prototype,"layers",null),r.__decorate([i.property({readOnly:!0,dependsOn:["visibleSublayers"]})],t.prototype,"layerDefs",null),r.__decorate([i.property({type:Number,dependsOn:["view.scale"]})],t.prototype,"scale",null),r.__decorate([i.property(o.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),r.__decorate([i.property({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],t.prototype,"version",null),r.__decorate([i.property({type:s})],t.prototype,"view",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],t.prototype,"visibleSublayers",null),r.__decorate([i.subclass("esri.layers.mixins.ExportImageParameters")],t)}(a);t.ExportImageParameters=u}.apply(null,a))||(e.exports=i)},385:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(159),r(152),r(200),r(321)],void 0===(i=function(e,t,r,a,i,n){function o(e,t,a,n){var o;if(void 0===n&&(n=new r.Extent),"2d"===a.type)o=t*a.resolution;else if("3d"===a.type){var s=a.basemapTerrain,l=s.overlayManager,u=l?l.overlayPixelSizeInMapUnits(e):1;o=s&&!s.spatialReference.equals(a.spatialReference)?i.getMetersPerUnitForSR(s.spatialReference)/i.getMetersPerUnitForSR(a.spatialReference):t*u}var c=e.x-o,p=e.y-o,d=e.x+o,h=e.y+o,y=a.spatialReference;return n.xmin=Math.min(c,d),n.ymin=Math.min(p,h),n.xmax=Math.max(c,d),n.ymax=Math.max(p,h),n.spatialReference=y,n}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=o,t.intersectsDrapedGeometry=function(e,t,r){var i=r.toMap(e);return a.isNone(i)?null:o(i,n.calculateTolerance(),r,s).intersects(t)?i:null};var s=new r.Extent}.apply(null,a))||(e.exports=i)},404:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(223),r(256),r(319),r(175),r(252)],void 0===(i=function(e,t,r,a,i,n,o,s){var l,u;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = position;\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(a.Slice,e),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),t.fragment.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "])),o.glsl.float(n.defaultMaskAlphaCutoff))),t}}.apply(null,a))||(e.exports=i)},568:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(226),r(156),r(153),r(153),r(157),r(151),r(184),r(173),r(308),r(569),r(364),r(261),r(451),r(358),r(570),r(218),r(285)],void 0===(i=function(e,t,r,a,i,n,o,s,l,u,c,p,d,h,y,f,m,g,v,_){var b=i.getLogger("esri.views.3d.layers.DynamicLayerView3D"),x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.drapeSourceType=0,t.hasDraped=!0,t.fullExtentInLocalViewSpatialReference=null,t.maximumDataResolution=null,t._images=new Array,t._extents=new Array,t._overlayExtents=new Array,t.updateWhenStationary=!0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(h.toViewIfLocal(this).then((function(t){return e._set("fullExtentInLocalViewSpatialReference",t)}))),this.updatingHandles.add(this,"suspended",(function(){return e._suspendedChangeHandler()})),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((function(){e._isScaleRangeActive()&&e.notifyChange("suspended")}),(function(){}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,"scaleRangeId",(function(){return e.notifyChange("suspended")})),"local"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,"extent",(function(){return e._overlayExtents.forEach((function(t,r){return e._updateImageExtent(r)}))}))},t.prototype.destroy=function(){this.clear()},t.prototype.setDrapingExtent=function(e,t,r,a,i,n){this._overlayExtents[e]={extent:c.create(t),spatialReference:r,resolution:a,renderLocalOrigin:i,pixelRatio:n},this._updateImageExtent(e)},t.prototype._updateImageExtent=function(e){var t=this._overlayExtents[e],r=this._clippedExtent(t.extent,w),a=d.computeImageExportSize(t.extent,r,t.resolution),i=t.pixelRatio*this.view.pixelRatio;if("imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var o=this.layer.imageMaxWidth,s=this.layer.imageMaxHeight;if(a.width>o){var l=o/a.width;a.height=Math.floor(a.height*l),a.width=o,i*=l}a.height>s&&(l=s/a.height,a.width=Math.floor(a.width*l),a.height=s,i*=l)}var u=this._extents[e];u&&c.equals(u.extent,r)&&!this._imageSizeDiffers(r,u.imageSize,a)||(this._extents[e]={extent:c.create(r),spatialReference:t.spatialReference,imageSize:a,pixelRatio:i},this.suspended||this._fetch(e).catch((function(e){n.isAbortError(e)||b.error(e)})))},t.prototype.clear=function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)},t.prototype.doRefresh=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a;return r.__generator(this,(function(r){switch(r.label){case 0:if(this.suspended)return[2];for(t=[],a=0;a<this._extents.length;a++)this._extents[a]&&t.push(this._fetch(a,e));return[4,n.eachAlways(t)];case 1:return r.sent(),[2]}}))}))},t.prototype.canResume=function(){if(!e.prototype.canResume.call(this))return!1;if(this._isScaleRangeLayer()){var t=this.layer,r=t.minScale,a=t.maxScale;if(r>0||a>0){var i=this.view.scale;if(i<a||r>0&&i>r)return!1}}return!0},t.prototype.isUpdating=function(){return this._images.some((function(e){return!!e.loadingPromise}))},t.prototype.processResult=function(e,t,a){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t),[2]}))}))},t.prototype.findExtentInfoAt=function(e){for(var t=0,r=this._extents;t<r.length;t++){var a=r[t],i=a.extent;if(new u(i[0],i[1],i[2],i[3],a.spatialReference).contains(e))return a}return null},t.prototype.getFetchOptions=function(){},t.prototype.redraw=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i=this;return r.__generator(this,(function(n){switch(n.label){case 0:return[4,a.forEach(this._images,(function(a,n){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return a?[4,e(a,t)]:[2];case 1:return r.sent(),this._createStageObjects(n,a.image),this.emit("draped-data-change"),[2]}}))}))}))];case 1:return n.sent(),[2]}}))}))},t.prototype._imageSizeDiffers=function(e,t,r){if(!this.maximumDataResolution)return!0;if(y.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;var a=c.width(e)/this.maximumDataResolution.x,i=c.height(e)/this.maximumDataResolution.y,n=a/t.width,o=i/t.height,s=a/r.width,l=i/r.height,u=Math.abs(n-s),p=Math.abs(o-l);return u>1.5||p>1.5},t.prototype._fetch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var a,i,s,l,p,d,h,y,f,m=this;return r.__generator(this,(function(g){switch(g.label){case 0:return this.suspended?[2]:(a=this._overlayExtents[e],i=this._extents[e],s=i.extent,l=new u(s[0],s[1],s[2],s[3],i.spatialReference),this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:c.create(s)}),(p=this._images[e]).loadingAbortController&&(p.loadingAbortController.abort(),p.loadingAbortController=null),0===l.width||0===l.height?(this._clearImage(e),[2]):(d=n.createAbortController(),p.loadingAbortController=d,n.onAbort(t,(function(){return d.abort()})),h=d.signal,y=this._waitFetchReady(h).then((function(){var e=r.__assign(r.__assign({requestAsImageElement:!0,pixelRatio:a.pixelRatio},m.getFetchOptions()),{signal:h}),t=i.imageSize,n=t.height,o=t.width;return m.layer.fetchImage(l,o,n,e)})).then((function(e){if(o.isAborted(h))throw b.warnOnce("A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true."),o.createAbortError();return m.processResult(p,e)})),p.loadingPromise=y,n.always(y,(function(){y===p.loadingPromise&&(p.loadingPromise=null,p.loadingAbortController=null)})),f=y.then((function(){c.set(p.renderExtent,s),m._createStageObjects(e,p.image),m.notifyChange("updating"),m.emit("draped-data-change")})).catch((function(e){throw e&&!n.isAbortError(e)&&b.error(e),m.notifyChange("updating"),e})),this.notifyChange("updating"),[4,f]));case 1:return g.sent(),[2]}}))}))},t.prototype.notifyGraphicUpdate=function(){},t.prototype._clearImage=function(e){var t=this._images[e],r=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(r.remove(4,t.texture.id),t.texture=null),t.material&&(r.remove(3,t.material.id),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)},t.prototype._createStageObjects=function(e,t){var r=this.view._stage,a=this._images[e];a.texture&&(r.remove(4,a.texture.id),a.texture=null),t?(a.texture=new m(t,"dynamicLayer",{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),r.add(4,a.texture)):a.material&&(r.remove(3,a.material.id),a.material=null),!a.material&&a.texture?(a.material=new g({transparent:!0,textureId:a.texture.id},"dynamicLayer"),r.add(3,a.material)):a.material&&t&&a.material.setParameterValues({textureId:a.texture.id});var i=this.view.basemapTerrain.overlayManager.renderer;if(a.material){var n=void 0,o=this._overlayExtents[e].renderLocalOrigin;if(0===e)n=d.createGeometryForExtent(a.renderExtent,-1);else{if(1!==e)return void console.error("DynamicLayerView3D._createStageObjects: Invalid extent idx");var s=this._images[0].renderExtent;if(!s)return;n=d.createOuterImageGeometry(s,a.renderExtent,-1)}var l=new f(n);l.material=a.material,l.origin=o,i.addGeometries([l],this,2),a.rendergeometry&&i.removeGeometries([a.rendergeometry],this,2),a.rendergeometry=l}else a.rendergeometry&&(i.removeGeometries([a.rendergeometry],this,2),a.rendergeometry=null)},t.prototype._isScaleRangeLayer=function(){return"minScale"in this.layer&&"maxScale"in this.layer},t.prototype._isScaleRangeActive=function(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)},t.prototype._clippedExtent=function(e,t){if("local"!==this.view.viewingMode)return c.set(t,e);var r=this.view.basemapTerrain,a=r.extent;return r.ready&&a?c.intersection(e,a,t):c.set(t,e)},t.prototype._suspendedChangeHandler=function(){this.suspended?(this.clear(),this.emit("draped-data-change")):this.refresh()},t.prototype._waitFetchReady=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.updateWhenStationary?[4,s.whenOnce(this.view,"stationary",e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},r.__decorate([l.property()],t.prototype,"layer",void 0),r.__decorate([l.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r.__decorate([l.property({type:Boolean})],t.prototype,"hasDraped",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"fullExtentInLocalViewSpatialReference",void 0),r.__decorate([l.property()],t.prototype,"updating",void 0),r.__decorate([l.subclass("esri.views.3d.layers.DynamicLayerView3D")],t)}(_.RefreshableLayerView(p.LayerView3D(v))),w=c.create();return x}.apply(null,a))||(e.exports=i)},569:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(173),r(326),r(442),r(195)],void 0===(i=function(e,t,r,a,i,n){function o(e,t){var r=[[e[0],e[1],t],[e[2],e[1],t],[e[2],e[3],t],[e[0],e[3],t]];return i.createSquareGeometry(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeImageExportSize=function(e,t,a){var i=r.width(e)/r.height(e),n={width:a,height:a};return i>1.0001?n.height=a/i:i<.9999&&(n.width=a*i),n.width=Math.round(n.width/(r.width(e)/r.width(t))),n.height=Math.round(n.height/(r.height(e)/r.height(t))),n},t.createGeometryForExtent=o,t.createOuterImageGeometry=function(e,t,i){if(!r.intersects(e,t))return o(t,i);for(var l=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],u=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],c=t[2]-t[0],p=t[3]-t[1],d=u[0]>0&&u[2]>0?3:2,h=l[0]>0&&l[2]>0?3:2,y=(h+1)*(d+1),f=new Float64Array(3*y),m=new Float32Array(2*y),g=new Uint32Array(6*(h*d-1)),v=0,_=0,b=0,x=0,w=0,S=0;S<4;S++){var P=l[S];if(!(P<=0)){for(var O=0,E=0;E<4;E++){var M=u[E];M<=0||(f[_++]=t[0]+O,f[_++]=t[1]+v,f[_++]=i,m[b++]=O/c,m[b++]=v/p,E<3&&S<3&&(1!==E||1!==S)&&(g[w++]=x,g[w++]=x+1,g[w++]=x+d+1,g[w++]=x+1,g[w++]=x+d+2,g[w++]=x+d+1),x++,O+=M)}v+=P}}var D={};D[n.VertexAttrConstants.POSITION]={size:3,data:f},D[n.VertexAttrConstants.NORMAL]={size:3,data:s},D[n.VertexAttrConstants.UV0]={size:2,data:m};for(var C={},I=new Uint32Array(g.length),T=0;T<I.length;T++)I[T]=0;return C[n.VertexAttrConstants.POSITION]=g,C[n.VertexAttrConstants.NORMAL]=I,C[n.VertexAttrConstants.UV0]=g,new a.GeometryData(D,C)};var s=new Float32Array([0,0,1])}.apply(null,a))||(e.exports=i)},570:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(591),r(344),r(543),r(249),r(249),r(372),r(571)],void 0===(i=function(e,t,r,a,i,n,o,s,l,u){var c=function(e){function t(t,r){var a=e.call(this,r)||this;return a.supportsEdges=!0,a.techniqueConfig=new u.ImageMaterialTechniqueConfiguration,a.params=s.copyParameters(t,d),a}return r.__extends(t,e),t.prototype.setParameterValues=function(e){o.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.intersect=function(e,t,r,a,i,n,o){s.intersectTriangleGeometry(e,t,a,i,n,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new p(e):void 0},t.prototype.createBufferWriter=function(){return new n.DefaultBufferWriter(n.PositionUVLayout)},t.prototype.createRenderer=function(e,t){return new l(e,t,this)},t}(i.Material),p=function(e){function t(t){var a=e.call(this,r.__assign(r.__assign({},t),t.material.getParameters()))||this;return a.updateParameters(),a}return r.__extends(t,e),t.prototype.updateParameters=function(){var e=this.material.getParameters();this.updateTexture(e.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(u.ImageMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.getParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(a),d={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0};return c}.apply(null,a))||(e.exports=i)},571:function(e,t,r){var a,i;a=[r.dj.c(e.i),t,r(117),r(223),r(256),r(253),r(257),r(260),r(228),r(373),r(404),r(242),r(217),r(217),r(161)],void 0===(i=function(e,t,a,i,n,o,s,l,u,c,p,d,h,y){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),a=this.configuration,i=r.build({slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:a.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),u.Default3D)},t.prototype.bindPass=function(e,t,r){this.program.setUniform1f("opacity",t.opacity)},t.prototype.bindDraw=function(e){n.Transform.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=0===e.output&&e.transparent?h.simpleBlendingParams(1,771):null,r=function(r){return y.makePipelineState({blending:t,polygonOffset:e.polygonOffset&&m,culling:(a=e.cullFace,0!==a&&{face:1===a?1028:1029,mode:2305}),depthTest:c.depthCompareLess,depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?c.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null});var a};return this._occludeeState=r(!0),r(!1)},Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),t.shader=new o.ReloadableShaderModule(p,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(404)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.ImageMaterialTechnique=f;var m={factor:1,units:1},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return a.__extends(t,e),a.__decorate([l.parameter({count:7})],t.prototype,"output",void 0),a.__decorate([l.parameter({count:3})],t.prototype,"cullFace",void 0),a.__decorate([l.parameter()],t.prototype,"slicePlaneEnabled",void 0),a.__decorate([l.parameter()],t.prototype,"sliceHighlightDisabled",void 0),a.__decorate([l.parameter()],t.prototype,"transparent",void 0),a.__decorate([l.parameter()],t.prototype,"polygonOffset",void 0),a.__decorate([l.parameter()],t.prototype,"writeDepth",void 0),a.__decorate([l.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(l.ShaderTechniqueConfiguration);t.ImageMaterialTechniqueConfiguration=g}.apply(null,a))||(e.exports=i)}}]);
//# sourceMappingURL=60.js.map