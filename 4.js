(function(){var e={"esri/core/accessorSupport/decorators":151,"esri/core/maybe":152,"esri/core/promiseUtils":153,"esri/core/Error":154,"esri/core/JSONSupport":155,"esri/core/Logger":156,"esri/core/watchUtils":157,"esri/core/Accessor":158,"esri/geometry":159,"esri/core/libs/gl-matrix-2/vec3f64":160,"esri/core/libs/gl-matrix-2/vec3":162,"esri/geometry/support/jsonUtils":163,"esri/core/has":164,"esri/request":165,"esri/core/jsonMap":166,"esri/core/Handles":167,"esri/core/mathUtils":168,"esri/core/Collection":169,"esri/geometry/SpatialReference":170,"esri/core/screenUtils":171,"esri/core/urlUtils":172,"esri/geometry/support/aaBoundingRect":173,"esri/Graphic":174,"esri/views/3d/webgl-engine/core/shaderModules/interfaces":175,"esri/core/compilerUtils":177,"esri/geometry/support/spatialReferenceUtils":178,"esri/core/accessorSupport/ensureType":179,"esri/core/arrayUtils":180,"esri/Color":182,"esri/widgets/support/widget":183,"esri/geometry/Extent":184,"esri/core/libs/gl-matrix-2/mat4f64":185,"esri/widgets/Widget":188,"esri/core/libs/gl-matrix-2/mat4":189,"esri/core/Evented":190,"esri/layers/support/fieldUtils":191,"esri/views/3d/support/projectionUtils":192,"esri/geometry/support/aaBoundingBox":193,"esri/layers/support/Field":194,"esri/views/3d/webgl-engine/lib/Util":195,"esri/geometry/support/webMercatorUtils":197,"esri/core/SetUtils":198,"esri/tasks/support/Query":199,"esri/core/unitUtils":200,"esri/core/libs/gl-matrix-2/vec4f64":201,"esri/geometry/Point":202,"esri/views/3d/support/geometryUtils":203,"esri/views/webgl":204,"esri/core/libs/gl-matrix-2/vec2":205,"esri/views/2d/engine/webgl/definitions":206,"esri/layers/graphics/dehydratedFeatures":207,"esri/layers/Layer":208,"esri/core/MapUtils":210,"esri/views/support/Scheduler":211,"esri/core/PooledArray":214,"esri/geometry/Geometry":215,"esri/core/libs/gl-matrix-2/vec2f64":216,"esri/views/webgl/renderState":217,"esri/views/layers/LayerView":218,"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":223,"esri/layers/graphics/OptimizedGeometry":224,"esri/core/MultiOriginJSONSupport":225,"esri/core/asyncUtils":226,"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":228,"esri/core/string":229,"esri/core/ObjectPool":230,"esri/core/scheduling":231,"esri/geometry/Polygon":232,"esri/layers/support/commonProperties":233,"esri/layers/support/timeUtils":235,"esri/core/HandleOwner":236,"esri/layers/support/TileInfo":237,"esri/views/3d/support/earthUtils":238,"esri/symbols":239,"esri/layers/mixins/PortalLayer":240,"esri/views/input/InputHandler":241,"esri/views/webgl/Program":242,"esri/layers/graphics/featureConversionUtils":243,"esri/layers/mixins/OperationalLayer":244,"esri/core/libs/gl-matrix-2/vec4":245,"esri/support/arcadeOnDemand":246,"esri/renderers/visualVariables/support/visualVariableUtils":247,"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":249,"esri/views/3d/support/mathUtils":251,"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":252,"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":253,"esri/core/collectionUtils":254,"esri/layers/support/FieldsIndex":255,"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":256,"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":257,"esri/intl":258,"esri/geometry/Polyline":259,"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":260,"esri/views/3d/support/debugFlags":261,"esri/views/3d/layers/graphics/graphicUtils":262,"esri/core/Warning":264,"esri/layers/mixins/ScaleRangeLayer":265,"esri/views/MapView":266,"esri/core/events":270,"esri/assets":271,"esri/core/libs/gl-matrix-2/mat3":272,"esri/portal/Portal":273,"esri/layers/graphics/OptimizedFeature":274,"esri/Map":275,"esri/core/libs/gl-matrix-2/mat3f64":276,"esri/views/3d/layers/graphics/elevationAlignmentUtils":277,"esri/widgets/Expand":278,"esri/TimeExtent":282,"esri/portal/PortalItem":283,"esri/views/layers/RefreshableLayerView":285,"esri/views/2d/tiling/TileKey":286,"esri/views/SceneView":287,"esri/views/3d/webgl-engine/lib/Camera":288,"esri/views/3d/support/orientedBoundingBox":289,"esri/core/Identifiable":292,"esri/PopupTemplate":297,"esri/layers/mixins/RefreshableLayer":298,"esri/views/webgl/Texture":299,"esri/core/Promise":303,"esri/layers/graphics/OptimizedFeatureSet":304,"esri/core/workers":305,"esri/core/libs/gl-matrix-2/vec2f32":306,"esri/views/webgl/BufferObject":307,"esri/views/3d/layers/LayerView3D":308,"esri/renderers/support/jsonUtils":316,"esri/views/3d/support/buffer/InterleavedLayout":317,"esri/views/webgl/VertexArrayObject":318,"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":319,"esri/core/accessorSupport/utils":322,"esri/core/Loadable":323,"esri/layers/support/arcgisLayerUrl":324,"esri/layers/TileLayer":325,"esri/views/3d/webgl-engine/lib/GeometryData":326,"esri/tasks/Task":327,"esri/core/deprecate":335,"esri/kernel":336,"esri/support/actions/ActionBase":337,"esri/symbols/cim/CIMCursor":338,"esri/layers/mixins/ArcGISService":339,"esri/views/3d/support/buffer/BufferView":340,"esri/views/webgl/Util":341,"esri/views/3d/camera/constraintUtils":342,"esri/views/3d/state/utils/navigationUtils":343,"esri/views/3d/webgl-engine/lib/Material":344,"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":345,"esri/views/3d/layers/graphics/ElevationContext":346,"esri/support/persistableUrlUtils":351,"esri/geometry/Multipoint":352,"esri/geometry/support/boundsUtils":353,"esri/symbols/support/jsonUtils":354,"esri/views/3d/support/stack":355,"esri/views/3d/webgl-engine/lib/Geometry":356,"esri/symbols/support/utils":357,"esri/views/3d/webgl-engine/lib/Texture":358,"esri/portal/support/geometryServiceUtils":359,"esri/portal/support/resourceUtils":365,"esri/intl/date":366,"esri/symbols/cim/CurveHelper":367,"esri/renderers/support/LegendOptions":368,"esri/Viewpoint":369,"esri/core/libs/gl-matrix-2/mat2df32":370,"esri/views/3d/support/buffer/glUtil":371,"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":372,"esri/views/3d/webgl-engine/lib/StencilUtils":373,"esri/core/libs/gl-matrix-2/vec4f32":374,"esri/views/3d/terrain/terrainUtils":375,"esri/symbols/support/materialUtils":386,"esri/views/support/WatchUpdatingTracking":388,"esri/core/libs/gl-matrix-2/vec3f32":389,"esri/views/3d/webgl-engine/lib/Intersector":390,"esri/views/3d/webgl-engine/lib/intersectorUtils":391,"esri/views/webgl/FramebufferObject":392,"esri/geometry/support/contains":407,"esri/views/2d/arcade/utils":408,"esri/symbols/Symbol3DLayer":409,"esri/support/popupUtils":411,"esri/core/libs/gl-matrix-2/math/common":412,"esri/core/libs/gl-matrix-2/mat3f32":413,"esri/views/2d/tiling/TileInfoView":414,"esri/views/3d/terrain/TerrainConst":415,"esri/views/3d/webgl-engine/lib/glUtil3D":416,"esri/views/3d/webgl-engine/lib/Object3D":417,"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":418,"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":419,"esri/symbols/support/gfxUtils":420,"esri/geometry/support/coordsUtils":427,"esri/symbols/Symbol":428,"esri/symbols/SimpleLineSymbol":429,"esri/symbols/FillSymbol3DLayer":430,"esri/symbols/Symbol3D":431,"esri/symbols/TextSymbol3DLayer":432,"esri/renderers/visualVariables/SizeVariable":433,"esri/renderers/support/numberUtils":434,"esri/core/accessorSupport/diffUtils":435,"esri/geometry/HeightModelInfo":436,"esri/layers/support/LabelClass":437,"esri/layers/support/Sublayer":438,"esri/layers/support/sublayerUtils":439,"esri/views/2d/viewpointUtils":440,"esri/core/libs/gl-matrix-2/mat2d":441,"esri/views/3d/webgl-engine/lib/GeometryUtil":442,"esri/views/3d/webgl-engine/lib/geometryDataUtils":443,"esri/core/libs/gl-matrix-2/quat":444,"esri/views/3d/webgl-engine/lib/Object3DStateSet":445,"esri/views/3d/webgl-engine/materials/renderers/utils":446,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":447,"esri/views/3d/layers/graphics/featureExpressionInfoUtils":448,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":449,"esri/views/3d/layers/support/FastSymbolUpdates":450,"esri/views/3d/webgl-engine/lib/RenderGeometry":451,"esri/layers/ElevationLayer":452,"esri/views/3d/layers/support/layerViewUpdatingProperties":453,"esri/views/3d/terrain/tileUtils":454,"esri/core/accessorSupport/PropertyOrigin":475,"esri/core/ArrayPool":476,"esri/intl/number":477,"esri/core/wgs84Constants":478,"esri/geometry/support/intersects":479,"esri/support/actions/ActionButton":480,"esri/renderers":481,"esri/symbols/support/Symbol3DMaterial":482,"esri/core/MemCache":483,"esri/tasks/support/StatisticDefinition":485,"esri/layers/support/LOD":486,"esri/core/CollectionFlattener":487,"esri/Basemap":488,"esri/core/loadAll":489,"esri/views/View":490,"esri/geometry/support/scaleUtils":491,"esri/layers/support/layerUtils":492,"esri/views/3d/support/imageUtils":493,"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":494,"esri/views/3d/layers/graphics/ElevationAligners":495,"esri/views/webgl/capabilities/isWebGL2Context":496,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":497,"esri/views/3d/support/PropertiesPool":498,"esri/views/2d/engine/vectorTiles/GeometryUtils":499,"esri/core/accessorSupport/decorators/property":515,"esri/core/throttle":516,"esri/intl/locale":517,"esri/popup/content/Content":518,"esri/popup/FieldInfo":519,"esri/support/actions/ActionToggle":520,"esri/geometry/support/quantizationUtils":521,"esri/symbols/PointSymbol3D":522,"esri/symbols/PolygonSymbol3D":523,"esri/renderers/Renderer":524,"esri/tasks/support/QuantizationParameters":528,"esri/views/support/layerViewUtils":529,"esri/views/ViewAnimation":530,"esri/views/input/handlers/support":531,"esri/core/ObjectStack":532,"esri/views/3d/camera/intersectionUtils":533,"esri/views/3d/webgl-engine/lib/IdGen":534,"esri/views/3d/webgl-engine/lib/GLMaterial":535,"esri/views/3d/webgl-engine/lib/AutoDisposable":536,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":537,"esri/core/libs/earcut/earcut":538,"esri/views/3d/layers/support/edgeUtils":539,"esri/views/3d/webgl-engine/materials/DefaultMaterial":540,"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":541,"esri/views/3d/layers/graphics/constants":542,"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":543,"esri/core/accessorSupport/decorators/cast":573,"esri/core/uuid":574,"esri/core/libs/pep/pep":575,"esri/widgets/support/widgetUtils":576,"esri/symbols/support/ObjectSymbol3DLayerResource":577,"esri/tasks/support/colorRamps":578,"esri/renderers/support/utils":579,"esri/symbols/support/unitConversionUtils":581,"esri/symbols/support/defaultsJSON":582,"esri/views/2d/tiling":585,"esri/views/2d/tiling/TileCoverage":586,"esri/views/2d/tiling/TileQueue":587,"esri/views/3d/terrain/TilingScheme":588,"esri/views/animation/easing":589,"esri/views/3d/state/controllers/InteractiveController":590,"esri/views/3d/webgl-engine/lib/GLMaterialTexture":591,"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":592,"esri/views/3d/layers/graphics/symbolComplexity":593,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":594,"esri/core/ItemCache":595,"esri/views/3d/layers/support/symbolColorUtils":596,"esri/layers/VectorTileLayer":597,"esri/views/2d/engine/webgl/TiledDisplayObject":598,"esri/views/2d/engine/DisplayObject":599,"esri/core/libs/gl-matrix-2/quatf32":600,"esri/core/accessorSupport/get":614,"esri/core/accessorSupport/metadata":615,"esri/core/accessorSupport/decorators/persistable":616,"esri/core/multiOriginJSONSupportUtils":617,"esri/core/clock":618,"esri/core/accessorSupport/write":619,"esri/core/domUtils":620,"esri/libs/maquette/index":621,"esri/layers/support/domains":622,"esri/geometry/support/extentUtils":623,"esri/portal/PortalQueryParams":624,"esri/symbols/cim/Rect":625,"esri/symbols/cim/utils":626,"esri/symbols/support/IconSymbol3DLayerResource":627,"esri/symbols/callouts/calloutUtils":628,"esri/symbols/SimpleFillSymbol":629,"esri/tasks/support/MultipartColorRamp":630,"esri/renderers/mixins/VisualVariablesMixin":631,"esri/renderers/visualVariables/VisualVariable":632,"esri/symbols/support/styleUtils":633,"esri/layers/support/TilemapCache":636,"esri/views/input/InputManager":637,"esri/Camera":638,"esri/core/libs/gl-matrix-2/factories/vec3f64":639,"esri/views/2d/tiling/TileStrategy":640,"esri/views/input/DragEventSeparator":641,"esri/views/input/recognizers/support":642,"esri/views/support/screenshotUtils":643,"esri/views/3d/support/ElevationProvider":644,"esri/views/3d/state/Constraints":645,"esri/core/libs/gl-matrix-2/mat4f32":646,"esri/core/libs/gl-matrix-2/quatf64":647,"esri/views/3d/support/geometryUtils/plane":648,"esri/views/3d/support/geometryUtils/ray":649,"esri/views/3d/state/controllers/momentum/MomentumController":650,"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":651,"esri/views/3d/webgl-engine/materials/HUDMaterial":652,"esri/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":653,"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":654,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":655,"esri/renderers/support/renderingInfoUtils":656,"esri/views/3d/terrain/OverlayRenderer":657,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":658,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":659,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":660,"esri/views/3d/support/FrustumExtentIntersection":661,"esri/views/3d/support/WorkerHandle":662,"esri/portal/support/jsonContext":663,"esri/views/2d/engine/vectorTiles/VectorTile":664,"esri/views/webgl/rasterUtils":665,"esri/views/3d/layers/TiledLayerView3D":666,"esri/views/3d/webgl-engine/lib/depthRange":667,"esri/core/handleUtils":759,"esri/core/accessorSupport/decorators/reader":760,"esri/layers/support/Domain":762,"esri/popup/support/FieldInfoFormat":763,"esri/popup/content/MediaContent":764,"esri/popup/content/mixins/ChartMediaInfo":765,"esri/popup/content/support/chartMediaInfoUtils":766,"esri/popup/content/ColumnChartMediaInfo":767,"esri/popup/content/TextContent":768,"esri/popup/ExpressionInfo":769,"esri/renderers/ClassBreaksRenderer":770,"esri/portal/PortalUser":771,"esri/portal/PortalGroup":772,"esri/symbols/cim/cimSymbolUtils":773,"esri/symbols/cim/CIMPlacements":774,"esri/symbols/cim/GeometryWalker":775,"esri/webdoc/support/opacityUtils":776,"esri/symbols/IconSymbol3DLayer":777,"esri/symbols/LineSymbol3DLayer":778,"esri/symbols/ObjectSymbol3DLayer":779,"esri/symbols/SimpleMarkerSymbol":780,"esri/renderers/visualVariables/support/SizeVariableLegendOptions":781,"esri/renderers/visualVariables/support/sizeVariableUtils":782,"esri/renderers/support/HeatmapColorStop":783,"esri/renderers/UniqueValueRenderer":784,"esri/core/workers/utils":785,"esri/layers/support/fieldType":786,"esri/symbols/support/defaults":788,"esri/layers/support/layerSourceUtils":790,"esri/widgets/support/GoTo":791,"esri/core/libs/gl-matrix-2/math/mat2d":792,"esri/views/input/recognizers/SingleAndDoubleClick":793,"esri/views/3d/support/geometryUtils/vector":794,"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":795,"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":796,"esri/views/3d/webgl-engine/lighting/Lightsources":797,"esri/views/3d/camera/constraintUtils/common":798,"esri/views/3d/state/controllers/CameraController":799,"esri/views/navigation/Momentum":800,"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":801,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":802,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":803,"esri/views/3d/webgl-engine/shaders/HUDMaterial.glsl":804,"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":805,"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":806,"esri/views/3d/layers/graphics/pointUtils":807,"esri/views/3d/webgl-engine/materials/lineStippleUtils":808,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":809,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":810,"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":811,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":812,"esri/symbols/cim/CIMSymbolRasterizer":813,"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":814,"esri/views/3d/support/StreamDataLoader":815,"esri/views/3d/terrain/TileAgent":816,"esri/views/3d/terrain/PatchGeometryFactory":817,"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":818,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":819,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":820,"esri/views/webgl/context-util":849,"esri/core/accessorSupport/wire":851,"esri/core/accessorSupport/extensions/serializableProperty":852,"esri/core/RandomLCG":854,"esri/core/accessorSupport/watch":855,"esri/core/nextTick":856,"esri/core/accessorSupport/read":857,"esri/intl/substitute":858,"esri/intl/messages":859,"esri/geometry/support/WKIDUnitConversion":860,"esri/geometry/support/zmUtils":861,"esri/geometry/support/centroid":862,"esri/popup/content/mixins/MediaInfo":863,"esri/popup/content/support/ChartMediaInfoValue":864,"esri/popup/content/support/ChartMediaInfoValueSeries":865,"esri/symbols/CIMSymbol":866,"esri/portal/PortalQueryResult":867,"esri/portal/PortalFolder":868,"esri/symbols/cim/cimAnalyzer":869,"esri/symbols/cim/CIMSymbolHelper":870,"esri/symbols/cim/CIMOperators":871,"esri/symbols/ExtrudeSymbol3DLayer":872,"esri/symbols/edges/utils":873,"esri/symbols/edges/Edges3D":874,"esri/symbols/FillSymbol":875,"esri/symbols/support/colors":876,"esri/symbols/Font":877,"esri/symbols/PathSymbol3DLayer":878,"esri/symbols/WaterSymbol3DLayer":879,"esri/symbols/support/Thumbnail":880,"esri/symbols/callouts/LineCallout3D":881,"esri/symbols/support/Symbol3DVerticalOffset":882,"esri/symbols/LineSymbol3D":883,"esri/symbols/MarkerSymbol":884,"esri/symbols/MeshSymbol3D":885,"esri/symbols/TextSymbol":886,"esri/symbols/support/symbolConversion":887,"esri/tasks/support/ColorRamp":888,"esri/renderers/visualVariables/ColorVariable":889,"esri/core/LRUCache":890,"esri/renderers/DotDensityRenderer":891,"esri/renderers/SimpleRenderer":892,"esri/core/workers/RemoteClient":893,"esri/symbols/support/ElevationInfo":894,"esri/portal/PortalItemResource":895,"esri/portal/PortalRating":896,"esri/layers/support/labelUtils":899,"esri/layers/support/FeatureType":901,"esri/layers/mixins/ArcGISCachedService":902,"esri/layers/support/serviceTileInfoProperty":903,"esri/layers/mixins/ArcGISMapService":904,"esri/layers/mixins/SublayersOwner":905,"esri/webdoc/support/writeUtils":906,"esri/Ground":907,"esri/support/LayersMixin":908,"esri/views/DOMContainer":909,"esri/widgets/Feature/support/FeatureContentMixin":910,"esri/views/input/gamepad/GamepadInputDevice":911,"esri/core/libs/gl-matrix-2/common":912,"esri/core/libs/gl-matrix-2/mat2df64":913,"esri/views/2d/ViewState":914,"esri/webscene/Lighting":915,"esri/views/3d/support/buffer/types":916,"esri/views/3d/support/geometryUtils/boundedPlane":917,"esri/views/3d/support/geometryUtils/lineSegment":918,"esri/views/3d/support/geometryUtils/sphere":919,"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":920,"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":921,"esri/views/3d/state/utils/viewUtils":922,"esri/views/3d/state/controllers/PointToPointAnimationController":923,"esri/views/3d/state/controllers/AnimationController":924,"esri/views/3d/support/cameraUtils":925,"esri/views/3d/support/cameraUtilsInternal":926,"esri/views/navigation/PanPlanarMomentumEstimator":927,"esri/views/navigation/FilteredFiniteDifference":928,"esri/views/navigation/RotationMomentumEstimator":929,"esri/views/navigation/ZoomMomentumEstimator":930,"esri/views/3d/webgl-engine/lib/renderStats":931,"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":932,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":933,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":934,"esri/views/3d/layers/graphics/Loadable":935,"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":936,"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":937,"esri/views/3d/webgl-engine/shaders/LineCallout.glsl":938,"esri/views/3d/layers/graphics/Graphics3DSymbol":939,"esri/views/3d/layers/graphics/polygonUtils":940,"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":941,"esri/views/3d/webgl-engine/lib/Layer":942,"esri/views/3d/webgl-engine/lib/localOrigin":943,"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":944,"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":945,"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":946,"esri/views/webgl/Renderbuffer":947,"esri/views/webgl/programUtils":948,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":949,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":950,"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":951,"esri/views/3d/support/buffer/utils":952,"esri/views/3d/webgl-engine/lib/TextRenderParameters":953,"esri/tasks/support/ProjectParameters":954,"esri/views/2d/engine/vectorTiles/TileIndex":955,"esri/views/2d/engine/vectorTiles/style/StyleLayer":956,"esri/views/3d/terrain/RasterTile":957,"esri/views/3d/terrain/TileTexture":958,"esri/views/3d/support/pointsOfInterest/PointOfInterest":959,"esri/views/3d/terrain/Tile":960,"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":961,"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":962,"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentShader.glsl":963,"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":964,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":965,"esri/core/accessorSupport/set":1091,"esri/core/accessorSupport/decorators/subclass":1092,"esri/core/accessorSupport/extensions":1093,"esri/core/accessorSupport/extensions/serializableProperty/type":1094,"esri/core/accessorSupport/extensions/serializableProperty/writer":1095,"esri/core/accessorSupport/decorators/writer":1096,"esri/core/Message":1097,"esri/support/requestUtils":1099,"esri/core/ReentrantObjectPool":1100,"esri/libs/maquette/dom":1101,"esri/widgets/support/decorators/propUtils":1102,"esri/layers/support/CodedValue":1103,"esri/popup/content":1104,"esri/popup/content/AttachmentsContent":1105,"esri/popup/content/CustomContent":1106,"esri/popup/content/FieldsContent":1107,"esri/popup/content/BarChartMediaInfo":1108,"esri/popup/content/ImageMediaInfo":1109,"esri/popup/content/LineChartMediaInfo":1110,"esri/popup/content/PieChartMediaInfo":1111,"esri/popup/content/support/mediaInfoTypes":1112,"esri/popup/support/RelatedRecordsInfoFieldOrder":1113,"esri/symbols/cim/CIMEffects":1114,"esri/symbols/cim/packingUtils":1115,"esri/symbols/cim/SDFHelper":1116,"esri/symbols/support/Symbol3DOutline":1117,"esri/symbols/support/Symbol3DAnchorPosition2D":1118,"esri/symbols/LabelSymbol3D":1119,"esri/symbols/support/StyleOrigin":1120,"esri/symbols/callouts/Callout3D":1121,"esri/symbols/callouts/LineCallout3DBorder":1122,"esri/symbols/PictureFillSymbol":1123,"esri/symbols/support/urlUtils":1124,"esri/symbols/PictureMarkerSymbol":1125,"esri/symbols/WebStyleSymbol":1126,"esri/renderers/support/AuthoringInfo":1127,"esri/renderers/support/AuthoringInfoVisualVariable":1128,"esri/tasks/support/AlgorithmicColorRamp":1129,"esri/renderers/visualVariables/support/VisualVariableLegendOptions":1130,"esri/renderers/visualVariables/support/ColorStop":1131,"esri/renderers/visualVariables/OpacityVariable":1132,"esri/renderers/visualVariables/RotationVariable":1133,"esri/renderers/visualVariables/support/SizeStop":1134,"esri/renderers/DictionaryRenderer":1135,"esri/renderers/HeatmapRenderer":1136,"esri/core/devEnvironmentUtils":1137,"esri/layers/support/FeatureTemplate":1140,"esri/support/basemapDefinitions":1141,"esri/support/basemapUtils":1142,"esri/views/BreakpointsOwner":1143,"esri/widgets/support/AnchorElementViewModel":1144,"esri/views/input/keys":1145,"esri/core/libs/gl-matrix-2/math/vec3":1146,"esri/views/PopupView":1147,"esri/support/GraphicsCollection":1148,"esri/views/input/ViewEvents":1149,"esri/views/interactive/interactiveToolUtils":1150,"esri/geometry/support/heightModelInfoUtils":1151,"esri/views/2d/support/Timeline":1152,"esri/views/navigation/gamepadAndKeyboardUtils":1153,"esri/views/input/BrowserEventSource":1154,"esri/views/input/handlers/PreventContextMenu":1155,"esri/views/input/recognizers/Drag":1156,"esri/views/input/recognizers/ImmediateDoubleClick":1157,"esri/views/input/recognizers/PointerClickHoldAndDrag":1158,"esri/views/support/WebGLRequirements":1159,"esri/views/ui/DefaultUI":1160,"esri/views/ui/Component":1161,"esri/layers/support/ElevationSampler":1162,"esri/views/3d/webgl-engine/lib/BufferVectorMath":1163,"esri/webscene/Environment":1164,"esri/webscene/background/Background":1165,"esri/webscene/background/ColorBackground":1166,"esri/core/libs/gl-matrix-2/factories/vec4f64":1167,"esri/core/libs/gl-matrix-2/factories/mat4f64":1168,"esri/views/3d/environment/SimpleAtmosphereTechnique":1169,"esri/views/3d/environment/SimpleAtmosphere.glsl":1170,"esri/views/3d/environment/resources/SimpleAtmosphereTexture":1171,"esri/core/libs/gl-matrix-2/math/vec4":1172,"esri/core/libs/gl-matrix-2/factories/mat3f64":1173,"esri/core/libs/gl-matrix-2/factories/quatf64":1174,"esri/views/3d/support/geometryUtils/clipRay":1175,"esri/views/3d/support/geometryUtils/frustum":1176,"esri/views/3d/support/geometryUtils/triangle":1177,"esri/views/3d/environment/atmosphereUtils":1178,"esri/views/3d/environment/RealisticAtmosphere.glsl":1179,"esri/views/3d/environment/Stars.glsl":1180,"esri/views/3d/state/controllers/global/ZoomStepController":1181,"esri/views/3d/camera/constraintUtils/altitude":1182,"esri/views/3d/support/intersectionUtils":1183,"esri/views/3d/camera/constraintUtils/distance":1184,"esri/views/3d/camera/constraintUtils/surfaceCollision":1185,"esri/views/3d/webgl-engine/lib/GeometryRecord":1186,"esri/views/3d/camera/constraintUtils/tilt":1187,"esri/views/animation/pointToPoint/Settings":1188,"esri/views/3d/support/geometryUtils/coordinateSystem":1189,"esri/views/3d/state/controllers/local/ZoomStepController":1190,"esri/views/3d/state/controllers/RotateController":1191,"esri/views/3d/state/controllers/GamepadKeyboardController":1192,"esri/views/support/spatialReferenceSupport":1193,"esri/views/3d/input/util":1194,"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":1195,"esri/views/3d/state/controllers/momentum/RotationMomentumController":1196,"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":1197,"esri/views/navigation/MomentumEstimator":1198,"esri/views/3d/input/handlers/SingleKey":1199,"esri/views/3d/layers/graphics/Deconflictor":1200,"esri/views/3d/webgl-engine/materials/WaterGLMaterial":1201,"esri/views/3d/webgl-engine/materials/WaterTechnique":1202,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":1203,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":1204,"esri/views/3d/webgl-engine/shaders/WaterSurface.glsl":1205,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":1206,"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":1207,"esri/layers/support/labelFormatUtils":1208,"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":1209,"esri/views/3d/webgl-engine/lib/BoundingInfo":1210,"esri/views/3d/layers/graphics/graphicSymbolUtils":1211,"esri/views/3d/layers/graphics/Graphics3DGraphic":1212,"esri/geometry/support/triangulationUtils":1213,"esri/geometry/support/meshUtils/deduplicate":1214,"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":1215,"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":1216,"esri/views/3d/webgl-engine/lib/GLMaterialRep":1217,"esri/views/3d/webgl-engine/lib/Octree":1218,"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":1219,"esri/views/3d/webgl-engine/shaders/RibbonLine.glsl":1220,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":1221,"esri/views/3d/webgl-engine/lib/RenderContext":1222,"esri/views/3d/webgl-engine/lib/rendererUtils":1223,"esri/views/3d/webgl-engine/lib/TextureTechnique":1224,"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":1225,"esri/views/3d/webgl-engine/lighting/SceneLighting":1226,"esri/views/webgl/RenderingContext":1227,"esri/views/webgl/capabilities/DisjointTimerQuery":1228,"esri/views/3d/support/buffer/math/vec3":1229,"esri/views/3d/support/buffer/math/common":1230,"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":1231,"esri/views/3d/webgl-engine/lib/WebGLDriverTest":1232,"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":1233,"esri/views/3d/webgl-engine/shaders/DefaultMaterial.glsl":1234,"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":1235,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":1236,"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":1237,"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":1238,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":1239,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":1240,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":1241,"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":1242,"esri/views/3d/webgl-engine/core/shaderLibrary/default/RealisticTree.glsl":1243,"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":1244,"esri/symbols/cim/Rasterizer":1245,"esri/views/3d/layers/graphics/lineUtils":1246,"esri/geometry/support/MeshMaterial":1247,"esri/geometry/support/MeshTexture":1248,"esri/geometry/support/MeshMaterialMetallicRoughness":1249,"esri/views/3d/webgl-engine/materials/NativeLineMaterial":1250,"esri/views/3d/webgl-engine/shaders/NativeLine.glsl":1251,"esri/views/3d/layers/graphics/objectResourceUtils":1252,"esri/views/3d/glTF/DefaultLoadingContext":1253,"esri/views/3d/glTF/loader":1254,"esri/core/Version":1255,"esri/views/3d/layers/graphics/wosrLoader":1256,"esri/core/libs/gl-matrix-2/mat2":1257,"esri/views/3d/webgl-engine/materials/PathTechnique":1258,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":1259,"esri/views/3d/webgl-engine/shaders/Path.glsl":1260,"esri/views/3d/webgl-engine/shaders/ColorMaterial.glsl":1261,"esri/views/3d/webgl-engine/lib/TextRenderer":1262,"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":1263,"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":1264,"esri/views/3d/layers/support/FeatureTileDescriptor3D":1265,"esri/views/3d/state/Frustum":1266,"esri/views/3d/layers/graphics/ElevationQuery":1267,"esri/views/3d/support/index":1268,"esri/views/3d/support/MemoryController":1269,"esri/views/3d/layers/support/MemoryManagedLayerView":1270,"esri/views/3d/support/AsyncWorkerQueue":1271,"esri/tasks/GeometryService":1272,"esri/layers/support/LercDecoder":1273,"esri/views/2d/engine/vectorTiles/SchemaHelper":1274,"esri/views/2d/engine/vectorTiles/style/StyleRepository":1275,"esri/views/3d/support/pointsOfInterest/disposeMembers":1276,"esri/views/3d/layers/ElevationLayerView3D":1277,"esri/views/3d/layers/support/tiledLayerUtils":1278,"esri/views/3d/terrain/ElevationBounds":1279,"esri/views/3d/terrain/ElevationData":1280,"esri/views/3d/terrain/ElevationTileAgent":1281,"esri/views/3d/terrain/MapTileAgent":1282,"esri/views/3d/support/animationUtils":1283,"esri/views/3d/webgl-engine/parts/requireUtils":1284,"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendLayers.glsl":1285,"esri/views/3d/webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl":1286,"esri/views/3d/webgl-engine/lib/tracer":1287,"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Terrain.glsl":1288,"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":1289,"esri/views/3d/webgl-engine/shaders/Compositing.glsl":1290,"esri/views/3d/webgl-engine/shaders/HighlightComposition.glsl":1291,"esri/views/3d/webgl-engine/shaders/SSAO.glsl":1292,"esri/views/3d/webgl-engine/lib/localOriginHelper":1293,"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":1294,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":1295,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeShaderProgram.glsl":1296,"esri/core/accessorSupport/decorators/aliasOf":1408,"esri/core/accessorSupport/decorators/autoDestroy":1409,"esri/core/accessorSupport/decorators/declared":1410,"esri/core/accessorSupport/decorators/enumeration":1411,"esri/core/accessorSupport/decorators/shared":1412,"esri/core/accessorSupport/extensions/computedProperty":1413,"esri/core/accessorSupport/extensions/serializableProperty/originAliases":1414,"esri/core/accessorSupport/extensions/serializableProperty/reader":1415,"esri/core/accessorSupport/extensions/serializableProperty/shorthands":1416,"esri/support/revision":1417,"esri/core/accessorSupport/Properties":1419,"esri/core/accessorSupport/Store":1420,"esri/core/accessorSupport/testSupport":1421,"esri/core/HeapSort":1422,"esri/libs/maquette/projection":1425,"esri/libs/maquette/h":1428,"esri/libs/maquette/projector":1429,"esri/libs/maquette/cache":1430,"esri/libs/maquette/mapping":1431,"esri/widgets/support/decorators":1432,"esri/widgets/support/decorators/accessibleHandler":1433,"esri/widgets/support/decorators/messageBundle":1434,"esri/widgets/support/decorators/renderable":1435,"esri/widgets/support/decorators/vmEvent":1436,"esri/widgets/support/jsxFactory":1437,"esri/widgets/support/shim/SVGElement":1439,"esri/layers/support/CodedValueDomain":1442,"esri/layers/support/InheritedDomain":1443,"esri/layers/support/RangeDomain":1444,"esri/geometry/support/offset":1445,"esri/core/date":1446,"esri/popup/content/support/ImageMediaInfoValue":1447,"esri/popup/LayerOptions":1448,"esri/popup/RelatedRecordsInfo":1449,"esri/symbols/cim/CIMSymbolDrawHelper":1450,"esri/symbols/cim/effects/EffectAddControlPoints":1451,"esri/symbols/cim/effects/EffectArrow":1452,"esri/symbols/cim/effects/EffectBuffer":1453,"esri/symbols/cim/effects/EffectCut":1454,"esri/symbols/cim/effects/EffectDashes":1455,"esri/symbols/cim/effects/EffectDonut":1456,"esri/symbols/cim/effects/EffectJog":1457,"esri/symbols/cim/effects/EffectMove":1458,"esri/symbols/cim/effects/EffectOffset":1459,"esri/symbols/cim/effects/EffectReverse":1460,"esri/symbols/cim/effects/EffectRotate":1461,"esri/symbols/cim/effects/EffectScale":1462,"esri/symbols/cim/effects/EffectWave":1463,"esri/symbols/cim/placements/PlacementAlongLineSameSize":1464,"esri/symbols/cim/enums":1465,"esri/symbols/cim/placements/PlacementAtExtremities":1466,"esri/symbols/cim/placements/PlacementAtRatioPositions":1467,"esri/symbols/cim/placements/PlacementOnLine":1468,"esri/symbols/cim/placements/PlacementOnVertices":1469,"esri/symbols/cim/placements/PlacementPolygonCenter":1470,"esri/symbols/edges/SketchEdges3D":1471,"esri/symbols/edges/SolidEdges3D":1472,"esri/symbols/LineSymbol":1473,"esri/symbols/LineSymbolMarker":1474,"esri/symbols/support/Symbol3DFillMaterial":1475,"esri/symbols/support/Symbol3DAnchorPosition3D":1476,"esri/symbols/support/Symbol3DHalo":1477,"esri/renderers/support/AuthoringInfoFieldInfo":1478,"esri/renderers/support/AuthoringInfoClassBreakInfo":1479,"esri/renderers/visualVariables/support/OpacityStop":1480,"esri/renderers/visualVariables/VisualVariableFactory":1481,"esri/renderers/support/ClassBreakInfo":1482,"esri/renderers/support/AttributeColorInfo":1483,"esri/renderers/support/DotDensityLegendOptions":1484,"esri/renderers/support/UniqueValueInfo":1485,"esri/support/featureFlags":1486,"esri/core/accessorSupport/MultiOriginStore":1487,"esri/core/workers/workers":1503,"esri/core/workers/Connection":1504,"esri/core/workers/registry":1505,"esri/views/support/debugFlags":1506,"esri/core/workers/WorkerOwner":1507,"esri/core/workers/workerFactory":1508,"esri/core/workers/loaderConfig":1509,"esri/core/workers/WorkerFallback":1510,"esri/layers/mixins/operationalLayers":1511,"esri/symbols/support/FeatureExpressionInfo":1512,"esri/layers/support/LabelExpressionInfo":1514,"esri/layers/support/Tilemap":1516,"esri/ground/NavigationConstraint":1518,"esri/support/groundUtils":1519,"esri/views/overlay/ViewOverlay":1520,"esri/widgets/Popup":1521,"esri/widgets/Spinner":1522,"esri/widgets/Spinner/SpinnerViewModel":1523,"esri/widgets/Popup/PopupViewModel":1524,"esri/views/input/handlers/LatestPointerType":1525,"esri/views/input/EventMatch":1526,"esri/widgets/Popup/actions":1527,"esri/views/Magnifier":1528,"esri/views/MapViewBase":1529,"esri/views/BasemapView":1530,"esri/views/LayerViewManager":1531,"esri/views/RefreshManager":1532,"esri/views/ToolViewManager":1533,"esri/views/interactive/ToolViewManagerManipulatorState":1534,"esri/views/input/Input":1535,"esri/views/input/gamepad/GamepadSettings":1536,"esri/views/navigation/Navigation":1537,"esri/views/navigation/gamepad/GamepadSettings":1538,"esri/views/support/DefaultsFromMap":1539,"esri/views/2d/AnimationManager":1540,"esri/views/2d/unitBezier":1541,"esri/core/libs/gl-matrix-2/factories/mat2df64":1542,"esri/core/libs/gl-matrix-2/math/vec2":1543,"esri/core/libs/gl-matrix-2/factories/vec2f64":1544,"esri/views/2d/FrameTask":1545,"esri/views/2d/layerViewModuleImportUtils":1546,"esri/views/2d/MapViewConstraints":1547,"esri/views/2d/constraints/RotationConstraint":1548,"esri/views/2d/constraints/ZoomConstraint":1549,"esri/views/2d/PaddedViewState":1550,"esri/core/libs/gl-matrix-2/factories/mat2df32":1551,"esri/core/libs/gl-matrix-2/math/mat3":1552,"esri/core/libs/gl-matrix-2/factories/mat3f32":1553,"esri/core/libs/gl-matrix-2/factories/vec2f32":1554,"esri/core/libs/gl-matrix-2/types/vec2":1555,"esri/views/2d/tiling/LODInfo":1556,"esri/views/2d/tiling/TileSpan":1557,"esri/views/support/QueueProcessor":1558,"esri/core/Queue":1559,"esri/views/2d/tiling/TileCache":1560,"esri/views/2d/input/MapViewInputManager":1561,"esri/views/2d/input/handlers/DoubleClickZoom":1562,"esri/views/2d/input/handlers/DoubleTapDragZoom":1563,"esri/views/2d/input/handlers/DragPan":1564,"esri/views/2d/input/handlers/DragRotate":1565,"esri/views/2d/input/handlers/GamepadNavigation":1566,"esri/views/2d/input/handlers/KeyPan":1567,"esri/views/2d/input/handlers/KeyRotate":1568,"esri/views/2d/input/handlers/KeyZoom":1569,"esri/views/2d/input/handlers/MouseWheelZoom":1570,"esri/views/2d/input/handlers/PinchAction":1571,"esri/views/input/gamepad/GamepadSource":1572,"esri/views/input/gamepad/GamepadState":1573,"esri/views/input/recognizers/DoubleTapDrag":1574,"esri/views/2d/support/HighlightOptions":1575,"esri/views/ui/2d/DefaultUI2D":1576,"esri/views/ui/UI":1577,"esri/widgets/Attribution":1578,"esri/widgets/Attribution/AttributionViewModel":1579,"esri/widgets/Compass":1580,"esri/widgets/Compass/CompassViewModel":1581,"esri/widgets/NavigationToggle":1582,"esri/widgets/NavigationToggle/NavigationToggleViewModel":1583,"esri/widgets/Zoom":1584,"esri/widgets/Zoom/IconButton":1585,"esri/widgets/Zoom/ZoomViewModel":1586,"esri/widgets/Zoom/ZoomConditions2D":1587,"esri/widgets/Zoom/ZoomConditions3D":1588,"esri/webmap/background/ColorBackground":1589,"esri/views/GroundView":1590,"esri/views/support/GroundViewElevationSampler":1591,"esri/core/libs/gl-matrix-2/math/mat4":1592,"esri/layers/graphics/dehydratedFeatureComparison":1593,"esri/views/3d/layerViewModuleImportUtils":1594,"esri/views/3d/constraints/Constraints":1595,"esri/views/3d/constraints/AltitudeConstraint":1596,"esri/views/3d/constraints/ClipDistanceConstraint":1597,"esri/views/3d/constraints/CollisionConstraint":1598,"esri/views/3d/constraints/TiltConstraint":1599,"esri/views/3d/environment/SceneViewEnvironment":1600,"esri/views/3d/environment/SceneViewAtmosphere":1601,"esri/views/3d/environment/SceneViewLighting":1602,"esri/webscene/background/utils":1603,"esri/views/3d/environment/SceneViewEnvironmentManager":1604,"esri/views/3d/environment/EnvironmentRenderer":1605,"esri/views/3d/environment/PanoramicAtmosphere":1606,"esri/core/libs/gl-matrix-2/factories/mat4f32":1607,"esri/views/webgl/ShaderTranspiler":1608,"esri/views/webgl/reservedWordsGLSL3":1609,"esri/views/webgl/lib/glsl-tokenizer/string":1610,"esri/views/webgl/lib/glsl-tokenizer/index":1611,"esri/views/webgl/lib/glsl-tokenizer/lib/literals":1612,"esri/views/webgl/lib/glsl-tokenizer/lib/operators":1613,"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":1614,"esri/views/3d/support/buffer/internals/Mat3":1615,"esri/views/3d/support/buffer/internals/Mat4":1616,"esri/views/3d/support/buffer/internals/Scalar":1617,"esri/views/3d/support/buffer/internals/Vec2":1618,"esri/views/3d/support/buffer/internals/Vec3":1619,"esri/views/3d/support/buffer/internals/Vec4":1620,"esri/core/libs/gl-matrix-2/factories/vec3f32":1621,"esri/views/3d/support/geometryUtils/axisAngle":1622,"esri/core/VectorStack":1623,"esri/views/3d/environment/RealisticAtmosphere":1624,"esri/views/3d/environment/RealisticAtmosphereTechnique":1625,"esri/views/3d/environment/SimpleAtmosphere":1626,"esri/views/3d/environment/Stars":1627,"esri/views/3d/environment/StarsTechnique":1628,"esri/views/3d/support/sunUtils":1629,"esri/views/3d/lib/SunCalc":1630,"esri/views/3d/input/SceneInputManager":1631,"esri/views/3d/input/handlers/DoubleClickZoom":1632,"esri/core/libs/gl-matrix-2/math/quat":1633,"esri/views/3d/animation/pointToPoint/Animation":1634,"esri/views/3d/animation/pointToPoint/Camera":1635,"esri/views/animation/pointToPoint/Animation":1636,"esri/views/animation/pointToPoint/Definition":1637,"esri/views/animation/pointToPoint/apex/Path":1638,"esri/views/animation/pointToPoint/Path":1639,"esri/views/animation/pointToPoint/Segment":1640,"esri/views/animation/pointToPoint/apex/planning":1641,"esri/views/animation/pointToPoint/apex/functions":1642,"esri/views/3d/input/handlers/DragRotate":1643,"esri/views/3d/input/handlers/DragZoom":1644,"esri/views/3d/state/controllers/global/ZoomController":1645,"esri/views/3d/state/controllers/local/ZoomController":1646,"esri/views/3d/input/handlers/GamepadNavigation":1647,"esri/views/3d/support/cameraUtilsPlanar":1648,"esri/views/3d/support/cameraUtilsSpherical":1649,"esri/views/3d/input/handlers/KeyboardNavigation":1650,"esri/views/3d/input/handlers/MouseWheelZoom":1651,"esri/views/3d/input/handlers/PinchAndPanNavigation":1652,"esri/views/3d/state/controllers/global/PinchAndPanController":1653,"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":1654,"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":1655,"esri/views/navigation/PanSphericalMomentumEstimator":1656,"esri/views/navigation/FilteredValue":1657,"esri/views/3d/state/controllers/local/PinchAndPanController":1658,"esri/views/3d/input/handlers/PointerDownCancelAnimation":1659,"esri/views/3d/input/handlers/SingleKeyResetHeading":1660,"esri/views/3d/input/handlers/SingleKeyResetTilt":1661,"esri/views/3d/input/handlers/TwoFingerTilt":1662,"esri/views/input/recognizers/VerticalTwoFingerDrag":1663,"esri/views/3d/layers/graphics/GraphicsDeconflictor":1664,"esri/views/3d/layers/graphics/deconflictorDebug":1665,"esri/core/libs/gl-matrix-2/types/mat4":1666,"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":1667,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":1668,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":1669,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":1670,"esri/views/3d/webgl-engine/materials/renderers/Instance":1671,"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":1672,"esri/views/3d/layers/graphics/LabelDeconflictor":1673,"esri/views/3d/layers/graphics/Labeler":1674,"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":1675,"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":1676,"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":1677,"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":1678,"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":1679,"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":1680,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":1681,"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":1682,"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":1683,"esri/views/3d/webgl-engine/lib/LongVectorMath":1684,"esri/views/webgl/enums":1685,"esri/views/webgl/InstanceCounter":1686,"esri/views/webgl/capabilities/load":1687,"esri/views/webgl/capabilities/Instancing":1688,"esri/views/webgl/capabilities/LoseContext":1689,"esri/views/webgl/capabilities/VertexArrayObjects":1690,"esri/views/webgl/ShaderCompiler":1691,"esri/views/webgl/ProgramCache":1692,"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":1693,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":1694,"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":1695,"esri/symbols/cim/TextRasterizer":1696,"esri/symbols/support/cimSymbolUtils":1697,"esri/views/3d/layers/graphics/sdfPrimitives":1698,"esri/views/3d/webgl-engine/lib/DDSUtil":1699,"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":1700,"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":1701,"esri/geometry/support/MeshComponent":1702,"esri/geometry/support/MeshVertexAttributes":1703,"esri/geometry/support/meshUtils/projection":1704,"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":1705,"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":1706,"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":1707,"esri/views/3d/layers/graphics/lodResourceUtils":1708,"esri/views/3d/glTF/DefaultErrorContext":1709,"esri/views/3d/glTF/LoaderResult":1710,"esri/views/3d/glTF/internal/Resource":1711,"esri/views/3d/glTF/internal/BinaryStreamReader":1712,"esri/views/3d/glTF/internal/fillDefaults":1713,"esri/views/3d/glTF/internal/pathUtils":1714,"esri/views/3d/support/buffer/utils/mat3":1715,"esri/views/3d/support/buffer/utils/mat4":1716,"esri/views/3d/support/buffer/utils/scalar":1717,"esri/views/3d/support/buffer/utils/vec2":1718,"esri/views/3d/support/buffer/utils/vec3":1719,"esri/views/3d/support/buffer/utils/vec4":1720,"esri/views/3d/glTF/internal/indexUtils":1721,"esri/views/3d/support/buffer/math":1722,"esri/views/3d/support/buffer/math/vec4":1723,"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":1724,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":1725,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":1726,"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":1727,"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":1728,"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":1729,"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":1730,"esri/core/libs/gl-matrix-2/math/mat2":1731,"esri/views/3d/webgl-engine/lib/pathGeometryUtils":1732,"esri/core/libs/gl-matrix-2/mat2f64":1733,"esri/core/libs/gl-matrix-2/factories/mat2f64":1734,"esri/views/3d/webgl-engine/materials/PathMaterial":1735,"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":1736,"esri/views/3d/webgl-engine/materials/ColorMaterial":1737,"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":1738,"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":1739,"esri/views/3d/webgl-engine/lib/TextTexture":1740,"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":1741,"esri/views/3d/webgl-engine/materials/WaterMaterial":1742,"esri/views/3d/webgl-engine/lib/AnimationTimer":1743,"esri/views/3d/layers/graphics/labelPlacement":1744,"esri/views/3d/webgl-engine/lib/MaterialCollection":1745,"esri/views/3d/webgl-engine/lib/TextTextureAtlas":1746,"esri/views/3d/layers/graphics/ObjectResourceCache":1747,"esri/views/3d/layers/support/FeatureTileTree3D":1748,"esri/views/3d/layers/support/FeatureTileMeasurements3D":1749,"esri/views/3d/layers/support/FeatureTileVisibility3D":1750,"esri/views/3d/state/ViewState":1751,"esri/views/3d/state/ViewStateManager":1752,"esri/views/3d/state/ConstraintsManager":1753,"esri/views/3d/state/NearFarHeuristic":1754,"esri/views/3d/state/SurfaceCollisionConstraint":1755,"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":1756,"esri/views/3d/support/viewpointUtils":1757,"esri/views/3d/state/helpers/SceneIntersectionHelper":1758,"esri/views/3d/support/CombinedElevationProvider":1759,"esri/views/3d/support/DisplayQualityProfile":1760,"esri/views/3d/support/HighlightOptions":1761,"esri/core/libs/gl-matrix-2/factories/vec4f32":1762,"esri/views/3d/support/ResourceController":1763,"esri/views/3d/support/StreamDataLoaderTask":1764,"esri/views/3d/support/MapCoordsHelper":1765,"esri/tasks/operations/generalize":1766,"esri/tasks/operations/lengths":1767,"esri/tasks/operations/offset":1768,"esri/tasks/operations/relation":1769,"esri/tasks/operations/trimExtend":1770,"esri/tasks/support/GeneralizeParameters":1771,"esri/tasks/support/LengthsParameters":1772,"esri/tasks/support/OffsetParameters":1773,"esri/tasks/support/RelationParameters":1774,"esri/tasks/support/TrimExtendParameters":1775,"esri/views/3d/support/QualitySettings":1776,"esri/views/3d/support/RenderCoordsHelper":1777,"esri/views/3d/support/SceneViewPerformanceInfo":1778,"esri/views/3d/support/LayerPerformanceInfo":1779,"esri/views/3d/layers/support/PerformanceInfoLayerView":1780,"esri/layers/support/SpriteSource":1781,"esri/layers/support/vectorTileLayerLoader":1782,"esri/views/2d/engine/vectorTiles/style/VectorTileSource":1783,"esri/views/2d/engine/vectorTiles/tileInfoUtils":1784,"esri/views/2d/engine/vectorTiles/style/Filter":1785,"esri/views/2d/engine/vectorTiles/style/StyleDefinition":1786,"esri/views/2d/engine/vectorTiles/style/StyleProperty":1787,"esri/views/2d/engine/vectorTiles/RenderBucket":1788,"esri/views/3d/terrain/terrainUtilsPlanar":1789,"esri/views/3d/terrain/terrainUtilsSpherical":1790,"esri/views/3d/support/SharedSymbolResources":1791,"esri/views/3d/support/TextureCollection":1792,"esri/views/3d/support/pointsOfInterest/PointsOfInterest":1793,"esri/views/3d/support/pointsOfInterest/CameraOnSurface":1794,"esri/views/3d/support/pointsOfInterest/CenterOnSurface":1795,"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":1796,"esri/views/3d/support/pointsOfInterest/Focus":1797,"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":1798,"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":1799,"esri/views/3d/terrain/TerrainSurface":1800,"esri/views/3d/terrain/OverlayManager":1801,"esri/views/3d/terrain/PlanarPatch":1802,"esri/views/3d/support/buffer/BufferPool":1803,"esri/views/3d/terrain/TilePerLayerInfo":1804,"esri/views/3d/terrain/SphericalPatch":1805,"esri/views/3d/terrain/SurfaceExtentHelper":1806,"esri/views/3d/terrain/SurfaceTilingSchemeLogic":1807,"esri/views/3d/terrain/TerrainRenderer":1808,"esri/views/3d/terrain/PatchRenderData":1809,"esri/views/3d/terrain/TextureFader":1810,"esri/views/3d/terrain/TileRenderer":1811,"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":1812,"esri/views/3d/terrain/BlendLayersTechnique":1813,"esri/views/3d/terrain/RasterColorizerTechnique":1814,"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":1815,"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":1816,"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":1817,"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":1818,"esri/views/3d/terrain/support/FBOPool":1819,"esri/views/3d/webgl-engine/lib/webgl-debug":1820,"esri/views/3d/webgl-engine/shaders/TerrainTechnique":1821,"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":1822,"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":1823,"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":1824,"esri/views/3d/terrain/UpsampleInfo":1825,"esri/views/3d/webgl-engine/Stage":1826,"esri/views/3d/webgl-engine/parts/Model":1827,"esri/views/3d/webgl-engine/lib/ModelContentType":1828,"esri/views/3d/webgl-engine/lib/ModelDirtySet":1829,"esri/views/3d/webgl-engine/parts/RenderView":1830,"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":1831,"esri/core/libs/gl-matrix-2/factories/quatf32":1832,"esri/views/3d/support/dito":1833,"esri/views/3d/webgl-engine/collections/Component/interface":1834,"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":1835,"esri/views/3d/webgl-engine/collections/Component/DepthRange":1836,"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":1837,"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":1838,"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":1839,"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":1840,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":1841,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":1842,"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":1843,"esri/views/3d/webgl-engine/core/material/MaterialBase":1844,"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":1845,"esri/views/3d/webgl-engine/lib/ComponentUtils":1846,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":1847,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":1848,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":1849,"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":1850,"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":1851,"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":1852,"esri/views/3d/webgl-engine/lib/CompositingHelper":1853,"esri/views/3d/webgl-engine/shaders/CompositingTechnique":1854,"esri/views/3d/webgl-engine/lib/Renderer":1855,"esri/core/TimeProfiler":1856,"esri/views/3d/webgl-engine/lib/depthRangeUtils":1857,"esri/views/3d/webgl-engine/lib/FxaaRenderPass":1858,"esri/views/3d/webgl-engine/lib/HighlightHelper":1859,"esri/views/3d/webgl-engine/shaders/HighlightTechnique":1860,"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":1861,"esri/views/3d/webgl-engine/lib/RenderTargetHelper":1862,"esri/views/3d/webgl-engine/lib/RenderPluginManager":1863,"esri/views/3d/webgl-engine/lib/ShadowMap":1864,"esri/views/3d/webgl-engine/lib/SliceHelper":1865,"esri/views/3d/webgl-engine/lib/SmaaRenderPass":1866,"esri/views/3d/webgl-engine/lib/SSAOHelper":1867,"esri/views/3d/webgl-engine/lib/SSAOTechnique":1868,"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":1869,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":1870,"esri/views/3d/webgl-engine/lib/LocalOriginManager":1871,"esri/views/3d/support/meshProcessing":1872,"esri/views/3d/support/buffer/workerHelper":1873,"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":1874,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":1875,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":1876,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":1877,"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":1878,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":1879,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":1880,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":1881,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":1882,"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":1883,"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":1884,"esri/views/3d/webgl-engine/lib/edgeRendering/util":1885,"esri/views/webgl/Profiling":1886,"esri/views/3d/webgl-engine/lib/TextureRepository":1887,"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":1888,"esri/views/3d/webgl-engine/parts/ScreenshotManager":1889,"esri/views/ui/3d/DefaultUI3D":1890,"esri/widgets/Expand/ExpandViewModel":1891},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[4],Array(151).concat([function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1408),r(1409),r(573),r(1410),r(1411),r(515),r(760),r(1412),r(1092),r(1096),r(616)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t),r.__exportStar(i,t),r.__exportStar(o,t),r.__exportStar(a,t),r.__exportStar(s,t),r.__exportStar(l,t),r.__exportStar(c,t),r.__exportStar(u,t),r.__exportStar(p,t),r.__exportStar(d,t),r.__exportStar(h,t)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return null!=e}function n(e,t,n){return r(e)?n(e):t}Object.defineProperty(t,"__esModule",{value:!0}),t.isSome=r,t.isNone=function(e){return null==e},t.isUndefined=function(e){return void 0===e},t.applySome=function(e,t){return r(e)?t(e):null},t.unwrap=function(e){return e},t.unwrapOr=function(e,t){return r(e)?e:"function"==typeof t?t():t},t.destroyMaybe=function(e){return r(e)&&e.destroy(),null},t.mapSome=function(e,t){var n=new Array;return e.forEach((function(e){var i=t(e);r(i)&&n.push(i)})),n},t.mapMany=function(e,t){for(var r=new Array,i=0,o=e;i<o.length;i++){var a=o[i];r.push(n(a,null,t))}return r},t.forEachSome=function(e,t){for(var r=0,i=e;r<i.length;r++)n(i[r],null,t)},t.mapOr=n,t.andThen=function(e,t){return r(e)?t(e):null},t.mapSomeFirst=function(e,t){for(var n=0,i=e;n<i.length;n++){var o=t(i[n]);if(r(o))return o}return null},t.get=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=e,i=0;i<t.length&&n;)n=n[t[i++]];return n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1418),r(618),r(154),r(270),r(156),r(152),r(161)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=s.getLogger("esri");function u(e){return Promise.all(e)}function p(e){return new Promise((function(t,r){try{e(t,r)}catch(e){Promise.resolve().then((function(){return r(e)}))}}))}function d(e){return void 0===e&&(e="Aborted"),new o("AbortError",e)}function h(){return new n.default}function f(e){if(m(e))throw d()}function v(e){return l.isSome(e)?"aborted"in e?e:e.signal:e}function m(e){var t=v(e);return l.isSome(t)&&t.aborted}function y(e,t){var r=v(e);if(!l.isNone(r)){if(!r.aborted)return a.once(r,"abort",(function(){return t()}));t()}}function g(e){return e&&"AbortError"===e.name}function _(){var e=null,t=p((function(t,r){e={resolve:t,reject:r}}));return e.promise=t,e}function b(e){if(e){if("function"!=typeof e.forEach){var t=Object.keys(e);return b(t.map((function(t){return e[t]}))).then((function(e){var r={};return t.forEach((function(t,n){return r[t]=e[n]})),r}))}var r=e,n=x;return p((function(e){var t=[],i=r.length;0===i&&e(t),r.forEach((function(r){var o={promise:r||n(r)};t.push(o),o.promise.then((function(e){o.value=e})).catch((function(e){o.error=e})).then((function(){0==--i&&e(t)}))}))}))}}function x(e){return void 0===e&&(e=void 0),Promise.resolve(e)}function w(e,t,r){void 0===t&&(t=void 0);var n=h();return y(r,(function(){return n.abort()})),p((function(r,i){var o=setTimeout((function(){o=0,r(t)}),e);y(n,(function(){o&&(clearTimeout(o),i(d()))}))}))}function S(e){return e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then?e:x(e)}t.all=u,t.filter=function(e,t){var r=e.slice();return u(e.map((function(e,r){return t(e,r)}))).then((function(e){return r.filter((function(t,r){return e[r]}))}))},t.create=p,t.createAbortError=d,t.createAbortController=h,t.throwIfAborted=f,t.isAborted=m,t.throwIfAbortError=function(e){if(g(e))throw e},t.throwIfNotAbortError=function(e){if(!g(e))throw e},t.onAbort=y,t.onAbortOrThrow=function(e,t){var r=v(e);if(!l.isNone(r))return f(r),a.once(r,"abort",(function(){return t(d())}))},t.isAbortError=g,t.ignoreAbortErrors=function(e){return e.catch((function(e){if(!g(e))throw e}))},t.logOnError=function(e,t){return e.catch((function(e){g(e)||(t=l.isSome(t)?t:c).error(e)}))},t.createDeferred=_,t.eachAlways=b,t.isThenable=function(e){return e&&"function"==typeof e.then},t.eachAlwaysValues=function(e){return b(e).then((function(e){return e.filter((function(e){return!!e.value})).map((function(e){return e.value}))}))},t.first=function(e){return e&&e.length?p((function(t,r){for(var n=0,i=e;n<i.length;n++)i[n].then(t,r)})):x()},t.reject=function(e){return Promise.reject(e)},t.resolve=x,t.after=w,t.timeout=function(e,t,r,n){var i=r&&"abort"in r?r:null;null!=n||i||(n=r);var a=setTimeout((function(){a=0,i&&i.abort()}),t),s=function(){throw n||new o("promiseUtils:timeout","The wrapped promise did not resolve within "+t+" ms")};return e.then((function(e){if(0===a)throw s();return clearTimeout(a),e}),(function(e){throw clearTimeout(a),0===a?s():e}))},t.isPromiseLike=function(e){return e&&"function"==typeof e.then},t.when=S,t.debounce=function(e,t){var n,i,o,a;void 0===t&&(t=-1);var s=null,l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];if(n){i=c,a&&a.reject(d());var p=(a=_()).promise;if(s){var f=s;s=null,f.abort()}return p}if(o=a||_(),a=null,t>0){var v=h(),m=n=S(e.apply(void 0,r.__spreadArrays(c,[v.signal])));w(t).then((function(){n===m&&(a?v.abort():s=v)}))}else n=1,n=S(e.apply(void 0,c));var y=function(){var e=i;i=o=n=s=null,null!=e&&l.apply(void 0,e)},g=n,b=o;return g.then(y,y),g.then(b.resolve,b.reject),b.promise};return l},t.createResolver=function(){var e,t,r=p((function(r,n){e=r,t=n})),n=function(t){e(t)};return n.resolve=function(t){return e(t)},n.reject=function(e){return t(e)},n.timeout=function(e,t){return i.default.setTimeout((function(){return n.reject(t)}),e)},n.promise=r,n},t.always=function(e,t){return e.then(t,t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(156),r(1097)],void 0===(i=function(e,t,r,n,i,o){var a=function(e){function t(r,n,i){var o=e.call(this,r,n,i)||this;return o instanceof t?o:new t(r,n,i)}return r.__extends(t,e),t.prototype.toJSON=function(){if(null!=this.details)try{var e=n.clone(this.details);return{name:this.name,message:this.message,details:e}}catch(e){throw i.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}},t.fromJSON=function(e){return new t(e.name,e.message,e.details)},t}(o);return a.prototype.type="error",a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(857),r(619)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");var r=new this;return r.read(e,t),r}Object.defineProperty(t,"__esModule",{value:!0}),t.JSONSupportMixin=function(e){var t=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.apply(this,t)||this}return r.__extends(t,e),t.prototype.read=function(e,t){o.default(this,e,t)},t.prototype.write=function(e,t){return a.default(this,e||{},t)},t.prototype.toJSON=function(e){return this.write(null,e)},t.fromJSON=function(e,t){return s.call(this,e,t)},r.__decorate([i.subclass("esri.core.JSONSupport")],t)}(e);return t.prototype.toJSON.isDefaultToJSON=!0,t},t.isJSONSupport=function(e){return e&&"read"in e&&"write"in e&&"toJSON"in e};var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([i.subclass("esri.core.JSONSupport")],t)}(t.JSONSupportMixin(n));t.JSONSupport=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(229),r(161)],void 0===(i=function(e,t,r,n,i){var o={info:0,warn:1,error:2},a=function(){function e(t){void 0===t&&(t={}),this._loggedMessages={error:new Map,warn:new Map,info:new Map},this.module=t.module||"",this.writer=t.writer||null,this.level=t.level||null,null!=t.enabled&&(this.enabled=!!t.enabled),e._loggers[this.module]=this;var r=this.module.lastIndexOf(".");-1!==r&&(this.parent=e.getLogger(this.module.slice(0,r)))}return e.prototype.log=function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(this._isEnabled()&&this._matchLevel(t)){if("always"!==n&&!e._throttlingDisabled){var a=this._argsToKey(i),s=this._loggedMessages[t].get(a);if("once"===n&&null!=s||"oncePerTick"===n&&s>=e._tickCounter)return;this._loggedMessages[t].set(a,e._tickCounter),e._scheduleTickCounterIncrement()}var l=this._inheritedWriter();l&&l.apply(void 0,r.__spreadArrays([t,this.module],i))}},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["error","always"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["warn","always"],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["info","always"],e))},e.prototype.errorOnce=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["error","once"],e))},e.prototype.warnOnce=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["warn","once"],e))},e.prototype.infoOnce=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["info","once"],e))},e.prototype.errorOncePerTick=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["error","oncePerTick"],e))},e.prototype.warnOncePerTick=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["warn","oncePerTick"],e))},e.prototype.infoOncePerTick=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log.apply(this,r.__spreadArrays(["info","oncePerTick"],e))},e.prototype.getLogger=function(t){return e.getLogger(this.module+"."+t)},Object.defineProperty(e,"test",{get:function(){return{resetLoggers:function(t){void 0===t&&(t={});var r=e._loggers;return e._loggers=t,r},set throttlingDisabled(t){e._throttlingDisabled=t}}},enumerable:!0,configurable:!0}),e.getLogger=function(t){var r=e._loggers[t];return r||(r=new e({module:t})),r},e.prototype._parentWithMember=function(e,t){for(var r=this;r&&null==r[e];)r=r.parent;return r?r[e]:t},e.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)},e.prototype._consoleWriter=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];console[e].apply(console,r.__spreadArrays(["["+t+"]"],n))},e.prototype._matchLevel=function(e){return o[this._parentWithMember("level","error")]<=o[e]},e.prototype._isEnabled=function(){return this._parentWithMember("enabled",!0)},e.prototype._argsToKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=function(e,t){return"object"!=typeof t||Array.isArray(t)?t:"[Object]"};return i.numericHash(JSON.stringify(e,r))},e._scheduleTickCounterIncrement=function(){e._tickCounterScheduled||(e._tickCounterScheduled=!0,Promise.resolve().then((function(){e._tickCounter++,e._tickCounterScheduled=!1})))},e._loggers={},e._tickCounter=0,e._tickCounterScheduled=!1,e._throttlingDisabled=!1,e}(),s=a.getLogger("esri");return n("esri-debug-messages")?s.level="info":s.level="warn",a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(270),r(118),r(153)],void 0===(i=function(e,t,r,n,i){function o(e,t,r,n,i){var o=e.watch(t,(function(t,i,o,a){r&&!r(t)||n.call(e,t,i,o,a)}),i);if(Array.isArray(t))for(var a=0,s=t;a<s.length;a++){var l=s[a],c=e.get(l);r&&r(c)&&n.call(e,c,c,t,e)}else c=e.get(t),r&&r(c)&&n.call(e,c,c,t,e);return o}function a(e,t,r,n,a){var s="function"==typeof n?n:null,l="object"==typeof n?n:null;"boolean"==typeof n&&(a=n);var c,u=!1;function p(){c&&(c.remove(),c=null)}var d=i.createDeferred();i.onAbort(l,(function(){p(),d.reject(i.createAbortError())}));var h={then:d.promise.then.bind(d.promise),catch:d.promise.catch.bind(d.promise),remove:p};return Object.freeze(h),c=o(e,t,r,(function(t,r,n,i){u=!0,p(),s&&s.call(e,t,r,n,i),d.resolve({value:t,oldValue:r,propertyName:n,target:i})}),a),u&&p(),h}function s(e){return!!e}function l(e){return!e}function c(e){return!0===e}function u(e){return!1===e}function p(e){return void 0!==e}function d(e){return void 0===e}Object.defineProperty(t,"__esModule",{value:!0}),t.whenValidOnce=a;var h=/\?(\.|$)/g;function f(e,t,r,n){for(var i=Array.isArray(t)?t:t.indexOf(",")>-1?t.split(","):[t],o=v(e,t,r,n),a=0,s=i;a<s.length;a++){var l=s[a].trim().replace(h,"$1"),c=e.get(l);r.call(e,c,c,l,e)}return o}function v(e,t,r,n){return e.watch(t,r,n)}t.init=f,t.watch=v,t.once=function(e,t,r,n){return a(e,t,null,r,n)},t.when=function(e,t,r,n){return o(e,t,s,r,n)},t.whenOnce=function(e,t,r,n){return a(e,t,s,r,n)},t.whenNot=function(e,t,r,n){return o(e,t,l,r,n)},t.whenNotOnce=function(e,t,r,n){return a(e,t,l,r,n)},t.whenTrue=function(e,t,r,n){return o(e,t,c,r,n)},t.whenTrueOnce=function(e,t,r,n){return a(e,t,c,r,n)},t.whenFalse=function(e,t,r,n){return o(e,t,u,r,n)},t.whenFalseOnce=function(e,t,r,n){return a(e,t,u,r,n)},t.whenDefined=function(e,t,r,n){return o(e,t,p,r,n)},t.whenDefinedOnce=function(e,t,r,n){return a(e,t,p,r,n)},t.whenUndefined=function(e,t,r,n){return o(e,t,d,r,n)},t.whenUndefinedOnce=function(e,t,r,n){return a(e,t,d,r,n)},t.whenEqual=function(e,t,r,i,a){return o(e,t,(function(e){return n.equals(r,e)}),i,a)},t.whenEqualOnce=function(e,t,r,i,o){return a(e,t,(function(e){return n.equals(r,e)}),i,o)},t.pausable=function(e,t,r,n){var i=!1,o=e.watch(t,(function(t,n,o,a){i||r.call(e,t,n,o,a)}),n);return{remove:function(){o.remove()},pause:function(){i=!0},resume:function(){i=!1}}},t.on=function(e,t,n,i,o,a,s){var l={};function c(t){var r=l[t];r&&(a&&a(r.target,t,e,n),r.handle.remove(),delete l[t])}var u=f(e,t,(function(t,a,s){c(s),r.isEventTarget(t)&&(l[s]={handle:r.on(t,n,i),target:t},o&&o(t,s,e,n))}),s);return{remove:function(){for(var e in u.remove(),l)c(e)}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(335),r(156),r(151),r(614),r(1419),r(1091),r(1421),r(855)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){function p(e){var t=typeof e;return null==e?{value:e}:Array.isArray(e)?{type:[e[0]],value:null}:"object"===t?e.constructor&&e.constructor.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e:"boolean"===t?{type:Boolean,value:e}:"string"===t?{type:String,value:e}:"number"===t?{type:Number,value:e}:"function"===t?{type:e,value:null}:void 0}return function(){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(this.constructor===e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new s.default(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t)),c.interceptor&&c.interceptor.onInstanceConstruct(this)}return e.createSubclass=function(e){if(void 0===e&&(e={}),Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");var t=e.properties,n=e.declaredClass,i=e.constructor;delete e.declaredClass,delete e.properties,delete e.constructor;var a=this,s=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return i&&i.apply(n,t),n}return r.__extends(t,e),t}(a);s.__accessorMetadata__=a.__accessorMetadata__;var l=function(t){var r=e[t];s.prototype[t]="function"==typeof r?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.inherited=function(){if(a.prototype[t])return a.prototype[t].apply(this,e)};var i=r.apply(this,e);return this.inherited=null,i}:e[t]};for(var c in e)l(c);for(var c in t){var u=p(t[c]);o.property(u)(s.prototype,c)}return o.subclass(n)(s)},e.prototype.postscript=function(e){var t=this.__accessor__,r=t.ctorArgs||e;t.initialize(),r&&(this.set(r),t.ctorArgs=null),t.constructed(),this.initialize()},e.prototype.initialize=function(){},e.prototype.destroy=function(){if(this.destroyed)try{throw new Error("instance is already destroyed")}catch(e){console.warn(e.stack)}else u.removeTarget(this),this.__accessor__.destroy(),c.interceptor&&c.interceptor.onInstanceDestroy(this)},Object.defineProperty(e.prototype,"initialized",{get:function(){return this.__accessor__&&this.__accessor__.initialized||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"constructed",{get:function(){return this.__accessor__&&2===this.__accessor__.lifecycle||!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.__accessor__&&this.__accessor__.destroyed||!1},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return a.default(this,e)},e.prototype.hasOwnProperty=function(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)},e.prototype.isInstanceOf=function(e){return n.deprecatedFunction(i.getLogger(this.declaredClass),"isInstanceOf",{replacement:"Use instanceof directly",version:"4.16"}),this instanceof e},e.prototype.keys=function(){return this.__accessor__?this.__accessor__.keys():[]},e.prototype.set=function(e,t){return l.default(this,e,t),this},e.prototype.watch=function(e,t,r){return u.default(this,e,t,r)},e.prototype._clearOverride=function(e){return this.__accessor__.clearOverride(e)},e.prototype._override=function(e,t){return this.__accessor__.override(e,t)},e.prototype._isOverridden=function(e){return this.__accessor__.isOverridden(e)},e.prototype.notifyChange=function(e){this.__accessor__.propertyInvalidated(e)},e.prototype._get=function(e){return this.__accessor__.internalGet(e)},e.prototype._set=function(e,t){return this.__accessor__.internalSet(e,t),this},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(179),r(184),r(215),r(352),r(202),r(232),r(259),r(170),r(163)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0}),t.Extent=i,t.BaseGeometry=o,t.Multipoint=a,t.Point=s,t.Polygon=l,t.Polyline=c,t.SpatialReference=u,t.isGeometry=function(e){return e instanceof o},t.fromJSON=p.fromJSON,t.typeKebabDictionary=r.strict()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"}),t.isFeatureGeometryType=function(e){return"point"===e||"multipoint"===e||"polyline"===e||"polygon"===e},t.featureGeometryTypeKebabDictionary=r.strict()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),t.geometryTypes={base:o,key:"type",typeMap:{extent:i,multipoint:a,point:s,polyline:c,polygon:l}},t.ensureType=n.ensureOneOfType(t.geometryTypes)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(639)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3f64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(117),i=r(122),o=r(1406);r(758);var a,s=r(123);t.ShimPromise=i.default.Promise,t.isThenable=function(e){return e&&"function"==typeof e.then},s.default("es6-promise")||(i.default.Promise=t.ShimPromise=((a=function(){function e(r){var n=this;this.state=1,this[Symbol.toStringTag]="Promise";var i=!1,a=[],s=function(e){a&&a.push(e)},l=function(e,t){1===n.state&&(n.state=e,n.resolvedValue=t,s=o.queueMicroTask,a&&a.length>0&&o.queueMicroTask((function(){if(a){for(var e=a.length,t=0;t<e;++t)a[t].call(null);a=null}})))},c=function(e,r){1!==n.state||i||(t.isThenable(r)?(r.then(l.bind(null,0),l.bind(null,2)),i=!0):l(e,r))};this.then=function(t,r){return new e((function(e,i){s((function(){var o=2===n.state?r:t;if("function"==typeof o)try{e(o(n.resolvedValue))}catch(e){i(e)}else 2===n.state?i(n.resolvedValue):e(n.resolvedValue)}))}))};try{r(c.bind(null,0),c.bind(null,2))}catch(e){l(2,e)}}return e.all=function(r){return new this((function(i,o){var a=[],s=0,l=0,c=!0;function u(e,t){a[e]=t,++s,p()}function p(){c||s<l||i(a)}var d,h,f,v,m=0;try{for(var y=n.__values(r),g=y.next();!g.done;g=y.next()){var _=g.value;d=m,h=_,++l,t.isThenable(h)?h.then(u.bind(null,d),o):e.resolve(h).then(u.bind(null,d)),m++}}catch(e){f={error:e}}finally{try{g&&!g.done&&(v=y.return)&&v.call(y)}finally{if(f)throw f.error}}c=!1,p()}))},e.race=function(t){return new this((function(r,i){try{for(var o=n.__values(t),a=o.next();!a.done;a=o.next()){var s=a.value;s instanceof e?s.then(r,i):e.resolve(s).then(r)}}catch(e){l={error:e}}finally{try{a&&!a.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}var l,c}))},e.reject=function(e){return new this((function(t,r){r(e)}))},e.resolve=function(e){return new this((function(t){t(e)}))},e.prototype.catch=function(e){return this.then(void 0,e)},e}())[Symbol.species]=t.ShimPromise,a)),s.default("es2018-promise-finally")||(i.default.Promise.prototype.finally=function(e){return this.then(e&&function(t){return Promise.resolve(e()).then((function(){return t}))},e&&function(t){return Promise.resolve(e()).then((function(){throw t}))})}),t.default=t.ShimPromise},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1146)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(184),r(215),r(352),r(202),r(232),r(259)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function c(e){return void 0!==e.points}function u(e){return void 0!==e.x&&void 0!==e.y}function p(e){return void 0!==e.paths}function d(e){return void 0!==e.rings}function h(e){return e?e instanceof n?e:u(e)?o.fromJSON(e):p(e)?s.fromJSON(e):d(e)?a.fromJSON(e):c(e)?i.fromJSON(e):l(e)?r.fromJSON(e):null:null}Object.defineProperty(t,"__esModule",{value:!0}),t.fromJson=function(e){try{throw new Error("fromJson is deprecated, use fromJSON instead")}catch(e){console.warn(e.stack)}return h(e)},t.isExtent=l,t.isMultipoint=c,t.isPoint=u,t.isPolyline=p,t.isPolygon=d,t.isMesh=function(e){return void 0!==e.vertexAttributes},t.fromJSON=h,t.getJsonType=function(e){return e?u(e)?"esriGeometryPoint":p(e)?"esriGeometryPolyline":d(e)?"esriGeometryPolygon":l(e)?"esriGeometryEnvelope":c(e)?"esriGeometryMultipoint":null:null};var f={esriGeometryPoint:o,esriGeometryPolyline:s,esriGeometryPolygon:a,esriGeometryEnvelope:r,esriGeometryMultipoint:i};t.getGeometryType=function(e){return e&&f[e]||null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(121),r(849)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;function c(e){return"function"==typeof l[e]?l[e]=l[e](i):l[e]}n.has||(null===(a=i.dojoConfig)||void 0===a?void 0:a.has)?(l=r.__assign(r.__assign({},null===(s=i.dojoConfig)||void 0===s?void 0:s.has),n.has),delete n.has):l={},c.add=function(e,t,r,n){return(n||void 0===l[e])&&(l[e]=t),r&&c(e)},c.cache=l,function(){c.add("host-webworker",void 0!==i.WorkerGlobalScope&&self instanceof i.WorkerGlobalScope);var e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(c.add("host-browser",e),c.add("host-node","object"==typeof i.process&&i.process.versions&&i.process.versions.node&&i.process.versions.v8),c.add("dom",e),c("host-browser")){var t=navigator,r=t.userAgent,n=t.appVersion,o=parseFloat(n);if(c.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),c.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),c.add("khtml",n.indexOf("Konqueror")>=0?o:void 0),c.add("edge",parseFloat(r.split("Edge/")[1])||void 0),c.add("opr",parseFloat(r.split("OPR/")[1])||void 0),c.add("webkit",!c("wp")&&!c("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),c.add("chrome",!c("edge")&&!c("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),c.add("android",!c("wp")&&parseFloat(r.split("Android ")[1])||void 0),c.add("safari",!(n.indexOf("Safari")>=0)||c("wp")||c("chrome")||c("android")||c("edge")||c("opr")?void 0:parseFloat(n.split("Version/")[1])),c.add("mac",n.indexOf("Macintosh")>=0),c.add("quirks","BackCompat"===document.compatMode),!c("wp")&&r.match(/(iPhone|iPod|iPad)/)){var a=RegExp.$1.replace(/P/,"p"),s=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(s.replace(/_/,".").replace(/_/g,""));c.add(a,l),c.add("ios",l)}c.add("trident",parseFloat(n.split("Trident/")[1])||void 0),c.add("svg","undefined"!=typeof SVGAngle),c("webkit")||(r.indexOf("Opera")>=0&&c.add("opera",o>=9.8&&parseFloat(r.split("Version/")[1])||o),!(r.indexOf("Gecko")>=0)||c("wp")||c("khtml")||c("trident")||c("edge")||c.add("mozilla",o),c("mozilla")&&c.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}}(),c.add("esri-debug-messages",!1),c.add("esri-deprecation-warnings",!0),function(){if(i.navigator){var e=navigator.userAgent,t=e.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i),r=e.match(/iPhone/i);t&&c.add("esri-mobile",t),r&&c.add("esri-iPhone",r),c.add("esri-geolocation",!!navigator.geolocation)}c.add("esri-canvas-svg-support",!c("trident")),c.add("esri-secure-context",(function(){return"isSecureContext"in i?i.isSecureContext:i.location&&i.location.origin?0===i.location.origin.indexOf("https:"):void 0})),c.add("esri-wasm","WebAssembly"in i),c.add("esri-shared-array-buffer",(function(){var e="SharedArrayBuffer"in i,t=!1===i.crossOriginIsolated;return e&&!t})),c.add("esri-atomics","Atomics"in i),c.add("esri-workers","Worker"in i),c.add("esri-text-decoder","TextDecoder"in i),c.add("esri-text-encoder","TextEncoder"in i),c("host-webworker")||(c.add("esri-abortable-fetch","fetch"in i&&"signal"in new Request("https://www.arcgis.com")),c("host-node")||(c.add("csp-restrictions",(function(){try{new Function}catch(e){return!0}return!1})),c.add("esri-image-decode",(function(){if("decode"in new Image){var e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((function(){c.add("esri-image-decode",!0,!0,!0)})).catch((function(){c.add("esri-image-decode",!1,!0,!0)}))}return!1})),c.add("esri-url-encodes-apostrophe",(function(){var e=i.document.createElement("a");return e.href="?'",e.href.indexOf("?%27")>-1})),c.add("esri-webgl",(function(){return p().available})),c.add("esri-webgl-high-precision-fragment",(function(){return p().supportsHighPrecisionFragment})),c.add("esri-webgl-vertex-shader-samplers",(function(){return p().supportsVertexShaderSamplers})),c.add("esri-webgl-element-index-uint",(function(){return p().supportsElementIndexUint})),c.add("esri-webgl-standard-derivatives",(function(){return p().supportsStandardDerivatives})),c.add("esri-webgl-texture-float",(function(){return p().supportsTextureFloat})),c.add("esri-webgl-color-buffer-float",(function(){return p().supportsColorBufferFloat})),c.add("esri-webgl-instanced-arrays",(function(){return p().supportsInstancedArrays})),c.add("esri-webgl-major-performance-caveat",(function(){return p().majorPerformanceCaveat})),c.add("esri-featurelayer-webgl",!0),c.add("esri-featurelayer-webgl-labeling",!0),c.add("esri-webgl2",(function(){return function(){if(d)return d;if(d={available:!1,version:0},void 0===typeof WebGL2RenderingContext)return d;var e=document.createElement("canvas");if(!e)return d;var t=o.createContext(e,{},"webgl2");if(!t)return d;d.available=!0;var r=t.getParameter(t.VERSION);if(!r)return d;var n=r.match(/^WebGL\s+([\d.]*)/);return n&&(d.version=parseFloat(n[1])),d}().available})),c.add("esri-webgl-max-texture-size",(function(){return p().maxTextureSize}))))}();var u=null;function p(){if(u)return u;if(u={available:!1,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,supportsTextureFloat:!1,supportsColorBufferFloat:!1,version:0},void 0===typeof WebGLRenderingContext)return u;var e=document.createElement("canvas");if(!e)return u;var t=o.createContext(e,{failIfMajorPerformanceCaveat:!0},"webgl");if(t||(t=o.createContext(e,{},"webgl"))&&(u.majorPerformanceCaveat=!0),!t)return u;var r=t.getParameter(t.VERSION);if(!r)return u;var n=r.match(/^WebGL\s+([\d.]*)/);if(n){u.version=parseFloat(n[1]),u.available=u.version>=.94;var i=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);i&&(u.supportsHighPrecisionFragment=i.precision>0),u.supportsVertexShaderSamplers=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,u.supportsElementIndexUint=null!==t.getExtension("OES_element_index_uint"),u.supportsStandardDerivatives=null!==t.getExtension("OES_standard_derivatives"),u.supportsInstancedArrays=null!==t.getExtension("ANGLE_instanced_arrays"),u.supportsTextureFloat=null!==t.getExtension("OES_texture_float"),u.supportsColorBufferFloat=null!==t.getExtension("WEBGL_color_buffer_float")}return u.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),u}var d=null;return c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(336),r(154),r(121),r(164),r(118),r(152),r(153),r(229),r(172),r(1099),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f){function v(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,a,s,c,d;return n.__generator(this,(function(f){switch(f.label){case 0:return r=h.isDataProtocol(e),(i=h.isBlobProtocol(e))||r||(e=h.normalize(e)),o={url:e,requestOptions:n.__assign({},u.unwrap(t))},(a=h.getInterceptor(e))?[4,A(a,o)]:[3,2];case 1:if(null!=(s=f.sent()))return[2,{data:s,getHeader:w,requestOptions:o.requestOptions,url:o.url}];a.after||a.error||(a=null),f.label=2;case 2:if(e=o.url,"image"===(t=o.requestOptions).responseType){if(l("host-webworker")||l("host-node"))throw S("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),o)}else if(r)throw S("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),o);if("head"===t.method){if(t.body)throw S("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),o);if(r||i)throw S("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),o)}return[4,P()];case 3:return f.sent(),m?[2,m.execute(e,t)]:(c=p.createAbortController(),p.onAbort(t,(function(){return c.abort()})),[4,I({controller:c,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:a,params:o,redoRequest:!1,useIdentity:y.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1})]);case 4:return d=f.sent(),a&&a.after&&a.after(d),[2,d]}}))}))}var m,y=i.request,g="FormData"in s,_=[499,498,403,401],b=["COM_0056","COM_0057","SB_0008"],x=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],w=function(){return null};function S(e,t,r,n){var i="Error",o={url:r.url,requestOptions:r.requestOptions,getHeader:w,ssl:!1};if(t instanceof a)return t.details?(t.details=c.clone(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=o,t;if(t){var s=n&&function(e){return n.headers.get(e)},l=n&&n.status,u=t.message;u&&(i=u),s&&(o.getHeader=s),o.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||l||0,o.subCode=t.subcode,o.messageCode=t.messageCode,"string"==typeof t.details?o.messages=[t.details]:o.messages=t.details}return p.isAbortError(t)?p.createAbortError():new a(e,i,o)}function P(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return l("host-webworker")?m?[3,2]:[4,new Promise((function(e,t){r.e(139).then(function(){var t=[r(2012)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:[3,3];case 1:m=t.sent(),t.label=2;case 2:return[3,6];case 3:return v._abortableFetch?[3,6]:l("esri-abortable-fetch")?(v._abortableFetch=s.fetch.bind(s),[3,6]):[3,4];case 4:return e=v,[4,new Promise((function(e,t){r.e(257).then(function(){var t=[r(2013)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 5:e._abortableFetch=t.sent().fetch,t.label=6;case 6:return[2]}}))}))}function T(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return o.id?[3,2]:[4,new Promise((function(e,t){r.e(80).then(function(){var t=[r(2014)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}function O(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,a,l,c,u,d;return n.__generator(this,(function(n){switch(n.label){case 0:return t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,a=r.body,l=null,c=null,u=null,g&&"HTMLFormElement"in s&&(a instanceof FormData?l=a:a instanceof HTMLFormElement&&(c=a,l=new FormData(c))),"string"==typeof a&&(u=a),e.fetchOptions={cache:r.cacheBust&&!v._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:"head"===r.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:i},(l||u)&&(e.fetchOptions.body=l||u),"anonymous"===r.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query&&r.query.token||l&&l.get&&l.get("token")||c&&c.elements.token),!e.useIdentity||e.hasToken||e.credentialToken||C(t)||p.isAborted(i)?[3,11]:(d=void 0,"immediate"!==r.authMode?[3,3]:[4,T()]);case 1:return n.sent(),[4,o.id.getCredential(t,{signal:i})];case 2:return d=n.sent(),e.credential=d,[3,10];case 3:return"no-prompt"!==r.authMode?[3,9]:[4,T()];case 4:n.sent(),n.label=5;case 5:return n.trys.push([5,7,,8]),[4,o.id.getCredential(t,{prompt:!1,signal:i})];case 6:return d=n.sent(),e.credential=d,[3,8];case 7:return n.sent(),[3,8];case 8:return[3,10];case 9:o.id&&(d=o.id.findCredential(t)),n.label=10;case 10:d&&(e.credentialToken=d.token,e.useSSL=!!d.ssl),n.label=11;case 11:return[2]}}))}))}function C(e){return x.some((function(t){return t.test(e)}))}function M(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,a,s,c,u,f,m,_,b,x,w,P,T,O,C,M,A,I,R,L;return n.__generator(this,(function(j){switch(j.label){case 0:if(t=e.params.url,r=e.params.requestOptions,i=e.fetchOptions,a=h.isBlobProtocol(t)||h.isDataProtocol(t),s=r.responseType||"json",c=a?0:null!=r.timeout?r.timeout:y.timeout,u=!1,!a){if(e.useSSL&&(t=h.toHTTPS(t)),r.cacheBust&&"default"===i.cache&&(t=h.addQueryParameter(t,"request.preventCache",Date.now())),f=n.__assign({},r.query),e.credentialToken&&(f.token=e.credentialToken),m=h.objectToQuery(f),l("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27")),_=t.length+1+m.length,b=void 0,u="post"===r.method||!!r.body||_>y.maxUrlLength,(x=r.useProxy||!!h.getProxyRule(t))&&(w=h.getProxyUrl(t),b=w.path,!u&&b.length+1+_>y.maxUrlLength&&(u=!0),w.query&&(f=n.__assign(n.__assign({},w.query),f))),"HEAD"===i.method&&(u||x)){if(u){if(_>y.maxUrlLength)throw S("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw S("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(x)throw S("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}u?(i.method="POST",r.body?t=h.addQueryParameters(t,f):(i.body=h.objectToQuery(f),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=h.addQueryParameters(t,f),x&&(e.useProxy=!0,t=b+"?"+t),f.token&&g&&i.body instanceof FormData&&((P=i.body).set?P.set("token",f.token):P.append("token",f.token)),r.hasOwnProperty("withCredentials")?e.withCredentials=r.withCredentials:(h.isTrustedServer(t)||o.id&&(T=o.id.findServerInfo(t))&&T.webTierAuth)&&(e.withCredentials=!0),e.withCredentials&&(i.credentials="include")}O=0,C=!1,c>0&&(O=setTimeout((function(){C=!0,e.controller.abort()}),c)),j.label=1;case 1:return j.trys.push([1,18,19,20]),"image"!==r.responseType||"default"!==i.cache||"GET"!==i.method||u||function(e){if(e)for(var t=0,r=Object.getOwnPropertyNames(e);t<r.length;t++){if(e[r[t]])return!0}return!1}(r.headers)||!a&&!e.useProxy&&y.proxyUrl&&(V=t,(F=h.getOrigin(V))&&!d.endsWith(F,".arcgis.com")&&-1===v._corsServers.indexOf(F)&&!h.isTrustedServer(F))?[3,3]:[4,D(t,e)];case 2:return A=j.sent(),[3,17];case 3:return[4,v._abortableFetch(t,i)];case 4:if(M=j.sent(),e.useProxy||function(e){if(!h.isBlobProtocol(e)&&!h.isDataProtocol(e)){var t=h.getOrigin(e);t&&-1===v._corsServers.indexOf(t)&&v._corsServers.push(t)}}(t),!M.ok||"HEAD"===i.method)return[3,17];switch(s){case"array-buffer":return[3,5];case"blob":case"image":return[3,7]}return[3,9];case 5:return[4,M.arrayBuffer()];case 6:return A=j.sent(),[3,11];case 7:return[4,M.blob()];case 8:return A=j.sent(),[3,11];case 9:return[4,M.text()];case 10:return A=j.sent(),[3,11];case 11:if(O&&(clearTimeout(O),O=0),"json"===s||"xml"===s||"document"===s)if(A)switch(s){case"json":A=JSON.parse(A);break;case"xml":A=E(A,"application/xml");break;case"document":A=E(A,"text/html")}else A=null;if(!A)return[3,17];if("array-buffer"!==s&&"blob"!==s)return[3,15];if(I=M.headers.get("Content-Type"),!(/application\/json|text\/plain/i.test(I)&&A["blob"===s?"size":"byteLength"]<=750))return[3,15];j.label=12;case 12:return j.trys.push([12,14,,15]),[4,new Response(A).json()];case 13:return(R=j.sent()).error&&(A=R),[3,15];case 14:return j.sent(),[3,15];case 15:return"image"===s&&A instanceof Blob?[4,D(URL.createObjectURL(A),e,!0)]:[3,17];case 16:A=j.sent(),j.label=17;case 17:return[3,20];case 18:if("AbortError"===(L=j.sent()).name){if(C)throw new Error("Timeout exceeded");throw p.createAbortError("Request canceled")}if(!(!M&&L instanceof TypeError&&y.proxyUrl)||r.body||"post"===r.method||"head"===r.method||e.useProxy)throw L;return e.redoRequest=!0,h.addProxyRule({proxyUrl:y.proxyUrl,urlPrefix:h.removeFile(h.urlToObject(t).path)}),[3,20];case 19:return O&&clearTimeout(O),[7];case 20:return[2,[M,A]]}var V,F}))}))}function A(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o;return n.__generator(this,(function(s){switch(s.label){case 0:if(null!=e.responseData)return[2,e.responseData];if(e.headers&&(t.requestOptions.headers=n.__assign(n.__assign({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=n.__assign(n.__assign({},t.requestOptions.query),e.query)),!e.before)return[3,5];r=void 0,i=void 0,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.before(t)];case 2:return i=s.sent(),[3,4];case 3:return o=s.sent(),r=S("request:interceptor",o,t),[3,4];case 4:if((i instanceof Error||i instanceof a)&&(r=S("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return[2,i];case 5:return[2]}}))}))}function E(e,t){var r;try{r=(new DOMParser).parseFromString(e,t)}catch(e){}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}function I(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,a,s,l,c,u,p,d,f;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,O(e)];case 1:n.sent(),n.label=2;case 2:n.trys.push([2,8,,9]),n.label=3;case 3:return[4,M(e)];case 4:f=n.sent(),t=f[0],r=f[1],n.label=5;case 5:return[4,R(e,t,r)];case 6:if(!n.sent())return[3,3];n.label=7;case 7:return[3,9];case 8:throw i=n.sent(),(a=S("request:server",i,e.params,t)).details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a;case 9:return s=e.params.url,/\/sharing\/rest\/(accounts|portals)\/self/i.test(s)&&!e.hasToken&&!e.credentialToken&&r&&r.user&&r.user.username&&!h.isTrustedServer(s)&&(l=h.getOrigin(s,!0))&&y.trustedServers.push(l),(c=e.credential)&&o.id&&(u=o.id.findServerInfo(c.server),(p=u&&u.owningSystemUrl)&&(p=p.replace(/\/?$/,"/sharing"),(d=o.id.findCredential(p,c.userId))&&-1===o.id._getIdenticalSvcIdx(p,d)&&d.resources.unshift(p))),[2,{data:r,getHeader:t?function(e){return t.headers.get(e)}:w,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}]}}))}))}function R(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,a,s,l,u,p,d;return n.__generator(this,(function(n){switch(n.label){case 0:if(e.redoRequest)return e.redoRequest=!1,[2,!1];if(!t)return[2,!0];if(!t.ok)throw new Error("Unable to load "+t.url+" status: "+t.status);return r&&r.error&&(i=c.mixin(new Error,r.error)),i&&(a=Number(i.code),s=i.hasOwnProperty("subcode")?Number(i.subcode):null,l=(l=i.messageCode)&&l.toUpperCase()),u=e.params.requestOptions.authMode,403===a&&(4===s||i.message&&i.message.toLowerCase().indexOf("ssl")>-1&&-1===i.message.toLowerCase().indexOf("permission"))?e.useSSL?[3,6]:(e.useSSL=!0,[2,!1]):[3,1];case 1:return!e.useIdentity||"no-prompt"===u&&498!==a||-1===_.indexOf(a)||C(e.params.url)||!(403!==a||-1===b.indexOf(l)&&(null==s||2===s&&e.credentialToken))?[3,6]:[4,T()];case 2:n.sent(),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,o.id.getCredential(e.params.url,{error:S("request:server",i,e.params),prompt:"no-prompt"!==u,signal:e.controller.signal,token:e.credentialToken})];case 4:return p=n.sent(),e.credential=p,e.credentialToken=p.token,e.useSSL=e.useSSL||p.ssl,[2,!1];case 5:return d=n.sent(),"no-prompt"===u?(e.credential=null,e.credentialToken=null,[2,!1]):(i=d,[3,6]);case 6:if(i)throw i;return[2,!0]}}))}))}function D(e,t,r){void 0===r&&(r=!1);var n=t.controller.signal,i=new Image;return t.withCredentials?i.crossOrigin="use-credentials":i.crossOrigin="anonymous",i.alt="",i.src=e,f.loadImageAsync(i,e,r,n)}return v._abortableFetch=null,v._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],v}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var r=this;void 0===t&&(t={ignoreUnknown:!1}),this.jsonToAPI=e,this.options=t,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this.invertMap(e),this.apiValues=this.getKeysSorted(this.apiToJSON),this.jsonValues=this.getKeysSorted(this.jsonToAPI),this.read=function(e){return r.fromJSON(e)},this.write=function(e,t,n){var i=r.toJSON(e);void 0!==i&&(t[n]=i)}}return e.prototype.toJSON=function(e){return this.apiToJSON.hasOwnProperty(e)?this.apiToJSON[e]:this.options.ignoreUnknown?void 0:e},e.prototype.fromJSON=function(e){return this.jsonToAPI.hasOwnProperty(e)?this.jsonToAPI[e]:this.options.ignoreUnknown?void 0:e},e.prototype.invertMap=function(e){var t={};for(var r in e)t[e[r]]=r;return t},e.prototype.getKeysSorted=function(e){var t=[];for(var r in e)t.push(r);return t.sort(),t},e}();t.JSONMap=r,t.strict=function(){return function(e){return new r(e,{ignoreUnknown:!0})}},t.default=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r._groups=new Map,r}return r.__extends(t,e),t.prototype.destroy=function(){this.removeAll()},Object.defineProperty(t.prototype,"size",{get:function(){var e=0;return this._groups.forEach((function(t){e+=t.length})),e},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t){var r=this;if(!this._isHandle(e)&&!Array.isArray(e)&&!i.isCollection(e))return this;var n=this._getOrCreateGroup(t);return Array.isArray(e)||i.isCollection(e)?e.forEach((function(e){return r._isHandle(e)&&n.push(e)})):n.push(e),this.notifyChange("size"),this},t.prototype.forEach=function(e,t){if("function"==typeof e)this._groups.forEach((function(t){return t.forEach(e)}));else{var r=this._getGroup(e);r&&r.forEach(t)}},t.prototype.has=function(e){return this._groups.has(this._ensureGroupKey(e))},t.prototype.remove=function(e){if(Array.isArray(e)||i.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;for(var t=this._getGroup(e),r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this},t.prototype.removeAll=function(){return this._groups.forEach((function(e){for(var t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this},t.prototype._isHandle=function(e){return e&&!!e.remove},t.prototype._getOrCreateGroup=function(e){if(this.has(e))return this._getGroup(e);var t=[];return this._groups.set(this._ensureGroupKey(e),t),t},t.prototype._getGroup=function(e){return this._groups.get(this._ensureGroupKey(e))},t.prototype._deleteGroup=function(e){return this._groups.delete(this._ensureGroupKey(e))},t.prototype._ensureGroupKey=function(e){return e||"_default_"},r.__decorate([o.property({readOnly:!0})],t.prototype,"size",null),r.__decorate([o.subclass("esri.core.Handles")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float32Array(1);function n(e,t,r){return e<t?t:e>r?r:e}function i(e,t,r){return e+(t-e)*r}function o(e){return r[0]=e,r[0]}t.isFinite=Number.isFinite||function(e){return"number"==typeof e&&window.isFinite(e)},t.isNaN=Number.isNaN||function(e){return e!=e},t.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},t.clamp=n,t.glClamp=function(e,t,r){return Math.min(Math.max(e,t),r)},t.isPowerOfTwo=function(e){return 0==(e&e-1)},t.nextHighestPowerOfTen=function(e){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(e)))},t.sign=Math.sign||function(e){return+(e>0)-+(e<0)||+e},t.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},t.lerp=i,t.scale=function(e,t,r,n,o){return i(n,o,(e-t)/(r-t))},t.deg2rad=function(e){return e*Math.PI/180},t.rad2deg=function(e){return 180*e/Math.PI},t.reciprocalClamped=function(e,t){return void 0===t&&(t=1e-6),(e<0?-1:1)/Math.max(Math.abs(e),t)},t.acosClamped=function(e){return Math.acos(n(e,-1,1))},t.asinClamped=function(e){return Math.asin(n(e,-1,1))},t.floatEqualRelative=function(e,r,n){if(void 0===n&&(n=1e-6),t.isNaN(e)||t.isNaN(r))return!1;if(e===r)return!0;var i=Math.abs(e-r),o=Math.abs(e),a=Math.abs(r);if(0===e||0===r||o<1e-12&&a<1e-12){if(i>.01*n)return!1}else if(i/(o+a)>n)return!1;return!0},t.floatEqualAbsolute=function(e,r,n){return void 0===n&&(n=1e-6),!t.isNaN(e)&&!t.isNaN(r)&&(e>r?e-r:r-e)<=n},t.clampFloat32=function(e){return o(Math.max(-t.NUMBER_MAX_FLOAT32,Math.min(e,t.NUMBER_MAX_FLOAT32)))},t.NUMBER_MAX_FLOAT32=o(34028234663852886e22)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(476),r(180),r(190),r(118),r(230),r(231),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=new s(function(){function e(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1}return e.prototype.preventDefault=function(){this.cancellable&&(this.defaultPrevented=!0)},e.prototype.reset=function(e){this.defaultPrevented=!1,this.item=e},e}(),null,(function(e){e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1})),d=function(){};function h(e){return e?e instanceof x?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function f(e){if(e&&e.length)return e[0]}function v(e,t,r,n){for(var i=Math.min(e.length-r,t.length-n),o=0;o<i&&e[r+o]===t[n+o];)o++;return o}var m=new Set,y=new Set,g=new Set,_=new Map,b=0,x=function(e){function t(t){var r=e.call(this,t)||this;return r._chgListeners=[],r._notifications=null,r._timer=null,r.length=0,r._items=[],Object.defineProperty(r,"uid",{value:b++}),r}var o;return r.__extends(t,e),o=t,t.isCollection=function(e){return null!=e&&e instanceof o},t.prototype.normalizeCtorArgs=function(e){return e?Array.isArray(e)||e instanceof o?{items:e}:e:{}},Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(e){this._emitBeforeChanges(1)||(this._splice.apply(this,r.__spreadArrays([0,this.length],h(e))),this._emitAfterChanges(1))},enumerable:!0,configurable:!0}),t.prototype.hasEventListener=function(e){return"change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e)},t.prototype.on=function(e,t){if("change"===e){var r=this._chgListeners,n={removed:!1,callback:t};return r.push(n),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove:function(){this.remove=d,n.removed=!0,r.splice(r.indexOf(n),1)}}}return this._emitter.on(e,t)},t.prototype.once=function(e,t){var r=this.on(e,t);return{remove:function(){r.remove()}}},t.prototype.add=function(e,t){if(this._emitBeforeChanges(1))return this;var r=this.getNextIndex(t);return this._splice(r,0,e),this._emitAfterChanges(1),this},t.prototype.addMany=function(e,t){if(void 0===t&&(t=this._items.length),!e||!e.length)return this;if(this._emitBeforeChanges(1))return this;var n=this.getNextIndex(t);return this._splice.apply(this,r.__spreadArrays([n,0],h(e))),this._emitAfterChanges(1),this},t.prototype.removeAll=function(){if(!this.length||this._emitBeforeChanges(2))return[];var e=this._splice(0,this.length)||[];return this._emitAfterChanges(2),e},t.prototype.clone=function(){return this._createNewInstance({items:this._items.map(a.clone)})},t.prototype.concat=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.map(h);return this._createNewInstance({items:(e=this._items).concat.apply(e,n)})},t.prototype.drain=function(e,t){if(this.length&&!this._emitBeforeChanges(2)){for(var r=this._splice(0,this.length),n=r.length,i=0;i<n;i++)e.call(t,r[i],i,r);this._emitAfterChanges(2)}},t.prototype.every=function(e,t){return this._items.every(e,t)},t.prototype.filter=function(e,t){var r;return r=2===arguments.length?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})},t.prototype.find=function(e,t){return i.find(this._items,e,t)},t.prototype.findIndex=function(e,t){return i.findIndex(this._items,e,t)},t.prototype.flatten=function(e,t){var r=[];return function e(t,r,n,i){r&&r.forEach((function(r,o,a){t.push(r),e(t,n.call(i,r,o,a),n,i)}))}(r,this,e,t),new o(r)},t.prototype.forEach=function(e,t){return this._items.forEach(e,t)},t.prototype.getItemAt=function(e){return this._items[e]},t.prototype.getNextIndex=function(e){var t=this.length;return(e=null==e?t:e)<0?e=0:e>t&&(e=t),e},t.prototype.includes=function(e,t){return void 0===t&&(t=0),!!arguments.length&&-1!==this._items.indexOf(e,t)},t.prototype.indexOf=function(e,t){return void 0===t&&(t=0),this._items.indexOf(e,t)},t.prototype.join=function(e){return void 0===e&&(e=","),this._items.join(e)},t.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),this._items.lastIndexOf(e,t)},t.prototype.map=function(e,t){var r=this._items.map(e,t);return new o({items:r})},t.prototype.reorder=function(e,t){void 0===t&&(t=this.length-1);var r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,e),this._emitAfterChanges(4)}return e}},t.prototype.pop=function(){if(this.length&&!this._emitBeforeChanges(2)){var e=f(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}},t.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._emitBeforeChanges(1)||(this._splice.apply(this,r.__spreadArrays([this.length,0],e)),this._emitAfterChanges(1)),this.length},t.prototype.reduce=function(e,t){var r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)},t.prototype.reduceRight=function(e,t){var r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)},t.prototype.remove=function(e){return this.removeAt(this.indexOf(e))},t.prototype.removeAt=function(e){if(!(e<0||e>=this.length||this._emitBeforeChanges(2))){var t=f(this._splice(e,1));return this._emitAfterChanges(2),t}},t.prototype.removeMany=function(e){if(!e||!e.length||this._emitBeforeChanges(2))return[];for(var t=e instanceof o?e.toArray():e,r=this._items,n=[],i=t.length,a=0;a<i;a++){var s=t[a],l=r.indexOf(s);if(l>-1){var c=1+v(t,r,a+1,l+1),u=this._splice(l,c);u&&u.length>0&&n.push.apply(n,u),a+=c-1}}return this._emitAfterChanges(2),n},t.prototype.reverse=function(){if(this._emitBeforeChanges(4))return this;var e=this._splice(0,this.length);return e&&(e.reverse(),this._splice.apply(this,r.__spreadArrays([0,0],e))),this._emitAfterChanges(4),this},t.prototype.shift=function(){if(this.length&&!this._emitBeforeChanges(2)){var e=f(this._splice(0,1));return this._emitAfterChanges(2),e}},t.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),this._createNewInstance({items:this._items.slice(e,t)})},t.prototype.some=function(e,t){return this._items.some(e,t)},t.prototype.sort=function(e){if(!this.length||this._emitBeforeChanges(4))return this;var t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice.apply(this,r.__spreadArrays([0,0],t)),this._emitAfterChanges(4),this},t.prototype.splice=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=(t?2:0)|(n.length?1:0);if(this._emitBeforeChanges(o))return[];var a=this._splice.apply(this,r.__spreadArrays([e,t],n))||[];return this._emitAfterChanges(o),a},t.prototype.toArray=function(){return this._items.slice()},t.prototype.toJSON=function(){return this.toArray()},t.prototype.toLocaleString=function(){return this._items.toLocaleString()},t.prototype.toString=function(){return this._items.toString()},t.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!e.length||this._emitBeforeChanges(1)||(this._splice.apply(this,r.__spreadArrays([0,0],e)),this._emitAfterChanges(1)),this.length},t.prototype._createNewInstance=function(e){return new this.constructor(e)},t.prototype._splice=function(e,t){for(var n=this,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a,s,c=this._items,u=this.constructor.prototype.itemType;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=l.schedule((function(){return n._dispatchChange()}))),t){if(s=c.splice(e,t),this.hasEventListener("before-remove")){var d=p.acquire();d.target=this,d.cancellable=!0;for(var h=0,f=s.length;h<f;h++)a=s[h],d.reset(a),this.emit("before-remove",d),d.defaultPrevented&&(s.splice(h,1),c.splice(e,0,a),e+=1,h-=1,f-=1);p.release(d)}if(this.length=this._items.length,this.hasEventListener("after-remove")){var v=p.acquire();for(v.target=this,v.cancellable=!1,f=s.length,h=0;h<f;h++)v.reset(s[h]),this.emit("after-remove",v);p.release(v)}}if(i&&i.length){if(u){for(var m=[],y=0,g=i;y<g.length;y++){var _=g[y],b=u.ensureType(_);null==b&&null!=_||m.push(b)}i=m}var x=this.hasEventListener("before-add"),w=this.hasEventListener("after-add"),S=e===this.length;if(x||w){var P=p.acquire();P.target=this,P.cancellable=!0;var T=p.acquire();T.target=this,T.cancellable=!1;for(var O=0,C=i;O<C.length;O++){var M=C[O];x?(P.reset(M),this.emit("before-add",P),P.defaultPrevented||(S?c.push(M):c.splice(e++,0,M),this._set("length",c.length),w&&(T.reset(M),this.emit("after-add",T)))):(S?c.push(M):c.splice(e++,0,M),this._set("length",c.length),T.reset(M),this.emit("after-add",T))}p.release(T),p.release(P)}else{if(S)for(var A=0,E=i;A<E.length;A++){var I=E[A];c.push(I)}else c.splice.apply(c,r.__spreadArrays([e,0],i));this._set("length",c.length)}}return(i&&i.length||s&&s.length)&&this._notifyChangeEvent(i,s),s},t.prototype._emitBeforeChanges=function(e){var t=!1;if(this.hasEventListener("before-changes")){var r=p.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,p.release(r)}return t},t.prototype._emitAfterChanges=function(e){if(this.hasEventListener("after-changes")){var t=p.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),p.release(t)}},t.prototype._notifyChangeEvent=function(e,t){this.hasEventListener("change")&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})},t.prototype._dispatchChange=function(){if(this._timer&&(this._timer.remove(),this._timer=null),this._notifications){var e=this._notifications;this._notifications=null;for(var t=function(e){var t=e.changes;m.clear(),y.clear(),g.clear();for(var i=0,o=t;i<o.length;i++){var a=o[i],s=a.added,l=a.removed;if(s)if(0===g.size&&0===y.size)for(var c=0,u=s;c<u.length;c++){var p=u[c];m.add(p)}else for(var d=0,h=s;d<h.length;d++)p=h[d],y.has(p)?(g.add(p),y.delete(p)):g.has(p)||m.add(p);if(l)if(0===g.size&&0===m.size)for(var f=0,v=l;f<v.length;f++)p=v[f],y.add(p);else for(var _=0,b=l;_<b.length;_++)p=b[_],m.has(p)?m.delete(p):(g.delete(p),y.add(p))}var x=n.acquire();m.forEach((function(e){x.push(e)}));var w=n.acquire();y.forEach((function(e){w.push(e)}));var S=r._items,P=e.items,T=n.acquire();if(g.forEach((function(e){P.indexOf(e)!==S.indexOf(e)&&T.push(e)})),e.listeners&&(x.length||w.length||T.length))for(var O={target:r,added:x,removed:w,moved:T},C=e.listeners.length,M=0;M<C;M++){var A=e.listeners[M];A.removed||A.callback.call(r,O)}n.release(x),n.release(w),n.release(T)},r=this,i=0,o=e;i<o.length;i++)t(o[i]);m.clear(),y.clear(),g.clear()}},t.ofType=function(e){if(!e)return o;if(_.has(e))return _.get(e);var t;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(var n in e.typeMap){var i=e.typeMap[n].prototype.declaredClass;t?t+=" | "+i:t=i}var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(n,e),r.__decorate([c.subclass("esri.core.Collection<"+t+">")],n)}(o),s={Type:e,ensureType:"function"==typeof e?u.ensureType(e):u.ensureOneOfType(e)};return Object.defineProperty(a.prototype,"itemType",{value:s}),_.set(e,a),a},r.__decorate([c.property()],t.prototype,"length",void 0),r.__decorate([c.property()],t.prototype,"items",null),o=r.__decorate([c.subclass("esri.core.Collection")],t)}(o.EventedAccessor);return x}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(178)],void 0===(i=function(e,t,r,n,i,o,a){var s=function(e){function t(t){var r=e.call(this,t)||this;return r.latestWkid=null,r.wkid=null,r.wkt=null,r.imageCoordinateSystem=null,r}var n;return r.__extends(t,e),n=t,t.fromJSON=function(e){if(!e)return null;if(e.wkid){if(102100===e.wkid)return n.WebMercator;if(4326===e.wkid)return n.WGS84}var t=new n;return t.read(e),t},t.prototype.normalizeCtorArgs=function(e){var t;return e&&"object"==typeof e?e:((t={})["string"==typeof e?"wkt":"wkid"]=e,t)},Object.defineProperty(t.prototype,"isWGS84",{get:function(){return a.isWGS84(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWebMercator",{get:function(){return a.isWebMercator(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGeographic",{get:function(){return a.isGeographic(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWrappable",{get:function(){return a.isWrappable(this)},enumerable:!0,configurable:!0}),t.prototype.writeWkt=function(e,t){this.wkid||(t.wkt=e)},t.prototype.clone=function(){if(this===n.WGS84)return n.WGS84;if(this===n.WebMercator)return n.WebMercator;var e=new n;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=i.clone(this.imageCoordinateSystem)),e},t.prototype.equals=function(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;var t=e.imageCoordinateSystem,r=t.id,n=t.referenceServiceName,i=e.imageCoordinateSystem.geodataXform,o=this.imageCoordinateSystem;return null==r||i?JSON.stringify(o)===JSON.stringify(e.imageCoordinateSystem):n?o.id===r&&o.referenceServiceName===n:o.id===r}return a.equals(this,e)},t.prototype.toJSON=function(e){return this.write(null,e)},t.GCS_NAD_1927=null,t.WGS84=null,t.WebMercator=null,r.__decorate([o.property({dependsOn:["wkid"],readOnly:!0})],t.prototype,"isWGS84",null),r.__decorate([o.property({dependsOn:["wkid"],readOnly:!0})],t.prototype,"isWebMercator",null),r.__decorate([o.property({dependsOn:["wkid","wkt"],readOnly:!0})],t.prototype,"isGeographic",null),r.__decorate([o.property({dependsOn:["wkid"],readOnly:!0})],t.prototype,"isWrappable",null),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"latestWkid",void 0),r.__decorate([o.property({type:Number,json:{write:!0,origins:{"web-scene":{write:{overridePolicy:function(){return{isRequired:null===this.wkt}}}}}}})],t.prototype,"wkid",void 0),r.__decorate([o.property({type:String,json:{origins:{"web-scene":{write:{overridePolicy:function(){return{isRequired:null===this.wkid}}}}}}})],t.prototype,"wkt",void 0),r.__decorate([o.writer("wkt"),o.writer("web-scene","wkt")],t.prototype,"writeWkt",null),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"vcsWkid",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"latestVcsWkid",void 0),r.__decorate([o.property()],t.prototype,"imageCoordinateSystem",void 0),n=r.__decorate([o.subclass("esri.geometry.SpatialReference")],t)}(n.JSONSupport);return s.prototype.toJSON.isDefaultToJSON=!0,s.GCS_NAD_1927=new s({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),s.WGS84=new s(a.WGS84),s.WebMercator=new s(a.WebMercator),Object.freeze&&(Object.freeze(s.GCS_NAD_1927),Object.freeze(s.WGS84),Object.freeze(s.WebMercator)),s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function i(e){return e?72*e/96:0}function o(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),{x:e,y:t}}function a(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),[e,t]}function s(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),{x:e,y:t}}function l(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),[e,t]}function c(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function u(e){return o(e.x,e.y)}function p(e,t){var r=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return o(t.clientX-r.left,t.clientY-r.top)}t.pt2px=function(e){return e?e/72*96:0},t.px2pt=i,t.toPt=function(e){if("string"==typeof e){if(n.test(e)){var t=e.match(n),r=Number(t[1]),o=t[3]&&t[3].toLowerCase(),a="-"===e.charAt(0),s="px"===o?i(r):r;return a?-s:s}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},t.createScreenPoint=o,t.createScreenPointArray=a,t.createRenderScreenPoint=s,t.createRenderScreenPointArray=l,t.createRenderScreenPointArray3=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),[e,t,r]},t.castRenderScreenPointArray=function(e){return e},t.castRenderScreenPointArray3=function(e){return e},t.castScreenPointArray=function(e){return e},t.screenToRender=function(e,t,r){var n,i;switch(e.type){case"2d":var o=window.devicePixelRatio||1;n=t.x*o,i=t.y*o;break;case"3d":c(t,h),e.state.camera.screenToRender(h,d),n=d[0],i=d[1]}return r?(r.x=n,r.y=i,r):s(n,i)},t.renderToScreen=function(e,t,r){var n,i;switch(e.type){case"2d":var a=window.devicePixelRatio||1;n=t.x/a,i=t.y/a;break;case"3d":c(t,d),e.state.camera.renderToScreen(d,h),n=h[0],i=h[1]}return r?(r.x=n,r.y=i,r):o(n,i)},t.screenArrayToRender=function(e,t,r){var n,i;switch(e.type){case"2d":var o=window.devicePixelRatio||1;n=t[0]*o,i=t[1]*o;break;case"3d":e.state.camera.screenToRender(t,d),n=d[0],i=d[1]}return r?(r[0]=n,r[1]=i,r.length>2&&(r[2]=0),r):l(n,i)},t.renderArrayToScreen=function(e,t,r){var n,i;switch(e.type){case"2d":var o=window.devicePixelRatio||1;n=t[0]/o,i=t[0]/o;break;case"3d":e.state.camera.renderToScreen(t,h),n=h[0],i=h[1]}return r?(r[0]=n,r[1]=i,r):a(n,i)},t.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},t.screenPointObjectToArray=c,t.createScreenPointFromEvent=u,t.createScreenPointFromNativeEvent=p,t.createScreenPointFromSupportedEvent=function(e,t){return t instanceof Event?p(e,t):u(t)},t.isSupportedScreenPointEvent=function(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e){var t=e.type;switch(t){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":return!1;default:return r.neverReachedSilent(t),!1}}return!1};var d=l(),h=a()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(336),r(154),r(121),r(156),r(152),r(229)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u,p,d=s.getLogger("esri.core.urlUtils"),h=n.request,f="esri/config: esriConfig.request.proxyUrl is not set.",v=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,m=/^\s*http:/i,y=/^\s*https:/i,g=/^\s*file:/i,_=/:\d+$/,b=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,x=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),w=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$"),S=function(){function e(e){void 0===e&&(e=""),this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;var t=this.uri.match(x);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=this.authority.match(w),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}return e.prototype.toString=function(){return this.uri},e}();function P(e){var t={path:null,query:null},r=new S(e),n=e.indexOf("?");return null===r.query?t.path=e:(t.path=e.substring(0,n),t.query=T(r.query)),r.fragment&&(t.hash=r.fragment,null===r.query&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function T(e){for(var t={},r=0,n=e.split("&");r<n.length;r++){var i=n[r];if(i){var o=i.indexOf("="),a=void 0,s=void 0;o<0?(a=decodeURIComponent(i),s=""):(a=decodeURIComponent(i.slice(0,o)),s=decodeURIComponent(i.slice(o+1)));var l=t[a];"string"==typeof l&&(l=t[a]=[l]),Array.isArray(l)?l.push(s):t[a]=s}}return t}function O(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}function C(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((function(r){return encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))})).join("&"):Object.keys(e).map((function(r){var n=e[r];if(null==n)return"";var i=encodeURIComponent(r)+"=",o=t&&t[r];return o?i+encodeURIComponent(o(n)):Array.isArray(n)?n.map((function(e){return O(e)?i+encodeURIComponent(JSON.stringify(e)):i+encodeURIComponent(e)})).join("&"):O(n)?i+encodeURIComponent(JSON.stringify(n)):i+encodeURIComponent(n)})).filter((function(e){return e})).join("&"):""}t.Url=S,t.appUrl=new S(n.applicationUrl),t.trustedServersUrlCache={},t.appBaseUrl=(p=(u=t.appUrl.path).substring(0,u.lastIndexOf(u.split("/")[u.split("/").length-1])),t.appUrl.scheme+"://"+t.appUrl.host+(null!=t.appUrl.port?":"+t.appUrl.port:"")+p),t.urlToObject=P,t.queryToObject=T,t.objectToQuery=C,t.getProxyUrl=function(e){var r;void 0===e&&(e=!1);var n,i=h.proxyUrl;if("string"==typeof e){n=e,r=y.test(n)||"https"===t.appUrl.scheme&&W(n);var a=I(e);a&&(i=a.proxyUrl)}else r=!!e;if(!i)throw d.warn(f),new o("urlutils:proxy-not-set",f);return r&&Y()&&(i=X(i)),P(i)},t.addProxy=function(e){var t,n,i=I(e);if(i){var o=A(i.proxyUrl);t=o.path,n=o.query?T(o.query):null}if(t){var a=P(e);e=t+"?"+a.path;var s=C(r.__assign(r.__assign({},n),a.query));s&&(e=e+"?"+s)}return e};var M={path:"",query:""};function A(e){var t=e.indexOf("?");return-1!==t?(M.path=e.slice(0,t),M.query=e.slice(t+1)):(M.path=e,M.query=null),M}function E(e){return(e=Q(e=function(e){return e&&"/"===e[e.length-1]?e:e+"/"}(e=A(e).path),!0)).toLowerCase()}function I(e){for(var t=h.proxyRules,r=E(e),n=0;n<t.length;n++)if(0===r.indexOf(t[n].urlPrefix))return t[n]}function R(e){var t=(e=V(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function D(e,t,r){void 0===r&&(r=!1);var n=K(e),i=K(t);return!(!r&&n.scheme!==i.scheme)&&n.host.toLowerCase()===i.host.toLowerCase()&&n.port===i.port}function L(e){return t.trustedServersUrlCache[e]||(J(e)||W(e)?t.trustedServersUrlCache[e]=[new S(j(e))]:t.trustedServersUrlCache[e]=[new S("http://"+e),new S("https://"+e)]),t.trustedServersUrlCache[e]}function j(e,r,n){return void 0===r&&(r=t.appBaseUrl),W(e)?n&&n.preserveProtocolRelative?e:"http"===t.appUrl.scheme&&t.appUrl.authority===N(e).slice(2)?"http:"+e:"https:"+e:J(e)?e:F("/"===e[0]?function(e){var t=e.indexOf("//"),r=e.indexOf("/",t+2);return-1===r?e:e.slice(0,r)}(r):r,e)}function V(e){return function(e){var r=h.httpsDomains;if(!function(e){return m.test(e)||"http"===t.appUrl.scheme&&W(e)}(e))return e;var n,i=e.indexOf("/",7);if(n=(n=-1===i?e:e.slice(0,i)).toLowerCase().slice(7),_.test(n)){if(!c.endsWith(n,":80"))return e;n=n.slice(0,-3),e=e.replace(":80","")}return"http"!==t.appUrl.scheme||n!==t.appUrl.authority||b.test(e)?((Y()&&n===t.appUrl.authority||r&&r.some((function(e){return n===e||c.endsWith(n,"."+e)}))||Y()&&!I(e))&&(e=X(e)),e):e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){var t=A(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+="?"+t.query)}return e}(e=j(e=e.trim()))))}function F(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.filter(l.isSome);if(r&&r.length){var n=[];if(k(r[0])){var i=r[0],o=i.indexOf("//");-1!==o&&(n.push(i.slice(0,o+1)),Z(r[0])&&(n[0]+="/"),r[0]=i.slice(o+2))}else"/"===r[0][0]&&n.push("");for(var a=r.reduce((function(e,t){return t?e.concat(t.split("/")):e}),[]),s=0;s<a.length;s++){var c=a[s];".."===c&&n.length>0&&".."!==n[n.length-1]?n.pop():(!c&&s===a.length-1||c&&("."!==c||0===n.length))&&n.push(c)}return n.join("/")}}function N(e,t){if(void 0===t&&(t=!1),z(e)||U(e))return null;var r=e.indexOf("://");if(-1===r&&W(e))r=2;else{if(-1===r)return null;r+=3}var n=e.indexOf("/",r);return-1!==n&&(e=e.slice(0,n)),t&&(e=Q(e,!0)),e}function k(e){return W(e)||J(e)}function z(e){return e&&"blob:"===e.slice(0,5)}function U(e){return"data:"===e.slice(0,5)}function B(e){var t=H(e);if(!t||!t.isBase64)return null;for(var r=atob(t.data),n=new Uint8Array(r.length),i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return n.buffer}t.addProxyRule=function(e){for(var t={proxyUrl:e.proxyUrl,urlPrefix:E(e.urlPrefix)},r=h.proxyRules,n=t.urlPrefix,i=r.length,o=0;o<r.length;o++){var a=r[o].urlPrefix;if(0===n.indexOf(a)){if(n.length===a.length)return-1;i=o;break}0===a.indexOf(n)&&(i=o+1)}return r.splice(i,0,t),i},t.getProxyRule=I,t.hasSamePortal=function(e,t){return e=R(e),t=R(t),Q(e)===Q(t)},t.getInterceptor=function(e){var t=function(t){return null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&c.startsWith(e,t)},r=h.interceptors;if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n];if(Array.isArray(o.urls)){if(o.urls.some(t))return o}else if(t(o.urls))return o}return null},t.hasSameOrigin=D,t.isTrustedServer=function(e){if("string"==typeof e){if(!k(e))return!0;e=K(e)}if(D(e,t.appUrl))return!0;for(var r=h.trustedServers||[],n=0;n<r.length;n++)for(var i=L(r[n]),o=0;o<i.length;o++)if(D(e,i[o]))return!0;return!1},t.makeAbsolute=j,t.makeRelative=function(e,r,n){if(void 0===r&&(r=t.appBaseUrl),!k(e))return e;var i=V(e),o=i.toLowerCase(),a=V(r).toLowerCase().replace(/\/+$/,""),s=n?V(n).toLowerCase().replace(/\/+$/,""):null;if(s&&0!==a.indexOf(s))return e;for(var l=function(e,t,r){return-1===(r=e.indexOf(t,r))?e.length:r},c=l(o,"/",o.indexOf("//")+2),u=-1;o.slice(0,c+1)===a.slice(0,c)+"/"&&(u=c+1,c!==o.length);)c=l(o,"/",c+1);if(-1===u)return e;if(s&&u<s.length)return e;e=i.slice(u);var p=a.slice(u-1).replace(/[^/]+/g,"").length;if(p>0)for(var d=0;d<p;d++)e="../"+e;else e="./"+e;return e},t.normalize=V,t.join=F,t.getOrigin=N,t.isAbsolute=k,t.isBlobProtocol=z,t.isDataProtocol=U,t.dataToArrayBuffer=B;var G=/^data:(.*?)(;base64)?,(.*)$/;function H(e){var t=e.match(G);return t?{mediaType:t[1],isBase64:!!t[2],data:t[3]}:null}function q(e){var t=B(e);if(!t)return null;var r=H(e);return new Blob([t],{type:r.mediaType})}function W(e){return e&&"/"===e[0]&&"/"===e[1]}function J(e){return v.test(e)}function Z(e){return g.test(e)}function X(e){return W(e)?"https:"+e:e.replace(m,"https:")}function Y(){return"https"===t.appUrl.scheme}function Q(e,t){return void 0===t&&(t=!1),W(e)?e.slice(2):(e=e.replace(v,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function K(e){return"string"==typeof e?new S(j(e)):(e.scheme||(e.scheme=t.appUrl.scheme),e)}function $(e,t,r){var n=P(e),i=n.query||{};return i[t]=String(r),n.path+"?"+C(i)}t.dataComponents=H,t.makeData=function(e){return e.isBase64?"data:"+e.mediaType+";base64,"+e.data:"data:"+e.mediaType+","+e.data},t.dataToBlob=q,t.downloadDataAsFile=function(e,t){(function(e,t){var r=document.createElement("a");if(!("download"in r))return!1;var n=null;if(a.URL&&a.URL.createObjectURL){var i=q(e);if(!i)return!1;n=a.URL.createObjectURL(i)}r.download=t,r.href=n||e,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),n&&a.URL.revokeObjectURL(n)})(e,t)||function(e,t){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(q(e),t)}(e,t)},t.isProtocolRelative=W,t.hasProtocol=J,t.toHTTP=function(e){return W(e)?"http:"+e:e.replace(y,"http:")},t.toHTTPS=X,t.isAppHTTPS=Y,t.removeFile=function(e){var t=0;if(k(e)){var r=e.indexOf("//");-1!==r&&(t=r+2)}var n=e.lastIndexOf("/");return n<t?e:e.slice(0,n+1)},t.removeTrailingSlash=function(e){return e.replace(/\/+$/,"")},t.changeDomain=function(e,t,r){if(!(t&&r&&e&&k(e)))return e;var n=e.indexOf("//"),i=e.indexOf("/",n+2),o=e.indexOf(":",n+2),a=Math.min(i<0?e.length:i,o<0?e.length:o);return e.slice(n+2,a).toLowerCase()!==t.toLowerCase()?e:""+e.slice(0,n+2)+r+e.slice(a)},t.isSVG=function(e){return te.test(e)},t.removeQueryParameters=function(e,t){var r=P(e),n=Object.keys(r.query||{});return n.length>0&&t&&t.warn("removeQueryParameters()","Url query parameters are not supported, the following parameters have been removed: "+n.join(", ")+"."),r.path},t.addQueryParameter=$,t.addQueryParameters=function(e,t){var r=P(e),n=r.query||{};for(var i in t)n[i]=t[i];var o=C(n);return o?r.path+"?"+o:r.path},t.removeQueryParameter=function(e,t){var r=P(e),n=r.path,i=r.query;if(!i)return e;delete i[t];var o=C(i);return o?n+"?"+o:n},t.addTokenParameter=function(e){var t=i.id&&i.id.findCredential(e);return t&&t.token?$(e,"token",t.token):e},t.getPathExtension=function(e){if(l.isNone(e))return null;var t=e.match(ee);return t?t[1]:null};var ee=/.*?\.([^\/]*)$/,te=/(^data:image\/svg|\.svg$)/i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(184)],void 0===(i=function(e,t,r,n){function i(e){return void 0===e&&(e=t.ZERO),[e[0],e[1],e[2],e[3]]}function o(e){return e[0]>=e[2]?0:e[2]-e[0]}function a(e){return e[1]>=e[3]?0:e[3]-e[1]}function s(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function c(e){return 4===e.length}function u(e,t,r){return e<t?t:e>r?r:e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n,o){return void 0===o&&(o=i()),o[0]=e,o[1]=t,o[2]=r,o[3]=n,o},t.fromExtent=function(e,t){return void 0===t&&(t=i()),t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t},t.toExtent=function(e,t){return new n({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})},t.expandPointInPlace=function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])},t.expand=function(e,t,n){if(void 0===n&&(n=e),"length"in t)c(t)?(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.max(e[2],t[0]),n[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":n[0]=Math.min(e[0],t.xmin),n[1]=Math.min(e[1],t.ymin),n[2]=Math.max(e[2],t.xmax),n[3]=Math.max(e[3],t.ymax);break;case"point":n[0]=Math.min(e[0],t.x),n[1]=Math.min(e[1],t.y),n[2]=Math.max(e[2],t.x),n[3]=Math.max(e[3],t.y);break;default:r.neverReached(t)}return n},t.expandWithNestedArray=function(e,t,r){void 0===r&&(r=e);for(var n=t.length,i=e[0],o=e[1],a=e[2],s=e[3],l=0;l<n;l++){var c=t[l];i=Math.min(i,c[0]),o=Math.min(o,c[1]),a=Math.max(a,c[0]),s=Math.max(s,c[1])}return r[0]=i,r[1]=o,r[2]=a,r[3]=s,r},t.allFinite=function(e){for(var t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0},t.width=o,t.height=a,t.diameter=function(e){var t=o(e),r=a(e);return Math.sqrt(t*t+r*r)},t.area=function(e){return o(e)*a(e)},t.center=function(e,t){return void 0===t&&(t=[0,0]),t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t},t.containsPoint=function(e,t){return s(e,t[0],t[1])},t.containsPointObject=function(e,t){return s(e,t.x,t.y)},t.containsXY=s,t.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r},t.intersects=function(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])},t.contains=function(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]},t.intersection=function(e,t,r){void 0===r&&(r=e);var n=t[0],i=t[1],o=t[2],a=t[3];return r[0]=u(e[0],n,o),r[1]=u(e[1],i,a),r[2]=u(e[2],n,o),r[3]=u(e[3],i,a),r},t.distance=function(e,t){var r=(e[0]+e[2])/2,n=(e[1]+e[3])/2,i=Math.max(Math.abs(t[0]-r)-o(e)/2,0),s=Math.max(Math.abs(t[1]-n)-a(e)/2,0);return Math.sqrt(i*i+s*s)},t.size=function(e,t){t[0]=e[2]-e[0],t[1]=e[3]-e[1]},t.offset=function(e,t,r,n){return void 0===n&&(n=e),n[0]=e[0]+t,n[1]=e[1]+r,n[2]=e[2]+t,n[3]=e[3]+r,n},t.pad=function(e,t,r){return void 0===r&&(r=e),r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r},t.setMin=function(e,t,r){return void 0===r&&(r=e),r[0]=t[0],r[1]=t[1],r!==e&&(r[2]=e[2],r[3]=e[3]),r},t.setMax=function(e,t,r){return void 0===r&&(r=e),r[2]=t[0],r[3]=t[1],r!==e&&(r[0]=e[0],r[1]=e[1]),e},t.set=l,t.empty=function(e){return e?l(e,t.NEGATIVE_INFINITY):i(t.NEGATIVE_INFINITY)},t.is=c,t.isPoint=function(e){return!(0!==o(e)&&isFinite(e[0])||0!==a(e)&&isFinite(e[1]))},t.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!c(e)||!c(t))return!1;if(r){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1}else for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.POSITIVE_INFINITY=[-1/0,-1/0,1/0,1/0],t.NEGATIVE_INFINITY=[1/0,1/0,-1/0,-1/0],t.ZERO=[0,0,0,0],t.UNIT=[0,0,1,1]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(297),r(239),r(155),r(118),r(152),r(151),r(163),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.layer=null,n.popupTemplate=null,n.sourceLayer=null,Object.defineProperty(n,"uid",{value:a.generateUID()}),n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t,r,n){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:n}},Object.defineProperty(t.prototype,"attributes",{set:function(e){var t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometry",{set:function(e){var t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbol",{set:function(e){var t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){var t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))},enumerable:!0,configurable:!0}),t.prototype.getEffectivePopupTemplate=function(e){return void 0===e&&(e=!1),this.popupTemplate?this.popupTemplate:this.sourceLayer?this.sourceLayer.popupTemplate?this.sourceLayer.popupTemplate:e&&l.isSome(this.sourceLayer.defaultPopupTemplate)?this.sourceLayer.defaultPopupTemplate:null:null},t.prototype.getAttribute=function(e){return this.attributes&&this.attributes[e]},t.prototype.setAttribute=function(e,t){var r;if(this.attributes){var n=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",n,t,e)}else this.attributes=((r={})[e]=t,r),this._notifyLayer("attributes",void 0,t,e)},t.prototype.getObjectId=function(){return this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null},t.prototype.toJSON=function(){return{geometry:l.isSome(this.geometry)?this.geometry.toJSON():null,symbol:l.isSome(this.symbol)?this.symbol.toJSON():null,attributes:r.__assign({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}},t.prototype.clone=function(){return new a(this.cloneProperties())},t.prototype.cloneProperties=function(){return{attributes:s.clone(this.attributes),geometry:s.clone(this.geometry),layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:s.clone(this.symbol),visible:this.visible}},t.prototype._notifyLayer=function(e,t,r,n){if(this.layer&&this.layer.graphicChanged){var i={graphic:this,property:e,oldValue:t,newValue:r};"attributes"===e&&(i.attributeName=n),this.layer.graphicChanged(i)}},r.__decorate([c.property({value:null})],t.prototype,"attributes",null),r.__decorate([c.property({value:null,types:n.geometryTypes,json:{read:u.fromJSON}})],t.prototype,"geometry",null),r.__decorate([c.property()],t.prototype,"layer",void 0),r.__decorate([c.property({type:i})],t.prototype,"popupTemplate",void 0),r.__decorate([c.property()],t.prototype,"sourceLayer",void 0),r.__decorate([c.property({value:null,types:o.symbolTypes,json:{read:p.read}})],t.prototype,"symbol",null),r.__decorate([c.property({type:Boolean,value:!0})],t.prototype,"visible",null),a=r.__decorate([c.subclass("esri.Graphic")],t)}(a.JSONSupport),h=0;return function(e){e.generateUID=function(){return h++}}(d||(d={})),d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n="",i=0;i<t.length;i++)n+=e[i]+t[i];return n+e[e.length-1]}Object.defineProperty(t,"__esModule",{value:!0}),t.glsl=r,function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(r=t.glsl||(t.glsl={}))}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.neverReached=function(e){r("esri-debug-messages")&&console.error("Should never be reached (uncaught value "+e+")",(new Error).stack)},t.neverReachedSilent=function(e){},t.typeCast=function(e){return function(){return e}},t.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(229),r(860)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={102113:!0,102100:!0,3857:!0,3785:!0},o={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0},a='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',s=[-20037508.342788905,20037508.342788905],l=[-20037508.342787,20037508.342787],c={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:s,origin:l,dx:1e-5},102100:{wkTemplate:a,valid:s,origin:l,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:s,origin:l,dx:1e-5},3857:{wkTemplate:a,valid:s,origin:l,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,180],dx:1e-5}};function u(e){return d(e)&&e.wkid?c[e.wkid]:null}function p(e){return d(e)&&!0===i[e.wkid]}function d(e){return null!=e&&(null!=e.wkid&&e.wkid>=2e3||null!=e.wkt)}t.equals=function(e,t){return!(!e||!t)&&(e===t||(null!=e.wkid||null!=t.wkid?e.wkid===t.wkid||p(e)&&p(t)||null!=t.latestWkid&&e.wkid===t.latestWkid||null!=e.latestWkid&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))},t.getInfo=u,t.isGeographic=function(e){return!!d(e)&&(e.wkid?null==n[e.wkid]:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))},t.isWGS84=function(e){return d(e)&&4326===e.wkid},t.isWebMercator=p,t.isWrappable=function(e){return d(e)&&!0===o[e.wkid]},t.isValid=d,t.WGS84={wkid:4326,wkt:r.replace(u({wkid:4326}).wkTemplate,{Central_Meridian:"0.0"})},t.WebMercator={wkid:102100,latestWkid:3857}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(156)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n.getLogger("esri.core.Accessor");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function s(e){return null==e?e:e.toString()}function l(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function c(e){return null==e?e:Math.round(parseFloat(e))}function u(e){return e&&e.constructor&&void 0!==e.constructor.__accessorMetadata__}function p(e,t){return null!=t&&e&&!(t instanceof e)}function d(e){return e&&"isCollection"in e}function h(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function f(e,t){return!!u(t)&&(i.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+m(e)+"'"),!0)}function v(e,t){return null==t?t:d(e)?function(e,t){if(!t||!t.constructor||!d(t.constructor))return f(e,t)?t:new e(t);var r=h(e.prototype.itemType),n=h(t.constructor.prototype.itemType);return r?n?r===n?t:r.prototype.isPrototypeOf(n.prototype)?new e(t):(f(e,t),t):new e(t):t}(e,t):p(e,t)?f(e,t)?t:new e(t):t}function m(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function y(e){switch(e){case Number:return l;case w:return c;case Boolean:return a;case String:return s;case Date:return o;default:return v.bind(null,e)}}function g(e,t){var r=y(e);return 1===arguments.length?r:r(t)}function _(e,t,r){return 1===arguments.length?_.bind(null,e):t?Array.isArray(t)?t.map((function(t){return e(t,r)})):[e(t,r)]:t}function b(e,t,r){return 0!==t&&Array.isArray(r)?r.map((function(r){return b(e,t-1,r)})):e(r)}function x(e,t,r){if(2===arguments.length)return x.bind(null,e,t);if(!r)return r;for(var n=t,i=r=b(e,t,r);n>0&&Array.isArray(i);)n--,i=i[0];if(void 0!==i)for(var o=0;o<n;o++)r=[r];return r}t.ensureDate=o,t.ensureBoolean=a,t.ensureString=s,t.ensureNumber=l,t.ensureInteger=c,t.isClassedType=u,t.requiresType=p,t.ensureClass=v,t.ensureType=g,t.ensureArrayTyped=_,t.ensureArray=function(e,t){return 1===arguments.length?_(g.bind(null,e)):_(g.bind(null,e),t)},t.ensureNArrayTyped=x,t.ensureNArray=function(e,t,r){return 2===arguments.length?x(g.bind(null,e),t):x(g.bind(null,e),t,r)},t.isOneOf=function(e){return!!Array.isArray(e)&&!e.some((function(t){var r=typeof t;return!("string"===r||"number"===r||"function"===r&&e.length>1)}))},t.ensureOneOf=function e(t,r){if(2===arguments.length)return e(t).call(null,r);for(var n=new Set,o=t.filter((function(e){return"function"!=typeof e})),a=t.filter((function(e){return"function"==typeof e})),s=0,l=t;s<l.length;s++){var c=l[s];"string"!=typeof c&&"number"!=typeof c||n.add(c)}var u=null,d=null;return function(e,t){if(null==e)return e;var r=typeof e,s="string"===r||"number"===r;return s&&(n.has(e)||a.some((function(e){return"string"===r&&e===String||"number"===r&&e===Number})))||"object"===r&&a.some((function(t){return!p(e,t)}))?e:(s&&o.length?(u||(u=o.map((function(e){return"string"==typeof e?"'"+e+"'":""+e})).join(", ")),i.error("Accessor#set","'"+e+"' is not a valid value for this property, only the following values are valid: "+u)):"object"==typeof e&&a.length?(d||(d=a.map((function(e){return m(e)})).join(", ")),i.error("Accessor#set","'"+e+"' is not a valid value for this property, value must be one of "+d)):i.error("Accessor#set","'"+e+"' is not a valid value for this property"),t&&(t.valid=!1),null)}},t.ensureOneOfType=function e(t,r){if(2===arguments.length)return e(t).call(null,r);var n={},o=[],a=[];for(var s in t.typeMap){var l=t.typeMap[s];n[s]=g(l),o.push(m(l)),a.push(s)}var c=function(){return"'"+o.join("', '")+"'"},d=function(){return"'"+a.join("', '")+"'"},h="string"==typeof t.key?function(e){return e[t.key]}:t.key;return function(e){if(t.base&&!p(t.base,e))return e;if(null==e)return e;var r=h(e)||t.defaultKeyValue,o=n[r];if(!o)return i.error("Accessor#set","Invalid property value, value needs to be one of "+c()+", or a plain object that can autocast (having .type = "+d()+")"),null;if(!p(t.typeMap[r],e))return e;if("string"==typeof t.key&&!u(e)){var a={};for(var s in e)s!==t.key&&(a[s]=e[s]);return o(a)}return o(e)}};var w=function(){};t.Integer=w,t.types={native:function(e){return{type:"native",value:e}},array:function(e){return{type:"array",value:e}},oneOf:function(e){return{type:"one-of",values:e}}},t.isLongFormType=function(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0;default:r.neverReachedSilent(e)}return!1},t.ensureLongFormType=function e(t){switch(t.type){case"native":return g(t.value);case"array":return _(e(t.value));case"one-of":return function(e){var t=null;return function(n,o){return function e(t,r){if(null==t)return!0;switch(r.type){case"native":switch(r.value){case Number:case w:return"number"==typeof t;case Boolean:return"boolean"==typeof t;case String:return"string"==typeof t}return t instanceof r.value;case"array":return!!Array.isArray(t)&&!t.some((function(t){return!e(t,r.value)}));case"one-of":return r.values.some((function(r){return e(t,r)}))}}(n,e)?n:(null==t&&(t=function e(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case w:return"integer";case Date:return"date";default:return m(t.value)}case"array":return"array of "+e(t.value);case"one-of":var n=t.values.map((function(t){return e(t)}));return"one of "+n.slice(0,n.length-1)+" or "+n[n.length-1];default:r.neverReached(t)}return"unknown"}(e)),i.error("Accessor#set","Invalid property value, value needs to be of type "+t),o&&(o.valid=!1),null)}}(t);default:r.neverReached(t)}return null},t.default=g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(296),r(854)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.find=r.find,t.findIndex=r.findIndex,t.from=r.from,t.includes=r.includes,t.unique=function(e,t){return t?e.filter((function(e,n,i){return r.findIndex(i,t.bind(null,e))===n})):e.filter((function(e,t,r){return r.indexOf(e)===t}))},t.equals=function(e,t,r){if(!e&&!t)return!0;if(!e||!t||e.length!==t.length)return!1;if(r){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1}else for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.difference=function(e,t,r){var n,i;return r?(n=t.filter(p.bind(null,e,r)),i=e.filter(p.bind(null,t,r))):(n=t.filter(u.bind(null,e)),i=e.filter(u.bind(null,t))),{added:n,removed:i}},t.intersect=function(e,t,n){return e&&t?n?e.filter((function(e){return r.findIndex(t,(function(t){return n(e,t)}))>-1})):e.filter((function(e){return t.indexOf(e)>-1})):[]};var i=!!Array.prototype.fill;t.constant=function(e,t){if(i)return new Array(e).fill(t);for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r},t.range=function(e,t){void 0===t&&(t=e,e=0);for(var r=new Array(t-e),n=e;n<t;n++)r[n-e]=n;return r},t.binaryIndexOf=function(e,t,r){for(var n=e.length,i=0,o=n-1;i<o;){var a=i+Math.floor((o-i)/2);t>e[a]?i=a+1:o=a}var s=e[i];return r?t>=e[n-1]?-1:s===t?i:i-1:s===t?i:-1},t.flatten=function(e){return e.reduce((function(e,t){return e.concat(t||[])}),[])};var o=function(){this.last=0};t.PositionHint=o;var a=new o;function s(e,t,r,n){n=n||a;for(var i=Math.max(0,n.last-10),o=i;o<r;++o)if(e[o]===t)return n.last=o,o;var s=Math.min(i,r);for(o=0;o<s;++o)if(e[o]===t)return n.last=o,o;return-1}t.indexOf=s,t.removeUnordered=function(e,t,r,n){var i=null==r?e.length:r,o=s(e,t,i,n);if(-1!==o)return e[o]=e[i-1],null==r&&e.pop(),t};var l=new Set;t.removeUnorderedMany=function(e,t,r,n,i,o){if(void 0===r&&(r=e.length),void 0===n&&(n=t.length),0===n||0===r)return r;l.clear();for(var s=0;s<n;++s)l.add(t[s]);i=i||a;var c=Math.max(0,i.last-10);for(s=c;s<r;++s)if(l.has(e[s])&&(o&&o.push(e[s]),l.delete(e[s]),e[s]=e[r-1],--r,--s,0===l.size||0===r))return l.clear(),r;for(s=0;s<c;++s)if(l.has(e[s])&&(o&&o.push(e[s]),l.delete(e[s]),e[s]=e[r-1],--r,--s,0===l.size||0===r))return l.clear(),r;return l.clear(),r},t.pickRandom=function(e,t,r){var n=e.length;if(t>=n)return e.slice(0);c.seed=r;for(var i=r?function(){return c.getFloat()}:Math.random,o=new Set,a=[];a.length<t;){var s=Math.floor(i()*n);o.has(s)||(o.add(s),a.push(e[s]))}return a},t.shuffle=function(e,t){c.seed=t;for(var r=t?function(){return c.getFloat()}:Math.random,n=e.length-1;n>0;n--){var i=Math.floor(r()*(n+1)),o=e[n];e[n]=e[i],e[i]=o}return e};var c=new n;function u(e,t){return-1===e.indexOf(t)}function p(e,t,r){return!e.some(t.bind(null,r))}function d(e){return e}t.keysOfMap=function(e){var t=new Array(e.size),r=0;return e.forEach((function(e,n){return t[r++]=n})),t},t.keysOfSet=function(e,t){void 0===t&&(t=d);var r=new Array(e.size),n=0;return e.forEach((function(e){return r[n++]=t(e)})),r},t.fromMapValues=function(e){if(Array.from)return Array.from(e.values());var t=new Array(e.size),r=0;return e.forEach((function(e){return t[r++]=e})),t},t.remove=function(e,t){var r=e.indexOf(t);return-1!==r?(e.splice(r,1),t):null}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(179)],void 0===(i=function(e,t,r,n,i){function o(e){return r.clamp(i.ensureInteger(e),0,255)}function a(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}function s(e,t,r){r<0&&++r,r>1&&--r;var n=6*r;return n<1?e+(t-e)*n:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}var l=function(){function e(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}return e.blendColors=function(t,r,n,i){return void 0===i&&(i=new e),i.r=Math.round(t.r+(r.r-t.r)*n),i.g=Math.round(t.g+(r.g-t.g)*n),i.b=Math.round(t.b+(r.b-t.b)*n),i.a=t.a+(r.a-t.a)*n,i._sanitize()},e.fromRgb=function(t,r){var n=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(n){var i=n[2].split(/\s*,\s*/),o=n[1];if("rgb"===o&&3===i.length||"rgba"===o&&4===i.length){var a=i[0];if("%"===a.charAt(a.length-1)){var l=i.map((function(e){return 2.56*parseFloat(e)}));return 4===i.length&&(l[3]=parseFloat(i[3])),e.fromArray(l,r)}return e.fromArray(i.map((function(e){return parseFloat(e)})),r)}if("hsl"===o&&3===i.length||"hsla"===o&&4===i.length){var c=(parseFloat(i[0])%360+360)%360/360,u=parseFloat(i[1])/100,p=parseFloat(i[2])/100,d=p<=.5?p*(u+1):p+u-p*u,h=2*p-d;return l=[256*s(h,d,c+1/3),256*s(h,d,c),256*s(h,d,c-1/3),1],4===i.length&&(l[3]=parseFloat(i[3])),e.fromArray(l,r)}}return null},e.fromHex=function(t,r){void 0===r&&(r=new e);var n=4===t.length?4:8,i=(1<<n)-1,o=Number("0x"+t.substr(1));return isNaN(o)?null:(["b","g","r"].forEach((function(e){var t=o&i;o>>=n,r[e]=4===n?17*t:t})),r.a=1,r)},e.fromArray=function(t,r){return void 0===r&&(r=new e),r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()},e.fromString=function(t,r){var n=e.named[t];return n&&e.fromArray(n,r)||e.fromRgb(t,r)||e.fromHex(t,r)},e.fromJSON=function(t){return t&&new e([t[0],t[1],t[2],t[3]/255])},e.toUnitRGB=function(e){return n.isSome(e)?[e.r/255,e.g/255,e.b/255]:null},e.toUnitRGBA=function(e){return n.isSome(e)?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null},Object.defineProperty(e.prototype,"isBright",{get:function(){return.299*this.r+.587*this.g+.114*this.b>=127},enumerable:!0,configurable:!0}),e.prototype.setColor=function(t){return"string"==typeof t?e.fromString(t,this):Array.isArray(t)?e.fromArray(t,this):(this._set(t.r,t.g,t.b,t.a),t instanceof e||this._sanitize()),this},e.prototype.toRgb=function(){return[this.r,this.g,this.b]},e.prototype.toRgba=function(){return[this.r,this.g,this.b,this.a]},e.prototype.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),r=this.b.toString(16);return"#"+(e.length<2?"0"+e:e)+(t.length<2?"0"+t:t)+(r.length<2?"0"+r:r)},e.prototype.toCss=function(e){void 0===e&&(e=!1);var t=this.r+", "+this.g+", "+this.b;return e?"rgba("+t+", "+this.a+")":"rgb("+t+")"},e.prototype.toString=function(){return this.toCss(!0)},e.prototype.toJSON=function(){return this.toArray()},e.prototype.toArray=function(e){void 0===e&&(e=0);var t=o(this.r),r=o(this.g),n=o(this.b);return 0===e||1!==this.a?[t,r,n,o(255*this.a)]:[t,r,n]},e.prototype.clone=function(){return new e(this.toRgba())},e.prototype.hash=function(){return this.r<<24|this.g<<16|this.b<<8|255*this.a},e.prototype._sanitize=function(){return this.r=Math.round(a(this.r,0,255)),this.g=Math.round(a(this.g,0,255)),this.b=Math.round(a(this.b,0,255)),this.a=a(this.a,0,1),this},e.prototype._set=function(e,t,r,n){this.r=e,this.g=t,this.b=r,this.a=n},e.named={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},e}();return l.prototype.declaredClass="esri.Color",l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1432),r(1437),r(576),r(1439)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t),r.__exportStar(i,t),r.__exportStar(o,t),t.isWidget=function(e){return e&&"function"==typeof e.render},t.hasDomNode=function(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(229),r(151),r(215),r(202),r(170),r(407),r(479),r(178),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){function h(e,t,r){return null==t?r:null==r?t:e(t,r)}var f=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.type="extent",n.xmin=0,n.ymin=0,n.mmin=void 0,n.zmin=void 0,n.xmax=0,n.ymax=0,n.mmax=void 0,n.zmax=void 0,n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t,r,n,i){return!(o=e)||"esri.geometry.SpatialReference"!==o.declaredClass&&null==o.wkid?"object"==typeof e?(e.spatialReference=null==e.spatialReference?l.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:n,spatialReference:null==i?l.WGS84:i}:{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0};var o},t.fromBounds=function(e,t){return new a({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})},Object.defineProperty(t.prototype,"center",{get:function(){var e=new s({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){return null!=this.mmin&&null!=this.mmax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){return null!=this.zmin&&null!=this.zmax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return Math.abs(this.ymax-this.ymin)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return Math.abs(this.xmax-this.xmin)},enumerable:!0,configurable:!0}),t.prototype.centerAt=function(e){var t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)},t.prototype.clone=function(){var e=new a;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e},t.prototype.contains=function(e){if(!e)return!1;var t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&d.canProject(t,r)&&(e=t.isWebMercator?d.geographicToWebMercator(e):d.webMercatorToGeographic(e,!0)),"point"===e.type?c.extentContainsPoint(this,e):"extent"===e.type&&c.extentContainsExtent(this,e)},t.prototype.equals=function(e){if(!e)return!1;var t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&d.canProject(t,r)&&(e=t.isWebMercator?d.geographicToWebMercator(e):d.webMercatorToGeographic(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax},t.prototype.expand=function(e){var t=.5*(1-e),r=this.width*t,n=this.height*t;if(this.xmin+=r,this.ymin+=n,this.xmax-=r,this.ymax-=n,this.hasZ){var i=(this.zmax-this.zmin)*t;this.zmin+=i,this.zmax-=i}if(this.hasM){var o=(this.mmax-this.mmin)*t;this.mmin+=o,this.mmax-=o}return this},t.prototype.intersects=function(e){if(n.isNone(e))return!1;var t=this.spatialReference,r=e.spatialReference;t&&r&&!t.equals(r)&&d.canProject(t,r)&&(e=t.isWebMercator?d.geographicToWebMercator(e):d.webMercatorToGeographic(e,!0));var i=u.getExtentIntersector(e.type);return"mesh"!==e.type?i(this,e):i(this,e.extent)},t.prototype.normalize=function(){var e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]},t.prototype.offset=function(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=r&&(this.zmin+=r,this.zmax+=r),this},t.prototype.shiftCentralMeridian=function(){return this._normalize(!0)},t.prototype.union=function(e){return this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=h(Math.min,this.zmin,e.zmin),this.zmax=h(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=h(Math.min,this.mmin,e.mmin),this.mmax=h(Math.max,this.mmax,e.mmax)),this},t.prototype.intersection=function(e){return this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=h(Math.max,this.zmin,e.zmin),this.zmax=h(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=h(Math.max,this.mmin,e.mmin),this.mmax=h(Math.min,this.mmax,e.mmax)),this):null},t.prototype.toJSON=function(e){return this.write(null,e)},t.prototype._shiftCM=function(e){if(void 0===e&&(e=p.getInfo(this.spatialReference)),!e||!this.spatialReference)return this;var t=this.spatialReference,r=this._getCM(e);if(r){var n=t.isWebMercator?d.webMercatorToGeographic(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(n.x=this._normalizeX(n.x,e).x),this.spatialReference=new l(i.replace(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:n.x}))}return this},t.prototype._getCM=function(e){var t=null,r=e.valid,n=r[0],i=r[1],o=this.xmin,a=this.xmax;return o>=n&&o<=i&&a>=n&&a<=i||(t=this.center),t},t.prototype._normalize=function(e,t,r){var n=this.spatialReference;if(!n)return this;if(!(r=r||p.getInfo(n)))return this;var i=this._getParts(r).map((function(e){return e.extent}));if(i.length<2)return i[0]||this;if(i.length>2)return e?this._shiftCM(r):this.set({xmin:r.valid[0],xmax:r.valid[1]});if(e)return this._shiftCM(r);if(t)return i;var o=!0,a=!0;return i.forEach((function(e){e.hasZ||(o=!1),e.hasM||(a=!1)})),{rings:i.map((function(e){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(o)for(var r=(e.zmax-e.zmin)/2,n=0;n<t.length;n++)t[n].push(r);if(a){var i=(e.mmax-e.mmin)/2;for(n=0;n<t.length;n++)t[n].push(i)}return t})),hasZ:o,hasM:a,spatialReference:n}},t.prototype._getParts=function(e){var t=this.cache._parts;if(!t){t=[];var r=this.ymin,n=this.ymax,i=this.spatialReference,o=this.width,s=this.xmin,l=this.xmax,c=void 0,u=(e=e||p.getInfo(i)).valid,d=u[0],h=u[1],f=(c=this._normalizeX(this.xmin,e)).x,v=c.frameId,m=(c=this._normalizeX(this.xmax,e)).x,y=c.frameId,g=f===m&&o>0;if(o>2*h){var _=new a(s<l?f:m,r,h,n,i),b=new a(d,r,s<l?m:f,n,i),x=new a(0,r,h,n,i),w=new a(d,r,0,n,i),S=[],P=[];_.contains(x)&&S.push(v),_.contains(w)&&P.push(v),b.contains(x)&&S.push(y),b.contains(w)&&P.push(y);for(var T=v+1;T<y;T++)S.push(T),P.push(T);t.push({extent:_,frameIds:[v]},{extent:b,frameIds:[y]},{extent:x,frameIds:S},{extent:w,frameIds:P})}else f>m||g?t.push({extent:new a(f,r,h,n,i),frameIds:[v]},{extent:new a(d,r,m,n,i),frameIds:[y]}):t.push({extent:new a(f,r,m,n,i),frameIds:[v]});this.cache._parts=t}var O=this.hasZ,C=this.hasM;if(O||C){var M={};O&&(M.zmin=this.zmin,M.zmax=this.zmax),C&&(M.mmin=this.mmin,M.mmax=this.mmax);for(var A=0;A<t.length;A++)t[A].extent.set(M)}return t},t.prototype._normalizeX=function(e,t){var r,n=t.valid,i=n[0],o=n[1],a=2*o,s=0;return e>o?(e-=(r=Math.ceil(Math.abs(e-o)/a))*a,s=r):e<i&&(e+=(r=Math.ceil(Math.abs(e-i)/a))*a,s=-r),{x:e,frameId:s}},r.__decorate([o.property({dependsOn:["xmin","ymin","zmin","mmin","xmax","ymax","zmax","mmax","spatialReference"]})],t.prototype,"cache",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["cache"]})],t.prototype,"center",null),r.__decorate([o.property({readOnly:!0,dependsOn:["cache"]})],t.prototype,"extent",null),r.__decorate([o.property({readOnly:!0,dependsOn:["mmin","mmax"],json:{write:{enabled:!1,overridePolicy:null}}})],t.prototype,"hasM",null),r.__decorate([o.property({readOnly:!0,dependsOn:["zmin","zmax"],json:{write:{enabled:!1,overridePolicy:null}}})],t.prototype,"hasZ",null),r.__decorate([o.property({readOnly:!0,dependsOn:["ymin","ymax"]})],t.prototype,"height",null),r.__decorate([o.property({readOnly:!0,dependsOn:["xmin","xmax"]})],t.prototype,"width",null),r.__decorate([o.property({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],t.prototype,"xmin",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"ymin",void 0),r.__decorate([o.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],t.prototype,"mmin",void 0),r.__decorate([o.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],t.prototype,"zmin",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"xmax",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"ymax",void 0),r.__decorate([o.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],t.prototype,"mmax",void 0),r.__decorate([o.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],t.prototype,"zmax",void 0),a=r.__decorate([o.subclass("esri.geometry.Extent")],t)}(a);return f.prototype.toJSON.isDefaultToJSON=!0,f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1168)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=r}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(258),r(169),r(620),r(190),r(167),r(156),r(303),r(153),r(157),r(151),r(621),r(183)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){var v=l.getLogger("esri.widgets.Widget"),m=0;return function(e){function t(t,i){var o=e.call(this,t,i)||this;o._attached=!1,o._internalHandles=new s,o.domNode=null,o.iconClass="esri-icon-checkbox-unchecked",o.label=o.declaredClass.split(".").pop(),o.visible=!0,o._loadLocale=u.debounce((function(){return r.__awaiter(o,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){switch(t.label){case 0:return this._messageBundleProps&&this._messageBundleProps.length?[4,u.eachAlways(this._messageBundleProps.map((function(t){var i=t.bundlePath,o=t.propertyName;return r.__awaiter(e,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this,t=o,[4,n.loadMessageBundle(i)];case 1:return e[t]=r.sent(),[2]}}))}))}))).then((function(t){for(var r=0,n=t;r<n.length;r++){var i=n[r];i.error&&v.error("widget-intl:locale-error",e.declaredClass,i.error)}}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.loadLocale()];case 3:return t.sent(),[2]}}))}))}));var a="esri-widget-uid-"+Date.now().toString(16),l=o.render.bind(o),c=!1;return o.render=function(){if(!c||o.destroyed)return null;var e=l();return e.properties?e.properties.key||(e.properties.key=a):e.properties={key:a},e},o.addResolvingPromise(o._resourcesFetch=o.beforeFirstRender().then((function(){c=!0,o._postInitialize()}))),o}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){var n=r.__assign({},e);return t&&(n.container=t),n},t.prototype.postInitialize=function(){},t.prototype.beforeFirstRender=function(){return this._loadLocale()},t.prototype.loadLocale=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.destroy=function(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._internalHandles.destroy(),this._emitter.clear())},Object.defineProperty(t.prototype,"container",{set:function(e){this._get("container")||this._set("container",e)},enumerable:!0,configurable:!0}),t.prototype.castContainer=function(e){return o.byId(e)},Object.defineProperty(t.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+m++},set:function(e){e&&this._set("id",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderable",{get:function(){return this._resourcesFetch},enumerable:!0,configurable:!0}),t.prototype.render=function(){throw new Error("not implemented")},t.prototype.scheduleRender=function(){this.destroyed||this._projector.scheduleRender()},t.prototype.classes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f.classes.apply(this,e)},t.prototype.own=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)},t.prototype.renderNow=function(){this._projector.renderNow()},t.prototype._postInitialize=function(){var e,t,o=this;this.destroyed||((null===(e=this._renderableProps)||void 0===e?void 0:e.length)&&this._internalHandles.add(this._renderableProps.map((function(e){return p.init(o,e,(function(t,r){var n=this;if(i.isCollection(r)&&this._internalHandles.remove(this.declaredClass+":"+e+"-collection-change-event-listener"),i.isCollection(t)){var o=t.on("change",(function(){return n.scheduleRender()}));this._internalHandles.add(o,this.declaredClass+":"+e+"-collection-change-event-listener")}this.scheduleRender()}))}))),(null===(t=this._delegatedEventNames)||void 0===t?void 0:t.length)&&this._internalHandles.add(p.init(this,"viewModel",(function(e,t){t&&o._internalHandles.remove("delegated-events"),e&&o._internalHandles.add(o._delegatedEventNames.map((function(t){return e.on(t,(function(e){o.emit(t,e)}))})),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(n.onLocaleChange((function(){return r.__awaiter(o,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._loadLocale()];case 1:return e.sent(),this.scheduleRender(),[2]}}))}))}))),this._internalHandles.add(p.whenOnce(this,"container",(function(e){return r.__awaiter(o,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.destroyed||this._attach(e),[2]}))}))}))))},t.prototype._attach=function(e){e&&(this._projector.merge(e,this.render),this._attached=!0)},t.prototype._detach=function(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)},r.__decorate([d.shared(h.createProjector())],t.prototype,"_projector",void 0),r.__decorate([d.property({value:null})],t.prototype,"container",null),r.__decorate([d.cast("container")],t.prototype,"castContainer",null),r.__decorate([d.property({aliasOf:"container"})],t.prototype,"domNode",void 0),r.__decorate([d.property()],t.prototype,"iconClass",void 0),r.__decorate([d.property({dependsOn:["container"]})],t.prototype,"id",null),r.__decorate([d.property()],t.prototype,"label",void 0),r.__decorate([d.property()],t.prototype,"renderable",null),r.__decorate([d.property()],t.prototype,"viewModel",void 0),r.__decorate([d.property()],t.prototype,"visible",void 0),r.__decorate([d.subclass("esri.widgets.Widget")],t)}(c.EsriPromiseMixin(a.EventedAccessor))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1592)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(759),r(151)],void 0===(i=function(e,t,r,n,i,o){var a=function(){function e(){this._emitter=new e.EventEmitter}return e.prototype.emit=function(e,t){return this._emitter.emit(e,t)},e.prototype.on=function(e,t){return this._emitter.on(e,t)},e.prototype.once=function(e,t){return this._emitter.once(e,t)},e.prototype.hasEventListener=function(e){return this._emitter.hasEventListener(e)},e}();return function(e){var t=function(){function e(){}return e.prototype.clear=function(){this._listenersMap&&this._listenersMap.clear()},e.prototype.emit=function(e,t){var n=this._listenersMap&&this._listenersMap.get(e);return!!n&&(r.__spreadArrays(n).forEach((function(e){e.call(null,t)})),n.length>0)},e.prototype.on=function(e,t){var r=this;if(Array.isArray(e)){var n=e.map((function(e){return r.on(e,t)}));return i.handlesGroup(n)}if(e.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);var o=this._listenersMap.get(e)||[];return o.push(t),this._listenersMap.set(e,o),{remove:function(){var n=r._listenersMap&&r._listenersMap.get(e)||[];n.indexOf(t)>=0&&n.splice(n.indexOf(t),1)}}},e.prototype.once=function(e,t){var r;return r=this.on(e,(function(e){r.remove(),t.call(null,e)}))},e.prototype.hasEventListener=function(e){var t=this._listenersMap&&this._listenersMap.get(e);return null!=t&&t.length>0},e}();e.EventEmitter=t,e.EventedMixin=function(e){return function(e){function n(){var r=null!==e&&e.apply(this,arguments)||this;return r._emitter=new t,r}return r.__extends(n,e),n.prototype.emit=function(e,t){return this._emitter.emit(e,t)},n.prototype.on=function(e,t){return this._emitter.on(e,t)},n.prototype.once=function(e,t){return this._emitter.once(e,t)},n.prototype.hasEventListener=function(e){return this._emitter.hasEventListener(e)},r.__decorate([o.subclass("esri.core.Evented")],n)}(e)};var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._emitter=new a.EventEmitter,t}return r.__extends(t,e),t.prototype.emit=function(e,t){return this._emitter.emit(e,t)},t.prototype.on=function(e,t){return this._emitter.on(e,t)},t.prototype.once=function(e,t){return this._emitter.once(e,t)},t.prototype.hasEventListener=function(e){return this._emitter.hasEventListener(e)},r.__decorate([o.subclass("esri.core.Evented")],t)}(n);e.EventedAccessor=s}(a||(a={})),a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(296),r(154),r(152),r(119),r(153),r(198),r(622),r(246),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){function d(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n],a=s.getDeepValue(o,t),l=a&&"function"!=typeof a&&y(r,a);l&&s.setDeepValue(o,l.name,t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.rendererFields=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],t.visualVariableFields=["field","normalizationField"],t.fixRendererFields=function(e,r){if(null!=e&&null!=r)for(var n=0,i=Array.isArray(e)?e:[e];n<i.length;n++){var o=i[n];if(d(t.rendererFields,o,r),"visualVariables"in o&&o.visualVariables)for(var a=0,s=o.visualVariables;a<s.length;a++){var l=s[a];d(t.visualVariableFields,l,r)}}},t.fixTimeInfoFields=function(e,t){if(null!=e&&null!=t)if("startField"in e){var r=y(t,e.startField),n=y(t,e.endField);e.startField=r&&r.name||null,e.endField=n&&n.name||null}else{var i=y(t,e.startTimeField),o=y(t,e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=o&&o.name||null}};var h=new Set;function f(e,t){return e&&t?(h.clear(),v(h,e,t),c.valuesOfSet(h).sort()):[]}function v(e,t,r){if(r)if(t&&t.length)if(i.includes(r,"*"))for(var n=0,o=t;n<o.length;n++){var a=o[n].name;e.add(a)}else for(var s=0,l=r;s<l.length;s++)m(e,t,p=l[s]);else{if(i.includes(r,"*"))return e.clear(),void e.add("*");for(var c=0,u=r;c<u.length;c++){var p=u[c];e.add(p)}}}function m(e,t,r){if(t&&t.length){var n=y(t,r);n&&e.add(n.name)}else"string"==typeof r&&e.add(r)}function y(e,t){if("string"!=typeof t)return null;if(null!=e){t=t.toLowerCase();for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i&&i.name.toLowerCase()===t)return i}}return null}function g(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l;return n.__generator(this,(function(n){switch(n.label){case 0:return r?[4,p.loadArcade()]:[2];case 1:for(i=n.sent().arcadeUtils,o=i.extractFieldNames(r),a=0,s=o;a<s.length;a++)l=s[a],m(e,t,l);return[2]}}))}))}function _(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i&&i.valueType&&i.valueType===t)return i.name}return null}function b(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i;return n.__generator(this,(function(n){return t?(r=t.fields,(i=s.getDeepValue("elevationInfo.featureExpressionInfo",t))?[2,i.collectRequiredFields(e,r)]:[2]):[2]}))}))}function x(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i;return n.__generator(this,(function(o){switch(o.label){case 0:return r=t.labelingInfo,i=t.fields,r&&r.length?[4,l.all(r.map((function(t){return function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l;return n.__generator(this,(function(n){switch(n.label){case 0:return r?(i=r.getLabelExpression(),o=r.where,"arcade"!==i.type?[3,2]:[4,g(e,t,i.expression)]):[2];case 1:return n.sent(),[3,3];case 2:(a=i.expression.match(/{[^}]*}/g))&&a.forEach((function(r){m(e,t,r.slice(1,-1))})),n.label=3;case 3:return s=/['"]+/g,o&&(3===(l=o.split(" ")).length&&m(e,t,l[0].replace(s,"")),7===l.length&&(m(e,t,l[0].replace(s,"")),m(e,t,l[4].replace(s,"")))),[2]}}))}))}(e,i,t)})))]:[2];case 1:return o.sent(),[2]}}))}))}function w(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function S(e){return null===e||w(e)}t.fixFields=f,t.collectFields=v,t.collectField=m,t.unpackFieldNames=function(e,t){return t&&e?i.includes(t,"*")?e.map((function(e){return e.name})):t:[]},t.packFields=function(e,t,r){if(void 0===r&&(r=1),!t||!e)return[];if(i.includes(t,"*"))return["*"];var n=f(e,t);return n.length/e.length>=r?["*"]:n},t.getField=y,t.hasField=function(e,t){if(!e||!t||"string"!=typeof t)return!1;t=t.toLowerCase();for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i&&i.name.toLowerCase()===t)return!0}return!1},t.collectArcadeFieldNames=g,t.getDisplayFieldName=function(e){var t=e.displayField,r=e.fields;return t||(r&&r.length?_(r,"name-or-title")||_(r,"unique-identifier")||_(r,"type-or-category")||function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(n&&n.name){var i=n.name.toLowerCase();if(i.indexOf("name")>-1||i.indexOf("title")>-1)return n.name}}return null}(r):null)},t.getElevationFields=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){switch(r.label){case 0:return e?[4,b(t=new Set,e)]:[2,[]];case 1:return r.sent(),[2,c.valuesOfSet(t).sort()]}}))}))},t.collectElevationFields=b,t.collectFeatureReductionFields=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(i){switch(i.label){case 0:return t&&r&&"cluster"===r.type&&r.fields?[4,l.all(r.fields.map((function(r){return function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return r.outStatistic.onStatisticValueExpression?g(e,t,r.outStatistic.onStatisticValueExpression):e.add(r.outStatistic.onStatisticField),[2]}))}))}(e,t.fields,r)})))]:[2];case 1:return i.sent(),[2]}}))}))},t.collectFilterFields=function(e,t,i){return n.__awaiter(this,void 0,void 0,(function(){var a,s;return n.__generator(this,(function(n){switch(n.label){case 0:return t&&i&&(i.where&&"1=1"!==i.where||i.timeExtent)?(t.timeInfo&&i.timeExtent&&v(e,t.fields,[t.timeInfo.startField,t.timeInfo.endField]),i.where?[4,new Promise((function(e,t){r.e(5).then(function(){var t=[r(301)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:[3,2]):[2];case 1:if(a=n.sent(),!(s=a.WhereClause.create(i.where,t.fieldsIndex)).isStandardized)throw new o("fieldUtils:collectFilterFields","Where clause is not standardized");v(e,t.fields,s.fieldNames),n.label=2;case 2:return[2]}}))}))},t.getTimeFields=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){return e&&(t="timeInfo"in e&&e.timeInfo)?[2,f(e.fields,[e.trackIdField,t.startField,t.endField])]:[2,[]]}))}))},t.getFeatureEditFields=function(e){if(!e)return[];var t="editFieldsInfo"in e&&e.editFieldsInfo;return t?f(e.fields,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]},t.getFeatureGeometryFields=function(e){if(!e)return[];var t="geometryProperties"in e&&e.geometryProperties;return t?f(e.fields,[t&&t.shapeAreaFieldName,t&&t.shapeLengthFieldName]):[]},t.getLabelingFields=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){switch(r.label){case 0:return e?[4,x(t=new Set,e)]:[2,[]];case 1:return r.sent(),[2,c.valuesOfSet(t).sort()]}}))}))},t.collectLabelingFields=x,t.getFieldDefaultValue=function(e){var t=e.defaultValue;return void 0!==t&&A(e,t)?t:e.nullable?null:void 0};var P="isInteger"in Number?Number.isInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function T(e){return null===e||P(e)}function O(e){return null!=e&&"string"==typeof e}function C(e){return null===e||O(e)}function M(){return!0}function A(e,t){var r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?T:P;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?S:w;break;case"string":case"esriFieldTypeString":r=e.nullable?C:O;break;default:r=M}return 1===arguments.length?r:r(t)}t.isValueMatchingFieldType=A,t.numericTypes=["integer","small-integer","single","double"];var E,I,R=c.SetFromValues(n.__spreadArrays(t.numericTypes,["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]));function D(e){return null!=e&&R.has(e.type)}function L(e,t){return e.nullable&&null===t?null:D(e)&&!j(e.type,Number(t))?E.OUT_OF_RANGE:A(e,t)?e.domain?u.validateDomainValue(e.domain,t):null:I.INVALID_TYPE}function j(e,t){var r="string"==typeof e?V(e):e;return!!r&&(r.isInteger?P(t)&&t>=r.min&&t<=r.max:t>=r.min&&t<=r.max)}function V(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return t.smallIntegerRange;case"esriFieldTypeInteger":case"integer":return t.integerRange;case"esriFieldTypeSingle":case"single":return t.singleRange;case"esriFieldTypeDouble":case"double":return t.doubleRange}}function F(e,t,r){if(!t||!t.attributes||!e){if(a.isSome(r))for(var n=0,i=e;n<i.length;n++){var o=i[n];r.add(o)}return!0}for(var s=t.attributes,l=!1,c=0,u=e;c<u.length;c++)if(!((o=u[c])in s)){if(l=!0,!a.isSome(r))break;r.add(o)}return l}t.isNumericField=D,t.isStringField=function(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)},t.isDateField=function(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)},t.isValidFieldValue=function(e,t){return null===L(e,t)},function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(E=t.NumericRangeValidationError||(t.NumericRangeValidationError={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(I=t.TypeValidationError||(t.TypeValidationError={})),t.sanitizeNullFieldValue=function(e){return null==e||"number"==typeof e&&isNaN(e)?null:e},t.validateFieldValue=L,t.isNumberInRange=j,t.getFieldRange=function(e){return u.getDomainRange(e.domain)||(D(e)?V(e.type):void 0)},t.getNumericTypeForValue=function(e){if(!w(e))return null;if(P(e)){if(e>=t.smallIntegerRange.min&&e<=t.smallIntegerRange.max)return"esriFieldTypeSmallInteger";if(e>=t.integerRange.min&&e<=t.integerRange.max)return"esriFieldTypeInteger"}return e>=t.singleRange.min&&e<=t.singleRange.max?"esriFieldTypeSingle":"esriFieldTypeDouble"},t.smallIntegerRange={min:-32768,max:32767,isInteger:!0},t.integerRange={min:-2147483648,max:2147483647,isInteger:!0},t.singleRange={min:-34e37,max:12e37,isInteger:!1},t.doubleRange={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1},t.validationErrorToString=function(e,t,r){switch(e){case u.DomainValidationError.INVALID_CODED_VALUE:return"Value "+r+" is not in the coded domain - field: "+t.name+", domain: "+JSON.stringify(t.domain);case u.DomainValidationError.VALUE_OUT_OF_RANGE:return"Value "+r+" is out of the range of valid values - field: "+t.name+", domain: "+JSON.stringify(t.domain);case I.INVALID_TYPE:return"Value "+r+" is not a valid value for the field type - field: "+t.name+", type: "+t.type+", nullable: "+t.nullable;case E.OUT_OF_RANGE:var n=V(t.type),i=n.min,o=n.max;return"Value "+r+" is out of range for the number type - field: "+t.name+", type: "+t.type+", value range is "+i+" to "+o}},t.featureHasFields=function(e,t){return!F(e,t,null)},t.populateMissingFields=F,t.getExpressionFields=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,a;return n.__generator(this,(function(n){switch(n.label){case 0:r=new Set,i=0,o=t,n.label=1;case 1:return i<o.length?(a=o[i],[4,g(r,e.fields,a)]):[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return[2,c.valuesOfSet(r).sort()]}}))}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(200),r(189),r(162),r(160),r(202),r(170),r(173),r(207),r(238),r(1163)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f,v,m,y,g,_,b,x;function w(e,t,r,n){return!(e.length<2)&&(2===e.length&&(K[0]=e[0],K[1]=e[1],K[2]=0,e=K),P(e,t,0,r,n,0,1))}function S(e,t,r,n,i,o,a){void 0===a&&(a=0);for(var s=new Array,l=0,c=e;l<c.length;l++)for(var u=0,p=m=c[l];u<p.length;u++){var d=p[u];s.push(d[0],d[1],t?d[2]:a)}if(!P(s,n,0,s,o,0,s.length/3))return!1;var h=0;i.length=0;for(var f=0,v=e;f<v.length;f++){for(var m=v[f],y=new Array,g=0,_=m;g<_.length;g++)d=_[g],t&&r?y.push([s[h++],s[h++],s[h++],d[3]]):t?y.push([s[h++],s[h++],s[h++]]):r?(y.push([s[h++],s[h++],d[2]]),h++):(y.push([s[h++],s[h++]]),h++);i.push(y)}return!0}function P(e,t,r,i,o,a,s){void 0===s&&(s=1);var l=B(t,o,J);if(n.isNone(l))return!1;if(l===O){if(e===i&&r===a)return!0;for(var c=r+3*s,u=r,p=a;u<c;u++,p++)i[p]=e[u];return!0}var d=r+3*s;for(u=r,p=a;u<d;u+=3,p+=3)l(e,u,i,p);return!0}function T(e,r){return r.spatialReference===e?r.spatialReferenceId:(r.spatialReference=e,"metersPerUnit"in r&&(r.metersPerUnit=i.getMetersPerUnitForSR(e,1)),e.wkt===t.SphericalECEFSpatialReference.wkt?r.spatialReferenceId=1:e.isWGS84?r.spatialReferenceId=2:e.isWebMercator?r.spatialReferenceId=3:e.wkt===t.WGS84ECEFSpatialReference.wkt?r.spatialReferenceId=4:4490===e.wkid?r.spatialReferenceId=5:r.spatialReferenceId=0)}function O(e,t,r,n){e!==r&&(r[n++]=e[t++],r[n++]=e[t++],r[n]=e[t])}function C(e,t,r,n){r[n++]=Y*(e[t++]/d.earthRadius),r[n++]=Y*(Math.PI/2-2*Math.atan(Math.exp(-1*e[t++]/d.earthRadius))),r[n]=e[t]}function M(e,t,r,n){C(e,t,r,n),D(r,n,r,n)}function A(e,t,r,n){C(e,t,r,n),F(r,n,r,n)}function E(e,t,n,i){var o=.4999999*Math.PI,a=r.clamp(X*e[t+1],-o,o),s=Math.sin(a);n[i++]=X*e[t]*d.earthRadius,n[i++]=d.halfEarthRadius*Math.log((1+s)/(1-s)),n[i]=e[t+2]}function I(e,t,r){var i=T(t,q),o=U[i][6];return!n.isNone(o)&&(o(e,0,K,0),r!==K&&(r[0]=K[0],r[1]=K[1],r.length>2&&(r[2]=K[2])),!0)}function R(e,t){return K[0]=e.x,K[1]=e.y,K[2]=e.hasZ?e.z:0,I(K,e.spatialReference,t)}function D(e,t,r,n){var i=d.earthRadius+e[t+2],o=X*e[t+1],a=X*e[t],s=Math.cos(o);r[n++]=Math.cos(a)*s*i,r[n++]=Math.sin(a)*s*i,r[n]=Math.sin(o)*i}function L(e,t,n,i){var o=h.Vec3Compact.length(e,t),a=r.asinClamped(e[t+2]/(0===o?1:o)),s=Math.atan2(e[t+1],e[t]);n[i++]=Y*s,n[i++]=Y*a,n[i]=o-d.earthRadius}function j(e,t,r,n){L(e,t,r,n),E(r,n,r,n)}function V(e,t,r,n){L(e,t,r,n),F(r,n,r,n)}function F(e,t,r,n){var i=Q,o=X*e[t],a=X*e[t+1],s=e[t+2],l=Math.sin(a),c=Math.cos(a),u=i.a/Math.sqrt(1-i.e2*l*l);r[n++]=(u+s)*c*Math.cos(o),r[n++]=(u+s)*c*Math.sin(o),r[n++]=(u*(1-i.e2)+s)*l}function N(e,t,r,n){var i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T=Q,O=e[t],C=e[t+1],M=e[t+2];i=Math.abs(M),o=O*O+C*C,a=Math.sqrt(o),s=o+M*M,l=Math.sqrt(s),S=Math.atan2(C,O),c=M*M/s,u=o/s,y=T.a2/l,g=T.a3-T.a4/l,u>.3?(p=i/l*(1+u*(T.a1+y+c*g)/l),w=Math.asin(p),h=p*p,d=Math.sqrt(1-h)):(d=a/l*(1-c*(T.a5-y-u*g)/l),w=Math.acos(d),h=1-d*d,p=Math.sqrt(h)),f=1-T.e2*h,v=T.a/Math.sqrt(f),w+=x=(_=d*(g=i-(m=T.a6*v)*p)-p*(y=a-v*d))/(m/f+(b=d*y+p*g)),P=b+_*x/2,M<0&&(w=-w),r[n++]=Y*S,r[n++]=Y*w,r[n]=P}function k(e,t,r,n){N(e,t,r,n),D(r,n,r,n)}function z(e,t,r,n){N(e,t,r,n),E(r,n,r,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalECEFSpatialReference=new c({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'}),t.WGS84ECEFSpatialReference=new c({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'}),t.canProject=function(e,t){return!!B(e,t,J)},t.getProjectorName=function(e,t){var r=B(e,t,J);return r===O?"copy3":r===D?"wgs84ToSphericalECEF":r===E?"wgs84ToWebMercator":r===F?"wgs84ToWGS84ECEF":r===C?"webMercatorToWGS84":r===M?"webMercatorToSphericalECEF":r===A?"webMercatorToWGS84ECEF":r===N?"wgs84ECEFToWGS84":r===k?"wgs84ECEFToSphericalECEF":r===z?"wgs84ECEFToWebMercator":r===L?"sphericalECEFToWGS84":r===j?"sphericalECEFToWebMercator":r===V?"sphericalECEFToWGS84ECEF":null},t.vectorToVector=w,t.polygonToPolygon=function(e,t,r,n){void 0===r&&(r=t.spatialReference),void 0===n&&(n=0);var i=[];return!!S(e.rings,e.hasZ,e.hasM,e.spatialReference,i,r,n)&&(t.rings=i,t.spatialReference=r,t.hasZ=e.hasZ,t.hasM=e.hasM,!0)},t.polylineToPolyline=function(e,t,r,n){void 0===r&&(r=t.spatialReference),void 0===n&&(n=0);var i=[];return!!S(e.paths,e.hasZ,e.hasM,e.spatialReference,i,r,n)&&(t.paths=i,t.spatialReference=r,t.hasZ=e.hasZ,t.hasM=e.hasM,!0)},t.multipointToMultipoint=function(e,t,r,n){void 0===r&&(r=t.spatialReference),void 0===n&&(n=0);var i=new Array;return!!S([e.points],e.hasZ,e.hasM,e.spatialReference,i,r,n)&&(t.points=i[0],t.spatialReference=r,t.hasZ=e.hasZ,t.hasM=e.hasM,!0)},t.pointToPoint=function(e,t,r,n){void 0===r&&(r=t.spatialReference),void 0===n&&(n=0),K[0]=e.x,K[1]=e.y;var i=e.z;return K[2]=void 0!==i?i:n,!!P(K,e.spatialReference,0,K,r,0,1)&&(t.x=K[0],t.y=K[1],t.spatialReference=r,void 0!==i?(t.z=K[2],t.hasZ=!0):(t.z=void 0,t.hasZ=!1),!0)},t.pointToVector=function(e,t,r,n){void 0===n&&(n=0),K[0]=e.x,K[1]=e.y;var i=e.z;return K[2]=void 0!==i?i:n,P(K,e.spatialReference,0,t,r,0,1)},t.vectorToPoint=function(e,t,r,n){var i;return r instanceof l?(i=r,n=n||i.spatialReference):p.isPoint(r)?((i=r).hasZ=!0,n=n||i.spatialReference):i=new l({spatialReference:n=r}),P(e,t,0,K,n,0,1)?(i.x=K[0],i.y=K[1],i.z=K[2],i.spatialReference=n,i):null},t.xyzToVector=function(e,t,r,n,i,o){return K[0]=e,K[1]=t,K[2]=r,P(K,n,0,i,o,0,1)},t.bufferToBuffer=P,t.localLinearScaleFactors=function(e,t,r,n){var i=T(t,q),o=T(n,W);if(i===o&&0!==i||t.equals(n))return r[0]=1,r[1]=1,r[2]=1,!0;if(1===i){var s=a.vec3.length(e),l=s/Math.sqrt(e[0]*e[0]+e[1]*e[1]),c=s/d.earthRadius;if(3===o)return r[0]=l*c,r[1]=l*c,r[2]=1,!0;if(2===o||5===o){var u=180/(d.earthRadius*Math.PI);return r[0]=u*l*c,r[1]=u*c,r[2]=1,!0}}return!1},t.computeLinearTransformation=function(e,t,r,i){var a=T(e,q),s=T(i,W);if(a===s&&1!==s&&(0!==a||e.equals(i)))return o.mat4.identity(r),o.mat4.translate(r,r,t),!0;if(1===s){var l=U[a][6],c=U[6][s];if(n.isNone(l)||n.isNone(c))return!1;l(t,0,$,0),c($,0,ee,0);var u=X*$[0],p=X*$[1],d=Math.sin(u),h=Math.cos(u),f=Math.sin(p),v=Math.cos(p),m=r;return m[0]=-d,m[4]=-f*h,m[8]=v*h,m[12]=ee[0],m[1]=h,m[5]=-f*d,m[9]=v*d,m[13]=ee[1],m[2]=0,m[6]=v,m[10]=f,m[14]=ee[2],m[3]=0,m[7]=0,m[11]=0,m[15]=1,!0}if(3===s&&(2===a||1===a)){if(l=U[a][6],n.isNone(l))return!1;l(t,0,$,0);var y=X*$[1];E($,0,ee,0),o.mat4.identity(r),o.mat4.translate(r,r,ee);var g=1/Math.cos(y);return o.mat4.scale(r,r,[g,g,1]),!0}return!1},t.transformDirection=function(e,t,r,n,i){a.vec3.copy(te,e),a.vec3.add(re,e,t),w(te,r,te,i),w(re,r,re,i),a.vec3.subtract(n,re,te),a.vec3.normalize(n,n)},t.mbsToMbs=function(e,t,r,i){var o=G(t,i,Z);if(o.projector===O)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(n.isNone(o.projector))return!1;var a=o.source,s=o.dest;if(3===s.spatialReferenceId){var l=U[a.spatialReferenceId][2];if(n.isNone(l))return!1;l(e,0,$,0);var c=Math.abs(X*$[1])+Math.asin(e[3]/(d.earthRadius+e[2]));if(E($,0,r,0),c>.9999*Math.PI)r[3]=Number.MAX_VALUE;else{var u=1/Math.cos(c);r[3]=u*e[3]}return!0}return o.projector(e,0,r,0),r[3]=e[3]*a.metersPerUnit/s.metersPerUnit,!0},t.extentToBoundingBox=function(e,t,r){if(null==e)return!1;var n=!0;return K[0]=null!=e.xmin?e.xmin:0,K[1]=null!=e.ymin?e.ymin:0,K[2]=null!=e.zmin?e.zmin:0,n=n&&P(K,e.spatialReference,0,t,r,0,1),K[0]=null!=e.xmax?e.xmax:0,K[1]=null!=e.ymax?e.ymax:0,K[2]=null!=e.zmax?e.zmax:0,n=n&&P(K,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n},t.extentToBoundingRect=function(e,t,r){if(null==e)return!1;var n=!0;return K[0]=null!=e.xmin?e.xmin:0,K[1]=null!=e.ymin?e.ymin:0,K[2]=null!=e.zmin?e.zmin:0,n=n&&P(K,e.spatialReference,0,K,r,0,1),t[0]=K[0],t[1]=K[1],K[0]=null!=e.xmax?e.xmax:0,K[1]=null!=e.ymax?e.ymax:0,K[2]=null!=e.zmax?e.zmax:0,n=n&&P(K,e.spatialReference,0,K,r,0,1),t[2]=K[0],t[3]=K[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n},t.boundingRectToBoundingRect=function(e,t,r,n){return!(null==e||(t.equals(n)?(u.set(r,e),0):(K[0]=e[0],K[1]=e[1],K[2]=0,!P(K,t,0,K,n,0,1)||(r[0]=K[0],r[1]=K[1],K[0]=e[2],K[1]=e[3],K[2]=0,!P(K,t,0,K,n,0,1)||(r[2]=K[0],r[3]=K[1],0)))))},function(e){e.x2lon=function(e){return e/d.earthRadius},e.y2lat=function(e){return Math.PI/2-2*Math.atan(Math.exp(-1*e/d.earthRadius))},e.lon2x=function(e){return e*d.earthRadius},e.lat2y=function(e){var t=Math.sin(e);return d.earthRadius/2*Math.log((1+t)/(1-t))}}(t.webMercator||(t.webMercator={})),t.canProjectToWGS84ComparableLonLat=function(e){var t=T(e,q);return!!U[t][6]},t.vectorToWGS84ComparableLonLat=I,t.pointToWGS84ComparableLonLat=R,t.pointToWGS84ComparableLonLatPoint=function(e,t){var r=T(t.spatialReference,W);return!n.isNone(U[6][r])&&!!R(e,K)&&(t.x=K[0],t.y=K[1],t.z=K[2],!0)},t.wgs84ComparableLonLatToECEF=function(e,t,r,n){void 0===n&&(n=0);var i=d.earthRadius+n,o=Math.cos(r);e[0]=Math.cos(t)*o*i,e[1]=Math.sin(t)*o*i,e[2]=Math.sin(r)*i};var U=((f={})[2]=((v={})[5]=null,v[6]=O,v[1]=D,v[0]=null,v[3]=E,v[2]=O,v[4]=F,v),f[5]=((m={})[5]=O,m[6]=O,m[1]=D,m[0]=null,m[3]=null,m[2]=null,m[4]=F,m),f[3]=((y={})[5]=null,y[6]=C,y[1]=M,y[0]=null,y[3]=O,y[2]=C,y[4]=A,y),f[4]=((g={})[5]=N,g[6]=N,g[1]=k,g[0]=null,g[3]=z,g[2]=N,g[4]=O,g),f[1]=((_={})[5]=L,_[6]=L,_[1]=O,_[0]=null,_[3]=j,_[2]=L,_[4]=V,_),f[0]=((b={})[5]=null,b[6]=null,b[1]=null,b[0]=O,b[3]=null,b[2]=null,b[4]=null,b),f[6]=((x={})[5]=null,x[6]=O,x[1]=D,x[0]=null,x[3]=null,x[2]=O,x[4]=F,x),f);function B(e,t,r){return void 0===r&&(r=H()),G(e,t,r).projector}function G(e,t,r){if(r.source.spatialReference===e&&r.dest.spatialReference===t)return r;var n=T(e,r.source),i=T(t,r.dest);return 0===n&&0===i?e.equals(t)?r.projector=O:r.projector=null:r.projector=U[n][i],r}function H(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:O}}t.getProjector=B;var q={spatialReference:null,spatialReferenceId:0},W={spatialReference:null,spatialReferenceId:0},J=H(),Z=H(),X=r.deg2rad(1),Y=r.rad2deg(1),Q={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1823091254.6075456,a3:142.91722289812412,a4:4557728136.518864,a5:42840.589930055656,a6:.9933056200098622},K=s.vec3f64.create(),$=s.vec3f64.create(),ee=s.vec3f64.create(),te=s.vec3f64.create(),re=s.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(184),r(173)],void 0===(i=function(e,t,r,n,i){function o(e){return void 0===e&&(e=t.ZERO),[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,n,i,a,s){return void 0===s&&(s=o()),s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=i,s[5]=a,s}function s(e){return e[0]>=e[3]?0:e[3]-e[0]}function l(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function u(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function d(e){return 6===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.fromValues=a,t.fromExtent=function(e,t){return void 0===t&&(t=o()),t[0]=e.xmin,t[1]=e.ymin,t[2]=e.zmin,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.zmax,t},t.toExtent=function(e,t){var r=isFinite(e[2])||isFinite(e[5]);return new n(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})},t.fromMinMax=function(e,t,r){return void 0===r&&(r=o()),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},t.expandPointInPlace=function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[3]&&(e[3]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[4]&&(e[4]=t[1]),t[2]<e[2]&&(e[2]=t[2]),t[2]>e[5]&&(e[5]=t[2])},t.expand=function(e,t,r){return void 0===r&&(r=e),d(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5])):i.is(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[2]),r[4]=Math.max(e[4],t[3])):2===t.length?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1])):3===t.length&&(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2])),r},t.expandWithBuffer=function(e,t,r,n,i){void 0===r&&(r=0),void 0===n&&(n=t.length/3),void 0===i&&(i=e);for(var o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],p=0;p<n;p++)o=Math.min(o,t[r+3*p]),a=Math.min(a,t[r+3*p+1]),s=Math.min(s,t[r+3*p+2]),l=Math.max(l,t[r+3*p]),c=Math.max(c,t[r+3*p+1]),u=Math.max(u,t[r+3*p+2]);return i[0]=o,i[1]=a,i[2]=s,i[3]=l,i[4]=c,i[5]=u,i},t.expandWithOffset=function(e,t,r,n,i){return void 0===i&&(i=e),i[0]=Math.min(e[0],e[0]+t),i[3]=Math.max(e[3],e[3]+t),i[1]=Math.min(e[1],e[1]+r),i[4]=Math.max(e[4],e[4]+r),i[2]=Math.min(e[2],e[2]+n),i[5]=Math.max(e[5],e[5]+n),i},t.expandWithNestedArray=function(e,t,r,n){void 0===n&&(n=e);var i=t.length,o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5];if(r)for(var p=0;p<i;p++){var d=t[p];o=Math.min(o,d[0]),a=Math.min(a,d[1]),s=Math.min(s,d[2]),l=Math.max(l,d[0]),c=Math.max(c,d[1]),u=Math.max(u,d[2])}else for(p=0;p<i;p++)d=t[p],o=Math.min(o,d[0]),a=Math.min(a,d[1]),l=Math.max(l,d[0]),c=Math.max(c,d[1]);return n[0]=o,n[1]=a,n[2]=s,n[3]=l,n[4]=c,n[5]=u,n},t.allFinite=function(e){for(var t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},t.width=s,t.depth=l,t.height=c,t.diameter=function(e){var t=s(e),r=c(e),n=l(e);return Math.sqrt(t*t+r*r+n*n)},t.center=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=e[0]+s(e)/2,t[1]=e[1]+l(e)/2,t[2]=e[2]+c(e)/2,t},t.size=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=s(e),t[1]=l(e),t[2]=c(e),t},t.maximumDimension=function(e){return Math.max(s(e),c(e),l(e))},t.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},t.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},t.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},t.intersects=u,t.intersectsClippingArea=function(e,t){return!!r.isNone(t)||u(e,t)},t.offset=function(e,t,r,n,i){return void 0===i&&(i=e),i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+n,i[3]=e[3]+t,i[4]=e[4]+r,i[5]=e[5]+n,i},t.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},t.setMin=function(e,t,r){return void 0===r&&(r=e),r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},t.setMax=function(e,t,r){return void 0===r&&(r=e),r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},t.set=p,t.empty=function(e){return e?p(e,t.NEGATIVE_INFINITY):o(t.NEGATIVE_INFINITY)},t.toRect=function(e,t){return t||(t=i.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},t.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},t.is=d,t.isPoint=function(e){return 0===s(e)&&0===l(e)&&0===c(e)},t.equals=function(e,t,n){if(r.isNone(e)||r.isNone(t))return e===t;if(!d(e)||!d(t))return!1;if(n){for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1}else for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},t.wrap=function(e,t,r,n,i,o){return a(e,t,r,n,i,o,h)},t.POSITIVE_INFINITY=[-1/0,-1/0,-1/0,1/0,1/0,1/0],t.NEGATIVE_INFINITY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],t.ZERO=[0,0,0,0,0,0];var h=o()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151),r(179),r(622),r(786)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=new n.default({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});return function(e){function t(t){var r=e.call(this,t)||this;return r.alias=null,r.defaultValue=void 0,r.description=null,r.domain=null,r.editable=!0,r.length=-1,r.name=null,r.nullable=!0,r.type=null,r.valueType=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readDescription=function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(e){}return r?r.value:null},t.prototype.readValueType=function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(e){}return r?c.fromJSON(r.fieldValueType):null},t.prototype.clone=function(){return new n({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"alias",void 0),r.__decorate([o.property({type:[String,Number],json:{write:{allowNull:!0}}})],t.prototype,"defaultValue",void 0),r.__decorate([o.property()],t.prototype,"description",void 0),r.__decorate([o.reader("description")],t.prototype,"readDescription",null),r.__decorate([o.property({types:s.types,json:{read:{reader:s.fromJSON},write:!0}})],t.prototype,"domain",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"editable",void 0),r.__decorate([o.property({type:a.Integer,json:{write:!0}})],t.prototype,"length",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"nullable",void 0),r.__decorate([o.enumeration(l.kebabDict)],t.prototype,"type",void 0),r.__decorate([o.property()],t.prototype,"valueType",void 0),r.__decorate([o.reader("valueType",["description"])],t.prototype,"readValueType",null),n=r.__decorate([o.subclass("esri.layers.support.Field")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(189),r(205),r(216),r(160),r(245),r(201)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=l.vec4f64.create(),u=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();function p(e,t){if(!e){t=t||"assert";var r=new Error(t);throw r.stack&&console.log(r.stack),new u(t)}}function d(e){for(var t in e)return t}function h(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function f(e,t){void 0===t&&(t=0);for(var r=0,n=0;n<4;n++)r+=e[t+n]*m[n];return r}t.AssertException=u,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"},t.assert=p,t.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},t.encodeInt16=function(e){return r.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var r=Math.abs(e[0]),n=Math.abs(e[1]),i=1/(r+n+Math.abs(e[2])),o=r*i,a=n*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(o-s),t[1]=(e[1]<0?-1:1)*(a-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((r.clamp(Math.round(255*e[0]),0,255)<<16)+(r.clamp(Math.round(255*e[1]),0,255)<<8)+r.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.rayTriangle3D=function(e,t,r,n,i,o,s,l,c){void 0===c&&(c=a.vec3f64.create());var u=n[s]-r[o],p=n[s+1]-r[o+1],d=n[s+2]-r[o+2],h=i[l]-r[o],f=i[l+1]-r[o+1],v=i[l+2]-r[o+2],m=t[1]*v-f*t[2],y=t[2]*h-v*t[0],g=t[0]*f-h*t[1],_=u*m+p*y+d*g;if(_>-1e-5&&_<1e-5)return!1;var b=1/_,x=e[0]-r[o],w=e[1]-r[o+1],S=e[2]-r[o+2];if(c[1]=b*(x*m+w*y+S*g),c[1]<0||c[1]>1)return!1;var P=w*d-p*S,T=S*u-d*x,O=x*p-u*w;return c[2]=b*(t[0]*P+t[1]*T+t[2]*O),!(c[2]<0||c[1]+c[2]>1||(c[0]=b*(h*P+f*T+v*O),0))},t.rayBoxTest=function(e,t,r,n){var i,o=(r[0]-e[0])/t[0],a=(n[0]-e[0])/t[0];o>a&&(i=o,o=a,a=i);var s=(r[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(s>l&&(i=s,s=l,l=i),o>l||s>a)return!1;s>o&&(o=s),l<a&&(a=l);var c=(r[2]-e[2])/t[2],u=(n[2]-e[2])/t[2];return c>u&&(i=c,c=u,u=i),!(o>u||c>a||(u<a&&(a=u),a<0))},t.rayRay2D=function(e,t,r,n,i,a){void 0===a&&(a=o.vec2f64.create());var s=(n[i]-r[i])*(t[0]-e[0])-(n[0]-r[0])*(t[i]-e[i]),l=(n[0]-r[0])*(e[i]-r[i])-(n[i]-r[i])*(e[0]-r[0]);if(0===s)return!1;var c=l/s;return a[0]=e[0]+c*(t[0]-e[0]),a[1]=e[i]+c*(t[i]-e[i]),!0},t.project=function(e,t,r,n,i){i||(i=e),c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,s.vec4.transformMat4(c,c,t),i.length>2&&(i[2]=-c[2]),s.vec4.transformMat4(c,c,r),p(0!==c[3]),i[0]=c[0]/c[3],i[1]=c[1]/c[3],i[2]=c[2]/c[3],i[0]=(.5*i[0]+.5)*n[2]+n[0],i[1]=(.5*i[1]+.5)*n[3]+n[1]},t.getFirstObjectKey=d,t.getFirstObjectValue=function(e){return e[d(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=h,t.setMatrixTranslation3=function(e,t,r,n){e[12]=t,e[13]=r,e[14]=n},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=a.vec3f64.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return h(e=n.mat4.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},t.fovx2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)},t.fovd2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.fovd2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.packFloatRGBA=function(e,t,n){void 0===n&&(n=0);for(var i,o=r.clamp(e,0,y),a=0;a<4;a++)t[n+a]=Math.floor(256*((i=o*v[a])-Math.floor(i)))},t.unpackFloatRGBA=f;var v=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],y=f(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,r,n,o){var a=e;0===e[11]?(n[0]=2/(t*a[0]),n[1]=2/(r*a[5]),n[2]=(1+a[12])/a[0],n[3]=(1+a[13])/a[5],i.vec2.set(o,0,1)):(n[0]=-2/(t*a[0]),n[1]=-2/(r*a[5]),n[2]=(1-a[8])/a[0],n[3]=(1-a[9])/a[5],i.vec2.set(o,1,0))}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(478),r(170),r(178)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.wgs84Radius,s=a/2;function l(e){return 57.29577951308232*e}function c(e){return.017453292519943*e}function u(e){return null!=e.wkid||null!=e.wkt}var p=[0,0];function d(e,t,r,n,i){var o,a,s,l=e,c=i;if("x"in l&&"x"in c)o=t(l.x,l.y,p,n),c.x=o[0],c.y=o[1];else if("xmin"in l&&"xmin"in c)a=t(l.xmin,l.ymin,p,n),c.xmin=a[0],c.ymin=a[1],s=t(l.xmax,l.ymax,p,n),c.xmax=s[0],c.ymax=s[1];else if("paths"in l&&"paths"in c||"rings"in l&&"rings"in c){for(var u=("paths"in l?l.paths:l.rings),d=[],h=void 0,f=0;f<u.length;f++){var v=u[f];h=[],d.push(h);for(var m=0;m<v.length;m++)h.push(t(v[m][0],v[m][1],[0,0],n)),v[m].length>2&&h[m].push(v[m][2]),v[m].length>3&&h[m].push(v[m][3])}"paths"in c?c.paths=d:c.rings=d}else if("points"in l&&"points"in c){var y=l.points,g=[];for(f=0;f<y.length;f++)g[f]=t(y[f][0],y[f][1],[0,0],n),y[f].length>2&&g[f].push(y[f][2]),y[f].length>3&&g[f].push(y[f][3]);c.points=g}else if("type"in l&&"mesh"===l.type&&"type"in c&&"mesh"===c.type){var _=l.vertexAttributes&&l.vertexAttributes.position,b=c.vertexAttributes&&c.vertexAttributes.position;if(_){var x=[0,0];for(f=0;f<_.length;f+=3)t(_[f],_[f+1],x,n),b[f]=x[0],b[f+1]=x[1]}}return c.spatialReference=r,i}function h(e,t){var r=e&&(u(e)?e:e.spatialReference),n=t&&(u(t)?t:t.spatialReference);return!(!r||!n)&&(!!o.equals(n,r)||o.isWebMercator(n)&&o.isWGS84(r)||o.isWebMercator(r)&&o.isWGS84(n))}function f(e,t,r){void 0===r&&(r=[0,0]),t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);var n=c(t);return r[0]=c(e)*a,r[1]=s*Math.log((1+Math.sin(n))/(1-Math.sin(n))),r}function v(e,t,r,n){void 0===r&&(r=[0,0]),void 0===n&&(n=!1);var i=l(e/a);return r[0]=n?i:i-360*Math.floor((i+180)/360),r[1]=l(Math.PI/2-2*Math.atan(Math.exp(-1*t/a))),r}t.canProject=h,t.project=function(e,t){var n=e&&e.spatialReference,a=t&&(u(t)?t:t.spatialReference);return h(n,a)?o.equals(n,a)?r.clone(e):o.isWebMercator(a)?d(e,f,i.WebMercator,!1,r.clone(e)):o.isWGS84(a)?d(e,v,i.WGS84,!1,r.clone(e)):null:null},t.lngLatToXY=f,t.xyToLngLat=v,t.geographicToWebMercator=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=r.clone(e)),d(e,f,i.WebMercator,t,n)},t.webMercatorToGeographic=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=r.clone(e)),d(e,v,i.WGS84,t,n)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!!Set.prototype.entries;t.someSet=r?function(e,t){for(var r=e.entries(),n=r.next();!n.done;n=r.next())if(t(n.value[0]))return!0;return!1}:function(e,t){var r=!0;return e.forEach((function(e){r&&(r=!t(e))})),!r};var n=!!Set.prototype.values,i=!!Array.from;t.valuesOfSet=n&&i?function(e){return Array.from(e.values())}:function(e){var t=new Array(e.size),r=0;return e.forEach((function(e){return t[r++]=e})),t},t.SetFromValues=n?function(e){return new Set(e)}:function(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];t.add(i)}return t},t.firstOfSet=n?function(e){if(0===e.size)throw new Error("Set is empty");return e.values().next().value}:function(e){if(0===e.size)throw new Error("Set is empty");var t,r=!1;return e.forEach((function(e){r||(t=e,r=!0)})),t},t.reduceSet=function(e,t,r){var n=r;return e.forEach((function(e){return n=t(e,n)})),n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(159),r(239),r(282),r(166),r(155),r(118),r(151),r(179),r(163),r(354),r(528),r(485)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){var m=new s.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new s.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cacheHint=void 0,r.datumTransformation=null,r.distance=void 0,r.gdbVersion=null,r.geometry=null,r.geometryPrecision=void 0,r.groupByFieldsForStatistics=null,r.having=null,r.historicMoment=null,r.maxAllowableOffset=void 0,r.maxRecordCountFactor=1,r.multipatchOption=null,r.num=void 0,r.objectIds=null,r.orderByFields=null,r.outFields=null,r.outSpatialReference=null,r.outStatistics=null,r.parameterValues=null,r.pixelSize=null,r.quantizationParameters=null,r.rangeValues=null,r.relationParameter=null,r.resultType=null,r.returnCentroid=!1,r.returnDistinctValues=!1,r.returnExceededLimitFeatures=!0,r.returnGeometry=!1,r.returnQueryGeometry=!1,r.returnM=void 0,r.returnZ=void 0,r.source=null,r.spatialRelationship="intersects",r.start=void 0,r.sqlFormat=null,r.text=null,r.timeExtent=null,r.units=null,r.where=null,r}var s;return r.__extends(t,e),s=t,t.from=function(e){return p.ensureClass(s,e)},t.prototype.castDatumTransformation=function(e){return"number"==typeof e||"object"==typeof e?e:null},t.prototype.writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.writeParameterValues=function(e,t){if(e){var r={};for(var n in e){var i=e[n];Array.isArray(i)?r[n]=i.map((function(e){return e instanceof Date?e.getTime():e})):i instanceof Date?r[n]=i.getTime():r[n]=i}t.parameterValues=r}},t.prototype.writeStart=function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"},t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.clone=function(){return new s(c.clone({cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},t.MAX_MAX_RECORD_COUNT_FACTOR=5,r.__decorate([u.property({type:Boolean,json:{write:{writer:function(e,t){null!=e&&(t.cacheHint=e)}}}})],t.prototype,"cacheHint",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"datumTransformation",void 0),r.__decorate([u.cast("datumTransformation")],t.prototype,"castDatumTransformation",null),r.__decorate([u.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),r.__decorate([u.property({types:i.geometryTypes,json:{read:d.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r.__decorate([u.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),r.__decorate([u.property({type:[String],json:{write:!0}})],t.prototype,"groupByFieldsForStatistics",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"having",void 0),r.__decorate([u.property({type:Date})],t.prototype,"historicMoment",void 0),r.__decorate([u.writer("historicMoment")],t.prototype,"writeHistoricMoment",null),r.__decorate([u.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),r.__decorate([u.property({type:Number,cast:function(e){return e<1?1:e>s.MAX_MAX_RECORD_COUNT_FACTOR?s.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],t.prototype,"maxRecordCountFactor",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"multipatchOption",void 0),r.__decorate([u.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),r.__decorate([u.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),r.__decorate([u.property({type:[String],json:{write:!0}})],t.prototype,"orderByFields",void 0),r.__decorate([u.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),r.__decorate([u.property({type:n.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),r.__decorate([u.property({type:[v],json:{write:!0}})],t.prototype,"outStatistics",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"parameterValues",void 0),r.__decorate([u.writer("parameterValues")],t.prototype,"writeParameterValues",null),r.__decorate([u.property({types:o.symbolTypes,json:{read:h.read,write:!0}})],t.prototype,"pixelSize",void 0),r.__decorate([u.property({type:f.default,json:{write:!0}})],t.prototype,"quantizationParameters",void 0),r.__decorate([u.property({type:[Object],json:{write:!0}})],t.prototype,"rangeValues",void 0),r.__decorate([u.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],t.prototype,"relationParameter",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"resultType",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnCentroid",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnDistinctValues",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:!e}}}}})],t.prototype,"returnExceededLimitFeatures",void 0),r.__decorate([u.property({type:Boolean,json:{write:!0}})],t.prototype,"returnGeometry",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnQueryGeometry",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnM",void 0),r.__decorate([u.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnZ",void 0),r.__decorate([u.property({json:{write:!0}})],t.prototype,"source",void 0),r.__decorate([u.property({type:String,json:{read:{source:"spatialRel",reader:m.read},write:{target:"spatialRel",writer:m.write}}})],t.prototype,"spatialRelationship",void 0),r.__decorate([u.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),r.__decorate([u.writer("start"),u.writer("num")],t.prototype,"writeStart",null),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"sqlFormat",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),r.__decorate([u.property({type:a,json:{write:!0}})],t.prototype,"timeExtent",void 0),r.__decorate([u.property({type:String,json:{read:y.read,write:{writer:y.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),r.__decorate([u.property({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],t.prototype,"where",void 0),r.__decorate([u.writer("where")],t.prototype,"writeWhere",null),s=r.__decorate([u.subclass("esri.tasks.support.Query")],t)}(l.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(166),r(198),r(478),r(860)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.inchesPerMeter=39.37;var s=o.wgs84Radius*Math.PI/180,l=o.wgs84Radius*Math.PI/200,c=/UNIT\[([^\]]+)\]\]$/i,u=a,p=i.SetFromValues([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),d=n.strict()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),h=function(e){return e*e},f=function(e){return e*e*e},v={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:h(.001)},"square-centimeters":{inBaseUnits:h(.01)},"square-decimeters":{inBaseUnits:h(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:h(1e3)},"square-inches":{inBaseUnits:h(.0254)},"square-feet":{inBaseUnits:h(.3048)},"square-yards":{inBaseUnits:h(.9144)},"square-miles":{inBaseUnits:h(1609.344)},"square-us-feet":{inBaseUnits:h(1200/3937)},acres:{inBaseUnits:.0015625*h(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*f(.001)},"cubic-centimeters":{inBaseUnits:1e3*f(.01)},"cubic-decimeters":{inBaseUnits:1e3*f(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*f(1e3)},"cubic-inches":{inBaseUnits:1e3*f(.0254)},"cubic-feet":{inBaseUnits:1e3*f(.3048)},"cubic-yards":{inBaseUnits:1e3*f(.9144)},"cubic-miles":{inBaseUnits:1e3*f(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},m=function(){var e={};for(var t in v)for(var r in v[t].units)e[r]=t;return e}();function y(e){var t=m[e];if(t)return t;throw new Error("unknown measure")}function g(e){return v[e].baseUnit}function _(e,t){return void 0===t&&(t=null),t=t||y(e),v[t].baseUnit===e}function b(e,t,r){if(t===r)return e;var n=y(t);if(n!==y(r))throw new Error("incompatible units");var i=_(t,n)?e:function(e,t,r){return e*v[r].units[t].inBaseUnits}(e,t,n);return _(r,n)?i:function(e,t,r){return e/v[r].units[t].inBaseUnits}(i,r,n)}function x(e){return d.fromJSON(e.toLowerCase())||null}function w(e,t){return void 0===t&&(t=s),S(e,!0)||t}function S(e,t){var r,n,i;if(void 0===t&&(t=!1),null!=e&&("object"==typeof e?(r=e.wkid,n=e.wkt):"number"==typeof e?r=e:"string"==typeof e&&(n=e)),r)!(i=u.values[u[r]])&&t&&p.has(r)&&(i=l);else if(n&&-1!==n.search(/^PROJCS/i)){var o=c.exec(n);o&&o[1]&&(i=parseFloat(o[1].split(",")[1]))}return i}function P(e){var t,r,n;if(null!=e&&("object"==typeof e?(t=e.wkid,r=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(r=e)),t)n=u.units[u[t]];else if(r&&-1!==r.search(/^PROJCS/i)){var i=c.exec(r);i&&i[1]&&(n=(i=/[\\"\\']{1}([^\\"\\']+)/.exec(i[1]))&&i[1])}return n?x(n):null}t.measurementAreaUnits=["metric","imperial","square-inches","square-feet","square-yards","square-miles","square-us-feet","square-meters","square-kilometers","acres","ares","hectares"],t.measurementLengthUnits=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],t.measureForUnit=y,t.baseUnitForMeasure=g,t.baseUnitForUnit=function(e){return g(y(e))},t.isBaseUnit=_,t.convertUnit=b,t.preferredMetricLengthUnit=function(e,t){return b(e,t,"meters")<3e3?"meters":"kilometers"},t.preferredMetricVerticalLengthUnit=function(e,t){return b(e,t,"meters")<1e5?"meters":"kilometers"},t.preferredImperialLengthUnit=function(e,t){return b(e,t,"feet")<1e3?"feet":"miles"},t.preferredImperialVerticalLengthUnit=function(e,t){return b(e,t,"feet")<1e5?"feet":"miles"},t.preferredMetricAreaUnit=function(e,t){return b(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"},t.preferredImperialAreaUnit=function(e,t){return b(e,t,"square-feet")<1e6?"square-feet":"square-miles"},t.lengthToDegrees=function(e,t,r){return void 0===r&&(r=o.wgs84Radius),b(e,t,"meters")/(r*Math.PI/180)},t.unitFromRESTJSON=x,t.unitToRESTJSON=function(e){return d.toJSON(e)||null},t.getMetersPerVerticalUnitForSR=function(e){var t=w(e);return t>1e5?1:t},t.getVerticalUnitStringForSR=function(e){return w(e)>1e5?"meters":P(e)},t.getMetersPerUnitForSR=w,t.getMetersPerUnit=S,t.getUnitString=P,t.getDefaultUnitSystem=function(e){if(!e)return null;var t=P(e);switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null;default:r.neverReached(t)}return null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1167)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(151),r(179),r(215),r(170),r(1445),r(178),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=[0,0];function d(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}var h=n.getLogger("esri.geometry.Point"),f=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.x=0,n.y=0,n.z=void 0,n.m=void 0,n.type="point",n}var n;return r.__extends(t,e),n=t,t.copy=function(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));var r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())},t.distance=function(e,t){var r=e.x-t.x,n=e.y-t.y,i=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+n*n+i*i)},t.prototype.normalizeCtorArgs=function(e,t,r,n,i){var o;if(Array.isArray(e))i=t,e=(o=e)[0],t=o[1],r=o[2],n=o[3];else if(e&&"object"==typeof e){if(e=null!=(o=e).x?o.x:o.longitude,t=null!=o.y?o.y:o.latitude,r=null!=o.z?o.z:o.altitude,n=o.m,(i=o.spatialReference)&&"esri.geometry.SpatialReference"!==i.declaredClass&&(i=new s(i)),null!=o.longitude||null!=o.latitude)if(null==o.longitude)h.warn(".longitude=","Latitude was defined without longitude");else if(null==o.latitude)h.warn(".latitude=","Longitude was defined without latitude");else if(!o.declaredClass&&i&&i.isWebMercator){var a=u.lngLatToXY(o.longitude,o.latitude,p);e=a[0],t=a[1]}}else d(r)?(i=r,r=null):d(n)&&(i=n,n=null);var l={x:e,y:t};return null==l.x&&null!=l.y?h.warn(".y=","Y coordinate was defined without an X coordinate"):null==l.y&&null!=l.x&&h.warn(".x=","X coordinate was defined without a Y coordinate"),null!=i&&(l.spatialReference=i),null!=r&&(l.z=r),null!=n&&(l.m=n),l},Object.defineProperty(t.prototype,"hasM",{get:function(){return void 0!==this.m},set:function(e){e!==this.hasM&&(this._set("m",e?0:void 0),this._set("hasM",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){return void 0!==this.z},set:function(e){e!==this.hasZ&&(this._set("z",e?0:void 0),this._set("hasZ",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latitude",{get:function(){var e=this._get("spatialReference");if(e){if(e.isWebMercator)return u.xyToLngLat(this.x,this.y,p)[1];if(e.isGeographic)return this._get("y")}return null},set:function(e){var t=this._get("spatialReference");t&&(t.isWebMercator?this._set("y",u.lngLatToXY(this.x,e,p)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){var e=this._get("spatialReference");if(e){if(e.isWebMercator)return u.xyToLngLat(this._get("x"),this._get("y"),p)[0];if(e.isGeographic)return this._get("x")}return null},set:function(e){var t=this._get("spatialReference");t&&(t.isWebMercator?this._set("x",u.lngLatToXY(e,this._get("y"),p)[0]):t.isGeographic&&this._set("x",e),this._set("longitude",e))},enumerable:!0,configurable:!0}),t.prototype.writeX=function(e,t,r){t[r]=isNaN(e)?"NaN":e},t.prototype.readX=function(e){return"string"==typeof e?NaN:e},t.prototype.clone=function(){var e=new n;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e},t.prototype.copy=function(e){return n.copy(e,this),this},t.prototype.equals=function(e){var t,r;if(!e)return!1;var n=this,i=n.x,o=n.y,a=n.z,s=n.m,l=n.spatialReference,c=e.z,p=e.m,d=e.x,h=e.y,f=e.spatialReference;if(!l.equals(f))if(l.isWebMercator&&f.isWGS84)d=(t=u.lngLatToXY(d,h))[0],h=t[1],f=l;else{if(!l.isWGS84||!f.isWebMercator)return!1;d=(r=u.xyToLngLat(d,h))[0],h=r[1],f=l}return i===d&&o===h&&a===c&&s===p&&l.wkid===f.wkid},t.prototype.offset=function(e,t,r){return l.offsetPoint(this,e,t,r)},t.prototype.normalize=function(){if(!this.spatialReference)return this;var e=c.getInfo(this.spatialReference);if(!e)return this;var t=this.x,r=e.valid,n=r[0],i=r[1],o=2*i;return t>i?t-=Math.ceil(Math.abs(t-i)/o)*o:t<n&&(t+=Math.ceil(Math.abs(t-n)/o)*o),this._set("x",t),this},t.prototype.distance=function(e){return n.distance(this,e)},t.prototype.toArray=function(){var e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]},t.prototype.toJSON=function(e){return this.write(null,e)},r.__decorate([i.property({dependsOn:["x","y","z","m","spatialReference"]})],t.prototype,"cache",void 0),r.__decorate([i.property({type:Boolean,dependsOn:["m"],json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],t.prototype,"hasM",null),r.__decorate([i.property({type:Boolean,dependsOn:["z"],json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],t.prototype,"hasZ",null),r.__decorate([i.property({type:Number,dependsOn:["y"]})],t.prototype,"latitude",null),r.__decorate([i.property({type:Number,dependsOn:["x"]})],t.prototype,"longitude",null),r.__decorate([i.property({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),i.cast((function(e){return isNaN(e)?e:o.ensureNumber(e)}))],t.prototype,"x",void 0),r.__decorate([i.writer("x")],t.prototype,"writeX",null),r.__decorate([i.reader("x")],t.prototype,"readX",null),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"y",void 0),r.__decorate([i.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],t.prototype,"z",void 0),r.__decorate([i.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],t.prototype,"m",void 0),n=r.__decorate([i.subclass("esri.geometry.Point")],t)}(a);return f.prototype.toJSON.isDefaultToJSON=!0,f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1622),r(917),r(1175),r(1176),r(918),r(648),r(649),r(919),r(1177),r(794)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0}),t.plane=s,t.boundedPlane=n,t.triangle=u,t.lineSegment=a,t.ray=l,t.clipRay=i,t.sphere=c,t.frustum=o,t.vector=p,t.axisAngle=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(307),r(392),r(242),r(947),r(1227),r(1691),r(299),r(318),r(1692),r(948),r(849)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferObject=r,t.FramebufferObject=n,t.Program=i,t.Renderbuffer=o,t.RenderingContext=a,t.ShaderCompiler=s,t.Texture=l,t.VertexArrayObject=c,t.ProgramCache=u.ProgramCache,t.createProgram=p.createProgram,t.glslifyDefineMap=p.glslifyDefineMap,t.createContextOrErrorHTML=d.createContextOrErrorHTML}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1543)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WEBGL_MAX_STOPS=8,t.WEBGL_MAX_INNER_STOPS=t.WEBGL_MAX_STOPS-2,t.NAN_MAGIC_NUMBER=1e-30,t.EXTRUDE_SCALE=64,t.PICTURE_FILL_COLOR=4294967295,t.TILE_SIZE=512,t.RASTER_TILE_SIZE=256,t.ANGLE_FACTOR_256=256/360,t.DEBUG_LABELS=!1,t.COLLISION_BUCKET_SIZE=128,t.DOT_DENSITY_MAX_FIELDS=8,t.MAGIC_LABEL_LINE_HEIGHT=29,t.COLLISION_MAX_ZOOM_DELTA=1,t.COLLISION_EARLY_REJECT_BUCKET_SIZE=16,t.COLLISION_BOX_PADDING=16,t.COLLISION_TILE_BOX_SIZE=t.TILE_SIZE/t.COLLISION_BUCKET_SIZE,t.COLLISION_PLACEMENT_PADDING=8,t.HEURISTIC_GLYPHS_PER_LINE=50,t.HEURISTIC_GLYPHS_PER_FEATURE=10,t.GLYPH_SIZE=24,t.TEXT_PLACEMENT_PADDING=8,t.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}},t.ATTRIBUTE_STORE_TEXTURE_SIZE=1024,t.TEXTURE_BINDING_SPRITE_ATLAS=0,t.TEXTURE_BINDING_GLYPH_ATLAS=0,t.TEXTURE_BINDING_BITMAP=0,t.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1,t.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2,t.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3,t.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4,t.TEXTURE_BINDING_HIGHLIGHT_0=5,t.TEXTURE_BINDING_HIGHLIGHT_1=6,t.TEXTURE_BINDING_RENDERER_0=5,t.TEXTURE_BINDING_RENDERER_1=6,t.ATTRIBUTE_DATA_FILTER_FLAGS=0,t.ATTRIBUTE_DATA_ANIMATION=1,t.ATTRIBUTE_DATA_VV=2,t.ATTRIBUTE_DATA_DD0=3,t.ATTRIBUTE_DATA_DD1=3,t.MAX_FILTERS=2,t.HIGHLIGHT_FLAG=1,t.FILTER_FLAG_0=2,t.EFFECT_FLAG_0=4,t.THIN_LINE_THRESHOLD=2.5,t.HITTEST_SEARCH_SIZE=24,t.MAX_ANIMATION_TIME_MS=2e3,t.VTL_TEXTURE_BINDING_UNIT_SPRITES=5,t.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6,t.VTL_HIGH_RES_CUTOFF=1.15,t.MAX_GPU_UPLOADS_PER_FRAME=2}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(159),r(174),r(177),r(164),r(118),r(152),r(120),r(170),r(193),r(173),r(163),r(521),r(194),r(1593)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){Object.defineProperty(t,"__esModule",{value:!0}),t.equals=v.equals;t.DehydratedFeatureClass=function(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null},t.hasGeometry=function(e){return s.isSome(e.geometry)},t.isFeatureGeometry=function(e){return r.isFeatureGeometryType(e.type)};function m(e,t,r){if(!e)return null;switch(t){case"point":var n=e;return{x:n.x,y:n.y,z:n.z,m:n.m,hasZ:null!=n.z,hasM:null!=n.m,type:"point",spatialReference:r};case"polyline":var i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r};case"polygon":var o=e;return{rings:o.rings,hasZ:!!o.hasZ,hasM:!!o.hasM,type:"polygon",spatialReference:r};case"multipoint":var a=e;return{points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"multipoint",spatialReference:r}}}function y(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}}function g(e){return"declaredClass"in e}function _(e){return"declaredClass"in e}function b(e){return"declaredClass"in e}function x(e){return s.isNone(e)?null:g(e)?e:d.fromJSON(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,n=e.hasZ,o=e.hasM;return{rings:T(r),hasZ:n,hasM:o,spatialReference:t};case"polyline":var a=e.paths;return n=e.hasZ,o=e.hasM,{paths:T(a),hasZ:n,hasM:o,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:n=e.hasZ,hasM:o=e.hasM,spatialReference:t};case"multipoint":var s=e.points;return n=e.hasZ,o=e.hasM,{points:C(s)?O(s):s,hasZ:n,hasM:o,spatialReference:t};default:return void i.neverReached(e)}}(e))}t.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null},t.isPoint=function(e){return"point"===e.type},t.fromFeatureSetJSON=function(e){var t=r.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),o=c.fromJSON(e.spatialReference),a=e.transform,s=e.features.map((function(r){var s=function(e,t,r,i){return{uid:n.generateUID(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:m(e.geometry,t,r),visible:!0}}(r,t,o,e.objectIdFieldName),l=s.geometry;if(l&&a)switch(l.type){case"point":s.geometry=h.hydratePoint(a,l,l,l.hasZ,l.hasM);break;case"multipoint":s.geometry=h.hydrateMultipoint(a,l,l,l.hasZ,l.hasM);break;case"polygon":s.geometry=h.hydratePolygon(a,l,l,l.hasZ,l.hasM);break;case"polyline":s.geometry=h.hydratePolyline(a,l,l,l.hasZ,l.hasM);break;default:i.neverReached(l)}return s}));return{geometryType:t,features:s,spatialReference:o,fields:e.fields?e.fields.map((function(e){return f.fromJSON(e)})):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}},t.fromJSONGeometry=m,t.makeDehydratedPoint=y,t.isHydratedGeometry=g,t.isHydratedPoint=_,t.isHydratedGraphic=b,t.hydrateGraphic=function(e,t){if(!e)return null;if(b(e))return e;var r=new n({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=a.clone(e.symbol),r.attributes=a.clone(e.attributes),r.geometry=x(e.geometry),r},t.hydrateGeometry=x,t.clonePoint=function(e,t){if(!e)return null;var r;if(_(e)){if(null==t)return e.clone();if(_(t))return t.copy(e)}return null!=t?((r=t).x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=y(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r};var w=o("esri-text-decoder")?function(e){return 32+e.length}:function(e){return 32*e.length};function S(e){if(!e)return 0;var t=32;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(typeof n){case"string":t+=w(n);break;default:case"number":t+=16}}return t}function P(e){if(s.isNone(e))return 0;var t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":for(var r=0,n=2+(e.hasZ?1:0)+(e.hasM?1:0),o="polyline"===e.type?e.paths:e.rings,a=0,c=o;a<c.length;a++)r+=c[a].length;t+=8*r*n+64,t+=128*r,t+=34,t+=32*(o.length+1);break;case"multipoint":var u=2+(e.hasZ?1:0)+(e.hasM?1:0),p=e.points.length;t+=8*p*u+64,t+=128*p,t+=34,t+=32;break;case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=l.estimateSize(e.vertexAttributes.position),t+=l.estimateSize(e.vertexAttributes.normal),t+=l.estimateSize(e.vertexAttributes.uv),t+=l.estimateSize(e.vertexAttributes.tangent);break;default:i.neverReached(e)}return t}function T(e){return function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(0!==n.length)return C(n)}return!1}(e)?e.map((function(e){return O(e)})):e}function O(e){return e.map((function(e){return l.toArray(e)}))}function C(e){return e.length&&(l.isFloat32Array(e[0])||l.isFloat64Array(e[0]))}function M(e,t){switch(u.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)u.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(r=0;r<e.rings.length;r++)u.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":u.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:i.neverReached(e)}}function A(e,t){switch(p.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)p.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(r=0;r<e.rings.length;r++)p.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":p.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:i.neverReached(e)}}t.estimateAttributesObjectSize=S,t.estimateGeometryObjectSize=P,t.estimateSize=function(e){var t=32;return t+=S(e.attributes),(t+=3)+(8+P(e.geometry))},t.numVertices=function(e){if(s.isNone(e))return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,r=0,n=e.paths;r<n.length;r++)t+=n[r].length;return t;case"polygon":t=0;for(var o=0,a=e.rings;o<a.length;o++)t+=a[o].length;return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var l=e.vertexAttributes&&e.vertexAttributes.position;return l?l.length/3:0;default:return void i.neverReached(e)}},t.hasVertices=function(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,r=e.paths;t<r.length;t++)if(r[t].length>0)return!0;return!1;case"polygon":for(var n=0,o=e.rings;n<o.length;n++)if(o[n].length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:return void i.neverReached(e)}},t.computeAABB=M,t.expandAABB=function(e,t){M(e,E),u.expand(t,E)},t.computeAABR=A,t.expandAABR=function(e,t){A(e,I),p.expand(t,I)},t.getObjectId=function(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null};var E=u.create(),I=p.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(159),r(165),r(154),r(190),r(292),r(323),r(156),r(172),r(151),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h){var f=0,v=p.getLogger("esri.layers.Layer");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attributionDataUrl=null,t.fullExtent=new o.Extent(-180,-90,180,90,o.SpatialReference.WGS84),t.legendEnabled=!0,t.listMode="show",t.blendMode="normal",t.opacity=1,t.parent=null,t.popupEnabled=!0,t.attributionVisible=!0,t.spatialReference=o.SpatialReference.WGS84,t.title=null,t.type=null,t.url=null,t.visible=!0,t}return n.__extends(t,e),t.fromArcGISServerUrl=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return t="string"==typeof e?{url:e}:e,[4,new Promise((function(e,t){r.e(136).then(function(){var t=[r(2056)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:i=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,i.fromUrl(t)];case 3:return[2,n.sent()];case 4:throw o=n.sent(),v.error("#fromArcGISServerUrl({ url: '"+t.url+"'})","Failed to create layer from arcgis server url",o),o;case 5:return[2]}}))}))},t.fromPortalItem=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,o,a,s,l,c;return n.__generator(this,(function(n){switch(n.label){case 0:return t="portalItem"in e?e:{portalItem:e},[4,new Promise((function(e,t){r.e(126).then(function(){var t=[r(557)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:o=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,o.fromItem(t)];case 3:return[2,n.sent()];case 4:throw a=n.sent(),s=t&&t.portalItem,l=s&&s.id||"unset",c=s&&s.portal&&s.portal.url||i.portalUrl,v.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+c+"', id: '"+l+"')",a),a;case 5:return[2]}}))}))},t.prototype.initialize=function(){var e=this;this.when().catch((function(t){p.getLogger(e.declaredClass).error("#load()","Failed to load layer (title: '"+e.title+"', id: '"+e.id+"')",t)}))},Object.defineProperty(t.prototype,"hasAttributionData",{get:function(){return null!=this.attributionDataUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return Date.now().toString(16)+"-layer-"+f++},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedUrl",{get:function(){var e=this._get("url");return e?d.urlToObject(e):null},enumerable:!0,configurable:!0}),t.prototype.fetchAttributionData=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return e=this.attributionDataUrl,this.hasAttributionData&&e?[4,a(e,{query:{f:"json"},responseType:"json"})]:[3,2];case 1:return[2,t.sent().data];case 2:throw new s("layer:no-attribution-data","Layer does not have attribution data")}}))}))},n.__decorate([h.property({type:String})],t.prototype,"attributionDataUrl",void 0),n.__decorate([h.property({type:o.Extent})],t.prototype,"fullExtent",void 0),n.__decorate([h.property({readOnly:!0,dependsOn:["attributionDataUrl"]})],t.prototype,"hasAttributionData",null),n.__decorate([h.property({type:String})],t.prototype,"id",null),n.__decorate([h.property({type:Boolean,nonNullable:!0})],t.prototype,"legendEnabled",void 0),n.__decorate([h.property({type:["show","hide","hide-children"]})],t.prototype,"listMode",void 0),n.__decorate([h.property({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0})],t.prototype,"blendMode",void 0),n.__decorate([h.property({type:Number,range:{min:0,max:1},nonNullable:!0})],t.prototype,"opacity",void 0),n.__decorate([h.property()],t.prototype,"parent",void 0),n.__decorate([h.property({readOnly:!0,dependsOn:["url"]})],t.prototype,"parsedUrl",null),n.__decorate([h.property({type:Boolean})],t.prototype,"popupEnabled",void 0),n.__decorate([h.property({type:Boolean})],t.prototype,"attributionVisible",void 0),n.__decorate([h.property({type:o.SpatialReference})],t.prototype,"spatialReference",void 0),n.__decorate([h.property({type:String})],t.prototype,"title",void 0),n.__decorate([h.property({type:String,readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),n.__decorate([h.property()],t.prototype,"url",void 0),n.__decorate([h.property({type:Boolean,nonNullable:!0})],t.prototype,"visible",void 0),n.__decorate([h.subclass("esri.layers.Layer")],t)}(l.EventedMixin(c.IdentifiableMixin(u)))}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!!Map.prototype.entries;t.someMap=r?function(e,t){for(var r=e.entries(),n=r.next();!n.done;n=r.next())if(t(n.value[1],n.value[0]))return!0;return!1}:function(e,t){var r=!0;return e.forEach((function(e,n){r&&(r=!t(e,n))})),!r};var n=!!Map.prototype.values,i=!!Map.prototype.keys,o=!!Array.from;function a(e){if(0===e.size)throw new Error("Map is empty");var t,r=!1;return e.forEach((function(e,n){r||(t=n,r=!0)})),t}function s(e){if(0===e.size)throw new Error("Map is empty");var t,r=!1;return e.forEach((function(e){r||(t=e,r=!0)})),t}t.pairsOfMap=function(e){var t=[];return e.forEach((function(e,r){return t.push([r,e])})),t},t.valuesOfMap=n&&o?function(e){return Array.from(e.values())}:function(e){var t=new Array(e.size),r=0;return e.forEach((function(e){return t[r++]=e})),t},t.keysOfMap=i&&o?function(e){return Array.from(e.keys())}:function(e){var t=new Array(e.size),r=0;return e.forEach((function(e,n){return t[r++]=n})),t},t.MapFromValues=n?function(e){return new Map(e)}:function(e){for(var t=new Map,r=0,n=e;r<n.length;r++){var i=n[r];t.set(i[0],i[1])}return t},t.firstKeyOfMap=i?function(e){if(0===e.size)throw new Error("Map is empty");return e.keys().next().value}:a,t.firstValueOfMap=n?function(e){if(0===e.size)throw new Error("Map is empty");return e.values().next().value}:s,t.test={firstKeyOfMapFallback:a,firstValueOfMapFallback:s}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1098),r(156),r(152),r(214),r(157),r(1506)],void 0===(i=function(e,t,r,n,i,o,a,s){var l;Object.defineProperty(t,"__esModule",{value:!0});var c,u,p,d,h=n.getLogger("esri.views.support.Scheduler");function f(e){return e in t.taskPriorities?t.taskPriorities[e]:"number"==typeof e?e:1}t.newScheduler=function(e){return new u.Scheduler(e)},function(e){e.REMOTE_CLIENT="remote client",e.STREAM_DATA_LOADER="stream data loader",e.TERRAIN_SURFACE="terrain surface",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.I3S_CONTROLLER="I3S controller",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.FEATURE_FETCH_QUEUE="feature fetch queue",e.GRAPHICS_CORE="Graphics3D",e.LABELER="labeler",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.FEATURE_QUERY_ENGINE="feature query",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.OVERLAY_MANAGER="overlay manager",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e[e.TEST_PRIO=1]="TEST_PRIO"}(c=t.Task||(t.Task={})),t.taskPriorities=((l={})[c.REMOTE_CLIENT]=1,l[c.STREAM_DATA_LOADER]=1,l[c.FEATURE_FETCH_QUEUE]=1,l[c.TERRAIN_SURFACE]=2,l[c.SURFACE_GEOMETRY_UPDATES]=2,l[c.I3S_CONTROLLER]=4,l[c.POINT_CLOUD_LAYER]=4,l[c.FEATURE_TILE_FETCHER]=4,l[c.GRAPHICS_CORE]=6,l[c.LABELER]=6,l[c.GRAPHICS_DECONFLICTOR]=6,l[c.FILTER_VISIBILITY]=8,l[c.FEATURE_QUERY_ENGINE]=8,l[c.SCALE_VISIBILITY]=8,l[c.FRUSTUM_VISIBILITY]=8,l[c.POINT_OF_INTEREST_FREQUENT]=6,l[c.POINT_OF_INTEREST_INFREQUENT]=30,l[c.FEATURE_TILE_TREE]=16,l[c.FEATURE_TILE_TREE_ACTIVE]=1,l[c.ELEVATION_ALIGNMENT]=12,l[c.TEXT_TEXTURE_ATLAS]=12,l[c.OVERLAY_MANAGER]=12,l[c.LINE_OF_SIGHT_TOOL]=16,l[c.LINE_OF_SIGHT_TOOL_INTERACTIVE]=1,l),t.getTaskPriority=f,function(e){var t=function(){function t(t){var r=this;this._now=t,this._budget=null,this._state=1,this._tasks=new o,this._runQueue=new o,this._load=0,this._idleStateCallbacks=new o,this._idleUpdatesStartFired=!1,this._maxReschedule=v,this._forceTask=!1,this._safetyBudget=0,this._debug=!1,this._debugHandle=a.init(s,"SCHEDULER_LOG_SLOW_TASKS",(function(e){return r._debug=e})),this._budget=new e.Budget(t);var n,l=this;this._test={get state(){return i.isNone(n)?l._state:n},set state(e){n=e},FRAME_SAFETY_BUDGET:5,idleBudget:100,get budget(){return l._budget.budget},usedBudget:0,startTime:0,updateTask:function(e){return r._updateTask(e)},getState:function(e){return r._getState(e)},getRuntime:function(e){return r._getRuntime(e)}}}return t.prototype.destroy=function(){this._debugHandle&&this._debugHandle.remove()},t.prototype.registerTask=function(e,t,n){var i=this,o=f(e),a=new r(e,t,n,o);return this._tasks.push(a),{remove:function(){return i._removeTask(a)},set task(e){a.setPriority(e)}}},t.prototype.registerIdleStateCallbacks=function(e,t){var r=this,n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),2===this.state&&this._idleUpdatesStartFired&&n.idleBegin();var i=this;return{remove:function(){return r._removeIdleStateCallbacks(n)},set idleBegin(e){i._idleUpdatesStartFired&&(n.idleEnd(),2===i._state&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}},Object.defineProperty(t.prototype,"now",{get:function(){return this._now()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"load",{get:function(){return this._load},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return i.isNone(this._test.state)?this._state:this._test.state},set:function(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach((function(e){return e.idleEnd()}))))},enumerable:!0,configurable:!0}),t.prototype.updateBudget=function(e){this._test.usedBudget=0,this._test.startTime=e.elapsedFrameTime,this._safetyBudget=5;var t=e.frameDuration,r=1;switch(this.state){case 2:this._safetyBudget=0,t=Math.max(100,e.frameDuration),r=30;break;case 1:t=Math.max(1e3/30,e.frameDuration)}return t-=e.elapsedFrameTime+this._safetyBudget,2!==this.state&&t<0&&!this._forceTask?(this._forceTask=!0,!1):(t=Math.max(t,r),this._budget.reset(t,this.state),this._maxReschedule=v,this._updateLoad(),this._schedule())},t.prototype.frame=function(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach((function(e){return e.idleBegin()}))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed},t.prototype._removeIdleStateCallbacks=function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)},t.prototype._removeTask=function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)},t.prototype._updateTask=function(e){this._tasks.forEach((function(t){t.name===e&&t.setPriority(e)}))},t.prototype._getState=function(e){if(this._runQueue.some((function(t){return t.name===e})))return p.SCHEDULED;var t=p.IDLE;return this._tasks.forEach((function(r){r.name===e&&r.needsUpdate()&&(r.schedule<=1?t=p.READY:t!==p.READY&&(t=p.WAITING))})),t},t.prototype._getRuntime=function(e){var t=0;return this._tasks.forEach((function(r){r.name===e&&(t+=r.runtime)})),t},t.prototype._runIdle=function(){this._run()},t.prototype._runInteracting=function(){this._run()},t.prototype._runAnimating=function(){this._run()},t.prototype._updateLoad=function(){var e=0;this._tasks.forEach((function(t){return t.needsUpdate()?++e:e})),this._load=.9*this._load+e*(1-.9)},t.prototype._schedule=function(){var e=this;if(this._maxReschedule<=0)return!1;this._runQueue.filterInPlace((function(e){return!!e.needsUpdate()||(e.schedule=e.priority,!1)}));for(var t=function(){var t=!1,n=0;if(r._tasks.forEach((function(r){if(0!==r.schedule&&r.needsUpdate())switch(t=!0,n=Math.max(n,r.priority),r.schedule){case 1:r.schedule=0,e._runQueue.push(r);break;default:--r.schedule}})),!t)return{value:!1};r._maxReschedule===v&&(r._maxReschedule=n),--r._maxReschedule},r=this;0===this._runQueue.length;){var n=t();if("object"==typeof n)return n.value}return!0},t.prototype._run=function(){do{for(;this._runQueue.length>0;){var e=this._runQueue.pop();this._budget.resetProgress();var t=this._budget.now();try{e.update(this._budget)}catch(t){h.error('Exception in task "'+e.name+'"',t)}if(e.schedule=e.priority,e.runtime+=this._budget.now()-t,this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",e.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return}}while(this._schedule())},Object.defineProperty(t.prototype,"test",{get:function(){return this._test},enumerable:!0,configurable:!0}),t}();e.Scheduler=t;var r=function(){function e(e,t,r,n){this.name=e,this.update=t,this.needsUpdate=r,this._priority=n,this.runtime=0,this.schedule=this._priority}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),e.prototype.setPriority=function(e){this.name=e,this._priority=f(e),0!==this.schedule&&(this.schedule=this._priority)},e}(),n=function(){function e(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}return e.prototype.run=function(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)},Object.defineProperty(e.prototype,"done",{get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"budget",{get:function(){return this._budget},enumerable:!0,configurable:!0}),e.prototype.madeProgress=function(){this._didWork=!0},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),e.prototype.reset=function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1},Object.defineProperty(e.prototype,"remaining",{get:function(){return Math.max(this._budget-this.elapsed,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elapsed",{get:function(){return this.now()-this._begin},enumerable:!0,configurable:!0}),e.prototype.resetProgress=function(){this._didWork=!1},Object.defineProperty(e.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0}),e}();e.Budget=n}(u||(u={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(p=t.TaskState||(t.TaskState={})),t.noBudget=((d=new u.Budget((function(){return performance.now()}))).enabled=!1,d);var v=r.MAX_SAFE_INTEGER}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(1422)],void 0===(i=function(e,t,r,n,i){return function(){function e(e){var t=this;this.data=[],this._length=0,this._allocator=null,this._deallocator=function(){},this._shrink=function(){},this._hint=new n.PositionHint,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator?(this._allocator=e.allocator,this._deallocator=e.deallocator):"deallocator"in e&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=function(){t.data.length>1.5*t.length&&(t.data.length=Math.floor(1.1*t.length))}))}return e.prototype.toArray=function(){return this.data.slice(0,this.length)},e.prototype.getItemAt=function(e){if(!(e<0||e>=this._length))return this.data[e]},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(var t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.length=0},e.prototype.prune=function(){this.clear(),this.data=[]},e.prototype.push=function(e){this.data[this._length++]=e},e.prototype.pushArray=function(e,t){void 0===t&&(t=e.length);for(var r=0;r<t;r++)this.data[this._length++]=e[r]},e.prototype.fill=function(e,t){for(var r=0;r<t;r++)this.data[this._length++]=e},e.prototype.pushNew=function(){return this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length])),++this._length,this.back()},e.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}},e.prototype.iterableRemoveMany=function(e){var t,i;return r.__generator(this,(function(r){switch(r.label){case 0:t=new Array,i=0,r.label=1;case 1:return i<this.length?i>=this.length?[3,4]:(n.indexOf(e.data,this.data[i],e.length,e._hint)<0&&t.push(this.data[i]),[4]):[3,4];case 2:r.sent(),r.label=3;case 3:return++i,[3,1];case 4:return this.data=t,this._length=this.data.length,[2]}}))},e.prototype.remove=function(e){var t=n.indexOf(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e},e.prototype.removeUnordered=function(e){var t=n.removeUnordered(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),t},e.prototype.removeUnorderedIndex=function(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()},e.prototype.removeUnorderedMany=function(e,t,r){void 0===t&&(t=e.length),this.length=n.removeUnorderedMany(this.data,e,this.length,t,this._hint,r)},e.prototype.front=function(){if(0!==this.length)return this.data[0]},e.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},e.prototype.swapElements=function(e,t){var r;e>=this.length||t>=this.length||e===t||(r=[this.data[t],this.data[e]],this.data[e]=r[0],this.data[t]=r[1])},e.prototype.sort=function(e){i.sort(this.data,0,this.length,e)},e.prototype.iterableSort=function(e){return i.iterableSort(this.data,0,this.length,e)},e.prototype.some=function(e,t){for(var r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1},e.prototype.filterInPlace=function(e,t){for(var r=0,n=0;n<this._length;++n){var i=this.data[n];e.call(t,i,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=i,r++)}if(this._deallocator)for(n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this},e.prototype.forEach=function(e,t){for(var r=this.length,n=0;n<Math.min(this.length,r);++n)e.call(t,this.data[n],n,this.data)},e.prototype.iterableForEach=function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<this.length?[4,this.data[e]]:[3,4];case 2:t.sent(),t.label=3;case 3:return++e,[3,1];case 4:return[2]}}))},e.prototype.map=function(e,t){for(var r=new Array(this.length),n=0;n<this.length;++n)r[n]=e.call(t,this.data[n],n,this.data);return r},e.prototype.reduce=function(e,t){for(var r=t,n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(170)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.type=null,n.extent=null,n.hasM=!1,n.hasZ=!1,n.spatialReference=o.WGS84,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"cache",{get:function(){return{}},enumerable:!0,configurable:!0}),t.prototype.readSpatialReference=function(e,t){if(e instanceof o)return e;if(null!=e){var r=new o;return r.read(e,t),r}return e},t.prototype.clone=function(){return console.warn(".clone() is not implemented for "+this.declaredClass),null},t.prototype.clearCache=function(){this.notifyChange("cache")},t.prototype.getCacheValue=function(e){return this.cache[e]},t.prototype.setCacheValue=function(e,t){this.cache[e]=t},r.__decorate([i.property()],t.prototype,"type",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"cache",null),r.__decorate([i.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"extent",void 0),r.__decorate([i.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasM",void 0),r.__decorate([i.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"hasZ",void 0),r.__decorate([i.property({type:o,json:{write:!0}})],t.prototype,"spatialReference",void 0),r.__decorate([i.reader("spatialReference")],t.prototype,"readSpatialReference",null),r.__decorate([i.subclass("esri.geometry.Geometry")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1544)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec2f64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){function n(e){return h.intern(e)}function i(e){return v.intern(e)}function o(e){return y.intern(e)}function a(e){return _.intern(e)}function s(e){return x.intern(e)}function l(e){return S.intern(e)}function c(e){return T.intern(e)}function u(e){return C.intern(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleBlendingParams=function(e,t,r,n){return void 0===r&&(r=32774),void 0===n&&(n=[0,0,0,0]),{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}},t.separateBlendingParams=function(e,t,r,n,i,o,a){return void 0===i&&(i=32774),void 0===o&&(o=32774),void 0===a&&(a=[0,0,0,0]),{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:n,opRgb:i,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}},t.backFaceCullingParams={face:1029,mode:2305},t.defaultDepthWriteParams={zNear:0,zFar:1},t.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0},t.makeBlending=n,t.makeCulling=i,t.makePolygonOffset=o,t.makeDepthTest=a,t.makeStencilTest=s,t.makeDepthWrite=l,t.makeColorWrite=c,t.makeStencilWrite=u,t.makePipelineState=function(e){return A.intern(e)};var p=function(){function e(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}return e.prototype.intern=function(e){if(!e)return null;var t=this.makeKey(e),r=this.interns;return r.has(t)||r.set(t,this.makeRef(e)),r.get(t)},e}();function d(e){return"["+e.join(",")+"]"}var h=new p(f,(function(e){return r.__assign({__tag:"Blending"},e)}));function f(e){return e?d([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}var v=new p(m,(function(e){return r.__assign({__tag:"Culling"},e)}));function m(e){return e?d([e.face,e.mode]):null}var y=new p(g,(function(e){return r.__assign({__tag:"PolygonOffset"},e)}));function g(e){return e?d([e.factor,e.units]):null}var _=new p(b,(function(e){return r.__assign({__tag:"DepthTest"},e)}));function b(e){return e?d([e.func]):null}var x=new p(w,(function(e){return r.__assign({__tag:"StencilTest"},e)}));function w(e){return e?d([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}var S=new p(P,(function(e){return r.__assign({__tag:"DepthWrite"},e)}));function P(e){return e?d([e.zNear,e.zFar]):null}var T=new p(O,(function(e){return r.__assign({__tag:"ColorWrite"},e)}));function O(e){return e?d([e.r,e.g,e.b,e.a]):null}var C=new p(M,(function(e){return r.__assign({__tag:"StencilWrite"},e)}));function M(e){return e?d([e.mask]):null}var A=new p((function(e){return e?d([f(e.blending),m(e.culling),g(e.polygonOffset),b(e.depthTest),w(e.stencilTest),P(e.depthWrite),O(e.colorWrite),M(e.stencilWrite)]):null}),(function(e){return{blending:n(e.blending),culling:i(e.culling),polygonOffset:o(e.polygonOffset),depthTest:a(e.depthTest),stencilTest:s(e.stencilTest),depthWrite:l(e.depthWrite),colorWrite:c(e.colorWrite),stencilWrite:u(e.stencilWrite)}})),E=function(){function e(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}return e.prototype.setPipeline=function(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1},e.prototype.invalidateBlending=function(){this._blendingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateCulling=function(){this._cullingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidatePolygonOffset=function(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthTest=function(){this._depthTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilTest=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthWrite=function(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateColorWrite=function(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilWrite=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.setBlending=function(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1},e.prototype.setCulling=function(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1},e.prototype.setPolygonOffset=function(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1},e.prototype.setDepthTest=function(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1},e.prototype.setStencilTest=function(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1},e.prototype.setDepthWrite=function(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1},e.prototype.setColorWrite=function(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1},e.prototype.setStencilWrite=function(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1},e.prototype.setSubState=function(e,t,r,n){return(r||e!==t)&&(n(e),this._pipelineInvalid=!0),e},e}();t.StateTracker=E}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(190),r(236),r(292),r(156),r(303),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.layer=null,r.parent=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";throw s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),t}}))},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendInfo",{get:function(){return this.getSuspendInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.getSuspendInfo=function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e},t.prototype.isUpdating=function(){return!1},r.__decorate([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r.__decorate([c.property()],t.prototype,"layer",void 0),r.__decorate([c.property()],t.prototype,"parent",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],t.prototype,"suspended",null),r.__decorate([c.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],t.prototype,"suspendInfo",null),r.__decorate([c.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),r.__decorate([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r.__decorate([c.subclass("esri.views.layers.LayerView")],t)}(o.HandleOwnerMixin(a.IdentifiableMixin(l.EsriPromiseMixin(i.EventedMixin(n)))))}.apply(null,n))||(e.exports=i)},,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(162),r(160),r(175)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");var n=a.glsl(l||(l=r.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel = pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot = dot(slicePlaneBasis1, rel);\n        float basis2Dot = dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front < 0.0\n          && factors.side0 < 0.0\n          && factors.side1 < 0.0\n          && factors.side2 < 0.0\n          && factors.side3 < 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),i=a.glsl(c||(c=r.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors = calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH = 1.0;\n        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor = (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),o=t.sliceHighlightDisabled?a.glsl(u||(u=r.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):a.glsl(p||(p=r.__makeTemplateObject(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),i);t.sliceEnabledForVertexPrograms&&e.vertex.code.add(n),e.fragment.code.add(n),e.fragment.code.add(o)}else{var s=a.glsl(d||(d=r.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "])));t.sliceEnabledForVertexPrograms&&e.vertex.code.add(s),e.fragment.code.add(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Slice=s,function(e){e.bindUniformsWithOrigin=function(t,r,n){e.bindUniforms(t,r,n.slicePlane,n.origin)},e.bindUniforms=function(e,t,r,a){t.slicePlaneEnabled&&(n.isSome(r)?(a?(i.vec3.subtract(h,r.origin,a),e.setUniform3fv("slicePlaneOrigin",h)):e.setUniform3fv("slicePlaneOrigin",r.origin),e.setUniform3fv("slicePlaneBasis1",r.basis1),e.setUniform3fv("slicePlaneBasis2",r.basis2)):(e.setUniform3fv("slicePlaneBasis1",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneBasis2",o.vec3f64.ZEROS),e.setUniform3fv("slicePlaneOrigin",o.vec3f64.ZEROS)))}}(s=t.Slice||(t.Slice={}));var l,c,u,p,d,h=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(1487),r(475),r(857),r(322),r(619)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){function u(e){return l.getProperties(e).store}Object.defineProperty(t,"__esModule",{value:!0}),t.MultiOriginJSONMixin=function(e){var t=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this,i=l.getProperties(n),a=i.metadatas,s=i.store,c=new o.default;return i.store=c,s.keys().forEach((function(e){c.set(e,s.get(e),0)})),Object.keys(a).forEach((function(e){i.internalGet(e)&&c.set(e,i.internalGet(e),0)})),n}return r.__extends(t,e),t.prototype.clear=function(e,t){return void 0===t&&(t="user"),u(this).delete(e,a.nameToId(t))},t.prototype.read=function(e,t){s.default(this,e,t)},t.prototype.write=function(e,t){return e=e||{},c.default(this,e,t),e},t.prototype.getAtOrigin=function(e,t){var r=u(this),n=a.nameToId(t);if("string"==typeof e)return r.get(e,n);var i={};return e.forEach((function(e){i[e]=r.get(e,n)})),i},t.prototype.setAtOrigin=function(e,t,r){l.getProperties(this).setAtOrigin(e,t,a.nameToId(r))},t.prototype.originOf=function(e){return a.idToName(this.originIdOf(e))},t.prototype.originIdOf=function(e){return u(this).originOf(e)},t.prototype.revert=function(e,t){var r=u(this),n=a.nameToId(t),i=l.getProperties(this);("string"==typeof e?"*"===e?r.keys(n):[e]:e).forEach((function(e){i.propertyInvalidated(e),r.revert(e,n),i.propertyCommitted(e)}))},t.prototype.removeOrigin=function(e){for(var t=u(this),r=a.nameToId(e),n=0,i=t.keys(r);n<i.length;n++){var o=i[n];t.originOf(o)===r&&t.set(o,t.get(o,r),6)}},t.prototype.updateOrigin=function(e,t){for(var r=u(this),n=a.nameToId(t),i=this.get(e),o=n+1;o<7;++o)r.delete(e,o);r.set(e,i,n)},t.prototype.toJSON=function(e){return this.write(null,e)},r.__decorate([i.subclass("esri.core.MultiOriginJSONSupport")],t)}(e);return t.prototype.toJSON.isDefaultToJSON=!0,t};var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([i.subclass("esri.core.MultiOriginJSONSupport")],t)}(t.MultiOriginJSONMixin(n));t.MultiOriginJSONSupport=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=function(e,t,n){return r.eachAlways(e.map((function(e,r){return t.apply(n,[e,r])})))},t.map=function(e,t,n){return r.eachAlways(e.map((function(e,r){return t.apply(n,[e,r])}))).then((function(e){return e.map((function(e){return e.value}))}))},t.result=function(e){return e.then((function(e){return{ok:!0,value:e}})).catch((function(e){return{ok:!1,error:e}}))},t.assertResult=function(e){if(!0===e.ok)return e.value;throw e.error}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(119),r(1089)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=/\{([^\}]+)\}/g;function o(e){return null==e?"":e}t.endsWith=n.endsWith,t.startsWith=n.startsWith,t.padEnd=n.padEnd,t.padStart=n.padStart,t.includes=n.includes,t.replace=function(e,t){return e.replace(i,"object"==typeof t?function(e,n){return o(r.getDeepValue(n,t))}:function(e,r){return o(t(r))})},t.escapeRegExpString=function(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,(function(e){return t&&-1!==t.indexOf(e)?e:"\\"+e}))},t.numericHash=function(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){function n(e){return e&&e.acquire&&"function"==typeof e.acquire}return function(){function e(e,t,r,n,i){if(void 0===n&&(n=1),void 0===i&&(i=0),this.ctor=e,this.acquireFunction=t,this.releaseFunction=r,this.allocationSize=n,this._pool=new Array(i),this._initialSize=i,this.ctor)for(var o=0;o<i;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(n,1)}return e.prototype.destroy=function(){this.prune(0)},e.prototype.acquire=function(){for(var t,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=this.ctor;if(e.test.disabled)t=new a;else{if(0===this._pool.length)for(var s=this.allocationSize,l=0;l<s;l++)this._pool[l]=new a;t=this._pool.pop()}return this.acquireFunction?this.acquireFunction.apply(this,r.__spreadArrays([t],i)):n(t)&&t.acquire.apply(t,i),t},e.prototype.release=function(t){t&&!e.test.disabled&&(this.releaseFunction?this.releaseFunction(t):function(e){return e&&e.release&&"function"==typeof e.release}(t)&&t.release(),this._pool.push(t))},e.prototype.prune=function(e){if(void 0===e&&(e=this._initialSize),!(e>=this._pool.length)){for(var t=e;t<this._pool.length;++t){var r=this._pool[t];this._dispose(r)}this._pool.length=e}},e.prototype._dispose=function(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()},e.test={disabled:!1},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(856),r(214),r(153)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1},a=function(){function e(e){this.callback=e,this.isActive=!0}return e.prototype.remove=function(){this.isActive=!1},e}(),s=-1,l=0,c={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},u=["prepare","preRender","render","postRender","update"],p=[],d=new n,h=function(){function e(e){this._task=e}return e.prototype.remove=function(){this._task.removed=!0},e.prototype.pause=function(){this._task.paused=!0},e.prototype.resume=function(){this._task.paused=!1},e}();function f(e){void 0===e&&(e=performance.now()),t.debug.rafId=null,d.length>0&&(t.debug.rafId=v()),t.debug.executeFrameTasks(e)}function v(){return t.debug.requestNextFrame?t.debug.requestNextFrame(_):_()}t.FrameTaskHandle=h,t.debug={frameTasks:d,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(e){void 0===e&&(e=!1),d.forEach((function(e){e.removed=!0})),e&&y()},dispatch:g,executeFrameTasks:function(e){void 0===e&&(e=performance.now()),s<0&&(s=e);var t=e-s,r=l>0?l:1e3/60,n=Math.max(0,t-r);s=e;for(var i=function(i){var o=u[i];d.forEach((function(a){a.paused||a.removed||(0===i&&a.ticks++,a.phases[o]&&(c.time=e,c.deltaTime=0===a.ticks?0:t,c.elapsedFrameTime=performance.now()-e,c.frameDuration=r-n,a.phases[o].call(a,c)))}))},o=0;o<u.length;o++)i(o);y()}},t.schedule=function(e){var n=new a(e);return p.push(n),t.debug.willDispatch||(t.debug.willDispatch=!0,r(g)),n},t.addFrameTask=function(e){var r=new o(e);return d.push(r),t.debug.rafId||(s=-1,t.debug.rafId=v()),new h(r)},t.setFrameDuration=function(e){l=Math.max(0,e)},t.requestNextFrame=v;var m=new n;function y(){d.forEach((function(e){e.removed&&m.push(e)})),d.removeUnorderedMany(m.data,m.length),m.clear()}function g(){for(;p.length;){var e=p.shift();e.isActive&&(e.isActive=!1,e.callback())}t.debug.willDispatch=!1}function _(){return requestAnimationFrame(f)}t.waitTicks=function(e,t){void 0===e&&(e=1);var n=i.createResolver(),o=function(){i.isAborted(t)?n.reject(i.createAbortError()):0===e?n():(--e,r((function(){return o()})))};return o(),n.promise}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(184),r(215),r(202),r(170),r(862),r(407),r(427),r(623),r(479),r(197),r(861)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){function m(e){return!Array.isArray(e[0])}var y=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.rings=[],n.type="polygon",n}var a;return r.__extends(t,e),a=t,t.fromExtent=function(e){var t=e.clone().normalize(),r=e.spatialReference,n=!1,i=!1;t.map((function(e){e.hasZ&&(n=!0),e.hasM&&(i=!0)}));var o={rings:t.map((function(e){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n&&e.hasZ)for(var r=e.zmin+.5*(e.zmax-e.zmin),o=0;o<t.length;o++)t[o].push(r);if(i&&e.hasM){var a=e.mmin+.5*(e.mmax-e.mmin);for(o=0;o<t.length;o++)t[o].push(a)}return t})),spatialReference:r};return n&&(o.hasZ=!0),i&&(o.hasM=!0),new a(o)},t.prototype.normalizeCtorArgs=function(e,t){var r,n,i,o=null;return e&&!Array.isArray(e)?(o=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,n=e.hasM):o=e,o=o||[],t=t||l.WGS84,o.length&&o[0]&&null!=o[0][0]&&"number"==typeof o[0][0]&&(o=[o]),(i=o[0]&&o[0][0])&&(void 0===r&&void 0===n?(r=i.length>2,n=!1):void 0===r?r=!n&&i.length>3:void 0===n&&(n=!r&&i.length>3)),{rings:o,spatialReference:t,hasZ:r,hasM:n}},Object.defineProperty(t.prototype,"centroid",{get:function(){var e=c.polygonCentroid(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;var t=new s;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){var e=this.spatialReference,t=d.getPolygonExtent(this);if(!t)return null;var r=new o(t);return r.spatialReference=e,r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSelfIntersecting",{get:function(){return h.isSelfIntersecting(this.rings)},enumerable:!0,configurable:!0}),t.prototype.writePaths=function(e,t){t.rings=n.clone(this.rings)},t.prototype.addRing=function(e){if(e){this.clearCache();var t=this.rings,r=t.length;if(m(e)){for(var n=[],i=0,o=e.length;i<o;i++)n[i]=e[i].toArray();t[r]=n}else t[r]=e.concat();return this}},t.prototype.clone=function(){var e=new a;return e.spatialReference=this.spatialReference,e.rings=n.clone(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e},t.prototype.contains=function(e){return!!e&&(f.canProject(e,this.spatialReference)&&(e=f.project(e,this.spatialReference)),u.polygonContainsPoint(this,e))},t.prototype.isClockwise=function(e){var t,r=this;return t=m(e)?e.map((function(e){return r.hasZ?r.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y]})):e,p.isClockwise(t,this.hasM,this.hasZ)},t.prototype.getPoint=function(e,t){if(!this._validateInputs(e,t))return null;var r=this.rings[e][t],n=this.hasZ,i=this.hasM;return n&&!i?new s(r[0],r[1],r[2],void 0,this.spatialReference):i&&!n?new s(r[0],r[1],void 0,r[2],this.spatialReference):n&&i?new s(r[0],r[1],r[2],r[3],this.spatialReference):new s(r[0],r[1],this.spatialReference)},t.prototype.insertPoint=function(e,t,r){return this._validateInputs(e,t,!0)?(this.clearCache(),v.updateSupportFromPoint(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this):this},t.prototype.removePoint=function(e,t){return this._validateInputs(e,t)?(this.clearCache(),new s(this.rings[e].splice(t,1)[0],this.spatialReference)):null},t.prototype.removeRing=function(e){if(!this._validateInputs(e,null))return null;this.clearCache();var t=this.rings.splice(e,1)[0],r=this.spatialReference;return t.map((function(e){return new s(e,r)}))},t.prototype.setPoint=function(e,t,r){return this._validateInputs(e,t)?(this.clearCache(),v.updateSupportFromPoint(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this):this},t.prototype._validateInputs=function(e,t,r){if(void 0===r&&(r=!1),null==e||e<0||e>=this.rings.length)return!1;if(null!=t){var n=this.rings[e];if(r&&(t<0||t>n.length))return!1;if(!r&&(t<0||t>=n.length))return!1}return!0},t.prototype.toJSON=function(e){return this.write(null,e)},r.__decorate([i.property({dependsOn:["hasM","hasZ","rings"]})],t.prototype,"cache",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["cache"]})],t.prototype,"centroid",null),r.__decorate([i.property({dependsOn:["cache"],readOnly:!0})],t.prototype,"extent",null),r.__decorate([i.property({dependsOn:["cache"],readOnly:!0})],t.prototype,"isSelfIntersecting",null),r.__decorate([i.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],t.prototype,"rings",void 0),r.__decorate([i.writer("rings")],t.prototype,"writePaths",null),a=r.__decorate([i.subclass("esri.geometry.Polygon")],t)}(a);return y.prototype.toJSON.isDefaultToJSON=!0,y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(322),r(619),r(351),r(894),r(776)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){if(null!=t.screenSizePerspective||"defaults"!==this.originOf("screenSizePerspectiveEnabled"))return t.screenSizePerspective;n.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,0)}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){("defaults"===this.originOf("screenSizePerspectiveEnabled")&&e||i.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},n))&&(t[r]=e)}}}}}},t.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",writer:function(e,t,r){t[r]=!e}}}},t.labelsVisible={type:Boolean,value:!0,json:{read:{source:"showLabels"},write:{target:"showLabels"}}},t.url={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.write}}},t.legendEnabled={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}},t.elevationInfo={value:null,type:a,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}},t.readOnlyService=function(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}},t.opacity={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},t.opacityDrawingInfo=r.__assign(r.__assign({},t.opacity),{json:r.__assign(r.__assign({},t.opacity.json),{origins:{"web-document":r.__assign(r.__assign({},t.opacity.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?s.transparencyToOpacity(t.layerDefinition.drawingInfo.transparency):void 0:s.transparencyToOpacity(t.drawingInfo.transparency)}}})})}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(282),r(177),r(166)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Milliseconds=function(e){return e};var o={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};t.timeUnitKebabDictionary=i.strict()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:null}),t.offsetDate=function(e,t,r){var n=new Date(e.getTime());if(t&&r){var i=o[r],a=i.getter,s=i.setter,l=i.multiplier;n[s](n[a]()+t*l)}return n},t.combinedViewLayerTimeExtentProperty={type:r,dependsOn:["view.timeExtent","layer.timeExtent","layer.timeInfo","layer.timeOffset","layer.timeOffset.value","layer.timeOffset.unit","layer.useViewTime"],readOnly:!0,get:function(){var e,t;if(!(null===(e=this.layer)||void 0===e?void 0:e.timeInfo))return null;var r=null===(t=this.view)||void 0===t?void 0:t.timeExtent,n=this.layer.timeExtent,i=this.layer.useViewTime?r&&n?r.intersection(n):r||n:n;if(!i||i.isEmpty)return i;var o=this.layer.timeOffset,a=o?i.offset(-o.value,o.unit):i,s=this._get("timeExtent");return a.equals(s)?s:a}},t.millisecondsPerTimeUnit={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},t.truncateDate=function(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return n.neverReached(t),null}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(151),r(388)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.HandleOwnerMixin=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.destroy=function(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())},Object.defineProperty(t.prototype,"handles",{get:function(){return this._get("handles")||new i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingHandles",{get:function(){return this._get("updatingHandles")||new a.WatchUpdatingTracking},enumerable:!0,configurable:!0}),r.__decorate([o.property({readOnly:!0})],t.prototype,"handles",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"updatingHandles",null),r.__decorate([o.subclass("esri.core.HandleOwner")],t)}(e)};var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([o.subclass("esri.core.HandleOwner")],t)}(t.HandleOwnerMixin(n));t.HandleOwner=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(166),r(155),r(200),r(151),r(179),r(173),r(178),r(197),r(486)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){var h=new i.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(e){function t(t){var r=e.call(this,t)||this;return r.dpi=96,r.format=null,r.origin=null,r.minScale=0,r.maxScale=0,r.size=null,r.spatialReference=null,r}var i;return r.__extends(t,e),i=t,t.create=function(e){void 0===e&&(e={size:256,spatialReference:n.SpatialReference.WebMercator});var t=e.resolutionFactor||1,r=e.scales,o=e.size||256,s=e.spatialReference||n.SpatialReference.WebMercator;if(!u.isValid(s)){var l=[];if(r)for(var c=0;c<r.length;c++){var p=r[c];l.push({level:c,scale:p,resolution:p})}else{var d=5e-4;for(c=23;c>=0;c--)l.unshift({level:c,scale:d,resolution:d}),d*=2}return new i({dpi:96,lods:l,origin:new n.Point(0,0,s),size:[o,o],spatialReference:s})}var h=u.getInfo(s),f=e.origin?new n.Point({x:e.origin.x,y:e.origin.y,spatialReference:s}):h?new n.Point({x:h.origin[0],y:h.origin[1],spatialReference:s}):new n.Point({x:0,y:0,spatialReference:s}),v=1/(39.37*a.getMetersPerUnitForSR(s)*96),m=[];if(r)for(c=0;c<r.length;c++)d=(p=r[c])*v,m.push({level:c,scale:p,resolution:d});else{var y=u.isGeographic(s)?512/o*591657527.5917094:256/o*591657527.591555,g=Math.ceil(24/t);for(m.push({level:0,scale:y,resolution:y*v}),c=1;c<g;c++)d=(p=y/Math.pow(2,t))*v,m.push({level:c,scale:p,resolution:d}),y=p}return new i({dpi:96,lods:m,origin:f,size:[o,o],spatialReference:s})},Object.defineProperty(t.prototype,"isWrappable",{get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var r=u.getInfo(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1},enumerable:!0,configurable:!0}),t.prototype.readOrigin=function(e,t){return n.Point.fromJSON(r.__assign({spatialReference:t.spatialReference},e))},Object.defineProperty(t.prototype,"lods",{set:function(e){var t=this,r=0,n=0,i=[];this._levelToLOD={},e&&(r=-1/0,n=1/0,e.forEach((function(e){i.push(e.scale),r=e.scale>r?e.scale:r,n=e.scale<n?e.scale:n,t._levelToLOD[e.level]=e}))),this._set("scales",i),this._set("minScale",r),this._set("maxScale",n),this._set("lods",e),this._initializeUpsampleLevels()},enumerable:!0,configurable:!0}),t.prototype.readSize=function(e,t){return[t.cols,t.rows]},t.prototype.writeSize=function(e,t){t.cols=e[0],t.rows=e[0]},t.prototype.zoomToScale=function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var r=Math.round(e-.5),n=Math.round(e);return t[n]+(n-e)*(t[r]-t[n])},t.prototype.scaleToZoom=function(e){for(var t=this.scales,r=t.length-1,n=0;n<r;n++){var i=t[n],o=t[n+1];if(i<=e)return n;if(o===e)return n+1;if(i>e&&o<e)return n+1-(e-o)/(i-o)}return n},t.prototype.snapScale=function(e,t){void 0===t&&(t=.95);var r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))},t.prototype.tileAt=function(e,t,r,n){var i,o,a=this.lodAt(e);if(!a)return null;if("number"==typeof t)i=t,o=r;else if(u.equals(t.spatialReference,this.spatialReference))i=t.x,o=t.y,n=r;else{var s=p.project(t,this.spatialReference);if(!s)return null;i=s.x,o=s.y,n=r}var l=a.resolution*this.size[0],d=a.resolution*this.size[1];return n||(n={id:null,level:0,row:0,col:0,extent:c.create()}),n.level=e,n.row=Math.floor((this.origin.y-o)/d+.001),n.col=Math.floor((i-this.origin.x)/l+.001),this.updateTileInfo(n),n},t.prototype.updateTileInfo=function(e){var t=this.lodAt(e.level);if(t){var r=t.resolution*this.size[0],n=t.resolution*this.size[1];e.id=e.level+"/"+e.row+"/"+e.col,e.extent||(e.extent=c.create()),e.extent[0]=this.origin.x+e.col*r,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+r,e.extent[3]=e.extent[1]+n}},t.prototype.upsampleTile=function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))},t.prototype.getTileBounds=function(e,t){var r=this.lodAt(t.level).resolution,n=r*this.size[0],i=r*this.size[1];return e[0]=this.origin.x+t.col*n,e[1]=this.origin.y-(t.row+1)*i,e[2]=e[0]+n,e[3]=e[1]+i,e},t.prototype.lodAt=function(e){return this._levelToLOD&&this._levelToLOD[e]||null},t.prototype.clone=function(){return i.fromJSON(this.write({}))},t.prototype._initializeUpsampleLevels=function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,r=0;r<e.length;r++){var n=e[r];this._upsampleLevels[n.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/n.resolution:0},t=n}},r.__decorate([s.property({type:Number,json:{write:!0}})],t.prototype,"compressionQuality",void 0),r.__decorate([s.property({type:Number,json:{write:!0}})],t.prototype,"dpi",void 0),r.__decorate([s.property({type:String,json:{read:h.read,write:h.write,origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"format",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],t.prototype,"isWrappable",null),r.__decorate([s.property({type:n.Point,json:{write:!0}})],t.prototype,"origin",void 0),r.__decorate([s.reader("origin")],t.prototype,"readOrigin",null),r.__decorate([s.property({type:[d],value:null,json:{write:!0}})],t.prototype,"lods",null),r.__decorate([s.property({readOnly:!0})],t.prototype,"minScale",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"maxScale",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"scales",void 0),r.__decorate([s.property({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],t.prototype,"size",void 0),r.__decorate([s.reader("size",["rows","cols"])],t.prototype,"readSize",null),r.__decorate([s.writer("size",{cols:{type:l.Integer},rows:{type:l.Integer}})],t.prototype,"writeSize",null),r.__decorate([s.property({type:n.SpatialReference,json:{write:!0}})],t.prototype,"spatialReference",void 0),i=r.__decorate([s.subclass("esri.layers.support.TileInfo")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(478),r(162),r(160),r(202),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,n,i,o){var s,l;e instanceof a&&n instanceof a&&(i=n.longitude,o=n.latitude,l=e.latitude,s=e.longitude);var c=r.deg2rad(l),u=r.deg2rad(o),p=c-u,d=r.deg2rad(s)-r.deg2rad(i),h=Math.sin(p/2),f=Math.sin(d/2),v=2*r.asinClamped(Math.sqrt(h*h+Math.cos(c)*Math.cos(u)*f*f))*t.earthRadius;return Math.round(1e4*v)/1e4}function c(e,t){var r=e/15;return t||(r=Math.round(r)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=n.wgs84Radius,t.halfEarthRadius=t.earthRadius/2,t.halfEarthCircumference=Math.PI*t.earthRadius,t.earthCircumference=2*t.halfEarthCircumference,t.metersPerDegree=t.halfEarthCircumference/180,t.getGreatCircleDistance=l,t.getGreatCircleSpanAt=function(e,t,r){var n=t.spatialReference,i=new a(t.x,e.y,n),o=new a(r.x,e.y,n),s=new a(e.x,t.y,n),c=new a(e.x,r.y,n);return{lon:l(i,o),lat:l(s,c)}},t.getLonDeltaForDistance=function(e,n){var i=n/t.earthRadius,o=r.deg2rad(e),a=Math.sin(i/2),s=Math.cos(o),l=2*r.asinClamped(Math.sqrt(a*a/(s*s)));return r.rad2deg(l)},t.getLatDeltaForDistance=function(e){return r.rad2deg(e/t.earthRadius)},t.getMaxCameraAltitude=function(e){var n=e/2,i=r.deg2rad(n);return(1-Math.sin(i))*t.earthRadius/Math.sin(i)},t.getViewExtentDistance=function(e,n){var i=r.deg2rad(n/2),o=(e+t.earthRadius)*Math.cos(i)-Math.sqrt(Math.pow(Math.cos(i)*(e+t.earthRadius),2)-e*e-2*e*t.earthRadius);return 2*r.acosClamped((Math.pow(e+t.earthRadius,2)+Math.pow(t.earthRadius,2)-Math.pow(o,2))/(2*(e+t.earthRadius)*t.earthRadius))*t.earthRadius},t.computeCartesianDistance=function(e,t){var r=s.wgs84ComparableLonLatToECEF(u,e.longitude,e.latitude,e.z||0),n=s.wgs84ComparableLonLatToECEF(p,t.longitude,t.latitude,t.z||0),i=[n[0]-r[0],n[1]-r[1],n[2]-r[2]];return Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2])},t.longitudeToTimezone=c,t.positionToTimezone=function(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=c(e[0],!0);var r=t.hours%1;t.hours-=r,t.minutes=60*r;var n=t.minutes%1;return t.minutes-=n,t.seconds=Math.round(60*n),t},t.distanceToIdealHorizon=function(e,r){r=r||t.earthRadius;var n=i.vec3.dot(e,e),o=r*r;return Math.sqrt(Math.abs(n-o))};var u=o.vec3f64.create(),p=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(179),r(866),r(872),r(875),r(430),r(877),r(777),r(1119),r(883),r(778),r(884),r(885),r(779),r(878),r(1123),r(1125),r(522),r(523),r(629),r(429),r(780),r(428),r(431),r(409),r(886),r(432),r(879),r(1126),r(881),r(1122),r(882),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D){Object.defineProperty(t,"__esModule",{value:!0}),t.CIMSymbol=n,t.ExtrudeSymbol3DLayer=i,t.BaseFillSymbol=o,t.FillSymbol3DLayer=a,t.Font=s,t.IconSymbol3DLayer=l,t.LabelSymbol3D=c,t.LineSymbol3D=u,t.LineSymbol3DLayer=p,t.BaseMarkerSymbol=d,t.MeshSymbol3D=h,t.ObjectSymbol3DLayer=f,t.PathSymbol3DLayer=v,t.PictureFillSymbol=m,t.PictureMarkerSymbol=y,t.PointSymbol3D=g,t.PolygonSymbol3D=_,t.SimpleFillSymbol=b,t.SimpleLineSymbol=x,t.SimpleMarkerSymbol=w,t.BaseSymbol=S,t.BaseSymbol3D=P,t.BaseSymbol3DLayer=T,t.TextSymbol=O,t.TextSymbol3DLayer=C,t.WaterSymbol3DLayer=M,t.WebStyleSymbol=A,t.LineCallout3D=E,t.LineCallout3DBorder=I,t.Symbol3DVerticalOffset=R.Symbol3DVerticalOffset,t.fromJSON=D.fromJSON,t.isSymbol=function(e){return e instanceof S},t.isSymbol2D=function(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}},t.isSymbol3D=function(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}},t.symbolTypes={base:S,key:"type",typeMap:{"simple-fill":b,"picture-fill":m,"picture-marker":y,"simple-line":x,"simple-marker":w,text:O,"label-3d":c,"line-3d":u,"mesh-3d":h,"point-3d":g,"polygon-3d":_,"web-style":A,cim:n}},t.symbolTypesRenderer={base:S,key:"type",typeMap:{"simple-fill":b,"picture-fill":m,"picture-marker":y,"simple-line":x,"simple-marker":w,text:O,"line-3d":u,"mesh-3d":h,"point-3d":g,"polygon-3d":_,"web-style":A,cim:n}},t.symbolTypesLabel={base:S,key:"type",typeMap:{text:O,"label-3d":c}},t.symbolTypes3D={base:S,key:"type",typeMap:{"label-3d":c,"line-3d":u,"mesh-3d":h,"point-3d":g,"polygon-3d":_,"web-style":A}},t.symbolTypesRenderer3D={base:S,key:"type",typeMap:{"line-3d":u,"mesh-3d":h,"point-3d":g,"polygon-3d":_,"web-style":A}},t.symbolTypesLabel3D={base:S,key:"type",typeMap:{"label-3d":c}},t.ensureType=r.ensureOneOfType(t.symbolTypes)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(156),r(153),r(172),r(151),r(273),r(283),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=o.getLogger("esri.layers.mixins.PortalLayer");t.PortalLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resourceReferences={portalItem:null,paths:[]},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"portalItem",{set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))},enumerable:!0,configurable:!0}),t.prototype.readPortalItem=function(e,t,r){if(t.itemId)return new u({id:t.itemId,portal:r&&r.portal})},t.prototype.writePortalItem=function(e,t){e&&e.id&&(t.itemId=e.id)},t.prototype.loadFromPortal=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var i,o;return n.__generator(this,(function(n){switch(n.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,new Promise((function(e,t){r.e(125).then(function(){var t=[r(836)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return i=n.sent(),a.throwIfAborted(t),[4,i.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)];case 3:return[2,n.sent()];case 4:throw o=n.sent(),p.warn("Failed to load layer ("+this.title+", "+this.id+") portal item ("+this.portalItem.id+")\n  "+o),o;case 5:return[2]}}))}))},t.prototype.read=function(t,r){r&&(r.layer=this),e.prototype.read.call(this,t,r)},t.prototype.write=function(t,r){var o=r&&r.portal,a=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||c.getDefault());return o&&a&&!s.hasSamePortal(a.restUrl,o.restUrl)?(r.messages&&r.messages.push(new i("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):e.prototype.write.call(this,t,n.__assign(n.__assign({},r),{layer:this}))},n.__decorate([l.property({type:u})],t.prototype,"portalItem",null),n.__decorate([l.reader("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),n.__decorate([l.writer("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),n.__decorate([l.property()],t.prototype,"resourceReferences",void 0),n.__decorate([l.subclass("esri.layers.mixins.PortalLayer")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(1526)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r.getLogger("esri.views.input.InputHandler"),o=function(){function e(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}return Object.defineProperty(e.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches)for(var e in this._incomingEventMatches=[],this._incoming)for(var t=0,r=this._incoming[e];t<r.length;t++){var n=r[t];this._incomingEventMatches.push(n.match)}return this._incomingEventMatches},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"incomingEventTypes",{get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((function(e){return e.eventType}))),this._incomingEventTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outgoingEventTypes",{get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingInputs",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.onInstall=function(e){var t=this;this._manager?i.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((function(e){return t._handleEvent(e)})),e.setUninstallCallback((function(){return t._onUninstall()})),this._manager=e)},e.prototype.onUninstall=function(){},e.prototype.registerIncoming=function(e,t,r){var i,o=this;"function"==typeof t?(r=t,i=[]):i=t||[];var s="string"==typeof e?new n.EventMatch(e,i):e,l=function(){o._incomingEventTypes=null,o._incomingEventMatches=null},c=function(e){var t=o._incoming[e.match.eventType];if(t){var r=t.indexOf(e);t.splice(r,1),l(),o._manager&&o._manager.updateDependencies()}},u=new a(s,r,{onPause:c,onRemove:c,onResume:function(e){var t=o._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),l(),o._manager&&o._manager.updateDependencies())}}),p=this._incoming[s.eventType];return p||(p=[],this._incoming[s.eventType]=p),p.push(u),l(),this._manager&&this._manager.updateDependencies(),u},e.prototype.registerOutgoing=function(e){var t=this;if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);var r=new s(e,{onEmit:function(e,r,n,i){t._manager.emit(e.eventType,r,n,i)},onRemove:function(e){delete t._outgoing[e.eventType],t._manager.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r},e.prototype.startCapturingPointer=function(e){this._manager.setPointerCapture(e,!0)},e.prototype.stopCapturingPointer=function(e){this._manager.setPointerCapture(e,!1)},e.prototype.refreshHasPendingInputs=function(){this._manager.refreshHasPendingInputs()},e.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):i.error("This InputHandler is not registered with an InputManager")},e.prototype._handleEvent=function(e){var t=this._incoming[e.type];if(t)for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}},e}();t.InputHandler=o;var a=function(){function e(e,t,r){this.match=e,this._callback=t,this._handler=r}return e.prototype.pause=function(){this._handler.onPause(this)},e.prototype.resume=function(){this._handler.onResume(this)},e.prototype.remove=function(){this._handler.onRemove(this)},Object.defineProperty(e.prototype,"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0}),e}(),s=function(){function e(e,t){this.eventType=e,this._removed=!1,this._handler=t}return e.prototype.emit=function(e,t,r){this._removed||this._handler.onEmit(this,e,t,r)},e.prototype.remove=function(){this._removed=!0,this._handler.onRemove(this)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(152),r(1608)],void 0===(i=function(e,t,r,n,i){var o=r("esri-debug-messages");function a(e,t){if(n.isNone(e)||e.length!==t.length)return!0;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!0;return!1}return function(){function e(t,n,i,o,a){if(void 0===a&&(a={}),this._context=null,this._glName=null,this._locations={},this._id=void 0,this._initialized=!1,this._vShader=null,this._fShader=null,this._defines={},this._nameToUniformLocation={},this._nameToAttribLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},t||console.error("RenderingContext isn't initialized!"),0===n.length&&console.error("Shaders source should not be empty!"),this._context=t,this._vertexShaderSource=n,this._fragmentShaderSource=i,Array.isArray(a))for(var s=0,l=a;s<l.length;s++){var c=l[s];this._defines[c]="1"}else this._defines=a;this._id=e._nextId++,this._locations=o,r("esri-webgl-debug")&&t.instanceCounter.increment(3,this)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0}),e.prototype.getDefine=function(e){return this._defines[e]},e.prototype.dispose=function(){if(this._context){var e=this._context.gl;if(this._vShader){var t=this._vShader;e.deleteShader(t),this._vShader=null}if(this._fShader){var n=this._fShader;e.deleteShader(n),this._fShader=null}this._glName&&(e.deleteProgram(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrement(3,this),this._context=null}},e.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633),this._fShader=this._loadShader(35632),this._vShader&&this._fShader||console.error("Error loading shaders!");var e=this._context.gl,t=e.createProgram();for(var n in e.attachShader(t,this._vShader),e.attachShader(t,this._fShader),this._locations){var i=this._locations[n];e.bindAttribLocation(t,i,n)}e.linkProgram(t),r("esri-validate-shaders")&&!e.getProgramParameter(t,e.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+e.getProgramParameter(t,e.VALIDATE_STATUS)+", gl error ["+e.getError()+"]infoLog: "+e.getProgramInfoLog(t)),this._glName=t,this._initialized=!0}},e.prototype.getUniformLocation=function(e){return this.initialize(),void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e)),this._nameToUniformLocation[e]},e.prototype.hasUniform=function(e){return null!==this.getUniformLocation(e)},e.prototype.getAttribLocation=function(e){return this.initialize(),void 0===this._nameToAttribLocation[e]&&(this._nameToAttribLocation[e]=this._context.gl.getAttribLocation(this._glName,e)),this._nameToAttribLocation[e]},e.prototype.setUniform1i=function(e,t){var r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)},e.prototype.setUniform1iv=function(t,r){var n=this._nameToUniform1v[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform1v[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform2iv=function(t,r){o&&r.length%2!=0&&console.error("Value array must have even number of elements!");var n=this._nameToUniform2[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform2[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform3iv=function(t,r){o&&r.length%3!=0&&console.error("Value array must contain sets of three values!");var n=this._nameToUniform3[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform3[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform4iv=function(t,r){o&&r.length%4!=0&&console.error("Value array must contain sets of four values!");var n=this._nameToUniform4[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform4[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform1f=function(e,t){var r=this._nameToUniform1[e];void 0!==r&&t===r||(this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(e),t),this._nameToUniform1[e]=t)},e.prototype.setUniform1fv=function(t,r){var n=this._nameToUniform1v[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform1v[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform2f=function(e,t,r){var n=this._nameToUniform2[e];void 0!==n&&t===n[0]&&r===n[1]||(this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(e),t,r),void 0===n?this._nameToUniform2[e]=[t,r]:(n[0]=t,n[1]=r))},e.prototype.setUniform2fv=function(t,r){o&&r.length%2!=0&&console.error("Value array must have even number of elements!");var n=this._nameToUniform2[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform2[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform3f=function(e,t,r,n){var i=this._nameToUniform3[e];void 0!==i&&t===i[0]&&r===i[1]&&n===i[2]||(this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(e),t,r,n),void 0===i?this._nameToUniform3[e]=[t,r,n]:(i[0]=t,i[1]=r,i[2]=n))},e.prototype.setUniform3fv=function(t,r){o&&r.length%3!=0&&console.error("Value array must contain sets of three values!");var n=this._nameToUniform3[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform3[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniform4f=function(e,t,r,n,i){var o=this._nameToUniform4[e];void 0!==o&&t===o[0]&&r===o[1]&&n===o[2]&&i===o[3]||(this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(e),t,r,n,i),void 0===o?this._nameToUniform4[e]=[t,r,n,i]:(o[0]=t,o[1]=r,o[2]=n,o[3]=i))},e.prototype.setUniform4fv=function(t,r){o&&r.length%4!=0&&console.error("Value array must contain sets of four values!");var n=this._nameToUniform4[t];a(n,r)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(t),r),void 0===n?this._nameToUniform4[t]=e._arrayCopy(r):e._arrayAssign(r,n))},e.prototype.setUniformMatrix3fv=function(t,r,i){void 0===i&&(i=!1),o&&r.length%9!=0&&console.error("Matrix array must contain sets ot 9 elements!");var s=this._nameToUniformMatrix3[t];(function(e,t){return!!n.isNone(e)||(9!==e.length?a(e,t):(o&&9!==t.length&&console.error("Matrix object must contain 16 elements!"),9!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]))})(s,r)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(t),i,r),void 0===s?this._nameToUniformMatrix3[t]=e._arrayCopy(r):e._arrayAssign(r,s))},e.prototype.setUniformMatrix4fv=function(t,r,i){void 0===i&&(i=!1),o&&r.length%16!=0&&console.error("Matrix array must contain sets ot 16 elements!");var s=this._nameToUniformMatrix4[t];(function(e,t){return!!n.isNone(e)||(16!==e.length?a(e,t):(o&&16!==t.length&&console.error("Matrix object must contain 16 elements!"),16!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15]))})(s,r)&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(t),i,r),void 0===s?this._nameToUniformMatrix4[t]=e._arrayCopy(r):e._arrayAssign(r,s))},e.prototype.assertCompatibleVertexAttributeLocations=function(e){var t=e.locations===this.locations;return t||console.error("VertexAttributeLocations are incompatible"),t},e._padToThree=function(e){var t=e.toString();return e<1e3&&(t=("  "+e).slice(-3)),t},e.prototype._addLineNumbers=function(t){var r=2;return t.replace(/\n/g,(function(){return"\n"+e._padToThree(r++)+":"}))},e.prototype._loadShader=function(e){var t=35633===e,n=t?this._vertexShaderSource:this._fragmentShaderSource,o=n,a="";for(var s in this._defines)a+="#define "+s+" "+this._defines[s]+"\n";o=a+o,"webgl2"===this._context.contextVersion&&(o=i.transpileShader(o,t?"vertex":"fragment"));var l=this._context.gl,c=l.createShader(e);return l.shaderSource(c,o),l.compileShader(c),r("esri-validate-shaders")&&!l.getShaderParameter(c,l.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t?"vertex":"fragment"," shader")),console.error(l.getShaderInfoLog(c)),console.error(this._addLineNumbers(o)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(n))),c},e._arrayCopy=function(e){for(var t=[],r=0;r<e.length;++r)t.push(e[r]);return t},e._arrayAssign=function(e,t){for(var r=0;r<e.length;++r)t[r]=e[r]},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156),r(163),r(274),r(304),r(224)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){return e?t?4:3:t?3:2}Object.defineProperty(t,"__esModule",{value:!0});var c=n.getLogger("esri.tasks.support.optimizedFeatureSet"),u={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},p=function(e,t,r,n,i,o){e[r]=i,e[r+1]=o},d=function(e,t,r,n,i,o){e[r]=i,e[r+1]=o,e[r+2]=t[n+2]},h=function(e,t,r,n,i,o){e[r]=i,e[r+1]=o,e[r+2]=t[n+3]},f=function(e,t,r,n,i,o){e[r]=i,e[r+1]=o,e[r+2]=t[n+2],e[r+3]=t[n+3]};function v(e,t,r,n){if(e){if(r)return t&&n?f:d;if(t&&n)return h}else if(t&&n)return d;return p}function m(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function y(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function g(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function _(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function b(e){var t=e.coords;return{x:t[0],y:t[1]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function w(e){var t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function P(e){var t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function O(e){var t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function M(e,t){return e&&t?C:e?S:t?T:x}function A(e,t,r){if(!e)return null;for(var n=l(t,r),i=[],o=0;o<e.coords.length;o+=n){for(var a=[],s=0;s<n;s++)a.push(e.coords[o+s]);i.push(a)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function E(e,t,r){void 0===r&&(r=l(t.hasZ,t.hasM)),e.lengths[0]=t.points.length;for(var n=e.coords,i=0,o=0,a=t.points;o<a.length;o++)for(var s=a[o],c=0;c<r;c++)n[i++]=s[c];return e}function I(e,t,r){if(!e)return null;for(var n=l(t,r),i=e.coords,o=[],a=0,s=0,c=e.lengths;s<c.length;s++){for(var u=c[s],p=[],d=0;d<u;d++){for(var h=[],f=0;f<n;f++)h.push(i[a++]);p.push(h)}o.push(p)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function R(e,t,r){void 0===r&&(r=l(t.hasZ,t.hasM));for(var n=e.lengths,i=e.coords,o=0,a=0,s=t.paths;a<s.length;a++){for(var c=s[a],u=0,p=c;u<p.length;u++)for(var d=p[u],h=0;h<r;h++)i[o++]=d[h];n.push(c.length)}return e}function D(e,t,r){if(!e)return null;for(var n=l(t,r),i=e.coords,o=[],a=0,s=0,c=e.lengths;s<c.length;s++){for(var u=c[s],p=[],d=0;d<u;d++){for(var h=[],f=0;f<n;f++)h.push(i[a++]);p.push(h)}o.push(p)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function L(e,t,r,n){return void 0===r&&(r=t.hasZ),void 0===n&&(n=t.hasM),j(e,t.rings,r,n),e}function j(e,t,r,n){var i=l(r,n),o=e.lengths,a=e.coords,s=0;o.length=a.length=0;for(var c=0,u=t;c<u.length;c++){for(var p=u[c],d=0,h=p;d<h.length;d++)for(var f=h[d],v=0;v<i;v++)a[s++]=f[v];o.push(p.length)}return e}t.quantizeX=m,t.quantizeY=y,t.hydrateX=g,t.hydrateY=_,t.convertToPoint=function(e,t,r){return e?t?r?O(e):w(e):r?P(e):b(e):null},t.convertFromPoint=function(e,t,r){return void 0===r&&(r=M(null!=t.z,null!=t.m)),r(e,t)},t.convertToMultipoint=A,t.convertFromMultipoint=E,t.convertToPolyline=I,t.convertFromPolyline=R,t.convertToPolygon=D,t.convertFromPolygon=L,t.convertFromNestedArray=j;var V=[],F=[];function N(e,t,n,i,a,u){if(e.length=0,!n){for(var p=0,d=t;p<d.length;p++){var h=d[p],f=h.attributes[u];e.push(new o.default(null,h.attributes,null,f))}return e}switch(n){case"esriGeometryPoint":return function(e,t,r,n,i){for(var a=M(r,n),l=0,c=t;l<c.length;l++){var u=c[l],p=u.geometry,d=u.attributes,h=void 0;p&&(h=a(new s.default,p)),e.push(new o.default(h,d,null,d[i]))}return e}(e,t,i,a,u);case"esriGeometryMultipoint":return function(e,t,r,n,i){for(var a=l(r,n),c=0,u=t;c<u.length;c++){var p=u[c],d=p.geometry,h=p.attributes,f=void 0;d&&(f=E(new s.default,d,a)),e.push(new o.default(f,h,null,h[i]))}return e}(e,t,i,a,u);case"esriGeometryPolyline":return function(e,t,r,n,i){for(var a=l(r,n),c=0,u=t;c<u.length;c++){var p=u[c],d=p.geometry,h=p.attributes,f=void 0;d&&(f=R(new s.default,d,a)),e.push(new o.default(f,h,null,h[i]))}return e}(e,t,i,a,u);case"esriGeometryPolygon":return function(e,t,r,n,i){for(var a=0,l=t;a<l.length;a++){var c=l[a],u=c.geometry,p=c.centroid,d=c.attributes,h=void 0;u&&(h=L(new s.default,u,r,n)),p?e.push(new o.default(h,d,x(new s.default,p),d[i])):e.push(new o.default(h,d,null,d[i]))}return e}(e,t,i,a,u);default:c.error("convertToFeatureSet:unknown-geometry",new r("Unable to parse unknown geometry type '"+n+"'")),e.length=0}return e}function k(e,t,n,i,o){switch(e.length=0,n){case"esriGeometryPoint":return function(e,t,r,n){var i=b;r&&n?i=O:r?i=w:n&&(i=P);for(var o=0,a=t;o<a.length;o++){var s=a[o],l=s.geometry,c=s.attributes,u=l?i(l):null;e.push({attributes:c,geometry:u})}return e}(e,t,i,o);case"esriGeometryMultipoint":return function(e,t,r,n){for(var i=0,o=t;i<o.length;i++){var a=o[i],s=a.geometry,l=a.attributes,c=void 0;s&&(c=A(s,r,n)),e.push({attributes:l,geometry:c})}return e}(e,t,i,o);case"esriGeometryPolyline":return function(e,t,r,n){for(var i=0,o=t;i<o.length;i++){var a=o[i],s=a.geometry,l=a.attributes,c=void 0;s&&(c=I(s,r,n)),e.push({attributes:l,geometry:c})}return e}(e,t,i,o);case"esriGeometryPolygon":return function(e,t,r,n){for(var i=0,o=t;i<o.length;i++){var a=o[i],s=a.geometry,l=a.attributes,c=a.centroid,u=void 0;if(s&&(u=D(s,r,n)),c){var p=b(c);e.push({attributes:l,centroid:p,geometry:u})}else e.push({attributes:l,geometry:u})}return e}(e,t,i,o);default:c.error("convertToFeatureSet:unknown-geometry",new r("Unable to parse unknown geometry type '"+n+"'"))}return e}function z(e,t,r,n,i,o,a,s){if(void 0===a&&(a=r),void 0===s&&(s=n),e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var c,p,d,h,f=u[i],g=t.coords,_=t.lengths,b=l(r,n),x=l(r&&a,n&&s),w=v(r,n,a,s);if(!_.length)return w(e.coords,g,0,0,m(o,g[0]),y(o,g[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=b,e;for(var S=0,P=0,T=P,O=0,C=_;O<C.length;O++){var M=C[O];if(!(M<f)){var A=0;P=T,d=c=m(o,g[S]),h=p=y(o,g[S+1]),w(e.coords,g,P,S,d,h),A++,S+=b,P+=x;for(var E=1;E<M;E++,S+=b)d=m(o,g[S]),h=y(o,g[S+1]),d===c&&h===p||(w(e.coords,g,P,S,d-c,h-p),P+=x,A++,c=d,p=h);A>=f&&(e.lengths.push(A),T=P)}}return e.coords.length=T,e.coords.length?e:null}function U(e,t,r,n){var i=e[t],o=e[t+1],a=e[r],s=e[r+1],l=e[n],c=e[n+1],u=a,p=s,d=l-u,h=c-p;if(0!==d||0!==h){var f=((i-u)*d+(o-p)*h)/(d*d+h*h);f>1?(u=l,p=c):f>0&&(u+=d*f,p+=h*f)}return(d=i-u)*d+(h=o-p)*h}function B(e,t,r,n,i,o,a){for(var s,l=n,c=0,u=o+r;u<a;u+=r)(s=U(t,u,o,a))>l&&(c=u,l=s);l>n&&(c-o>r&&B(e,t,r,n,i,o,c),i(e,t,e.length,c,t[c],t[c+1]),a-c>r&&B(e,t,r,n,i,c,a))}function G(e,t,r,n,i){var o=t.coords,a=t.lengths,s=r?n?f:d:n?d:p,c=l(r,n);if(!o.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return s(e.coords,o,0,0,g(i,o[0]),_(i,o[1])),e!==t&&(e.lengths.length=0,e.coords.length=c),e;for(var u=i.scale,h=u[0],v=u[1],m=0,y=0;y<a.length;y++){var b=a[y];e.lengths[y]=b;var x=g(i,o[m]),w=_(i,o[m+1]);s(e.coords,o,m,m,x,w),m+=c;for(var S=1;S<b;S++,m+=c)x+=o[m]*h,w-=o[m+1]*v,s(e.coords,o,m,m,x,w)}return e!==t&&(e.lengths.length=a.length,e.coords.length=o.length),e}t.convertFromFeature=function(e,t,r,n,i){V[0]=e;var o=N(F,V,t,r,n,i)[0];return V.length=F.length=0,o},t.convertFromFeatures=N,t.convertToFeature=function(e,t,r,n){F[0]=e,k(V,F,t,r,n);var i=V[0];return V.length=F.length=0,i},t.convertFromGeometry=function(e,t,n){if(!e)return null;var o=new s.default;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),i.isPoint(e)?M(null!=t?t:null!=e.z,null!=n?n:null!=e.m)(o,e):i.isPolygon(e)?L(o,e,t,n):i.isPolyline(e)?R(o,e,l(t,n)):i.isMultipoint(e)?E(o,e,l(t,n)):void c.error("convertFromGeometry:unknown-geometry",new r("Unable to parse unknown geometry type '"+e+"'"))},t.convertToGeometry=function(e,t,n,i){var o=e&&("coords"in e?e:e.geometry);if(!o)return null;switch(t){case"esriGeometryPoint":var a=b;return n&&i?a=O:n?a=w:i&&(a=P),a(o);case"esriGeometryMultipoint":return A(o,n,i);case"esriGeometryPolyline":return I(o,n,i);case"esriGeometryPolygon":return D(o,n,i);default:return void c.error("convertToGeometry:unknown-geometry",new r("Unable to parse unknown geometry type '"+t+"'"))}},t.convertToFeatures=k,t.convertToFeatureSet=function(e){var t=e.objectIdFieldName,r=e.spatialReference,n=e.transform,i=e.fields,o=e.hasM,a=e.hasZ,s=e.features,l=e.geometryType,c=e.exceededTransferLimit,u={features:k([],s,l,a,o),fields:i,geometryType:l,objectIdFieldName:t,spatialReference:r};return n&&(u.transform=n),c&&(u.exceededTransferLimit=c),o&&(u.hasM=o),a&&(u.hasZ=a),u},t.convertFromFeatureSet=function(e,t){var n=new a.default,i=e.hasM,o=e.hasZ,s=e.features,l=e.objectIdFieldName,u=e.spatialReference,p=e.geometryType,d=e.exceededTransferLimit,h=e.transform;return n.fields=e.fields,n.geometryType=p,n.objectIdFieldName=l||t,n.spatialReference=u,n.objectIdFieldName?(s&&N(n.features,s,p,o,i,n.objectIdFieldName),d&&(n.exceededTransferLimit=d),i&&(n.hasM=i),o&&(n.hasZ=o),h&&(n.transform=h),n):(c.error(new r("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)},t.hydrateOptimizedFeatureSet=function(e){var t=e.transform,r=e.features,n=e.hasM,i=e.hasZ;if(!t)return e;for(var o=0,a=r;o<a.length;o++){var s=a[o];s.geometry&&G(s.geometry,s.geometry,n,i,t),s.centroid&&G(s.centroid,s.centroid,n,i,t)}return e.transform=null,e},t.quantizeOptimizedFeatureSet=function(e,t){var r=t.geometryType,n=t.features,i=t.hasM,a=t.hasZ;if(!e)return t;for(var l=0;l<n.length;l++){var c=n[l],u=new o.default(new s.default,c.attributes);z(u.geometry,c.geometry,i,a,r,e),c.centroid&&(u.centroid=new s.default,z(u.centroid,c.centroid,i,a,"esriGeometryPoint",e)),n[l]=u}return t.transform=e,t},t.quantizeOptimizedGeometry=z,t.generalizeOptimizedGeometry=function(e,t,r,n,i,o,a,s){if(void 0===a&&(a=r),void 0===s&&(s=n),e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var c=u[i],p=t.coords,d=t.lengths,h=l(r,n),f=l(r&&a,n&&s),m=v(r,n,a,s);if(!d.length)return m(e.coords,p,0,0,p[0],p[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=h,e;for(var y=0,g=o*o,_=0,b=d;_<b.length;_++){var x=b[_];if(x<c)y+=x*h;else{var w=e.coords.length/f,S=y,P=y+(x-1)*h;m(e.coords,p,e.coords.length,S,p[S],p[S+1]),B(e.coords,p,h,g,m,S,P),m(e.coords,p,e.coords.length,P,p[P],p[P+1]);var T=e.coords.length/f-w;T>=c?e.lengths.push(T):e.coords.length=w*f,y+=x*h}}return e.coords.length?e:null},t.getBoundsOptimizedGeometry=function(e,t,r,n){var i=l(r,n),o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords)for(var u=t.coords,p=0;p<u.length;p+=i){var d=u[p],h=u[p+1];o=Math.min(o,d),s=Math.max(s,d),a=Math.min(a,h),c=Math.max(c,h)}return e[0]=o,e[1]=a,e[2]=s,e[3]=c,e},t.getQuantizedBoundsOptimizedGeometry=function(e,t,r,n){for(var i=l(r,n),o=t.lengths,a=t.coords,s=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d=0,h=0,f=o;h<f.length;h++){var v=f[h],m=a[d],y=a[d+1];s=Math.min(m,s),c=Math.min(y,c),u=Math.max(m,u),p=Math.max(y,p),d+=i;for(var g=1;g<v;g++,d+=i){var _=a[d],b=a[d+1];m+=_,y+=b,_<0&&(s=Math.min(s,m)),_>0&&(u=Math.max(u,m)),b<0?c=Math.min(c,y):b>0&&(p=Math.max(p,y))}}return e[0]=s,e[1]=c,e[2]=u,e[3]=p,e},t.hydrateOptimizedGeometry=G,t.removeZMValues=function(e,t,r,n,i,o){var a,s=l(r,n),c=v(r,n,i,o),u=t.coords;e.coords.length=0,e.lengths.length=0,(a=e.lengths).push.apply(a,t.lengths);for(var p=0;p<u.length;p+=s)c(e.coords,u,e.coords.length,p,u[p],u[p+1]);return e},t.removeCollinearVectices=function(e,t,r,n,i){if(!t||!t.coords||!t.coords.length)return null;for(var o=u[r],a=t.coords,s=t.lengths,c=v(n,i,n,i),p=l(n,i),d=0,h=0,f=0,m=0,y=0,g=s;y<g.length;y++){var _=g[y];h=m,c(e.coords,a,h,d,a[d],a[d+1]);var b=a[d+=p],x=a[d+1],w=b,S=x,P=x/b;h+=p,c(e.coords,a,h,d,w,S),d+=p;for(var T=2;T<_;T++){b=a[d];var O=(x=a[d+1])/b,C=P===O||!isFinite(P)&&!isFinite(O),M=C&&isFinite(O)?P>=0&&O>=0||P<=0&&O<=0:S>=0&&x>=0||S<=0&&x<=0;C&&M?(w+=b,S+=x):(w=b,S=x,h+=p),c(e.coords,a,h,d,w,S),d+=p,P=O}var A=((h+=p)-m)/p;A>=o&&(e.lengths[f]=A,m=h,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(151),r(857),r(619),r(1511),r(233),r(161)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationalLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.title="Layer",t}return r.__extends(t,e),t.prototype.writeListMode=function(e,t,r,n){(n&&"ground"===n.layerContainerType||e&&a.willPropertyWrite(this,r,{},n))&&(t[r]=e)},t.prototype.writeOperationalLayerType=function(e,t){e&&(t.layerType=e)},t.prototype.writeTitle=function(e,t){t.title=e||"Layer"},t.prototype.read=function(t,r){var n=this;r&&(r.layer=this),o.readLoadable(this,t,(function(r){return e.prototype.read.call(n,t,r)}),r)},t.prototype.write=function(t,i){if(i&&i.origin){var o=i.origin+"/"+(i.layerContainerType||"operational-layers"),a=s.supportedTypes[o],l=a&&a[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===o&&(l=!1),!l)return i.messages&&i.messages.push(new n("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+o+"'",{layer:this})),null}var c=e.prototype.write.call(this,t,r.__assign(r.__assign({},i),{layer:this})),u=!!i&&!!i.messages&&!!i.messages.filter((function(e){return e instanceof n&&"web-document-write:property-required"===e.name})).length;return!this.url&&u?null:c},t.prototype.beforeSave=function(){},r.__decorate([i.property({json:{read:!1,write:!1,origins:{"web-map":{default:"normal",read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),r.__decorate([i.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),r.__decorate([i.property({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),r.__decorate([i.writer("listMode")],t.prototype,"writeListMode",null),r.__decorate([i.property({type:String,readOnly:!0,json:{write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),r.__decorate([i.writer("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),r.__decorate([i.property(l.opacity)],t.prototype,"opacity",void 0),r.__decorate([i.property({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"title",void 0),r.__decorate([i.writer("title")],t.prototype,"writeTitle",null),r.__decorate([i.property({type:Boolean,json:{name:"visibility",origins:{"web-document":{name:"visibility",default:!0},"portal-item":{name:"visibility",read:{source:["visible","visibility"]}}}}})],t.prototype,"visible",void 0),r.__decorate([i.subclass("esri.layers.mixins.OperationalLayer")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1172)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(152),r(153),r(161)],void 0===(i=function(e,t,n,i,o,a){var s;function l(){return n.__awaiter(this,void 0,void 0,(function(){var e=this;return n.__generator(this,(function(t){return s||(s=n.__awaiter(e,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e,t){r.e(17).then(function(){var t=[r(1017)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[4,(e=t.sent()).arcade.load()];case 2:return t.sent(),[2,{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}]}}))}))),[2,s]}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.loadArcade=l,t.createLabelExpression=function(e,t,r){return c.create(e,t,r,null,["$feature"])},t.createVVExpression=function(e,t,r){return c.create(e,t,r,null,["$feature","$view"])},t.createRendererExpression=function(e,t,r){return c.create(e,t,r,null,["$feature","$view"])},t.createDictionaryExpression=function(e,t,r,n){return c.create(e,t,r,n,["$feature","$view"])};var c=function(){function e(e,t,r,n,i,o,a){this.evaluate=n,this._syntaxTree=r,this._arcade=e,this._arcadeDictionary=t,this._arcadeFeature=i,this._fields=o,this._spatialReference=a,this._referencesGeometry=e.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}return e.create=function(t,r,s,c,u,p){return n.__awaiter(this,void 0,void 0,(function(){var d,h,f,v,m,y,g,_,b,x,w,S,P,T,O;return n.__generator(this,(function(C){switch(C.label){case 0:return[4,l()];case 1:return d=C.sent(),h=d.arcade,f=d.Feature,v=d.Dictionary,m=i.SpatialReference.fromJSON(r),y=h.parseScript(t,p),g=u.reduce((function(e,t){var r;return n.__assign(n.__assign({},e),((r={})[t]=null,r))}),{}),_=null,o.isSome(c)&&((_=new v(c)).immutable=!0,g.$config=null),b=h.scriptUsesGeometryEngine(y)&&h.enableGeometrySupport(),x=h.scriptUsesFeatureSet(y)&&h.enableFeatureSetSupport(),w=h.scriptIsAsync(y)&&h.enableAsyncSupport(),S={vars:g,spatialReference:m,useAsync:!!w},(P=new v).immutable=!1,P.setField("scale",0),T=h.compileScript(y,S),O=function(e){return"$view"in e&&e.$view&&(P.setField("scale",e.$view.scale),e.$view=P),_&&(e.$config=_),T({vars:e,spatialReference:m})},[4,a.all([b,x,w])];case 2:return C.sent(),[2,new e(h,v,y,O,new f,s,m)]}}))}))},e.prototype.repurposeFeature=function(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this._fields}),this._arcadeFeature},e.prototype.createDictionary=function(){return new this._arcadeDictionary},e.prototype.referencesMember=function(e){return this._arcade.referencesMember(this._syntaxTree,e)},e.prototype.referencesFunction=function(e){return this._arcade.referencesFunction(this._syntaxTree,e)},e.prototype.referencesGeometry=function(){return this._referencesGeometry},e.prototype.referencesScale=function(){return this._referencesScale},e.prototype.extractFieldLiterals=function(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)},e}();t.ArcadeExpression=c,t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182),r(174),r(177),r(156),r(152),r(579),r(782)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=o.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=new n,p=Math.PI;function d(e,t,n){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"color"===e.type}))[0]:e;if(i)if("esri.renderers.visualVariables.ColorVariable"===i.declaredClass){var o="number"==typeof t,s=o?null:t,l=s&&s.attributes,u=o?t:null,p=i.field,d=i.cache,h=d.ipData,f=d.hasExpression,v=i.cache.compiledFunc;if(!p&&!f){var m=i.stops;return m&&m[0]&&m[0].color}if("number"!=typeof u)if(f){if(!a.isSome(n)||!a.isSome(n.arcade))return void c.error("Use of arcade expressions requires an arcade context");var y={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},g=n.arcade.arcadeUtils,b=g.getViewInfo(y),x=g.createExecContext(s,b);if(!v){var w=g.createSyntaxTree(i.valueExpression);v=g.createFunction(w),i.cache.compiledFunc=v}u=g.executeFunction(v,x)}else l&&(u=l[p]);var S=i.normalizationField,P=l?parseFloat(l[S]):void 0;if(null!=u&&(!S||o||!isNaN(P)&&0!==P)){isNaN(P)||o||(u/=P);var T=_(u,h);if(T){var O=T[0],C=T[1],M=O===C?i.stops[O].color:r.blendColors(i.stops[O].color,i.stops[C].color,T[2],a.isSome(n)?n.color:void 0);return new r(M)}}}else c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function h(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"opacity"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.OpacityVariable"===n.declaredClass){var i="number"==typeof t,o=i?null:t,s=o&&o.attributes,l=i?t:null,u=n.field,p=n.cache,d=p.ipData,h=p.hasExpression,f=n.cache.compiledFunc;if(!u&&!h){var v=n.stops;return v&&v[0]&&v[0].opacity}if("number"!=typeof l)if(h){if(a.isNone(r)||a.isNone(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");var m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,g=y.getViewInfo(m),b=y.createExecContext(o,g);if(!f){var x=y.createSyntaxTree(n.valueExpression);f=y.createFunction(x),n.cache.compiledFunc=f}l=y.executeFunction(f,b)}else s&&(l=s[u]);var w=n.normalizationField,S=s?parseFloat(s[w]):void 0;if(null!=l&&(!w||i||!isNaN(S)&&0!==S)){isNaN(S)||i||(l/=S);var P=_(l,d);if(P){var T=P[0],O=P[1];if(T===O)return n.stops[T].opacity;var C=n.stops[T].opacity;return C+(n.stops[O].opacity-C)*P[2]}}}else c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function f(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"rotation"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.RotationVariable"===n.declaredClass){var i=n.axis||"heading",o="heading"===i&&"arithmetic"===n.rotationType?90:0,s="heading"===i&&"arithmetic"===n.rotationType?-1:1,l="number"==typeof t?null:t,u=l&&l.attributes,p=n.field,d=n.cache.hasExpression,h=n.cache.compiledFunc,f=0;if(!p&&!d)return f;if(d){if(a.isNone(r)||a.isNone(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},m=r.arcade.arcadeUtils,y=m.getViewInfo(v),g=m.createExecContext(l,y);if(!h){var _=m.createSyntaxTree(n.valueExpression);h=m.createFunction(_),n.cache.compiledFunc=h}f=m.executeFunction(h,g)}else u&&(f=u[p]||0);return"number"!=typeof f||isNaN(f)?null:o+s*f}c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function v(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"size"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.SizeVariable"===n.declaredClass){var i=g(function(e,t,r){var n="number"==typeof t,i=n?null:t,o=i&&i.attributes,s=n?t:null,u=e.cache.isScaleDriven,p=e.cache.compiledFunc;if(u){var d=a.isSome(r)?r.scale:void 0,h=a.isSome(r)?r.view:void 0;s=null==d||h&&"3d"===h.type?function(e){var t=null,r=null,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):d}else if(!n)switch(e.inputValueType){case"expression":if(a.isNone(r)||a.isNone(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");var f={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,m=v.getViewInfo(f),y=v.createExecContext(i,m);if(!p){var g=v.createSyntaxTree(e.valueExpression);p=v.createFunction(g),e.cache.compiledFunc=p}s=v.executeFunction(p,y);break;case"field":o&&(s=o[e.field]);break;case"unknown":s=null}if(!l.isValidNumber(s))return null;if(n||!e.normalizationField)return s;var _=o?parseFloat(o[e.normalizationField]):null;return l.isValidNumber(_)&&0!==_?s/_:null}(n,t,r),n,t,r,n.cache.ipData);return null==i||isNaN(i)?0:i}c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function m(e,t,r){return null==e?null:l.isSizeVariable(e)?v(e,t,r):l.isValidNumber(e)?e:null}function y(e,t,r){return l.isValidNumber(r)&&e>r?r:l.isValidNumber(t)&&e<t?t:e}function g(e,t,r,n,i){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(m(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){var n=e.stops,i=n&&n.length&&n[0].size;return null==i&&(i=e.minSize),m(i,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){var i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),o=m(t.minSize,r,n),s=m(t.maxSize,r,n),l=a.isSome(n)?n.shape:void 0;if(e<=t.minDataValue)return o;if(e>=t.maxDataValue)return s;if("area"===t.scaleBy&&l){var c="circle"===l,u=c?p*Math.pow(o/2,2):o*o,d=u+i*((c?p*Math.pow(s/2,2):s*s)-u);return c?2*Math.sqrt(d/p):Math.sqrt(d)}return o+i*(s-o)}(e,t,r,n);case"proportional":return function(e,t,r,n){var i=a.isSome(n)?n.shape:void 0,o=e/t.minDataValue,s=m(t.minSize,r,n),l=m(t.maxSize,r,n);return y("circle"===i?2*Math.sqrt(o*Math.pow(s/2,2)):"square"===i||"diamond"===i||"image"===i?Math.sqrt(o*Math.pow(s,2)):o*s,s,l)}(e,t,r,n);case"stops":return function(e,t,r,n,i){var o=_(e,i),a=o[0],s=o[1],l=o[2];if(a===s)return m(t.stops[a].size,r,n);var c=m(t.stops[a].size,r,n);return c+(m(t.stops[s].size,r,n)-c)*l}(e,t,r,n,i);case"real-world-size":return function(e,t,r,n){var i=(a.isSome(n)&&n.resolution?n.resolution:1)*s.meterIn[t.valueUnit],o=m(t.minSize,r,n),l=m(t.maxSize,r,n),c=t.valueRepresentation;return y("area"===c?2*Math.sqrt(e/p)/i:"radius"===c||"distance"===c?2*e/i:e/i,o,l)}(e,t,r,n);case"identity":return e;case"unknown":return null}}function _(e,t){if(t){var r=0,n=t.length-1;return t.some((function(t,i){return e<t?(n=i,!0):(r=i,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}}t.viewScaleRE=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,t.getColor=d,t.getOpacity=h,t.getRotationAngle=f,t.getSize=v,t.getSizeFromNumberOrVariable=m,t.getSizeForValue=g,t.getSizeRangeAtScale=function(e,t,r){var n=e.cache.isScaleDriven,i=r&&"3d"===r.type;if(!(n&&i||t))return null;var o={scale:t,view:r},a=m(e.minSize,u,o),s=m(e.maxSize,u,o);if(null!=a||null!=s){if(a>s){var l=s;s=a,a=l}return{minSize:a,maxSize:s}}},t.getVisualVariableValues=function(e,t,r){if(e.visualVariables){for(var n=[],i=[],o=[],a=[],s=[],l=0,c=e.visualVariables;l<c.length;l++){var u=c[l];switch(u.type){case"color":i.push(u);break;case"opacity":o.push(u);break;case"rotation":s.push(u);break;case"size":a.push(u)}}return i.forEach((function(e){var i=d(e,t,r);n.push({variable:e,value:i})})),o.forEach((function(e){var i=h(e,t,r);n.push({variable:e,value:i})})),s.forEach((function(e){var i=f(e,t,r);n.push({variable:e,value:i})})),a.forEach((function(e){var i=v(e,t,r);n.push({variable:e,value:i})})),n.filter((function(e){return null!=e.value}))}},t.getAllSizes=function(e,t,r){for(var n=["proportional","proportional","proportional"],o=0,a=e;o<a.length;o++){var s=a[o],l=s.useSymbolValue?"symbol-value":v(s,t,r);switch(s.axis){case"width":n[0]=l;break;case"depth":n[1]=l;break;case"height":n[2]=l;break;case"width-and-depth":n[0]=l,n[1]=l;break;case"all":case void 0:case null:n[0]=l,n[1]=l,n[2]=l;break;default:i.neverReached(s.axis)}}return n}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(162),r(160),r(193),r(651),r(195),r(446)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=a.create(),p=l.VertexAttrConstants;t.intersectTriangleGeometry=function(e,t,r,i,o,s,h){var f=c.isInstanceHidden(t),m=r.tolerance;if(!f)if(e.boundingInfo)l.assert("triangle"===e.data.primitiveType),function e(t,r,i,o,s,l){var c=_(r,i,d);if(a.setMin(u,t.getBBMin()),a.setMax(u,t.getBBMax()),n.isSome(s)&&s.applyToAABB(u),b(u,r,c,o)){var p=t.getPrimitiveIndices(),h=t.getIndices(),f=t.getPosition(),m=p?p.length:h.length/3;if(m>S){var y=t.getChildren();if(void 0!==y){for(var g=0;g<8;++g)void 0!==y[g]&&e(y[g],r,i,o,s,l);return}}v(r,i,0,m,h,f,p,s,l)}}(e.boundingInfo,i,o,m,s,h);else{var y=e.getIndices(p.POSITION),g=e.getAttribute(p.POSITION);v(i,o,0,y.length/3,y,g,void 0,s,h)}};var d=o.vec3f64.create(),h=Math.pow(2,-52),f=o.vec3f64.create();function v(e,t,r,i,o,a,s,l,c){var u,p,d;if(s)return function(e,t,r,i,o,a,s,l,c){for(var u,p,d,v=a.data,m=a.offsetIdx,y=a.strideIdx,_=e[0],b=e[1],x=e[2],w=t[0]-_,S=t[1]-b,P=t[2]-x,T=r;T<i;++T){var O=s[T],C=3*O,M=m+y*o[C++],A=v[M++],E=v[M++],I=v[M];M=m+y*o[C++];var R=v[M++],D=v[M++],L=v[M];M=m+y*o[C];var j=v[M++],V=v[M++],F=v[M];n.isSome(l)&&(A=(u=l.applyToVertex(A,E,I))[0],E=u[1],I=u[2],R=(p=l.applyToVertex(R,D,L))[0],D=p[1],L=p[2],j=(d=l.applyToVertex(j,V,F))[0],V=d[1],F=d[2]);var N=R-A,k=D-E,z=L-I,U=j-A,B=V-E,G=F-I,H=S*G-B*P,q=P*U-G*w,W=w*B-U*S,J=N*H+k*q+z*W;if(!(Math.abs(J)<=h)){var Z=_-A,X=b-E,Y=x-I,Q=Z*H+X*q+Y*W;if(J>0){if(Q<0||Q>J)continue}else if(Q>0||Q<J)continue;var K=X*z-k*Y,$=Y*N-z*Z,ee=Z*k-N*X,te=w*K+S*$+P*ee;if(J>0){if(te<0||Q+te>J)continue}else if(te>0||Q+te<J)continue;var re=(U*K+B*$+G*ee)/J;if(re>=0)c(re,g(N,k,z,U,B,G,f),O)}}}(e,t,r,i,o,a,s,l,c);for(var v=a.data,m=a.offsetIdx,y=a.strideIdx,_=e[0],b=e[1],x=e[2],w=t[0]-_,S=t[1]-b,P=t[2]-x,T=r,O=3*r;T<i;++T){var C=m+y*o[O++],M=v[C++],A=v[C++],E=v[C];C=m+y*o[O++];var I=v[C++],R=v[C++],D=v[C];C=m+y*o[O++];var L=v[C++],j=v[C++],V=v[C];n.isSome(l)&&(M=(u=l.applyToVertex(M,A,E))[0],A=u[1],E=u[2],I=(p=l.applyToVertex(I,R,D))[0],R=p[1],D=p[2],L=(d=l.applyToVertex(L,j,V))[0],j=d[1],V=d[2]);var F=I-M,N=R-A,k=D-E,z=L-M,U=j-A,B=V-E,G=S*B-U*P,H=P*z-B*w,q=w*U-z*S,W=F*G+N*H+k*q;if(!(Math.abs(W)<=h)){var J=_-M,Z=b-A,X=x-E,Y=J*G+Z*H+X*q;if(W>0){if(Y<0||Y>W)continue}else if(Y>0||Y<W)continue;var Q=Z*k-N*X,K=X*F-k*J,$=J*N-F*Z,ee=w*Q+S*K+P*$;if(W>0){if(ee<0||Y+ee>W)continue}else if(ee>0||Y+ee<W)continue;var te=(z*Q+U*K+B*$)/W;te>=0&&c(te,g(F,N,k,z,U,B,f),T)}}}t.intersectTriangles=v;var m=o.vec3f64.create(),y=o.vec3f64.create();function g(e,t,r,n,o,a,s){return i.vec3.set(m,e,t,r),i.vec3.set(y,n,o,a),i.vec3.cross(s,m,y),i.vec3.normalize(s,s),s}function _(e,t,r){return i.vec3.set(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function b(e,t,r,n){return x(e,t,r,n,1/0)}function x(e,t,r,n,i){var o=(e[0]-n-t[0])*r[0],a=(e[3]+n-t[0])*r[0],s=Math.min(o,a),l=Math.max(o,a),c=(e[1]-n-t[1])*r[1],u=(e[4]+n-t[1])*r[1];if((l=Math.min(l,Math.max(c,u)))<0)return!1;if((s=Math.max(s,Math.min(c,u)))>l)return!1;var p=(e[2]-n-t[2])*r[2],d=(e[5]+n-t[2])*r[2];return!((l=Math.min(l,Math.max(p,d)))<0)&&!((s=Math.max(s,Math.min(p,d)))>l)&&s<i}function w(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}t.computeNormal=g,t.computeInvDir=_,t.intersectAabbInvDir=b,t.intersectAabbInvDirBefore=x,t.verticalOffsetAtDistance=function(e,t,n,i,o){var a=(n.screenLength||0)*e.pixelRatio;o&&(a=s.scale(a,i,t,o));var l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return r.glClamp(l*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)},t.bindScreenSizePerspective=function(e,t,r){if(e){var n=e.parameters,i=e.paddingPixelsOverride;t.setUniform4f(r,n.divisor,n.offset,n.minPixelSize,i)}},t.copyParameters=function e(t,r){var n=r?e(r):{};for(var i in t){var o=t[i];o&&o.forEach&&(o=w(o)),null==o&&i in n||(n[i]=o)}return n},t.updateParameters=function(e,t){var r=!1;for(var n in t){var i=t[n];void 0!==i&&(r=!0,Array.isArray(i)?e[n]=i.slice():e[n]=i)}return r},t.intersectDrapedRenderLineGeometry=function(e,t,n,i,o){if(t.options.selectionMode){for(var a=e.getAttribute(p.POSITION).data,s=e.getAttribute(p.SIZE),l=s&&s.data[0],c=n[0],u=n[1],d=((l+i)/2+4)*e.pixelRatio,h=Number.MAX_VALUE,f=0;f<a.length-5;f+=3){var v=a[f],m=a[f+1],y=c-v,g=u-m,_=a[f+3]-v,b=a[f+4]-m,x=_*y+b*g,w=_*_+b*b,S=r.clamp(x/w,0,1),P=_*S-y,T=b*S-g,O=P*P+T*T;O<h&&(h=O)}h<d*d&&o()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var S=1e3}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},t.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},t.maxScale=function(e){var t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],n=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(Math.max(t,r),n))},t.scaleFromMatrix=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),o=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return n.vec3.set(e,r,i,o),e},t.makeOrthonormal=function(e,t,r){r=r||e;var i=n.vec3.dot(e,t);n.vec3.set(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),n.vec3.normalize(r,r)},t.tangentFrame=function(e,t,r){Math.abs(e[0])>Math.abs(e[1])?n.vec3.set(t,0,1,0):n.vec3.set(t,1,0,0),n.vec3.cross(r,e,t),n.vec3.normalize(t,t),n.vec3.cross(t,r,e),n.vec3.normalize(r,r)},t.moduloPositive=function(e,t){return(e%t+t)%t},t.cartesianToSpherical=function(e,t){var i=n.vec3.length(e),o=r.asinClamped(e[2]/i),a=Math.atan2(e[1]/i,e[0]/i);return n.vec3.set(t,i,o,a),t},t.sphericalToCartesian=function(e,t){var r=e[0],i=e[1],o=e[2],a=Math.cos(i);n.vec3.set(t,r*a*Math.cos(o),r*a*Math.sin(o),r*Math.sin(i))},t.directionFromTo=function(e,t,r){var n=r[0]-t[0],i=r[1]-t[1],o=r[2]-t[2],a=n*n+i*i+o*o;return a?(a=1/Math.sqrt(a),e[0]=n*a,e[1]=i*a,e[2]=o*a,e):(e[0]=0,e[1]=0,e[2]=0,e)},t.bilerp=function(e,t,r,n,i,o){var a=e+(t-e)*i;return a+(r+(n-r)*i-a)*o},t.slerp=function(e,t,r,o){void 0===o&&(o=i.vec3f64.create());var a=n.vec3.length(e),s=n.vec3.length(t),l=n.vec3.dot(e,t)/(a*s);if(l<.9999999999999999){var c=Math.acos(l),d=((1-r)*a+r*s)/Math.sin(c),h=d/a*Math.sin((1-r)*c),f=d/s*Math.sin(r*c);return n.vec3.scale(u,e,h),n.vec3.scale(p,t,f),n.vec3.add(o,u,p)}return n.vec3.lerp(o,e,t,r)},t.angle=function(e,t,i){e=n.vec3.normalize(u,e),t=n.vec3.normalize(p,t);var o=r.acosClamped(n.vec3.dot(e,t));if(i){var a=n.vec3.cross(c,e,t);if(n.vec3.dot(a,i)<0)return-o}return o},t.makePiecewiseLinearFunction=function(e){var t=e.length;return function(r){if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];for(var n=1;r>e[n][0];)n++;var i=e[n-1][0],o=e[n][0],a=(o-r)/(o-i);return a*e[n-1][1]+(1-a)*e[n][1]}},t.vectorEquals=function(e,t){if(null==e||null==t)return e!==t;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0};var o=function(){function e(e,t){this.min=e,this.max=t,this.range=t-e}return e.prototype.ndiff=function(e,t){return void 0===t&&(t=0),Math.ceil((e-t)/this.range)*this.range+t},e.prototype._normalize=function(e,t,r,n,i){return void 0===n&&(n=0),void 0===i&&(i=!1),(r-=n)<e?r+=this.ndiff(e-r):r>t&&(r-=this.ndiff(r-t)),i&&r===t&&(r=e),r+n},e.prototype.normalize=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=!1),this._normalize(this.min,this.max,e,t,r)},e.prototype.clamp=function(e,t){return void 0===t&&(t=0),r.clamp(e-t,this.min,this.max)+t},e.prototype.monotonic=function(e,t,r){return e<t?t:t+this.ndiff(e-t,r)},e.prototype.minimalMonotonic=function(e,t,r){return this._normalize(e,e+this.range,t,r)},e.prototype.center=function(e,t,r){return t=this.monotonic(e,t,r),this.normalize((e+t)/2,r)},e.prototype.diff=function(e,t,r){return this.monotonic(e,t,r)-e},e.prototype.shortestSignedDiff=function(e,t){e=this.normalize(e);var r=(t=this.normalize(t))-e,n=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(r)<Math.abs(n)?r:n},e.prototype.contains=function(e,t,r){return t=this.minimalMonotonic(e,t),(r=this.minimalMonotonic(e,r))>e&&r<t},e}();t.Cyclical=o,t.planeFromPoints=function(e,t,r,i){n.vec3.subtract(a,t,e),n.vec3.subtract(s,r,e),n.vec3.cross(i,a,s),n.vec3.normalize(i,i),i[3]=-n.vec3.dot(e,i)};var a=i.vec3f64.create(),s=i.vec3f64.create();function l(e){for(var t in e){var r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}t.cyclical2PI=l(new o(0,2*Math.PI)),t.cyclicalPI=l(new o(-Math.PI,Math.PI)),t.cyclicalDeg=l(new o(0,360));var c=i.vec3f64.create(),u=i.vec3f64.create(),p=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(210),r(198)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),a=function(){function e(){this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new p,this.extensions=new d,this.defines=new h,this._includedModules=new Map}return e.prototype.include=function(e,t){this._includedModules.has(e)?this._includedModules.get(e)!==t&&o.error("Trying to include shader module multiple times with different sets of options."):(this._includedModules.set(e,t),"shaderModule"in e?e.shaderModule(this,t):e(this,t))},e.prototype.generateSource=function(e){var t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,o=i.uniforms.generateSource(),a=i.code.generateSource(),s="vertex"===e?v:f,l=this.defines.generateSource().concat(i.defines.generateSource());return"\n"+t.join("\n")+"\n\n"+l.join("\n")+"\n\n"+s+"\n\n"+o.join("\n")+"\n\n"+r.join("\n")+"\n\n"+n.join("\n")+"\n\n"+a.join("\n")},e}();t.ShaderBuilder=a;var s=function(){function e(){this._entries=new Array,this._set=new Set}return e.prototype.add=function(e,t,r){var n=e+"_"+t+"_"+r;return this._set.has(n)||(this._entries.push([e,t,r]),this._set.add(n)),this},e.prototype.generateSource=function(){return this._entries.map((function(e){return"uniform "+e[1]+" "+e[0]+((t=e[2])?"["+t+"]":"")+";";var t}))},e}(),l=function(){function e(){this._entries=new Array}return e.prototype.add=function(e){this._entries.push(e)},e.prototype.generateSource=function(){return this._entries},e}(),c=function(){this.uniforms=new s,this.code=new l,this.defines=new h},u=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute "+e[1]+" "+e[0]+";"}))},e}(),p=function(){function e(){this._entries=new Array}return e.prototype.add=function(e,t){this._entries.push([e,t])},e.prototype.generateSource=function(){return this._entries.map((function(e){return"varying "+e[1]+" "+e[0]+";"}))},e}(),d=function(){function e(){this._entries=new Set}return e.prototype.add=function(e){this._entries.add(e)},e.prototype.generateSource=function(t){var r="vertex"===t?e.WHITELIST_VERTEX:e.WHITELIST_FRAGMENT;return i.valuesOfSet(this._entries).filter((function(e){return r.indexOf(e)>=0})).map((function(e){return"#extension "+e+" : enable"}))},e.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],e.WHITELIST_VERTEX=[],e}(),h=function(){function e(){this._entries=new Map}return e.prototype.addInt=function(e,t){var r=t%1==0?t.toFixed(0):t.toString();this._entries.set(e,r)},e.prototype.addFloat=function(e,t){var r=t%1==0?t.toFixed(1):t.toString();this._entries.set(e,r)},e.prototype.generateSource=function(){return n.pairsOfMap(this._entries).map((function(e){return"#define "+e[0]+" "+e[1]}))},e}(),f="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._module=e,this._loadModule=t}return e.prototype.get=function(){return this._module},e.prototype.reload=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,this._loadModule()];case 1:return e._module=t.sent(),[2,this._module]}}))}))},e}();t.ReloadableShaderModule=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(169)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.referenceSetter=function(e,t,n){return void 0===n&&(n=r),t||(t=new n),t===e||(t.removeAll(),function(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}(e)?t.addMany(e):e&&t.add(e)),t},t.castForReferenceSetter=function(e){return e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function n(e){return e.toLowerCase().trim()}return function(){function e(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],e){for(var t=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a&&a.name;if(s){var l=n(s);this._fieldsMap.set(s,a),this._fieldsMap.set(l,a),t.push(l),r(a)&&(this.dateFields.push(a),this._dateFieldsSet.add(a))}}t.sort(),this.uid=t.join(",")}}return e.prototype.destroy=function(){this._fieldsMap.clear()},e.prototype.has=function(e){return null!=this.get(e)},e.prototype.get=function(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(n(e)):void 0},e.prototype.isDateField=function(e){return this._dateFieldsSet.has(this.get(e))},e.prototype.normalizeFieldName=function(e){var t=this.get(e);if(t)return t.name},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(189),r(646),r(175)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){t.linearDepth?e.vertex.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye = view * vec4(pos, 1.0);\n      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])))):e.vertex.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=a,function(e){function t(e,t,r){n.mat4.translate(c,r,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",c)}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,r){t(e,r.origin,r.view)}}(a=t.Transform||(t.Transform={}));var s,l,c=i.mat4f32.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){t&&(this._config=function(e){var t=e.__proto__.__configurationParameters||[],r={};r.key=e.key;for(var n=0,i=t;n<i.length;n++){var o=i[n];r[o]=e[o]}return r}(t)),this._program=this.initializeProgram(e),e.commonUniformStore&&(this._commonUniformStore=e.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program)),this._pipeline=this.initializePipeline(e)}return e.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)},e.prototype.reload=function(e){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose()),this._program=this.initializeProgram(e),this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)},Object.defineProperty(e.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._config.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.bindPass=function(e,t,r){},e.prototype.bindMaterial=function(e,t,r){},e.prototype.bindDraw=function(e,t,r){},e.prototype.bindPipelineState=function(e){e.setPipelineState(this.pipeline)},e.prototype.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)},Object.defineProperty(e.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,configurable:!0}),e}();t.ShaderTechnique=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(366),r(477),r(858),r(517),r(859)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=r.formatDate,t.convertDateFormatToIntlOptions=r.convertDateFormatToIntlOptions,t.formatNumber=n.formatNumber,t.convertNumberFormatToIntlOptions=n.convertNumberFormatToIntlOptions,t.substitute=i.substitute,t.getLocale=o.getLocale,t.setLocale=o.setLocale,t.onLocaleChange=o.onLocaleChange,t.prefersRTL=o.prefersRTL,t.loadMessageBundle=a.loadMessageBundle,t.getKnownMessageBundleLocale=a.getKnownMessageBundleLocale}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(184),r(215),r(202),r(170),r(623),r(861)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.paths=[],n.type="polyline",n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t){var r,n,i,o=null;return e&&!Array.isArray(e)?(o=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,n=e.hasM):o=e,o=o||[],t=t||l.WGS84,o.length&&o[0]&&null!=o[0][0]&&"number"==typeof o[0][0]&&(o=[o]),(i=o[0]&&o[0][0])&&(void 0===r&&void 0===n?(r=i.length>2,n=!1):void 0===r?r=!n&&i.length>3:void 0===n&&(n=!r&&i.length>3)),{paths:o,spatialReference:t,hasZ:r,hasM:n}},Object.defineProperty(t.prototype,"extent",{get:function(){var e=this.spatialReference,t=c.getPolylineExtent(this);if(!t)return null;var r=new o(t);return r.spatialReference=e,r},enumerable:!0,configurable:!0}),t.prototype.writePaths=function(e,t){t.paths=n.clone(this.paths)},t.prototype.addPath=function(e){if(e){this.clearCache();var t=this.paths,r=t.length;if(function(e){return!Array.isArray(e[0])}(e)){for(var n=[],i=0,o=e.length;i<o;i++)n[i]=e[i].toArray();t[r]=n}else t[r]=e.concat();return this}},t.prototype.clone=function(){var e=new a;return e.spatialReference=this.spatialReference,e.paths=n.clone(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e},t.prototype.getPoint=function(e,t){if(!this._validateInputs(e,t))return null;var r=this.paths[e][t],n=this.hasZ,i=this.hasM;return n&&!i?new s(r[0],r[1],r[2],void 0,this.spatialReference):i&&!n?new s(r[0],r[1],void 0,r[2],this.spatialReference):n&&i?new s(r[0],r[1],r[2],r[3],this.spatialReference):new s(r[0],r[1],this.spatialReference)},t.prototype.insertPoint=function(e,t,r){return this._validateInputs(e,t,!0)?(this.clearCache(),u.updateSupportFromPoint(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this):this},t.prototype.removePath=function(e){if(!this._validateInputs(e,null))return null;this.clearCache();var t=this.paths.splice(e,1)[0],r=this.spatialReference;return t.map((function(e){return new s(e,r)}))},t.prototype.removePoint=function(e,t){return this._validateInputs(e,t)?(this.clearCache(),new s(this.paths[e].splice(t,1)[0],this.spatialReference)):null},t.prototype.setPoint=function(e,t,r){return this._validateInputs(e,t)?(this.clearCache(),u.updateSupportFromPoint(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this):this},t.prototype._validateInputs=function(e,t,r){if(void 0===r&&(r=!1),null==e||e<0||e>=this.paths.length)return!1;if(null!=t){var n=this.paths[e];if(r&&(t<0||t>n.length))return!1;if(!r&&(t<0||t>=n.length))return!1}return!0},t.prototype.toJSON=function(e){return this.write(null,e)},r.__decorate([i.property({dependsOn:["hasM","hasZ","paths"]})],t.prototype,"cache",void 0),r.__decorate([i.property({dependsOn:["cache"],readOnly:!0})],t.prototype,"extent",null),r.__decorate([i.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],t.prototype,"paths",void 0),r.__decorate([i.writer("paths")],t.prototype,"writePaths",null),a=r.__decorate([i.subclass("esri.geometry.Polyline")],t)}(a);return p.prototype.toJSON.isDefaultToJSON=!0,p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});t.ShaderTechniqueConfiguration=function(){this.key=0},t.parameter=function(e){return void 0===e&&(e={}),function(t,n){var i=t;i.__configurationParameters=i.__configurationParameters||[],i.__configurationParameters.push(n);var o="_"+n;void 0===i.__configurationParameters__offset&&(i.__configurationParameters__offset=0);var a=i.__configurationParameters__offset,s=e.count||2,l=Math.ceil(r.log2(s)),c=(1<<l)-1<<a;if(i.__configurationParameters__offset+=l,i.__configurationParameters__offset>=32)throw new Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+i.__configurationParameters__offset+")");Object.defineProperty(i,n,{get:function(){return this[o]},set:function(e){this.key=this.key&~c|e<<a&c,this[o]=e}})}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_VISIBLE=!1,t.DECONFLICTOR_SHOW_INVISIBLE=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_DEBUG_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TERRAIN_DEBUG_POPUP=!1,t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.I3S_TREE_SHOW_TILES=!1,t.I3S_SHOW_MODIFICATIONS=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),r.__decorate([i.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),r.__decorate([i.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),r.__decorate([i.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),r.__decorate([i.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),r.__decorate([i.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),r.__decorate([i.property()],t.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),r.__decorate([i.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),r.__decorate([i.property()],t.prototype,"TERRAIN_DEBUG_POPUP",void 0),r.__decorate([i.property()],t.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),r.__decorate([i.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"I3S_TREE_SHOW_TILES",void 0),r.__decorate([i.property()],t.prototype,"I3S_SHOW_MODIFICATIONS",void 0),r.__decorate([i.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),r.__decorate([i.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),r.__decorate([i.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),r.__decorate([i.property()],t.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),r.__decorate([i.subclass("esri.views.3d.support.DebugFlags")],t)}(n))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(189),r(185),r(216),r(160),r(245),r(201),r(193),r(173),r(862),r(427),r(207),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){function m(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=h.getPointOnPath(t,h.getPathLength(t)/2);return f.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function y(e,t,r){var n=r?e:f.clonePoint(e);return t&&e?v.pointToPoint(e,n,t)?n:null:n}function g(e){if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t++)if(!g(r[t]))return!1;return!0}return null==e||e>=0}Object.defineProperty(t,"__esModule",{value:!0}),t.computeCentroid=function(e,t){if("point"===e.type)return y(e,t,!1);if(f.isHydratedGeometry(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(m(e),t,!0);case"mesh":return y(e.extent.center,t,!1)}else switch(e.type){case"extent":return y(function(e){var t=r.isFinite(e.zmin);return f.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=d.ringsCentroid(e.rings,e.hasZ);return f.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return y(m(e),t,!0)}},t.enlargeExtent=function(e,t,r){if(e){t||(t=p.create());var n=e,i=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?i+=o/20:n.height<1e-7*n.width&&(o+=i/20),l.vec4.set(t,n.xmin-i,n.ymin-o,n.xmax+i,n.ymax+o),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var n=e.geometries[r].data.vertexAttributes.auxpos1;n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=c.vec4f64.clone(c.vec4f64.ONES);return n.isSome(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),n.isSome(t)?r[3]=t:n.isSome(e)&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,i,o,a){void 0===a&&(a=[0,0,0,0]);for(var s=0;s<3;++s)n.isSome(e)&&null!=e[s]?a[s]=e[s]:n.isSome(r)&&null!=r[s]?a[s]=r[s]:a[s]=o[s];return n.isSome(t)?a[3]=t:n.isSome(i)?a[3]=i:a[3]=o[3],a},t.computeObjectScale=function(e,t,r,n){void 0===e&&(e=s.vec3f64.ONES),void 0===n&&(n=1);var i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{for(var o=void 0,a=0,l=2;l>=0;l--){var c=e[l],u=void 0,p=null!=c,d=0===l&&!o&&!p,h=r[l];"symbol-value"===c||d?u=0!==h?t[l]/h:1:p&&"proportional"!==c&&isFinite(c)&&(u=0!==h?c/h:1),null!=u&&(i[l]=u,o=u,a=Math.max(a,Math.abs(u)))}for(l=2;l>=0;l--)null==i[l]?i[l]=o:0===i[l]&&(i[l]=.001*a)}for(l=2;l>=0;l--)i[l]/=n;return s.vec3f64.fromArray(i)},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,n=t.width,i=t.depth,o=t.height,a=r?10:1;if(null==n&&null==o&&null==i)return[a*e[0],a*e[1],a*e[2]];for(var l,c=s.vec3f64.fromValues(n,i,o),u=0;u<3;u++){var p=c[u];if(null!=p){l=p/e[u];break}}for(u=0;u<3;u++)null==c[u]&&(c[u]=e[u]*l);return c},t.validateSymbolLayerSize=function(e){return null!=e.isPrimitive&&(e=[e.width,e.depth,e.height]),g(e)?null:"Symbol sizes may not be negative values"},t.isValidSize=g,t.computeObjectRotation=function(e,t,r,n){void 0===n&&(n=o.mat4f64.create());var a=e||0,s=t||0,l=r||0;return 0!==a&&i.mat4.rotateZ(n,n,-a/180*Math.PI),0!==s&&i.mat4.rotateX(n,n,s/180*Math.PI),0!==l&&i.mat4.rotateY(n,n,l/180*Math.PI),n},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:u.isPoint(e)?t.minDemResolutionForPoints:.01*u.maximumDimension(e)},t.namedAnchorToHUDMaterialAnchorPos={"bottom-left":a.vec2f64.fromValues(0,0),bottom:a.vec2f64.fromValues(.5,0),"bottom-right":a.vec2f64.fromValues(1,0),left:a.vec2f64.fromValues(0,.5),center:a.vec2f64.fromValues(.5,.5),right:a.vec2f64.fromValues(1,.5),"top-left":a.vec2f64.fromValues(0,1),top:a.vec2f64.fromValues(.5,1),"top-right":a.vec2f64.fromValues(1,1)}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1097)],void 0===(i=function(e,t,r,n){var i=function(e){function t(r,n,i){var o=e.call(this,r,n,i)||this;return o instanceof t?o:new t(r,n,i)}return r.__extends(t,e),t}(n);return i.prototype.type="warning",i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleRangeLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minScale=0,t.maxScale=0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"scaleRangeId",{get:function(){return this.minScale+","+this.maxScale},enumerable:!0,configurable:!0}),r.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),r.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),r.__decorate([n.property({readOnly:!0,dependsOn:["minScale","maxScale"]})],t.prototype,"scaleRangeId",null),r.__decorate([n.subclass("esri.layers.mixins.ScaleRangeLayer")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(174),r(169),r(487),r(154),r(164),r(156),r(152),r(153),r(171),r(157),r(305),r(151),r(1143),r(909),r(1528),r(1529),r(1561),r(1575),r(643),r(1159),r(1576),r(1589),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T){var O,C,M,A,E,I=c.getLogger("esri.views.MapView");function R(e,t,r){if(e)if(Array.isArray(e)||o.isCollection(e)){if(0===e.length)return;e.forEach((function(e){return R(e,t,r)}))}else!function(e){return e instanceof i}(e)?r.add(e):t.add(e)}return function(e){function t(t){var r=e.call(this,t)||this;return r._magnifierView=null,r._stage=null,r._resolveWhenReady=[],r.rootLayerViews=new a({root:r,rootCollectionNames:["basemapView.baseLayerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:function(e){return null}}),r.graphicsView=null,r.highlightOptions=new x,r.magnifier=new g,r.inputManager=new b({view:r}),r.mapViewNavigation=null,r.supersampleScreenhotsEnabled=!0,r.ui=new P,r.rendering=!1,f.initialize(),r}return n.__extends(t,e),t.prototype.destroy=function(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)},Object.defineProperty(t.prototype,"background",{get:function(){return this.get("map.initialViewProperties.background")||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureManager",{get:function(){return this._stage.painter.textureManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigating",{get:function(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)},enumerable:!0,configurable:!0}),t.prototype.toMap=function(t){if(d.isSupportedScreenPointEvent(t)){var r=d.createScreenPointFromSupportedEvent(this,t);return e.prototype.toMap.call(this,r)}return e.prototype.toMap.call(this,t)},t.prototype.hitTest=function(e,t){var r=d.isSupportedScreenPointEvent(e)?d.createScreenPointFromSupportedEvent(this,e):e;if(!this.ready||isNaN(r.x)||isNaN(r.y))return p.resolve({screenPoint:r,results:[]});var n=this.toMap(r),i=[this.graphicsView];i.push.apply(i,this.allLayerViews.toArray().reverse());var o=new Set,a=new Set,s=new Set,l=new Set;return t&&(R(t&&t.include,o,s),R(t&&t.exclude,a,l)),p.all(i.map((function(e){return!e||!e.hitTest||s.size>0&&!e.layer||s.size>0&&e.layer&&!s.has(e.layer)||l.size>0&&e.layer&&l.has(e.layer)?null:e.hitTest(r.x,r.y)}))).then((function(e){return{screenPoint:r,results:e.filter((function(e){return null!=e&&(!(o.size>0)||o.has(e))&&(!(a.size>0)||!a.has(e))})).map((function(e){return{mapPoint:n,graphic:e}}))}}))},t.prototype.takeScreenshot=function(e){return this.ready?this._stage.takeScreenshot(w.toRenderSettings(e,this),this.allLayerViews):p.reject("Map view cannot be used before it is ready")},t.prototype.on=function(t,r,n,i){return this.inputManager&&this.viewEvents.on(t,r,n,i)||e.prototype.on.call(this,t,r)},t.prototype.hasEventListener=function(t){return e.prototype.hasEventListener.call(this,t)||this.viewEvents.hasHandler(t)},t.prototype.whenLayerView=function(t){return e.prototype.whenLayerView.call(this,t)},t.prototype.graphicChanged=function(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)},t.prototype.whenReady=function(){var e=this;return p.create((function(t){e.ready?t(e):e._resolveWhenReady.push(t)}))},t.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()},t.prototype.validate=function(){var e=S.check({checkMajorWebPerformanceCaveat:!1});return l("safari")&&l("safari")<9&&(e=new s("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:l("safari")})),u.isSome(e)?(I.warn("#validate()",e.message),p.reject(e)):function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,a,s,l;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,Promise.all([new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(204)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(85)]).then(function(){var t=[r(2082)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){Promise.all([r.e(2),r.e(3)]).then(function(){var t=[r(186)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))])];case 1:return e=n.sent(),t=e[1],i=t.GraphicsView2D,o=t.LabelManager,a=t.MapViewNavigation,s=t.MagnifierView2D,l=e[2].Stage,C=i,M=o,A=a,E=s,O=l,[2]}}))}))}()},t.prototype._startup=function(){var t=this;this.timeline.begin("MapView Startup"),e.prototype._startup.call(this),this.graphics.owner=this;var r={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},n=new O(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled,contextOptions:r,renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new C({view:this,graphics:this.graphics,requestUpdateCallback:function(){return t.requestUpdate()}}),o=new A({view:this,animationManager:this.animationManager}),a=new M({view:this});this._magnifierView=new E,this._magnifierView.magnifier=this.magnifier,this._stage=n,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",o),this._set("labelManager",a),this.handles.add([this.rootLayerViews.on("change",(function(){return t._updateStageChildren()})),n.on("post-render",(function(){return t._set("rendering",n.renderRequested)})),n.on("will-render",(function(){return t._set("rendering",n.renderRequested)})),n.on("webgl-error",(function(e){return t.fatalError=e.error})),h.init(this,"stationary",(function(e){return n.stationary=e}),!0),h.init(this,"state.id",(function(){return n.state=t.state}),!0),h.init(this,"background",(function(e){return n.background=e}),!0),h.init(this,"magnifier",(function(e){return t._magnifierView.magnifier=e}),!0),h.init(this,"renderingOptions",(function(e){return n.renderingOptions=e}),!0),h.init(this,"highlightOptions",(function(){return n.highlightOptions=t.highlightOptions}),!0)],"map-view"),n.state=this.state,n.background=this.background,this._updateStageChildren();var s=this._resolveWhenReady;this._resolveWhenReady=[],s.forEach((function(e){return e(t)})),this.timeline.end("MapView Startup")},t.prototype._teardown=function(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,e.prototype._teardown.call(this)},t.prototype._updateStageChildren=function(){var e=this;this._stage.removeAllChildren(),this.rootLayerViews.forEach((function(t){e._stage.addChild(t.container)}));var t=this.graphicsView;this._stage.addChild(t.container),this._stage.addChild(this._magnifierView)},n.__decorate([v.property({type:T,dependsOn:["map.initialViewProperties?.background"]})],t.prototype,"background",null),n.__decorate([v.property()],t.prototype,"graphicsView",void 0),n.__decorate([v.property({type:x})],t.prototype,"highlightOptions",void 0),n.__decorate([v.property({type:g})],t.prototype,"magnifier",void 0),n.__decorate([v.property({readOnly:!0})],t.prototype,"inputManager",void 0),n.__decorate([v.property({readOnly:!0})],t.prototype,"textureManager",null),n.__decorate([v.property({readOnly:!0})],t.prototype,"mapViewNavigation",void 0),n.__decorate([v.property({dependsOn:["mapViewNavigation.interacting"],type:Boolean})],t.prototype,"navigating",null),n.__decorate([v.property({type:Boolean,constructOnly:!0})],t.prototype,"supersampleScreenhotsEnabled",void 0),n.__decorate([v.property({type:P})],t.prototype,"ui",void 0),n.__decorate([v.property({readOnly:!0})],t.prototype,"rendering",void 0),n.__decorate([v.property({constructOnly:!0})],t.prototype,"renderCanvas",void 0),n.__decorate([v.property({constructOnly:!0})],t.prototype,"deactivatedWebGLExtensions",void 0),n.__decorate([v.property({constructOnly:!0})],t.prototype,"debugWebGLExtensions",void 0),n.__decorate([v.subclass("esri.views.MapView")],t)}(m.BreakpointsOwner(y.DOMContainer(_)))}.apply(null,n))||(e.exports=i)},,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function n(e,t,n){if(!r(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,n);if(Array.isArray(t)){for(var i=t.slice(),o=0,a=i;o<a.length;o++){var s=a[o];e.addEventListener(s,n)}return{remove:function(){for(var t=0,r=i;t<r.length;t++){var o=r[t];e.removeEventListener(o,n)}}}}return e.addEventListener(t,n),{remove:function(){e.removeEventListener(t,n)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.isEventTarget=r,t.on=n,t.once=function(e,t,i){if(!r(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);var o=n(e,t,(function(t){o.remove(),i.call(e,t)}));return{remove:function(){o.remove()}}},t.pausable=function(e,t,r){var i=!1,o=n(e,t,(function(t){i||r.call(e,t)}));return{resume:function(){i=!1},pause:function(){i=!0},remove:function(){o.remove()}}},t.ieKeyNormalizationMap={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"},t.eventKey=function(e){var r=e.key;return t.ieKeyNormalizationMap[r]||r}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(165),r(172)],void 0===(i=function(e,t,r,n){function i(t){return n.join(e.toUrl("."),"../",t)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAsset=function(e,t){return r(i(e),t)},t.getAssetUrl=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1552)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(258),r(336),r(165),r(154),r(155),r(118),r(323),r(152),r(153),r(151),r(179),r(184),r(624),r(867),r(771),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){var b,x={PortalGroup:function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(772)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},PortalItem:function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(283)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},PortalUser:function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(771)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}};return function(e){function t(t){var r=e.call(this,t)||this;return r.access=null,r.allSSL=!1,r.authMode="auto",r.authorizedCrossOriginDomains=null,r.basemapGalleryGroupQuery=null,r.bingKey=null,r.canListApps=!1,r.canListData=!1,r.canListPreProvisionedItems=!1,r.canProvisionDirectPurchase=!1,r.canSearchPublic=!0,r.canShareBingPublic=!1,r.canSharePublic=!1,r.canSignInArcGIS=!1,r.canSignInIDP=!1,r.colorSetsGroupQuery=null,r.commentsEnabled=!1,r.created=null,r.culture=null,r.customBaseUrl=null,r.defaultBasemap=null,r.defaultExtent=null,r.defaultVectorBasemap=null,r.description=null,r.eueiEnabled=null,r.featuredGroups=null,r.featuredItemsGroupQuery=null,r.galleryTemplatesGroupQuery=null,r.livingAtlasGroupQuery=null,r.hasCategorySchema=!1,r.helperServices=null,r.homePageFeaturedContent=null,r.homePageFeaturedContentCount=null,r.httpPort=null,r.httpsPort=null,r.id=null,r.ipCntryCode=null,r.isPortal=!1,r.isReadOnly=!1,r.layerTemplatesGroupQuery=null,r.maxTokenExpirationMinutes=null,r.modified=null,r.name=null,r.portalHostname=null,r.portalMode=null,r.portalProperties=null,r.region=null,r.rotatorPanels=null,r.showHomePageDescription=!1,r.sourceJSON=null,r.supportsHostedServices=!1,r.symbolSetsGroupQuery=null,r.templatesGroupQuery=null,r.units=null,r.url=i.portalUrl,r.urlKey=null,r.user=null,r.useStandardizedQuery=!1,r.useVectorBasemaps=!1,r.vectorBasemapGalleryGroupQuery=null,r}var c;return n.__extends(t,e),c=t,t.prototype.normalizeCtorArgs=function(e){return"string"==typeof e?{url:e}:e},t.prototype.destroy=function(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)},t.prototype.readAuthorizedCrossOriginDomains=function(e){if(e)for(var t=0,r=e;t<r.length;t++){var n=r[t];-1===i.request.trustedServers.indexOf(n)&&i.request.trustedServers.push(n)}return e},t.prototype.readDefaultBasemap=function(e){if(e){var t=b.fromJSON(e);return t.portalItem={portal:this},t}return null},t.prototype.readDefaultVectorBasemap=function(e){if(e){var t=b.fromJSON(e);return t.portalItem={portal:this},t}return null},Object.defineProperty(t.prototype,"extraQuery",{get:function(){var e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?" AND orgid:"+this.id:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOrganization",{get:function(){return!!this.access},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"restUrl",{get:function(){var e=this.url;if(e){var t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailUrl",{get:function(){var e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null},enumerable:!0,configurable:!0}),t.prototype.readUrlKey=function(e){return e?e.toLowerCase():e},t.prototype.readUser=function(e){var t=null;return e&&((t=_.fromJSON(e)).portal=this),t},t.prototype.load=function(e){var t=this,n=new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(488)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(t){h.throwIfAborted(e),b=t})).then((function(){return t.sourceJSON?t.sourceJSON:t._fetchSelf(t.authMode,!1,e)})).then((function(e){if(a.id){var r=a.id;t.credential=r.findCredential(t.restUrl),t.credential||t.authMode!==c.AUTH_MODE_AUTO||(t._esriId_credentialCreateHandle=r.on("credential-create",(function(){r.findCredential(t.restUrl)&&t._signIn()})))}t.sourceJSON=e,t.read(e)}));return this.addResolvingPromise(n),h.resolve(this)},t.prototype.createClosestFacilityTask=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:return t.sent(),e=this._getHelperServiceUrl("closestFacility"),[4,new Promise((function(e,t){r.e(63).then(function(){var t=[r(2034)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return[2,new(t.sent())(e)]}}))}))},t.prototype.createElevationLayers=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.load()];case 1:return n.sent(),e=this._getHelperService("defaultElevationLayers"),[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(452)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return t=n.sent(),[2,e?e.map((function(e){return new t({id:e.id,url:e.url})})):[]]}}))}))},t.prototype.createGeometryService=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:return t.sent(),e=this._getHelperServiceUrl("geometry"),[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1272)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return[2,new(t.sent())({url:e})]}}))}))},t.prototype.createPrintTask=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:return t.sent(),e=this._getHelperServiceUrl("printTask"),[4,new Promise((function(e,t){r.e(51).then(function(){var t=[r(2036)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return[2,new(t.sent())(e)]}}))}))},t.prototype.createRouteTask=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:return t.sent(),e=this._getHelperServiceUrl("route"),[4,new Promise((function(e,t){r.e(58).then(function(){var t=[r(2048)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return[2,new(t.sent())(e)]}}))}))},t.prototype.createServiceAreaTask=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:return t.sent(),e=this._getHelperServiceUrl("serviceArea"),[4,new Promise((function(e,t){r.e(76).then(function(){var t=[r(2051)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:return[2,new(t.sent())(e)]}}))}))},t.prototype.fetchBasemaps=function(e,t){var r=new y;return r.query=e||(this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then((function(e){if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',e.total){var n=e.results[0];return r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc",n.queryItems(r,t)}return null})).then((function(e){return e&&e.total?e.results.filter((function(e){return"Web Map"===e.type})).map((function(e){return new b({portalItem:e})})):[]}))},t.prototype.fetchCategorySchema=function(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then((function(e){return e.categorySchema})):h.isAborted(e)?h.reject(h.createAbortError()):h.resolve([])},t.prototype.fetchFeaturedGroups=function(e){var t=this.featuredGroups,r=new y;if(r.num=100,r.sortField="title",t&&t.length){for(var n=[],i=0,o=t;i<o.length;i++){var a=o[i];n.push('(title:"'+a.title+'" AND owner:'+a.owner+")")}return r.query=n.join(" OR "),this.queryGroups(r,e).then((function(e){return e.results}))}return h.isAborted(e)?h.reject(h.createAbortError()):h.resolve([])},t.prototype.fetchRegions=function(e){var t=this.user&&this.user.culture||this.culture||o.getLocale();return this._request(this.restUrl+"/portals/regions",n.__assign(n.__assign({},e),{query:{culture:t}}))},t.getDefault=function(){return c._default&&!c._default.destroyed||(c._default=new c),c._default},t.prototype.queryGroups=function(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)},t.prototype.queryItems=function(e,t){return this._queryPortal("/search",e,"PortalItem",t)},t.prototype.queryUsers=function(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)},t.prototype.toJSON=function(){throw new l("internal:not-yet-implemented","Portal.toJSON is not yet implemented")},t.fromJSON=function(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new c({sourceJSON:e})},t.prototype._getHelperService=function(e){var t=this.helperServices&&this.helperServices[e];if(!t)throw new l("portal:service-not-found",'The `helperServices` do not include an entry named "'+e+'"');return t},t.prototype._getHelperServiceUrl=function(e){var t=this._getHelperService(e);if(!t.url)throw new l("portal:service-url-not-found",'The `helperServices` entry "'+e+'" does not include a `url` value');return t.url},t.prototype._fetchSelf=function(e,t,r){void 0===e&&(e=this.authMode),void 0===t&&(t=!1);var i=this.restUrl+"/portals/self",a=n.__assign({authMode:e,query:{culture:o.getLocale().toLowerCase()}},r);return"auto"===a.authMode&&(a.authMode="no-prompt"),t&&(a.query.default=!0),this._request(i,a)},t.prototype._queryPortal=function(e,t,r,i){var o=this,a=v.ensureType(y,t),s=function(t){return o._request(o.restUrl+e,n.__assign(n.__assign({},a.toRequestOptions(o)),i)).then((function(e){var r=a.clone();return r.start=e.nextStart,new g({nextQueryParams:r,queryParams:a,total:e.total,results:c._resultsToTypedArray(t,{portal:o},e,i)})})).then((function(e){return h.all(e.results.map((function(t){return"function"==typeof t.when?t.when():e}))).then((function(){return e}),(function(t){return h.throwIfAbortError(t),e}))}))};return r&&x[r]?x[r]().then((function(e){return h.throwIfAborted(i),s(e)})):s()},t.prototype._signIn=function(){var e=this;if(this.authMode===c.AUTH_MODE_ANONYMOUS)return h.reject(new l("portal:invalid-auth-mode",'Current "authMode"\' is "'+this.authMode+'"'));if("failed"===this.loadStatus)return h.reject(this.loadError);var t=function(t){return h.resolve().then((function(){return"not-loaded"===e.loadStatus?(t||(e.authMode="immediate"),e.load().then((function(){return null}))):"loading"===e.loadStatus?e.load().then((function(){return e.credential?null:(e.credential=t,e._fetchSelf("immediate"))})):e.user&&e.credential===t?null:(e.credential=t,e._fetchSelf("immediate"))})).then((function(t){t&&(e.sourceJSON=t,e.read(t))}))};return a.id?a.id.getCredential(this.restUrl).then((function(e){return t(e)})):t(this.credential)},t.prototype._normalizeSSL=function(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")},t.prototype._normalizeUrl=function(e){var t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.indexOf("?")>-1?"&":"?")+"token="+t:e)},t.prototype._requestToTypedArray=function(e,t,n){var i=this,o=function(r){return i._request(e,t).then((function(e){var t=c._resultsToTypedArray(r,{portal:i},e);return h.all(t.map((function(t){return"function"==typeof t.when?t.when():e}))).then((function(){return t}),(function(){return t}))}))};return n?new Promise((function(e,t){Promise.all([r.e(22),r.e(83)]).then(function(){var t=[r(2053)("./"+n)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(e){return o(e)})):o()},t.prototype._request=function(e,t){void 0===t&&(t={});var r=n.__assign({f:"json"},t.query),i=t.authMode,o=void 0===i?this.authMode===c.AUTH_MODE_ANONYMOUS?"anonymous":"auto":i,a=t.body,l=void 0===a?null:a,u=t.cacheBust,p=void 0!==u&&u,d=t.method,h=void 0===d?"auto":d,f=t.responseType,v={authMode:o,body:l,cacheBust:p,method:h,query:r,responseType:void 0===f?"json":f,timeout:0,signal:t.signal};return s(this._normalizeSSL(e),v).then((function(e){return e.data}))},t._resultsToTypedArray=function(e,t,r,n){var i;if(r){var o=d.isSome(n)?n.signal:null;i=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(i=i.map((function(r){var n=u.mixin(e?e.fromJSON(r):r,t);return"function"==typeof n.load&&n.load(o),n})))}else i=[];return i},t.AUTH_MODE_ANONYMOUS="anonymous",t.AUTH_MODE_AUTO="auto",t.AUTH_MODE_IMMEDIATE="immediate",n.__decorate([f.property()],t.prototype,"access",void 0),n.__decorate([f.property()],t.prototype,"allSSL",void 0),n.__decorate([f.property()],t.prototype,"authMode",void 0),n.__decorate([f.property()],t.prototype,"authorizedCrossOriginDomains",void 0),n.__decorate([f.reader("authorizedCrossOriginDomains")],t.prototype,"readAuthorizedCrossOriginDomains",null),n.__decorate([f.property()],t.prototype,"basemapGalleryGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"bingKey",void 0),n.__decorate([f.property()],t.prototype,"canListApps",void 0),n.__decorate([f.property()],t.prototype,"canListData",void 0),n.__decorate([f.property()],t.prototype,"canListPreProvisionedItems",void 0),n.__decorate([f.property()],t.prototype,"canProvisionDirectPurchase",void 0),n.__decorate([f.property()],t.prototype,"canSearchPublic",void 0),n.__decorate([f.property()],t.prototype,"canShareBingPublic",void 0),n.__decorate([f.property()],t.prototype,"canSharePublic",void 0),n.__decorate([f.property()],t.prototype,"canSignInArcGIS",void 0),n.__decorate([f.property()],t.prototype,"canSignInIDP",void 0),n.__decorate([f.property()],t.prototype,"colorSetsGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"commentsEnabled",void 0),n.__decorate([f.property({type:Date})],t.prototype,"created",void 0),n.__decorate([f.property()],t.prototype,"credential",void 0),n.__decorate([f.property()],t.prototype,"culture",void 0),n.__decorate([f.property()],t.prototype,"currentVersion",void 0),n.__decorate([f.property()],t.prototype,"customBaseUrl",void 0),n.__decorate([f.property()],t.prototype,"defaultBasemap",void 0),n.__decorate([f.reader("defaultBasemap")],t.prototype,"readDefaultBasemap",null),n.__decorate([f.property({type:m})],t.prototype,"defaultExtent",void 0),n.__decorate([f.property()],t.prototype,"defaultVectorBasemap",void 0),n.__decorate([f.reader("defaultVectorBasemap")],t.prototype,"readDefaultVectorBasemap",null),n.__decorate([f.property()],t.prototype,"description",void 0),n.__decorate([f.property()],t.prototype,"eueiEnabled",void 0),n.__decorate([f.property({dependsOn:["user","id","canSearchPublic"],readOnly:!0})],t.prototype,"extraQuery",null),n.__decorate([f.property()],t.prototype,"featuredGroups",void 0),n.__decorate([f.property()],t.prototype,"featuredItemsGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"galleryTemplatesGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"livingAtlasGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"hasCategorySchema",void 0),n.__decorate([f.property()],t.prototype,"helpBase",void 0),n.__decorate([f.property()],t.prototype,"helperServices",void 0),n.__decorate([f.property()],t.prototype,"helpMap",void 0),n.__decorate([f.property()],t.prototype,"homePageFeaturedContent",void 0),n.__decorate([f.property()],t.prototype,"homePageFeaturedContentCount",void 0),n.__decorate([f.property()],t.prototype,"httpPort",void 0),n.__decorate([f.property()],t.prototype,"httpsPort",void 0),n.__decorate([f.property()],t.prototype,"id",void 0),n.__decorate([f.property()],t.prototype,"ipCntryCode",void 0),n.__decorate([f.property({dependsOn:["access"],readOnly:!0})],t.prototype,"isOrganization",null),n.__decorate([f.property()],t.prototype,"isPortal",void 0),n.__decorate([f.property()],t.prototype,"isReadOnly",void 0),n.__decorate([f.property()],t.prototype,"layerTemplatesGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"maxTokenExpirationMinutes",void 0),n.__decorate([f.property({type:Date})],t.prototype,"modified",void 0),n.__decorate([f.property()],t.prototype,"name",void 0),n.__decorate([f.property()],t.prototype,"portalHostname",void 0),n.__decorate([f.property()],t.prototype,"portalMode",void 0),n.__decorate([f.property()],t.prototype,"portalProperties",void 0),n.__decorate([f.property()],t.prototype,"region",void 0),n.__decorate([f.property({dependsOn:["url"],readOnly:!0})],t.prototype,"restUrl",null),n.__decorate([f.property()],t.prototype,"rotatorPanels",void 0),n.__decorate([f.property()],t.prototype,"showHomePageDescription",void 0),n.__decorate([f.property()],t.prototype,"sourceJSON",void 0),n.__decorate([f.property()],t.prototype,"staticImagesUrl",void 0),n.__decorate([f.property()],t.prototype,"stylesGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"supportsHostedServices",void 0),n.__decorate([f.property()],t.prototype,"symbolSetsGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"templatesGroupQuery",void 0),n.__decorate([f.property()],t.prototype,"thumbnail",void 0),n.__decorate([f.property({dependsOn:["restUrl","thumbnail"],readOnly:!0})],t.prototype,"thumbnailUrl",null),n.__decorate([f.property()],t.prototype,"units",void 0),n.__decorate([f.property()],t.prototype,"url",void 0),n.__decorate([f.property()],t.prototype,"urlKey",void 0),n.__decorate([f.reader("urlKey")],t.prototype,"readUrlKey",null),n.__decorate([f.property()],t.prototype,"user",void 0),n.__decorate([f.reader("user")],t.prototype,"readUser",null),n.__decorate([f.property()],t.prototype,"useStandardizedQuery",void 0),n.__decorate([f.property()],t.prototype,"useVectorBasemaps",void 0),n.__decorate([f.property()],t.prototype,"vectorBasemapGalleryGroupQuery",void 0),c=n.__decorate([f.subclass("esri.portal.Portal")],t)}(c.JSONSupportMixin(p))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t,r,n){void 0===e&&(e=null),void 0===t&&(t={}),this.localId=0,this.geohashIndexed=!1,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),r&&(this.centroid=r),null!=n&&(this.objectId=n)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(488),r(907),r(158),r(487),r(190),r(156),r(151),r(1142),r(1519),r(908)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){var h=l.getLogger("esri.Map");return function(e){function t(t){var r=e.call(this,t)||this;return r.basemap=null,r.ground=new i,r._basemapCache=u.createCache(),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"allLayers",{get:function(){return new a({root:this,rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:function(e){return e.layers}})},enumerable:!0,configurable:!0}),t.prototype.castBasemap=function(e){return u.ensureType(e,this._basemapCache)},t.prototype.castGround=function(e){return p.ensureType(e)||(h.error("Map.ground may not be set to null or undefined"),this._get("ground"))},t.prototype.findLayerById=function(e){return this.allLayers.find((function(t){return t.id===e}))},r.__decorate([c.property({readOnly:!0})],t.prototype,"allLayers",null),r.__decorate([c.property({type:n})],t.prototype,"basemap",void 0),r.__decorate([c.cast("basemap")],t.prototype,"castBasemap",null),r.__decorate([c.property({type:i,nonNullable:!0})],t.prototype,"ground",void 0),r.__decorate([c.cast("ground")],t.prototype,"castGround",null),r.__decorate([c.subclass("esri.Map")],t)}(d.LayersMixin(s.EventedMixin(o)))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1173)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(189),r(185),r(160),r(262),r(644),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e,t,n,i,o){var a=e.z||0;switch(n.mode){case"on-the-ground":var l=s.getElevationAtPoint(t,e,"ground")||0;return o&&(o.verticalDistanceToGround=0,o.sampledElevation=l),l;case"relative-to-ground":l=s.getElevationAtPoint(t,e,"ground")||0;var c=n.geometryZWithOffset(a,i);return o&&(o.verticalDistanceToGround=c,o.sampledElevation=l),c+l;case"relative-to-scene":return l=s.getElevationAtPoint(t,e,"scene")||0,c=n.geometryZWithOffset(a,i),o&&(o.verticalDistanceToGround=c,o.sampledElevation=l),c+l;case"absolute-height":if(c=n.geometryZWithOffset(a,i),o){var u=s.getElevationAtPoint(t,e,"ground")||0;o.verticalDistanceToGround=c-u,o.sampledElevation=u}return c;default:return r.neverReached(n.mode),0}}var u;Object.defineProperty(t,"__esModule",{value:!0}),t.applyPerVertexElevationAlignment=function(e,t,r,n,i,o,a,s,c,u,d){var h,f,v=p[d.mode],m=0;if(l.bufferToBuffer(e,t,r,n,c.spatialReference,i,s)&&(v.requiresAlignment(d)?(m=v.applyElevationAlignmentBuffer(n,i,o,a,s,c,u,d),h=o,f=a):(h=n,f=i),l.bufferToBuffer(h,c.spatialReference,f,o,u.spatialReference,a,s)))return m},t.evaluateElevationAlignmentAtPoint=c,t.elevationModeChangeUpdateType=function(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?u.UPDATE:e.onTheGroundChanged},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.applyElevationAlignmentForHUD=function(e,t,r,i,o){var s=c(t,r,o,i,h);a.updateVertexAttributeAuxpos1w(e,h.verticalDistanceToGround);var u=h.sampledElevation,p=n.mat4.copy(d,e.objectTransformation);return f[0]=t.x,f[1]=t.y,f[2]=s,l.computeLinearTransformation(t.spatialReference,f,p,i.spatialReference)?e.objectTransformation=p:console.warn("Could not locate symbol object properly, it might be misplaced"),u},function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(u=t.SymbolUpdateType||(t.SymbolUpdateType={}));var p={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,a,s){var l=s.calculateOffsetRenderUnits(a),c=s.featureExpressionInfoContext;t*=3,n*=3;for(var u=0;u<i;++u){var p=e[t+0],d=e[t+1],h=e[t+2];r[n+0]=p,r[n+1]=d,r[n+2]=null==c?h+l:l,t+=3,n+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o){var a=0,s=o.spatialReference;t*=3,n*=3;for(var l=0;l<i;++l){var c=e[t+0],u=e[t+1],p=e[t+2],d=o.getElevation(c,u,p,s,"ground")||0;a+=d,r[n+0]=c,r[n+1]=u,r[n+2]=d,t+=3,n+=3}return a/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,a,s){var l=0,c=s.calculateOffsetRenderUnits(a),u=s.featureExpressionInfoContext,p=o.spatialReference;t*=3,n*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=o.getElevation(h,f,v,p,"ground")||0;l+=m,r[n+0]=h,r[n+1]=f,r[n+2]=null==u?v+m+c:m+c,t+=3,n+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,a,s){var l=0,c=s.calculateOffsetRenderUnits(a),u=s.featureExpressionInfoContext,p=o.spatialReference;t*=3,n*=3;for(var d=0;d<i;++d){var h=e[t+0],f=e[t+1],v=e[t+2],m=o.getElevation(h,f,v,p,"scene")||0;l+=m,r[n+0]=h,r[n+1]=f,r[n+2]=null==u?v+m+c:m+c,t+=3,n+=3}return l/i},requiresAlignment:function(){return!0}}},d=i.mat4f64.create(),h={verticalDistanceToGround:0,sampledElevation:0},f=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(188),r(1891),r(183)],void 0===(i=function(e,t,r,n,i,o,a){var s="esri-expand__icon-number";return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.autoCollapse=null,n.collapseTooltip="",n.content="",n.expanded=null,n.expandTooltip="",n.group=null,n.iconNumber=0,n.label=void 0,n.messages=null,n.messagesCommon=null,n.mode="auto",n.view=null,n.viewModel=new o,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"contentId",{get:function(){return this.id+"_controls_content"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expandTitle",{get:function(){var e=this.expanded,t=this.messagesCommon,r=this.collapseTooltip,n=this.expandTooltip;return e?r||t.collapse:n||t.expand},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collapseIconClass",{get:function(){return"esri-icon-collapse"},set:function(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expandIconClass",{get:function(){return a.isWidget(this.content)?this.content.iconClass:"esri-icon-expand"},set:function(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")},enumerable:!0,configurable:!0}),t.prototype.expand=function(){this.viewModel.expanded=!0},t.prototype.collapse=function(){this.viewModel.expanded=!1},t.prototype.toggle=function(){this.viewModel.expanded=!this.viewModel.expanded},t.prototype.render=function(){var e,t=this.mode,r=((e={})["esri-expand--auto"]="auto"===t,e["esri-expand--drawer"]="drawer"===t,e["esri-expand--floating"]="floating"===t,e);return a.tsx("div",{class:this.classes("esri-expand esri-widget",r)},this.renderMask(),this.renderContainer())},t.prototype.renderContainer=function(){var e,t=this.expanded,r=((e={})["esri-expand__container--expanded"]=t,e);return a.tsx("div",{class:this.classes("esri-expand__container",r)},this.renderPanel(),this.renderContent())},t.prototype.renderMask=function(){var e,t=this.expanded,r=((e={})["esri-expand__mask--expanded"]=t,e);return a.tsx("div",{bind:this,onclick:this._toggle,class:this.classes("esri-expand__mask",r)})},t.prototype.renderBadgeNumber=function(){var e=this.expanded,t=this.iconNumber;return t&&!e?a.tsx("span",{key:"expand__icon-number",class:s},t):null},t.prototype.renderPanelNumber=function(){var e=this.iconNumber,t=this.expanded;return e&&t?a.tsx("span",{key:"expand__expand-icon-number",class:this.classes(s,"esri-expand__icon-number--expanded")},e):null},t.prototype.renderIcon=function(){var e,t=this.collapseIconClass,r=this.expandIconClass,n=this.expanded,i=((e={})["esri-expand__icon--expanded"]=n,e[t]=n,e[r]=!n,e);return t===r&&(i[t]=!0),a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-collapse__icon",i)})},t.prototype.renderTitle=function(){return a.tsx("span",{class:"esri-icon-font-fallback-text"},this.expandTitle)},t.prototype.renderExpandButton=function(){var e=this.expanded,t=this.expandTitle,r=this.contentId;return a.tsx("div",{bind:this,onclick:this._toggle,onkeydown:this._toggle,"aria-controls":r,"aria-expanded":e?"true":"false",title:t,role:"button",tabindex:"0",class:"esri-widget--button"},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())},t.prototype.renderPanel=function(){return a.tsx("div",{class:"esri-expand__panel"},this.renderExpandButton(),this.renderPanelNumber())},t.prototype.renderContent=function(){var e,t=this.expanded,r=this.contentId,n=((e={})["esri-expand__content--expanded"]=t,e);return a.tsx("div",{id:r,role:"region",class:this.classes("esri-expand__content",n)},this.renderContentContainer())},t.prototype.renderContentContainer=function(){var e=this.content;return"string"==typeof e?a.tsx("div",{innerHTML:e}):a.isWidget(e)?e.render():e instanceof HTMLElement?a.tsx("div",{bind:e,afterCreate:this._attachToNode}):a.hasDomNode(e)?a.tsx("div",{bind:e.domNode,afterCreate:this._attachToNode}):null},t.prototype._toggle=function(){this.toggle()},t.prototype._attachToNode=function(e){e.appendChild(this)},r.__decorate([n.property({readOnly:!0,dependsOn:["id"]}),a.renderable()],t.prototype,"contentId",null),r.__decorate([n.property({readOnly:!0,dependsOn:["expanded","messagesCommon","collapseTooltip","expandTooltip"]}),a.renderable()],t.prototype,"expandTitle",null),r.__decorate([n.aliasOf("viewModel.autoCollapse")],t.prototype,"autoCollapse",void 0),r.__decorate([n.property({dependsOn:["content"]}),a.renderable()],t.prototype,"collapseIconClass",null),r.__decorate([n.property(),a.renderable()],t.prototype,"collapseTooltip",void 0),r.__decorate([n.property(),a.renderable()],t.prototype,"content",void 0),r.__decorate([n.aliasOf("viewModel.expanded"),a.renderable()],t.prototype,"expanded",void 0),r.__decorate([n.property({dependsOn:["content"]}),a.renderable()],t.prototype,"expandIconClass",null),r.__decorate([n.property(),a.renderable()],t.prototype,"expandTooltip",void 0),r.__decorate([n.aliasOf("viewModel.group")],t.prototype,"group",void 0),r.__decorate([n.property(),a.renderable()],t.prototype,"iconNumber",void 0),r.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([n.property(),a.renderable(),a.messageBundle("esri/widgets/Expand/t9n/Expand")],t.prototype,"messages",void 0),r.__decorate([n.property(),a.renderable(),a.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0),r.__decorate([n.property(),a.renderable()],t.prototype,"mode",void 0),r.__decorate([n.aliasOf("viewModel.view"),a.renderable()],t.prototype,"view",void 0),r.__decorate([n.property({type:o}),a.renderable("viewModel.state")],t.prototype,"viewModel",void 0),r.__decorate([a.accessibleHandler()],t.prototype,"_toggle",null),r.__decorate([n.subclass("esri.widgets.Expand")],t)}(i)}.apply(null,n))||(e.exports=i)},,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(235)],void 0===(i=function(e,t,r,n,i,o){var a=function(e){function t(t){var r=e.call(this,t)||this;return r.end=null,r.start=null,r}var n;return r.__extends(t,e),n=t,Object.defineProperty(t,"allTime",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(t,"empty",{get:function(){return l},enumerable:!0,configurable:!0}),t.prototype.readEnd=function(e,t){return null!=t.end?new Date(t.end):null},t.prototype.writeEnd=function(e,t){t.end=e?e.getTime():null},Object.defineProperty(t.prototype,"isAllTime",{get:function(){return this.equals(n.allTime)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.equals(n.empty)},enumerable:!0,configurable:!0}),t.prototype.readStart=function(e,t){return null!=t.start?new Date(t.start):null},t.prototype.writeStart=function(e,t){t.start=e?e.getTime():null},t.prototype.clone=function(){return new n({end:this.end,start:this.start})},t.prototype.intersection=function(e){var t,r,i,o,a,s,l,c;if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return n.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();var u,p,d=null!==(r=null===(t=this.start)||void 0===t?void 0:t.getTime())&&void 0!==r?r:-1/0,h=null!==(o=null===(i=this.end)||void 0===i?void 0:i.getTime())&&void 0!==o?o:1/0,f=null!==(s=null===(a=e.start)||void 0===a?void 0:a.getTime())&&void 0!==s?s:-1/0,v=null!==(c=null===(l=e.end)||void 0===l?void 0:l.getTime())&&void 0!==c?c:1/0;if(f>=d&&f<=h?u=f:d>=f&&d<=v&&(u=d),h>=f&&h<=v?p=h:v>=d&&v<=h&&(p=v),!isNaN(u)&&!isNaN(p)){var m=new n;return m.start=u===-1/0?null:new Date(u),m.end=p===1/0?null:new Date(p),m}return n.empty},t.prototype.offset=function(e,t){if(this.isEmpty||this.isAllTime)return this.clone();var r=new n,i=this.start,a=this.end;return i&&(r.start=o.offsetDate(i,e,t)),a&&(r.end=o.offsetDate(a,e,t)),r},t.prototype.equals=function(e){if(!e)return!1;var t=this.start?this.start.getTime():this.start,r=this.end?this.end.getTime():this.end,n=e.start?e.start.getTime():e.start,i=e.end?e.end.getTime():e.end;return t===n&&r===i},r.__decorate([i.property({type:Date,json:{write:{allowNull:!0}}})],t.prototype,"end",void 0),r.__decorate([i.reader("end")],t.prototype,"readEnd",null),r.__decorate([i.writer("end")],t.prototype,"writeEnd",null),r.__decorate([i.property({dependsOn:["start","end"],readOnly:!0,json:{read:!1}})],t.prototype,"isAllTime",null),r.__decorate([i.property({dependsOn:["start","end"],readOnly:!0,json:{read:!1}})],t.prototype,"isEmpty",null),r.__decorate([i.property({type:Date,json:{write:{allowNull:!0}}})],t.prototype,"start",void 0),r.__decorate([i.reader("start")],t.prototype,"readStart",null),r.__decorate([i.writer("start")],t.prototype,"writeStart",null),n=r.__decorate([i.subclass("esri.TimeExtent")],t)}(n.JSONSupport),s=new a,l=new a({start:void 0,end:void 0});return a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(154),r(155),r(118),r(323),r(152),r(153),r(172),r(151),r(179),r(184),r(273),r(895),r(896),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){return function(e){function t(t){var r=e.call(this,t)||this;return r.access=null,r.accessInformation=null,r.applicationProxies=null,r.avgRating=null,r.categories=null,r.created=null,r.culture=null,r.description=null,r.extent=null,r.groupCategories=null,r.id=null,r.itemControl=null,r.licenseInfo=null,r.modified=null,r.name=null,r.numComments=null,r.numRatings=null,r.numViews=null,r.owner=null,r.ownerFolder=null,r.portal=null,r.screenshots=null,r.size=null,r.snippet=null,r.sourceJSON=null,r.tags=null,r.title=null,r.type=null,r.typeKeywords=null,r.url=null,r}var a;return n.__extends(t,e),a=t,t.from=function(e){return h.ensureClass(a,e)},Object.defineProperty(t.prototype,"displayName",{get:function(){var e=this.type,t=this.typeKeywords||[],r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.indexOf("Table")>-1?"Table":t.indexOf("Route Layer")>-1?"Route Layer":t.indexOf("Markup")>-1?"Markup":"Feature Layer":"Image Service"===e?r=t.indexOf("Elevation 3D Layer")>-1?"Elevation Layer":t.indexOf("Tiled Imagery")>-1?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e&&this.portal&&this.portal.isPortal?r=t.indexOf("Web Tool")>-1?"Tool":"Geoprocessing Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=-1===t.indexOf("Spatiotemporal")&&(t.indexOf("Hosted Service")>-1||t.indexOf("Tiled")>-1)&&-1===t.indexOf("Relational")?"Tile Layer":"Map Image Layer":e&&e.toLowerCase().indexOf("add in")>-1?r=e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e&&(r="Tile Package (tpkx)"),r},enumerable:!0,configurable:!0}),t.prototype.readExtent=function(e){return e&&e.length?new f(e[0][0],e[0][1],e[1][0],e[1][1]):null},Object.defineProperty(t.prototype,"iconUrl",{get:function(){var e,t=this.type&&this.type.toLowerCase()||"",r=this.typeKeywords||[],n=!1,o=!1,a=!1,s=!1,l=!1;return t.indexOf("service")>0||"feature collection"===t||"kml"===t||"wms"===t||"wmts"===t||"wfs"===t?(n=r.indexOf("Hosted Service")>-1,"feature service"===t||"feature collection"===t||"kml"===t||"wfs"===t?(o=r.indexOf("Table")>-1,a=r.indexOf("Route Layer")>-1,s=r.indexOf("Markup")>-1,e=(l=-1!==r.indexOf("Spatiotemporal"))&&o?"spatiotemporaltable":o?"table":a?"routelayer":s?"markup":l?"spatiotemporal":n?"featureshosted":"features"):e="map service"===t||"wms"===t||"wmts"===t?n||r.indexOf("Tiled")>-1||"wmts"===t?"maptiles":"mapimages":"scene service"===t?r.indexOf("Line")>-1?"sceneweblayerline":r.indexOf("3DObject")>-1?"sceneweblayermultipatch":r.indexOf("Point")>-1?"sceneweblayerpoint":r.indexOf("IntegratedMesh")>-1?"sceneweblayermesh":r.indexOf("PointCloud")>-1?"sceneweblayerpointcloud":r.indexOf("Polygon")>-1?"sceneweblayerpolygon":r.indexOf("Building")>-1?"sceneweblayerbuilding":"sceneweblayer":"image service"===t?r.indexOf("Elevation 3D Layer")>-1?"elevationlayer":r.indexOf("Tiled Imagery")>-1?"tiledimagerylayer":"imagery":"stream service"===t?"streamlayer":"vector tile service"===t?"vectortile":"datastore catalog service"===t?"datastorecollection":"geocoding service"===t?"geocodeservice":"geoprocessing service"===t&&r.indexOf("Web Tool")>-1&&this.portal&&this.portal.isPortal?"tool":"layers"):e="web map"===t||"cityengine web scene"===t?"maps":"web scene"===t?r.indexOf("ViewingMode-Local")>-1?"webscenelocal":"websceneglobal":"web mapping application"===t||"mobile application"===t||"application"===t||"operation view"===t||"desktop application"===t?"apps":"map document"===t||"map package"===t||"published map"===t||"scene document"===t||"globe document"===t||"basemap package"===t||"mobile basemap package"===t||"mobile map package"===t||"project package"===t||"project template"===t||"pro map"===t||"layout"===t||"layer"===t&&r.indexOf("ArcGIS Pro")>-1||"explorer map"===t&&r.indexOf("Explorer Document")?"mapsgray":"service definition"===t||"csv"===t||"shapefile"===t||"cad drawing"===t||"geojson"===t||"360 vr experience"===t||"netcdf"===t||"administrative report"===t?"datafiles":"explorer add in"===t||"desktop add in"===t||"windows viewer add in"===t||"windows viewer configuration"===t?"appsgray":"arcgis pro add in"===t||"arcgis pro configuration"===t?"addindesktop":"rule package"===t||"file geodatabase"===t||"sqlite geodatabase"===t||"csv collection"===t||"kml collection"===t||"windows mobile package"===t||"map template"===t||"desktop application template"===t||"gml"===t||"arcpad package"===t||"code sample"===t||"form"===t||"document link"===t||"operations dashboard add in"===t||"rules package"===t||"image"===t||"workflow manager package"===t||"explorer map"===t&&r.indexOf("Explorer Mapping Application")>-1||r.indexOf("Document")>-1?"datafilesgray":"network analysis service"===t||"geoprocessing service"===t||"geodata service"===t||"geometry service"===t||"geoprocessing package"===t||"locator package"===t||"geoprocessing sample"===t||"workflow manager service"===t?"toolsgray":"layer"===t||"layer package"===t||"explorer layer"===t?"layersgray":"scene package"===t?"scenepackage":"mobile scene package"===t?"mobilescenepackage":"tile package"===t||"compact tile package"===t?"tilepackage":"task file"===t?"taskfile":"report template"===t?"report-template":"statistical data collection"===t?"statisticaldatacollection":"insights workbook"===t?"workbook":"insights model"===t?"insightsmodel":"insights page"===t?"insightspage":"insights theme"===t?"insightstheme":"hub initiative"===t?"hubinitiative":"hubpage"===t?"hubpage":"hub site application"===t?"hubsite":"relational database connection"===t?"relationaldatabaseconnection":"big data file share"===t?"datastorecollection":"image collection"===t?"imagecollection":"style"===t?"style":"desktop style"===t?"desktopstyle":"dashboard"===t?"dashboard":"raster function template"===t?"rasterprocessingtemplate":"vector tile package"===t?"vectortilepackage":"ortho mapping project"===t?"orthomappingproject":"ortho mapping template"===t?"orthomappingtemplate":"solution"===t?"solutions":"geopackage"===t?"geopackage":"deep learning package"===t?"deeplearningpackage":"real time analytic"===t?"realtimeanalytics":"big data analytic"===t?"bigdataanalytics":"feed"===t?"feed":"excalibur imagery project"===t?"excaliburimageryproject":"notebook"===t?"notebook":"storymap"===t?"storymap":"survey123 add in"===t?"survey123addin":"mission"===t?"mission":"mission report"===t?"missionreport":"quickcapture project"===t?"quickcaptureproject":"pro report"===t?"proreport":"urban model"===t?"urbanmodel":"web experience"===t?"experiencebuilder":"web experience template"===t?"webexperiencetemplate":"workflow"===t?"workflow":"insights script"===t?"insightsscript":"kernel gateway connection"===t?"kernelgatewayconnection":"hub initiative template"===t?"hubinitiativetemplate":"storymap theme"===t?"storymaptheme":"maps",e?i.getAssetUrl("esri/images/portal/"+e+"16.png"):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLayer",{get:function(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].indexOf(this.type)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemUrl",{get:function(){var e=this.get("portal.restUrl");return e?e+"/content/items/"+this.id:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailUrl",{get:function(){var e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(e+"/info/"+t+"?f=json"):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userItemUrl",{get:function(){var e=this.get("portal.restUrl");if(!e)return null;var t=this.owner||this.get("portal.user.username");return t?e+"/content/users/"+(this.ownerFolder?t+"/"+this.ownerFolder:t)+"/items/"+this.id:null},enumerable:!0,configurable:!0}),t.prototype.load=function(e){var t=this;this.portal||(this.portal=v.getDefault());var r=this.portal.load(e).then((function(){return t.sourceJSON?t.sourceJSON:t.id&&t.itemUrl?t.portal._request(t.itemUrl,{signal:c.isSome(e)?e.signal:null}):{}})).then((function(e){t.sourceJSON=e,t.read(e)}));return this.addResolvingPromise(r),u.resolve(this)},t.prototype.addRating=function(e){var t={method:"post",query:{}};return e instanceof y&&(e=e.rating),isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then((function(){return new y({rating:e,created:new Date})}))},t.prototype.clone=function(){var e={access:this.access,accessInformation:this.accessInformation,applicationProxies:s.clone(this.applicationProxies),avgRating:this.avgRating,categories:s.clone(this.categories),created:s.clone(this.created),culture:this.culture,description:this.description,extent:s.clone(this.extent),groupCategories:s.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:s.clone(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:s.clone(this.screenshots),size:this.size,snippet:this.snippet,tags:s.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:s.clone(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new a({sourceJSON:this.sourceJSON}).set(e)},t.prototype.createPostQuery=function(){var e=this.toJSON();for(var t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e},t.prototype.deleteRating=function(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then((function(){}))},t.prototype.fetchData=function(e,t){return void 0===e&&(e="json"),this.portal._request(this.itemUrl+"/data",n.__assign({responseType:e},t))},t.prototype.fetchRating=function(e){return this.portal._request(this.itemUrl+"/rating",e).then((function(e){return null!=e.rating?(e.created=new Date(e.created),new y(e)):null}))},t.prototype.fetchRelatedItems=function(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",n.__assign({query:e},t),"PortalItem")},t.prototype.getThumbnailUrl=function(e){var t=this.thumbnailUrl;return t&&e&&(t+="&w="+e),t},t.prototype.reload=function(){var e=this;return this.portal._request(this.itemUrl,{cacheBust:!0}).then((function(t){return e.sourceJSON=t,e.read(t),e}))},t.prototype.update=function(e){var t=this;return this.id?this.load().then((function(){return t.portal._signIn()})).then((function(){var r=e&&e.data,n={method:"post"};for(var i in n.query=t.createPostQuery(),n.query)null===n.query[i]&&(n.query[i]="");return n.query.clearEmptyFields=!0,null!=r&&("string"==typeof r?n.query.text=r:"object"==typeof r&&(n.query.text=JSON.stringify(r))),t.portal._request(t.userItemUrl+"/update",n).then((function(){return t.reload()}))})):u.reject(new o("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))},t.prototype.updateThumbnail=function(e){var t=this;return this.id?this.load().then((function(){return t.portal._signIn()})).then((function(){var r=e.thumbnail,n=e.filename,i={method:"post"};if("string"==typeof r)p.isDataProtocol(r)?i.query={data:r}:i.query={url:p.makeAbsolute(r)},c.isSome(n)&&(i.query.filename=n);else{var o=new FormData;c.isSome(n)?o.append("file",r,n):o.append("file",r),i.body=o}return t.portal._request(t.userItemUrl+"/updateThumbnail",i).then((function(){return t.reload()}))})):u.reject(new o("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))},t.prototype.fetchResources=function(e,t){return void 0===e&&(e={}),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(365)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,n.sent().fetchResources(this,e,t)]}}))}))},t.prototype.addResource=function(e,t,i){return n.__awaiter(this,void 0,void 0,(function(){var o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(365)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return o=n.sent(),e.portalItem=this,[2,o.addOrUpdateResource(e,"add",t,i)]}}))}))},t.prototype.removeResource=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(365)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:if(i=n.sent(),e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new o("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return[2,i.removeResource(this,e,t)]}}))}))},t.prototype.removeAllResources=function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(365)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,t.sent().removeAllResources(this,e)]}}))}))},t.prototype.resourceFromPath=function(e){return new m({portalItem:this,path:e})},t.prototype.toJSON=function(){var e=this.extent,t={created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return s.fixJson(t)},t.fromJSON=function(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new a({sourceJSON:e})},t.prototype._getPostQuery=function(){var e=this.toJSON();for(var t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e},n.__decorate([d.property({type:["private","shared","org","public"]})],t.prototype,"access",void 0),n.__decorate([d.property()],t.prototype,"accessInformation",void 0),n.__decorate([d.property({json:{read:{source:"appProxies"}}})],t.prototype,"applicationProxies",void 0),n.__decorate([d.property()],t.prototype,"avgRating",void 0),n.__decorate([d.property()],t.prototype,"categories",void 0),n.__decorate([d.property({type:Date})],t.prototype,"created",void 0),n.__decorate([d.property()],t.prototype,"culture",void 0),n.__decorate([d.property()],t.prototype,"description",void 0),n.__decorate([d.property({dependsOn:["type","typeKeywords"],readOnly:!0})],t.prototype,"displayName",null),n.__decorate([d.property({type:f})],t.prototype,"extent",void 0),n.__decorate([d.reader("extent")],t.prototype,"readExtent",null),n.__decorate([d.property()],t.prototype,"groupCategories",void 0),n.__decorate([d.property({dependsOn:["type","typeKeywords"],readOnly:!0})],t.prototype,"iconUrl",null),n.__decorate([d.property()],t.prototype,"id",void 0),n.__decorate([d.property({dependsOn:["type"],readOnly:!0})],t.prototype,"isLayer",null),n.__decorate([d.property()],t.prototype,"itemControl",void 0),n.__decorate([d.property({dependsOn:["portal.restUrl","id"],readOnly:!0})],t.prototype,"itemUrl",null),n.__decorate([d.property()],t.prototype,"licenseInfo",void 0),n.__decorate([d.property({type:Date})],t.prototype,"modified",void 0),n.__decorate([d.property()],t.prototype,"name",void 0),n.__decorate([d.property()],t.prototype,"numComments",void 0),n.__decorate([d.property()],t.prototype,"numRatings",void 0),n.__decorate([d.property()],t.prototype,"numViews",void 0),n.__decorate([d.property()],t.prototype,"owner",void 0),n.__decorate([d.property()],t.prototype,"ownerFolder",void 0),n.__decorate([d.property({type:v})],t.prototype,"portal",void 0),n.__decorate([d.property()],t.prototype,"screenshots",void 0),n.__decorate([d.property()],t.prototype,"size",void 0),n.__decorate([d.property()],t.prototype,"snippet",void 0),n.__decorate([d.property()],t.prototype,"sourceJSON",void 0),n.__decorate([d.property()],t.prototype,"tags",void 0),n.__decorate([d.property()],t.prototype,"thumbnail",void 0),n.__decorate([d.property({dependsOn:["itemUrl","thumbnail","portal.credential.token"],readOnly:!0})],t.prototype,"thumbnailUrl",null),n.__decorate([d.property()],t.prototype,"title",void 0),n.__decorate([d.property()],t.prototype,"type",void 0),n.__decorate([d.property()],t.prototype,"typeKeywords",void 0),n.__decorate([d.property()],t.prototype,"url",void 0),n.__decorate([d.property({dependsOn:["portal.restUrl","portal.user.username","owner","ownerFolder","id"],readOnly:!0})],t.prototype,"userItemUrl",null),a=n.__decorate([d.subclass("esri.portal.PortalItem")],t)}(a.JSONSupportMixin(l))}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";e.exports=r(1517)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshableLayerView=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t.refreshDebounced=n.debounce((function(e,n){return r.__awaiter(t,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return"number"==typeof e?t=e:(t=Date.now(),n=e),this._set("refreshTimestamp",t),this.doRefresh?[4,this.doRefresh(n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}),2e3),t}return r.__extends(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},r.__decorate([i.property()],t.prototype,"layer",void 0),r.__decorate([i.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),r.__decorate([i.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(e)},t.isRefreshableLayerView=function(e){return"refresh"in e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230)],void 0===(i=function(e,t,r){return function(){function e(e,t,r,n){this.set(e,t,r,n)}return e.getId=function(e,t,r,n){return"object"==typeof e?e.level+"/"+e.row+"/"+e.col+"/"+e.world:e+"/"+t+"/"+r+"/"+n},Object.defineProperty(e.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0}),e.prototype.acquire=function(e,t,r,n){this.set(e,t,r,n)},e.prototype.equals=function(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world},e.prototype.release=function(){this.level=0,this.row=0,this.col=0,this.world=0},e.prototype.set=function(e,t,r,n){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){var i=e.split("/"),o=i[0],a=i[1],s=i[2],l=i[3];this.level=parseFloat(o),this.row=parseFloat(a),this.col=parseFloat(s),this.world=parseFloat(l)}else this.level=+e,this.row=+t,this.col=+r,this.world=+n||0;return this},e.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world},e.prototype.getChildKeys=function(){var t=this.level+1,r=this.row<<1,n=this.col<<1,i=this.world;return[new e(t,r,n,i),new e(t,r,n+1,i),new e(t,r+1,n,i),new e(t,r+1,n+1,i)]},e.prototype.compareRowMajor=function(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0},e.pool=new r(e,null,null,25,50),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(638),r(159),r(174),r(907),r(369),r(169),r(620),r(154),r(270),r(164),r(156),r(152),r(153),r(231),r(157),r(305),r(171),r(151),r(179),r(160),r(436),r(173),r(491),r(197),r(492),r(1143),r(909),r(1590),r(1147),r(490),r(530),r(1594),r(1595),r(1600),r(1604),r(1631),r(1664),r(1674),r(1747),r(1748),r(1751),r(1752),r(1758),r(1759),r(261),r(1760),r(644),r(203),r(1761),r(1268),r(1765),r(192),r(498),r(1776),r(1777),r(1778),r(1791),r(917),r(1793),r(1800),r(375),r(1826),r(390),r(391),r(529),r(643),r(1193),r(1159),r(1890),r(1164),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V,F,N,k,z,U,B,G,H,q,W,J,Z,X,Y,Q,K,$,ee,te,re,ne,ie,oe,ae,se,le,ce,ue,pe,de,he,fe,ve,me,ye,ge,_e){var be=f.getLogger("esri.views.SceneView"),xe=function(e){function t(t){var r=e.call(this,t)||this;r._clippingArea=null,r._userClippingArea=null,r._initialDefaultSpatialReference=null,r._defaults={},r._externallySet={environment:!1},r._createGraphicsViewController=null,r._resolveWhenReady=[],r.propertiesPool=new re.default({slicePlane:se.BoundedPlaneClass},r),r._resourceController=$.newResourceController(r),r._defaultToMapOptions={include:new Set},r._defaultHitTestOptions={exclude:new Set},r.deconflictor=new z.GraphicsDeconflictor({view:r}),r.labeler=new U.Labeler({view:r,deconflictor:r.deconflictor.labels}),r.sharedSymbolResources=null,r.basemapTerrain=null,r.elevationProvider=null,r.camera=null,r.canvas=null,r.center=null,r.constraints=new V.default,r.environmentManager=new N.default,r.extent=null,r.windowDevicePixelRatio=1,r.fullOpacity=1,r.graphicsView=null,r.groundView=null,r.navigating=!1,r.map=null,r.screenSizePerspectiveEnabled=!0,r.state=null,r.scale=null,r.spatialReference=null,r.isHeightModelInfoRequired=!0,r.alphaCompositingEnabled=!1,r.supersampleScreenhotsEnabled=!0,r.type="3d",r.ui=new ge,r._numUpdating=0,r._lastUpdateTime=0,r.updatingProgress=.5,r.viewpoint=null,r.zoom=null,r.highlightOptions=new K,_.initialize(),t&&t.environment||(r._defaults.environment=new F,r.environment=r._defaults.environment);var i=function(){r.notifyChange("dataExtent"),r.updatingChanged(),r.map&&r.map.allLayers.forEach((function(e){return n.__awaiter(r,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.when()];case 1:case 2:return t.sent(),[3,3];case 3:return this.updatingChanged(),[2]}}))}))}))};return r.handles.add([g.on(r,"map.allLayers","after-changes",i,i,i,!0),r.allLayerViews.on("after-changes",(function(){return r._updateUpdatingMonitors()})),r.watch("map",(function(e){e&&e.load&&e.load().catch((function(){}))}))]),r.inputManager=new k({view:r}),r.stateManager=new q.ViewStateManager({view:r,updateDevicePixelRatio:function(){var e=window.devicePixelRatio;e!==r.windowDevicePixelRatio&&(r.windowDevicePixelRatio=e,r.notifyChange("pixelRatio"))}}),r}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this.groundView=new I({view:this}),this._updateUpdatingMonitors();var t=function(){return e._updateDefaultToMapOptions()};this.handles.add(g.on(this,"map.allLayers","after-changes",t,t,t)),this.updatingHandles.add(this.qualitySettings,"memoryLimit",(function(t){e.resourceController&&(e.resourceController.memoryController.maxMemory=t)}),2),this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",(function(t){e.resourceController&&(e.resourceController.memoryController.additionalCacheMemory=t)}),2),this.updatingHandles.add(this.qualitySettings,"frameRate",(function(e){return y.setFrameDuration(e>0?1e3/Math.ceil(e):0)}),2),this.updatingHandles.add(Z,"SCENEVIEW_LOCKING_LOG",(function(t){return e.defaultsFromMap.logDebugInformation=t}),2),this.updatingHandles.add(this,"map.ground",t,3),this.updatingHandles.add(this,"map.ground.opacity",(function(){return e._updateDefaultHitTestOptions()}),3),this.handles.add(this.watch("spatialReference",(function(){return e.notifyChange("clippingArea")}),!0))},t.prototype.destroy=function(){this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=null,this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null},Object.defineProperty(t.prototype,"renderSpatialReference",{get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.spatialReference:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;var e=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!e)return this._clippingArea=null,null;if(!(e instanceof o.Extent))return be.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!C.canProject(e.spatialReference,this.spatialReference))return be.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;e=C.project(e,this.spatialReference)}return this._clippingArea&&e&&this._clippingArea.equals(e)?this._clippingArea:(this._clippingArea=e,e)},set:function(e){this.ready&&"global"===this.viewingMode&&e?be.error("#clippingArea=","Clipping area is only supported in local viewingMode"):(this._userClippingArea=e,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataExtent",{get:function(){var e=[],t=this.spatialReference||o.SpatialReference.WGS84,r=this.clippingArea;r&&(r=C.project(r,t));var n=function(n){if(n){var i=C.project(n,t);i&&(r&&!(i=i.intersection(r))||e.push(i))}},i=this.basemapTerrain;if(i&&i.spatialReference&&n(new o.Extent({xmin:i.extent[0],ymin:i.extent[1],zmin:0,xmax:i.extent[2],ymax:i.extent[3],zmax:0,spatialReference:i.spatialReference})),this.map&&this.map.allLayers.forEach((function(e){return n(e.fullExtent)})),0===e.length)return new o.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t});var a=e.reduce((function(e,t){return e.union(t)}));return a.hasZ?(a.zmin=Math.min(0,a.zmin),a.zmax=Math.max(0,a.zmax)):(a.zmin=0,a.zmax=0),a},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"environment",{set:function(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)},enumerable:!0,configurable:!0}),t.prototype.castEnvironment=function(e){return e?e instanceof F?e:e instanceof _e?F.fromWebsceneEnvironment(e):w.ensureType(F,e):new F},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(e){v.isSome(e)?this._override("pixelRatio",e):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumPixelRatio",{get:function(){var e=1/0,t=this.qualitySettings,r=t.maximumPixelRatio,n=t.maximumRenderResolution;if(null!=r&&(e=Math.min(e,r)),null!=n){var i=n/Math.max(this.width,this.height);e=Math.min(e,i)}return e},set:function(e){v.isSome(e)?this._override("maximumPixelRatio",e):this._clearOverride("maximumPixelRatio")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundExtent",{get:function(){var e=this._get("basemapTerrain");if(e&&e.spatialReference){var t=e.extent;return new o.Extent({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e.spatialReference})}var r=this.spatialReference||o.SpatialReference.WGS84;return new o.Extent({spatialReference:r})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interacting",{get:function(){return this.navigating||v.isSome(this.activeTool)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stationary",{get:function(){return!this.animation&&!this.resizing&&(v.isNone(this.state)||this.state.stationary)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||X.getDefaultProfile()},set:function(e){X.isValidProfile(e)&&(X.apply(e,this.qualitySettings),this._set("qualityProfile",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slicePlane",{set:function(e){if(this._stage.renderView.setRenderParameters({slicePlane:e}),v.isNone(e))this._set("slicePlane",null);else{var t=this.propertiesPool.get("slicePlane");Q.boundedPlane.copy(e,t),this._set("slicePlane",t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return null!=this.spatialReference?O.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightModelInfo",{get:function(){var e=this.getDefaultHeightModelInfo();return null!=e?P.deriveUnitFromSR(e,this.spatialReference):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){var e=0,t=0,r=!1;this.allLayerViews.forEach((function(n){if(n.isFulfilled()){if(n.updating){if(r=!0,n.suspended)return;++t,e+="updatingProgress"in n?n.updatingProgress:.5}}else++t}));for(var n=0,i=[this.graphicsView,this.basemapView,this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage&&this._stage.renderView,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger];n<i.length;n++){var o=i[n];v.isSome(o)&&o.updating&&(t+=.1,e+=.05)}for(var a=0,s=[this.deconflictor,this.labeler];a<s.length;a++)o=s[a],v.isSome(o)&&o.updating&&(++t,e+=o.updatingProgress);if((r=!!(r||t>0||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager&&this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some((function(e){return!e.isFulfilled()}))))?(this._numUpdating=Math.max(t,this._numUpdating),e+=this._numUpdating-t):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=r?.5:1,this._get("updatingProgress")!==e){var l=this._resourceController.scheduler.now;if(e<1){var c=Math.min((l-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-c)+e*c}this._set("updatingProgress",e),this._lastUpdateTime=r&&e<1?l:0}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewingMode",{get:function(){var e=this.get("map.initialViewProperties.viewingMode"),t=this.spatialReference;return e||(e=!t||me.isSpatialReferenceSupported(t,"global")?"global":"local"),e},set:function(e){this.ready?be.error("#viewingMode","viewingMode cannot be set once view is ready"):["local","global"].indexOf(e)>=0?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return new oe(this)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,r,n,i){return this.viewEvents.on(t,r,n,i)||e.prototype.on.call(this,t,r)},t.prototype.hasEventListener=function(t){return e.prototype.hasEventListener.call(this,t)||this.viewEvents.hasHandler(t)},t.prototype.toMap=function(e,t){if(!this.ready)return be.error("#toMap()","Scene view cannot be used before it is ready"),null;var r=t?this._externalToInternalIntersectOptions(t):this._defaultToMapOptions,n=v.isSome(r.graphics)&&(v.isSome(r.graphics.include)||v.isSome(r.graphics.exclude)),i=b.isSupportedScreenPointEvent(e)?b.createScreenPointFromSupportedEvent(this,e):e,o=b.screenPointObjectToArray(i);r.enableDraped=r.include&&!r.include.has(he.TERRAIN_ID)||r.exclude&&r.exclude.has(he.TERRAIN_ID);var a=this.sceneIntersectionHelper,s=new de.Intersector(this.viewingMode);if(s.options.selectionMode=!0,s.options.store=n?2:0,a.intersectIntersectorScreen(o,s,r),n){for(var l=0,c=s.results.all;l<c.length;l++){var u=c[l],p=u.toGraphic(this);if(v.isNone(p))return this._intersectResultToMapPoint(u);if(this._testGraphicUidFilter(r.graphics,p))return this._intersectResultToMapPoint(u)}return null}return this._intersectResultToMapPoint(s.results.min)},t.prototype.toScreen=function(e){if(!this.ready)return be.error("#toScreen()","Scene view cannot be used before it is ready"),null;var t=null==e.z&&Y.getElevationAtPoint(this.elevationProvider,e)||0;return te.pointToVector(e,Se,this.renderSpatialReference,t),this.engineToScreen(Se)},t.prototype.pixelSizeAt=function(e){return this.ready?e?(te.pointToVector(e,Se,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Se)):0:(be.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)},t.prototype.hitTest=function(e,t){if(!this.ready)return be.error("#hitTest()","Scene view cannot be used before it is ready"),null;var r=b.isSupportedScreenPointEvent(e)?b.createScreenPointFromSupportedEvent(this,e):e,n=b.createScreenPointArray(r.x,r.y),i=t?this._externalToInternalIntersectOptions(t):this._defaultHitTestOptions;i.terrainLocationFeedbackEnabled=!0,i.enableDraped=!0;var o=new de.Intersector(this.viewingMode);o.options.selectionMode=!0,o.options.store=2,this.sceneIntersectionHelper.intersectIntersectorScreen(n,o,i);var a=this._intersectResultsToHits(o.results.all,i.graphics),s=o.results.ground,l=s.toOwner(this),c=v.isSome(l)&&"type"in l&&"integrated-mesh"===l.type?l:null,u={screenPoint:r,results:a,ground:{mapPoint:this._intersectResultToMapPoint(s),distance:s.hasIntersectionPoint?s.distanceInRenderSpace:0,layer:c}};return Z.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=o),m.resolve(u)},t.prototype.popupHitTest=function(e){return this.hitTest(e).then((function(t){for(var r=[],n=t.results.length?t.results[0].distance:0,i=0,o=t.results;i<o.length;i++){var a=o[i];if(a.distance!==n)break;r.push(a)}var s=null;return!(0===r.length||Math.abs(n-t.ground.distance)<1e-5)||t.ground.layer&&"integrated-mesh"===t.ground.layer.type||(s=t.ground.mapPoint),{results:r,screenPoint:e,mapPoint:s}}))},t.prototype.goTo=function(e,t){return this.stateManager.goTo(e,t)},t.prototype.whenLayerView=function(t){return e.prototype.whenLayerView.call(this,t)},t.prototype.takeScreenshot=function(e){var t=this;return this.whenReady().then((function(){var r=ve.toRenderSettings(e,t);return r.pixelRatio/=t.pixelRatio,t._stage.renderView.takeScreenshot(ve.screenshotSuperSampleSettings(r,t.supersampleScreenhotsEnabled,t.padding))}))},t.prototype.importLayerView=function(e){return j.layerView3DImporter.importLayerView(e)},t.prototype.hasLayerViewModule=function(e){return j.layerView3DImporter.hasLayerViewModule(e)},t.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()},t.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null},t.prototype.validate=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){if(e=ye.check(),h("safari")&&h("safari")<9&&(e=new p("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:h("safari")})),v.isSome(e))throw be.warn("#validate()",e.message),e;return[2]}))}))},t.prototype.isSpatialReferenceSupported=function(e,t,r){var n=e.isGeographic,i=e.isWebMercator,o=me.isSpatialReferenceSupported(e,"global"),a="local"===this.viewingMode,s=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(s){if(a&&n)return r&&r("Layer "+t.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!a&&!o)return r&&r("Layer "+t.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(n&&!o)return r&&r("Layer "+t.id+" is ignored because its spatial reference is geographic but unsupported"),!1;if(t)if(M.isTiledLayer(t)){var l,c=void 0;if(s?c=null!=(l=ue.getTiledLayerInfo(t,e,this.viewingMode)).tileInfo:(null==(l=ue.getTiledLayerInfo(t,e,"global")).tileInfo&&null!=(l=ue.getTiledLayerInfo(t,e,"local")).tileInfo&&i&&!this.ready&&(this.viewingMode="local"),c=null!=l.tileInfo),!c)return r&&r("Layer "+t.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((e.isWGS84||i)&&!a)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=e),s||this.ready||(this.viewingMode="global",r&&r("Viewing mode locked to global due to reprojectable layer "+t.id)),r&&r("Layer "+t.id+" is ignored because it supports server-side reprojection"),!1;return!0},t.prototype.whenReady=function(){var e=this;return m.create((function(t){e.ready?t(e):e._resolveWhenReady.push(t)}))},t.prototype.computeMapPointFromVec3d=function(e,t){var r=this.spatialReference||o.SpatialReference.WGS84;return te.vectorToVector(e,this.renderSpatialReference,e,r)||(r=o.SpatialReference.WGS84,te.vectorToVector(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new o.Point(e,r),t},t.prototype.engineToScreen=function(e,t){var r=b.createRenderScreenPointArray3();this.state.camera.projectPoint(e,r);var n=b.screenPointArrayToObject(r);return b.renderToScreen(this,n,t)},t.prototype.flushDisplayModifications=function(){this._stage.processDirty()},t.prototype.trackGraphicState=function(e){if(!e.graphic)return be.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;var t=this.getViewForGraphic(e.graphic),r=null,n=!1,i=function(t){!n&&v.isSome(t)&&"graphics3d"in t&&t.graphics3d&&t.graphics3d.graphicsCore&&(r=t.graphics3d.graphicsCore.trackGraphicState(e))};return v.isSome(t)?i(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((function(e){return i(e)}),(function(){})).catch((function(){})),{remove:function(){n=!0,v.isSome(r)&&(r.remove(),r=null)}}},t.prototype.maskOccludee=function(e){if(!e)return be.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;var t=this.getViewForGraphic(e),r=null,n=!1,i=function(t){!n&&v.isSome(t)&&"graphics3d"in t&&fe.occludeesSupported(t)&&(r=t.occlude(e))};return v.isSome(t)?i(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((function(e){return i(e)}),(function(){})).catch((function(){})),{remove:function(){n=!0,v.isSome(r)&&(r.remove(),r=null)}}},t.prototype.getViewForGraphic=function(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find((function(t){return t.layer===e.layer})):null},t.prototype.graphicChanged=function(e){v.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(e)},t.prototype.whenViewForGraphic=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r=this;return n.__generator(this,(function(n){switch(n.label){case 0:return e.layer!==this?[3,2]:[4,g.whenOnce(this,"graphicsView")];case 1:return n.sent(),[2,this.graphicsView];case 2:if(!e.layer||!this.map)throw new p("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?[2,m.create((function(t,n){var i=r.map.allLayers.on("change",(function(o){-1!==o.added.indexOf(e.layer)&&(i.remove(),r.whenLayerView(e.layer).then(t,n))}))}))]:[2,this.whenLayerView(e.layer)]}}))}))},t.prototype._intersectResultToMapPoint=function(e,t){if(e.getIntersectionPoint(Se)){t=this.computeMapPointFromVec3d(Se,t);var r=this.basemapTerrain;return"TerrainRenderer"===e.intersector&&r&&(t.z=Y.getElevationAtPoint(r,t)||0),t}return null},t.prototype._intersectResultsToHits=function(e,t){for(var r=new Array,n=null,i=0;i<e.length;i++){var o=e[i],a=o.toOwner(this);if(v.isSome(a)&&(a===this.map.ground||"type"in a&&"integrated-mesh"===a.type))break;var s=o.toGraphic(this);if(v.isSome(s)){if(v.isNone(n)&&i!==e.length-1&&(n=new Set),v.isSome(n)){var l=this._getGraphicFilterUid(s);if(n.has(l))continue;n.add(l)}if(this._testGraphicUidFilter(t,s)){var c=this._intersectResultToMapPoint(o),u=o.distanceInRenderSpace;r.push({graphic:s,mapPoint:c,distance:u})}}}return r},t.prototype._getGraphicFilterUid=function(e){if(e.layer&&"objectIdField"in e.layer){var t=e.attributes[e.layer.objectIdField];if(t)return"o-"+e.layer.id+"-"+t}return"u-"+e.uid},t.prototype._testGraphicUidFilter=function(e,t){var r=this._getGraphicFilterUid(t);return v.isNone(e)||(v.isNone(e.include)||e.include.has(r))&&(v.isNone(e.exclude)||!e.exclude.has(r))},t.prototype._externalToInternalRenderItems=function(e,t,r){var n=this;return void 0===r&&(r={layerUids:null,graphicUids:null}),e?(e instanceof a?(function(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}(r,this._getGraphicFilterUid(e)),0===t&&(v.isSome(this.graphicsView)&&e.layer===this?we(r,this.graphicsView.mockLayerId):e.layer&&we(r,e.layer.uid))):"forEach"in e?e.forEach((function(e){Array.isArray(e)?n._externalToInternalRenderItems(e,t,r):c.isCollection(e)?e===n.graphics&&v.isSome(n.graphicsView)?we(r,n.graphicsView.mockLayerId):n._externalToInternalRenderItems(e,t,r):e instanceof s?e===n.map.ground&&we(r,he.TERRAIN_ID):n._externalToInternalRenderItems(e,t,r)})):we(r,e.uid),r):r},t.prototype._externalToInternalIntersectOptions=function(e){var t=this._externalToInternalRenderItems(e.include,0),r=this._externalToInternalRenderItems(e.exclude,1);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}},t.prototype._viewingModeToManifold=function(e){switch(e){case"global":return"spherical";case"local":return"planar"}},t.prototype._initBasemapTerrain=function(e){this._set("basemapTerrain",new ce({view:this,manifold:this._viewingModeToManifold(e)})),this._set("elevationProvider",new J.CombinedElevationProvider({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)},t.prototype._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))},t.prototype._initGlobe=function(e){var t=this;this._initCoordinateSystem(),this._set("state",new H.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference})),this._initBasemapTerrain(e),this._set("pointsOfInterest",new le.default({view:this})),this._set("featureTiles",new G.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));var n=function(){var e=t.basemapTerrain&&t.basemapTerrain.extent;if(t.clippingArea||e)if(e&&t.basemapTerrain.spatialReference){var r=T.toExtent(t.basemapTerrain.extent,t.basemapTerrain.spatialReference);t.clippingArea?t.featureTiles.filterExtent=r.intersection(t.clippingArea):t.featureTiles.filterExtent=r}else t.featureTiles.filterExtent=t.clippingArea;else t.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(Z,"FEATURE_TILE_TREE_SHOW_TILES",(function(e){e&&t.featureTiles&&!t.featureTreeDebugger?t.updatingHandles.addPromise(new Promise((function(e,t){r.e(138).then(function(){var t=[r(2118)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))).then((function(e){var r=e.FeatureTileTree3DDebugger;!t.featureTreeDebugger&&Z.FEATURE_TILE_TREE_SHOW_TILES&&(t.featureTreeDebugger=new r({view:t}))})):e||!t.featureTreeDebugger||Z.FEATURE_TILE_TREE_SHOW_TILES||(t.featureTreeDebugger.destroy(),t.featureTreeDebugger=null)}),3),this.updatingHandles.add(this,"clippingArea",n,3),this.updatingHandles.add(this,"basemapTerrain.extent",n,3)],"feature-tiles"),this.stateManager.init()},t.prototype._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),v.isSome(this.state)&&(this.state.destroy(),this._set("state",null)),this._exitCoordinateSystem())},t.prototype._initCoordinateSystem=function(){var e=this;if(this.spatialReference){var t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new ee.default(this.map,t));var r="global"===this.viewingMode,n=r?te.SphericalECEFSpatialReference:t;n!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ie.RenderCoordsHelper.createMode(this.viewingMode,n)),r||this.handles.add(this.watch("basemapTerrain.extent",(function(t){0===t[0]&&0===t[1]&&0===t[2]&&0===t[3]||(e.renderCoordsHelper.extent=t)}),!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(de.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)},t.prototype._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))},t.prototype.updatingChanged=function(){this.notifyChange("updating")},t.prototype._updateUpdatingMonitors=function(){var e=this;this.handles.remove("updatingMonitors"),this.allLayerViews.forEach((function(t){t.destroyed||(e.handles.add([t.watch(["updating","updatingProgress"],(function(){return e.updatingChanged()}),!0)],"updatingMonitors"),t.when((function(){return e.updatingChanged()}),(function(){return e.updatingChanged()})))})),this.updatingChanged()},t.prototype._renderScreenshotOverlay=function(e,t){if(this.overlay&&this.overlay.hasVisibleItems){var r=e.getContext("2d");r.putImageData(t,0,0),this.overlay.renderCanvas(e);for(var n=r.getImageData(0,0,t.width,t.height),i=0;i<n.data.length;i++)t.data[i]=n.data[i]}},t.prototype._initStage=function(){var e=this,t={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:this.viewingMode,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(t,r){return e._renderScreenshotOverlay(t,r)}}},r=new W.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(t){e._stage.getLayers().forEach(t)}},this);this._set("sceneIntersectionHelper",r);var n=u.byId(this.surface);this._stage=new pe.Stage({viewingMode:this.viewingMode,container:n,options:t,sceneIntersectionHelper:r}),this._lostWebGLContextHandle=d.on(this._stage.renderView.getCanvas(),"webglcontextlost",(function(){return e.fatalError=new p("webgl-context-lost")})),this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",(function(){e._stage.renderView.setRenderParameters({antialiasingEnabled:e.qualitySettings.antialiasingEnabled})}),2),"stage");for(var i=function(){e._stage.renderView.setRenderParameters({defaultHighlightOptions:K.toEngineOptions(e.highlightOptions)})},o=0,a=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity"];o<a.length;o++){var s=a[o];this.handles.add(this.updatingHandles.add(this,s,i),"stage")}i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(de.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.getCanvas())},t.prototype._exitStage=function(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)},t.prototype._initSurface=function(){this._exitSurface(),this._initStage(),this._initGlobe(this.viewingMode),this.sharedSymbolResources=new ae.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new B.ObjectResourceCache})},t.prototype._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())},t.prototype._createGraphicsViewIfNeeded=function(){var e=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view"),this._createGraphicsViewController=m.createAbortController();var t=function(){e._createGraphicsViewController=null,e.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this.updatingChanged()}},t.prototype._createGraphicsViewAsync=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.all([r.e(8),r.e(77)]).then(function(){var t=[r(2119)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return t=n.sent(),m.throwIfAborted(e),[4,g.whenTrueOnce(this.basemapTerrain,"ready",e)];case 2:return n.sent(),this._set("graphicsView",new t({view:this})),[2]}}))}))},t.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))},t.prototype._startup=function(){var e=this;if("global"===this.viewingMode&&(this._clippingArea=null),this._set("ready",!0),this._initSurface(),this.handles.add(g.on(this,"graphics","after-changes",(function(){return e._createGraphicsViewIfNeeded()})),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){var t=this.get("map.initialViewProperties.environment");t&&(this.environment=t)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();var r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach((function(t){return t(e)}))},t.prototype._teardown=function(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)},t.prototype._updateDefaultToMapOptions=function(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(he.TERRAIN_ID);for(var e=0,t=this.map.allLayers.items;e<t.length;e++){var r=t[e];"integrated-mesh"===r.type&&this._defaultToMapOptions.include.add(r.uid)}}},t.prototype._updateDefaultHitTestOptions=function(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(he.TERRAIN_ID);for(var e=0,t=this.map.allLayers.items;e<t.length;e++){var r=t[e];"integrated-mesh"===r.type&&r.opacity<1&&this._defaultToMapOptions.exclude.add(r.uid)}}},n.__decorate([x.property()],t.prototype,"_resourceController",void 0),n.__decorate([x.property()],t.prototype,"_stage",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"deconflictor",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"labeler",void 0),n.__decorate([x.property({type:L,readOnly:!0,aliasOf:"state.animation"})],t.prototype,"animation",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"basemapTerrain",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"elevationProvider",void 0),n.__decorate([x.property({type:i,aliasOf:"stateManager.camera"})],t.prototype,"camera",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"canvas",void 0),n.__decorate([x.property({type:o.Point,aliasOf:"stateManager.center"})],t.prototype,"center",void 0),n.__decorate([x.property({type:o.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],t.prototype,"clippingArea",null),n.__decorate([x.property({type:V.default})],t.prototype,"constraints",void 0),n.__decorate([x.property({type:o.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],t.prototype,"dataExtent",null),n.__decorate([x.property({value:null,type:F})],t.prototype,"environment",null),n.__decorate([x.cast("environment")],t.prototype,"castEnvironment",null),n.__decorate([x.property({readOnly:!0})],t.prototype,"environmentManager",void 0),n.__decorate([x.property({type:o.Extent,aliasOf:"stateManager.extent"})],t.prototype,"extent",void 0),n.__decorate([x.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],t.prototype,"screenCenter",void 0),n.__decorate([x.property({type:Number,dependsOn:["maximumPixelRatio"]})],t.prototype,"pixelRatio",null),n.__decorate([x.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],t.prototype,"maximumPixelRatio",null),n.__decorate([x.property({aliasOf:"stateManager.frustum"})],t.prototype,"frustum",void 0),n.__decorate([x.property({type:Number,readOnly:!0})],t.prototype,"fullOpacity",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"graphicsView",void 0),n.__decorate([x.property({type:o.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],t.prototype,"groundExtent",null),n.__decorate([x.property()],t.prototype,"groundView",void 0),n.__decorate([x.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],t.prototype,"initialExtentRequired",null),n.__decorate([x.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],t.prototype,"interacting",null),n.__decorate([x.property({dependsOn:["animation","resizing","state.stationary"]})],t.prototype,"stationary",null),n.__decorate([x.property({aliasOf:"state.navigating"})],t.prototype,"navigating",void 0),n.__decorate([x.property()],t.prototype,"map",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"mapCoordsHelper",void 0),n.__decorate([x.property({aliasOf:"stateManager.padding"})],t.prototype,"padding",void 0),n.__decorate([x.property({type:le.default,readOnly:!0})],t.prototype,"pointsOfInterest",void 0),n.__decorate([x.property({type:G.default,readOnly:!0})],t.prototype,"featureTiles",void 0),n.__decorate([x.property()],t.prototype,"featureTreeDebugger",void 0),n.__decorate([x.property({type:Boolean})],t.prototype,"screenSizePerspectiveEnabled",void 0),n.__decorate([x.property({constructOnly:!0})],t.prototype,"deactivatedWebGLExtensions",void 0),n.__decorate([x.property({constructOnly:!0})],t.prototype,"debugWebGLExtensions",void 0),n.__decorate([x.property({constructOnly:!0})],t.prototype,"renderCanvas",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"state",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"inputManager",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"stateManager",void 0),n.__decorate([x.property({type:["low","medium","high"]})],t.prototype,"qualityProfile",null),n.__decorate([x.property({type:ne,get:function(){var e=this._get("qualitySettings");return e||(e=new ne,X.apply(this.qualityProfile,e)),e}})],t.prototype,"qualitySettings",void 0),n.__decorate([x.property()],t.prototype,"slicePlane",null),n.__decorate([x.property({dependsOn:["viewingMode"]})],t.prototype,"preconditionsReady",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"renderCoordsHelper",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"sceneIntersectionHelper",void 0),n.__decorate([x.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],t.prototype,"resolution",null),n.__decorate([x.property({type:Number,aliasOf:"stateManager.scale"})],t.prototype,"scale",void 0),n.__decorate([x.property()],t.prototype,"heightModelInfo",null),n.__decorate([x.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],t.prototype,"spatialReference",void 0),n.__decorate([x.property({type:Boolean,constructOnly:!0})],t.prototype,"alphaCompositingEnabled",void 0),n.__decorate([x.property({type:Boolean})],t.prototype,"supersampleScreenhotsEnabled",void 0),n.__decorate([x.property({readOnly:!0})],t.prototype,"type",void 0),n.__decorate([x.property({type:ge})],t.prototype,"ui",void 0),n.__decorate([x.property({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","_resourceController.updating","_stage.renderView.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs"]})],t.prototype,"updating",null),n.__decorate([x.property({type:Number,readOnly:!0,dependsOn:["updating"]})],t.prototype,"updatingProgress",void 0),n.__decorate([x.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],t.prototype,"viewingMode",null),n.__decorate([x.property({type:l,aliasOf:"stateManager.viewpoint"})],t.prototype,"viewpoint",void 0),n.__decorate([x.property({type:Number,aliasOf:"stateManager.zoom"})],t.prototype,"zoom",void 0),n.__decorate([x.property({type:K})],t.prototype,"highlightOptions",void 0),n.__decorate([x.subclass("esri.views.SceneView")],t)}(A.BreakpointsOwner(E.DOMContainer(R.PopupView(D))));function we(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}var Se=S.vec3f64.create();return xe}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(171),r(189),r(185),r(162),r(160),r(245),r(201),r(203),r(251),r(794),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e,t,r){void 0===e&&(e=s.vec3f64.create()),void 0===t&&(t=s.vec3f64.create()),void 0===r&&(r=s.vec3f64.fromValues(0,0,1)),this._viewUp=s.vec3f64.create(),this._viewForward=s.vec3f64.create(),this._viewRight=s.vec3f64.create(),this._ray=u.ray.createWrapper(),this._viewport=c.vec4f64.fromValues(0,0,1,1),this._padding=c.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=o.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=o.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=o.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=o.mat4f64.create(),this._frustumDirty=!0,this._frustum=u.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=s.vec3f64.clone(e),this._center=s.vec3f64.clone(t),this._up=s.vec3f64.clone(r),this._padding=c.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=s.vec3f64.create()),a.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){i.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=c.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),l.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(i.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),n=r*this.aspect;i.mat4.frustum(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){i.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return h.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=h.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return h.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=h.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return a.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=o.mat4f64.create()),i.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),i.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),e.prototype.depthNDCToWorld=function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))},Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){var t=e;return a.vec3.copy(this._eye,t._eye),a.vec3.copy(this._center,t._center),a.vec3.copy(this._up,t._up),l.vec4.copy(this._viewport,t._viewport),l.vec4.copy(this._padding,t._padding),this._near=t._near,this._far=t._far,this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(i.mat4.copy(this._viewMatrix,t._viewMatrix),a.vec3.copy(this._viewRight,t._viewRight),a.vec3.copy(this._viewUp,t._viewUp),a.vec3.copy(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(i.mat4.copy(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(u.frustum.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?i.mat4.copy(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=o.mat4f64.clone(t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),t._fullViewport?this._fullViewport?l.vec4.copy(this._fullViewport,t._fullViewport):this._fullViewport=c.vec4f64.clone(t._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return a.vec3.exactEquals(this._eye,e._eye)&&a.vec3.exactEquals(this._center,e._center)&&a.vec3.exactEquals(this._up,e._up)&&l.vec4.exactEquals(this._viewport,e._viewport)&&l.vec4.exactEquals(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation},e.prototype.almostEquals=function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e._fov-this._fov)>=.001)return!1;a.vec3.sub(y,e._eye,e._center),a.vec3.sub(g,this._eye,this._center);var t=a.vec3.dot(y,g),r=a.vec3.sqrLen(y),n=a.vec3.sqrLen(g);return t*t>=(1-1e-10)*r*n&&a.vec3.sqrDist(e._eye,this._eye)<5e-4*Math.max(r,n)*5e-4&&l.vec4.squaredDistance(e._padding,this._padding)<.5&&l.vec4.squaredDistance(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(d.projectPointSignedLength(this.viewForward,a.vec3.subtract(y,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=n.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e,t,r){return void 0===t&&(t=.5),void 0===r&&(r=.5),e||(e=n.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,n){void 0===n&&(n=!1),e!==v&&a.vec3.copy(v,e),v[3]=1,n&&(t[2]=-v[2]),l.vec4.transformMat4(v,v,this.projectionMatrix),a.vec3.scale(v,v,1/Math.abs(v[3]));var i=this.fullViewport;return t[0]=r.lerp(0,i[0]+i[2],.5+.5*v[0]),t[1]=r.lerp(0,i[1]+i[3],.5+.5*v[1]),n||(t[2]=.5*(v[2]+1)),t},e.prototype.projectPoint=function(e,t){if(v[0]=e[0],v[1]=e[1],v[2]=e[2],v[3]=1,l.vec4.transformMat4(v,v,this.viewProjectionMatrix),0===v[3])return null;a.vec3.scale(v,v,1/Math.abs(v[3]));var n=this.fullViewport;return"x"in t?(t.x=r.lerp(0,n[0]+n[2],.5+.5*v[0]),t.y=r.lerp(0,n[1]+n[3],.5+.5*v[1])):(t[0]=r.lerp(0,n[0]+n[2],.5+.5*v[0]),t[1]=r.lerp(0,n[1]+n[3],.5+.5*v[1]),t.length>2&&(t[2]=.5*(v[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(i.mat4.multiply(m,this.projectionMatrix,this.viewMatrix),!i.mat4.invert(m,m))return null;var r=this.fullViewport;return v[0]=2*(e[0]-r[0])/r[2]-1,v[1]=2*(e[1]-r[1])/r[3]-1,v[2]=2*e[2]-1,v[3]=1,l.vec4.transformMat4(v,v,m),0===v[3]?null:(t[0]=v[0]/v[3],t[1]=v[1]/v[3],t[2]=v[2]/v[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var r=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=n,t},e.prototype.renderToScreen=function(e,t){var r=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=r,t[1]=n,t},e.prototype.computeUpGlobal=function(){a.vec3.subtract(y,this.center,this.eye);var e=a.vec3.length(this.center);e<1?(a.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(a.vec3.dot(y,this.center))>.9999*a.vec3.length(y)*e||(a.vec3.cross(this.up,y,this.center),a.vec3.cross(this.up,this.up,y),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){p.directionFromTo(y,this.eye,this.center),Math.abs(y[2])<=.9999&&(a.vec3.scale(y,y,y[2]),a.vec3.set(this.up,-y[0],-y[1],1-y[2]),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){a.vec3.exactEquals(e,t)||(a.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(u.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(i.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),a.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),a.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),a.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}();t.default=f;var v=c.vec4f64.create(),m=o.mat4f64.create(),y=s.vec3f64.create(),g=s.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(272),r(276),r(444),r(600),r(647),r(162),r(389),r(160),r(245),r(201),r(193),r(1833),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=a.quatf64.create(),m=c.vec3f64.create(),y=c.vec3f64.create(),g=p.vec4f64.create(),_=n.mat3f64.create();function b(e,t,r){return void 0===e&&(e=[0,0,0]),void 0===t&&(t=[-1,-1,-1]),void 0===r&&(r=[0,0,0,1]),{center:c.vec3f64.clone(e),halfSize:l.vec3f32.clone(t),quaternion:o.quatf32.clone(r)}}function x(e,t){var r=f.plane.signedDistance(t,e.center),n=C(e,t);return r>n?1:r<-n?-1:0}t.ObbArray=function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:c.vec3f64.createView(this.buffer,56*r+0),halfSize:l.vec3f32.createView(this.buffer,56*r+24),quaternion:o.quatf32.createView(this.buffer,56*r+36)}},t.create=b,t.clone=function(e){return b(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){s.vec3.copy(t.center,e.center),s.vec3.copy(t.halfSize,e.halfSize),i.quat.copy(t.quaternion,e.quaternion)},t.compute=function(e,t){return t=t||b(),h.computeOBB(e,t),t},t.intersectPlane=x,t.toAaBoundingBox=function(e,t){t||(t=d.create());var n=r.mat3.fromQuat(_,e.quaternion),i=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),o=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),a=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-o,t[2]=e.center[2]-a,t[3]=e.center[0]+i,t[4]=e.center[1]+o,t[5]=e.center[2]+a,t},t.minimumDistancePlane=function(e,t){return f.plane.signedDistance(t,e.center)-C(e,t)},t.maximumDistancePlane=function(e,t){return f.plane.signedDistance(t,e.center)+C(e,t)},t.isVisible=function(e,t){return x(e,t.planes[0])<=0&&x(e,t.planes[1])<=0&&x(e,t.planes[2])<=0&&x(e,t.planes[3])<=0&&x(e,t.planes[4])<=0&&x(e,t.planes[5])<=0},t.intersectLine=function(e,t,r,n){void 0===n&&(n=0),i.quat.conjugate(v,e.quaternion),s.vec3.subtract(m,t,e.center);for(var o=s.vec3.transformQuat(m,m,v),a=s.vec3.transformQuat(y,r,v),l=-1/0,c=1/0,u=0;u<3;u++)if(Math.abs(a[u])>1e-6){var p=(n+e.halfSize[u]-o[u])/a[u],d=(-n-e.halfSize[u]-o[u])/a[u];l=Math.max(l,Math.min(p,d)),c=Math.min(c,Math.max(p,d))}else if(o[u]>e.halfSize[u]+n||o[u]<-e.halfSize[u]-n)return!1;return l<=c},t.projectedArea=function(e,t,n,o,a){i.quat.conjugate(v,e.quaternion),s.vec3.sub(m,t,e.center),s.vec3.transformQuat(m,m,v);var l=m[0]<-e.halfSize[0]?-1:m[0]>e.halfSize[0]?1:0,c=m[1]<-e.halfSize[1]?-1:m[1]>e.halfSize[1]?1:0,p=m[2]<-e.halfSize[2]?-1:m[2]>e.halfSize[2]?1:0,d=Math.abs(l)+Math.abs(c)+Math.abs(p);if(0===d)return 1/0;var h=1===d?4:6,f=6*(l+3*c+9*p+13);r.mat3.fromQuat(_,e.quaternion),r.mat3.scale(_,_,e.halfSize);for(var y=0;y<h;y++){var b=O[f+y];s.vec3.set(m,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),s.vec3.transformMat3(m,m,_),s.vec3.add(g,e.center,m),g[3]=1,u.vec4.transformMat4(g,g,n);var x=1/Math.max(1e-6,g[3]);T[2*y]=g[0]*x,T[2*y+1]=g[1]*x}var w=2*h-2,S=T[0]*(T[3]-T[w+1])+T[w]*(T[1]-T[w-1]);for(y=2;y<w;y+=2)S+=T[y]*(T[y+3]-T[y-1]);return Math.abs(S)*o*a*.125};var w,S,P,T=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],O=(w=new Int8Array(162),S=0,(P=function(e){for(var t=0;t<e.length;t++)w[S+t]=e[t];S+=6})([6,2,3,1,5,4]),P([0,2,3,1,5,4]),P([0,2,3,7,5,4]),P([0,1,3,2,6,4]),P([0,1,3,2,0,0]),P([0,1,5,7,3,2]),P([0,1,3,7,6,4]),P([0,1,3,7,6,2]),P([0,1,5,7,6,2]),P([0,1,5,4,6,2]),P([0,1,5,4,0,0]),P([0,1,3,7,5,4]),P([0,2,6,4,0,0]),P([0,0,0,0,0,0]),P([1,3,7,5,0,0]),P([2,3,7,6,4,0]),P([2,3,7,6,0,0]),P([2,3,1,5,7,6]),P([0,1,5,7,6,2]),P([0,1,5,7,6,4]),P([0,1,3,7,6,4]),P([4,5,7,6,2,0]),P([4,5,7,6,0,0]),P([4,5,1,3,7,6]),P([0,2,3,7,5,4]),P([6,2,3,7,5,4]),P([6,2,3,1,5,4]),w);function C(e,t){i.quat.conjugate(v,e.quaternion),s.vec3.transformQuat(m,t,v);var r=e.halfSize;return Math.abs(m[0]*r[0])+Math.abs(m[1]*r[1])+Math.abs(m[2]*r[2])}t.projectedRadius=C,t.corners=function(e,t){for(var r=0;r<8;++r){var n=t[r];n[0]=1&r?-e.halfSize[0]:e.halfSize[0],n[1]=2&r?-e.halfSize[1]:e.halfSize[1],n[2]=4&r?-e.halfSize[2]:e.halfSize[2],s.vec3.transformQuat(n,n,e.quaternion),s.vec3.add(n,n,e.center)}}}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=0;t.IdentifiableMixin=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return Object.defineProperty(n,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+i++}),n}return r.__extends(t,e),r.__decorate([n.subclass("esri.core.Identifiable")],t)}(e)};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([n.subclass("esri.core.Identifiable")],t)}(t.IdentifiableMixin((function(){})));t.Identifiable=o}.apply(null,n))||(e.exports=i)},,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(117),i=r(122),o=r(853),a=r(1098),s=r(123),l=r(850);if(s.default("es6-array")&&s.default("es6-array-fill"))t.from=i.default.Array.from,t.of=i.default.Array.of,t.copyWithin=l.wrapNative(i.default.Array.prototype.copyWithin),t.fill=l.wrapNative(i.default.Array.prototype.fill),t.find=l.wrapNative(i.default.Array.prototype.find),t.findIndex=l.wrapNative(i.default.Array.prototype.findIndex);else{var c=function(e){return isNaN(e)?0:(e=Number(e),isFinite(e)&&(e=Math.floor(e)),Math.min(Math.max(e,0),a.MAX_SAFE_INTEGER))},u=function(e){return e=Number(e),isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e},p=function(e,t){return e<0?Math.max(t+e,0):Math.min(e,t)};t.from=function(e,t,r){if(null==e)throw new TypeError("from: requires an array-like object");t&&r&&(t=t.bind(r));var i,a,s=c(e.length),l="function"==typeof this?Object(new this(s)):new Array(s);if(!o.isArrayLike(e)&&!o.isIterable(e))return l;if(o.isArrayLike(e)){if(0===s)return[];for(var u=0;u<e.length;u++)l[u]=t?t(e[u],u):e[u]}else{u=0;try{for(var p=n.__values(e),d=p.next();!d.done;d=p.next()){var h=d.value;l[u]=t?t(h,u):h,u++}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}return void 0!==e.length&&(l.length=s),l},t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Array.prototype.slice.call(e)},t.copyWithin=function(e,t,r,n){if(null==e)throw new TypeError("copyWithin: target must be an array-like object");var i=c(e.length);t=p(u(t),i),r=p(u(r),i),n=p(void 0===n?i:u(n),i);var o=Math.min(n-r,i-t),a=1;for(t>r&&t<r+o&&(a=-1,r+=o-1,t+=o-1);o>0;)r in e?e[t]=e[r]:delete e[t],t+=a,r+=a,o--;return e},t.fill=function(e,t,r,n){var i=c(e.length),o=p(u(r),i);for(n=p(void 0===n?i:u(n),i);o<n;)e[o++]=t;return e},t.find=function(e,r,n){var i=t.findIndex(e,r,n);return-1!==i?e[i]:void 0},t.findIndex=function(e,t,r){var n=c(e.length);if(!t)throw new TypeError("find: second argument must be a function");r&&(t=t.bind(r));for(var i=0;i<n;i++)if(t(e[i],i,e))return i;return-1}}if(s.default("es7-array"))t.includes=l.wrapNative(i.default.Array.prototype.includes);else{t.includes=function(e,t,r){void 0===r&&(r=0);for(var n,i=(n=e.length,n=Number(n),isNaN(n)?0:(isFinite(n)&&(n=Math.floor(n)),Math.min(Math.max(n,0),a.MAX_SAFE_INTEGER))),o=r;o<i;++o){var s=e[o];if(t===s||t!=t&&s!=s)return!0}return!1}}},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(169),r(155),r(118),r(156),r(153),r(198),r(151),r(179),r(191),r(1104),r(769),r(519),r(1448),r(1449),r(1105),r(518),r(1106),r(1107),r(764),r(768),r(1112),r(337),r(480),r(520)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C){var M=i.ofType({key:"type",defaultKeyValue:"button",base:T,typeMap:{button:O,toggle:C}}),A={base:_,key:"type",typeMap:{media:w,custom:b,text:S,attachments:g,fields:x}},E=s.getLogger("esri.PopupTemplate"),I=["attachments","fields","media","text"];return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.actions=null,t.content="",t.expressionInfos=null,t.fieldInfos=null,t.layerOptions=null,t.lastEditInfoEnabled=!0,t.outFields=null,t.overwriteActions=!1,t.title="",t.relatedRecordsInfo=null,t}var o;return r.__extends(t,e),o=t,t.prototype.castContent=function(e){return Array.isArray(e)?e.map((function(e){return p.ensureOneOfType(A,e)})):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||l.isPromiseLike(e)?e:(E.error("content error","unsupported content value",{value:e}),null)},t.prototype.readContent=function(e,t){var r=t.popupElements;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)},t.prototype.writeContent=function(e,t){var r=this;"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((function(e){return-1!==I.indexOf(e.type)})).map((function(e){return e&&e.toJSON()})),t.popupElements.forEach((function(e){"attachments"===e.type?r._writeAttachmentContent(t):"media"===e.type?r._writeMediaContent(e,t):"text"===e.type&&r._writeTextContent(e,t)}))):t.description=e},t.prototype.writeFieldInfos=function(e,t){var r=this.content,n=Array.isArray(r)?r:null;if(e){var i=!!n&&n.some((function(e){return"fields"===e.type&&(!e.fieldInfos||0===e.fieldInfos.length)}));t.fieldInfos=e.filter(Boolean).map((function(e){var t=e.toJSON();return i||(t.visible=!1),t}))}if(n)for(var o=0,a=n;o<a.length;o++){var s=a[o];"fields"===s.type&&this._writeFieldsContent(s,t)}},t.prototype.writeLayerOptions=function(e,t){t.layerOptions=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON()},t.prototype.writeTitle=function(e,t){t.title=e||""},t.prototype.clone=function(){var e=this.actions,t=e?a.clone(e.toArray()):[];return new o({actions:t,content:Array.isArray(this.content)?a.clone(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?a.clone(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?a.clone(this.fieldInfos):null,layerOptions:this.layerOptions?a.clone(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?a.clone(this.outFields):null,overwriteActions:this.overwriteActions,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?a.clone(this.relatedRecordsInfo):null})},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return[4,this._collectExpressionInfoFields(e,t,this.expressionInfos)];case 1:return n.sent(),d.collectFields(e,t,r.__spreadArrays(this.outFields||[],this._getActionsFields(this.actions),this._getTitleFields(this.title),this._getContentFields(this.content))),[2]}}))}))},t.prototype.getRequiredFields=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return t=new Set,[4,this.collectRequiredFields(t,e)];case 1:return r.sent(),[2,c.valuesOfSet(t).sort()]}}))}))},t.prototype._writeFieldsContent=function(e,t){if(Array.isArray(e.fieldInfos)&&e.fieldInfos.length){var r=a.clone(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach((function(e){var r=n.find(t.fieldInfos,(function(t){return t.fieldName.toLowerCase()===e.fieldName.toLowerCase()}));r?r.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=r}},t.prototype._writeAttachmentContent=function(e){e.showAttachments||(e.showAttachments=!0)},t.prototype._writeTextContent=function(e,t){!t.description&&e.text&&(t.description=e.text)},t.prototype._writeMediaContent=function(e,t){if(Array.isArray(e.mediaInfos)&&e.mediaInfos.length){var n=a.clone(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=r.__spreadArrays(t.mediaInfos,n):t.mediaInfos=n}},t.prototype._readPopupInfoElements=function(e){var t=e.description,r=e.mediaInfos,n=e.popupElements,i={description:!1,mediaInfos:!1};return n.map((function(e){return"media"===e.type?(e.mediaInfos||!r||i.mediaInfos||(e.mediaInfos=r,i.mediaInfos=!0),w.fromJSON(e)):"text"===e.type?(e.text||!t||i.description||(e.text=t,i.description=!0),S.fromJSON(e)):"attachments"===e.type?g.fromJSON(e):"fields"===e.type?x.fromJSON(e):void 0})).filter(Boolean)},t.prototype._readPopupInfo=function(e){var t=e.description,r=e.mediaInfos,n=e.showAttachments,i=[];return t?i.push(new S({text:t})):i.push(new x),Array.isArray(r)&&r.length&&i.push(w.fromJSON({mediaInfos:r})),n&&i.push(g.fromJSON({displayType:"list"})),i.length?i:t},t.prototype._getContentElementFields=function(e){var t=this;return e&&"attachments"!==e.type?"custom"===e.type?e.outFields||[]:"fields"===e.type?this._getFieldInfoFields(e.fieldInfos||this.fieldInfos):"media"===e.type?(e.mediaInfos||[]).reduce((function(e,n){return r.__spreadArrays(e,t._getMediaInfoFields(n))}),[]):"text"===e.type?this._extractFieldNames(e.text):void 0:[]},t.prototype._getMediaInfoFields=function(e){var t=e.caption,n=e.title,i=e.value||{},o=i.fields,a=void 0===o?[]:o,s=i.normalizeField,l=i.tooltipField,c=i.sourceURL,u=i.linkURL,p=r.__spreadArrays(this._extractFieldNames(n),this._extractFieldNames(t),this._extractFieldNames(c),this._extractFieldNames(u),a);return s&&p.push(s),l&&p.push(l),p},t.prototype._getContentFields=function(e){var t=this;return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce((function(e,n){return r.__spreadArrays(e,t._getContentElementFields(n))}),[]):[]},t.prototype._collectExpressionInfoFields=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return n?[4,l.all(n.map((function(r){return d.collectArcadeFieldNames(e,t,r.expression)})))]:[2];case 1:return r.sent(),[2]}}))}))},t.prototype._getFieldInfoFields=function(e){return e?e.filter((function(e){return void 0===e.visible||!!e.visible})).map((function(e){return e.fieldName})).filter((function(e){return-1===e.indexOf("relationships/")&&-1===e.indexOf("expression/")})):[]},t.prototype._getActionsFields=function(e){var t=this;return e?e.toArray().reduce((function(e,n){return r.__spreadArrays(e,t._getActionFields(n))}),[]):[]},t.prototype._getActionFields=function(e){var t=e.className,n=e.title,i=e.type,o="button"===i||"toggle"===i?e.image:"";return r.__spreadArrays(this._extractFieldNames(n),this._extractFieldNames(t),this._extractFieldNames(o))},t.prototype._getTitleFields=function(e){return"string"==typeof e?this._extractFieldNames(e):[]},t.prototype._extractFieldNames=function(e){if(!e||"string"!=typeof e)return[];var t=e.match(/{[^}]*}/g);if(!t)return[];var r=/\{(\w+):.+\}/,n=t.filter((function(e){return!(0===e.indexOf("{relationships/")||0===e.indexOf("{expression/"))})).map((function(e){return e.replace(r,"{$1}")}));return n?n.map((function(e){return e.slice(1,-1)})):[]},r.__decorate([u.property({type:M})],t.prototype,"actions",void 0),r.__decorate([u.property()],t.prototype,"content",void 0),r.__decorate([u.cast("content")],t.prototype,"castContent",null),r.__decorate([u.reader("content",["description","popupElements","mediaInfos","showAttachments"])],t.prototype,"readContent",null),r.__decorate([u.writer("content",{popupElements:{type:i.ofType(h.types)},showAttachments:{type:Boolean},mediaInfos:{type:i.ofType(P.types)},description:{type:String}})],t.prototype,"writeContent",null),r.__decorate([u.property({type:[f],json:{write:!0}})],t.prototype,"expressionInfos",void 0),r.__decorate([u.property({type:[v]})],t.prototype,"fieldInfos",void 0),r.__decorate([u.writer("fieldInfos")],t.prototype,"writeFieldInfos",null),r.__decorate([u.property({type:m})],t.prototype,"layerOptions",void 0),r.__decorate([u.writer("layerOptions")],t.prototype,"writeLayerOptions",null),r.__decorate([u.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],t.prototype,"lastEditInfoEnabled",void 0),r.__decorate([u.property()],t.prototype,"outFields",void 0),r.__decorate([u.property()],t.prototype,"overwriteActions",void 0),r.__decorate([u.property({json:{type:String}})],t.prototype,"title",void 0),r.__decorate([u.writer("title")],t.prototype,"writeTitle",null),r.__decorate([u.property({type:y,json:{write:!0}})],t.prototype,"relatedRecordsInfo",void 0),o=r.__decorate([u.subclass("esri.PopupTemplate")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshableLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshInterval=0,t}return r.__extends(t,e),t.prototype.refresh=function(){this.emit("refresh")},r.__decorate([n.property({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),r.__decorate([n.subclass("esri.layers.mixins.RefreshableLayer")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(168),r(152)],void 0===(i=function(e,t,r,n,i,o){return function(){function e(t,i,o){void 0===o&&(o=null),this._context=null,this._glName=null,this._id=-1,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._descriptor=r.__assign({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},i),this._id=++e._nextId,n("esri-webgl-debug")&&t.instanceCounter.increment(0,this),this.setData(o)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._descriptor},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context&&this._context.gl){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach((function(t){e._context.bindTexture(null,t)})),t.deleteTexture(this._glName),this._glName=null}n("esri-webgl-debug")&&this._context.instanceCounter.decrement(0,this),this._context=null}},e.prototype.release=function(){this.dispose()},e.prototype.resize=function(e,t){var r=this._descriptor;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var n=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._descriptor;e._validateTexture(i),r.pixelStorei(r.UNPACK_ALIGNMENT,i.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.preMultiplyAlpha?1:0);var a=i.pixelFormat,s=i.internalFormat?i.internalFormat:a;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){var l=t.width,c=t.height;t instanceof HTMLVideoElement&&(l=t.videoWidth,c=t.videoHeight),i.width&&i.height&&console.assert(l===i.width&&c===i.height),r.texImage2D(r.TEXTURE_2D,0,s,a,i.dataType,t),i.hasMipmap&&this.generateMipmap(),void 0===i.width&&(i.width=l),void 0===i.height&&(i.height=c)}else if(null!=i.width&&null!=i.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&s===r.DEPTH_STENCIL&&(s=r.DEPTH24_STENCIL8),l=i.width,c=i.height,function(e){return o.isSome(e)&&"type"in e&&"compressed"===e.type}(t)){var u=Math.round(Math.log(Math.max(l,c))/Math.LN2)+1;i.hasMipmap=i.hasMipmap&&u===t.levels.length;for(var p=0;;++p){var d=t.levels[Math.min(p,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,p,s,l,c,0,d),1===l&&1===c||!i.hasMipmap)break;l=Math.max(1,l>>1),c=Math.max(1,c>>1)}}else if(o.isSome(t))r.texImage2D(r.TEXTURE_2D,0,s,l,c,0,a,i.dataType,t),i.hasMipmap&&this.generateMipmap();else for(p=0;r.texImage2D(r.TEXTURE_2D,p,s,l,c,0,a,i.dataType,null),(1!==l||1!==c)&&i.hasMipmap;++p)l=Math.max(1,l>>1),c=Math.max(1,c>>1);e._applySamplingMode(r,this._descriptor),e._applyWrapMode(r,this._descriptor),e._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(n,0)},e.prototype.updateData=function(e,t,r,n,i,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var a=this._context.gl,s=this._descriptor,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||r<0||n>s.width||i>s.height||t+n>s.width||r+i>s.height)&&console.error("An attempt to update out of bounds of the texture!"),a.pixelStorei(a.UNPACK_ALIGNMENT,s.unpackAlignment),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,s.flipped?1:0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.preMultiplyAlpha?1:0),o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?a.texSubImage2D(a.TEXTURE_2D,e,t,r,s.pixelFormat,s.dataType,o):a.texSubImage2D(a.TEXTURE_2D,e,t,r,n,i,s.pixelFormat,s.dataType,o),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._descriptor;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var n=this._context.gl;n.generateMipmap(n.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,e._validateTexture(this._descriptor),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,e._validateTexture(this._descriptor),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._validateTexture=function(e){(e.width<0||e.height<0)&&console.error("Negative dimension parameters are not allowed!"),i.isPowerOfTwo(e.width)&&i.isPowerOfTwo(e.height)||("number"==typeof e.wrapMode?33071!==e.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===e.wrapMode.s&&33071===e.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))},e._applySamplingMode=function(e,t){var r=t.samplingMode,n=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(n=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(n=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var n=e.gl;n.texParameterf(n.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(153),r(151)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){var t=this;this.instance=e,this._resolver=i.createDeferred(),this._status=void 0,this._resolvingPromises=[],this._resolver.promise.then((function(){t._status=0,t._cleanUp()}),(function(){t._status=1,t._cleanUp()}))}return e.prototype.addResolvingPromise=function(e){this._resolvingPromises.push(e),this._tryResolve()},e.prototype.isResolved=function(){return 0===this._status},e.prototype.isRejected=function(){return 1===this._status},e.prototype.isFulfilled=function(){return null!=this._status},e.prototype.abort=function(){this._resolver.reject(i.createAbortError())},e.prototype.when=function(e,t){return this._resolver.promise.then(e,t)},e.prototype._cleanUp=function(){this._allPromise=this._resolvingPromises=this._allPromise=null},e.prototype._tryResolve=function(){var e=this;if(!this.isFulfilled()){var t=i.createDeferred(),n=r.__spreadArrays(this._resolvingPromises,[t.promise]),o=this._allPromise=i.all(n);o.then((function(){e.isFulfilled()||e._allPromise!==o||e._resolver.resolve(e.instance)}),(function(t){e.isFulfilled()||e._allPromise!==o||i.isAbortError(t)||e._resolver.reject(t)})),t.resolve()}},e}();t.EsriPromiseMixin=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._promiseProps=new a(n),n.addResolvingPromise(i.resolve()),n}return r.__extends(t,e),t.prototype.isResolved=function(){return this._promiseProps.isResolved()},t.prototype.isRejected=function(){return this._promiseProps.isRejected()},t.prototype.isFulfilled=function(){return this._promiseProps.isFulfilled()},t.prototype.when=function(e,t){var r=this;return i.create((function(e,t){r._promiseProps.when(e,t)})).then(e,t)},t.prototype.catch=function(e){return this.when(null,e)},t.prototype.addResolvingPromise=function(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)},r.__decorate([o.subclass("esri.core.Promise")],t)}(e)};var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([o.subclass("esri.core.Promise")],t)}(t.EsriPromiseMixin(n));t.EsriPromise=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1503)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1554)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec2f32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(120)],void 0===(i=function(e,t,r,n){return function(){function e(t,n,i,o,a){this._context=null,this._glName=null,this._bufferType=void 0,this._usage=35044,this._size=-1,this._indexType=void 0,this._context=t,this._bufferType=n,this._usage=i,this._id=e._nextId++,this._glName=this._context.gl.createBuffer(),r("esri-webgl-debug")&&t.instanceCounter.increment(1,this),o&&this.setData(o,a)}return e.createIndex=function(t,r,n,i){return new e(t,34963,r,n,i)},e.createVertex=function(t,r,n){return new e(t,34962,r,n)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrement(1,this),this._context=null)},e.prototype.setData=function(e,t){if(e){if("number"==typeof e){if(e<0&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{var r=e.byteLength;n.isUint16Array(e)&&(r/=2,this._indexType=5123),n.isUint32Array(e)&&(r/=4,this._indexType=5125),this._size=r}var i=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this),this._context.gl.bufferData(this._bufferType,e,this._usage),this._context.bindVAO(i)}},e.prototype.setSubData=function(e,t,r,i){if(void 0===t&&(t=0),void 0===r&&(r=0),e){(t<0||t>=this._size)&&console.error("offset is out of range!");var o=t,a=r,s=i,l=e.byteLength;n.isUint16Array(e)&&(l/=2,o*=2,a*=2,s*=2),n.isUint32Array(e)&&(l/=4,o*=4,a*=4,s*=4),void 0===i&&(i=l-1),r>=i&&console.error("end must be bigger than start!"),t+r-i>this._size&&console.error("An attempt to write beyond the end of the buffer!");var c=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);var u=this._context.gl,p=ArrayBuffer.isView(e)?e.buffer:e;u.bufferSubData(this._bufferType,o,p.slice(a,s)),this._context.bindVAO(c)}},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(157),r(151),r(1151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.LayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r.__extends(t,e),t.prototype.destroy=function(){this.view=null},t.prototype.postscript=function(t){e.prototype.postscript.call(this,t),a.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create((function(t,r){i.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",(function(){var n=a.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()}))}))},r.__decorate([o.property()],t.prototype,"view",void 0),r.__decorate([o.property()],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(e)}}.apply(null,n))||(e.exports=i)},,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(154),r(119),r(264),r(770),r(1135),r(891),r(1136),r(892),r(784)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d={simple:u,uniqueValue:p,classBreaks:a,heatmap:c,dotDensity:l,dictionary:s};function h(e,t,r){if(!e)return null;if(e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type)return r&&r.messages&&r.messages.push(new o("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null;var n=function(e){return e&&d[e.type]||null}(e);if(n){var i=new n;return i.read(e,r),i}return r&&r.messages&&e&&r.messages.push(new o("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:r})),null}function f(e,t,i){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":return!1;default:return r.neverReached(e),!1}}(e,i)?e.write(t,i):(i.messages&&i.messages.push(new n("renderer:unsupported","Renderer of type '"+e.declaredClass+"' are not supported in scenes.",{renderer:e,context:i})),null):null}t.read=h,t.writeTarget=function(e,t,r,n){var o=f(e,{},n);o&&i.setDeepValue(r,o,t)},t.write=f,t.fromJSON=function(e,t){return h(e,0,t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(916)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(var r=0,n=e.fieldNames;r<n.length;r++){var i=n[r],o=e.fields.get(i);this[i]=new o.constructor(this.buffer,o.offset,this.stride)}}return Object.defineProperty(e.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0}),e.prototype.getField=function(e,t){var r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null},e.prototype.slice=function(t,r){return new e(this.layout,this.buffer.slice(t*this.stride,r*this.stride))},e.prototype.copyFrom=function(e,t,r,n){var i=this.stride;if(i%4==0){var o=new Uint32Array(e.buffer,t*i,n*i/4);new Uint32Array(this.buffer,r*i,n*i/4).set(o)}else o=new Uint8Array(e.buffer,t*i,n*i),new Uint8Array(this.buffer,r*i,n*i).set(o)},e}();t.InterleavedBuffer=i;var o=function(){function e(){this.stride=0,this.fields=new Map,this.fieldNames=[]}return e.prototype.vec2f=function(e,t){return this.appendField(e,r.BufferViewVec2f,t),this},e.prototype.vec2f64=function(e,t){return this.appendField(e,r.BufferViewVec2f64,t),this},e.prototype.vec3f=function(e,t){return this.appendField(e,r.BufferViewVec3f,t),this},e.prototype.vec3f64=function(e,t){return this.appendField(e,r.BufferViewVec3f64,t),this},e.prototype.vec4f=function(e,t){return this.appendField(e,r.BufferViewVec4f,t),this},e.prototype.vec4f64=function(e,t){return this.appendField(e,r.BufferViewVec4f64,t),this},e.prototype.mat3f=function(e,t){return this.appendField(e,r.BufferViewMat3f,t),this},e.prototype.mat3f64=function(e,t){return this.appendField(e,r.BufferViewMat3f64,t),this},e.prototype.mat4f=function(e,t){return this.appendField(e,r.BufferViewMat4f,t),this},e.prototype.mat4f64=function(e,t){return this.appendField(e,r.BufferViewMat4f64,t),this},e.prototype.vec4u8=function(e,t){return this.appendField(e,r.BufferViewVec4u8,t),this},e.prototype.f32=function(e,t){return this.appendField(e,r.BufferViewFloat,t),this},e.prototype.f64=function(e,t){return this.appendField(e,r.BufferViewFloat64,t),this},e.prototype.u8=function(e,t){return this.appendField(e,r.BufferViewUint8,t),this},e.prototype.u16=function(e,t){return this.appendField(e,r.BufferViewUint16,t),this},e.prototype.i8=function(e,t){return this.appendField(e,r.BufferViewInt8,t),this},e.prototype.vec2i8=function(e,t){return this.appendField(e,r.BufferViewVec2i8,t),this},e.prototype.vec2i16=function(e,t){return this.appendField(e,r.BufferViewVec2i16,t),this},e.prototype.vec2u8=function(e,t){return this.appendField(e,r.BufferViewVec2u8,t),this},e.prototype.vec4u16=function(e,t){return this.appendField(e,r.BufferViewVec4u16,t),this},e.prototype.u32=function(e,t){return this.appendField(e,r.BufferViewUint32,t),this},e.prototype.appendField=function(e,t,r){var i=t.ElementCount*n.elementTypeSize(t.ElementType),o=this.stride;this.fields.set(e,{size:i,constructor:t,offset:o,optional:r}),this.stride+=i,this.fieldNames.push(e)},e.prototype.alignTo=function(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this},e.prototype.hasField=function(e){return this.fieldNames.indexOf(e)>=0},e.prototype.createBuffer=function(e){return new i(this,e)},e.prototype.createView=function(e){return new i(this,e)},e.prototype.clone=function(){var t=new e;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((function(e,r){return t.fields.set(r,e)})),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t},e}();t.InterleavedLayout=o,t.newLayout=function(){return new o}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(341)],void 0===(i=function(e,t,r,n){return function(){function e(t,n,i,o,a){this._context=null,this._glName=null,this._layout=null,this._locations=null,this._buffers=void 0,this._indexBuffer=void 0,this._initialized=!1,this._context=t,this._layout=i,this._buffers=o,this._locations=n,a&&(this._indexBuffer=a),this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.increment(2,this)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var e=this;return Object.keys(this._buffers).reduce((function(t,r){return t+e._buffers[r].size}),this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0}),e.prototype.dispose=function(e){if(void 0===e&&(e=!0),this._context){var t=this._context.capabilities.vao;if(t&&this._glName&&(t.deleteVertexArray(this._glName),this._glName=null),this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(var n in this._buffers)this._buffers[n].dispose(),delete this._buffers[n];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}r("esri-webgl-debug")&&this._context.instanceCounter.decrement(2,this),this._context=null}},e.prototype.initialize=function(){if(!this._initialized){var e=this._context.capabilities.vao;if(e){var t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}},e.prototype.bind=function(){this.initialize();var e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())},e.prototype._bindLayout=function(){var e=this._buffers,t=!!this._context.capabilities.vao,r=this._layout,i=this._indexBuffer;e||console.error("Vertex buffer dictionary is empty!");var o=this._context.gl;for(var a in e){var s=e[a];s||console.error("Vertex buffer is uninitialized!");var l=r[a];l||console.error("Vertex element descriptor is empty!"),n.bindVertexBufferLayout(this._context,this._locations,s,l)}i&&(t?o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))},e.prototype.unbind=function(){this.initialize();var e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()},e.prototype._unbindLayout=function(){var e=this._buffers,t=this._layout;for(var r in e||console.error("Vertex buffer dictionary is empty!"),e){var i=e[r];i||console.error("Vertex buffer is uninitialized!");var o=t[r];n.unbindVertexBufferLayout(this._context,this._locations,i,o)}var a=this._indexBuffer;a&&this._context.unbindBuffer(a.bufferType)},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMaskAlphaCutoff=.1,t.symbolAlphaCutoff=.001,t.DiscardOrAdjustAlpha=function(e,t){var l=e.fragment;switch(t.alphaDiscardMode){case 0:l.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:l.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a = 1.0;\n        }\n      "]))));break;case 2:l.uniforms.add("textureAlphaCutoff","float"),l.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }\n      "]))));break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }\n      "]))))}}}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(759),r(118)],void 0===(i=function(e,t,r,n){function i(e){return Array.isArray(e)?e:e.split(".")}function o(e){if(Array.isArray(e)||e.indexOf(",")>-1){for(var t=Array.isArray(e)?e:e.split(","),r=0;r<t.length;r++)t[r]=t[r].trim();return 1===t.length?t[0]:t}return e.trim()}Object.defineProperty(t,"__esModule",{value:!0}),t.getProperties=function(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null},t.isPropertyDeclared=function(e,t){return e&&e.metadatas&&null!=e.metadatas[t]},t.merge=function(e,t,r){return function e(t,r,i){return r?Object.keys(r).reduce((function(t,o){var a=null,s="merge";if(i&&(a=i.path?i.path+"."+o:o,s=i.policy(a)),"replace"===s)return t[o]=r[o],t;if(void 0===t[o])return t[o]=n.clone(r[o]),t;var l=t[o],c=r[o];if(l===c)return t;if(Array.isArray(c)||Array.isArray(t))l=l?Array.isArray(l)?t[o]=l.concat():t[o]=[l]:t[o]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach((function(e){-1===l.indexOf(e)&&l.push(e)})));else if(c&&"object"==typeof c)if(i){var u=i.path;i.path=a,t[o]=e(l,c,i),i.path=u}else t[o]=e(l,c,null);else t.hasOwnProperty(o)&&!r.hasOwnProperty(o)||(t[o]=c);return t}),t||{}):t}(e,t,r?{policy:r,path:""}:null)},t.pathToStringOrArray=function(e){return e?"string"==typeof e&&-1===e.indexOf(".")?e:i(e):e},t.pathToArray=i,t.splitPath=o,t.parseConditionalPath=function(e){if(-1===e.indexOf("?"))return null;for(var t=i(e),r=new Array(t.length),n=0;n<t.length;n++){var o=t[n];r[n]="?"===o[o.length-1],r[n]&&(t[n]=o.slice(0,-1))}return{fullPath:t.join("."),conditional:r}},t.parse=function(e,t,n,i){var a=o(t);if(Array.isArray(a)){var s=a.map((function(t){return i(e,t.trim(),n)}));return r.handlesGroup(s)}return i(e,a.trim(),n)},t.once=function(e){var t=!1;return function(){t||(t=!0,e())}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(303),r(153),r(264),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.loadError=null,i.loadStatus="not-loaded",i.loadWarnings=null,i._set("loadWarnings",[]),i.addResolvingPromise(o.create((function(e){var t=i.load.bind(i);i.load=function(r){var a=o.create((function(e,t){o.onAbortOrThrow(r,t),i.destroyed&&t(new n("load:instance-destroyed","Instance is destroyed",{instance:i})),i._promiseProps.when(e,t)}));if("not-loaded"===i.loadStatus){i._set("loadStatus","loading");var s=i._loadController=o.createAbortController();t({signal:s.signal}),o.onAbort(s.signal,(function(){i._promiseProps.abort()}))}return e(),a}}))),i.when((function(){i._set("loadStatus","loaded"),i._loadController=null}),(function(e){i._set("loadStatus","failed"),i._set("loadError",e),i._loadController=null})),i}return r.__extends(t,e),Object.defineProperty(t.prototype,"loaded",{get:function(){return"loaded"===this.loadStatus},enumerable:!0,configurable:!0}),t.prototype.load=function(){return null},t.prototype.cancelLoad=function(){return this.isFulfilled()||(this._set("loadError",new n("load:cancelled","Cancelled")),this._loadController.abort()),this},r.__decorate([s.property({readOnly:!0,dependsOn:["loadStatus"]})],t.prototype,"loaded",null),r.__decorate([s.property({readOnly:!0})],t.prototype,"loadError",void 0),r.__decorate([s.property()],t.prototype,"loadStatus",void 0),r.__decorate([s.property({type:[a],readOnly:!0})],t.prototype,"loadWarnings",void 0),r.__decorate([s.subclass("esri.core.Loadable")],t)}(e)},c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([s.subclass("esri.core.Loadable")],t)}(l(i.EsriPromise));return function(e){e.LoadableMixin=l,e.isLoadable=function(e){return!(!e||!e.load)}}(c||(c={})),c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(172),r(351)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.serverTypes=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"];var i=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/("+t.serverTypes.join("|")+"))(?:\\/(?:layers\\/)?(\\d+))?","i"),o=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/("+t.serverTypes.join("|")+"))(?:\\/(?:layers\\/)?(\\d+))?","i");function a(e){var t=r.urlToObject(e),n=t.path.match(i)||t.path.match(o);if(!n)return null;var a=n[1],l=n[2],c=n[3],u=n[4],p=l.indexOf("/");return{title:s(-1!==p?l.slice(p+1):l),serverType:c,sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:a}}}function s(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}t.isArcGISUrl=function(e){return!!i.test(e)},t.parse=a,t.cleanTitle=s,t.titleFromUrlAndName=function(e,t){var r=[];if(e){var n=a(e);n&&n.title&&r.push(n.title)}if(t){var i=s(t);r.push(i)}if(2===r.length){if(-1!==r[0].toLowerCase().indexOf(r[1].toLowerCase()))return r[0];if(-1!==r[1].toLowerCase().indexOf(r[0].toLowerCase()))return r[1]}return r.join(" - ")},t.isHostedAgolService=function(e){if(!e)return!1;var t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),r=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&r},t.isHostedSecuredProxyService=function(e,t){return t&&e&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},t.sanitizeUrl=function(e,t){return e?r.removeTrailingSlash(r.removeQueryParameters(e,t)):e},t.sanitizeUrlWithLayerId=function(e,t,n){if(!t)return{url:t};t=r.removeQueryParameters(t,n);var i,o=a(r.urlToObject(t).path);return o&&null!=o.sublayer&&(null==e.layerId&&(i=o.sublayer),t=o.url.path),{url:r.removeTrailingSlash(t),layerId:i}},t.writeUrlWithLayerId=function(e,t,i,o,a){n.write(t,o,"url",a),o.url&&null!=e.layerId&&(o.url=r.join(o.url,i,e.layerId.toString()))},t.isWmsServer=function(e){if(!e)return!1;var t=e.toLowerCase(),r=-1!==t.indexOf("/services/"),n=-1!==t.indexOf("/mapserver/wmsserver"),i=-1!==t.indexOf("/imageserver/wmsserver"),o=-1!==t.indexOf("/wmsserver");return r&&(n||i||o)},t.isServerOrServicesAGOLUrl=function(e){if(!e)return!1;var t=new r.Url(r.makeAbsolute(e)).authority.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(154),r(236),r(152),r(225),r(153),r(172),r(151),r(208),r(902),r(904),r(339),r(244),r(240),r(298),r(265),r(905),r(324),r(324),r(233),r(438)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){var T=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.listMode="show",n.isReference=null,n.operationalLayerType="ArcGISTiledMapServiceLayer",n.resampling=!0,n.sourceJSON=null,n.spatialReference=null,n.path=null,n.sublayers=null,n.type="tile",n.url=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r.__assign({url:e},t):e},t.prototype.load=function(e){var t=this,r=s.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).then((function(){return t._fetchService(r)}),(function(){return t._fetchService(r)}))),c.resolve(this)},Object.defineProperty(t.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!0,configurable:!0}),t.prototype.readSpatialReference=function(e,t){return(e=e||t.tileInfo&&t.tileInfo.spatialReference)&&n.SpatialReference.fromJSON(e)},t.prototype.writeSublayers=function(e,t,n,i){if(this.loaded&&e){var o=e.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).toArray(),a=[],s=r.__assign({writeSublayerStructure:!1},i);o.forEach((function(e){var t=e.write({},s);a.push(t)})),a.some((function(e){return Object.keys(e).length>1}))&&(t.layers=a)}},Object.defineProperty(t.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0}),t.prototype.castTileServers=function(e){return Array.isArray(e)?e.map((function(e){return u.urlToObject(e).path})):null},t.prototype.fetchTile=function(e,t,r,n){void 0===n&&(n={});var o=n.signal,a=n.timestamp,s=this.getTileUrl(e,t,r),l={responseType:"image",signal:o};return null!=a&&(l.query={_ts:n.timestamp}),i(s,l).then((function(e){return e.data}))},t.prototype.getTileUrl=function(e,t,n){var i=!this.tilemapCache&&this.supportsBlankTile,o=u.objectToQuery(r.__assign(r.__assign({},this.parsedUrl.query),{blankTile:!i&&null})),a=this.tileServers;return(a&&a.length?a[t%a.length]:this.parsedUrl.path)+"/tile/"+e+"/"+t+"/"+n+(o?"?"+o:"")},t.prototype._fetchService=function(e){var t=this;return c.create((function(n,a){if(t.sourceJSON){if(null!=t.sourceJSON.bandCount&&null!=t.sourceJSON.pixelSizeX)throw new o("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");n({data:t.sourceJSON})}else{if(!t.parsedUrl)throw new o("tile-layer:undefined-url","layer's url is not defined");var s=w.parse(t.parsedUrl.path);if(s&&"ImageServer"===s.serverType)throw new o("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");i(t.parsedUrl.path,{query:r.__assign({f:"json"},t.parsedUrl.query),responseType:"json",signal:e}).then(n,a)}})).then((function(r){if(r.ssl&&(t.url=t.url.replace(/^http:/i,"https:")),t.sourceJSON=r.data,t.read(r.data,{origin:"service",url:t.parsedUrl}),10.1===t.version&&!w.isHostedAgolService(t.url))return t._fetchServerVersion(t.url,e).then((function(e){t.read({currentVersion:e})})).catch((function(){}))}))},t.prototype._fetchServerVersion=function(e,t){if(!x.isArcGISUrl(e))return c.reject();var r=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return i(r,{query:{f:"json"},responseType:"json",signal:t}).then((function(e){if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new o("tile-layer:version-not-available")}))},t.prototype._getMapName=function(e){var t=e.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return t&&t[2]},t.prototype._getDefaultAttribution=function(e){if(e){var t;e=e.toLowerCase();for(var r=0,n=T.length;r<n;r++)if((t=T[r]).toLowerCase().indexOf(e)>-1)return u.makeAbsolute("//static.arcgis.com/attribution/"+t)}},t.prototype._getDefaultTileServers=function(e){var t=-1!==e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),r=-1!==e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return t||r?[e,e.replace(t?/server\.arcgisonline/i:/services\.arcgisonline/i,t?"services.arcgisonline":"server.arcgisonline")]:[]},r.__decorate([p.property({readOnly:!0,dependsOn:["parsedUrl"]})],t.prototype,"attributionDataUrl",null),r.__decorate([p.property({type:["show","hide","hide-children"]})],t.prototype,"listMode",void 0),r.__decorate([p.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],t.prototype,"isReference",void 0),r.__decorate([p.property({readOnly:!0})],t.prototype,"operationalLayerType",void 0),r.__decorate([p.property({type:Boolean})],t.prototype,"resampling",void 0),r.__decorate([p.property()],t.prototype,"sourceJSON",void 0),r.__decorate([p.property({type:n.SpatialReference})],t.prototype,"spatialReference",void 0),r.__decorate([p.reader("spatialReference",["spatialReference","tileInfo"])],t.prototype,"readSpatialReference",null),r.__decorate([p.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),r.__decorate([p.property({readOnly:!0})],t.prototype,"sublayers",void 0),r.__decorate([p.writer("sublayers",{layers:{type:[P]}})],t.prototype,"writeSublayers",null),r.__decorate([p.property({json:{read:!1,write:!1}})],t.prototype,"popupEnabled",void 0),r.__decorate([p.property({dependsOn:["parsedUrl"]})],t.prototype,"tileServers",null),r.__decorate([p.cast("tileServers")],t.prototype,"castTileServers",null),r.__decorate([p.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),r.__decorate([p.property(S.url)],t.prototype,"url",void 0),r.__decorate([p.subclass("esri.layers.TileLayer")],t)}(b.SublayersOwner(_.ScaleRangeLayer(g.RefreshableLayer(m.OperationalLayer(y.PortalLayer(h.ArcGISCachedService(f.ArcGISMapService(v.ArcGISService(l.MultiOriginJSONMixin(a.HandleOwnerMixin(d)))))))))))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(443),r(195)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,i,o){void 0===i&&(i=e.DefaultIndices),void 0===o&&(o="triangle");var a={};for(var s in t){var l=t[s],c=l.data,u=l.size;a[s]={data:c,size:u,offsetIdx:0,strideIdx:u}}if(i===e.DefaultIndices){var p=function(e){var t=n.getFirstObjectValue(e);return null==t?0:t.data.length/t.size}(a),d=r.generateDefaultIndexArray(p);for(var h in i={},a)i[h]=d}this._id=r.getNewId(),this._vertexAttributes=a,this._indices=i,this._primitiveType=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){var e=n.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices[n.VertexAttrConstants.POSITION]){var t=3;e+=this._indices[n.VertexAttrConstants.POSITION].length*t*4}return this._indices[n.VertexAttrConstants.NORMAL]&&(t=3,e+=this._indices[n.VertexAttrConstants.NORMAL].length*t*4),this._indices[n.VertexAttrConstants.UV0]&&(t=2,e+=this._indices[n.VertexAttrConstants.UV0].length*t*4),this._indices[n.VertexAttrConstants.COLOR]&&(t=1,e+=this._indices[n.VertexAttrConstants.COLOR].length*t*4),e},e.DefaultIndices={},e}();t.GeometryData=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(172),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.requestOptions=null,n.url=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"!=typeof e?e:r.__assign({url:e},t)},Object.defineProperty(t.prototype,"parsedUrl",{get:function(){return this._parseUrl(this.url)},enumerable:!0,configurable:!0}),t.prototype._parseUrl=function(e){return e?i.urlToObject(e):null},t.prototype._encode=function(e,t,r){var n={};for(var i in e)if("declaredClass"!==i){var o=e[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){n[i]=[];for(var a=0;a<o.length;a++)n[i][a]=this._encode(o[a])}else if("object"==typeof o)if(o.toJSON){var s=o.toJSON(r&&r[i]);n[i]=t?s:JSON.stringify(s)}else n[i]=t?o:JSON.stringify(o);else n[i]=o}return n},r.__decorate([o.property({readOnly:!0,dependsOn:["url"]})],t.prototype,"parsedUrl",null),r.__decorate([o.property()],t.prototype,"requestOptions",void 0),r.__decorate([o.property({type:String})],t.prototype,"url",void 0),r.__decorate([o.subclass("esri.tasks.Task")],t)}(n)}.apply(null,n))||(e.exports=i)},,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new Set;function i(e,t,i){if(void 0===i&&(i={}),r("esri-deprecation-warnings")){var o=i.replacement,a=i.version,s=i.see,l=t;o&&(l+="\n\t🛠️ Replacement: "+o),a&&(l+="\n\t⚙️ Version: "+a),s&&(l+="\n\t🔗 See "+s+" for more details."),function(e,t,r){void 0===r&&(r=!1),r&&n.has(t)||(r&&n.add(t),e.warn("🛑 DEPRECATED - "+t))}(e,l,i.warnOnce)}}t.deprecatedModule=function(e,t,n){void 0===n&&(n={}),r("esri-deprecation-warnings")&&i(e,"Module: "+t,n)},t.deprecatedFunction=function(e,t,n){if(void 0===n&&(n={}),r("esri-deprecation-warnings")){var o=n.moduleName;i(e,"Function: "+(o?o+"::":"")+t+"()",n)}},t.deprecatedProperty=function(e,t,n){if(void 0===n&&(n={}),r("esri-deprecation-warnings")){var o=n.moduleName;i(e,"Property: "+(o?o+"::":"")+t,n)}},t.deprecated=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(1417),r(161)],void 0===(i=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.revision=i.commitHash,t.version="4.16",t.workerMessages={request:function(e,t){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(165)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){var n=e.options||{};return n.responseType="array-buffer",n.signal=null==t?void 0:t.signal,r(e.url,n)})).then((function(e){return{result:{data:e.data,ssl:e.ssl},transferList:[e.data]}}))}},t.setId=function(e){t.id=e},!n("host-webworker")&&n("esri-console-log-version")&&(n("esri-next")?console.warn("Using ArcGIS API for JavaScript "+t.version+"-next [Date: "+i.buildDate+", Revision: "+i.commitHash.slice(0,8)+"]"):console.debug("Using ArcGIS API for JavaScript "+t.version+" [Date: "+i.buildDate+", Revision: "+i.commitHash.slice(0,8)+"]"))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(292),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.active=!1,r.className=null,r.disabled=!1,r.id=null,r.indicator=!1,r.title=null,r.type=null,r.visible=!0,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})},r.__decorate([o.property()],t.prototype,"active",void 0),r.__decorate([o.property()],t.prototype,"className",void 0),r.__decorate([o.property()],t.prototype,"disabled",void 0),r.__decorate([o.property()],t.prototype,"id",void 0),r.__decorate([o.property()],t.prototype,"indicator",void 0),r.__decorate([o.property()],t.prototype,"title",void 0),r.__decorate([o.property()],t.prototype,"type",void 0),r.__decorate([o.property()],t.prototype,"visible",void 0),n=r.__decorate([o.subclass("esri.support.actions.ActionBase")],t)}(i.IdentifiableMixin(n))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(163),r(774)],void 0===(i=function(e,t,r,n,i){function o(e){if(e)for(var t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function a(e){if(e)for(var t=0,r=e;t<r.length;t++)o(r[t])}function s(e){if(e)for(var t=e.length,r=1;r<t;++r)e[r][0]+=e[r-1][0],e[r][1]+=e[r-1][1]}function l(e){if(e)for(var t=0,r=e;t<r.length;t++)s(r[t])}function c(e){e&&(n.isPolygon(e)?l(e.rings):n.isPolyline(e)?l(e.paths):n.isMultipoint(e)&&s(e.points))}function u(e){e&&e.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.cloneAndDecodeGeometry=function(e){var t=r.clone(e);return c(t),t},t.deltaDecodeGeometry=c,t.deltaEncodeGeometry=function(e){e&&(n.isPolygon(e)?a(e.rings):n.isPolyline(e)?a(e.paths):n.isMultipoint(e)&&o(e.points))},t.reverseMultipath=function(e){if(e)for(var t=0,r=e;t<r.length;t++)u(r[t])},t.reversePath=u,t.getCoord2D=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]},t.isClosedPath=function(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]},t.getId=function(e){return e[4]},t.setId=function(e,t){e[4]=t};var p=function(){function e(e,t,r,o){this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=o,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,e&&(n.isPolygon(e)?t&&(this.multiPath=e.rings,this.isClosed=!0):n.isPolyline(e)?r&&(this.multiPath=e.paths,this.isClosed=!1):n.isExtent(e)&&t&&(this.multiPath=h(e).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new i.Placement}return e.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null},e}();t.PathTransformationCursor=p;var d=function(){function e(e,t,r,n){this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}return e.prototype.next=function(){for(;;){if(!this.multiPath){for(var e=this.inputGeometries.next();e;){if(n.isPolygon(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):n.isPolyline(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):n.isExtent(e)&&this.acceptPolygon&&(this.multiPath=h(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}},e}();function h(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}t.PathGeometryCursor=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(151),r(324)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISService=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=o.parse(this.url);if(e&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(e){this._set("url",o.sanitizeUrl(e,n.getLogger(this.declaredClass)))},enumerable:!0,configurable:!0}),r.__decorate([i.property({dependsOn:["url"]})],t.prototype,"title",null),r.__decorate([i.property({type:String})],t.prototype,"url",null),r.__decorate([i.subclass("esri.layers.mixins.ArcGISService")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1615),r(1616),r(1617),r(1618),r(1619),r(1620)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(o.BufferViewScalarImpl);t.BufferViewFloat=c;var u=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(a.BufferViewVec2Impl);t.BufferViewVec2f=u;var p=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(s.BufferViewVec3Impl);t.BufferViewVec3f=p;var d=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(l.BufferViewVec4Impl);t.BufferViewVec4f=d;var h=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(n.BufferViewMat3Impl);t.BufferViewMat3f=h;var f=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(n.BufferViewMat3Impl);t.BufferViewMat3f64=f;var v=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f32",t}(i.BufferViewMat4Impl);t.BufferViewMat4f=v;var m=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(i.BufferViewMat4Impl);t.BufferViewMat4f64=m;var y=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(o.BufferViewScalarImpl);t.BufferViewFloat64=y;var g=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(a.BufferViewVec2Impl);t.BufferViewVec2f64=g;var _=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(s.BufferViewVec3Impl);t.BufferViewVec3f64=_;var b=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float64Array,t,r,n,i)||this;return o.elementType="f64",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="f64",t}(l.BufferViewVec4Impl);t.BufferViewVec4f64=b;var x=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u8",t}(o.BufferViewScalarImpl);t.BufferViewUint8=x;var w=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u8",t}(a.BufferViewVec2Impl);t.BufferViewVec2u8=w;var S=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u8",t}(s.BufferViewVec3Impl);t.BufferViewVec3u8=S;var P=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u8",t}(l.BufferViewVec4Impl);t.BufferViewVec4u8=P;var T=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint16Array,t,r,n,i)||this;return o.elementType="u16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u16",t}(o.BufferViewScalarImpl);t.BufferViewUint16=T;var O=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint16Array,t,r,n,i)||this;return o.elementType="u16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u16",t}(a.BufferViewVec2Impl);t.BufferViewVec2u16=O;var C=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint16Array,t,r,n,i)||this;return o.elementType="u16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u16",t}(s.BufferViewVec3Impl);t.BufferViewVec3u16=C;var M=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint16Array,t,r,n,i)||this;return o.elementType="u16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u16",t}(l.BufferViewVec4Impl);t.BufferViewVec4u16=M;var A=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint32Array,t,r,n,i)||this;return o.elementType="u32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u32",t}(o.BufferViewScalarImpl);t.BufferViewUint32=A;var E=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint32Array,t,r,n,i)||this;return o.elementType="u32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u32",t}(a.BufferViewVec2Impl);t.BufferViewVec2u32=E;var I=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint32Array,t,r,n,i)||this;return o.elementType="u32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u32",t}(s.BufferViewVec3Impl);t.BufferViewVec3u32=I;var R=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint32Array,t,r,n,i)||this;return o.elementType="u32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="u32",t}(l.BufferViewVec4Impl);t.BufferViewVec4u32=R;var D=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int8Array,t,r,n,i)||this;return o.elementType="i8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i8",t}(o.BufferViewScalarImpl);t.BufferViewInt8=D;var L=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int8Array,t,r,n,i)||this;return o.elementType="i8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i8",t}(a.BufferViewVec2Impl);t.BufferViewVec2i8=L;var j=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int8Array,t,r,n,i)||this;return o.elementType="i8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i8",t}(s.BufferViewVec3Impl);t.BufferViewVec3i8=j;var V=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int8Array,t,r,n,i)||this;return o.elementType="i8",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i8",t}(l.BufferViewVec4Impl);t.BufferViewVec4i8=V;var F=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int16Array,t,r,n,i)||this;return o.elementType="i16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i16",t}(o.BufferViewScalarImpl);t.BufferViewInt16=F;var N=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int16Array,t,r,n,i)||this;return o.elementType="i16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i16",t}(a.BufferViewVec2Impl);t.BufferViewVec2i16=N;var k=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int16Array,t,r,n,i)||this;return o.elementType="i16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i16",t}(s.BufferViewVec3Impl);t.BufferViewVec3i16=k;var z=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int16Array,t,r,n,i)||this;return o.elementType="i16",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i16",t}(l.BufferViewVec4Impl);t.BufferViewVec4i16=z;var U=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int32Array,t,r,n,i)||this;return o.elementType="i32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i32",t}(o.BufferViewScalarImpl);t.BufferViewInt32=U;var B=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int32Array,t,r,n,i)||this;return o.elementType="i32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i32",t}(a.BufferViewVec2Impl);t.BufferViewVec2i32=B;var G=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int32Array,t,r,n,i)||this;return o.elementType="i32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i32",t}(s.BufferViewVec3Impl);t.BufferViewVec3i32=G;var H=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Int32Array,t,r,n,i)||this;return o.elementType="i32",o}return r.__extends(t,e),t.fromTypedArray=function(e,r){return new t(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)},t.ElementType="i32",t}(l.BufferViewVec4Impl);t.BufferViewVec4i32=H}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(152)],void 0===(i=function(e,t,r,n,i){function o(e){return e[0].stride}function a(e){switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1;default:throw n.neverReached(e),new Error("Unknown data type")}}function s(e){switch(e){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:case 34041:return 4;case 33325:return 2;case 33326:case 35898:case 33327:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:n.neverReached(e)}return 0}Object.defineProperty(t,"__esModule",{value:!0}),t.vertexCount=function(e,t){return e.vertexBuffers[t].size/o(e.layout[t])},t.getStride=o,t.getBytesPerElement=a,t.getTypedArrayConstructor=function(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw n.neverReached(e),new Error("Unknown data type")}},t.addDescriptor=function(e,t,r,n,i,o){var s=a(n);if(e.length>0){var l=e[0].stride,c=l+s*r;e.forEach((function(e){return e.stride=c})),e.push({name:t,count:r,type:n,offset:l,stride:c,normalized:i,divisor:o})}else e.push({name:t,count:r,type:n,offset:0,stride:s*r,normalized:i,divisor:o})},t.hasAttribute=function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return!0;return!1},t.findAttribute=function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},t.copyFramebufferToTexture=function(e,t,r,n,i){void 0===i&&(i=0);var o=e.getBoundFramebufferObject(),a=e.getBoundTexture(0);e.bindFramebuffer(t),e.bindTexture(r,0),e.gl.copyTexImage2D(e.gl.TEXTURE_2D,i,r.descriptor.pixelFormat,n[0],n[1],n[2],n[3],0),e.gl.flush(),e.bindFramebuffer(o),e.bindTexture(a,0)},t.setBaseInstanceOffset=function(e,t){var n={};for(var i in e)n[i]=e[i].map((function(e){return e.divisor?r.__assign(r.__assign({},e),{baseInstance:t}):e}));return n},t.bindVertexBufferLayout=function(e,t,r,n,i){var o=e.gl,a=e.capabilities.instancing;e.bindBuffer(r);for(var s=0,l=n;s<l.length;s++){var c=l[s],u=t[c.name],p=(i||(0+c.baseInstance?c.baseInstance:0))*c.stride;if(void 0===u&&console.error("There is no location for vertex attribute '"+c.name+"' defined."),c.baseInstance&&!c.divisor&&console.error("Vertex attribute '"+c.name+"' uses baseInstanceOffset without divisor."),c.count<=4)o.vertexAttribPointer(u,c.count,c.type,c.normalized,c.stride,c.offset+p),o.enableVertexAttribArray(u),c.divisor&&c.divisor>0&&a&&a.vertexAttribDivisor(u,c.divisor);else if(9===c.count)for(var d=0;d<3;d++)o.vertexAttribPointer(u+d,3,c.type,c.normalized,c.stride,c.offset+12*d+p),o.enableVertexAttribArray(u+d),c.divisor&&c.divisor>0&&a&&a.vertexAttribDivisor(u+d,c.divisor);else if(16===c.count)for(d=0;d<4;d++)o.vertexAttribPointer(u+d,4,c.type,c.normalized,c.stride,c.offset+16*d+p),o.enableVertexAttribArray(u+d),c.divisor&&c.divisor>0&&a&&a.vertexAttribDivisor(u+d,c.divisor);else console.error("Unsupported vertex attribute element count: "+c.count)}},t.unbindVertexBufferLayout=function(e,t,r,n){var i=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(var a=0,s=n;a<s.length;a++){var l=s[a],c=t[l.name];if(l.count<=4)i.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&o&&o.vertexAttribDivisor(c,0);else if(9===l.count)for(var u=0;u<3;u++)i.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&o&&o.vertexAttribDivisor(c+u,0);else if(16===l.count)for(u=0;u<4;u++)i.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&o&&o.vertexAttribDivisor(c+u,0);else console.error("Unsupported vertex attribute element count: "+l.count)}e.unbindBuffer(34962)},t.getBytesPerElementFormat=s,t.getGpuMemoryUsage=function e(t){if(i.isNone(t))return 0;if("colorAttachment"in t)return t.glName?e(t.colorAttachment)+e(t.depthStencilAttachment):0;if("descriptor"in t)return t.glName?e(t.descriptor):0;var r=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!r)return 0;var n="hasMipmap"in t&&t.hasMipmap?1.3:1,o=t.width*t.height;return s(r)*o*n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(205),r(1182),r(798),r(1184),r(1185),r(1187),r(589),r(1187),r(1182),r(1184),r(1185)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0}),t.applyTiltConstraint=c.applyTiltConstraint,t.getTiltConstraintError=c.getTiltConstraintError,t.applyAltitudeConstraint=u.applyAltitudeConstraint,t.getAltitudeConstraintError=u.getAltitudeConstraintError,t.applyDistanceConstraint=p.applyDistanceConstraint,t.getDistanceConstraintError=p.getDistanceConstraintError,t.applySurfaceCollisionConstraint=d.applySurfaceCollisionConstraint,t.applyAll=function(e,t,r,n){void 0===r&&(r=f),void 0===n&&(n=t);var o=!1;n!==t&&n.copyFrom(t),n.markViewDirty(),n.computeUp(e.state.mode);for(var s=0;s<v;s++){for(var l=0,c=0,u=h;c<u.length;c++){var p=u[c];if(i.hasConstraintType(r.selection,p.type)){var d=Math.abs(p.error(e,n,r));p.apply(e,n,r)&&(o=!0,l+=d)}}if(0===l)break}var m=i.hasConstraintType(r.selection,8),y=function(e,t){switch(e){case 4:return 1;case 5:return t.state.isGlobal?2:1;default:return 0}}(r.interactionType,e);return m&&a.applySurfaceCollisionConstraint(e,n,y)&&(o=!0),o&&n.computeUp(e.state.mode),o},t.pixelDistanceToInteractionFactor=function(e,t){var n="number"==typeof e?e:r.vec2.distance(e,t),i=Math.min(1,n/150);return l.inOutCubic(i)};var h=[{type:1,error:function(e,t,r){return s.getTiltConstraintError(e,t,r)*t.distance},apply:s.applyTiltConstraint},{type:2,error:n.getAltitudeConstraintError,apply:n.applyAltitudeConstraint},{type:4,error:o.getDistanceConstraintError,apply:o.applyDistanceConstraint}],f={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},v=5}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(171),r(189),r(185),r(205),r(216),r(162),r(160),r(238),r(203),r(251),r(355),r(1189),r(288)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){function m(e,t,r){var n=h.sm4d.get();i.mat4.identity(n),i.mat4.rotate(n,n,r[3],r),l.vec3.subtract(e.eye,e.eye,t),l.vec3.transformMat4(e.eye,e.eye,n),l.vec3.add(e.eye,e.eye,t),l.vec3.subtract(e.center,e.center,t),l.vec3.transformMat4(e.center,e.center,n),l.vec3.add(e.center,e.center,t),l.vec3.transformMat4(e.up,e.up,n),e.markViewDirty()}Object.defineProperty(t,"__esModule",{value:!0}),t.Earth=p.sphere.fromValues(u.earthRadius,c.vec3f64.create()),t.normalizeCoordinate=function(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r},t.rotationFromPointsAroundAxis=function(e,t,r){var n=h.sv3d.get(),i=h.sv3d.get(),o=h.sv3d.get();l.vec3.copy(i,e),l.vec3.copy(o,t);var a=l.vec3.dot(i,r),s=l.vec3.dot(o,r);l.vec3.scale(n,r,a),l.vec3.subtract(i,i,n),l.vec3.normalize(i,i),l.vec3.scale(n,r,s),l.vec3.subtract(o,o,n),l.vec3.normalize(o,o);var c=l.vec3.dot(i,o);l.vec3.cross(n,r,i);var u=l.vec3.dot(o,n);return Math.atan2(u,c)},t.normalizeRotationDelta=function(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e},t.applyRotation=m,t.intersectPlaneFromScreenPoint=function(e,t,r,n){return p.plane.intersectRay(e,p.ray.fromScreen(t,r,re),n)},t.applyZoomToPoint=function(e,t,r,n){var i=h.sv3d.get(),o=1-r;l.vec3.subtract(i,t,e.eye);var a=l.vec3.length(i),s=a*(1-o);o>=0&&s<n&&(o=-((s=n)-a)/a),Math.abs(a-s)<1e-6||(l.vec3.scale(i,i,o),l.vec3.add(e.eye,e.eye,i),l.vec3.lerp(e.center,e.center,t,o))},t.applyZoomOnSphere=function(e,t,r){t.getScreenCenter(g),p.sphere.intersectScreen(e,t,g,t.center),t.markViewDirty();var n=t.distance,i=n*r;if(!(Math.abs(n-i)<1e-6)){var o=l.vec3.scale(h.sv3d.get(),t.viewForward,i);l.vec3.subtract(t.eye,t.center,o),t.markViewDirty()}};var y,g=n.createScreenPointArray();function _(e,t){l.vec3.set(t,0,0,0);for(var r=0,n=e;r<n.length;r++){var i=n[r];l.vec3.add(t,t,i)}l.vec3.scale(t,t,1/e.length)}function b(e,t,r){return Math.sin(e/l.vec3.length(t))*(r+u.earthRadius)}t.centroidOnSphere=function(e,t,r){_(t,r),l.vec3.normalize(r,r),l.vec3.scale(r,r,e)},t.centroid=_,t.onSurfaceTiltToEyeTiltGlobal=b,t.offSurfaceTiltToEyeTiltGlobal=function(e,t,r){return b(Math.PI/2,t,r)+(e-Math.PI/2)},function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(y=t.PanMode||(t.PanMode={})),t.VerticalPanTresholds={Elevation:3e4,Angle:r.deg2rad(8)},t.PreservingHeadingThreshold={Pole:.95,Angle:r.deg2rad(18),Tilt:45},t.TiltThresholdPanningSpeed=r.deg2rad(80),t.pickPointAndInitSphere=function(e,r,n,i){var o=c.vec3f64.create(),a=p.sphere.create(),s=!0;return e.intersectScreen(n,o)?a.radius=l.vec3.length(o):(r.aboveGround?a.radius=Math.max(l.vec3.length(r.center),.9*t.Earth.radius):a.radius=l.vec3.length(r.eye)-r.relativeElevation,i?S(a,r,n,o):s=p.sphere.intersectScreen(a,r,n,o)),{sphere:a,scenePickPoint:s?o:null}},t.decidePanMode=function(e,n,i){var o=l.vec3.length(e.eye),a=o-t.Earth.radius;if(Math.abs(a)>t.VerticalPanTresholds.Elevation)return y.Horizontal;var s=n.radius>o;return e.aboveGround===s?y.Vertical:(l.vec3.subtract(x,e.eye,i),l.vec3.normalize(x,x),Math.abs(.5*Math.PI-r.acosClamped(l.vec3.dot(i,x)/l.vec3.length(i)))<t.VerticalPanTresholds.Angle?y.Vertical:y.Horizontal)};var x=c.vec3f64.create();t.applyPanPlanar=function(e,t,r){l.vec3.subtract(w,r,t),l.vec3.subtract(e.eye,e.eye,w),l.vec3.subtract(e.center,e.center,w),e.markViewDirty()};var w=c.vec3f64.create();function S(e,t,r,n){var i=p.ray.fromScreenAtEye(t,r,re);return p.sphere.closestPointOnSilhouette(e,i,P),p.sphere.intersectRay(e,i,n)?!(l.vec3.squaredDistance(P,i.origin)<l.vec3.squaredDistance(n,i.origin)&&(l.vec3.copy(n,P),1)):(l.vec3.subtract(T,t.eye,t.center),l.vec3.normalize(T,T),p.plane.fromNormalAndOffset(T,-l.vec3.dot(l.vec3.normalize(T,T),P),O),p.plane.intersectRay(O,i,n),!1)}t.sphereOrPlanePointFromScreenPoint=S;var P=c.vec3f64.create(),T=c.vec3f64.create(),O=p.plane.create();function C(e,n,i,o,a,s){var c;if(l.vec3.cross(ee,e,n),l.vec3.subtract(K,e,n),l.vec3.length(e)<=a||!o.aboveGround){l.vec3.cross(i,K,o.eye);var u=l.vec3.dot(e,n)/(l.vec3.length(e)*l.vec3.length(n)),p=Math.cos(r.clamp(d.cyclicalPI.normalize(r.deg2rad(s)),0,t.TiltThresholdPanningSpeed));c=-r.acosClamped(u)-Math.max(0,l.vec3.length(n)-a)/(p*a)}else l.vec3.subtract(M,o.eye,o.center),l.vec3.cross(i,K,M),c=-l.vec3.length(K)/a;return l.vec3.normalize(i,i),l.vec3.scale(i,i,l.vec3.length(ee)),c}t.rotationAngleAndAxisDirectRotation=C;var M=c.vec3f64.create();function A(e,n,i,o){var a,s=Math.cos(r.clamp(d.cyclicalPI.normalize(r.deg2rad(o)),0,t.TiltThresholdPanningSpeed));return a=n>i?-(n-i)/(s*i):n<-i?Math.PI-(n+i)/(s*i):r.acosClamped(n/i),((e>i?-(e-i)/(s*i):e<-i?Math.PI-(e+i)/(s*i):r.acosClamped(e/i))-a)*i}function E(e,t,r,n,i,o,s,c,u,p){var d=A(e[2],t[2],s.radius,u),h=p?A(e[0],t[0],s.radius,180):t[0]-e[0],f=Math.sin(c)*h-Math.cos(c)*d,v=Math.cos(c)*h+Math.sin(c)*d;l.vec3.normalize(Q,i);var m=p?f/Math.sqrt(Math.abs(Math.pow(s.radius,2)-Math.pow(l.vec3.dot(r,Q),2))):f/s.radius,y=v/Math.sqrt(Math.abs(Math.pow(s.radius,2)-Math.pow(l.vec3.dot(r,n),2)));a.vec2.set(o,m,y)}function I(e,t,r,n,i,o,a,s,c,u){l.vec3.cross(ee,e,t),f.coordinateSystemFromOneAxisAndNormalVector(o.up,o.eye,z,U,B),f.coordinateSystemFromOneAxisAndNormalVector([0,0,1],o.eye,F,N,k),l.vec3.copy(r,N),l.vec3.copy(n,F),l.vec3.normalize(r,r),l.vec3.scale(r,r,l.vec3.length(ee)),f.vectorCoordinates(e,l.vec3.normalize(U,U),l.vec3.normalize(B,B),l.vec3.normalize(z,z),G),f.vectorCoordinates(t,U,B,z,H),E(G,H,e,F,N,i,a,s,c,u)}function R(e,t,r,n,o,a,s){i.mat4.identity(J),i.mat4.identity(Z),i.mat4.identity(X),i.mat4.rotate(J,J,o,n),i.mat4.rotate(Z,Z,s,a),i.mat4.multiply(X,J,Z),l.vec3.subtract(t,e,r),l.vec3.transformMat4(t,t,X),l.vec3.add(t,t,r)}function D(e,t,r,n,o,a){i.mat4.identity(J),i.mat4.identity(Z),i.mat4.identity(X),i.mat4.rotate(J,J,n,r),i.mat4.rotate(Z,Z,a,o),i.mat4.multiply(X,J,Z),l.vec3.subtract(e.eye,e.eye,t),l.vec3.transformMat4(e.eye,e.eye,X),l.vec3.add(e.eye,e.eye,t),l.vec3.subtract(e.center,e.center,t),l.vec3.transformMat4(e.center,e.center,X),l.vec3.add(e.center,e.center,t),l.vec3.subtract(e.up,e.up,t),l.vec3.transformMat4(e.up,e.up,X),l.vec3.add(e.up,e.up,t),e.markViewDirty()}function L(e,r,n,i,o,a,s,l){void 0===s&&(s=t.PreservingHeadingThreshold.Pole),void 0===l&&(l=t.PreservingHeadingThreshold.Angle);var c=Math.abs(i)>Math.PI-l||Math.abs(i)<l,u=Math.abs(e[2])<n*s||Math.abs(r)>n;return!!(c&&u&&a.aboveGround&&o<t.PreservingHeadingThreshold.Tilt)}function j(e,t,r,n,i,o){if(o)p.axisAngle.fromPoints(r,n,W),m(t,e.center,W);else{var a=C(r,n,te,t,e.radius,i);m(t,e.center,p.axisAngle.wrapAxisAngle(te,a))}}function V(e,t,r,n,i,o,a){var s,c=a?20:1;l.vec3.copy(Y,n),$.copyFrom(t);for(var u=0;u<c&&l.vec3.squaredDistance(r,Y)>1e-12&&(s=l.vec3.squaredDistance(r,Y),I(r,Y,N,F,q,$,e,i,o,a),D($,e.center,F,q[1],N,q[0]),R(Y,Y,e.center,F,q[1],N,q[0]),l.vec3.squaredDistance(r,Y)<s||0===u);u++)t.copyFrom($)}t.lengthFromPoints=A,t.rotationAnglesHeadingPreserving=E,t.rotationAnglesAndAxesHeadingPreserving=I,t.rotatePointAroundTwoAxes=R,t.applyRotationWithTwoAxes=D,t.preserveHeadingThreshold=L,t.applyPanSphericalDirectRotation=j,t.applyPanSphericalPreserveHeading=V,t.panToPosition=function(e,n,i,o,a,s,c){L(i,l.vec3.dot(n.up,i),e.radius,-d.cyclicalPI.normalize(r.deg2rad(a)),s,n,t.PreservingHeadingThreshold.Pole,t.PreservingHeadingThreshold.Angle)?V(e,n,i,o,-d.cyclicalPI.normalize(r.deg2rad(a)),s,c):j(e,n,i,o,s,c)},t.panMotionToRotationMatrix=function(e,t,n,o,a,s,c,u,p){L(e.center,l.vec3.dot(e.up,e.center),l.vec3.length(e.center),-d.cyclicalPI.normalize(r.deg2rad(s)),c,t)?function(e,t,r,n,o,a){var s=e.eye;f.coordinateSystemFromOneAxisAndNormalVector([0,0,1],s,F,N,k);var c=t.translation[0]*r.pan,u=t.translation[1]*r.pan,p=Math.max(Math.sqrt(Math.abs(1-Math.pow(l.vec3.dot(e.center,F),2)/Math.pow(l.vec3.length(e.center),2))),.5),d=(Math.sin(a)*u+Math.cos(a)*c)/p,h=-Math.cos(a)*u+Math.sin(a)*c;switch(i.mat4.rotate(n.pan.matrix,n.pan.matrix,d,F),n.pan.enabled=!0,o.mode){case"pan":i.mat4.rotate(n.pan.matrix,n.pan.matrix,h,N),n.pan.enabled=!0;break;case"zoom":n.zoom=-t.translation[1]*r.zoom}}(t,n,o,u,p,-d.cyclicalPI.normalize(r.deg2rad(a))):function(e,t,r,n,o){var a=e.eye,s=e.viewRight,c=l.vec3.cross(h.sv3d.get(),s,a),u=t.translation[0]*r.pan;switch(0!==u&&(i.mat4.rotate(n.pan.matrix,n.pan.matrix,-u,c),n.pan.enabled=!0),o.mode){case"pan":var p=t.translation[1]*r.pan;0!==p&&(i.mat4.rotate(n.pan.matrix,n.pan.matrix,p,s),n.pan.enabled=!0);break;case"zoom":n.zoom=-t.translation[1]*r.zoom}}(t,n,o,u,p)};var F=c.vec3f64.create(),N=c.vec3f64.create(),k=c.vec3f64.create(),z=c.vec3f64.create(),U=c.vec3f64.create(),B=c.vec3f64.create(),G=c.vec3f64.create(),H=c.vec3f64.create(),q=s.vec2f64.create(),W=p.axisAngle.create(),J=o.mat4f64.create(),Z=o.mat4f64.create(),X=o.mat4f64.create(),Y=c.vec3f64.create(),Q=c.vec3f64.create(),K=c.vec3f64.create(),$=new v.default,ee=c.vec3f64.create(),te=c.vec3f64.create(),re={origin:c.vec3f64.create(),direction:c.vec3f64.create()}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(534)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){this.supportsEdges=!1,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this._insertOrder=0,this.id=e._idGen.gen(t)}return e.prototype.dispose=function(){},e.prototype.update=function(e){return!1},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"insertOrder",{get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())},enumerable:!0,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},e.prototype.isVisible=function(){return this._visible},e.prototype.parametersChanged=function(){r.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)},e._idGen=new n.IdGen,e}();t.Material=i,t.materialPredicate=function(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){function i(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],["\n    void outputHighlight() {\n      vec4 fragCoord = gl_FragCoord;\n\n      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z > sceneDepth + 5e-7) {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputHighlight=i,function(e){e.bindOutputHighlight=function(e,t,r){e.bindTexture(r.highlightDepthTexture,5),t.setUniform1i("depthTex",5),t.setUniform4f("highlightViewportPixelSz",0,0,1/r.viewport[2],1/r.viewport[3])}}(i=t.OutputHighlight||(t.OutputHighlight={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(581),r(448)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object.defineProperty(e.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=n.getMetersPerUnit(e)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"},Object.defineProperty(e.prototype,"offsetMeters",{set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetElevationInfoUnits",{set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},enumerable:!0,configurable:!0}),e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.geometryZWithOffset=function(e,t){var r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=i.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e.prototype.setFromElevationInfo=function(e){this.mode=e.mode,this.unit=e.unit||"meters",this.offsetElevationInfoUnits=r.unwrapOr(e.offset,0)},e.prototype.updateFeatureExpressionInfoContext=function(e,t,n){if(r.isNone(e))this._featureExpressionInfoContext=null;else{var o=e&&e.arcade;o&&r.isSome(t)&&r.isSome(n)?(this._featureExpressionInfoContext=i.clone(e),i.setContextFeature(this._featureExpressionInfoContext,i.createFeature(o.modules,t,n))):this._featureExpressionInfoContext=e}},e.fromElevationInfo=function(t){var n=new e;return r.isSome(t)&&n.setFromElevationInfo(t),n},e}();t.ElevationContext=o}.apply(null,n))||(e.exports=i)},,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(172)],void 0===(i=function(e,t,r,n){function i(e,t){var r=t&&t.url&&t.url.path;if(e&&r&&(e=n.makeAbsolute(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){var i=n.makeRelative(e,t.portalItem.itemUrl);s.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return l(e,t&&t.portal)}function o(e,t){if(!e)return e;!n.isAbsolute(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);var r=n.makeAbsolute(e);if(t){var i=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(i){var o=l(i,t.portal);(r=n.makeRelative(l(r,t.portal),o,o))!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=function(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?n.changeDomain(e,t.urlKey+"."+t.customBaseUrl,t.portalHostname):e}(r,t&&t.portal),n.isAbsolute(r)&&(r=n.normalize(r)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.fromJSON=i,t.toJSON=o,t.read=function(e,t,r){return i(e,r)},t.write=function(e,t,r,n){var i=o(e,n);void 0!==i&&(t[r]=i)};var a=/\/items\/([^\/]+)\/resources\//,s=/^\.\/resources\//;function l(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;var r=t.urlKey+"."+t.customBaseUrl;return n.hasSameOrigin(n.appUrl,n.appUrl.scheme+"://"+r)?n.changeDomain(e,t.portalHostname,r):n.changeDomain(e,r,t.portalHostname)}t.itemIdFromResourceUrl=function(e){var t=r.isSome(e)?e.match(a):null;return r.isSome(t)?t[1]:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(184),r(215),r(202),r(861)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e){return function(t,r){return null==t?r:null==r?t:e(t,r)}}var u=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.points=[],n.type="multipoint",n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t){if(!e&&!t)return null;var r,n={};Array.isArray(e)?(n.points=e,n.spatialReference=t):!(r=e)||"esri.geometry.SpatialReference"!==r.declaredClass&&null==r.wkid?(e.points&&(n.points=e.points),e.spatialReference&&(n.spatialReference=e.spatialReference),e.hasZ&&(n.hasZ=e.hasZ),e.hasM&&(n.hasM=e.hasM)):n.spatialReference=e;var i=n.points&&n.points[0];return i&&(void 0===n.hasZ&&void 0===n.hasM?(n.hasZ=i.length>2,n.hasM=!1):void 0===n.hasZ?n.hasZ=i.length>3:void 0===n.hasM&&(n.hasM=i.length>3)),n},Object.defineProperty(t.prototype,"extent",{get:function(){var e=this.points;if(!e.length)return null;for(var t,r,n,i,a=new o,s=this.hasZ,l=this.hasM,u=s?3:2,p=e[0],d=c(Math.min),h=c(Math.max),f=p[0],v=p[1],m=p[0],y=p[1],g=0,_=e.length;g<_;g++){var b=e[g],x=b[0],w=b[1];if(f=d(f,x),v=d(v,w),m=h(m,x),y=h(y,w),s&&b.length>2){var S=b[2];t=d(t,S),n=h(n,S)}if(l&&b.length>u){var P=b[u];r=d(r,P),i=h(i,P)}}return a.xmin=f,a.ymin=v,a.xmax=m,a.ymax=y,a.spatialReference=this.spatialReference,s?(a.zmin=t,a.zmax=n):(a.zmin=null,a.zmax=null),l?(a.mmin=r,a.mmax=i):(a.mmin=null,a.mmax=null),a},enumerable:!0,configurable:!0}),t.prototype.writePoints=function(e,t){t.points=n.clone(this.points)},t.prototype.addPoint=function(e){return this.clearCache(),l.updateSupportFromPoint(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this},t.prototype.clone=function(){var e={points:n.clone(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new a(e)},t.prototype.getPoint=function(e){if(!this._validateInputs(e))return null;var t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference},n=2;return this.hasZ&&(r.z=t[2],n=3),this.hasM&&(r.m=t[n]),new s(r)},t.prototype.removePoint=function(e){return this._validateInputs(e)?(this.clearCache(),new s(this.points.splice(e,1)[0],this.spatialReference)):null},t.prototype.setPoint=function(e,t){return this._validateInputs(e)?(this.clearCache(),l.updateSupportFromPoint(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this):this},t.prototype.toJSON=function(e){return this.write(null,e)},t.prototype._validateInputs=function(e){return null!=e&&e>=0&&e<this.points.length},r.__decorate([i.property({dependsOn:["points","hasZ","hasM","spatialReference"]})],t.prototype,"cache",void 0),r.__decorate([i.property({dependsOn:["cache"]})],t.prototype,"extent",null),r.__decorate([i.property({type:[[Number]],json:{write:{isRequired:!0}}})],t.prototype,"points",void 0),r.__decorate([i.writer("points")],t.prototype,"writePoints",null),a=r.__decorate([i.subclass("esri.geometry.Multipoint")],t)}(a);return u.prototype.toJSON.isDefaultToJSON=!0,u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function n(e){return void 0!==e.points}function i(e){return void 0!==e.x&&void 0!==e.y}function o(e){return void 0!==e.paths}function a(e){return void 0!==e.rings}function s(e){return function(t,r){return null==t?r:null==r?t:e(t,r)}}Object.defineProperty(t,"__esModule",{value:!0});var l=s(Math.min),c=s(Math.max);function u(e,t,r,n){var i=r?3:2;if(!t.length||!t[0].length)return null;for(var o=t[0][0],a=o[0],s=o[1],u=t[0][0],p=u[0],d=u[1],h=void 0,f=void 0,v=void 0,m=void 0,y=0;y<t.length;y++)for(var g=t[y],_=0;_<g.length;_++){var b=g[_],x=b[0],w=b[1];if(a=l(a,x),s=l(s,w),p=c(p,x),d=c(d,w),r&&b.length>2){var S=b[2];h=l(h,S),f=c(f,S)}if(n&&b.length>i){var P=b[i];v=l(h,P),m=c(f,P)}}return r?n?(e[0]=a,e[1]=s,e[2]=h,e[3]=v,e[4]=p,e[5]=d,e[6]=f,e[7]=m,e.length=8,e):(e[0]=a,e[1]=s,e[2]=h,e[3]=p,e[4]=d,e[5]=f,e.length=6,e):n?(e[0]=a,e[1]=s,e[2]=v,e[3]=p,e[4]=d,e[5]=m,e.length=6,e):(e[0]=a,e[1]=s,e[2]=p,e[3]=d,e.length=4,e)}function p(e,t,r,n,i,o){var a=t.xmin,s=t.xmax,l=t.ymin,c=t.ymax,u=t.zmin,p=t.zmax,d=t.mmin,h=t.mmax;return i?(u=u||0,p=p||0,o?(d=d||0,h=h||0,e[0]=a,e[1]=l,e[2]=u,e[3]=d,e[4]=s,e[5]=c,e[6]=p,e[7]=h,e):(e[0]=a,e[1]=l,e[2]=u,e[3]=s,e[4]=c,e[5]=p,e)):o?(d=d||0,h=h||0,e[0]=a,e[1]=l,e[2]=d,e[3]=s,e[4]=c,e[5]=h,e):(e[0]=a,e[1]=l,e[2]=s,e[3]=c,e)}function d(e,t,r,n,i,o){var a=r?3:2,s=n&&o,u=r&&i;if(!t.length||!t[0].length)return null;for(var p=t[0],d=p[0],h=p[1],f=t[0],v=f[0],m=f[1],y=void 0,g=void 0,_=void 0,b=void 0,x=0;x<t.length;x++){var w=t[x],S=w[0],P=w[1];if(d=l(d,S),h=l(h,P),v=c(v,S),m=c(m,P),u&&w.length>2){var T=w[2];y=l(y,T),g=c(g,T)}if(s&&w.length>a){var O=w[a];_=l(y,O),b=c(g,O)}}return i?(y=y||0,g=g||0,o?(_=_||0,b=b||0,e[0]=d,e[1]=h,e[2]=y,e[3]=_,e[4]=v,e[5]=m,e[6]=g,e[7]=b,e):(e[0]=d,e[1]=h,e[2]=y,e[3]=v,e[4]=m,e[5]=g,e)):o?(_=_||0,b=b||0,e[0]=d,e[1]=h,e[2]=_,e[3]=v,e[4]=m,e[5]=b,e):(e[0]=d,e[1]=h,e[2]=v,e[3]=m,e)}t.getBoundsXY=function(e,t){return o(t)?u(e,t.paths,!1,!1):a(t)?u(e,t.rings,!1,!1):n(t)?d(e,t.points,!1,!1,!1,!1):r(t)?p(e,t):(i(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)},t.getBoundsXYZ=function(e,t){return o(t)?u(e,t.paths,!0,!1):a(t)?u(e,t.rings,!0,!1):n(t)?d(e,t.points,!0,!1,!0,!1):r(t)?p(e,t,0,0,!0,!1):(i(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)},t.getRingsOrPathsBounds=u,t.getExtentBounds=p,t.getPointsBounds=d,t.getPointsBoundsWidth=function(e){if(!e.length||!e[0].length)return null;for(var t=e[0][0],r=e[0][0],n=0;n<e.length;n++){var i=e[n][0];t=l(t,i),r=c(r,i)}return r-t},t.getPointsBoundsCenterX=function(e){if(!e.length||!e[0].length)return null;for(var t=e[0][0],r=e[0][0],n=0;n<e.length;n++){var i=e[n][0];t=l(t,i),r=c(r,i)}return t+.5*(r-t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156),r(264),r(866),r(1119),r(883),r(885),r(1123),r(1125),r(522),r(523),r(629),r(429),r(780),r(431),r(886),r(1126),r(881),r(887)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){Object.defineProperty(t,"__esModule",{value:!0});var x={esriSMS:v,esriPMS:u,esriTS:y,esriSLS:f,esriSFS:h,esriPFS:c,PointSymbol3D:p,LineSymbol3D:s,PolygonSymbol3D:d,MeshSymbol3D:l,LabelSymbol3D:a,styleSymbolReference:g,CIMSymbolReference:o},w=n.getLogger("esri.symbols.support.jsonUtils");function S(e,t,r){var n=function(e){return e&&x[e.type]||null}(e);if(n){var o=new n;return o.read(e,r),o}if(e){var a="Symbols of type '"+(e.type||"unknown")+"' are not supported";r&&r.messages&&r.messages.push(new i("symbol:unsupported",a,{definition:e,context:r})),w.error(a)}return null}function P(e,t,n){if(!e)return null;if(n&&"web-scene"===n.origin&&!(e instanceof m)&&!(e instanceof g)){var i="cim"!==e.type?b.to3D(e):{symbol:null,error:new r("symbol-conversion:unsupported-cim-symbol","CIM symbol is unsupported in web scenes",{symbol:e})};return i.symbol?i.symbol.write(t,n):(n.messages&&n.messages.push(new r("symbol:unsupported","Symbols of type '"+e.declaredClass+"' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView",{symbol:e,context:n,error:i.error})),null)}return n&&"web-map"===n.origin&&"web-style"===e.type?(n.messages&&n.messages.push(new r("symbol:unsupported","Symbols of type '"+e.declaredClass+"' are not supported in webmaps. Use CIMSymbol instead when working with WebMap in MapView.",{symbol:e,context:n})),null):e.write(t,n)}t.read=S,t.writeTarget=function(e,t,r,n){var i=P(e,{},n);i&&(t[r]=i)},t.write=P,t.fromJSON=function(e,t){return S(e,0,t)},t.readCallout3D=function(e,t){if(!e||!e.type)return null;var r=null;switch(e.type){case"line":r=new _}return r&&r.read(e,t),r}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1623)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.sv2d=r.VectorStack.createVec2f64(),t.sv3d=r.VectorStack.createVec3f64(),t.sv4d=r.VectorStack.createVec4f64(),t.sm3d=r.VectorStack.createMat3f64(),t.sm4d=r.VectorStack.createMat4f64(),t.sq4d=r.VectorStack.createQuatf64()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1210),r(443),r(534),r(195),r(195)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(t,r,n){this._boundingInfo=null,this._id=e.__idGen.gen(r),this._data=t,this._boundingInfo=n}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.computeAttachmentOrigin=function(e){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)},e.prototype.computeAttachmentOriginTriangles=function(e){var t=this.getIndices(a.VertexAttrConstants.POSITION),r=this.getAttribute(a.VertexAttrConstants.POSITION);return n.computeAttachmentOriginTriangles(r,t,e)},e.prototype.computeAttachmentOriginPoints=function(e){var t=this.getIndices(a.VertexAttrConstants.POSITION),r=this.getAttribute(a.VertexAttrConstants.POSITION);return n.computeAttachmentOriginPoints(r,t,e)},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(a.VertexAttrConstants.POSITION),t=this.data.getAttribute(a.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var s=0;s<i;++s)e[s]=s}var l=e.length;o.assert(l%i==0,"Indexing error: "+l.toFixed(0)+" not divisible by "+i.toFixed(0));var c=n.generateDefaultIndexArray(l/i);return new r(c,i,e,t)},e.__idGen=new i.IdGen,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(239),r(226),r(177),r(164),r(152),r(171),r(160),r(420),r(482),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=/\/resource\/(.*?)\.svg$/,v=new i("white");function m(e,t){if(null==t)return e;var r=e.toRgba();return r[3]=r[3]*t,new i(r)}function y(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i=this;return n.__generator(this,(function(o){switch(o.label){case 0:return(r=e.symbolLayers)?[4,a.forEach(r,(function(e){return n.__awaiter(i,void 0,void 0,(function(){return n.__generator(this,(function(r){return[2,g(e,t)]}))}))}))]:[2];case 1:return o.sent(),[2]}}))}))}function g(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(r){switch(r.label){case 0:switch(e.type){case"extrude":return[3,1];case"icon":case"line":case"text":return[3,2];case"path":return[3,3];case"object":return[3,4];case"fill":case"water":return[3,6]}return[3,7];case 1:return function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t),[3,8];case 2:return function(e,t){var r=_(t);c.isSome(r)&&(e.size=r)}(e,t),[3,8];case 3:return function(e,t){var r=x(t,p.vec3f64.ONES,[e.width,void 0,e.height]);e.width=S(t[0],e.width,1,r),e.height=S(t[2],e.height,1,r)}(e,t),[3,8];case 4:return[4,b(e,t)];case 5:return r.sent(),[3,8];case 6:return[3,8];case 7:s.neverReached(e),r.label=8;case 8:return[2]}}))}))}function _(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if("number"==typeof n)return n}return null}function b(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,w(e)];case 1:return r=n.sent(),i=r.resourceSize,o=r.symbolSize,a=x(t,i,o),e.width=S(t[0],o[0],i[0],a),e.depth=S(t[1],o[1],i[1],a),e.height=S(t[2],o[2],i[2],a),[2]}}))}))}function x(e,t,r){for(var n=0;n<3;n++){var i=e[n];switch(i){case"symbol-value":return null!=r[n]?r[n]/t[n]:1;case"proportional":break;default:if(i&&t[n])return i/t[n]}}return 1}function w(e){return n.__awaiter(this,void 0,void 0,(function(){var t,i,o,a,s,l,c;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){r.e(187).then(function(){var t=[r(2163)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[4,n.sent().computeObjectLayerResourceSize(e,10)];case 2:for(t=n.sent(),i=e.width,o=e.height,a=e.depth,s=[i,a,o],l=1,c=0;c<3;c++)if(null!=s[c]){l=s[c]/t[c];break}for(c=0;c<3;c++)null==s[c]&&(s[c]=t[c]*l);return[2,{resourceSize:t,symbolSize:s}]}}))}))}function S(e,t,r,n){switch(e){case"proportional":return r*n;case"symbol-value":return null!=t?t:r;default:return e}}t.getSymbolOutlineSize=function(e){if(!e)return 0;if(o.isSymbol3D(e)){var t=function(e){var t=e.symbolLayers&&e.symbolLayers.length;if(t){var r=e.symbolLayers.getItemAt(t-1);if("outline"in r)return c.get(r,"outline","size")}}(e);return c.isSome(t)?t:0}var r=d.getStroke(e);return r&&u.px2pt(r.width)||0},t.isVolumetricSymbol=function(e){if(!e||!e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((function(e){return"object"===e.type}));case"line-3d":return e.symbolLayers.some((function(e){return"path"===e.type}));case"polygon-3d":return e.symbolLayers.some((function(e){return"object"===e.type||"extrude"===e.type}));default:return!1}},t.getIconHref=function(e,t){var r=t.resource.href;return!l("esri-canvas-svg-support")&&e.styleOrigin&&f.test(r)?r.replace(f,"/resource/png/$1.png"):r},t.applyOpacityToColor=m,t.applyColorToSymbol=function(e,t,r){e&&(t||null!=r)&&(t&&(t=new i(t)),o.isSymbol3D(e)?function(e,t,r){var n=e.symbolLayers;if(n){var i=function(e){var n=c.isSome(e)?e:null;return m(t=t||n||null!=r&&v,r)};n.forEach((function(e){if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=i(e.color);else{var n=c.isSome(e.material)?e.material.color:null,o=i(n);c.isNone(e.material)?e.material=new h.default({color:o}):e.material.color=o,null!=r&&"outline"in e&&c.isSome(e.outline)&&c.isSome(e.outline.color)&&(e.outline.color=m(e.outline.color,r))}}))}}(e,t,r):o.isSymbol2D(e)&&function(e,t,r){(t=t||e.color)&&(e.color=m(t,r)),null!=r&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=m(e.outline.color,r))}(e,t,r))},t.applySizesToSymbol=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(r){return e&&t?o.isSymbol3D(e)?[2,y(e,t)]:(o.isSymbol2D(e)&&function(e,t){var r=_(t);if(!c.isNone(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":var n=e.width/e.height;n>1?(e.width=r,e.height=r*n):(e.width=r*n,e.height=r);break;case"simple-line":e.width=r;break;case"text":e.font.size=r;break;case"simple-fill":case"picture-fill":case"cim":break;default:s.neverReached(e)}}(e,t),[2]):[2]}))}))},t.applyRotationToSymbol=function(e,t,r){if(e&&null!=t)if(o.isSymbol3D(e)){var n=e.symbolLayers;n&&n.forEach((function(e){if(e&&"object"===e.type)switch(r){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else o.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(154),r(190),r(168),r(168),r(152),r(153),r(120),r(172),r(1099),r(493),r(1699),r(416),r(534),r(195),r(392),r(299),r(341),r(496)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){return function(){function e(t,r,n){this.data=t,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new o,this.data=t,this.id=e.idGen.gen(r),this.params=n||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params),this.startPreload()}return e.prototype.startPreload=function(){var e=this.data;l.isNone(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))},e.prototype.startPreloadVideoElement=function(e){p.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)},e.prototype.startPreloadImageElement=function(e){p.isDataProtocol(e.src)||p.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)},e.getDataDimensions=function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e},e.estimateTexMemRequired=function(t,r){if(l.isNone(t))return 0;if(u.isArrayBuffer(t)||u.isUint8Array(t))return t.byteLength;var n=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?e.getDataDimensions(t):r,i=n.width,o=n.height;return(r.mipmap?4/3:1)*i*o*(r.components||4)||0},e.prototype.dispose=function(){this.data=void 0},Object.defineProperty(e.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0}),e.prototype.createDescriptor=function(e){var t=this.params.mipmap&&!this.params.disableAnisotropy;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:t?e.parameters.maxMaxAnisotropy:void 0}},e.prototype.load=function(t,r){if(l.isSome(this.glTexture))return this.glTexture;if(l.isSome(this.loadingPromise))return this.loadingPromise;var i=this.data;return l.isNone(i)?(this.glTexture=new _(t,this.createDescriptor(t),null),t.bindTexture(this.glTexture),this.glTexture):"string"==typeof i?this.loadFromURL(t,r,i):i instanceof Image?this.loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(t,i,r):(u.isArrayBuffer(i)||u.isUint8Array(i))&&this.params.encoding===e.DDS_ENCODING?this.loadFromDDSData(t,i):u.isUint8Array(i)?this.loadFromPixelData(t,i):u.isArrayBuffer(i)?this.loadFromPixelData(t,new Uint8Array(i)):(n.neverReachedSilent(i),null)},Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0}),e.prototype.frameUpdate=function(e,t,r){if(!(this.data instanceof HTMLVideoElement)||l.isNone(this.glTexture))return r;if(this.data.readyState<2||r===this.data.currentTime)return r;if(l.isSome(this.powerOfTwoStretchInfo)){var n=this.powerOfTwoStretchInfo,i=n.framebuffer,o=n.vao,a=n.sourceTexture;a.setData(this.data),this.drawStretchedTexture(e,t,i,o,a,this.glTexture)}else{var s=this.data,c=s.width,u=s.height,p=this.glTexture.descriptor,d=p.width,h=p.height;c!==d||u!==h?this.glTexture.updateData(0,0,0,Math.min(c,d),Math.min(u,h),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime},e.prototype.loadFromDDSData=function(e,t){return this.glTexture=f.createDDSTexture(e,this.createDescriptor(e),t,this.params.mipmap),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadFromPixelData=function(e,t){y.assert(this.params.width>0&&this.params.height>0);var r=this.createDescriptor(e);return r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height,this.glTexture=new _(e,r,t),e.bindTexture(this.glTexture),this.glTexture},e.prototype.loadAsync=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o=this;return r.__generator(this,(function(r){return t=c.createAbortController(),this.loadingController=t,n=e(t.signal),this.loadingPromise=n,i=function(){o.loadingController===t&&(o.loadingController=null),o.loadingPromise===n&&(o.loadingPromise=null)},n.then(i,i),[2,n]}))}))},e.prototype.loadFromURL=function(e,t,n){var i=this;return this.loadAsync((function(o){return r.__awaiter(i,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,h.requestImage(n,{signal:o})];case 1:return i=r.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromImageElement=function(e,t,n){var i=this;return n.complete?this.loadFromImage(e,n,t):this.loadAsync((function(o){return r.__awaiter(i,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,d.loadImageAsync(n,n.src,!1,o)];case 1:return i=r.sent(),[2,this.loadFromImage(e,i,t)]}}))}))}))},e.prototype.loadFromVideoElement=function(e,t,r){return r.readyState>=2?this.loadFromImage(e,r,t):this.loadFromVideoElementAsync(e,t,r)},e.prototype.loadFromVideoElementAsync=function(e,t,r){var n=this;return this.loadAsync((function(o){return c.create((function(a,s){var u=function(){r.removeEventListener("loadeddata",p),r.removeEventListener("error",d),l.isSome(h)&&h.remove()},p=function(){r.readyState>=2&&(u(),a(n.loadFromImage(e,r,t)))},d=function(e){u(),s(e||new i("Failed to load video"))};r.addEventListener("loadeddata",p),r.addEventListener("error",d);var h=c.onAbort(o,(function(){return d(c.createAbortError())}))}))}))},e.prototype.loadFromImage=function(t,r,n){var i=e.getDataDimensions(r);this.params.width=i.width,this.params.height=i.height;var o=this.createDescriptor(t);return o.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,o)||s.isPowerOfTwo(i.width)&&s.isPowerOfTwo(i.height)?(o.width=i.width,o.height=i.height,this.glTexture=new _(t,o,r),t.bindTexture(this.glTexture),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(t,r,i,o,n),t.bindTexture(this.glTexture),this.glTexture)},e.prototype.requiresPowerOfTwo=function(e,t){var r="number"==typeof t.wrapMode?33071===t.wrapMode:33071===t.wrapMode.s&&33071===t.wrapMode.t;return!x.default(e.gl)&&(t.hasMipmap||!r)},e.prototype.makePowerOfTwoTexture=function(e,t,r,i,o){var s,l=r.width,c=r.height,u=a.nextHighestPowerOfTwo(l),p=a.nextHighestPowerOfTwo(c);switch(i.width=u,i.height=p,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[l/u,c/p],(s=new _(e,i)).updateData(0,0,0,l,c,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,i,o);break;default:n.neverReached(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,r,n){var i=new _(e,r),o=new g(e,{colorTarget:0,depthStencilTarget:0},i),a=new _(e,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t),s=v.createQuadVAO(e);return this.drawStretchedTexture(e,n,o,s,a,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:a,framebuffer:o}:(s.dispose(!0),a.dispose(),o.detachColorTexture(),e.bindFramebuffer(null),o.dispose()),i},e.prototype.drawStretchedTexture=function(e,t,r,n,i,o){e.bindFramebuffer(r);var a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height);var s=t.program;e.bindProgram(s),s.setUniform4f("color",1,1,1,1),s.setUniform1i("tex",0),e.bindTexture(i,0),e.bindVAO(n),e.setPipelineState(t.pipeline),e.drawArrays(5,0,b.vertexCount(n,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height)},e.prototype.unload=function(){if(l.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,r=e.vao,n=e.sourceTexture;r.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(l.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),l.isSome(this.loadingController)){var i=this.loadingController;this.loadingController=null,this.loadingPromise=null,i.abort()}this.events.emit("unloaded")},e.idGen=new m.IdGen,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(154),r(273),r(1272),r(954),r(161)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){return void 0===e&&(e=null),r.__awaiter(this,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:if(n.geometryServiceUrl)return[2,new a({url:n.geometryServiceUrl})];if(!e)throw new i("internal:geometry-service-url-not-configured");return[4,(s="portal"in e?e.portal||o.getDefault():e).load({signal:t})];case 1:if(r.sent(),s.helperServices&&s.helperServices.geometry&&s.helperServices.geometry.url)return[2,new a({url:s.helperServices.geometry.url})];throw new i("internal:geometry-service-url-not-configured")}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.projectGeometry=function(e,t,n,o){return void 0===n&&(n=null),r.__awaiter(this,void 0,void 0,(function(){var a,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,l(n,o)];case 1:return a=r.sent(),(c=new s).geometries=[e],c.outSpatialReference=t,[4,a.project(c,{signal:o})];case 2:if((u=r.sent())&&Array.isArray(u)&&1===u.length)return[2,u[0]];throw new i("internal:geometry-service-projection-failed")}}))}))}}.apply(null,n))||(e.exports=i)},,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(154),r(152),r(172),r(172)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){var t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function c(e){var t=function(e){var t=s.getPathExtension(e);return o.isNone(t)?[e,""]:[e.slice(0,e.length-t.length-1),"."+t]}(e),r=t[0],n=t[1],i=l(r);return[i[0],i[1],n]}function u(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return e instanceof Blob?[2,e]:[4,n(e.url,{responseType:"blob"})];case 1:return[2,t.sent().data]}}))}))}function p(e){return e instanceof Blob?e.type:(t=e.url,r=s.getPathExtension(t),d[r]||v);var t,r}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchResources=function(e,t,n){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var i,s,l,c,u,p,d,h,f,v;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.load(n)];case 1:return r.sent(),i=a.join(e.itemUrl,"resources"),s=t.start,l=void 0===s?1:s,c=t.num,u=void 0===c?10:c,p=t.sortOrder,d=void 0===p?"asc":p,h=t.sortField,f={query:{start:l,num:u,sortOrder:d,sortField:void 0===h?"created":h},signal:o.get(n,"signal")},[4,e.portal._request(i,f)];case 2:return[2,{total:(v=r.sent()).total,nextStart:v.nextStart,resources:v.resources.map((function(t){var r=t.created,n=t.size,i=t.resource;return{created:new Date(r),size:n,resource:e.resourceFromPath(i)}}))}]}}))}))},t.addOrUpdateResource=function(e,t,n,s){return r.__awaiter(this,void 0,void 0,(function(){var c,p,d,h,f,v;return r.__generator(this,(function(r){switch(r.label){case 0:if(!e.hasPath())throw new i("portal-item-resource-"+t+":invalid-path","Resource does not have a valid path");return[4,e.portalItem.load(s)];case 1:return r.sent(),c=a.join(e.portalItem.userItemUrl,"add"===t?"addResources":"updateResources"),p=l(e.path),d=p[0],h=p[1],[4,u(n)];case 2:return f=r.sent(),v=new FormData,d&&"."!==d&&v.append("resourcesPrefix",d),v.append("fileName",h),v.append("file",f,h),v.append("f","json"),o.isSome(s)&&s.access&&v.append("access",s.access),[4,e.portalItem.portal._request(c,{method:"post",body:v,signal:o.get(s,"signal")})];case 3:return r.sent(),[2,e]}}))}))},t.removeResource=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!t.hasPath())throw new i("portal-item-resources-remove:invalid-path","Resource does not have a valid path");return[4,e.load(n)];case 1:return r.sent(),s=a.join(e.userItemUrl,"removeResources"),[4,e.portal._request(s,{method:"post",query:{resource:t.path},signal:o.get(n,"signal")})];case 2:return r.sent(),t.portalItem=null,[2]}}))}))},t.removeAllResources=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.load(t)];case 1:return r.sent(),n=a.join(e.userItemUrl,"removeResources"),[2,e.portal._request(n,{method:"post",query:{deleteAll:!0},signal:o.get(t,"signal")})]}}))}))},t.splitPrefixFileNameAndExtension=c,t.contentToBlob=u,t.getSiblingOfSameType=function(e,t){if(!e.hasPath())return null;var r=c(e.path),n=r[0],i=r[2];return e.portalItem.resourceFromPath(a.join(n,t+i))},t.resourceContentType=p,t.resourceContentExtension=function(e){return h[p(e)]||m};var d={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"},h={};for(var f in d)h[d[f]]=f;var v="text/plain",m=h[v]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(761),r(166),r(517)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a={year:"numeric",month:"numeric",day:"numeric"},s={year:"numeric",month:"long",day:"numeric"},l={year:"numeric",month:"short",day:"numeric"},c={year:"numeric",month:"long",weekday:"long",day:"numeric"},u={hour:"numeric",minute:"numeric"},p=r.__assign(r.__assign({},u),{second:"numeric"}),d={"short-date":a,"short-date-short-time":r.__assign(r.__assign({},a),u),"short-date-short-time-24":r.__assign(r.__assign(r.__assign({},a),u),{hour12:!1}),"short-date-long-time":r.__assign(r.__assign({},a),p),"short-date-long-time-24":r.__assign(r.__assign(r.__assign({},a),p),{hour12:!1}),"short-date-le":a,"short-date-le-short-time":r.__assign(r.__assign({},a),u),"short-date-le-short-time-24":r.__assign(r.__assign(r.__assign({},a),u),{hour12:!1}),"short-date-le-long-time":r.__assign(r.__assign({},a),p),"short-date-le-long-time-24":r.__assign(r.__assign(r.__assign({},a),p),{hour12:!1}),"long-month-day-year":s,"long-month-day-year-short-time":r.__assign(r.__assign({},s),u),"long-month-day-year-short-time-24":r.__assign(r.__assign(r.__assign({},s),u),{hour12:!1}),"long-month-day-year-long-time":r.__assign(r.__assign({},s),p),"long-month-day-year-long-time-24":r.__assign(r.__assign(r.__assign({},s),p),{hour12:!1}),"day-short-month-year":l,"day-short-month-year-short-time":r.__assign(r.__assign({},l),u),"day-short-month-year-short-time-24":r.__assign(r.__assign(r.__assign({},l),u),{hour12:!1}),"day-short-month-year-long-time":r.__assign(r.__assign({},l),p),"day-short-month-year-long-time-24":r.__assign(r.__assign(r.__assign({},l),p),{hour12:!1}),"long-date":c,"long-date-short-time":r.__assign(r.__assign({},c),u),"long-date-short-time-24":r.__assign(r.__assign(r.__assign({},c),u),{hour12:!1}),"long-date-long-time":r.__assign(r.__assign({},c),p),"long-date-long-time-24":r.__assign(r.__assign(r.__assign({},c),p),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":u,"long-time":p};t.dictionary=i.strict()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),t.dateFormats=t.dictionary.apiValues,t.toJSON=t.dictionary.toJSON.bind(t.dictionary),t.fromJSON=t.dictionary.fromJSON.bind(t.dictionary);var h={ar:"ar-u-nu-latn-ca-gregory"},f=new n.default,v=d["short-date-short-time"];function m(e){var t=e||v;if(!f.has(t)){var r=o.getLocale(),n=h[o.getLocale()]||r;f.set(t,new Intl.DateTimeFormat(n,t))}return f.get(t)}o.beforeLocaleChange((function(){f=new n.default,v=d["short-date-short-time"]})),t.getDateTimeFormatter=m,t.convertDateFormatToIntlOptions=function(e){return d[e]||null},t.formatDate=function(e,t){return m(t).format(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PIXEL_TOLERANCE=.03;var r=function(){function e(){this._path=[]}return e.prototype.path=function(){return this._path},e.prototype.addPath=function(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()},e.mergePath=function(e,t){t&&Array.prototype.push.apply(e,t)},e.prototype.startPath=function(e){this._path.push(e)},e.prototype.lineTo=function(e){this._path.push(e)},e.prototype.close=function(){var e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))},e}();t.PathHelper=r;var n=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=!1)}return e.prototype.normalize=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t},e.prototype.calculateLength=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)},e.prototype.calculateSegLength=function(e,t){return this.calculateLength(e[t],e[t+1])},e.prototype.calculatePathLength=function(e){for(var t=0,r=e?e.length:0,n=0;n<r-1;++n)t+=this.calculateSegLength(e,n);return t},e.prototype.calculatePathArea=function(e){for(var t=0,r=e?e.length:0,n=0;n<r-1;++n)t+=(e[n+1][0]-e[n][0])*(e[n+1][1]+e[n][1]);return t/2},e.prototype.getCoord2D=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]},e.prototype.getSegCoord2D=function(e,t,r){return this.getCoord2D(e[t],e[t+1],r)},e.prototype.getAngle=function(e,t,r){var n=t[0]-e[0],i=t[1]-e[1];return Math.atan2(i,n)},e.prototype.getSegAngle=function(e,t,r){return this.getAngle(e[t],e[t+1],r)},e.prototype.getAngleCS=function(e,t,r){var n=t[0]-e[0],i=t[1]-e[1],o=Math.sqrt(n*n+i*i);return o>0?[n/o,i/o]:[1,0]},e.prototype.getSegAngleCS=function(e,t,r){return this.getAngleCS(e[t],e[t+1],r)},e.prototype.cut=function(e,t,r,n){return[r<=0?e[t]:this.getSegCoord2D(e,t,r),n>=1?e[t+1]:this.getSegCoord2D(e,t,n)]},e.prototype.addSegment=function(e,t,r){r&&e.push(t[0]),e.push(t[1])},e.prototype.getSubCurve=function(e,t,r){var n=[];return this.appendSubCurve(n,e,t,r)?n:null},e.prototype.appendSubCurve=function(e,t,r,n){for(var i=t?t.length-1:0,o=0,a=!0,s=0;s<i;){var l=this.calculateSegLength(t,s);if(0!==l){if(a){if(o+l>r){var c=(r-o)/l,u=1,p=!1;if(o+l>=n&&(u=(n-o)/l,p=!0),(d=this.cut(t,s,c,u))&&this.addSegment(e,d,a),p)break;a=!1}}else{if(o+l>n){var d;(d=this.cut(t,s,0,(n-o)/l))&&this.addSegment(e,d,a);break}this.addSegment(e,[t[s],t[s+1]],a)}o+=l,++s}else++s}return!0},e.prototype.getCIMPointAlong=function(e,t){for(var r=e?e.length-1:0,n=0,i=-1;i<r;){++i;var o=this.calculateSegLength(e,i);if(0!==o){if(n+o>t){var a=(t-n)/o;return this.getCoord2D(e[i],e[i+1],a)}n+=o}}return null},e.prototype.isEmpty=function(e,t){if(!e||e.length<=1)return!0;for(var r=e?e.length-1:0,n=-1;n<r;){if(e[1+ ++n][0]!==e[n][0]||e[n+1][1]!==e[n][1])return!1;if(t&&e[n+1][2]!==e[n][2])return!1}return!0},e.prototype.offset=function(e,t,r,n,i){if(!e||e.length<2)return null;var o=e.length,a=e[0][0]===e[o-1][0]&&e[0][1]===e[o-1][1];if(a){if(e.length<3)return null;--o}for(var s=[],l=a?e[o-1]:null,c=e[0],u=0;u<o;u++){var p=u===o-1?a?e[0]:null:e[u+1];if(l)if(p){var d=[p[0]-c[0],p[1]-c[1]];this.normalize(d);var h=[c[0]-l[0],c[1]-l[1]];this.normalize(h);var f=h[0]*d[1]-h[1]*d[0],v=h[0]*d[0]+h[1]*d[1];if(f>=0==t<=0){x=[d[0]-h[0],d[1]-h[1]],this.normalize(x);var m=Math.sqrt((1+v)/2),y=-Math.abs(t)/m;s.push([c[0]-x[0]*y,c[1]-x[1]*y])}else switch(r){case"Mitered":if((m=Math.sqrt((1+v)/2))>0&&1/m<n){x=[d[0]-h[0],d[1]-h[1]],this.normalize(x),y=Math.abs(t)/m,s.push([c[0]-x[0]*y,c[1]-x[1]*y]);break}case"Bevelled":s.push([c[0]+h[1]*t,c[1]-h[0]*t]),s.push([c[0]+d[1]*t,c[1]-d[0]*t]);break;case"Rounded":s.push([c[0]+h[1]*t,c[1]-h[0]*t]);for(var g=.2,_=1;_<5;_++,g+=.2)x=[h[1]*(1-g)+d[1]*g,-h[0]*(1-g)-d[0]*g],this.normalize(x),s.push([c[0]+x[0]*t,c[1]+x[1]*t]);s.push([c[0]+d[1]*t,c[1]-d[0]*t]);break;case"Square":default:if(f<0)s.push([c[0]+(h[1]+h[0])*t,c[1]+(h[1]-h[0])*t]),s.push([c[0]+(d[1]-d[0])*t,c[1]-(d[0]+d[1])*t]);else{var b=Math.sqrt((1+Math.abs(v))/2);x=[d[0]-h[0],d[1]-h[1]],this.normalize(x),y=t/b,s.push([c[0]-x[0]*y,c[1]-x[1]*y])}}}else{var x=[c[0]-l[0],c[1]-l[1]];this.normalize(x),s.push([c[0]+x[1]*t,c[1]-x[0]*t])}else{x=[p[0]-c[0],p[1]-c[1]];this.normalize(x),s.push([c[0]+x[1]*t,c[1]-x[0]*t])}l=c,c=p}return a&&s.push([s[0][0],s[0][1]]),s},e}();t.CurveHelper=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.title=null,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({title:this.title})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),n=r.__decorate([i.subclass("esri.renderers.support.LegendOptions")],t)}(n.JSONSupport);t.LegendOptions=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(638),r(159),r(155),r(151),r(163)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(){return{enabled:!this.camera}}return function(e){function t(t){var r=e.call(this,t)||this;return r.rotation=0,r.scale=0,r.targetGeometry=null,r.camera=null,r}var o;return r.__extends(t,e),o=t,t.prototype.castRotation=function(e){return(e%=360)<0&&(e+=360),e},t.prototype.clone=function(){return new o({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry?this.targetGeometry.clone():null,camera:this.camera?this.camera.clone():null})},r.__decorate([a.property({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:l}}}}})],t.prototype,"rotation",void 0),r.__decorate([a.cast("rotation")],t.prototype,"castRotation",null),r.__decorate([a.property({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:l}}}}})],t.prototype,"scale",void 0),r.__decorate([a.property({types:i.geometryTypes,json:{read:s.fromJSON,write:!0,origins:{"web-scene":{read:s.fromJSON,write:{overridePolicy:l}}}}})],t.prototype,"targetGeometry",void 0),r.__decorate([a.property({type:n,json:{write:!0}})],t.prototype,"camera",void 0),o=r.__decorate([a.subclass("esri.Viewpoint")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1551)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2df32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n={divisor:0};t.glLayout=function(e,t){void 0===t&&(t={}),t=r.__assign(r.__assign({},n),t);var o=e.stride;return e.fieldNames.filter((function(t){var r=e.fields.get(t).optional;return!(r&&r.glPadding)})).map((function(r){var n=e.fields.get(r),a=n.constructor.ElementCount,s=function(e){var t=i[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}(n.constructor.ElementType),l=n.offset,c=!(!n.optional||!n.optional.glNormalized);return{name:r,stride:o,count:a,type:s,offset:l,normalized:c,divisor:t.divisor}}))};var i={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(210),r(210),r(152),r(152),r(189),r(185),r(371),r(228),r(931),r(1667),r(195),r(1201),r(1671),r(446),r(307),r(341),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){var _=function(){function e(e,t,r,n){void 0===n&&(n=c.Default3D),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._vertexAttributeLocations=n,this._material=r,this._materialRep=t,this._glMaterials=v.acquireMaterials(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return e.prototype.dispose=function(){v.releaseMaterials(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasWater",{get:function(){return!this.isEmpty&&n.someMap(this._glMaterials,(function(e){return e instanceof h.WaterGLMaterial}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!0,configurable:!0}),e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateRenderCommands()},e.prototype.addAndRemoveGeometries=function(e,t){var r=this,n=this._bufferWriter,i=n.vertexBufferLayout,o=i.stride/4,a=this._dataByOrigin,s=function(e,t,r,n){for(var i=new Map,o=t.vertexBufferLayout.stride/4,a=function(r,n){var a=r.origin,s=e.get(a.id),l=i.get(a.id);null==l&&(l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:a.vec3},i.set(a.id,l));var c=t.elementCount(r.data)*o;n?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(r)):(l.optimalCount-=c,l.toRemove.push(r))},s=0,l=r;s<l.length;s++){var c=l[s];a(c,!0)}for(var u=0,p=n;u<p.length;u++)a(c=p[u],!1);return i}(a,n,e,t);s.forEach((function(e,t){s.delete(t);var n=e.optimalCount,l=e.sparseCount,c=a.get(t);if(null==c&&(d.assert(n>0),c=r.createData(i,n,e.origin),a.set(t,c)),0===n)return c.vao.dispose(!0),c.vao=null,void a.delete(t);var u=n<e.sparseCount/2,p=u?n:l,h=b,f=c.buffer.size,v=c.buffer.array,m=c.buffer.resize(p,!1);u||m?r.removeAndRebuild(c,e.toRemove,o,v,h):e.toRemove.length>0?(r.removeByErasing(c,e.toRemove,o,h),e.toAdd.length>0&&(h.end=f)):(h.begin=f,h.end=f);var y=x;d.setMatrixTranslation3(y,-e.origin[0],-e.origin[1],-e.origin[2]),r.append(c,e.toAdd,o,y,h);var g=c.vao.vertexBuffers.geometry;if(g.byteSize!==c.buffer.array.buffer.byteLength)g.setData(c.buffer.array);else{var _=h.begin,w=h.end;if(_<w){var S=c.buffer.array,P=4*_,T=4*w;g.setSubData(S,P,P,T)}}c.drawCommandsDirty=!0}))},e.prototype.updateGeometries=function(e){for(var t=this._bufferWriter,r=t.vertexBufferLayout.stride/4,n=0,i=e;n<i.length;n++){var o=i[n],a=o.updateType,s=o.renderGeometry,l=this._dataByOrigin.get(s.origin.id),c=l&&l.instances.get(s.uniqueName);if(!c)return;if(1&a&&(c.isVisible=s.instanceParameters.visible),9&a){var u=s.instanceParameters.visible;c.hasHighlights=!!s.instanceParameters.highlights&&u}if(16&a&&(c.hasOccludees=!!s.instanceParameters.occludees),6&a){var p=l.buffer.array,h=l.vao;v.calculateTransformRelToOrigin(s,w,S),t.write({transformation:w,invTranspTransformation:S},s.data,t.vertexBufferLayout.createView(p.buffer),c.from),d.assert(c.from+t.elementCount(s.data)===c.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(p,c.from*r*4,c.from*r*4,c.to*r*4)}l.drawCommandsDirty=!0}},e.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach((function(e){e.hasHiddenInstances=n.someMap(e.instances,(function(e){return!e.isVisible})),e.hasHighlights=n.someMap(e.instances,(function(e){return e.isVisible&&e.hasHighlights})),e.hasOccludees=n.someMap(e.instances,(function(e){return e.isVisible&&e.hasOccludees}))})),this._hasHighlights=n.someMap(this._dataByOrigin,(function(e){return e.hasHighlights})),this._hasOccludees=n.someMap(this._dataByOrigin,(function(e){return e.hasOccludees})),this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.stats={default:0,highlight:0,occludees:0},0!==e.instances.size){if(!(e.hasOccludees||e.hasHighlights||e.hasHiddenInstances)){var t=4*e.buffer.size/y.getStride(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0})}var n=f.sortInstancesAccordingToRange(r.valuesOfMap(e.instances));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[];for(var i=0,o=n;i<o.length;i++){var a=o[i];a.isVisible&&(a.hasOccludees?f.addOrMerge(e.drawCommandsOccludees,a):f.addOrMerge(e.drawCommandsDefault,a),a.hasHighlights&&f.addOrMerge(e.drawCommandsHighlight,a))}var s=function(e){for(var t=0,r=0,n=e;r<n.length;r++)t+=n[r].count;return t/3};e.stats={default:s(e.drawCommandsDefault),highlight:s(e.drawCommandsHighlight),occludees:s(e.drawCommandsOccludees)}}}(e),e.drawCommandsDirty=!1)}))},e.prototype.updateLogic=function(e){return this._material.update(e)},e.prototype.render=function(e,t,r,n){var a=this,s=this._rctx,l=this._glMaterials.get(t.pass),c=4===t.pass,p=e;if(2===t.pass&&null===p&&(p=22),!l||2!==l.ensureResources(s)||null!=p&&!l.beginSlot(p)||c&&!this._hasHighlights)return!1;l.ensureParameters(r);var d=l.getTechnique(),h=l.getPipelineState(p,!1);s.setPipelineState(h),l.bind(s,r);var f=!1;return this._dataByOrigin.forEach((function(e){if(!(i.isNone(e.drawCommandsDefault)&&i.isNone(e.drawCommandsHighlight)&&i.isNone(e.drawCommandsOccludees))&&(!c||e.hasHighlights)){r.origin=e.origin,d.bindDraw(r),d.ensureAttributeLocations(e.vao),s.bindVAO(e.vao);var t=d.primitiveType,v=c?e.drawCommandsHighlight:e.drawCommandsDefault,m=c?e.stats.highlight:e.stats.default;if(o.isSome(v)&&(a.renderCommands(s,t,v),u.addToRenderStats(v.length,m,n),f=!0),!c&&(v=e.drawCommandsOccludees,o.isSome(v))){var y=l.getPipelineState(p,!0);s.setPipelineState(y),a.renderCommands(s,t,v),s.setPipelineState(h),u.addToRenderStats(v.length,e.stats.occludees,n),f=!0}}})),f},e.prototype.renderCommands=function(e,t,r){for(var n=0;n<r.length;n++)e.drawArrays(t,r[n].first,r[n].count)},e.prototype.createData=function(e,t,r){return{instances:new Map,vao:new g(this._rctx,this._vertexAttributeLocations,{geometry:l.glLayout(e)},{geometry:m.createVertex(this._rctx,35044)}),buffer:new p.ResizableFloat32Array(t),optimalCount:0,origin:r,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}},e.prototype.removeAndRebuild=function(e,t,r,n,i){for(var o=0,a=t;o<a.length;o++){var s=a[o].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*r,e.instances.delete(s)}var c=0,u=e.buffer.array;i.begin=0,i.end=0;var p=-1,d=-1,h=0;e.instances.forEach((function(e){var t=e.from*r,i=e.to*r,o=i-t;p!==d&&d!==t?(u.set(n.subarray(p,d),h),h+=d-p,p=t):-1===p&&(p=t),d=i,e.from=c/r,c+=o,e.to=c/r})),p!==d&&u.set(n.subarray(p,d),h),i.end=c},e.prototype.removeByErasing=function(e,t,r,n){n.begin=1/0,n.end=-1/0;for(var i=-1,o=-1,a=0,s=t;a<s.length;a++){var l=s[a].uniqueName,c=e.instances.get(l),u=c.from*r,p=c.to*r;i!==o&&o!==u?(e.buffer.erase(i,o),i=u):-1===i&&(i=u),o=p,e.instances.delete(l),e.optimalCount-=p-u,u<n.begin&&(n.begin=u),p>n.end&&(n.end=p)}i!==o&&e.buffer.erase(i,o)},e.prototype.append=function(e,t,r,n,i){for(var s=this._bufferWriter,l=0,c=t;l<c.length;l++){var u=c[l],p=o.isSome(u.transformation)?a.mat4.multiply(w,n,u.transformation):n;a.mat4.invert(S,p),a.mat4.transpose(S,S);var h=i.end;s.write({transformation:p,invTranspTransformation:S},u.data,s.vertexBufferLayout.createView(e.buffer.array.buffer),i.end/r);var v=s.elementCount(u.data)*r,m=h+v;d.assert(null==e.instances.get(u.uniqueName));var y=u.instanceParameters.visible,g=!!u.instanceParameters.highlights&&y,_=!!u.instanceParameters.occludees,b=new f.Instance(h/r,m/r,y,g,_);e.instances.set(u.uniqueName,b),e.optimalCount+=v,i.end+=v}},Object.defineProperty(e.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!0,configurable:!0}),e}(),b={begin:0,end:0},x=s.mat4f64.create(),w=s.mat4f64.create(),S=s.mat4f64.create();return _}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.depthCompareLess={func:513},t.depthCompareAlways={func:519},t.stencilWriteMaskOn={mask:255},t.stencilWriteMaskOff={mask:0},t.renderWhenBitIsNotSet=function(e){return{function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}},t.replaceBitWhenDepthTestPasses=function(e){return{function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}},t.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},t.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},t.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},t.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1762)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(452),r(325),r(597),r(664),r(815),r(957),r(1789),r(1790),r(958)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p={planar:l,spherical:c};t.weakAssert=function(e,t){e||console.warn("Terrain: "+t)};var d=80/180*Math.PI,h=110/180*Math.PI;function f(e){return e&&"esri.views.3d.layers.ImageryTileLayerView3D"===e.declaredClass}function v(e){return e&&"esri.views.3d.layers.TileLayerView3D"===e.declaredClass}function m(e){return e&&"esri.views.3d.layers.VectorTileLayerView3D"===e.declaredClass}function y(e){return e&&"esri.views.3d.layers.WMTSLayerView3D"===e.declaredClass}function g(e){return e&&"esri.views.3d.layers.ElevationLayerView3D"===e.declaredClass}function _(e,t,r,n){return p["local"===n||"planar"===n?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(e,r,t)}t.autoUpdateSkirtsVisibility=function(e,t,r,n){var i,o=p[e.manifold],a=o.isInsideExtent(e,t);if(a)i=e.getElevation(t[0],t[1],t[1],r);else{var s=e.elevationBounds;i=.5*(s.min+s.max)}var l=t[2]-i,c=Math.abs(l)<n?0:l<0?-1:1;if(!a)if(o.isInsideExtent(e,t,1.2)){var u=o.tiltToExtentEdge(e,t);u>d&&u<h&&(c=0)}else c=0;e.skirtScale=c},t.getLayerWithExtentRange=function(e){return f(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer},t.isVectorTileLayer=function(e){return e&&e instanceof i},t.isImageryTileLayerView=f,t.isTileLayerView=v,t.isVectorTileLayerView=m,t.isWMTSLayerView=y,t.isElevationLayerView=g,t.isSurfaceLayerView=function(e){return e&&(v(e)||f(e)||g(e)||m(e)||y(e))},t.isImageryTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof s.default},t.isVectorTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof o.VectorTile},t.isTextureTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof u.TileTexture},t.isRasterTileRenderInfo=function(e){var t=e&&e.sourceLayerInfo&&e.sourceLayerInfo.data;return t instanceof HTMLImageElement||t instanceof a.ImageWithType||t instanceof HTMLCanvasElement||t instanceof ImageData},t.useFetchTileForLayer=function(e){return e.fetchTile&&!(e.fetchTile===n.prototype.fetchTile||e.fetchTile===r.prototype.fetchTile)},t.checkIfTileInfoSupportedForView=_,t.getTiledLayerInfo=function(e,r,n){var i,o;if("wmts"===e.type){var a=e.activeLayer;if(a){var s=a.tileMatrixSet;if(s)i=s.tileInfo,o=s.fullExtent;else{var l=a.tileMatrixSets;if(l){var c=l.find((function(e){return null==_(e.tileInfo,e.fullExtent,r,n)}));if(c)return{tileInfo:c.tileInfo,fullExtent:c.fullExtent}}}}}else o="imagery-tile"===e.type?e.getCompatibleFullExtent(r):e.fullExtent,i="vector-tile"!==e.type||t.test.force512VTL?"imagery-tile"===e.type?e.getCompatibleTileInfo(r,o):e.tileInfo:e.compatibleTileInfo256;return i&&o&&null==_(i,o,r,n)?{tileInfo:i,fullExtent:o}:{tileInfo:null,fullExtent:null}},t.test={force512VTL:!1}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182),r(171),r(179),r(776)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.colorAndTransparencyProperty={type:r,json:{type:[i.Integer],default:null,read:{source:["color","transparency"],reader:function(e,t){var n=null!=t.transparency?o.transparencyToOpacity(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new r([i[0]||0,i[1]||0,i[2]||0,n]):null}},write:{target:{color:{type:[i.Integer]},transparency:{type:i.Integer}},writer:function(e,t){t.color=e.toJSON().slice(0,3);var r=o.opacityToTransparency(e.a);0!==r&&(t.transparency=r)}}}},t.screenSizeProperty={type:Number,cast:n.toPt,json:{write:!0}},t.stipplePatternProperty={type:[Number],cast:function(e){return null!=e?e:Array.isArray(e)?e.map(n.toPt):null},json:{read:!1,write:!1}}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(231),r(157),r(151),r(851)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updating=!1,t.handleId=0,t.handles=new i,t.scheduleHandleId=0,t.pendingPromises=new Set,t}return r.__extends(t,e),t.prototype.destroy=function(){this.removeAll(),this.handles.destroy()},t.prototype.add=function(e,t,r,n){var i=this;void 0===n&&(n=0);var o=0!=(1&n),s=++this.handleId;o||this.installSyncUpdatingWatch(e,t,s);var l=0!=(2&n)?a.init(e,t,r,o):e.watch(t,r,o);return this.handles.add(l,s),{remove:function(){i.handles.remove(s)}}},t.prototype.addOnCollectionPropertyChange=function(e,t,r,n){var i=this;void 0===n&&(n=0);var o=0!=(2&n),s=++this.handleId;return this.handles.add([a.on(e,t,"after-changes",this.createSyncUpdatingCallback()),a.on(e,t,"change",r,o?function(e){r({added:e.items,removed:[],moved:[],target:e})}:null)],s),{remove:function(){i.handles.remove(s)}}},t.prototype.addOnCollectionChange=function(e,t,r){var n=this;void 0===r&&(r=0);var i=0!=(2&r),o=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],o),i&&t({added:e.items,removed:[],moved:[],target:e}),{remove:function(){n.handles.remove(o)}}},t.prototype.addPromise=function(e){var t=this;if(!e)return e;var r=++this.handleId;this.handles.add({remove:function(){t.pendingPromises.delete(e)&&(0!==t.pendingPromises.size||t.handles.has(u)||t._set("updating",!1))}},r),this.pendingPromises.add(e),this._set("updating",!0);var n=function(){return t.handles.remove(r)};return e.then(n,n),e},t.prototype.removeAll=function(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)},t.prototype.installSyncUpdatingWatch=function(e,t,r){var n=l.default(e,t,this.createSyncUpdatingCallback());return this.handles.add(n,r),n},t.prototype.createSyncUpdatingCallback=function(){var e=this;return function(){e.handles.remove(u),++e.scheduleHandleId;var t=e.scheduleHandleId;e._get("updating")||e._set("updating",!0),e.handles.add(o.schedule((function(){t===e.scheduleHandleId&&(e._set("updating",e.pendingPromises.size>0),e.handles.remove(u))})),u)}},r.__decorate([s.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([s.subclass("esri.views.support.WatchUpdatingTracking")],t)}(n);t.WatchUpdatingTracking=c;var u=-42}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1621)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3f32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(152),r(185),r(162),r(160),r(203),r(391),r(446)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=r("esri-debug-messages"),p=function(){function e(e){this.options=new l.IntersectorOptions,this.results=new l.IntersectorResults,this.transform=new l.IntersectorTransform,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=1e-5,this.verticalOffset=null,this._ray={origin:a.vec3f64.create(),direction:a.vec3f64.create()},this._rayEndPoint=a.vec3f64.create(),this._rayStartPointTransformed=a.vec3f64.create(),this._rayEndPointTransformed=a.vec3f64.create(),this.viewingMode=e||"global"}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0}),e.prototype.reset=function(e,t){this.resetWithRay(s.ray.fromPoints(e,t,this._ray))},e.prototype.resetWithRay=function(e){e!==this._ray&&s.ray.copy(e,this._ray),0!==this.options.verticalOffset?"local"===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,o.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)},e.prototype.intersect=function(e,t,r,i,o,a){var s=this;this.point=t,this.camera=r,this.filterPredicate=o,this.tolerance=null==i?1e-5:i;var c,p=l.getVerticalOffsetObject3D(this.verticalOffset);u&&(c=performance.now());var d=a?function(e){a(e)&&s.intersectObject(e)}:function(e){s.intersectObject(e)};if(e&&e.length>0)for(var h=0,f=e;h<f.length;h++){var v=f[h],m=v.getSpatialQueryAccelerator&&v.getSpatialQueryAccelerator();if(m)n.isSome(p)?m.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,d,p):m.forEachAlongRay(this._ray.origin,this._ray.direction,d),this.options.selectionMode&&this.options.hud&&m.forEachDegenerateObject(d);else for(var y=0,g=v.getObjects();y<g.length;y++)d(g[y])}this.sortResults(),u&&(this.performanceInfo.queryDuration=performance.now()-c,this.performanceInfo.numObjectsTested=this._numObjectsTested)},e.prototype.intersectObject=function(e){var t=this;this._numObjectsTested++;var r=e.geometryRecords;if(r)for(var a,s=e.id,u=e.objectTransformation,p=l.getVerticalOffsetObject3D(this.verticalOffset),d=function(r){var d=r.geometry,f=r.material,v=r.instanceParameters;if(c.isInstanceHidden(v))return"continue";a=d.id,h.transform.setAndInvalidateLazyTransforms(u,r.getShaderTransformation()),o.vec3.transformMat4(h._rayStartPointTransformed,h._ray.origin,h.transform.inverse),o.vec3.transformMat4(h._rayEndPointTransformed,h._rayEndPoint,h.transform.inverse);var m=h.transform.transform;n.isSome(p)&&(p.objectTransform=h.transform),f.intersect(d,v,h.transform.transform,h,h._rayStartPointTransformed,h._rayEndPointTransformed,(function(r,o,c,u,p,d){if(r>=0){if(n.isSome(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,r))return;if(p)return void((null==t.results.hud.dist||r<t.results.hud.dist)&&t.results.hud.set(e,s,r,o,i.mat4f64.IDENTITY,u,d,a,c));var h=function(t){return t.set(e,s,r,o,m,u,null,a,c)};if((null==t.results.min.drapedLayerOrder||u>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||r<t.results.min.dist)&&h(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||u<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||r>t.results.max.dist)&&h(t.results.max),2===t.options.store){var f=new l.IntersectorResult(t._ray);h(f),t.results.all.push(f)}}}),r.shaderTransformation)},h=this,f=0,v=r;f<v.length;f++)d(v[f])},e.prototype.sortResults=function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))},e.DEFAULT_TOLERANCE=1e-5,e}();t.Intersector=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(272),r(276),r(189),r(185),r(444),r(647),r(162),r(389),r(160),r(245),r(201),r(203),r(917),r(919),r(417)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){Object.defineProperty(t,"__esModule",{value:!0}),t.sliceFilterPredicate=function(e){return function(t,r,n){return c.vec3.lerp(E,t,r,n),!v.extrusionContainsPoint(e,E)}};t.IntersectorOptions=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.storeTerrainResults=!0,this.store=2};var g=function(){function e(){this._transform=a.mat4f64.create(),this._transformInverse=new _({value:this._transform},o.mat4.invert,a.mat4f64.create),this._transformInverseTranspose=new _(this._transformInverse,o.mat4.transpose,a.mat4f64.create),this._transformTranspose=new _({value:this._transform},o.mat4.transpose,a.mat4f64.create),this._transformInverseRotation=new _({value:this._transform},n.mat3.normalFromMat4Legacy,i.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.setTransformMatrix=function(e){o.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){o.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){o.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=g;var _=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),b=function(){function e(){this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]},e}();t.IntersectorResults=b;var x=function(){function e(e){this.normal=p.vec3f64.create(),this.transformation=a.mat4f64.create(),this._ray=f.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return c.vec3.scale(I,this.ray.direction,this.dist),c.vec3.length(I)},enumerable:!0,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(c.vec3.scale(I,this.ray.direction,this.dist),c.vec3.add(e,this.ray.origin,I),!0)},e.prototype.getTransformedNormal=function(e){return c.vec3.copy(R,this.normal),R[3]=0,d.vec4.transformMat4(R,R,this.transformation),c.vec3.copy(e,R),c.vec3.normalize(e,e),e},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?f.ray.copy(e,this._ray):this._ray=f.ray.create()},e.prototype.set=function(e,t,r,n,i,a,s,l,u,d){e instanceof y&&(e={type:"stage",obj:e}),this.dist=r,c.vec3.copy(this.normal,n),o.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=a,this.center=s?p.vec3f64.clone(s):null,this.geometryId=l,this.triangleNr=u,this.drapedLayerGraphicOrder=d},e.prototype.copyFrom=function(e){f.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?p.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,c.vec3.copy(this.normal,e.normal),o.mat4.copy(this.transformation,e.transformation)},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var r=e.metadata.layerUid;return null!=r?t.map.findLayerByUid(r):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null},e}();function w(e,t){return r.isNone(e)||null==e.layerUid?null:r.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(r.isNone(e))return null;var n=w(e,t);if(r.isNone(n))return null;if(n===t.graphics)return r.isSome(t.graphicsView)?r.unwrap(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var i=t.allLayerViews.find((function(e){return e.layer===n}));return i?function(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}(i,e):null}t.IntersectorResult=x;var P=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,r){var n=e+this.localOrigin[0],i=t+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+i*i+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=r+o*a,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0]+this.localOrigin[0],r=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],a=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*s,e[1]+=r*s,e[2]+=n*s;var l=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*l,e[4]+=o*l,e[5]+=a*l,e},e}();t.TerrainVerticalOffsetGlobalViewingMode=P;var T=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=p.vec3f64.create(),this.mbs=h.vec4f64.create(),this.obb={center:p.vec3f64.create(),halfSize:u.vec3f32.create(),quaternion:null}}return Object.defineProperty(e.prototype,"localOrigin",{set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},enumerable:!0,configurable:!0}),e.prototype.applyToVertex=function(e,t,r){var n=e,i=t,o=r+this.componentLocalOriginLength,a=this.offset/Math.sqrt(n*n+i*i+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=t+i*a,this.tmpVertex[2]=r+o*a,this.tmpVertex},e.prototype.applyToAABB=function(e){var t=e[0],r=e[1],n=e[2]+this.componentLocalOriginLength,i=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*s,e[1]+=r*s,e[2]+=n*s;var l=this.offset/Math.sqrt(i*i+o*o+a*a);return e[3]+=i*l,e[4]+=o*l,e[5]+=a*l,e},e.prototype.applyToMbs=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.mbs[0]=e[0]+e[0]*r,this.mbs[1]=e[1]+e[1]*r,this.mbs[2]=e[2]+e[2]*r,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs},e.prototype.applyToObb=function(e){var t=e.center,r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*r,this.obb.center[1]=t[1]+t[1]*r,this.obb.center[2]=t[2]+t[2]*r,c.vec3.transformQuat(this.obb.halfSize,e.halfSize,e.quaternion),c.vec3.add(this.obb.halfSize,this.obb.halfSize,e.center);var n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,c.vec3.subtract(this.obb.halfSize,this.obb.halfSize,e.center),s.quat.conjugate(D,e.quaternion),c.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,D),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb},e}();t.I3SVerticalOffsetGlobalViewingMode=T;var O=function(){function e(e){void 0===e&&(e=0),this.offset=e,this.sphere=m.create(),this.tmpVertex=p.vec3f64.create()}return e.prototype.applyToVertex=function(e,t,r){var n=this.objectTransform.transform,i=n[0]*e+n[4]*t+n[8]*r+n[12],o=n[1]*e+n[5]*t+n[9]*r+n[13],a=n[2]*e+n[6]*t+n[10]*r+n[14],s=this.offset/Math.sqrt(i*i+o*o+a*a);i+=i*s,o+=o*s,a+=a*s;var l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*i+l[4]*o+l[8]*a+l[12],this.tmpVertex[1]=l[1]*i+l[5]*o+l[9]*a+l[13],this.tmpVertex[2]=l[2]*i+l[6]*o+l[10]*a+l[14],this.tmpVertex},e.prototype.applyToMinMax=function(e,t){var r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;var n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n},e.prototype.applyToAABB=function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e},e.prototype.applyToBoundingSphere=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),n=this.offset/r;return this.sphere.center[0]=t[0]+t[0]*n,this.sphere.center[1]=t[1]+t[1]*n,this.sphere.center[2]=t[2]+t[2]*n,this.sphere.radius=e+e*this.offset/r,this.sphere},e}();t.Object3DVerticalOffsetGlobalViewingMode=O;var C=new O;t.getVerticalOffsetObject3D=function(e){return r.isSome(e)?(C.offset=e,C):null};var M=new T;t.getVerticalOffsetI3S=function(e){return r.isSome(e)?(M.offset=e,M):null};var A=new P;t.getVerticalOffsetTerrain=function(e){return r.isSome(e)?(A.offset=e,A):null},t.TERRAIN_ID="terrain";var E=p.vec3f64.create(),I=p.vec3f64.create(),R=h.vec4f64.create(),D=l.quatf64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(947),r(299)],void 0===(i=function(e,t,r,n,i){return function(){function e(t,o,a,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:o.colorTarget,depthStencilTarget:o.depthStencilTarget,width:o.width,height:o.height,multisampled:o.multisampled},this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.increment(4,this),a){var l=void 0;a instanceof i?(this._colorAttachment=a,l=a.descriptor):(l=a,this._colorAttachment=new i(this._context,l)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),e._validateTextureDimensions(l,this._desc)}if(s instanceof n)2===o.depthStencilTarget?this._stencilAttachment=s:1===o.depthStencilTarget||3===o.depthStencilTarget?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var c=void 0;s instanceof i?(this._depthStencilTexture=s,c=this._depthStencilTexture.descriptor):(c=s,this._depthStencilTexture=new i(this._context,c)),e._validateTextureDimensions(c,this._desc)}}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof i?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._context){var e=this._context,t=e.getBoundFramebufferObject();this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(e.gl.deleteFramebuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&e.instanceCounter.decrement(4,this),e.bindFramebuffer(t),this._context=null}},e.prototype.attachColorTexture=function(t){if(t){var r=t.descriptor;if(e._validateTextureDimensions(r,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){if(this._colorAttachment instanceof i){var e=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}return this._colorAttachment=null,e}},e.prototype.attachDepthStencilTexture=function(t){if(t){var r=t.descriptor;if(34041!==r.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==r.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),e._validateTextureDimensions(r,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var r=t.descriptor;if(34041!==r.internalFormat&&33189!==r.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),e._validateBufferDimensions(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===r.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl,i=1===this._desc.depthStencilTarget?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,i,n.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,r,n,i,o,a){(e<0||t<0||i<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");var s=this._desc,l=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>s.width||t+n>s.height||i+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");var c=this._context;c.bindTexture(a),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,i,o,e,t,r,n)},e.prototype.readPixels=function(e,t,r,n,i,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,n,i,o,a)},e.prototype.resize=function(t,r){var n=this._desc;if(n.width!==t||n.height!==r)if(this._initialized){var o;n.width=t,n.height=r,this._colorAttachment instanceof i?((o=(a=this._colorAttachment).descriptor).width=t,o.height=r,this._colorAttachment.dispose(),this._colorAttachment=new i(this._context,o),e._validateTextureDimensions(a.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?((o=this._depthStencilTexture.descriptor).width=t,o.height=r,this._depthStencilTexture.dispose(),this._depthStencilTexture=new i(this._context,o)):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,r),this._stencilAttachment&&this._stencilAttachment.resize(t,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}else{var a;n.width=t,n.height=r,this._colorAttachment instanceof i&&(a=this._colorAttachment).resize(t,r),this._depthStencilTexture&&this._depthStencilTexture.resize(t,r)}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),o=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===o.colorTarget){var a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:o.width,height:o.height};this._colorAttachment=new i(this._context,a)}else{var s=new n(this._context,{internalFormat:32854,width:o.width,height:o.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,s.glName),this._colorAttachment=s}if(this._colorAttachment instanceof i){var l=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l.glName,0)}switch(o.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new n(this._context,{internalFormat:1===o.depthStencilTarget?33189:34041,width:o.width,height:o.height}));var c=1===o.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,c,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new n(this._context,{internalFormat:36168,width:o.width,height:o.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var u={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:o.width,height:o.height};this._depthStencilTexture=new i(this._context,u)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return r("esri-validate-shaders")&&e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof i){var e=this._colorAttachment;this._initialized&&(this._context.bindFramebuffer(this),(r=this._context.gl).framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)),e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=[0,0];function n(e,t){return i(e,t[0],t[1])}function i(e,t,r,n){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(null==n||!e.hasZ||n>=e.zmin&&n<=e.zmax)}function o(e,t){return function(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return a(!1,e,t);for(var r=!1,n=0,i=e.length;n<i;n++)r=a(r,e[n],t);return r}(e.rings,t)}function a(e,t,r){for(var n=r[0],i=r[1],o=e,a=0,s=0,l=t.length;s<l;s++){++a===l&&(a=0);var c=t[s],u=c[0],p=c[1],d=t[a],h=d[0],f=d[1];(p<i&&f>=i||f<i&&p>=i)&&u+(i-p)/(f-p)*(h-u)<n&&(o=!o)}return o}t.extentContainsPoint=function(e,t){return i(e,t.x,t.y,t.z)},t.extentContainsMultipoint=function(e,t){if(!t.points||t.points.length)return!1;for(var r=0,i=t.points;r<i.length;r++)if(!n(e,i[r]))return!1;return!0},t.extentContainsExtent=function(e,t){var r=t.xmin,n=t.ymin,o=t.zmin,a=t.xmax,s=t.ymax,l=t.zmax;return e.hasZ&&t.hasZ?i(e,r,n,o)&&i(e,r,s,o)&&i(e,a,s,o)&&i(e,a,n,o)&&i(e,r,n,l)&&i(e,r,s,l)&&i(e,a,s,l)&&i(e,a,n,l):i(e,r,n)&&i(e,r,s)&&i(e,a,s)&&i(e,a,n)},t.extentContainsCoords2D=n,t.extentContainsCoords3D=function(e,t){return i(e,t[0],t[1],t[2])},t.polygonContainsPoint=function(e,t){return r[1]=t.y,r[0]=t.x,o(e,r)},t.polygonContainsCoords=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(761),r(154),r(156),r(521),r(243)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=o.getLogger("esri.views.2d.support.arcadeOnDemand");t.callWithOptimizedFeature=function(e,t,n,i,o){var a=i.geometryType,c=i.hasZ,p=i.hasM,d=e.referencesGeometry()?o?u(e,s.convertToFeature(t,a,c,p),a,o):s.convertToFeature(t,a,c,p):t,h=e.repurposeFeature(d);try{return e.evaluate(r.__assign(r.__assign({},n),{$feature:h}))}catch(e){return l.warn("Feature arcade evaluation failed:",e),null}},t.callWithFeature=function(e,t,n,i,o){var a=e.referencesGeometry()&&o?u(e,t,i,o):t,s=e.repurposeFeature(a);try{return e.evaluate(r.__assign(r.__assign({},n),{$feature:s}))}catch(e){return l.warn("Feature arcade evaluation failed:",e),null}};var c=new n.default;function u(e,t,n,i){var o=i.transform,a=i.hasZ,s=i.hasM;c.has(e)||c.set(e,p(n));var l=c.get(e)(t.geometry,o,a,s);return r.__assign(r.__assign({},t),{geometry:l})}function p(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,n,i){return a.hydratePoint(r,t,e,n,i)};case"esriGeometryPolygon":return function(e,r,n,i){return a.hydratePolygon(r,t,e,n,i)};case"esriGeometryPolyline":return function(e,r,n,i){return a.hydratePolyline(r,t,e,n,i)};case"esriGeometryMultipoint":return function(e,r,n,i){return a.hydrateMultipoint(r,t,e,n,i)};default:return l.error(new i("mapview-arcade","Unable to handle geometryType: "+e)),function(e){return e}}}t.createHydrateFactory=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o){var a=n.strict()({Icon:"icon",Object:"object",Line:"line",Path:"path",Fill:"fill",Extrude:"extrude",Text:"text",Water:"water"}),s=function(e){function t(t){var r=e.call(this,t)||this;return r.enabled=!0,r.type=null,r}return r.__extends(t,e),t.prototype.writeEnabled=function(e,t,r){e||(t[r]=e)},r.__decorate([o.property({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],t.prototype,"enabled",void 0),r.__decorate([o.writer("enabled")],t.prototype,"writeEnabled",null),r.__decorate([o.property({type:a.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:a.write}}})],t.prototype,"type",void 0),r.__decorate([o.subclass("esri.symbols.Symbol3DLayer")],t)}(i.JSONSupport);return function(e){e.typeJSONDictionary=a}(s||(s={})),s}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(297),r(191),r(1104),r(519),r(763)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=["oid","global-id"],l=["oid","global-id","guid"];t.createPopupTemplate=function(e,t){var o=e.displayField,a=e.editFieldsInfo,s=e.fields,l=e.objectIdField,c=e.title;if(!s)return null;var u=f({editFieldsInfo:a,fields:s,objectIdField:l},t);if(!u.length)return null;var p=function(e){var t=n.getDisplayFieldName(e),r=e.titleBase;return t?r+": {"+t.trim()+"}":r}({titleBase:c,fields:s,displayField:o}),d=[new i.FieldsContent,new i.AttachmentsContent];return new r({title:p,content:d,fieldInfos:u})};var c=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],u=function(e,t){var r=t.editFieldsInfo,n=t.objectIdField,i=t.visibleFieldNames;return i?i.has(e.name):!(d(e.name,r)||n&&e.name===n||s.indexOf(e.type)>-1||c.some((function(t){return t.test(e.name)})))};function p(e,t){return"oid"===e.type?-1:"oid"===t.type?1:m(e)?-1:m(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function d(e,t){if(!e||!t)return!1;var r=t.creationDateField,n=t.creatorField,i=t.editDateField,o=t.editorField;return-1!==[r&&r.toLowerCase(),n&&n.toLowerCase(),i&&i.toLowerCase(),o&&o.toLowerCase()].indexOf(e.toLowerCase())}function h(e,t){return e.editable&&-1===l.indexOf(e.type)&&!d(e.name,t)}function f(e,t){var r=e.editFieldsInfo,n=e.fields,i=e.objectIdField;return function(e,t){var r=e;return t&&(e=e.filter((function(e){return-1===t.indexOf(e.type)}))),e===r&&(e=e.slice()),e.sort(p),e}(n,(null==t?void 0:t.ignoreFieldTypes)||y).map((function(e){return new o({fieldName:e.name,isEditable:h(e,r),label:e.alias,format:v(e),visible:u(e,{editFieldsInfo:r,objectIdField:i,visibleFieldNames:null==t?void 0:t.visibleFieldNames})})}))}function v(e){switch(e.type){case"small-integer":case"integer":case"single":return new a({digitSeparator:!0,places:0});case"double":return new a({digitSeparator:!0,places:2});case"date":return new a({dateFormat:"long-month-day-year"});default:return null}}function m(e){return"name"===(e.name&&e.name.toLowerCase())||"name"===(e.alias&&e.alias.toLowerCase())||void 0}t.createFieldsContent=function(e,t){return new i.FieldsContent({fieldInfos:f(e,t).filter((function(e){return e.visible}))})},t.createFieldInfos=f;var y=["geometry","blob","raster","guid","xml"]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EPSILON=1e-6,t.RANDOM=Math.random;var r=Math.PI/180,n=180/Math.PI;t.toRadian=function(e){return e*r},t.toDegree=function(e){return e*n},t.equals=function(e,r){return Math.abs(e-r)<=t.EPSILON*Math.max(1,Math.abs(e),Math.abs(r))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1553)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(178),r(1556),r(586),r(286),r(1557)],void 0===(i=function(e,t,r,n,i,o,a){var s=new o("0/0/0/0"),l=function(){function e(e,t,r,n,i,o,a,s){this.x=e,this.ymin=t,this.ymax=r,this.invM=n,this.leftAdjust=i,this.rightAdjust=o,this.leftBound=a,this.rightBound=s}return e.create=function(t,r){var n;t[1]>r[1]&&(t=(n=[r,t])[0],r=n[1]);var i=t[0],o=t[1],a=r[0],s=r[1],l=a-i,c=s-o,u=0!==c?l/c:0,p=(Math.ceil(o)-o)*u,d=(Math.floor(o)-o)*u;return new e(i,Math.floor(o),Math.ceil(s),u,l<0?p:d,l<0?d:p,l<0?a:i,l<0?i:a)},e.prototype.incrRow=function(){this.x+=this.invM},e.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},e.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},e}(),c=[[0,0],[0,0],[0,0],[0,0]];return function(){function e(e,t){var r=this;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var i=e.lods.slice();i.sort((function(e,t){return t.scale-e.scale}));var o=this._lodInfos=i.map((function(r){return n.create(e,r,t)}));i.forEach((function(e,t){r._infoByLevel[e.level]=o[t],r._infoByScale[e.scale]=o[t],r.scales[t]=e.scale}),this),this._wrap=e.isWrappable}return Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0}),e.prototype.getLODInfoAt=function(e){return this._infoByLevel["number"==typeof e?e:e.level]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),s.set(t);var n=this._infoByLevel[s.level];return n?n.getTileBounds(e,s,r):e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),s.set(t);var n=this._infoByLevel[s.level];return n?n.getTileCoords(e,s,r):e},e.prototype.getTileCoverage=function(e,t,r){void 0===t&&(t=192),void 0===r&&(r="closest");var n,o,s,u="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),p=i.pool.acquire(u),d=this._wrap,h=1/0,f=-1/0,v=p.spans;c[0][0]=c[0][1]=c[1][1]=c[3][0]=-t,c[1][0]=c[2][0]=e.size[0]+t,c[2][1]=c[3][1]=e.size[1]+t;for(var m=0,y=c;m<y.length;m++){var g=y[m];e.toMap(g,g),g[0]=u.getColumnForX(g[0]),g[1]=u.getRowForY(g[1])}for(var _=[],b=3,x=0;x<4;x++)if(c[x][1]!==c[b][1]){var w=l.create(c[x],c[b]);h=Math.min(w.ymin,h),f=Math.max(w.ymax,f),void 0===_[w.ymin]&&(_[w.ymin]=[]),_[w.ymin].push(w),b=x}else b=x;if(null==h||null==f||f-h>100)return null;var S=[];for(n=h;n<f;){for(null!=_[n]&&(S=S.concat(_[n])),o=1/0,s=-1/0,x=S.length-1;x>=0;x--)w=S[x],o=Math.min(o,w.getLeftCol()),s=Math.max(s,w.getRightCol());if(o=Math.floor(o),s=Math.floor(s),n>=u.first[1]&&n<=u.last[1])if(d)if(u.size[0]<u.worldSize[0]){var P=Math.floor(s/u.worldSize[0]);for(x=Math.floor(o/u.worldSize[0]);x<=P;x++)v.push(new a(n,Math.max(u.getFirstColumnForWorld(x),o),Math.min(u.getLastColumnForWorld(x),s)))}else v.push(new a(n,o,s));else o>u.last[0]||s<u.first[0]||(o=Math.max(o,u.first[0]),s=Math.min(s,u.last[0]),v.push(new a(n,o,s)));for(n+=1,x=S.length-1;x>=0;x--)(w=S[x]).ymax>=n?w.incrRow():S.splice(x,1)}return p},e.prototype.getTileParentId=function(e){s.set(e);var t=this._infoByLevel[s.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(s,this._lodInfos[r],s),s.id)},e.prototype.getTileResolution=function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1},e.prototype.getTileScale=function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1},e.prototype.intersects=function(e,t){s.set(t);var r=this._infoByLevel[s.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(s,n,s);for(var i=n.denormalizeCol(s.col,s.world),o=0,a=e.spans;o<a.length;o++){var l=a[o];if(l.row===s.row&&l.colFrom<=i&&l.colTo>=i)return!0}}if(n.resolution<r.resolution){var c=e.spans.reduce((function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e}),[1/0,-1/0,1/0,-1/0]),u=c[0],p=c[1],d=c[2],h=c[3],f=r.denormalizeCol(s.col,s.world),v=n.getColumnForX(r.getXForColumn(f)),m=n.getRowForY(r.getYForRow(s.row)),y=n.getColumnForX(r.getXForColumn(f+1))-1,g=n.getRowForY(r.getYForRow(s.row+1))-1;return!(v>h||y<d||m>p||g<u)}var _=n.denormalizeCol(s.col,s.world);return e.spans.some((function(e){return e.row===s.row&&e.colFrom<=_&&e.colTo>=_}))},e.prototype.normalizeBounds=function(e,t,n){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var i=r.getInfo(this.tileInfo.spatialReference),o=-n*(i.valid[1]-i.valid[0]);e[0]+=o,e[2]+=o}return e},e.prototype.getSmallestInfoForScale=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]},e.prototype.getClosestInfoForScale=function(e){var t=this.scales;return this._infoByScale[e]||(e=t.reduce((function(t,r){return Math.abs(r-e)<Math.abs(t-e)?r:t}),t[0])),this._infoByScale[e]},e.prototype.scaleToLevel=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r])return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1]);return this._infoByScale[t[0]].level},e.prototype.scaleToZoom=function(e){return this.tileInfo.scaleToZoom(e)},e.prototype._getTileIdAtLOD=function(e,t,r){var n=this._infoByLevel[r.level];return e.set(r),t.resolution<n.resolution?null:(t.resolution===n.resolution||(e.level=t.level,e.col=Math.floor(r.col*n.resolution/t.resolution+.01),e.row=Math.floor(r.row*n.resolution/t.resolution+.01)),e)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(173),r(588)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TILE_LOADING_DEBUGLOG=!1,t.MAX_ROOT_TILES=64,t.MAX_PATCH_TESSELATION=512,t.MAX_MEMORY_LOD_BIAS=2.5,t.ELEVATION_NODATA_VALUE=r.clampFloat32(r.NUMBER_MAX_FLOAT32/10),t.LOADING_LEVEL_MODULO=2,t.ELEVATION_DESIRED_RESOLUTION_LEVEL=4,t.WEBMERCATOR_WORLD_EXTENT=n.create(),i.WebMercatorAuxiliarySphere.getExtent(0,0,0,t.WEBMERCATOR_WORLD_EXTENT),t.GEOGRAPHIC_WORLD_EXTENT=n.create([-180,-90,180,90]),t.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.",t.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.",t.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",t.GEOMETRY_VERTEX_STRIDE=5}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(228),r(796),r(307),r(299),r(318)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t,o){void 0===t&&(t=n.Pos2),void 0===o&&(o=r.Default3D);var s=null;switch(t){case n.Pos2Tex:s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case n.Pos2:default:s=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new a(e,o,{geometry:t},{geometry:i.createVertex(e,35044,s)})},t.createEmptyTexture=function(e,t){return void 0===t&&(t=4),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=4);for(var n=new Uint8Array(r*r*4),i=0;i<n.length;i+=4)n[i+0]=255*t[0],n[i+1]=255*t[1],n[i+2]=255*t[2],n[i+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},n)},t.createEmptyDepthTexture=function(e){return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(189),r(185),r(162),r(160),r(251),r(1186),r(534),r(445),r(195),r(446)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=o.mat4f64.create(),this._bvObjectSpace=new m,this._bvWorldSpace=new m,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.id=e._idGen.gen(t.idHint),this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v),this.objectTransformation=o.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){i.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._geometryRecords;e<t.length;e++){var r=t[e];c.pool.release(r)}this._geometryRecords=null,this._geometries=null},e.prototype._initializeGeometryRecords=function(e,t,r,n){if(!Array.isArray(e))return this._geometryRecords=[],void(this._geometries=[]);d.assert(t.length===e.length,"Object3D: materials don't match geometries"),d.assert(r.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords=new Array(e.length),this._geometries=e.slice();for(var i=0;i<e.length;i++)this._geometryRecords[i]=c.pool.acquire(e[i],t[i],o.mat4f64.clone(r[i]),{highlights:null,occludees:null,visible:!0},n&&n[i]);this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){d.assert(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this._geometries.length;r++)this._geometries[r]===e&&t.push(this._geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return d.assert(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]},e.prototype.addGeometry=function(e,t,r,n,i,a){r=r||o.mat4f64.IDENTITY,this._geometries.push(e);var s=c.pool.acquire(e,t,r,n||{highlights:null,occludees:null,visible:!0},i,a);return this._geometryRecords.push(s),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),s},e.prototype.removeGeometry=function(e){var t=this._geometryRecords.splice(e,1)[0];return c.pool.release(t),this._hasVolatileTransformation=this._geometryRecords.some((function(e){return!!e.shaderTransformation})),this._geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[e]),this._invalidateBoundingVolume()},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(e){this._visible=e;for(var t=0,r=this._geometryRecords;t<r.length;t++)r[t].instanceParameters.visible=this._visible;this._notifyDirty("visibilityChanged")},e.prototype.occlude=function(){for(var e=p.generateObject3DStateId(1),t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.occludees=h.addObject3DStateID(n.instanceParameters.occludees,e)}return this._notifyDirty("occlusionChanged"),e},e.prototype.removeOcclude=function(e){for(var t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.occludees=h.removeObject3DStateID(n.instanceParameters.occludees,e)}this._notifyDirty("occlusionChanged")},e.prototype.highlight=function(){for(var e=p.generateObject3DStateId(0),t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.highlights=h.addObject3DStateID(n.instanceParameters.highlights,e)}return this._notifyDirty("highlightChanged"),e},e.prototype.removeHighlight=function(e){for(var t=0,r=this._geometryRecords;t<r.length;t++){var n=r[t];n.instanceParameters.highlights=h.removeObject3DStateID(n.instanceParameters.highlights,e)}this._notifyDirty("highlightChanged")},e.prototype.setGeometryTransformation=function(e,t){d.assert(e>=0&&e<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var r=this._geometryRecords[e];c.pool.release(r);var n=c.pool.acquire(r.geometry,r.material,o.mat4f64.clone(t),r.instanceParameters);this._geometryRecords[e]=n,this._notifyDirty("objGeometryReplaced",[r,n]),this._invalidateBoundingVolume()},e.prototype.getCombinedStaticTransformation=function(e,t){return i.mat4.multiply(n.unwrapOr(t,o.mat4f64.create()),this.objectTransformation,e.getStaticTransformation())},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||o.mat4f64.create(),i.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],r=this._geometryRecords[e],n=t.boundingInfo;this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this.getCombinedShaderTransformation(r))}a.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),a.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var i=s.vec3f64.create(),o=s.vec3f64.create(),c=l.maxScale(this.objectTransformation);for(e=0;e<this._geometryRecords.length;++e){t=this._geometries[e];var u=this._geometryRecords[e].getShaderTransformation(),p=l.maxScale(u);n=t.boundingInfo,a.vec3.transformMat4(i,n.getCenter(),u);var d=a.vec3.distance(i,this._bvObjectSpace.center),h=n.getBSRadius()*p;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,d+h),a.vec3.transformMat4(o,i,this.objectTransformation);var f=a.vec3.distance(o,this._bvWorldSpace.center),v=h*c;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,f+v)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,r){var n=e.getBBMin(),i=e.getBBMax(),o=s.vec3f64.clone(n),l=s.vec3f64.clone(i);a.vec3.transformMat4(o,o,r),a.vec3.transformMat4(l,l,r);for(var c=0;c<3;++c)t.bbMin[c]=Math.min(t.bbMin[c],o[c],l[c]),t.bbMax[c]=Math.max(t.bbMax[c],o[c],l[c]);for(c=0;c<3;++c){a.vec3.copy(o,n),a.vec3.copy(l,i),o[c]=i[c],l[c]=n[c],a.vec3.transformMat4(o,o,r),a.vec3.transformMat4(l,l,r);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],o[u],l[u]),t.bbMax[u]=Math.max(t.bbMax[u],o[u],l[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,n){if(this._parentLayer){r=r||1;var i=n||this;this._parentLayer.notifyDirty(e,t,r,i)}},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}},enumerable:!0,configurable:!0}),e._idGen=new u.IdGen,e}(),v=function(){function e(){this.bbMin=s.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.bbMax=s.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return e.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]},e}(),m=function(e){function t(){var t=e.call(this)||this;return t.center=s.vec3f64.create(),t.bsRadius=0,t}return r.__extends(t,e),t.prototype.init=function(){a.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a.vec3.set(this.center,0,0,0),this.bsRadius=0},t.prototype.getCenter=function(){return this.center},t.prototype.getBSRadius=function(){return this.bsRadius},t}(v);return f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(162),r(160),r(193),r(448),r(262)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=function(){function e(t,r,n,i,o,a,s,l,c){this.uniqueGeometries=n,this.uniqueMaterials=i,this.uniqueTextures=o,this.elevationAligner=a,this.elevationContext=s,this._edgeState=l,this.type="object3d",this.stageLayer=null,this.stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=t,this.stageObject=r,this.visibilityMode=null!=c?c:e.VisibilityModes.HIDE_FACERANGE}return Object.defineProperty(e.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!0,configurable:!0}),e.prototype.initialize=function(e,t){if(this.stageLayer=t,this.stage=e,this.uniqueMaterials)for(var r=0;r<this.uniqueMaterials.length;r++)e.add(3,this.uniqueMaterials[r]);if(this.uniqueGeometries)for(r=0;r<this.uniqueGeometries.length;r++)e.add(2,this.uniqueGeometries[r]);if(this.uniqueTextures)for(r=0;r<this.uniqueTextures.length;r++)e.add(4,this.uniqueTextures[r]);e.add(1,this.stageObject)},e.prototype.layerOpacityChanged=function(e,t){if(!n.isNone(this._edgeState)){for(var r=u(this._edgeState.baseMaterial),i=!1,o=0,a=this._edgeState.edgeMaterials;o<a.length;o++){var s=a[o];s.objectTransparency!==r&&(s.objectTransparency=r,i=!0)}i&&this.resetEdgeObject(t),this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}},e.prototype.slicePlaneEnabledChanged=function(e,t){n.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:e},!t),this._edgeState.slicePlaneEnabled=e)},e.prototype.setVisibility=function(t){if(null!=this.stage){if(this._visible===t)return!1;if(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===e.VisibilityModes.HIDE_FACERANGE?this.stageObject.setVisible(!1):(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),n.isSome(this._edgeState)){var r=this.stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this.addOrUpdateEdgeObject(r,!1)}return!0}},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){var e=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var t=0;t<this.uniqueMaterials.length;t++)e.remove(3,this.uniqueMaterials[t].id);if(this.uniqueGeometries)for(t=0;t<this.uniqueGeometries.length;t++)e.remove(2,this.uniqueGeometries[t].id);if(this.uniqueTextures)for(t=0;t<this.uniqueTextures.length;t++)e.remove(4,this.uniqueTextures[t].id)}e.remove(1,this.stageObject.id),this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var r=this.stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this.stageLayer=null,this.stage=null},e.prototype.alignWithElevation=function(e,t,r,i){if(null!=this.elevationAligner){n.isSome(r)&&s.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var o=this.elevationAligner(this,this.elevationContext,e,t);null!=o&&(this.alignedSampledElevation=o),this.resetEdgeObject(i)}},e.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),i.vec3.copy(e,this.stageObject.getCenter(!0))},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=a.create()),function(e,t,r){return r||(r=a.create()),a.setMin(r,e.getBBMin(!0)),a.setMax(r,e.getBBMax(!0)),r}(this.stageObject,0,e)},e.prototype.computeAttachmentOrigin=function(e){for(var t=0,r=this.stageObject.geometryRecords;t<r.length;t++)r[t].computeAttachmentOrigin(h)&&(i.vec3.transformMat4(h,h,this.stageObject.objectTransformation),i.vec3.add(e.render.origin,e.render.origin,h),e.render.num++)},e.prototype.getProjectedBoundingBox=function(e,t,n,o,s){return r.__awaiter(this,void 0,void 0,(function(){var c,u,v,m,y,g,_,b,x,w;return r.__generator(this,(function(r){switch(r.label){case 0:for(c=this.getBoundingBoxObjectSpace(s),u=f,v=a.isPoint(c)?1:u.length,g=0;g<v;g++)m=u[g],d[0]=c[m[0]],d[1]=c[m[1]],d[2]=c[m[2]],i.vec3.transformMat4(d,d,this.stageObject.objectTransformation),p[3*g+0]=d[0],p[3*g+1]=d[1],p[3*g+2]=d[2];if(!e(p,0,v))return[2,null];for(a.empty(c),y=null,this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds()),g=0;g<3*v;g+=3){for(_=0;_<3;_++)c[_]=Math.min(c[_],p[g+_]),c[_+3]=Math.max(c[_+3],p[g+_]);y&&n.push({location:p.slice(g,g+3),screenSpaceBoundingRect:y})}return t&&t.service&&"absolute-height"!==this.elevationContext.mode?(a.center(c,h),b="relative-to-scene"===this.elevationContext.mode?"scene":"ground",x=void 0,t.useViewElevation?(x=t.service.getElevation(h[0],h[1],b),[3,4]):[3,1]):[3,5];case 1:return r.trys.push([1,3,,4]),w=l.demResolutionForBoundingBox(c,t),[4,t.service.queryElevation(h[0],h[1],o,w,b)];case 2:return x=r.sent(),[3,4];case 3:return r.sent(),x=null,[3,4];case 4:a.offset(c,0,0,-this.alignedSampledElevation+x),r.label=5;case 5:return[2,c]}}))}))},e.prototype.addObjectState=function(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.occlude())},e.prototype.removeObjectState=function(e){e.removeObject(this.stageObject)},e.prototype.resetEdgeObject=function(e){if(!n.isNone(this._edgeState)){var t=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}},e.prototype.addOrUpdateEdgeObject=function(e,t){var r=this._edgeState;if(!n.isNone(r)){for(var i=u(r.baseMaterial),o=0,a=r.edgeMaterials;o<a.length;o++)a[o].objectTransparency=i;e.addOrUpdateObject(this.stageObject,r.edgeMaterials,{slicePlaneEnabled:r.slicePlaneEnabled},!t,r.addObjectSettings)}},e}();function u(e){return e.isVisible?e.getParameters().transparent?1:2:0}!function(e){!function(e){e[e.REMOVE_OBJECT=0]="REMOVE_OBJECT",e[e.HIDE_FACERANGE=1]="HIDE_FACERANGE"}(e.VisibilityModes||(e.VisibilityModes={}))}(c||(c={}));var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=o.vec3f64.create(),h=o.vec3f64.create(),f=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(180),r(177),r(156),r(168),r(152),r(160),r(201),r(277),r(346),r(448),r(262),r(935),r(593)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){Object.defineProperty(t,"__esModule",{value:!0});var y=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),g=function(e){function t(t,r,n,i){var o=e.call(this)||this;return o._elevationInfoOverride=null,o.complexity=null,o.logger=y,o._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},o.symbol=t,o.symbolLayer=r,o._context=n,o._renderPriority=i.renderPriority,o._renderPriorityStep=i.renderPriorityStep,o._elevationContext=new d.ElevationContext,o.complexity=o.computeComplexity(),o._updateDrivenProperties(i.ignoreDrivers),o._updateElevationContext(),o}return r.__extends(t,e),t.prototype.getCachedSize=function(){return null},Object.defineProperty(t.prototype,"needsDrivenTransparentPass",{get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque},enumerable:!0,configurable:!0}),t.prototype._logGeometryCreationWarnings=function(e,t,r,n){var i=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=n+" geometry failed to be created",s=null;i?!t.length||1===t.length&&!t[0].length?s=a+" (no "+r+" were defined)":Array.isArray(t)&&Array.isArray(t[0])?t.some((function(e){return 1===e.length}))?s=a+" ("+r+" should contain at least 2 vertices)":o&&0===o.length&&"rings"===r&&(s=a+" (filled "+r+" should use clockwise winding - try reversing the order of vertices)"):s=a+" ("+r+" should be defined as a 2D array)":s=a+" (failed to project geometry to view spatial reference)",s&&y.warnOncePerTick(s)},t.prototype._validateGeometryType=function(e,t,r){return!!i.includes(t,e.type)||(this.logger.warn("unsupported geometry type for "+r+" symbol: "+e.type),!1)},t.prototype._validateGeometry=function(e){if("point"===e.type){var t=e;if(!s.isFinite(t.x)||!s.isFinite(t.y))return y.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0},t.prototype._defaultElevationInfoNoZ=function(){return b},t.prototype._defaultElevationInfoZ=function(){return x},t.prototype._updateElevationContext=function(){l.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()},t.prototype.getDefaultElevationInfo=function(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()},t.prototype.getGeometryElevationMode=function(e,t){return void 0===t&&(t=this.getDefaultElevationInfo(e)),this._elevationContext.mode||t.mode},t.prototype.setElevationInfoOverride=function(e){this._elevationInfoOverride=e,this._updateElevationContext()},t.prototype.setGraphicElevationContext=function(e,t){var r=l.unwrap(e.geometry),n=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:n.unit,t.mode=this.getGeometryElevationMode(r,n),t.offsetMeters=l.unwrapOr(this._elevationContext.meterUnitOffset,l.unwrapOr(n.offset,0));var i=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;i&&(t.mode="relative-to-ground",t.offsetMeters=0);var o=i?h.zeroContext:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(o,e,this._context.layer),t},t.prototype.prepareSymbolLayerPatch=function(e){},t.prototype.updateGeometry=function(e,t){return!1},t.prototype.onRemoveGraphic=function(e){},t.prototype._updateDrivenProperties=function(e){var t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)this._drivenProperties=t;else{var r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach((function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var n=e.stops[r].color;n&&(t.opacity=!0,n.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),this._drivenProperties=t}},t.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var e=this._context.layer.opacity;return null==e?1:e},t.prototype._getCombinedOpacity=function(e,t){void 0===t&&(t=w);var r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(l.isSome(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r},t.prototype._getCombinedOpacityAndColor=function(e,t){void 0===t&&(t=w);var r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return f.mixinColorAndOpacity(null,r);var i=l.isSome(e)?n.toUnitRGB(e):c.vec3f64.ONES;return f.mixinColorAndOpacity(i,r)},t.prototype._getVertexOpacityAndColor=function(e,t,r){var n=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,o=f.mixinColorAndOpacity(n,i);return r&&(o[0]*=r,o[1]*=r,o[2]*=r,o[3]*=r),t?new t(o):o},t.prototype._getIdHint=function(e){return void 0===e&&(e=""),this._context.layer.id+"_symbol"+e},t.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled},t.prototype.computeComplexity=function(){return m.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)},t.prototype.destroy=function(){this.abortLoad()},t.prototype.globalPropertyChanged=function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r);case"elevationInfo":var n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,n)!==p.SymbolUpdateType.RECREATE;case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return o.neverReachedSilent(e),!1}},t.prototype.updateGraphics3DGraphicElevationInfo=function(e,t,r){var n=this,i=p.SymbolUpdateType.UPDATE;return e.forEach((function(e){var o=t(e);if(l.isSome(o)){var a=e.graphic;n.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else i=p.SymbolUpdateType.RECREATE})),i},t.prototype.applyRendererDiff=function(e,t){return!1},t.prototype.getFastUpdateAttrValues=function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables,r=t.size?_(t.size.field,e):0,n=t.color?_(t.color.field,e):0,i=t.opacity?_(t.opacity.field,e):0;return u.vec4f64.fromValues(r,n,i,0)},Object.defineProperty(t.prototype,"draped",{get:function(){return this._draped},enumerable:!0,configurable:!0}),t.prototype.ensureDrapedStatus=function(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&y.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)},t}(v.Loadable);function _(e,t){var r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}t.Graphics3DSymbolLayer=g,t.getAttributeValue=_;var b={mode:"on-the-ground",offset:0,unit:"meters"},x={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1};t.default=g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(271),r(182),r(165),r(595),r(153),r(171),r(1697)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=r.getAssetUrl("../../symbols/patterns/"),u={left:"start",center:"middle",right:"end",justify:"start"},p={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},d=new o(1e3);t.getSVGAlign=function(e){var t=e.horizontalAlignment;return t&&u[t.toLowerCase()]||"middle"},t.getSVGBaseline=function(e){var t=e.verticalAlignment;return t&&p[t.toLowerCase()]||"alphabetic"},t.getSVGBaselineShift=function(e){return"bottom"===e.verticalAlignment?"super":null},t.getFill=function(e){var t=e.style,r=null;if(e)switch(e.type){case"simple-marker":"cross"!==t&&"x"!==t&&(r=e.color);break;case"simple-fill":"solid"===t?r=e.color:"none"!==t&&(r={type:"pattern",x:0,y:0,src:c+t+".png",width:8,height:8});break;case"picture-fill":r={type:"pattern",src:e.url,width:s.pt2px(e.width)*e.xscale,height:s.pt2px(e.height)*e.yscale,x:s.pt2px(e.xoffset),y:s.pt2px(e.yoffset)};break;case"text":r=e.color;break;case"cim":r=l.getCIMSymbolColor(e)}return r},t.getPatternUrlWithColor=function(e,t){var r=e+"-"+t;return void 0!==d.get(r)?a.resolve(d.get(r)):i(e,{responseType:"image"}).then((function(e){var n=e.data,i=n.naturalWidth,o=n.naturalHeight,a=document.createElement("canvas");a.width=i,a.height=o;var s=a.getContext("2d");s.fillStyle=t,s.fillRect(0,0,i,o),s.globalCompositeOperation="destination-in",s.drawImage(n,0,0);var l=a.toDataURL();return d.put(r,l),l}))},t.getStroke=function e(t){if(!t)return null;var r;switch(t.type){case"simple-fill":case"picture-fill":case"simple-marker":r=e(t.outline);break;case"simple-line":var n=s.pt2px(t.width);"none"!==t.style&&0!==n&&(r={color:t.color,style:f(t.style),width:n,cap:t.cap,join:"miter"===t.join?s.pt2px(t.miterLimit):t.join});break;default:r=null}return r};var h,f=(h={},function(e){if(h[e])return h[e];var t=e.replace(/-/g,"");return h[e]=t,t});t.defaultThematicColor=new n([128,128,128])}.apply(null,n))||(e.exports=i)},,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(178)],void 0===(i=function(e,t,r){function n(e,t){var r=t[0]-e[0],n=t[1]-e[1];if(e.length>2&&t.length>2){var i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}return Math.sqrt(r*r+n*n)}function i(e,t,r){var n=e[0]+r*(t[0]-e[0]),i=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[n,i,e[2]+r*(t[2]-e[2])]:[n,i]}function o(e,t,r){for(var n=e.length,i=0,o=0,a=0,s=0;s<n;s++){var l=e[s],c=e[(s+1)%n],u=2;i+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(o+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&t&&(a+=l[0]*c[u]-c[0]*l[u])}return i<=0&&o<=0&&a<=0}function a(e,t){var n=r.getInfo(t);if(n)for(var i=n.valid[0],o=n.valid[1],a=o-i,s=function(e){var t=1/0,r=-1/0;e.forEach((function(e){for(var n=e[0];n<i;)n+=a;for(;n>o;)n-=a;t=Math.min(t,n),r=Math.max(r,n),e[0]=n}));var n=r-t;a-n<n&&e.forEach((function(e){e[0]<0&&(e[0]+=a)}))},l=0,c=e;l<c.length;l++)s(c[l])}Object.defineProperty(t,"__esModule",{value:!0}),t.geometryToCoordinates=function(e){if(!e)return null;if(Array.isArray(e))return e;var t=e.hasZ,r=e.hasM;if("point"===e.type)return r&&t?[e.x,e.y,e.z,e.m]:t?[e.x,e.y,e.z]:r?[e.x,e.y,e.m]:[e.x,e.y];if("polygon"===e.type)return e.rings.slice(0);if("polyline"===e.type)return e.paths.slice(0);if("multipoint"===e.type)return e.points.slice(0);if("extent"===e.type){var n=e.clone().normalize();if(!n)return null;var i=!1,o=!1;return n.forEach((function(e){e.hasZ&&(i=!0),e.hasM&&(o=!0)})),n.map((function(e){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(i&&e.hasZ)for(var r=.5*(e.zmax-e.zmin),n=0;n<t.length;n++)t[n].push(r);if(o&&e.hasM){var a=.5*(e.mmax-e.mmin);for(n=0;n<t.length;n++)t[n].push(a)}return t}))}return null},t.getLength=n,t.getMidpoint=function(e,t){return i(e,t,.5)},t.getPathLength=function(e){for(var t=e.length,r=0,i=0;i<t-1;++i)r+=n(e[i],e[i+1]);return r},t.getPointOnPath=function(e,t){if(t<=0)return e[0];for(var r=e.length,o=0,a=0;a<r-1;++a){var s=n(e[a],e[a+1]);if(t-o<s){var l=(t-o)/s;return i(e[a],e[a+1],l)}o+=s}return e[r-1]},t.isClockwise=o,t.closeRingsAndFixWinding=function(e){if("rings"in e){for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];n.length<3||n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]||n.push([n[0][0],n[0][1]])}if(e.rings.length>0&&!o(e.rings[0],e.hasM,e.hasZ))for(var i=0;i<e.rings.length;++i)e.rings[i]=e.rings[i].reverse()}},t.closeRings=function(e){if("rings"in e)for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];n.length<3||n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]||n.push([n[0][0],n[0][1]])}},t.getRingArea=function(e){for(var t=e.length,r=0,n=0;n<t;n++){var i=e[n],o=e[(n+1)%t];r+=i[0]*o[1]-o[0]*i[1]}return r},t.unnormalizeGeometryOnDatelineCrossing=function(e){return"polygon"!==e.type&&"polyline"!==e.type||a("polygon"===e.type?e.rings:e.paths,e.spatialReference),e},t.unnormalizeVerticesOnDatelineCrossing=a,t.computeUnnormalizedVertexPositionsOnDateLineCrossing=function(e,t,r,n){var i=1/0,o=-1/0;e.forEach((function(e){for(var a=e.pos[0];a<t;)a+=n;for(;a>r;)a-=n;i=Math.min(i,a),o=Math.max(o,a),e.unnormalizedPos[0]=a,e.unnormalizedPos[1]=e.pos[1],e.pos.length>2&&(e.unnormalizedPos[2]=e.pos[2]),e.pos.length>3&&(e.unnormalizedPos[3]=e.pos[3])}));var a=o-i;n-a<a&&e.forEach((function(e){e.unnormalizedPos[0]<0&&(e.unnormalizedPos[0]+=n)}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(166),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o,a){var s=new i.default({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"}),l=0;return function(e){function t(t){var r=e.call(this,t)||this;return r.id="sym"+l++,r.type=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"color",{set:function(e){this._set("color",e)},enumerable:!0,configurable:!0}),t.prototype.readColor=function(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.hash=function(){return JSON.stringify(this.toJSON())},t.prototype.clone=function(){},r.__decorate([a.property({type:s.apiValues,json:{read:s.read,write:{ignoreOrigin:!0,writer:s.write}}})],t.prototype,"type",void 0),r.__decorate([a.property({type:n,value:new n([0,0,0,1]),json:{write:{allowNull:!0}}})],t.prototype,"color",null),r.__decorate([a.reader("color")],t.prototype,"readColor",null),r.__decorate([a.subclass("esri.symbols.Symbol")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(118),r(171),r(151),r(1473),r(1474)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=new n.default({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.type="simple-line",n.style="solid",n.cap="round",n.join="round",n.marker=null,n.miterLimit=2,n}var n;return r.__extends(t,e),n=t,t.prototype.normalizeCtorArgs=function(e,t,r,n,i,a){if(e&&"string"!=typeof e)return e;var s={};return null!=e&&(s.style=e),null!=t&&(s.color=t),null!=r&&(s.width=o.toPt(r)),null!=n&&(s.cap=n),null!=i&&(s.join=i),null!=a&&(s.miterLimit=o.toPt(a)),s},t.prototype.clone=function(){var e;return new n({color:i.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:null===(e=this.marker)||void 0===e?void 0:e.clone()})},t.prototype.hash=function(){var t,r;return e.prototype.hash.call(this)+"."+(null===(t=this.color)||void 0===t?void 0:t.hash())+"."+this.style+"."+this.cap+"."+this.join+"."+this.miterLimit+"."+(null===(r=this.marker)||void 0===r?void 0:r.hash())},r.__decorate([a.enumeration({esriSLS:"simple-line"})],t.prototype,"type",void 0),r.__decorate([a.property({type:c.apiValues,json:{read:c.read,write:c.write}})],t.prototype,"style",void 0),r.__decorate([a.property({type:["butt","round","square"],json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}})],t.prototype,"cap",void 0),r.__decorate([a.property({type:["miter","round","bevel"],json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}})],t.prototype,"join",void 0),r.__decorate([a.property({type:l,json:{write:!0,origins:{"web-scene":{write:!1}}}})],t.prototype,"marker",void 0),r.__decorate([a.property({type:Number,json:{read:!1,write:!1}})],t.prototype,"miterLimit",void 0),n=r.__decorate([a.subclass("esri.symbols.SimpleLineSymbol")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(151),r(409),r(873),r(876),r(1475),r(1117)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="fill",r.material=null,r.castShadows=!0,r.outline=null,r.edges=null,r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({edges:n.isSome(this.edges)?this.edges.clone():null,enabled:this.enabled,material:n.isSome(this.material)?this.material.clone():null,castShadows:this.castShadows,outline:n.isSome(this.outline)?this.outline.clone():null})},t.fromSimpleFillSymbol=function(e){return new o({material:{color:(e.color||s.transparentWhite).clone()},outline:e.outline?new c.default({size:e.outline.width||0,color:(e.outline.color||s.white).clone()}):null})},r.__decorate([i.enumeration({Fill:"fill"})],t.prototype,"type",void 0),r.__decorate([i.property({type:l.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([i.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t.prototype,"castShadows",void 0),r.__decorate([i.property({type:c.default,json:{write:!0}})],t.prototype,"outline",void 0),r.__decorate([i.property(a.symbol3dEdgesProperty)],t.prototype,"edges",void 0),o=r.__decorate([i.subclass("esri.symbols.FillSymbol3DLayer")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(254),r(166),r(156),r(172),r(264),r(151),r(273),r(351),r(872),r(430),r(777),r(778),r(779),r(878),r(428),r(409),r(432),r(879),r(1120),r(880)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S){var P={icon:f,object:m,line:v,path:y,fill:h,extrude:d,text:b,water:x},T=n.ofType({base:_,key:"type",typeMap:P}),O=o.strict()({PointSymbol3D:"point-3d",PolygonSymbol3D:"polygon-3d",LineSymbol3D:"line-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"}),C=a.getLogger("esri.symbols.Symbol3D");return function(e){function t(t){var r=e.call(this,t)||this;r.styleOrigin=null,r.thumbnail=null,r.type=null;var i=r.__accessor__&&r.__accessor__.metadatas&&r.__accessor__.metadatas.symbolLayers,o=i&&i.type||n;return r._set("symbolLayers",new o),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return null},set:function(e){C.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolLayers",{set:function(e){i.referenceSetter(e,this._get("symbolLayers"))},enumerable:!0,configurable:!0}),t.prototype.readSymbolLayers=function(e,t,r){for(var n=[],i=0;i<e.length;i++){var o=e[i],a=_.typeJSONDictionary.read(o.type),s=a&&P[a];if(s){var c=new s;c.read(e[i],r),n.push(c)}else C.warn("Unknown symbol layer type: "+a),r&&r.messages&&r.messages.push(new l("symbol-layer:unsupported","Symbol layers of type '"+(a||o.type||"unknown")+"' are not supported",{definition:o,context:r}))}return n},t.prototype.readStyleOrigin=function(e,t,r){if(e.styleUrl&&e.name){var n=p.fromJSON(e.styleUrl,r);return new w({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new w({portal:r&&r.portal||u.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new l("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))},t.prototype.writeStyleOrigin=function(e,t,r,n){if(e.styleUrl&&e.name){var i=p.toJSON(e.styleUrl,n);s.isAbsolute(i)&&(i=s.normalize(i)),t.styleOrigin={styleUrl:i,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!s.hasSamePortal(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new l("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})},t.prototype.normalizeCtorArgs=function(e){return e instanceof _||e&&P[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e},r.__decorate([c.property({json:{read:!1,write:!1}})],t.prototype,"color",null),r.__decorate([c.property({type:T,nonNullable:!0,json:{write:!0}}),c.cast(i.castForReferenceSetter)],t.prototype,"symbolLayers",null),r.__decorate([c.reader("symbolLayers")],t.prototype,"readSymbolLayers",null),r.__decorate([c.property({type:w})],t.prototype,"styleOrigin",void 0),r.__decorate([c.reader("styleOrigin")],t.prototype,"readStyleOrigin",null),r.__decorate([c.writer("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],t.prototype,"writeStyleOrigin",null),r.__decorate([c.property({type:S.default,json:{read:!1}})],t.prototype,"thumbnail",void 0),r.__decorate([c.property({type:O.apiValues,readOnly:!0,json:{type:O.jsonValues,read:!1}})],t.prototype,"type",void 0),r.__decorate([c.subclass("esri.symbols.Symbol3D")],t)}(g)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(152),r(151),r(877),r(409),r(386),r(1477),r(482)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){return function(e){function t(t){var r=e.call(this,t)||this;return r._userSize=void 0,r.halo=null,r.material=null,r.text=void 0,r.type="text",r}var s;return r.__extends(t,e),s=t,Object.defineProperty(t.prototype,"font",{get:function(){return this._get("font")||null},set:function(e){e&&this._userSize&&(e.size=this._userSize),this._set("font",e)},enumerable:!0,configurable:!0}),t.prototype.writeFont=function(e,t,n,i){var o=r.__assign(r.__assign({},i),{textSymbol3D:!0});t.font=e.write({},o),delete t.font.size},Object.defineProperty(t.prototype,"size",{get:function(){return null!=this._userSize?this._userSize:this.font&&null!=this.font.size?this.font.size:9},set:function(e){this._userSize=e,this.font&&(this.font.size=this._userSize),this.notifyChange("size")},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new s({enabled:this.enabled,font:this.font&&n.clone(this.font),halo:this.halo&&n.clone(this.halo),material:i.isSome(this.material)?this.material.clone():null,size:this.size,text:this.text})},t.fromTextSymbol=function(e){var t=function(e,t){return e&&t>0?{color:n.clone(e),size:t}:null}(e.haloColor,e.haloSize),r=e.font?e.font.clone():new a;return new s({size:r.size,font:r,halo:t,material:e.color?{color:e.color.clone()}:null,text:e.text})},r.__decorate([o.property({type:a,json:{write:!0}})],t.prototype,"font",null),r.__decorate([o.writer("font")],t.prototype,"writeFont",null),r.__decorate([o.property({type:c.default,json:{write:!0}})],t.prototype,"halo",void 0),r.__decorate([o.property({type:u.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([o.property(l.screenSizeProperty),o.property({dependsOn:["font.size"]})],t.prototype,"size",null),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),r.__decorate([o.enumeration({Text:"text"})],t.prototype,"type",void 0),s=r.__decorate([o.subclass("esri.symbols.TextSymbol3DLayer")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(166),r(156),r(171),r(151),r(632),r(1134),r(781),r(782),r(247)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){var h=o.getLogger("esri.renderers.visualVariables.SizeVariable"),f=new i.default({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),v=new i.default({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function m(e){if(null!=e)return"string"==typeof e||"number"==typeof e?a.toPt(e):"size"===e.type?p.isSizeVariable(e)?e:(delete(e=r.__assign({},e)).type,new g(e)):void 0}function y(e,t,r){if("object"!=typeof e)return e;var n=new g;return n.read(e,r),n}var g=function(e){function t(t){var r=e.call(this,t)||this;return r.axis=null,r.legendOptions=null,r.normalizationField=null,r.scaleBy=null,r.target=null,r.type="size",r.useSymbolValue=null,r.valueExpression=null,r.valueRepresentation=null,r.valueUnit=null,r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"cache",{get:function(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:d.viewScaleRE.test(this.valueExpression)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{set:function(e){h.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{set:function(e){p.isSizeVariable(this.maxSize)&&(this.maxSize.index="visualVariables["+e+"].maxSize"),p.isSizeVariable(this.minSize)&&(this.minSize.index="visualVariables["+e+"].minSize"),this._set("index",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputValueType",{get:function(){return p.getInputValueType(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDataValue",{set:function(e){e&&this.stops&&(h.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{set:function(e){e&&this.stops&&(h.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)},enumerable:!0,configurable:!0}),t.prototype.castMaxSize=function(e){return m(e)},t.prototype.readMaxSize=function(e,t,r){return y(e,0,r)},Object.defineProperty(t.prototype,"minDataValue",{set:function(e){e&&this.stops&&(h.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minSize",{set:function(e){e&&this.stops&&(h.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)},enumerable:!0,configurable:!0}),t.prototype.castMinSize=function(e){return m(e)},t.prototype.readMinSize=function(e,t,r){return y(e,0,r)},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stops",{set:function(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((function(e){return!!e}))).sort((function(e,t){return e.value-t.value})):e&&(h.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformationType",{get:function(){return p.getTransformationType(this,this.inputValueType)},enumerable:!0,configurable:!0}),t.prototype.readValueExpression=function(e,t){return e||t.expression&&"$view.scale"},t.prototype.writeValueExpressionWebScene=function(e,t,r,i){if("$view.scale"===e){if(i&&i.messages){var o=this.index,a="string"==typeof o?o:"visualVariables["+o+"]";i.messages.push(new n("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:a+".valueExpression",context:i}))}}else t[r]=e},t.prototype.readValueUnit=function(e){return e?v.read(e):null},t.prototype.clone=function(){return new i({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:p.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:p.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((function(e){return e.clone()})),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})},t.prototype.flipSizes=function(){if("clamped-linear"===this.transformationType){var e=this.minSize,t=this.maxSize;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){for(var r=this.stops,n=r.map((function(e){return e.size})).reverse(),i=r.length,o=0;o<i;o++)r[o].size=n[o];return this}return this},t.prototype.getAttributeHash=function(){return e.prototype.getAttributeHash.call(this)+"-"+this.target+"-"+this.normalizationField},t.prototype._interpolateData=function(){return this.stops&&this.stops.map((function(e){return e.value||0}))},r.__decorate([s.property({readOnly:!0,dependsOn:["valueExpression","stops"]})],t.prototype,"cache",null),r.__decorate([s.property({type:f.apiValues,json:{type:f.jsonValues,origins:{"web-map":{read:!1}},read:f.read,write:f.write}})],t.prototype,"axis",void 0),r.__decorate([s.property({type:String,value:null,json:{read:!1}})],t.prototype,"expression",null),r.__decorate([s.property()],t.prototype,"index",null),r.__decorate([s.property({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],t.prototype,"inputValueType",null),r.__decorate([s.property({type:u,json:{write:!0}})],t.prototype,"legendOptions",void 0),r.__decorate([s.property({type:Number,value:null,json:{write:!0}})],t.prototype,"maxDataValue",null),r.__decorate([s.property({type:Number,value:null,json:{write:!0}})],t.prototype,"maxSize",null),r.__decorate([s.cast("maxSize")],t.prototype,"castMaxSize",null),r.__decorate([s.reader("maxSize")],t.prototype,"readMaxSize",null),r.__decorate([s.property({type:Number,value:null,json:{write:!0}})],t.prototype,"minDataValue",null),r.__decorate([s.property({type:Number,value:null,json:{write:!0}})],t.prototype,"minSize",null),r.__decorate([s.cast("minSize")],t.prototype,"castMinSize",null),r.__decorate([s.reader("minSize")],t.prototype,"readMinSize",null),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"normalizationField",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["valueExpression","minSize.arcadeRequired","maxSize.arcadeRequired"]})],t.prototype,"arcadeRequired",null),r.__decorate([s.property({type:String})],t.prototype,"scaleBy",void 0),r.__decorate([s.property({type:[c],value:null,json:{write:!0}})],t.prototype,"stops",null),r.__decorate([s.property({type:["outline"],json:{write:!0}})],t.prototype,"target",void 0),r.__decorate([s.property({type:String,readOnly:!0,dependsOn:["minDataValue","maxDataValue","minSize","maxSize","valueUnit","inputValueType","stops"]})],t.prototype,"transformationType",null),r.__decorate([s.property({type:["size"],json:{type:["sizeInfo"]}})],t.prototype,"type",void 0),r.__decorate([s.property({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],t.prototype,"useSymbolValue",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),r.__decorate([s.reader("valueExpression",["valueExpression","expression"])],t.prototype,"readValueExpression",null),r.__decorate([s.writer("web-scene","valueExpression")],t.prototype,"writeValueExpressionWebScene",null),r.__decorate([s.property({type:["radius","diameter","area","width","distance"],json:{write:!0}})],t.prototype,"valueRepresentation",void 0),r.__decorate([s.property({type:v.apiValues,json:{write:v.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],t.prototype,"valueUnit",void 0),r.__decorate([s.reader("valueUnit")],t.prototype,"readValueUnit",null),i=r.__decorate([s.subclass("esri.renderers.visualVariables.SizeVariable")],t)}(l);return g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(258)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=/^-?(\d+)(\.(\d+))?$/i;function i(e,t){return e-t}function o(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function a(e,t,r,n,i){var o=l(e,t,r,n),a=null==o.previous||o.previous<=i,s=null==o.next||o.next<=i;return a&&s||o.previous+o.next<=2*i}function s(e){var t=String(e),r=t.match(n);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){var i=t.split("e"),o=i[0],a=i[1];if(o&&a){var l=Number(o),c=Number(a),u=c>0;u||(c=Math.abs(c));var p=s(l);return u?(p.integer+=c,c>p.fractional?p.fractional=0:p.fractional-=c):(p.fractional+=c,c>p.integer?p.integer=1:p.integer-=c),p}}return{integer:0,fractional:0}}function l(e,t,r,n){var i,o={previous:null,next:null};if(null!=r){var a=t-r-(i=e-r);o.previous=Math.floor(Math.abs(100*a/i))}null!=n&&(a=n-t-(i=n-e),o.next=Math.floor(Math.abs(100*a/i)));return o}t.numDigits=s,t.percentChange=l,t.round=function(e,t){void 0===t&&(t={});var r=e.slice(0),n=t.tolerance,l=void 0===n?2:n,c=t.strictBounds,u=void 0!==c&&c,p=t.indexes,d=void 0===p?r.map((function(e,t){return t})):p;d.sort(i);for(var h=0;h<d.length;h++){var f=d[h],v=r[f],m=0===f?null:r[f-1],y=f===r.length-1?null:r[f+1],g=s(v).fractional;if(g){for(var _=0,b=!1,x=void 0;_<=g&&!b;){var w=o(v,_);b=a(v,x=u&&0===h?w[1]:w[0],m,y,l),_++}b&&(r[f]=x)}}return r};var c={maximumFractionDigits:20};t.format=function(e){return r.formatNumber(e,c)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(158),r(169),r(152),r(322)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function s(e){return e instanceof r}function l(e){return e instanceof n?Object.keys(e.items):s(e)?o.getProperties(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}t.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:function e(t,r){var n,o=t.diff;if(o&&"function"==typeof o)return o(t,r);var p=l(t),d=l(r);if(0!==p.length||0!==d.length){if(!p.length||!d.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(t,r))return{type:"complete",oldValue:t,newValue:r};var h,f=d.filter((function(e){return-1===p.indexOf(e)})),v=p.filter((function(e){return-1===d.indexOf(e)})),m=p.filter((function(e){return d.indexOf(e)>-1&&c(t,e)!==c(r,e)})).concat(f,v).sort(),y=u(t);if(y&&a.indexOf(y)>-1&&m.length)return{type:"complete",oldValue:t,newValue:r};for(var g=s(t)&&s(r),_=0,b=m;_<b.length;_++){var x=b[_],w=c(t,x),S=c(r,x),P=void 0;(g||"function"!=typeof w&&"function"!=typeof S)&&w!==S&&(null==w&&null==S||(P=o&&o[x]&&"function"==typeof o[x]?o[x](w,S):"object"==typeof w&&"object"==typeof S&&u(w)===u(S)?e(w,S):{type:"complete",oldValue:w,newValue:S},i.isSome(P)&&(i.isSome(h)?h.diff[x]=P:h={type:"partial",diff:(n={},n[x]=P,n)})))}return h}}(e,t)},t.isEmpty=function e(t){if(i.isNone(t))return!0;switch(t.type){case"complete":return!1;case"collection":for(var r=t,n=0,o=r.added;n<o.length;n++)if(!e(o[n]))return!1;for(var a=0,s=r.removed;a<s.length;a++)if(!e(s[a]))return!1;for(var l=0,c=r.changed;l<c.length;l++)if(!e(c[l]))return!1;return!0;case"partial":for(var u in t.diff)if(!e(t.diff[u]))return!1;return!0}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(166),r(155),r(200),r(264),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=i.strict()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),u=c.jsonValues.slice();n.removeUnordered(u,"orthometric");var p=i.strict()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});function d(e,t){return new s("height-unit:unsupported","Height unit of value '"+e+"' is not supported",t)}return function(e){function t(t){var r=e.call(this,t)||this;return r.heightModel="gravity-related-height",r.heightUnit="meters",r.vertCRS=null,r}var n;return r.__extends(t,e),n=t,t.prototype.writeHeightModel=function(e,t,r){return c.write(e,t,r)},t.prototype.readHeightModel=function(e,t,r){return c.read(e)||(r&&r.messages&&r.messages.push(function(e,t){return new s("height-model:unsupported","Height model of value '"+e+"' is not supported",t)}(e,{context:r})),null)},t.prototype.readHeightUnit=function(e,t,r){return p.read(e)||(r&&r.messages&&r.messages.push(d(e,{context:r})),null)},t.prototype.readHeightUnitService=function(e,t,r){return a.unitFromRESTJSON(e)||p.read(e)||(r&&r.messages&&r.messages.push(d(e,{context:r})),null)},t.prototype.readVertCRS=function(e,t){return t.vertCRS||t.ellipsoid||t.geoid},t.prototype.clone=function(){return new n({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})},t.prototype.equals=function(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)},t.deriveUnitFromSR=function(e,t){var r=a.getVerticalUnitStringForSR(t);return new n({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})},t.prototype.write=function(t,n){return n=r.__assign({origin:"web-scene"},n),e.prototype.write.call(this,t,n)},t.fromJSON=function(e){if(!e)return null;var t=new n;return t.read(e,{origin:"web-scene"}),t},r.__decorate([l.property({type:c.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:u,default:"ellipsoidal"}}}})],t.prototype,"heightModel",void 0),r.__decorate([l.writer("web-scene","heightModel")],t.prototype,"writeHeightModel",null),r.__decorate([l.reader(["web-scene","service"],"heightModel")],t.prototype,"readHeightModel",null),r.__decorate([l.property({type:p.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:p.jsonValues,write:p.write}}}})],t.prototype,"heightUnit",void 0),r.__decorate([l.reader("web-scene","heightUnit")],t.prototype,"readHeightUnit",null),r.__decorate([l.reader("service","heightUnit")],t.prototype,"readHeightUnitService",null),r.__decorate([l.property({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],t.prototype,"vertCRS",void 0),r.__decorate([l.reader("service","vertCRS",["vertCRS","ellipsoid","geoid"])],t.prototype,"readVertCRS",null),n=r.__decorate([l.subclass("esri.geometry.HeightModelInfo")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(166),r(155),r(118),r(151),r(1514),r(899),r(788),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=new i.default({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function h(e){return!e||"service"!==e.origin&&!(e.layer&&"map-image"===e.layer.type)}return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.deconflictionStrategy="static",r.labelExpression=null,r.labelExpressionInfo=null,r.labelPlacement=null,r.maxScale=0,r.minScale=0,r.symbol=u.defaultTextSymbol2D,r.useCodedValues=void 0,r.where=null,r}var i;return r.__extends(t,e),i=t,t.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var i=r(t[n[0]],n[1],n[2]),o=n[3],a=r(t[n[4]],n[5],n[6]);switch(o){case"AND":return i&&a;case"OR":return i||a}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},t.prototype.writeDeconflictionStrategy=function(e,t,r,n){"static"!==e&&(t[r]=e)},t.prototype.readLabelExpression=function(e,t){var r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e},t.prototype.writeLabelExpression=function(e,t,r,n){if(this.labelExpressionInfo&&(h(n)||n&&"service"===n.origin))if(null!=this.labelExpressionInfo.value)e=this.labelExpressionInfo.value.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]");else if(null!=this.labelExpressionInfo.expression){var i=c.getSingleFieldArcadeExpression(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}null!=e&&(t[r]=e)},t.prototype.writeLabelExpressionInfo=function(e,t,r,n){if(null==e&&null!=this.labelExpression&&h(n))e=new l({expression:this.getLabelExpressionArcade()});else if(!e)return;var i=e.toJSON(n);i.expression&&(t[r]=i)},t.prototype.writeMaxScale=function(e,t){(e||this.minScale)&&(t.maxScale=e)},t.prototype.writeMinScale=function(e,t){(e||this.maxScale)&&(t.minScale=e)},t.prototype.getLabelExpression=function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=this.labelExpression.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}"),e.type="conventional"),e},t.prototype.getLabelExpressionArcade=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return c.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},t.prototype.getLabelExpressionSingleField=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return c.getSingleFieldTemplatedString(e.expression);case"arcade":return c.getSingleFieldArcadeExpression(e.expression)}return null},t.prototype.clone=function(){return new i({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:a.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:a.clone(this.symbol),where:this.where,useCodedValues:this.useCodedValues})},r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([s.property({type:String})],t.prototype,"deconflictionStrategy",void 0),r.__decorate([s.writer("deconflictionStrategy")],t.prototype,"writeDeconflictionStrategy",null),r.__decorate([s.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"labelExpression",void 0),r.__decorate([s.reader("labelExpression")],t.prototype,"readLabelExpression",null),r.__decorate([s.writer("labelExpression")],t.prototype,"writeLabelExpression",null),r.__decorate([s.property({type:l,json:{write:{overridePolicy:function(e,t,r){return h(r)?{allowNull:!0}:{enabled:!1}}}}})],t.prototype,"labelExpressionInfo",void 0),r.__decorate([s.writer("labelExpressionInfo")],t.prototype,"writeLabelExpressionInfo",null),r.__decorate([s.property({type:d.apiValues,json:{type:d.jsonValues,read:d.read,write:d.write}})],t.prototype,"labelPlacement",void 0),r.__decorate([s.property({type:Number})],t.prototype,"maxScale",void 0),r.__decorate([s.writer("maxScale")],t.prototype,"writeMaxScale",null),r.__decorate([s.property({type:Number})],t.prototype,"minScale",void 0),r.__decorate([s.writer("minScale")],t.prototype,"writeMinScale",null),r.__decorate([s.property({types:n.symbolTypesLabel,json:{origins:{"web-scene":{types:n.symbolTypesLabel3D,read:p.read,write:p.writeTarget,default:null}},read:p.read,write:p.writeTarget,default:null}})],t.prototype,"symbol",void 0),r.__decorate([s.property({type:Boolean,json:{write:!0}})],t.prototype,"useCodedValues",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"where",void 0),i=r.__decorate([s.subclass("esri.layers.support.LabelClass")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(297),r(481),r(165),r(239),r(169),r(154),r(236),r(292),r(118),r(323),r(156),r(225),r(153),r(172),r(151),r(179),r(475),r(322),r(901),r(194),r(255),r(191),r(437),r(790),r(316),r(411),r(199),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I){function R(e){return e&&"esriSMS"===e.type}function D(e,t,r){return{ignoreOrigin:!0,enabled:r&&r.writeSublayerStructure||!1}}function L(e,t,r){return{ignoreOrigin:!0,enabled:!!r&&(r.writeSublayerStructure||this.originIdOf(t)>=x.nameToId(r.origin))}}var j=v.getLogger("esri.layers.support.Sublayer"),V=0,F=new Set;return F.add("layer"),F.add("parent"),F.add("loaded"),F.add("loadStatus"),F.add("loadError"),F.add("loadWarnings"),function(e){function t(t){var r=e.call(this,t)||this;return r.capabilities=void 0,r.fields=null,r.fullExtent=null,r.globalIdField=null,r.legendEnabled=!0,r.objectIdField=null,r.popupEnabled=!0,r.popupTemplate=null,r.sourceJSON=null,r.title=null,r.typeIdField=null,r.types=null,r}var p;return n.__extends(t,e),p=t,t.prototype.load=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){return this.addResolvingPromise(n.__awaiter(t,void 0,void 0,(function(){var t,r,i;return n.__generator(this,(function(o){switch(o.label){case 0:if(!this.layer&&!this.url)throw new u("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});return t=null,!this.layer||this.originIdOf("url")>2||M.isDataLayerSource(this.source)?[4,s(this.url,n.__assign({responseType:"json",query:{f:"json"}},e))]:[3,2];case 1:return r=o.sent(),t=r.data,[3,4];case 2:return i=this.id,this.source&&null!=this.source.mapLayerId&&(i=this.source.mapLayerId),[4,this.layer.fetchSublayerInfo(i,e)];case 3:t=o.sent(),o.label=4;case 4:return t&&(this.sourceJSON=t,this.read({layerDefinition:t},{origin:"service"})),[2]}}))}))),[2,this]}))}))},t.prototype.readCapabilities=function(e,t){var r=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map((function(e){return e.trim()})):[];return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:-1!==r.indexOf("query")}}},Object.defineProperty(t.prototype,"definitionExpression",{set:function(e){this._setAndNotifyLayer("definitionExpression",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new T(this.fields||[])},enumerable:!0,configurable:!0}),t.prototype.readGlobalIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(var r=0,n=t.fields;r<n.length;r++){var i=n[r];if("esriFieldTypeGlobalID"===i.type)return i.name}},Object.defineProperty(t.prototype,"id",{get:function(){var e=this._get("id");return null==e?V++:e},set:function(e){this._get("id")!==e&&(!1!==this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{set:function(e){this._setAndNotifyLayer("labelingInfo",e)},enumerable:!0,configurable:!0}),t.prototype.writeLabelingInfo=function(e,t,r,n){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map((function(e){return e.write({},n)}))}})},Object.defineProperty(t.prototype,"labelsVisible",{set:function(e){this._setAndNotifyLayer("labelsVisible",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layer",{set:function(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach((function(t){return t.layer=e}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listMode",{set:function(e){this._set("listMode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minScale",{set:function(e){this._setAndNotifyLayer("minScale",e)},enumerable:!0,configurable:!0}),t.prototype.readMinScale=function(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0},Object.defineProperty(t.prototype,"maxScale",{set:function(e){this._setAndNotifyLayer("maxScale",e)},enumerable:!0,configurable:!0}),t.prototype.readMaxScale=function(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0},t.prototype.readObjectIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(var r=0,n=t.fields;r<n.length;r++){var i=n[r];if("esriFieldTypeOID"===i.type)return i.name}},Object.defineProperty(t.prototype,"opacity",{set:function(e){this._setAndNotifyLayer("opacity",e)},enumerable:!0,configurable:!0}),t.prototype.readOpacity=function(e,t){var r=t.layerDefinition;return 1-.01*(null!=r.transparency?r.transparency:r.drawingInfo.transparency)},t.prototype.writeOpacity=function(e,t,r,n){t.layerDefinition={drawingInfo:{transparency:100-100*e}}},t.prototype.writeParent=function(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=this.parent.id:t.parentLayerId=-1},Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){if(e)for(var t=0,r=e.getSymbols();t<r.length;t++){var n=r[t];if(l.isSymbol3D(n)){j.warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){return(e=t.layerDefinition.drawingInfo.renderer||void 0)&&((e=A.read(e,t,r)||void 0)||j.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r})),e},t.prototype.writeRenderer=function(e,t,r,n){t.layerDefinition={drawingInfo:{renderer:e.write({},n)}}},t.prototype.writeWebSceneRenderer=function(e,t,r,n){t.layerDefinition={drawingInfo:{renderer:e.write({},n)}}},Object.defineProperty(t.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,type:M.MAPLAYER}},set:function(e){this._setAndNotifyLayer("source",e)},enumerable:!0,configurable:!0}),t.prototype.writeSource=function(e,t){t.layerDefinition={source:M.sourceToJSON(e)}},Object.defineProperty(t.prototype,"sublayers",{set:function(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)},enumerable:!0,configurable:!0}),t.prototype.castSublayers=function(e){return b.default(c.ofType(p),e)},t.prototype.writeSublayers=function(e,t,r){this.get("sublayers.length")&&(t[r]=this.sublayers.map((function(e){return e.id})).toArray().reverse())},t.prototype.readTypeIdField=function(e,t){var r=(t=t.layerDefinition||t).typeIdField;if(r){var n=O.getField(t.fields,r);if(n)return n.name}return null},Object.defineProperty(t.prototype,"url",{get:function(){var e,t,r=null!==(t=null===(e=this.layer)||void 0===e?void 0:e.parsedUrl)&&void 0!==t?t:this._lastParsedUrl,n=this.source;if(!r)return null;if(this._lastParsedUrl=r,M.isMapLayerSource(n))return r.path+"/"+n.mapLayerId;var i={layer:JSON.stringify({source:M.sourceToJSON(this.source)})};return r.path+"/dynamicLayer?"+g.objectToQuery(i)},set:function(e){e?this._override("url",e):this._clearOverride("url")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){this._setAndNotifyLayer("visible",e)},enumerable:!0,configurable:!0}),t.prototype.writeVisible=function(e,t,r,n){t[r]=this.getAtOrigin("defaultVisibility","service")||e},t.prototype.clone=function(){var e=w.getProperties(this).store,t=new p;return w.getProperties(t).store=e.clone(F),this.url,t._lastParsedUrl=this._lastParsedUrl,t},t.prototype.createPopupTemplate=function(e){return E.createPopupTemplate(this,e)},t.prototype.createQuery=function(){return new I({returnGeometry:!0,where:this.definitionExpression||"1=1"})},t.prototype.createFeatureLayer=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,a;return n.__generator(this,(function(n){switch(n.label){case 0:return this.hasOwnProperty("sublayers")?[2,null]:(e=this.layer&&this.layer.parsedUrl,t=this.source,i=null,e&&(i=M.isMapLayerSource(t)?e.path+"/"+t.mapLayerId:e.path+"/dynamicLayer"),[4,new Promise((function(e,t){Promise.all([r.e(1),r.e(32)]).then(function(){var t=[r(222)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]);case 1:return o=n.sent(),a=new o({url:i}),null!=this.layer.refreshInterval&&(a.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(a.definitionExpression=this.definitionExpression),this.originIdOf("labelingInfo")>2&&(a.labelingInfo=h.clone(this.labelingInfo)),this.originIdOf("labelsVisible")>0&&(a.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>0&&(a.legendEnabled=this.legendEnabled),this.originIdOf("visible")>0&&(a.visible=this.visible),this.originIdOf("minScale")>0&&(a.minScale=this.minScale),this.originIdOf("maxScale")>0&&(a.maxScale=this.maxScale),this.originIdOf("opacity")>0&&(a.opacity=this.opacity),this.originIdOf("popupTemplate")>0&&(a.popupTemplate=h.clone(this.popupTemplate)),this.originIdOf("renderer")>2&&(a.renderer=h.clone(this.renderer)),M.isDataLayerSource(this.source)&&(a.dynamicDataSource=h.clone(this.source)),this.originIdOf("title")>0&&(a.title=this.title),[2,a]}}))}))},t.prototype.getFeatureType=function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var n=e.attributes?e.attributes[t]:void 0;if(null==n)return null;var i=null;return r.some((function(e){var t=e.id;return null!=t&&(t.toString()===n.toString()&&(i=e),!!i)})),i},t.prototype.getFieldDomain=function(e,t){var r=t&&t.feature,n=this.getFeatureType(r);if(n){var i=n.domains&&n.domains[e];if(i&&"inherited"!==i.type)return i}return this._getLayerDomain(e)},t.prototype.queryFeatures=function(e,t){var n=this;return void 0===e&&(e=this.createQuery()),this.load().then((function(){if(!n.get("capabilities.operations.supportsQuery"))throw new u("Sublayer.queryFeatures","this layer doesn't support queries.");return y.all([new Promise((function(e,t){r.e(62).then(function(){var t=[r(348)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){r.e(188).then(function(){var t=[r(187)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))])})).then((function(r){var i=r[0].executeQuery,o=r[1];return i(n.url,I.from(e),n.layer?n.layer.spatialReference:null,t).then((function(e){return o.fromJSON(e.data)}))})).then((function(e){return e&&e.features&&e.features.forEach((function(e){e.sourceLayer=n})),e}))},t.prototype.toExportImageJSON=function(){var e=this,t={id:this.id,source:M.sourceToJSON(this.source)};this.definitionExpression&&(t.definitionExpression=this.definitionExpression);var r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((function(t,r){return t[r]=e.originIdOf(r),t}),{});if(Object.keys(r).some((function(e){return r[e]>=2}))){var n=t.drawingInfo={};r.renderer>=2&&(n.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>=2&&(n.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>=2&&(n.labelingInfo=this.labelingInfo?this.labelingInfo.map((function(e){return e.write({},{origin:"service"})})):null,n.showLabels=!0),r.opacity>=2&&(n.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(n.renderer)}return t},t.prototype._assignDefaultSymbolColors=function(e){this._forEachSimpleMarkerSymbols(e,(function(e){e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.outline&&e.outline.color?e.color=e.outline.color:e.color=[0,0,0,0])}))},t.prototype._forEachSimpleMarkerSymbols=function(e,t){if(e){for(var r=0,n=("uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[]);r<n.length;r++){var i=n[r];R(i.symbol)&&t(i.symbol)}"symbol"in e&&R(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&R(e.defaultSymbol)&&t(e.defaultSymbol)}},t.prototype._setAndNotifyLayer=function(e,t){var r,n,i=this.layer,o=this._get(e);switch(e){case"definitionExpression":r="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":r="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":r="supportsDynamicLayers",n="supportsModification"}var a=w.getProperties(this).getDefaultOrigin();if("service"!==a){if(r&&!1===this.get("layer.capabilities.exportMap."+r))return void this._logLockedError(e,"capability not available 'layer.capabilities.exportMap."+r+"'");if(n&&!1===this.get("capabilities.exportMap."+n))return void this._logLockedError(e,"capability not available 'capabilities.exportMap."+n+"'")}"source"!==e||"not-loaded"===this.loadStatus?(this._set(e,t),"service"!==a&&o!==t&&i&&i.emit&&i.emit("sublayer-update",{propertyName:e})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")},t.prototype._handleSublayersChange=function(e,t){var r=this;t&&(t.forEach((function(e){e.parent=null,e.layer=null})),this.handles.removeAll()),e&&(e.forEach((function(e){e.parent=r,e.layer=r.layer})),this.handles.add([e.on("after-add",(function(e){var t=e.item;t.parent=r,t.layer=r.layer})),e.on("after-remove",(function(e){var t=e.item;t.parent=null,t.layer=null})),e.on("before-changes",(function(e){var t=r.get("layer.capabilities.exportMap.supportsSublayersChanges");null==t||t||(j.error(new u("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:r,layer:r.layer})),e.preventDefault())}))]))},t.prototype._logLockedError=function(e,t){j.error(new u("sublayer:locked","Property '"+e+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:t,sublayer:this,layer:this.layer}))},t.prototype._getLayerDomain=function(e){var t=this.fieldsIndex.get(e);return t?t.domain:null},n.__decorate([_.property({readOnly:!0})],t.prototype,"capabilities",void 0),n.__decorate([_.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],t.prototype,"readCapabilities",null),n.__decorate([_.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:L}}})],t.prototype,"definitionExpression",null),n.__decorate([_.property({type:[P],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],t.prototype,"fields",void 0),n.__decorate([_.property({readOnly:!0,dependsOn:["fields"]})],t.prototype,"fieldsIndex",null),n.__decorate([_.property({type:i.Extent,json:{read:{source:"layerDefinition.extent"}}})],t.prototype,"fullExtent",void 0),n.__decorate([_.property({type:String})],t.prototype,"globalIdField",void 0),n.__decorate([_.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],t.prototype,"readGlobalIdFieldFromService",null),n.__decorate([_.property({type:Number,json:{write:{ignoreOrigin:!0}}})],t.prototype,"id",null),n.__decorate([_.property({value:null,type:[C],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:D}}})],t.prototype,"labelingInfo",null),n.__decorate([_.writer("labelingInfo")],t.prototype,"writeLabelingInfo",null),n.__decorate([_.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:D}}})],t.prototype,"labelsVisible",null),n.__decorate([_.property({value:null})],t.prototype,"layer",null),n.__decorate([_.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:L}}})],t.prototype,"legendEnabled",void 0),n.__decorate([_.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],t.prototype,"listMode",null),n.__decorate([_.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:D}}})],t.prototype,"minScale",null),n.__decorate([_.reader("minScale",["minScale","layerDefinition.minScale"])],t.prototype,"readMinScale",null),n.__decorate([_.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:D}}})],t.prototype,"maxScale",null),n.__decorate([_.reader("maxScale",["maxScale","layerDefinition.maxScale"])],t.prototype,"readMaxScale",null),n.__decorate([_.property({type:String})],t.prototype,"objectIdField",void 0),n.__decorate([_.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],t.prototype,"readObjectIdFieldFromService",null),n.__decorate([_.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:D}}})],t.prototype,"opacity",null),n.__decorate([_.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],t.prototype,"readOpacity",null),n.__decorate([_.writer("opacity")],t.prototype,"writeOpacity",null),n.__decorate([_.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0,overridePolicy:D}}})],t.prototype,"parent",void 0),n.__decorate([_.writer("parent")],t.prototype,"writeParent",null),n.__decorate([_.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:L,writer:function(e,t,r){t[r]=!e}}}})],t.prototype,"popupEnabled",void 0),n.__decorate([_.property({type:o,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:L}}})],t.prototype,"popupTemplate",void 0),n.__decorate([_.property({readOnly:!0,dependsOn:["fields","title"]})],t.prototype,"defaultPopupTemplate",null),n.__decorate([_.property({types:a.rendererTypes,value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:D}}})],t.prototype,"renderer",null),n.__decorate([_.reader("renderer",["layerDefinition.drawingInfo.renderer"])],t.prototype,"readRenderer",null),n.__decorate([_.writer("renderer")],t.prototype,"writeRenderer",null),n.__decorate([_.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:a.webSceneRendererTypes}})],t.prototype,"writeWebSceneRenderer",null),n.__decorate([_.property({cast:M.castSource,json:{read:{source:"layerDefinition.source",reader:M.sourceFromJSON},write:{target:"layerDefinition.source",overridePolicy:D}}})],t.prototype,"source",null),n.__decorate([_.writer("source")],t.prototype,"writeSource",null),n.__decorate([_.property()],t.prototype,"sourceJSON",void 0),n.__decorate([_.property({value:null,json:{type:[b.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:D}}})],t.prototype,"sublayers",null),n.__decorate([_.cast("sublayers")],t.prototype,"castSublayers",null),n.__decorate([_.writer("sublayers")],t.prototype,"writeSublayers",null),n.__decorate([_.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:L}}})],t.prototype,"title",void 0),n.__decorate([_.property({type:String})],t.prototype,"typeIdField",void 0),n.__decorate([_.reader("typeIdField",["layerDefinition.typeIdField"])],t.prototype,"readTypeIdField",null),n.__decorate([_.property({type:[S],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],t.prototype,"types",void 0),n.__decorate([_.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],t.prototype,"url",null),n.__decorate([_.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:D}}})],t.prototype,"visible",null),n.__decorate([_.writer("visible")],t.prototype,"writeVisible",null),p=n.__decorate([_.subclass("esri.layers.support.Sublayer")],t)}(p.HandleOwnerMixin(m.MultiOriginJSONMixin(d.IdentifiableMixin(f))))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(790)],void 0===(i=function(e,t,r){function n(e,t){if(!e||!e.length)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;for(var n=0,i=r.length,o=0,a=e;o<a.length;o++){for(var s=a[o].id;n<i&&r[n]!==s;)n++;if(n>=i)return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldWriteSublayerStructure=function(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!n(e,t)},t.isExportDynamic=function(e,t,i){return!!e.some((function(e){var t=e.source;return!(!t||t.type===r.MAPLAYER&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===i.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!n(e,t)},t.isSublayerOverhaul=function(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(369),r(169),r(152),r(153),r(200),r(478),r(912),r(441),r(913),r(205),r(216),r(184),r(215),r(202),r(170),r(178),r(197),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){Object.defineProperty(t,"__esModule",{value:!0});var x,w,S,P,T,O,C,M,A,E,I,R=l.wgs84Radius,D=180/Math.PI;function L(e,t,r,n){return n&&r&&!n.equals(r)&&_.canProject(n,r)&&n.isWebMercator?n.isWebMercator?function(e,t){var r=t[1];return r>89.99999?r=89.99999:r<-89.99999&&(r=-89.99999),r=Math.sin(c.common.toRadian(r)),d.vec2.set(e,c.common.toRadian(t[0])*R,.5*R*Math.log((1+r)/(1-r)))}(e,t):function(e,t,r){var n=c.common.toDegree(t[0]/R);return d.vec2.set(e,n-360*Math.floor((n+180)/360),c.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/R))))}(e,t):d.vec2.copy(e,t)}function j(e){return e.wkid?e:e.spatialReference||y.WGS84}function V(e,t){return t.type?d.vec2.set(e,t.x,t.y):d.vec2.copy(e,t)}function F(e){return s.getMetersPerUnitForSR(e)}function N(e,t){return Math.max(e.width/t[0],e.height/t[1])*W(e.spatialReference)}function k(e,t,n,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,p,d,h,y,g,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V,F,N;return r.__generator(this,(function(r){switch(r.label){case 0:if(!e)return[2,null];if(Array.isArray(e)&&!e.length)return[2,null];if(i.isCollection(e)&&(e=e.toArray()),!Array.isArray(e)||!e.length||"object"!=typeof e[0])return[3,7];if(c=e.every((function(e){return"attributes"in e})),u=e.some((function(e){return!e.geometry})),p=e,!(c&&u&&t&&t.allLayerViews))return[3,2];for(d=new Map,h=0,y=e;h<y.length;h++)E=y[h],g=E.layer,b=d.get(g)||[],null!=(x=E.attributes[g.objectIdField])&&b.push(x),d.set(g,b);return w=[],d.forEach((function(e,r){var n=t.allLayerViews.find((function(e){return e.layer.id===r.id}));if("queryFeatures"in n){var i=r.createQuery();i.objectIds=e,i.returnGeometry=!0,w.push(n.queryFeatures(i))}})),[4,a.all(w)];case 1:for(S=r.sent(),P=[],T=0,O=S;T<O.length;T++)if((C=O[T])&&C.features&&C.features.length)for(M=0,A=C.features;M<A.length;M++)E=A[M],o.isSome(E.geometry)&&P.push(E.geometry);p=P,r.label=2;case 2:I=0,R=p,r.label=3;case 3:return I<R.length?[4,k(R[I],t,n,s)]:[3,6];case 4:s=r.sent(),r.label=5;case 5:return I++,[3,3];case 6:return[2,s];case 7:return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]?(l=new m(e),[3,12]):[3,8];case 8:return e instanceof v?(l=e,[3,12]):[3,9];case 9:return"geometry"in e?e.geometry?(l=e.geometry,[3,12]):[3,10]:[3,12];case 10:return e.layer?(D=e.layer,"queryFeatures"in(L=t.allLayerViews.find((function(e){return e.layer.id===D.id})))?((j=D.createQuery()).objectIds=[e.attributes[D.objectIdField]],j.returnGeometry=!0,[4,L.queryFeatures(j)]):[3,12]):[3,12];case 11:V=r.sent(),l=o.get(V,"features",0,"geometry"),r.label=12;case 12:if(o.isNone(l))return[2,null];if(!(F="point"===l.type?new f({xmin:l.x,ymin:l.y,xmax:l.x,ymax:l.y,spatialReference:l.spatialReference}):l.extent))return[2,null];if(N=_.canProject(F,n),!F.spatialReference.equals(n)&&N)F=_.project(F,n);else if(!N)return[2,null];return[2,s=s?s.union(F):F.clone()]}}))}))}function z(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,c,u,p,d,v,y,g,x,w,S,P,T,O,C,M;return r.__generator(this,(function(r){switch(r.label){case 0:return e&&t?(i=t.spatialReference,o=t.constraints,a=t.padding,s=t.viewpoint,l=t.size,c=a?l[0]-a.left-a.right:l[0],u=a?l[1]-a.top-a.bottom:l[1],p=[c,u],d=null,e instanceof n?d=e:e.viewpoint?d=e.viewpoint:e.target&&"esri.Viewpoint"===e.target.declaredClass&&(d=e.target),v=null,d&&d.targetGeometry?(v=d.targetGeometry,[3,10]):[3,1]):[2,new n({targetGeometry:new m,scale:0,rotation:0})];case 1:return e instanceof f?(v=e,[3,10]):[3,2];case 2:return e||e&&("center"in e||"extent"in e||"target"in e)?[4,k(e.center,t,i)]:[3,10];case 3:return(x=r.sent())?[3,5]:[4,k(e.extent,t,i)];case 4:x=r.sent(),r.label=5;case 5:return(g=x)?[3,7]:[4,k(e.target,t,i)];case 6:g=r.sent(),r.label=7;case 7:return(y=g)?[3,9]:[4,k(e,t,i)];case 8:y=r.sent(),r.label=9;case 9:v=y,r.label=10;case 10:return!v&&s&&s.targetGeometry?v=s.targetGeometry:!v&&t.extent&&(v=t.extent),w=j(v),i||(i=j(t.spatialReference||t.extent||v)),b.canProject(v,i)||!w||w.equals(i)?(S=V(h.vec2f64.create(),v.center?v.center:v),P=new m(L(S,S,w,i),i),T=null,T=d&&d.targetGeometry&&"point"===d.targetGeometry.type?d.scale:e.hasOwnProperty("scale")&&e.scale?e.scale:e.hasOwnProperty("zoom")&&-1!==e.zoom&&o&&o.effectiveLODs?o.zoomToScale(e.zoom):Array.isArray(v)||"point"===v.type||"extent"===v.type&&0===v.width&&0===v.height?t.extent&&_.canProject(t.extent,i)?N(_.project(t.extent,i),p):t.extent?N(t.extent,p):s.scale:_.canProject(v.extent,i)?N(_.project(v.extent,i),p):N(v.extent,p),(O=function(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale)return{min:(o=e.layer).minScale,max:o.maxScale};if(Array.isArray(e)&&e.length&&e.every((function(e){return"layer"in e}))){for(var t=0,r=0,n=0,i=e;n<i.length;n++){var o;(o=i[n].layer)&&o.minScale&&o.maxScale&&(t=o.minScale<t?o.minScale:t,r=o.maxScale>r?o.maxScale:r)}return t&&r?{min:t,max:r}:null}}}(e))&&(O.min&&O.min>T?T=O.min:O.max&&O.max<T&&(T=O.max)),C=0,d?C=d.rotation:e.hasOwnProperty("rotation")?C=e.rotation:s&&(C=s.rotation),M=new n({targetGeometry:P,scale:T,rotation:C}),o&&(M=o.fit(M),o.rotationEnabled||(M.rotation=C)),[2,M]):[2,null]}}))}))}function U(e,t){var r=e.targetGeometry,n=t.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function B(e,t,r){return r?d.vec2.set(e,.5*(t[0]-r.right+r.left),.5*(t[1]-r.bottom+r.top)):d.vec2.scale(e,t,.5)}function G(e,t,r){var n=q(t),i=Math.abs(Math.cos(n)),o=Math.abs(Math.sin(n));return d.vec2.set(e,Math.round(r[1]*o+r[0]*i),Math.round(r[1]*i+r[0]*o))}function H(e){return e.scale*(t=e.targetGeometry.spatialReference,g.isValid(t)?1/(39.37*F(t)*96):1);var t}function q(e){return c.common.toRadian(e.rotation)||0}function W(e){return g.isValid(e)?39.37*F(e)*96:1}function J(e){if(e.isWrappable){var t=g.getInfo(e);return t.valid[1]-t.valid[0]}return 0}t.extentToScale=N,t.create=z,t.copy=U,t.getAnchor=B,t.getExtent=(x=h.vec2f64.create(),function(e,t,r){var n=t.targetGeometry;V(x,n);var i=.5*H(t);return e.xmin=x[0]-i*r[0],e.ymin=x[1]-i*r[1],e.xmax=x[0]+i*r[0],e.ymax=x[1]+i*r[1],e.spatialReference=n.spatialReference,e}),t.setExtent=function(e,r,n,i,o){return t.centerAt(e,r,n.center),e.scale=N(n,i),o&&o.constraints&&o.constraints.constrain(e),e},t.getOuterExtent=(w=h.vec2f64.create(),S=h.vec2f64.create(),function(e,t,r){V(w,t.targetGeometry),G(S,t,r);var n=.5*H(t),i=w[0]-n*S[0],o=w[1]-n*S[1],a=w[0]+n*S[0],s=w[1]+n*S[1],l=t.targetGeometry.spatialReference;return e.set({xmin:i,ymin:o,xmax:a,ymax:s,spatialReference:l}),e}),t.getOuterSize=G,t.getPaddingScreenTranslation=(P=h.vec2f64.create(),function(e,t,r){return d.vec2.sub(e,function(e,t){return d.vec2.scale(e,t,.5)}(e,t),B(P,t,r))}),t.getPaddingMapTranslation=function(){var e=p.mat2df64.create(),r=h.vec2f64.create();return function(n,i,o,a){var s=H(i),l=q(i);return d.vec2.set(r,s,s),u.mat2d.fromScaling(e,r),u.mat2d.rotate(e,e,l),u.mat2d.translate(e,e,t.getPaddingScreenTranslation(r,o,a)),u.mat2d.translate(e,e,[0,a.top-a.bottom]),d.vec2.set(n,e[4],e[5])}}(),t.getResolution=H,t.getResolutionToScaleFactor=W,t.getMatrix=function(){var e=h.vec2f64.create(),t=h.vec2f64.create(),r=h.vec2f64.create();return function(n,i,o,a,s,l){return d.vec2.negate(e,i),d.vec2.scale(t,o,.5*l),d.vec2.set(r,1/a*l,-1/a*l),u.mat2d.identity(n),u.mat2d.translate(n,n,t),s&&u.mat2d.rotate(n,n,s),u.mat2d.scale(n,n,r),u.mat2d.translate(n,n,e),n}}(),t.getTransform=function(){var e=h.vec2f64.create();return function(r,n,i,o){var a=H(n),s=q(n);return V(e,n.targetGeometry),t.getMatrix(r,e,i,a,s,o)}}(),t.getTransformNoRotation=function(){var e=h.vec2f64.create();return function(r,n,i,o){var a=H(n);return V(e,n.targetGeometry),t.getMatrix(r,e,i,a,0,o)}}(),t.getWorldWidth=J,t.getWorldScreenWidth=function(e,t){return Math.round(J(e)/t)},t.createAsync=function(e,t){return z(e,t)},t.angleBetween=(T=h.vec2f64.create(),O=h.vec2f64.create(),C=[0,0,0],function(e,t,r){d.vec2.subtract(T,e,t),d.vec2.normalize(T,T),d.vec2.subtract(O,e,r),d.vec2.normalize(O,O),d.vec2.cross(C,T,O);var n=Math.acos(d.vec2.dot(T,O)/(d.vec2.length(T)*d.vec2.length(O)))*D;return C[2]<0&&(n=-n),isNaN(n)&&(n=0),n}),t.addPadding=function(){var e=h.vec2f64.create();return function(r,n,i,o){var a=r.targetGeometry;return U(r,n),t.getPaddingMapTranslation(e,n,i,o),a.x+=e[0],a.y+=e[1],r}}(),t.removePadding=function(){var e=h.vec2f64.create();return function(r,n,i,o){var a=r.targetGeometry;return U(r,n),t.getPaddingMapTranslation(e,n,i,o),a.x-=e[0],a.y-=e[1],r}}(),t.centerAt=function(){var e=h.vec2f64.create();return function(t,r,n){U(t,r);var i=t.targetGeometry,o=j(n),a=j(i);return V(e,n),L(e,e,o,a),i.x=e[0],i.y=e[1],t}}(),t.pixelSize=function(e){return H(e)},t.resize=(M=h.vec2f64.create(),function(e,r,n,i,o){o||(o="center"),d.vec2.sub(M,n,i),d.vec2.scale(M,M,.5);var a=M[0],s=M[1];switch(o){case"center":d.vec2.set(M,0,0);break;case"left":d.vec2.set(M,-a,0);break;case"top":d.vec2.set(M,0,s);break;case"right":d.vec2.set(M,a,0);break;case"bottom":d.vec2.set(M,0,-s);break;case"top-left":d.vec2.set(M,-a,s);break;case"bottom-left":d.vec2.set(M,-a,-s);break;case"top-right":d.vec2.set(M,a,s);break;case"bottom-right":d.vec2.set(M,a,-s)}return t.translateBy(e,r,M),e}),t.rotateBy=function(e,t,r){return U(e,t),e.rotation+=r,e},t.rotateTo=function(e,t,r){return U(e,t),e.rotation=r,e},t.scaleBy=function(){var e=h.vec2f64.create();return function(r,n,i,o,a){return U(r,n),isNaN(i)||0===i||(t.toMap(e,o,n,a),r.scale=n.scale*i,t.toScreen(e,e,r,a),t.translateBy(r,r,d.vec2.set(e,e[0]-o[0],o[1]-e[1]))),r}}(),t.scaleTo=function(e,t,r){return U(e,t),e.scale=r,e},t.scaleAndRotateBy=function(){var e=h.vec2f64.create();return function(r,n,i,o,a,s){return U(r,n),isNaN(i)||0===i||(t.toMap(e,a,n,s),r.scale=n.scale*i,r.rotation+=o,t.toScreen(e,e,r,s),t.translateBy(r,r,d.vec2.set(e,e[0]-a[0],a[1]-e[1]))),r}}(),t.padAndScaleAndRotateBy=(A=h.vec2f64.create(),E=h.vec2f64.create(),function(e,r,n,i,o,a,s){return t.getPaddingScreenTranslation(E,a,s),d.vec2.add(A,o,E),i?t.scaleAndRotateBy(e,r,n,i,A,a):t.scaleBy(e,r,n,A,a)}),t.toMap=(I=p.mat2df64.create(),function(e,r,n,i){return d.vec2.transformMat2d(e,r,function(e,r,n,i){return t.getTransform(e,r,n,1),u.mat2d.invert(e,e)}(I,n,i))}),t.toScreen=function(){var e=p.mat2df64.create();return function(r,n,i,o){return d.vec2.transformMat2d(r,n,t.getTransform(e,i,o,1))}}(),t.translateBy=function(){var e=h.vec2f64.create(),t=p.mat2df64.create();return function(r,n,i){U(r,n);var o=H(n),a=r.targetGeometry;return u.mat2d.fromRotation(t,q(n)),u.mat2d.scale(t,t,h.vec2f64.fromValues(o,o)),d.vec2.transformMat2d(e,i,t),a.x+=e[0],a.y+=e[1],r}}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(792)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2d=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(389),r(160),r(203),r(1163),r(326),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c,u,p,d,h=a.Vec3Compact;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],o=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],a=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)a[6*c+u]=c;var p=new Array(36);for(c=0;c<6;c++)p[6*c+0]=0,p[6*c+1]=1,p[6*c+2]=2,p[6*c+3]=2,p[6*c+4]=3,p[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=r[c][0]*e[0],t[3*c+1]=r[c][1]*e[1],t[3*c+2]=r[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(o),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(a),u[l.VertexAttrConstants.UV0]=new Uint32Array(p);var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:t},d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(n)},d[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(i)},new s.GeometryData(d,u)}}(c||(c={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],o=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),a=0;a<6;a++)t[3*a]=r[a][0]*e[0],t[3*a+1]=r[a][1]*e[1],t[3*a+2]=r[a][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(i),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(o);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(n)},new s.GeometryData(u,c)}}(u||(u={})),function(e){var t=.5,i=n.vec3f32.fromValues(-t,0,-t),o=n.vec3f32.fromValues(t,0,-t),a=n.vec3f32.fromValues(0,0,t),c=n.vec3f32.fromValues(0,.5,0),u=n.vec3f32.create(),p=n.vec3f32.create(),d=n.vec3f32.create(),h=n.vec3f32.create(),f=n.vec3f32.create();r.vec3.subtract(u,i,c),r.vec3.subtract(p,i,o),r.vec3.cross(d,u,p),r.vec3.normalize(d,d),r.vec3.subtract(u,o,c),r.vec3.subtract(p,o,a),r.vec3.cross(h,u,p),r.vec3.normalize(h,h),r.vec3.subtract(u,a,c),r.vec3.subtract(p,a,i),r.vec3.cross(f,u,p),r.vec3.normalize(f,f);var v=[i,o,a,c],m=[0,-1,0,d[0],d[1],d[2],h[0],h[1],h[2],f[0],f[1],f[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),r=0;r<4;r++)t[3*r]=v[r][0]*e[0],t[3*r+1]=v[r][1]*e[1],t[3*r+2]=v[r][2]*e[2];var n={};n[l.VertexAttrConstants.POSITION]=new Uint32Array(y),n[l.VertexAttrConstants.NORMAL]=new Uint32Array(g);var i={};return i[l.VertexAttrConstants.POSITION]={size:3,data:t},i[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(m)},new s.GeometryData(i,n)}}(p||(p={})),function(e){e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=p.createGeometry,e.createSphereGeometry=function(e,t,r,n,i,o,a){e=e||50,n=void 0!==n?n:-Math.PI,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:.5*-Math.PI,a=void 0!==a?a:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(r)||6),p=(c+1)*(u+1),d=new Float32Array(3*p),h=new Float32Array(3*p),f=new Float32Array(2*p),v=[],m=0,y=0;y<=u;y++){for(var g=[],_=y/u,b=o+_*a,x=Math.cos(b),w=0;w<=c;w++){var S=w/c,P=n+S*i,T=Math.cos(P)*x,O=Math.sin(b),C=-Math.sin(P)*x;d[3*m]=T*e,d[3*m+1]=O*e,d[3*m+2]=C*e,h[3*m]=T,h[3*m+1]=O,h[3*m+2]=C,f[2*m]=S,f[2*m+1]=_,g.push(m),++m}v.push(g)}var M=new Uint32Array(2*c*(u-1)*3);for(m=0,y=0;y<u;y++)for(w=0;w<c;w++){var A=v[y][w],E=v[y][w+1],I=v[y+1][w+1],R=v[y+1][w];0===y?(M[m++]=A,M[m++]=I,M[m++]=R):y===u-1?(M[m++]=A,M[m++]=E,M[m++]=I):(M[m++]=A,M[m++]=E,M[m++]=I,M[m++]=I,M[m++]=R,M[m++]=A)}l.assert(m===M.length);var D={};D[l.VertexAttrConstants.POSITION]=M,D[l.VertexAttrConstants.NORMAL]=M,D[l.VertexAttrConstants.UV0]=M;var L={};return L[l.VertexAttrConstants.POSITION]={size:3,data:d},L[l.VertexAttrConstants.NORMAL]={size:3,data:h},L[l.VertexAttrConstants.UV0]={size:2,data:f},new s.GeometryData(L,D)},e.createPolySphereGeometry=function(e,t,r){var n,i,o=e;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var a=o*(1+Math.sqrt(5))/2;n=[-o,a,0,o,a,0,-o,-a,0,o,-a,0,0,-o,a,0,o,a,0,-o,-a,0,o,-a,a,0,-o,a,0,o,-a,0,-o,-a,0,o],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<n.length;c+=3)h.scale(n,c,e/h.length(n,c));var u={};function p(t,r){var i;t>r&&(t=(i=[r,t])[0],r=i[1]);var o=t.toString()+"."+r.toString();if(u[o])return u[o];var a=n.length;return n.length+=3,h.add(n,3*t,n,3*r,n,a),h.scale(n,a,e/h.length(n,a)),a/=3,u[o]=a,a}for(c=0;c<t;c++){for(var d=i.length,f=new Uint32Array(4*d),v=0;v<d;v+=3){var m=i[v],y=i[v+1],g=i[v+2],_=p(m,y),b=p(y,g),x=p(g,m),w=4*v;f[w]=m,f[w+1]=_,f[w+2]=x,f[w+3]=y,f[w+4]=b,f[w+5]=_,f[w+6]=g,f[w+7]=x,f[w+8]=b,f[w+9]=_,f[w+10]=b,f[w+11]=x}i=f,u={}}var S=new Float32Array(n);for(c=0;c<S.length;c+=3)h.normalize(S,c);var P={};P[l.VertexAttrConstants.POSITION]=i,P[l.VertexAttrConstants.NORMAL]=i;var T={};return T[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(n)},T[l.VertexAttrConstants.NORMAL]={size:3,data:S},new s.GeometryData(T,P)},e.createPointGeometry=function(e,t,r,n,i,o,a,c){var u=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),p=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=o?new Float32Array(o):new Float32Array([0,0]),h=r?new Uint8Array([255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]):new Uint8Array([255,255,255,255]),f=null!=n&&2===n.length?new Float32Array(n):new Float32Array([1,1]),v={};if(v[l.VertexAttrConstants.POSITION]={size:3,data:u},v[l.VertexAttrConstants.NORMAL]={size:3,data:p},v[l.VertexAttrConstants.UV0]={size:d.length,data:d},v[l.VertexAttrConstants.COLOR]={size:4,data:h},v[l.VertexAttrConstants.SIZE]={size:2,data:f},null!=i){var m=new Float32Array([i[0],i[1],i[2],i[3]]);v[l.VertexAttrConstants.AUXPOS1]={size:4,data:m}}if(null!=a){var y=new Float32Array([a[0],a[1],a[2],a[3]]);v[l.VertexAttrConstants.AUXPOS2]={size:4,data:y}}return null!=c?(s.GeometryData.call(c,v,s.GeometryData.DefaultIndices,"point"),c):new s.GeometryData(v,s.GeometryData.DefaultIndices,"point")},e.updatePointGeometry=function(e,t,r,n,i,o,a,s){var c,u=s.vertexAttributes;return null!=e&&((c=u[l.VertexAttrConstants.NORMAL].data)[0]=e[0],c[1]=e[1],c[2]=e[2]),null!=t&&((c=u[l.VertexAttrConstants.POSITION].data)[0]=t[0],c[1]=t[1],c[2]=t[2]),null!=r&&((c=u[l.VertexAttrConstants.COLOR].data)[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3]),null!=n&&((c=u[l.VertexAttrConstants.SIZE].data)[0]=n[0],c[1]=n[1]),null!=i&&((c=u[l.VertexAttrConstants.AUXPOS1].data)[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3]),null!=o&&((c=u[l.VertexAttrConstants.UV0].data)[0]=o[0],c[1]=o[1]),null!=a&&((c=u[l.VertexAttrConstants.AUXPOS2].data)[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]),s},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),n=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),o=new Uint32Array(e.length),a=0;a<e.length;a++)r[3*a]=e[a][0],r[3*a+1]=e[a][1],r[3*a+2]=e[a][2],t&&(n[3*a]=t[a][0],n[3*a+1]=t[a][1],n[3*a+2]=t[a][2]),i[a]=a,o[a]=0;t||(n[0]=0,n[1]=1,n[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=i,u[l.VertexAttrConstants.NORMAL]=t?i:o,u[l.VertexAttrConstants.UV0]=o;var p={};return p[l.VertexAttrConstants.POSITION]={size:3,data:r},p[l.VertexAttrConstants.NORMAL]={size:3,data:n},p[l.VertexAttrConstants.UV0]={size:2,data:c},new s.GeometryData(p,u,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),r=new Float32Array([0,1,0]),n=new Uint32Array([0,0,0]),i=new Float32Array([0,0]),o=new Uint32Array([0,0,0]),a={};a[l.VertexAttrConstants.POSITION]=t,a[l.VertexAttrConstants.NORMAL]=n,a[l.VertexAttrConstants.UV0]=o;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:r},c[l.VertexAttrConstants.UV0]={size:2,data:i},new s.GeometryData(c,a)};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function d(e,t,n,i,o){return!(Math.abs(r.vec3.dot(t,e))>o||(r.vec3.cross(n,e,t),r.vec3.normalize(n,n),r.vec3.cross(i,n,e),r.vec3.normalize(i,i),0))}function y(e,t,r,n,i,o,a){return d(e,t,i,o,a)||d(e,r,i,o,a)||d(e,n,i,o,a)}e.createSquareGeometry=function(e){var r,n;void 0===e&&(e=t);for(var i=new Float64Array(12),o=0;o<4;o++)for(var a=0;a<3;a++)i[3*o+a]=e[o][a];var c=new Uint32Array([0,1,2,2,3,0]),u=new Float32Array([0,0,1]),p=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),h=new Uint8Array([255,255,255,255]),f=((r={})[l.VertexAttrConstants.POSITION]=c,r[l.VertexAttrConstants.NORMAL]=p,r[l.VertexAttrConstants.UV0]=c,r[l.VertexAttrConstants.COLOR]=p,r),v=((n={})[l.VertexAttrConstants.POSITION]={size:3,data:i},n[l.VertexAttrConstants.NORMAL]={size:3,data:u},n[l.VertexAttrConstants.UV0]={size:2,data:d},n[l.VertexAttrConstants.COLOR]={size:4,data:h},n);return new s.GeometryData(v,f)},e.createConeGeometry=function(e,t,r,i,o,a){void 0===o&&(o=!0),void 0===a&&(a=!0);var c=0,u=t,p=e,d=n.vec3f32.fromValues(0,c,0),h=n.vec3f32.fromValues(0,c+p,0),f=n.vec3f32.fromValues(0,-1,0),v=n.vec3f32.fromValues(0,1,0);i&&(c=p,h=n.vec3f32.fromValues(0,0,0),d=n.vec3f32.fromValues(0,c,0),f=n.vec3f32.fromValues(0,1,0),v=n.vec3f32.fromValues(0,-1,0));var m=[h,d],y=[f,v],g=r+2,_=Math.sqrt(p*p+u*u);if(i)for(b=r-1;b>=0;b--)x=b*(2*Math.PI/r),w=n.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u),m.push(w),S=n.vec3f32.fromValues(p*Math.cos(x)/_,-u/_,p*Math.sin(x)/_),y.push(S);else for(var b=0;b<r;b++){var x=b*(2*Math.PI/r),w=n.vec3f32.fromValues(Math.cos(x)*u,c,Math.sin(x)*u);m.push(w);var S=n.vec3f32.fromValues(p*Math.cos(x)/_,u/_,p*Math.sin(x)/_);y.push(S)}var P=new Uint32Array(2*(r+2)*3),T=new Uint32Array(2*(r+2)*3),O=0,C=0;if(o){for(b=3;b<m.length;b++)P[O++]=1,P[O++]=b-1,P[O++]=b,T[C++]=0,T[C++]=0,T[C++]=0;P[O++]=m.length-1,P[O++]=2,P[O++]=1,T[C++]=0,T[C++]=0,T[C++]=0}if(a){for(b=3;b<m.length;b++)P[O++]=b,P[O++]=b-1,P[O++]=0,T[C++]=b,T[C++]=b-1,T[C++]=1;P[O++]=0,P[O++]=2,P[O++]=m.length-1,T[C++]=1,T[C++]=2,T[C++]=y.length-1}var M=new Float32Array(3*g);for(b=0;b<g;b++)M[3*b]=m[b][0],M[3*b+1]=m[b][1],M[3*b+2]=m[b][2];var A=new Float32Array(3*g);for(b=0;b<g;b++)A[3*b]=y[b][0],A[3*b+1]=y[b][1],A[3*b+2]=y[b][2];var E={};E[l.VertexAttrConstants.POSITION]=P,E[l.VertexAttrConstants.NORMAL]=T;var I={};return I[l.VertexAttrConstants.POSITION]={size:3,data:M},I[l.VertexAttrConstants.NORMAL]={size:3,data:A},new s.GeometryData(I,E)},e.createCylinderGeometry=function(e,t,i,o,a,c){var u=o?n.vec3f32.clone(o):n.vec3f32.fromValues(1,0,0),p=a?n.vec3f32.clone(a):n.vec3f32.fromValues(0,0,0),d=void 0===c||c,h=n.vec3f32.create();r.vec3.normalize(h,u);var f=n.vec3f32.create();r.vec3.scale(f,h,Math.abs(e));var v=n.vec3f32.create();r.vec3.scale(v,f,-.5),r.vec3.add(v,v,p);var m=n.vec3f32.fromValues(0,1,0);Math.abs(1-r.vec3.dot(h,m))<.2&&r.vec3.set(m,0,0,1);var y=n.vec3f32.create();r.vec3.cross(y,h,m),r.vec3.normalize(y,y),r.vec3.cross(m,y,h);var g=2*i+(d?2:0),_=i+(d?2:0),b=new Float32Array(3*g),x=new Float32Array(3*_),w=new Float32Array(2*g),S=new Uint32Array(3*i*(d?4:2)),P=new Uint32Array(3*i*(d?4:2));d&&(b[3*(g-2)+0]=v[0],b[3*(g-2)+1]=v[1],b[3*(g-2)+2]=v[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,b[3*(g-1)+0]=b[3*(g-2)+0]+f[0],b[3*(g-1)+1]=b[3*(g-2)+1]+f[1],b[3*(g-1)+2]=b[3*(g-2)+2]+f[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,x[3*(_-2)+0]=-h[0],x[3*(_-2)+1]=-h[1],x[3*(_-2)+2]=-h[2],x[3*(_-1)+0]=h[0],x[3*(_-1)+1]=h[1],x[3*(_-1)+2]=h[2]);for(var T=function(e,t,r){S[e]=t,P[e]=r},O=0,C=n.vec3f32.create(),M=n.vec3f32.create(),A=0;A<i;A++){var E=A*(2*Math.PI/i);r.vec3.scale(C,m,Math.sin(E)),r.vec3.scale(M,y,Math.cos(E)),r.vec3.add(C,C,M),x[3*A+0]=C[0],x[3*A+1]=C[1],x[3*A+2]=C[2],r.vec3.scale(C,C,t),r.vec3.add(C,C,v),b[3*A+0]=C[0],b[3*A+1]=C[1],b[3*A+2]=C[2],w[2*A+0]=A/i,w[2*A+1]=0,b[3*(A+i)+0]=b[3*A+0]+f[0],b[3*(A+i)+1]=b[3*A+1]+f[1],b[3*(A+i)+2]=b[3*A+2]+f[2],w[2*(A+i)+0]=A/i,w[2*A+1]=1;var I=(A+1)%i;T(O++,A,A),T(O++,A+i,A),T(O++,I,I),T(O++,I,I),T(O++,A+i,A),T(O++,I+i,I)}if(d){for(A=0;A<i;A++)I=(A+1)%i,T(O++,g-2,_-2),T(O++,A,_-2),T(O++,I,_-2);for(A=0;A<i;A++)I=(A+1)%i,T(O++,A+i,_-1),T(O++,g-1,_-1),T(O++,I+i,_-1)}var R={};R[l.VertexAttrConstants.POSITION]=S,R[l.VertexAttrConstants.NORMAL]=P,R[l.VertexAttrConstants.UV0]=S;var D={};return D[l.VertexAttrConstants.POSITION]={size:3,data:b},D[l.VertexAttrConstants.NORMAL]={size:3,data:x},D[l.VertexAttrConstants.UV0]={size:2,data:w},new s.GeometryData(D,R)},e.createTubeGeometry=function(t,r,n,i,o){n=n||10,i=null==i||i,l.assert(t.length>1);for(var a=[],s=[],c=0;c<n;c++){a.push([0,-c-1,-(c+1)%n-1]);var u=c/n*2*Math.PI;s.push([Math.cos(u)*r,Math.sin(u)*r])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],a,i,o)},e.createPathExtrusionGeometry=function(e,t,a,c,u,p){void 0===p&&(p=n.vec3f32.fromValues(0,0,0));var d=e.length,h=new Float32Array(t.length*d*3+(6*a.length||0)),v=new Float32Array(t.length*d+(2*a.length||0)),m=new Float32Array(t.length*d*3+(a?6:0)),g=(t.length-1)*d*6+3*c.length*2,_=new Uint32Array(g),b=new Uint32Array(g),x=0,w=0,S=0,P=0,T=0,O=n.vec3f32.create(),C=n.vec3f32.create(),M=n.vec3f32.create(),A=n.vec3f32.create(),E=n.vec3f32.create(),I=n.vec3f32.create(),R=n.vec3f32.create(),D=i.vec3f64.create(),L=n.vec3f32.create(),j=n.vec3f32.create(),V=n.vec3f32.create(),F=n.vec3f32.create(),N=n.vec3f32.create(),k=o.plane.create();r.vec3.set(L,0,1,0),r.vec3.subtract(C,t[1],t[0]),r.vec3.normalize(C,C),u?(r.vec3.add(D,t[0],p),r.vec3.normalize(M,D)):r.vec3.set(M,0,0,1),y(C,M,L,L,E,M,f),r.vec3.copy(A,M),r.vec3.copy(F,E);for(var z=0;z<a.length;z++)r.vec3.scale(I,E,a[z][0]),r.vec3.scale(D,M,a[z][2]),r.vec3.add(I,I,D),r.vec3.add(I,I,t[0]),h[x++]=I[0],h[x++]=I[1],h[x++]=I[2],v[S++]=0;for(m[w++]=-C[0],m[w++]=-C[1],m[w++]=-C[2],z=0;z<c.length;z++)_[P++]=c[z][0]>0?c[z][0]:-c[z][0]-1+a.length,_[P++]=c[z][1]>0?c[z][1]:-c[z][1]-1+a.length,_[P++]=c[z][2]>0?c[z][2]:-c[z][2]-1+a.length,b[T++]=0,b[T++]=0,b[T++]=0;for(var U=a.length,B=a.length-1,G=0;G<t.length;G++){var H=!1;G>0&&(r.vec3.copy(O,C),G<t.length-1?(r.vec3.subtract(C,t[G+1],t[G]),r.vec3.normalize(C,C)):H=!0,r.vec3.add(j,O,C),r.vec3.normalize(j,j),r.vec3.add(V,t[G-1],A),o.plane.fromPositionAndNormal(t[G],j,k),o.plane.intersectRay(k,o.ray.wrap(V,O),D)?(r.vec3.subtract(D,D,t[G]),r.vec3.normalize(M,D),r.vec3.cross(E,j,M),r.vec3.normalize(E,E)):y(j,A,F,L,E,M,f),r.vec3.copy(A,M),r.vec3.copy(F,E)),u&&(r.vec3.add(D,t[G],p),r.vec3.normalize(N,D));for(var q=0;q<d;q++)if(r.vec3.scale(I,E,e[q][0]),r.vec3.scale(D,M,e[q][1]),r.vec3.add(I,I,D),r.vec3.normalize(R,I),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2],v[S++]=u?r.vec3.dot(I,N):I[2],r.vec3.add(I,I,t[G]),h[x++]=I[0],h[x++]=I[1],h[x++]=I[2],!H){var W=(q+1)%d;_[P++]=U+q,_[P++]=U+d+q,_[P++]=U+W,_[P++]=U+W,_[P++]=U+d+q,_[P++]=U+d+W;for(var J=0;J<6;J++)b[T++]=_[P-6+J]-B}U+=d}var Z=t[t.length-1];for(z=0;z<a.length;z++)r.vec3.scale(I,E,a[z][0]),r.vec3.scale(D,M,a[z][1]),r.vec3.add(I,I,D),r.vec3.add(I,I,Z),h[x++]=I[0],h[x++]=I[1],h[x++]=I[2],v[S++]=0;var X=w/3;m[w++]=C[0],m[w++]=C[1],m[w++]=C[2];var Y=U-d;for(z=0;z<c.length;z++)_[P++]=c[z][0]>=0?U+c[z][0]:-c[z][0]-1+Y,_[P++]=c[z][2]>=0?U+c[z][2]:-c[z][2]-1+Y,_[P++]=c[z][1]>=0?U+c[z][1]:-c[z][1]-1+Y,b[T++]=X,b[T++]=X,b[T++]=X;var Q={};Q[l.VertexAttrConstants.POSITION]=_,Q[l.VertexAttrConstants.NORMAL]=b;var K={};return K[l.VertexAttrConstants.POSITION]={size:3,data:h},K.zOffset={size:1,data:v},K[l.VertexAttrConstants.NORMAL]={size:3,data:m},new s.GeometryData(K,Q)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var r=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1)),i=0,o=0,a=0;a<e.length;a++){for(var c=0;c<3;c++)r[i++]=e[a][c];a>0&&(n[o++]=a-1,n[o++]=a)}var u={},p={};if(u[l.VertexAttrConstants.POSITION]=n,p[l.VertexAttrConstants.POSITION]={size:3,data:r},t){var d=new Float32Array(3*t.length),h=0;for(a=0;a<e.length;a++)for(c=0;c<3;c++)d[h++]=t[a][c];u[l.VertexAttrConstants.NORMAL]=n,p[l.VertexAttrConstants.NORMAL]={size:3,data:d}}return new s.GeometryData(p,u,"line")},e.createExtrudedTriangle=function(e,t,r,n){for(var i,o,a=new Float32Array(18),c=[[-t,0,n/2],[r,0,n/2],[0,e,n/2],[-t,0,-n/2],[r,0,-n/2],[0,e,-n/2]],u=0;u<6;u++)a[3*u]=c[u][0],a[3*u+1]=c[u][1],a[3*u+2]=c[u][2];var p=((i={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),i),d=((o={})[l.VertexAttrConstants.POSITION]={size:3,data:a},o);return new s.GeometryData(d,p)},e.transformInPlace=function(e,t){for(var n=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,i=0;i<n.length;i+=3){var o=n[i],a=n[i+1],s=n[i+2];r.vec3.set(v,o,a,s),r.vec3.transformMat4(v,v,t),n[i]=v[0],n[i+1]=v[1],n[i+2]=v[2]}},e.addVertexColors=function(e,t){var r=t||[1,1,1,1],n=new Uint8Array(4);n[0]=255*r[0],n[1]=255*r[1],n[2]=255*r[2],n[3]=255*(r.length>3?r[3]:1);var i={},o=e.getVertexAttr();for(var a in o)i[a]=o[a];i[l.VertexAttrConstants.COLOR]={size:4,data:n};var c={};for(var a in e.indices)c[a]=e.indices[a];var u=c[l.VertexAttrConstants.POSITION].length;return c[l.VertexAttrConstants.COLOR]=new Uint32Array(u),new s.GeometryData(i,c,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),n=e.indices,i=a.Vec3Compact.subtract,o=n.position.length/3,s=new Float32Array(3*o),c=t.position.data,u=0,p=n.position,d=new Uint32Array(p.length),h=0;h<p.length;h+=3){i(c,3*p[h],c,3*p[h+2],m,0),i(c,3*p[h],c,3*p[h+1],v,0),r.vec3.cross(v,v,m),r.vec3.normalize(v,v);var f=u/3;s[u++]=v[0],s[u++]=v[1],s[u++]=v[2],d[h]=f,d[h+1]=f,d[h+2]=f}t[l.VertexAttrConstants.NORMAL]={size:3,data:s,offsetIdx:0,strideIdx:3},n[l.VertexAttrConstants.NORMAL]=d},e.cgToGIS=function(e,t){void 0===t&&(t=e);var r=e.getVertexAttr(),n=r.position.data,i=r.normal.data,o=t.getVertexAttr(),a=o.position.data,s=o.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(n)for(l=0;l<n.length;l+=3)c=n[l+1],a[l+1]=-n[l+2],a[l+2]=c;return t},e.makeOrthoBasisDirUp=d,e.makeOrthoBasisDirUpFallback=y}(d||(d={}));var f=.99619469809,v=n.vec3f32.create(),m=n.vec3f32.create();return d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(1177)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=1,a=null,s=new Uint32Array([0]);t.generateDefaultIndexArray=function(e){if(1===e)return s;if(e>o||null==a){for(;e>o;)o*=2;a=new Uint32Array(o);for(var t=0;t<o;t++)a[t]=t}return new Uint32Array(a.buffer,0,e)},t.computeAttachmentOriginTriangles=function(e,t,n){if(!e)return!1;var o=e.strideIdx,a=e.offsetIdx,s=e.data;r.vec3.set(n,0,0,0),r.vec3.set(d,0,0,0);for(var l=0,h=0,f=0;f<t.length-2;f+=3){var v=t[f+0]*o+a,m=t[f+1]*o+a,y=t[f+2]*o+a;r.vec3.set(c,s[v+0],s[v+1],s[v+2]),r.vec3.set(u,s[m+0],s[m+1],s[m+2]),r.vec3.set(p,s[y+0],s[y+1],s[y+2]);var g=i.areaPoints3d(c,u,p);g?(r.vec3.add(c,c,u),r.vec3.add(c,c,p),r.vec3.scale(c,c,1/3*g),r.vec3.add(n,n,c),l+=g):(r.vec3.add(d,d,c),r.vec3.add(d,d,u),r.vec3.add(d,d,p),h+=3)}return!(0===h&&0===l||(0!==l?(r.vec3.scale(n,n,1/l),0):0===h||(r.vec3.scale(n,d,1/h),0)))},t.computeAttachmentOriginPoints=function(e,t,n){if(!e||!t)return!1;var i=e.strideIdx,o=e.offsetIdx,a=e.data;r.vec3.set(n,0,0,0);for(var s=-1,l=0,c=0;c<t.length;c++){var u=t[c]*i+o;s!==u&&(n[0]+=a[u+0],n[1]+=a[u+1],n[2]+=a[u+2],l++),s=u}return l>1&&r.vec3.scale(n,n,1/l),l>0},t.computeAttachmentOriginLines=function(e,t,n,i){if(!e)return!1;var o=e.strideIdx,a=e.offsetIdx,s=e.data;r.vec3.set(i,0,0,0),r.vec3.set(d,0,0,0);for(var l=0,p=0,h=t?t.length-1:s.length/o-1,f=h+(n?2:0),v=0;v<f;v+=2){var m=v<h?v:h,y=v<h?v+1:0,g=(t?t[m]:m)*o+a,_=(t?t[y]:y)*o+a;c[0]=s[g+0],c[1]=s[g+1],c[2]=s[g+2],u[0]=s[_+0],u[1]=s[_+1],u[2]=s[_+2],r.vec3.scale(c,r.vec3.add(c,c,u),.5);var b=r.vec3.dist(c,u);b>0?(r.vec3.add(i,i,r.vec3.scale(c,c,b)),l+=b):(r.vec3.add(d,d,c),p++)}return 0!==l?(r.vec3.scale(i,i,1/l),!0):0!==p&&(r.vec3.scale(i,d,1/p),!0)};var l=0;t.getNewId=function(){return l++};var c=n.vec3f64.create(),u=n.vec3f64.create(),p=n.vec3f64.create(),d=n.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1633)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quat=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(534)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r.IdGen;t.generateObject3DStateId=function(e){var t=0===e?"highlight":"occludee";return{id:n.gen(t),channel:e}};var i=function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:0,objectStateId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:2,objectStateId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.objectStateId===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];0===r.type&&r.object===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];1===r.type&&r.renderGeometry===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]},e.prototype._removeObjectStateItem=function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}},e}();t.Object3DStateSet=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(152),r(189),r(185),r(921),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.addObject3DStateID=function(e,t){return r.isNone(e)&&(e=[]),e.push(t),e},t.removeObject3DStateID=function(e,t){if(r.isNone(e))return e;var n=e.filter((function(e){return e!==t}));return 0===n.length?null:n},t.isInstanceHidden=function(e){return!!n.isSome(e)&&!e.visible},t.acquireMaterials=function(e,t){var r=new Map;return r.set(0,t.acquire(e,0)),r.set(3,t.acquire(e,3)),r.set(2,t.acquire(e,2)),r.set(1,t.acquire(e,1)),r.set(4,t.acquire(e,4)),r},t.releaseMaterials=function(e,t){t.release(e,0),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)},t.calculateTransformRelToOrigin=function(e,t,r){var o=e.origin.vec3;s.setMatrixTranslation3(u,-o[0],-o[1],-o[2]),n.isSome(e.transformation)?i.mat4.multiply(t,u,e.transformation):i.mat4.copy(t,u),r&&(i.mat4.invert(r,t),i.mat4.transpose(r,r))},t.encodeDoubleVec3=function(e,t,r,n,i){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),a.encodeDoubleArray(l,c,3),r.set(i,0,c[0]),n.set(i,0,c[1]),r.set(i,1,c[2]),n.set(i,1,c[3]),r.set(i,2,c[4]),n.set(i,2,c[5])};var l=new Float64Array(3),c=new Float32Array(6),u=o.mat4f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(494),r(175)],void 0===(i=function(e,t,r,n,i){function o(e){e.include(n.RgbaFloatEncoding),e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("shadowMapNum","int"),e.fragment.uniforms.add("shadowMapDistance","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize = depthHalfPixelSz;\n      vec4 distance = shadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      if (i >= shadowMapNum) { return 0.0; }\n\n      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n\n      // vertex completely outside? -> no shadow\n      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadShadowMap=o,function(e){e.bindUniforms=function(e,t,r){t.shadowMappingEnabled&&(t.shadowMap.bind(e,r),t.shadowMap.bindView(e,t.origin))},e.bindViewCustomOrigin=function(e,t,r){t.shadowMappingEnabled&&t.shadowMap.bindView(e,r)},e.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}}(o=t.ReadShadowMap||(t.ReadShadowMap={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(207),r(246)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function s(e){return null!=e.cachedResult}function l(e){return"0"===e?0:null}t.clone=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}},t.createContextWithoutExpressionSupport=function(e){var t=e&&e.expression;if("string"==typeof t){var r=l(t);if(null!=r)return{cachedResult:r}}return null},t.createContext=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,a,s,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return"string"!=typeof(i=e&&e.expression)?[2,null]:null!=(a=l(i))?[2,{cachedResult:a}]:[4,o.loadArcade()];case 1:return s=r.sent(),c=s.arcadeUtils,u=c.createSyntaxTree(i),c.dependsOnView(u)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:s}}]}}))}))},t.createFeature=function(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)},t.setContextFeature=function(e,t){if(null!=e&&!s(e)){if(!t||!e.arcade)return void a.errorOncePerTick("Arcade support required but not provided");var r=t;r._geometry&&(r._geometry=i.hydrateGeometry(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}},t.execute=function(e){if(null!=e){if(s(e))return e.cachedResult;var t=e.arcade,r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,n=r&&r.expression;return t||"0"===n||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(276),r(185),r(160),r(810),r(541),r(175)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e,t){e.include(a.PositionAttribute),e.include(s.DoublePrecision,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(l.glsl(u||(u=r.__makeTemplateObject(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel = dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      vPosition_view = position_view();\n      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel = dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      vPosition_view = position_view();\n      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(l.glsl(p||(p=r.__makeTemplateObject(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}var u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexPosition=c,function(e){e.ModelTransform=function(){this.worldFromModel_RS=n.mat3f64.create(),this.worldFromModel_TH=o.vec3f64.create(),this.worldFromModel_TL=o.vec3f64.create()};e.ViewProjectionTransform=function(){this.worldFromView_TH=o.vec3f64.create(),this.worldFromView_TL=o.vec3f64.create(),this.viewFromCameraRelative_RS=n.mat3f64.create(),this.projFromView=i.mat4f64.create()},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(c=t.VertexPosition||(t.VertexPosition={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(168),r(272),r(276),r(189),r(185),r(162),r(160),r(579),r(261)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d;function h(e){return null!=e}function f(e){return"number"==typeof e}function v(e){return"string"==typeof e}function m(e,t){e&&e.push(t),y(t)}function y(e){}function g(e,t,r,n,i){var o=e.minSize,a=e.maxSize;if(e.expression)return m(i,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var s=n.symbolSize[r];return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(h(e.field))return h(e.stops)?2===e.stops.length&&f(e.stops[0].size)&&f(e.stops[1].size)?(_(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(m(i,"Could not convert size info: stops only supported with 2 elements"),!1):f(o)&&f(a)&&h(e.minDataValue)&&h(e.maxDataValue)?(_(o,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=u.meterIn[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/u.meterIn[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(m(i,"Could not convert size info: proportional size not supported"),!1):(m(i,"Could not convert size info: scale-dependent size not supported"),!1);if(!h(e.field)){if(e.stops&&e.stops[0]&&f(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(f(o))return t.minSize[r]=o,t.maxSize[r]=o,t.offset[r]=o,t.factor[r]=0,t.type[r]=1,!0}return m(i,"Could not convert size info: unsupported variant of sizeInfo"),!1}function _(e,t,r,n,i,o){var a=Math.abs(n-r)>0?(t-e)/(n-r):0;i.minSize[o]=a>0?e:t,i.maxSize[o]=a>0?t:e,i.offset[o]=e-r*a,i.factor[o]=a}function b(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function x(e,t,r){var n=2===r&&"arithmetic"===e.rotationType;t.offset[r]=n?90:0,t.factor[r]=n?-1:1,t.type[r]=1}function w(e,t,n){if(!e)return null;var i=!t.supportedTypes||!!t.supportedTypes.size,o=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,s=!!t.supportedTypes&&!!t.supportedTypes.opacity,l=e.reduce((function(e,l){if(!e)return e;if(l.valueExpression)return m(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case"size":return i?function(e,t,r,n){if(e.normalizationField||e.valueRepresentation)return m(n,"Could not convert size info: unsupported property"),null;if(null!=(i=e.field)&&!v(i))return m(n,"Could not convert size info: field is not a string"),null;var i,o;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return m(n,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};switch(e.axis){case"width":return(o=g(e,t.size,0,r,n))?t:null;case"height":return(o=g(e,t.size,2,r,n))?t:null;case"depth":return(o=g(e,t.size,1,r,n))?t:null;case"width-and-depth":return(o=g(e,t.size,0,r,n))&&g(e,t.size,1,r,n),o?t:null;case null:case void 0:case"all":return(o=(o=(o=g(e,t.size,0,r,n))&&g(e,t.size,1,r,n))&&g(e,t.size,2,r,n))?t:null;default:return m(n,'Could not convert size info: unknown axis "'+e.axis+'""'),null}}(l,e,t,n):e;case"color":return o?function(e,t,r){if(e.normalizationField)return m(r,"Could not convert color info: unsupported property"),null;if(v(e.field)){if(!e.stops)return m(r,"Could not convert color info: missing stops or colors"),null;if(e.stops.length>8)return m(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var n=e.stops,i=0;i<8;++i){var o=n[Math.min(i,n.length-1)];t.color.values[i]=o.value,b(t.color.colors,i,o.color)}}else{if(!(e.stops&&e.stops.length>=0))return m(r,"Could not convert color info: no field and no colors/stops"),null;var a=e.stops&&e.stops.length>=0&&e.stops[0].color;for(t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},i=0;i<8;i++)t.color.values[i]=1/0,b(t.color.colors,i,a)}return t}(l,e,n):e;case"opacity":return s?function(e,t,r){if(e.normalizationField)return m(r,"Could not convert opacity info: unsupported property"),null;if(v(e.field)){if(!e.stops)return m(r,"Could not convert opacity info: missing stops or opacities"),null;if(e.stops.length>8)return m(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var n=e.stops,i=0;i<8;++i){var o=n[Math.min(i,n.length-1)];t.opacity.values[i]=o.value,t.opacity.opacityValues[i]=o.opacity}}else{if(!(e.stops&&e.stops.length>=0))return m(r,"Could not convert opacity info: no field and no opacities/stops"),null;var a=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},i=0;i<8;i++)t.opacity.values[i]=1/0,t.opacity.opacityValues[i]=a}return t}(l,e,n):null;case"rotation":return a?function(e,t,r){if(!v(e.field))return m(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return m(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return x(e,t.rotation,0),t;case"roll":return x(e,t.rotation,1),t;case null:case void 0:case"heading":return x(e,t.rotation,2),t;default:return m(r,'Could not convert rotation info: unknown axis "'+e.axis+'""'),null}}(l,e,n):e;default:return r.neverReached(l),null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!function(e,t,r){for(var n=0;n<3;++n){var i=t.unitInMeters;1===e.type[n]&&(i*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/i,e.maxSize[n]=e.maxSize[n]/i,e.offset[n]=e.offset[n]/i,e.factor[n]=e.factor[n]/i}var o;if(0!==e.type[0])o=0;else if(0!==e.type[1])o=1;else{if(0===e.type[2])return m(r,"No size axis contains a valid size or scale"),!1;o=2}for(n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[o],e.maxSize[n]=e.maxSize[o],e.offset[n]=e.offset[o],e.factor[n]=e.factor[o],e.type[n]=e.type[o]);return!0}(l.size,t,n)?null:l:null}function S(e){return e&&null!=e.size}function P(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r)for(var n=e,i=t,o=0;o<3;o++)if(n.type[o]!==i.type[o]||n.offset[o]!==i.offset[o]||n.factor[o]!==i.factor[o])return!1;return!0}function T(e,t){var r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},n=S(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&n&&(r.vvSizeValue=t.transformation.scale),e&&n&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=o.mat3f64.create(),a.mat4.identity(O),function(e,t,r,n){void 0===n&&(n=s.mat4f64.create());var i=e||0,o=t||0,l=r||0;0!==i&&a.mat4.rotateZ(n,n,-i/180*Math.PI),0!==o&&a.mat4.rotateX(n,n,o/180*Math.PI),0!==l&&a.mat4.rotateY(n,n,l/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],O),i.mat3.fromMat4(r.vvSymbolRotationMatrix,O)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}Object.defineProperty(t,"__esModule",{value:!0}),t.convertVisualVariables=w,t.initFastSymbolUpdatesState=function(e,t){if(!e)return{enabled:!1};if(p.DISABLE_FAST_UPDATES)return{enabled:!1};var r=w(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:T(r,t),requiresShaderTransformation:S(r)}:{enabled:!1}},t.updateFastSymbolUpdatesState=function(e,t,r){if(!t||!e.enabled)return!1;var n=e.visualVariables,i=w(t.visualVariables,r);return!!i&&(!!(P(n.size,i.size,"size")&&P(n.color,i.color,"color")&&P(n.rotation,i.rotation,"rotation")&&P(n.opacity,i.opacity,"opacity"))&&(e.visualVariables=i,e.materialParameters=T(i,r),e.requiresShaderTransformation=S(i),!0))},t.getMaterialParams=T,function(e){var t=s.mat4f64.create(),r=c.vec3f64.create();e.evaluateModelTransform=function(e,i,o){if(!e.vvSizeEnabled)return o;a.mat4.copy(t,o);var s=e.vvSymbolRotationMatrix;a.mat4.set(O,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),a.mat4.multiply(t,t,O);for(var l=0;l<3;++l){var c=e.vvSizeOffset[l]+i[0]*e.vvSizeFactor[l];r[l]=n.clamp(c,e.vvSizeMinSize[l],e.vvSizeMaxSize[l])}return a.mat4.scale(t,t,r),a.mat4.translate(t,t,e.vvSymbolAnchor),t},e.evaluateModelTransformScale=function(e,t,r){if(!t.vvSizeEnabled)return l.vec3.set(e,1,1,1);for(var i=0;i<3;++i){var o=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=n.clamp(o,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}}(d||(d={}));var O=s.mat4f64.create();t.evaluateModelTransform=d.evaluateModelTransform,t.evaluateModelTransformScale=d.evaluateModelTransformScale}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(189),r(185),r(162),r(160),r(1168),r(251),r(443),r(445),r(195),r(446)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){return function(){function e(e,t,r,n,i,o,s){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.boundingInfo=t,this.material=r,this.origin=null,this.center=a.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,n&&this.updateTransformation(n,o),this.castShadow=s,this.instanceParameters={highlights:null,occludees:null,visible:!0}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,r){return t=t||l.maxScale(e),o.vec3.transformMat4(r,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),n.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(r.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):r.unwrapOr(this.transformation,s.IDENTITY)},e.prototype.computeAttachmentOrigin=function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(r.isSome(this.transformation)&&o.vec3.transformMat4(e,e,this.transformation),!0);var t=this.getIndices(p.VertexAttrConstants.POSITION),n=this.getAttribute(p.VertexAttrConstants.POSITION);return!!c.computeAttachmentOriginTriangles(n,t,e)&&(r.isSome(this.transformation)&&o.vec3.transformMat4(e,e,this.transformation),!0)},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(){var e=u.generateObject3DStateId(0),t=this.instanceParameters;return t.highlights=d.addObject3DStateID(t.highlights,e),e},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.highlights=d.removeObject3DStateID(t.highlights,e)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(335),r(154),r(156),r(152),r(225),r(153),r(172),r(151),r(436),r(208),r(902),r(339),r(244),r(240),r(233),r(1273),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){var x=s.getLogger("esri.layers.ElevationLayer");return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.copyright=null,n.heightModelInfo=null,n.path=null,n.opacity=1,n.operationalLayerType="ArcGISTiledElevationServiceLayer",n.sourceJSON=null,n.type="elevation",n.url=null,n.version=null,n._lercDecoder=b.acquireInstance(),n}return n.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n.__assign({url:e},t):e},t.prototype.destroy=function(){b.releaseInstance(this._lercDecoder),this._lercDecoder=null},Object.defineProperty(t.prototype,"minScale",{get:function(){},set:function(e){this.constructed&&x.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){},set:function(e){this.constructed&&x.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0}),t.prototype.readVersion=function(e,t){var r=t.currentVersion;return r||(r=9.3),r},t.prototype.load=function(e){var t=this,r=l.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new a("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then((function(){return t._fetchImageService(r)}),(function(){return t._fetchImageService(r)}))),u.resolve(this)},t.prototype.fetchTile=function(e,t,r,n){var a=this;void 0===n&&(n={}),null!=n&&"number"==typeof n&&(o.deprecated(x,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),n={noDataValue:n});var s={responseType:"array-buffer",signal:n.signal},l={noDataValue:n.noDataValue,returnFileInfo:!0};return this.load().then((function(){return a._fetchTileAvailability(e,t,r,n)})).then((function(){return i(a.getTileUrl(e,t,r),s)})).then((function(e){return a._lercDecoder.decode(e.data,l,n.signal)})).then((function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}}))},t.prototype.getTileUrl=function(e,t,r){var i=!this.tilemapCache&&this.supportsBlankTile,o=p.objectToQuery(n.__assign(n.__assign({},this.parsedUrl.query),{blankTile:!i&&null}));return this.parsedUrl.path+"/tile/"+e+"/"+t+"/"+r+(o?"?"+o:"")},t.prototype.queryElevation=function(e,t){var r=this;return this._importElevationQuery().then((function(n){return(new n.ElevationQuery).query(r,e,t)}))},t.prototype.createElevationSampler=function(e,t){var r=this;return this._importElevationQuery().then((function(n){return(new n.ElevationQuery).createSampler(r,e,t)}))},t.prototype._fetchTileAvailability=function(e,t,r,n){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,r,n):u.resolve("unknown")},t.prototype._fetchImageService=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r;return n.__generator(this,(function(o){switch(o.label){case 0:return this.sourceJSON?[2,this.sourceJSON]:(t={query:n.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:e},[4,i(this.parsedUrl.path,t)]);case 1:return(r=o.sent()).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=r.data,this.read(r.data,{origin:"service",url:this.parsedUrl}),[2]}}))}))},t.prototype._importElevationQuery=function(){return new Promise((function(e,t){r.e(26).then(function(){var t=[r(1344)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},n.__decorate([d.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),n.__decorate([d.property({readOnly:!0,type:h})],t.prototype,"heightModelInfo",void 0),n.__decorate([d.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),n.__decorate([d.property({type:["show","hide"]})],t.prototype,"listMode",void 0),n.__decorate([d.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"minScale",null),n.__decorate([d.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],t.prototype,"maxScale",null),n.__decorate([d.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"opacity",void 0),n.__decorate([d.property({type:["ArcGISTiledElevationServiceLayer"]})],t.prototype,"operationalLayerType",void 0),n.__decorate([d.property()],t.prototype,"sourceJSON",void 0),n.__decorate([d.property({json:{read:!1},value:"elevation",readOnly:!0})],t.prototype,"type",void 0),n.__decorate([d.property(_.url)],t.prototype,"url",void 0),n.__decorate([d.property()],t.prototype,"version",void 0),n.__decorate([d.reader("version",["currentVersion"])],t.prototype,"readVersion",null),n.__decorate([d.subclass("esri.layers.ElevationLayer")],t)}(v.ArcGISCachedService(m.ArcGISService(y.OperationalLayer(g.PortalLayer(c.MultiOriginJSONMixin(f))))))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingProgressValue={value:.5,readOnly:!0},t.updatingProgress={dependsOn:["updating","updatingProgressValue"],readOnly:!0,value:.5,get:function(){return this.updating?this.updatingProgressValue:1}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(214)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.q=new n,this._last=null}return Object.defineProperty(e.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,configurable:!0}),e.prototype.resetOne=function(e){this.q.clear(),this.q.push(e),this._last=null},e.prototype.reset=function(e){this.q.clear(),e&&this.q.pushArray(e),this._last=null},e.prototype.skipSubtree=function(){this._last=null},e.prototype.next=function(){return this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children),this._last=this.q.pop(),this._last},e}();t.IteratorPreorder=i;var o=function(){function e(){this.q=new n}return Object.defineProperty(e.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){if(this.q.clear(),e){this.q.pushArray(e);for(var t=0;t<this.q.length;++t){var r=this.q.data[t];r.isLeaf||this.q.pushArray(r.children)}}},e.prototype.next=function(){return this.q.pop()},e}();function a(e){return e?e[0]+"/"+e[1]+"/"+e[2]:"null"}function s(e,t){if(t(e),!e.isLeaf)for(var r=0,n=e.children;r<n.length;r++)s(n[r],t)}function l(e,t,r){var n=e.screenDepth,i=t.screenDepth;return n<i?-r:n>i?r:0}t.IteratorPostorder=o,t.lij2str=a,t.tile2str=function(e){return e?a(e.lij):"null"},t.traverseTilesPreorder=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)s(e[r],t);else s(e,t)},t.fallsWithinLayer=function(e,t,n){if(r.isNone(t))return!1;var i=t.fullExtent,o=e.extent;if(n){if(o[0]<i.xmin||o[1]<i.ymin||o[2]>i.xmax||o[3]>i.ymax)return!1}else if(i.xmin>o[2]||i.ymin>o[3]||i.xmax<o[0]||i.ymax<o[1])return!1;var a=e.surface.tilingScheme.levels[e.lij[0]].scale;return!(t.minScale>0&&a>1.00000001*t.minScale||t.maxScale>0&&a<.99999999*t.maxScale)},t.sortTiles=function(e,t){t.sort((function(t,r){return l(t,r,e)}))},t.compareTiles=l,t.computeUpsampleInfo=function(e,t,r){for(var n=1,i=0,o=0;e!==t;)if(n*=.5,i*=.5,o*=.5,1&e.lij[2]&&(i+=.5),0==(1&e.lij[1])&&(o+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,i,o,n)},t.hasVisibleSiblings=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=r.parent;if(n)for(var i=0;i<4;i++){var o=n.children[i];if(o&&o!==r&&o.visible)return!0}}return!1},t.tilesAreRelated=function(e,t){if(!e||!t)return!1;var r=e[0]<t[0],n=r?e:t,i=r?t:e,o=i[0]-n[0];if(0===o)return!1;var a=1<<o;return Math.floor(i[1]/a)===n[1]&&Math.floor(i[2]/a)===n[2]}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){switch(e){case"defaults":return 0;case"service":return 2;case"portal-item":return 3;case"web-scene":return 4;case"web-map":return 5;case"user":return 6}}function n(e){switch(e){case 0:return"defaults";case 2:return"service";case 3:return"portal-item";case 4:return"web-scene";case 5:return"web-map";case 6:return"user"}}Object.defineProperty(t,"__esModule",{value:!0}),t.nameToId=r,t.idToName=n,t.readableNameToId=function(e){return r(e)},t.idToReadableName=function(e){return n(e)},t.writableNameToId=function(e){return r(e)},t.idToWritableName=function(e){return n(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230)],void 0===(i=function(e,t,r){var n=Array.prototype.splice;function i(e){e.length=0}var o=function(){function e(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new r(Array,void 0,i,t,e)}return e.prototype.acquire=function(){return this._pool.acquire()},e.prototype.copy=function(e){var t=this.acquire();return e.unshift(0,0),n.apply(t,e),e.splice(0,2),t},e.prototype.release=function(e){this._pool.release(e)},e.prototype.prune=function(){this._pool.prune(0)},e.acquire=function(){return a.acquire()},e.copy=function(e){return a.copy(e)},e.release=function(e){return a.release(e)},e.prune=function(){a.prune()},e}(),a=new o(100);return o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(761),r(517)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={ar:"ar-u-nu-latn"},o=new r.default,a={};function s(e){var t=e||a;if(!o.has(t)){var r=n.getLocale(),s=i[n.getLocale()]||r;o.set(t,new Intl.NumberFormat(s,e))}return o.get(t)}n.beforeLocaleChange((function(){o=new r.default,a={}})),t.getFormatter=s,t.convertNumberFormatToIntlOptions=function(e){void 0===e&&(e={});var t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t},t.formatNumber=function(e,t){return s(t).format(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.wgs84Radius=6378137,t.wgs84InverseFlattening=298.257223563,t.wgs84Flattening=1/t.wgs84InverseFlattening,t.wgs84PolarRadius=t.wgs84Radius*(1-t.wgs84Flattening),t.wgs84Eccentricity=.0818191908426215}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407)],void 0===(i=function(e,t,r){function n(e,t){return r.extentContainsPoint(e,t)}function i(e,t){var r,n,i,o=e.hasZ&&t.hasZ;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(n=t.ymin,e.ymax<n)return!1}else if(n=e.ymin,t.ymax<n)return!1;if(o&&t.hasZ)if(e.zmin<=t.zmin){if(i=t.zmin,e.zmax<i)return!1}else if(i=e.zmin,t.zmax<i)return!1;return!0}function o(e,t){for(var n=t.points,i=t.hasZ?r.extentContainsCoords3D:r.extentContainsCoords2D,o=0,a=n;o<a.length;o++)if(i(e,a[o]))return!0;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.extentIntersectsPoint=n,t.extentIntersectsExtent=i,t.extentIntersectsMultipoint=o;var a=[0,0],s=[0,0],l=[0,0],c=[0,0],u=[a,s,l,c],p=[[l,a],[a,s],[s,c],[c,l]];function d(e,t){a[0]=e.xmin,a[1]=e.ymax,s[0]=e.xmax,s[1]=e.ymax,l[0]=e.xmin,l[1]=e.ymin,c[0]=e.xmax,c[1]=e.ymin;for(var n=0,i=u;n<i.length;n++){var o=i[n];if(r.polygonContainsCoords(t,o))return!0}for(var d=0,h=t.rings;d<h.length;d++){var f=h[d];if(f.length){var m=f[0];if(r.extentContainsCoords2D(e,m))return!0;for(var y=1;y<f.length;y++){var g=f[y];if(r.extentContainsCoords2D(e,g)||v(m,g,p))return!0;m=g}}}return!1}function h(e,t){a[0]=e.xmin,a[1]=e.ymax,s[0]=e.xmax,s[1]=e.ymax,l[0]=e.xmin,l[1]=e.ymin,c[0]=e.xmax,c[1]=e.ymin;for(var n=t.paths,i=0,o=n;i<o.length;i++){var u=o[i];if(n.length){var d=u[0];if(r.extentContainsCoords2D(e,d))return!0;for(var h=1;h<u.length;h++){var f=u[h];if(r.extentContainsCoords2D(e,f)||v(d,f,p))return!0;d=f}}}return!1}t.extentIntersectsPolygon=d,t.extentIntersectsPolyline=h;var f=[0,0];function v(e,t,r){for(var n=0;n<r.length;n++)if(m(e,t,r[n][0],r[n][1]))return!0;return!1}function m(e,t,r,n,i){var o=e[0],a=e[1],s=t[0],l=t[1],c=r[0],u=r[1],p=n[0]-c,d=o-c,h=s-o,f=n[1]-u,v=a-u,m=l-a,y=f*h-p*m;if(0===y)return!1;var g=(p*v-f*d)/y,_=(h*v-m*d)/y;return g>=0&&g<=1&&_>=0&&_<=1&&(i&&(i[0]=o+g*(s-o),i[1]=a+g*(l-a)),!0)}t.isSelfIntersecting=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],n=0;n<r.length-1;n++)for(var i=r[n],o=r[n+1],a=t+1;a<e.length;a++)for(var s=0;s<e[a].length-1;s++)if(m(i,o,u=e[a][s],p=e[a][s+1],f)&&!(f[0]===i[0]&&f[1]===i[1]||f[0]===u[0]&&f[1]===u[1]||f[0]===o[0]&&f[1]===o[1]||f[0]===p[0]&&f[1]===p[1]))return!0;var l=r.length;if(!(l<=4))for(n=0;n<l-3;n++){var c=l-1;for(0===n&&(c=l-2),i=r[n],o=r[n+1],a=n+2;a<c;a++){var u,p;if(m(i,o,u=r[a],p=r[a+1],f)&&!(f[0]===i[0]&&f[1]===i[1]||f[0]===u[0]&&f[1]===u[1]||f[0]===o[0]&&f[1]===o[1]||f[0]===p[0]&&f[1]===p[1]))return!0}}}return!1},t.segmentIntersects=m,t.getExtentIntersector=function(e){switch(e){case"esriGeometryEnvelope":case"extent":return i;case"esriGeometryMultipoint":case"multipoint":return o;case"esriGeometryPoint":case"point":return n;case"esriGeometryPolygon":case"polygon":return d;case"esriGeometryPolyline":case"polyline":return h;case"mesh":return i}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(337)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.image=null,r.type="button",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})},r.__decorate([n.property()],t.prototype,"image",void 0),i=r.__decorate([n.subclass("esri.support.Action.ActionButton")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(770),r(1135),r(891),r(1136),r(524),r(892),r(784),r(316)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0}),t.ClassBreaksRenderer=r,t.DictionaryRenderer=n,t.DotDensityRenderer=i,t.HeatmapRenderer=o,t.BaseRenderer=a,t.SimpleRenderer=s,t.UniqueValueRenderer=l,t.isRenderer=function(e){return e instanceof a},t.read=c.read,t.write=c.write,t.fromJSON=c.fromJSON,t.rendererTypes={key:"type",base:a,typeMap:{heatmap:o,simple:s,"unique-value":l,"class-breaks":r,"dot-density":i,dictionary:n}},t.webSceneRendererTypes={key:"type",base:a,typeMap:{simple:s,"unique-value":l,"class-breaks":r}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(152),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({color:i.isSome(this.color)?this.color.clone():null})},r.__decorate([o.property(a.colorAndTransparencyProperty)],t.prototype,"color",void 0),n=r.__decorate([o.subclass("esri.symbols.support.Symbol3DMaterial")],t)}(n.JSONSupport);t.Symbol3DMaterial=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(210),r(214),r(229)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_PRIORITY=-3;var o=function(){function e(e,t,r){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._storage.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._storage.maxSize},enumerable:!0,configurable:!0}),e.prototype.resetHitRate=function(){this._hit=this._miss=0},e.prototype.destroy=function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)},e.prototype.put=function(e,t,r,n){void 0===n&&(n=0),this._storage.put(this._namespace+e,t,r,n)},e.prototype.get=function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.pop=function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.updateSize=function(e,t,r){this._storage.updateSize(this._namespace+e,t,r)},e.prototype.clear=function(){this._storage.clear(this._namespace)},e.prototype.clearAll=function(){this._storage.clearAll()},e.prototype.getStats=function(){return this._storage.getStats()},e.prototype.resetStats=function(){this._storage.resetStats()},e}();t.MemCache=o;var a=function(){function e(e){void 0===e&&(e=10485760),this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new n}return e.prototype.register=function(e){this._users.push(e)},e.prototype.deregister=function(e){this._users.removeUnordered(e)},e.prototype.registerRemoveFunc=function(e,t){this._removeFuncs.push([e,t])},e.prototype.deregisterRemoveFunc=function(e){this._removeFuncs=this._removeFuncs.filter((function(t){return t[0]!==e}))},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,r,n,i){var o=this._db.get(e);if(o&&(this._size-=o.size,this._db.delete(e),o.entry!==r&&this._notifyRemoved(e,o.entry)),n>this._maxSize)this._notifyRemoved(e,r);else if(void 0!==r)if(!n||n<0)console.warn("Refusing to cache entry with invalid size "+n);else{var a=1+Math.max(i,t.MIN_PRIORITY)-t.MIN_PRIORITY;this._db.set(e,{entry:r,size:n,lifetime:a,lives:a}),this._size+=n,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")},e.prototype.updateSize=function(e,t,r){var n=this._db.get(e);n&&n.entry===t&&(this._size-=n.size,r>this._maxSize?this._notifyRemoved(e,t):(n.size=r,this._size+=r,this._checkSizeLimit()))},e.prototype.pop=function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss},e.prototype.get=function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss},e.prototype.getStats=function(){var e=this,r={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},n={},o=new Array;this._db.forEach((function(t,r){var a=t.lifetime;o[a]=(o[a]||0)+t.size,e._users.forEach((function(e){var o=e.namespace;if(i.startsWith(r,o)){var a=n[o]||0;n[o]=a+t.size}}))}));var a={};this._users.forEach((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var r=n[t]||0;n[t]=r,a[t]=Math.round(100*e.hitRate)+"%"}else a[t]="0%"}));var s=Object.keys(n);s.forEach((function(t){return n[t]=n[t]/e._size*100})),s.sort((function(e,t){return n[t]-n[e]})),s.forEach((function(e){return r[e]=Math.round(n[e])+"% / "+a[e]}));for(var l=o.length-1;l>=0;--l){var c=o[l];c&&(r["Priority "+(l+t.MIN_PRIORITY-1)]=Math.round(c/this.size*100)+"%")}return r},e.prototype.resetStats=function(){this._hit=this._miss=0,this._users.forEach((function(e){return e.resetHitRate()}))},e.prototype.clear=function(e){var t=this;this._db.forEach((function(r,n){i.startsWith(n,e)&&(t._size-=r.size,t._db.delete(n),t._notifyRemoved(n,r.entry))}))},e.prototype.clearAll=function(){var e=this;this._db.forEach((function(t,r){e._notifyRemoved(r,t.entry)})),this._size=0,this._db.clear()},e.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype._notifyRemoved=function(e,t){this._removeFuncs.forEach((function(r){i.startsWith(e,r[0])&&r[1](t)}))},e.prototype._checkSizeLimit=function(){var e=this;this._size<=this._maxSize||r.someMap(this._db,(function(t,r){return e._db.delete(r),t.lives<=1?(e._size-=t.size,e._notifyRemoved(r,t.entry)):(--t.lives,e._db.set(r,t)),e._size<=.9*e.maxSize}))},e}();t.MemCacheStorage=a}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(118),r(151)],void 0===(i=function(e,t,r,n,i,o,a){var s=new n.default({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"});return function(e){function t(t){var r=e.call(this,t)||this;return r.maxPointCount=void 0,r.maxRecordCount=void 0,r.maxVertexCount=void 0,r.onStatisticField=null,r.outStatisticFieldName=null,r.statisticType=null,r.statisticParameters=null,r}var n;return r.__extends(t,e),n=t,t.prototype.writeStatisticParameters=function(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=o.clone(e))},t.prototype.clone=function(){return new n({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:o.clone(this.statisticParameters)})},r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"maxPointCount",void 0),r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"maxRecordCount",void 0),r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"maxVertexCount",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"outStatisticFieldName",void 0),r.__decorate([a.property({type:String,json:{read:{source:"statisticType",reader:s.read},write:{target:"statisticType",writer:s.write}}})],t.prototype,"statisticType",void 0),r.__decorate([a.property({type:Object})],t.prototype,"statisticParameters",void 0),r.__decorate([a.writer("statisticParameters")],t.prototype,"writeStatisticParameters",null),n=r.__decorate([a.subclass("esri.tasks.support.StatisticDefinition")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.level=0,r.levelValue=null,r.resolution=0,r.scale=0,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})},r.__decorate([i.property({type:o.Integer,json:{write:!0}})],t.prototype,"level",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"levelValue",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"resolution",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"scale",void 0),n=r.__decorate([i.subclass("esri.layers.support.LOD")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(167),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new i,r.root=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add(this.rootCollectionNames.map((function(t){return e.watch("root."+t,(function(){return e.updateCollections()}),!0)}))),this.updateCollections()},t.prototype.destroy=function(){this.root=null,this.refresh(),this._handles.destroy(),this._handles=null},t.prototype.updateCollections=function(){var e=this;this._collections=this.rootCollectionNames.map((function(t){return e.get("root."+t)})).filter((function(e){return null!=e})),this.refresh()},t.prototype.refresh=function(){var e=this,t=this._handles;t.remove("collections"),this.removeAll();for(var r=[],n=[],i=0,o=this._collections;i<o.length;i++){var a=o[i];this._processCollection(r,n,a)}this.push.apply(this,n);for(var s=0,l=r;s<l.length;s++){var c=l[s];t.add(c.on("after-changes",(function(){return e.refresh()})),"collections")}},t.prototype._createNewInstance=function(e){return new n(e)},t.prototype._processCollection=function(e,t,r){var n=this;r&&(e.push(r),r.forEach((function(r){r&&(t.push(r),n._processCollection(e,t,n.getChildrenFunction(r)))})))},r.__decorate([o.property()],t.prototype,"rootCollectionNames",void 0),r.__decorate([o.property()],t.prototype,"root",void 0),r.__decorate([o.property()],t.prototype,"getChildrenFunction",void 0),r.__decorate([o.subclass("esri.core.CollectionFlattener")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(169),r(254),r(155),r(118),r(323),r(489),r(156),r(152),r(153),r(172),r(151),r(273),r(283),r(1141),r(906),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){var b=0,x=p.getLogger("esri.Basemap");return function(e){function t(t){var r=e.call(this,t)||this;r.id=null,r.portalItem=null,r.spatialReference=null,r.thumbnailUrl=null,r.title="Basemap",r.id=Date.now().toString(16)+"-basemap-"+b++,r.baseLayers=new o,r.referenceLayers=new o;var n=function(e){e.parent&&e.parent!==r&&"remove"in e.parent&&e.parent.remove(e),e.parent=r,"elevation"===e.type&&x.error("Layer '"+e.title+", id:"+e.id+"' of type '"+e.type+"' is not supported as a basemap layer and will therefore be ignored.")},i=function(e){e.parent=null};return r.baseLayers.on("after-add",(function(e){return n(e.item)})),r.referenceLayers.on("after-add",(function(e){return n(e.item)})),r.baseLayers.on("after-remove",(function(e){return i(e.item)})),r.referenceLayers.on("after-remove",(function(e){return i(e.item)})),r}var s;return n.__extends(t,e),s=t,t.prototype.initialize=function(){var e=this;this.when().catch((function(t){x.error("#load()","Failed to load basemap (title: '"+e.title+"', id: '"+e.id+"')",t)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)},t.prototype.normalizeCtorArgs=function(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=n.__assign({},e)).resourceInfo),e},Object.defineProperty(t.prototype,"baseLayers",{set:function(e){this._set("baseLayers",a.referenceSetter(e,this._get("baseLayers")))},enumerable:!0,configurable:!0}),t.prototype._writeBaseLayers=function(e,t,r){var i=[];e?(r=n.__assign(n.__assign({},r),{layerContainerType:"basemap"}),this.baseLayers.forEach((function(e){var t=_.getLayerJSON(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);d.isSome(t)&&i.push(t)})),this.referenceLayers.forEach((function(e){var t=_.getLayerJSON(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);d.isSome(t)&&(t.isReference=!0,i.push(t))})),t.baseMapLayers=i):t.baseMapLayers=i},Object.defineProperty(t.prototype,"referenceLayers",{set:function(e){this._set("referenceLayers",a.referenceSetter(e,this._get("referenceLayers")))},enumerable:!0,configurable:!0}),t.prototype.writeTitle=function(e,t){t.title=e||"Basemap"},t.prototype.load=function(e){return this.addResolvingPromise(this._loadFromSource(e)),h.resolve(this)},t.prototype.loadAll=function(){var e=this;return u.loadAll(this,(function(t){t(e.baseLayers,e.referenceLayers)}))},t.prototype.clone=function(){var e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new s({resourceInfo:this.resourceInfo}).set(e)},t.prototype.read=function(t,r){this.resourceInfo||this._set("resourceInfo",{data:t,context:r}),e.prototype.read.call(this,t,r)},t.prototype.write=function(t,r){return t=t||{},r&&r.origin||(r=n.__assign({origin:"web-map"},r)),e.prototype.write.call(this,t,r),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((function(e){var t=l.clone(e);return t.url&&f.isProtocolRelative(t.url)&&(t.url="https:"+t.url),t.templateUrl&&f.isProtocolRelative(t.templateUrl)&&(t.templateUrl="https:"+t.templateUrl),t}))),t},t.prototype._loadFromSource=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,o,a,s,l=this;return n.__generator(this,(function(n){switch(n.label){case 0:return r=(t=this).resourceInfo,i=t.portalItem,h.throwIfAborted(e),o=[],r?(a=r.context?r.context.url:null,o.push(this._loadLayersFromJSON(r.data,a,e)),r.data.id&&!r.data.title&&(s=r.data.id,o.push(g.getBasemapTitle(s).then((function(e){e&&l.read({title:e},r.context)}))))):i&&o.push(this._loadFromItem(i,e)),[4,h.all(o)];case 1:return n.sent(),[2]}}))}))},t.prototype._loadLayersFromJSON=function(e,t,i){return n.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,c,u,p,d;return n.__generator(this,(function(n){switch(n.label){case 0:return o=this.resourceInfo&&this.resourceInfo.context,a=this.portalItem&&this.portalItem.portal||o&&o.portal||null,s=o&&"web-scene"===o.origin?"web-scene":"web-map",[4,new Promise((function(e,t){r.e(24).then(function(){var t=[r(718)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return l=n.sent(),c=[],h.throwIfAborted(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)&&(u={context:{origin:s,url:t,portal:a,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},p=l.populateOperationalLayers(this.baseLayers,e.baseMapLayers.filter((function(e){return!e.isReference})),u),c.push(p),d=l.populateOperationalLayers(this.referenceLayers,e.baseMapLayers.filter((function(e){return e.isReference})),u),c.push(d)),[4,h.eachAlways(c)];case 2:return n.sent(),[2]}}))}))},t.prototype._loadFromItem=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,e.load(t)];case 1:return[4,n.sent().fetchData("json",t)];case 2:return r=n.sent(),i=f.urlToObject(e.itemUrl),this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||m.getDefault(),url:i}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||m.getDefault(),url:i}),[2,this._loadLayersFromJSON(this.resourceInfo.data,i,t)]}}))}))},t.fromId=function(e){var t=g.esriBasemapDefinitions[e];return t?s.fromJSON(t):null},n.__decorate([v.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer:function(e,t,r,n){this._writeBaseLayers(e,t,n)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:o},elevationLayers:{type:o}},writer:function(e,t,r,n){this._writeBaseLayers(e,t,n)}}}}}})],t.prototype,"baseLayers",null),n.__decorate([v.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],t.prototype,"id",void 0),n.__decorate([v.property({type:y})],t.prototype,"portalItem",void 0),n.__decorate([v.property()],t.prototype,"referenceLayers",null),n.__decorate([v.property({readOnly:!0})],t.prototype,"resourceInfo",void 0),n.__decorate([v.property({type:i.SpatialReference})],t.prototype,"spatialReference",void 0),n.__decorate([v.property()],t.prototype,"thumbnailUrl",void 0),n.__decorate([v.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],t.prototype,"title",void 0),n.__decorate([v.writer("title")],t.prototype,"writeTitle",null),s=n.__decorate([v.subclass("esri.Basemap")],t)}(s.JSONSupportMixin(c))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(226),r(169),r(323),r(152)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.load()];case 1:return r.sent(),[2,l(e,t)]}}))}))}function l(e,t){return r.__awaiter(this,void 0,void 0,(function(){var s,l,c,u=this;return r.__generator(this,(function(p){switch(p.label){case 0:return s=[],t(l=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var c=n[r];a.isNone(c)||(Array.isArray(c)?l.apply(void 0,c):i.isCollection(c)?c.forEach((function(e){return l(e)})):o.isLoadable(c)&&s.push(c))}}),c=null,[4,n.map(s,(function(e){return r.__awaiter(u,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,n.result((r=e,"loadAll"in r&&"function"==typeof r.loadAll?e.loadAll():e.load()))];case 1:return!1!==t.sent().ok||c||(c=e),[2]}var r}))}))}))];case 1:if(p.sent(),c)throw c.loadError;return[2,e]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.loadAll=s,t.loadAllChildren=l,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(275),r(282),r(158),r(169),r(487),r(154),r(190),r(236),r(323),r(156),r(152),r(303),r(153),r(231),r(157),r(151),r(184),r(436),r(170),r(178),r(1148),r(1530),r(1531),r(1532),r(1533),r(1535),r(1149),r(1537),r(1539)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I){var R=d.getLogger("esri.views.View");return function(e){function t(t){var r=e.call(this,t)||this;return r._userSpatialReference=null,r._cursor=null,r.allLayerViews=new s({root:r,rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:function(e){return e.layerViews}}),r.animation=null,r.basemapView=null,r.defaultsFromMap=new I({view:r}),r.fatalError=null,r.extent=null,r.graphics=new S.default,r.navigating=!1,r.layerViews=new a,r.padding={left:0,top:0,right:0,bottom:0},r.ready=!1,r.spatialReferenceWarningDelay=1e3,r.timeExtent=null,r.type=null,r.scale=null,r.updating=!1,r.initialExtentRequired=!0,r.renderContext=null,r.input=new M,r.navigation=new E,r.layerViewManager=null,r.refreshManager=null,r.isHeightModelInfoRequired=!1,r.width=null,r.height=null,r.resizing=!1,r.suspended=!1,r.viewEvents=new A.ViewEvents(r),r._isValid=!1,r._readyCycleForced=!1,r.handles.add(r.watch("preconditionsReady",(function(e){e?(r._currentSpatialReference=r.spatialReference,o.views.add(r)):(r._currentSpatialReference=null,o.views.remove(r)),r.notifyChange("spatialReference"),!e&&r.ready?(r.layerViewManager.clear(),r.toolViewManager.detach(),r._teardown()):e&&!r.ready&&(r._startup(),r.toolViewManager.attach())}),!0)),r}var o;return r.__extends(t,e),o=t,t.prototype.initialize=function(){var e,t=this;this.addResolvingPromise(this.validate().then((function(){return t._isValid=!0,y.whenOnce(t,"ready")}))),this.basemapView=new P.BasemapView({view:this}),this.layerViewManager=new T.default({view:this,layerViewImporter:{importLayerView:function(e){return t.importLayerView(e)},hasLayerViewModule:function(e){return t.hasLayerViewModule(e)}}}),this.refreshManager=new O({view:this}),this.toolViewManager=new C({view:this}),this._resetInitialViewPropertiesFromContent(),y.init(this.defaultsFromMap,"isSpatialReferenceDone",(function(r){var n=!!(t.map&&t.map.allLayers.length>0);if(r&&!t.spatialReference&&n||!e){if(r&&!t.spatialReference&&n&&!e){var i=e=v.after(t.spatialReferenceWarningDelay);e.then((function(){i===e&&R.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((function(){}))}}else e=null}),!0)},t.prototype.destroy=function(){this.destroyed||(this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.map=null,this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll())},t.prototype._startup=function(){this._set("ready",!0)},t.prototype._teardown=function(){this._set("ready",!1)},t.prototype.whenReady=function(){return v.resolve()},t.prototype.toMap=function(){return R.error("#toMap()","Not implemented on this instance of View"),null},Object.defineProperty(t.prototype,"heightModelInfo",{get:function(){return this.getDefaultHeightModelInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interacting",{get:function(){return this.navigating},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preconditionsReady",{get:function(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!p.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"map",{set:function(e){e!==this._get("map")&&(p.isLoadable(e)&&e.load().catch((function(){})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&((e=e.clone()).vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e},set:function(e){this._userSpatialReference=e,this._set("spatialReference",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stationary",{get:function(){return!this.animation&&!this.navigating&&!this.resizing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialExtent",{get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{get:function(){var e=this.toolViewManager?this.toolViewManager.cursor:null;return h.isSome(e)?e:this._cursor||"default"},set:function(e){this._cursor=e,this.notifyChange("cursor")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0}),t.prototype.whenLayerView=function(e){return this.layerViewManager.whenLayerView(e)},t.prototype.getDefaultSpatialReference=function(){return this.get("defaultsFromMap.spatialReference")},t.prototype.getDefaultHeightModelInfo=function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null},t.prototype.importLayerView=function(e){throw new l("importLayerView() not implemented")},t.prototype.hasLayerViewModule=function(e){return!1},t.prototype.validate=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.invalidate=function(){this._isValid=!1},t.prototype.isSpatialReferenceSupported=function(e,t,r){return!0},t.prototype.isTileInfoRequired=function(){return!1},t.prototype.when=function(t,r){return this.isResolved()&&!this.ready&&R.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),e.prototype.when.call(this,t,r)},t.prototype.forceReadyCycle=function(){var e=this;this.ready&&(this._readyCycleForced=!0,y.whenFalseOnce(this,"preconditionsReady",(function(){return e._readyCycleForced=!1})))},t.prototype.createTool=function(e,t,r){return this.toolViewManager.createTool(e,t,r)},t.prototype.tryFatalErrorRecovery=function(){this.fatalError=null},t.prototype._resetInitialViewPropertiesFromContent=function(){var e=this;if(this.defaultsFromMap){var t=function(){return e.defaultsFromMap&&e.defaultsFromMap.start()};this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([y.watch(this,"spatialReference",(function(e,r){w.equals(e,r)||t()})),y.watch(this,"initialExtentRequired",t),m.schedule(t)],"defaultsFromMap")}},t.views=new a,r.__decorate([g.aliasOf("toolViewManager.activeTool")],t.prototype,"activeTool",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"allLayerViews",void 0),r.__decorate([g.property()],t.prototype,"animation",void 0),r.__decorate([g.property()],t.prototype,"basemapView",void 0),r.__decorate([g.property()],t.prototype,"defaultsFromMap",void 0),r.__decorate([g.property()],t.prototype,"fatalError",void 0),r.__decorate([g.property({type:_})],t.prototype,"extent",void 0),r.__decorate([g.property(S.graphicsCollectionProperty)],t.prototype,"graphics",void 0),r.__decorate([g.property({readOnly:!0,type:b,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],t.prototype,"heightModelInfo",null),r.__decorate([g.property({readOnly:!0,dependsOn:["navigating"]})],t.prototype,"interacting",null),r.__decorate([g.property({readOnly:!0})],t.prototype,"navigating",void 0),r.__decorate([g.property({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],t.prototype,"preconditionsReady",null),r.__decorate([g.property({type:a,readOnly:!0})],t.prototype,"layerViews",void 0),r.__decorate([g.property({value:null,type:n})],t.prototype,"map",null),r.__decorate([g.property()],t.prototype,"padding",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"ready",void 0),r.__decorate([g.property({type:x,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]})],t.prototype,"spatialReference",null),r.__decorate([g.property()],t.prototype,"spatialReferenceWarningDelay",void 0),r.__decorate([g.property({dependsOn:["animation","navigating","resizing"]})],t.prototype,"stationary",null),r.__decorate([g.property({type:i})],t.prototype,"timeExtent",void 0),r.__decorate([g.aliasOf("toolViewManager.tools")],t.prototype,"tools",void 0),r.__decorate([g.property()],t.prototype,"toolViewManager",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([g.property({type:Number})],t.prototype,"scale",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"initialExtentRequired",void 0),r.__decorate([g.property({readOnly:!0,type:_,dependsOn:["defaultsFromMap.extent"]})],t.prototype,"initialExtent",null),r.__decorate([g.property({dependsOn:["toolViewManager.cursor"]})],t.prototype,"cursor",null),r.__decorate([g.property()],t.prototype,"renderContext",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"input",void 0),r.__decorate([g.property({type:E,nonNullable:!0})],t.prototype,"navigation",void 0),r.__decorate([g.property()],t.prototype,"layerViewManager",void 0),r.__decorate([g.property()],t.prototype,"width",void 0),r.__decorate([g.property()],t.prototype,"height",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"resizing",void 0),r.__decorate([g.property({value:null,dependsOn:["width","height"],readOnly:!0})],t.prototype,"size",null),r.__decorate([g.property({readOnly:!0})],t.prototype,"suspended",void 0),r.__decorate([g.property({readOnly:!0})],t.prototype,"viewEvents",void 0),r.__decorate([g.property()],t.prototype,"_isValid",void 0),r.__decorate([g.property()],t.prototype,"_readyCycleForced",void 0),r.__decorate([g.property()],t.prototype,"_currentSpatialReference",void 0),o=r.__decorate([g.subclass("esri.views.View")],t)}(u.HandleOwnerMixin(c.EventedMixin(f.EsriPromiseMixin(o))))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(200)],void 0===(i=function(e,t,r){function n(e,t){return e/(r.getMetersPerUnitForSR(t)*r.inchesPerMeter*96)}Object.defineProperty(t,"__esModule",{value:!0}),t.getScale=function(e,t){var n=t||e.extent,i=e.width,o=r.getMetersPerUnitForSR(n&&n.spatialReference);return n&&i?n.width/i*o*r.inchesPerMeter*96:0},t.getResolutionForScale=n,t.getScaleForResolution=function(e,t){return e*(r.getMetersPerUnitForSR(t)*r.inchesPerMeter*96)},t.getExtentForScale=function(e,t){var r=e.extent,i=e.width,o=n(t,r.spatialReference);return r.clone().expand(o*i/r.width)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isTiledLayer=function(e){return e&&"base-tile"===e.type||"tile"===e.type||"elevation"===e.type||"imagery-tile"===e.type||"base-elevation"===e.type||"open-street-map"===e.type||"web-tile"===e.type||"wmts"===e.type||"vector-tile"===e.type},t.isBaseLayer=function(e){return e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent.baseLayers.indexOf(e)>-1},t.serializeLayerDefinitions=function(e){var t=/[:;]/,r=[],n=!1;if(e&&(e.forEach((function(e,i){r.push([i,e]),!n&&t.test(e)&&(n=!0)})),r.length>0)){var i=void 0;if(n){var o={};r.forEach((function(e){o[e[0]]=e[1]})),i=JSON.stringify(o)}else{var a=[];r.forEach((function(e){a.push(e[0]+":"+e[1])})),i=a.join(";")}return i}return null},t.serializeTimeOptions=function(e){if(e){var t=[];return e.forEach((function(e,r){t.push('"'+r+'":'+JSON.stringify(e))})),t.length?"{"+t.join(",")+"}":void 0}},t.getLayersForScale=function(e,t){var r=[];if(e>0&&t)for(var n=function(n){if(t[n].parentLayerId>=0&&-1===r.indexOf(t[n].parentLayerId)&&t.some((function(e){return e.id===t[n].parentLayerId})))return"continue";if(t[n].id>=0){var i=!0,o=t[n].maxScale,a=t[n].minScale;(o>0||a>0)&&(o>0&&a>0?i=o<=e&&e<=a:o>0?i=o<=e:a>0&&(i=e<=a)),i&&r.push(t[n].id)}},i=0;i<t.length;i++)n(i);return r},t.areLabelsVisible=function(e){return!0===e.labelsVisible&&null!=e.labelingInfo&&e.labelingInfo.length>0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.requestImage=function(e,t){return n(e,r.__assign({responseType:"image"},t)).then((function(e){return e.data}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RgbaFloatEncoding=function(e){var t=n.glsl(i||(i=r.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT =\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat = 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS = vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0->1 back to 0->255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(189),r(185),r(162),r(160),r(202),r(277),r(262),r(261),r(192),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=p.VertexAttrConstants;t.perVertexElevationAligner=function(e,r,n,i){var o=e.stageObject,a=n.spatialReference;f.spatialReference=a;for(var l=o.geometryRecords,u=l.length,p="absolute-height"!==r.mode,h=0,g=0;g<u;g++){var _=l[g].geometry,x=l[g].getShaderTransformation();m[0]=x[12],m[1]=x[13],m[2]=x[14],_.invalidateBoundingInfo();for(var w=_.data.getVertexAttr(),S=w[d.POSITION],P=S.data,T=w.mapPos.data,O=S.size,C=P.length/O,M=0,A=0,E=!1,I=0,R=0;R<C;R++){f.x=T[A++],f.y=T[A++],f.z=T[A++],y[0]=P[M],y[1]=P[M+1],y[2]=P[M+2];var D=s.evaluateElevationAlignmentAtPoint(f,n,r,i,p?b:null);if(p&&(I+=b.sampledElevation),v[0]=P[M]+m[0],v[1]=P[M+1]+m[1],v[2]=P[M+2]+m[2],i.setAltitude(D,v),P[M]=v[0]-m[0],P[M+1]=v[1]-m[1],P[M+2]=v[2]-m[2],c.TESTS_DISABLE_UPDATE_THRESHOLDS)E=!0;else{var L=t.updateThresholdInMeters/i.unitInMeters;(Math.abs(y[0]-P[M])>=L||Math.abs(y[1]-P[M+1])>=L||Math.abs(y[2]-P[M+2])>=L)&&(E=!0)}M+=O}h+=I/C,E&&o.geometryVertexAttrsUpdated(g)}return h/u},t.perObjectElevationAligner=function(e,n,o,a){var p=e.stageObject,d=n.centerPointInElevationSR,f=0,m=0;if(p.metadata.usesVerticalDistanceToGround)f=s.evaluateElevationAlignmentAtPoint(d,o,n,a,b),l.updateVertexAttributeAuxpos1w(p,b.verticalDistanceToGround),m=b.sampledElevation;else{var y="absolute-height"!==n.mode;f=s.evaluateElevationAlignmentAtPoint(d,o,n,a,y?b:null),y&&(m=b.sampledElevation)}var g=r.mat4.copy(h,p.objectTransformation),x=i.vec3.set(_,g[12],g[13],g[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(v[0]=d.x,v[1]=d.y,v[2]=f,u.computeLinearTransformation(d.spatialReference,v,g,a.spatialReference)&&(p.objectTransformation=g)):a.setAltitudeOfTransformation(f,g);var w=t.updateThresholdInMeters/a.unitInMeters;return(Math.abs(g[12]-x[0])>=w||Math.abs(g[13]-x[1])>=w||Math.abs(g[14]-x[2])>=w)&&(p.objectTransformation=g),m};var h=n.mat4f64.create();t.perLodInstanceElevationAligner=function(e,r,n,o){var a,l=r.centerPointInElevationSR,p=0,d="absolute-height"!==r.mode;a=s.evaluateElevationAlignmentAtPoint(l,n,r,o,d?b:null),d&&(p=b.sampledElevation);var h=e.graphics3DSymbolLayer.lodRenderer.instanceData,f=e.instanceIndex,m=g;h.getGlobalTransform(f,m);var y=i.vec3.set(_,m[12],m[13],m[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(v[0]=l.x,v[1]=l.y,v[2]=a,u.computeLinearTransformation(l.spatialReference,v,m,o.spatialReference)&&h.setGlobalTransform(f,m)):o.setAltitudeOfTransformation(a,m);var x=t.updateThresholdInMeters/o.unitInMeters;return(Math.abs(m[12]-y[0])>=x||Math.abs(m[13]-y[1])>=x||Math.abs(m[14]-y[2])>=x)&&h.setGlobalTransform(f,m),p},t.updateThresholdInMeters=.01,t.iterativeUpdatesEnabled=!0;var f=new a,v=o.vec3f64.create(),m=o.vec3f64.create(),y=o.vec3f64.create(),g=n.mat4f64.create(),_=o.vec3f64.create(),b={verticalDistanceToGround:0,sampledElevation:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(389),r(950),r(175)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){var n=e.fragment,a=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&a&&e.include(i.VertexTextureCoordinates,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n  "],["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(o.glsl(c||(c=r.__makeTemplateObject(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "],["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *= metallicRoughness.b;\n        mrr[1] *= metallicRoughness.g;\n      }"],["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *= metallicRoughness.b;\n        mrr[1] *= metallicRoughness.g;\n      }"]))))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(o.glsl(p||(p=r.__makeTemplateObject(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *= textureLookup(texEmission, params).rgb;\n      }"],["\n      void applyEmission(TextureLookupParameter params) {\n        emission *= textureLookup(texEmission, params).rgb;\n      }"]))))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(o.glsl(d||(d=r.__makeTemplateObject(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *= textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "],["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *= textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):n.code.add(o.glsl(h||(h=r.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n      "],["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),n.code.add(o.glsl(f||(f=r.__makeTemplateObject(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "],["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),a?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      const vec3 mrr = vec3(0.0, 0.6, 0.2);\n      const vec3 emission = vec3(0.0);\n      float occlusion = 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "],["\n      const vec3 mrr = vec3(0.0, 0.6, 0.2);\n      const vec3 emission = vec3(0.0);\n      float occlusion = 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "]))))}var s,l,c,u,p,d,h,f;Object.defineProperty(t,"__esModule",{value:!0}),t.PBRSchematicMRRValues=n.vec3f32.fromValues(0,.6,.2),t.PhysicallyBasedRenderingParameters=a,function(e){e.bindUniforms=function(e,t,r){void 0===r&&(r=!1),r||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}}(a=t.PhysicallyBasedRenderingParameters||(t.PhysicallyBasedRenderingParameters={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1100),r(855)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;for(var o in this.owner=t,this.properties={},this.afterDispatchHandle=null,e){var a=e[o],s=new r.ReentrantObjectPool(a,null,null,2,2);this.properties[o]={pool:s,acquired:[]}}this.afterDispatchHandle=n.afterDispatch((function(){return i.release()}))}return e.prototype.destroy=function(){for(var e in this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.properties){for(var t=this.properties[e],r=0,i=t.acquired;r<i.length;r++){var o=i[r];n.isValueInUse(o)||t.pool.release(o)}t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null},e.prototype.get=function(e){var t=this.owner._get(e),r=this.properties[e],n=r.pool.acquire();for(r.acquired.push(n);n===t;)r.acquired.push(n),n=r.pool.acquire();return n},e.prototype.release=function(){for(var e in this.properties){for(var t=this.properties[e],r=0,i=0,o=t.acquired;i<o.length;i++){var a=o[i];n.isValueInUse(a)?t.acquired[r++]=a:t.pool.release(a)}t.acquired.length=r}},e}();t.PropertiesPool=i,t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.C_INFINITY=Number.POSITIVE_INFINITY,t.C_PI=Math.PI,t.C_2PI=2*t.C_PI,t.C_PI_BY_2=t.C_PI/2,t.C_RAD_TO_256=128/t.C_PI,t.C_256_TO_RAD=t.C_PI/128,t.C_DEG_TO_256=256/360,t.C_DEG_TO_RAD=t.C_PI/180,t.C_SQRT2=1.414213562,t.C_SQRT2_INV=1/t.C_SQRT2;var r=1/Math.LN2;function n(e,t){return(e%=t)>=0?e:e+t}t.positiveMod=n,t.radToByte=function(e){return n(e*t.C_RAD_TO_256,256)},t.degToByte=function(e){return n(e*t.C_DEG_TO_256,256)},t.log2=function(e){return Math.log(e)*r},t.sqr=function(e){return e*e},t.interpolate=function(e,t,r){return e*(1-r)+t*r},t.between=function(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(179),r(614),r(615),r(1091)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=r.getLogger("esri.core.accessorSupport.decorators.property");t.property=function(e){return void 0===e&&(e={}),function(t,r,l){if(t===Function.prototype)throw new Error("Inappropriate use of @property() on a static field: "+t.name+"."+r+". Accessor does not support static properties.");var c=o.getOwnPropertyMetadata(t,r);l&&(l.get||l.set?(c.get=l.get||c.get,c.set=l.set||c.set):"value"in l&&("value"in e&&s.warn('@property() will redefine the value of "'+r+'" on "'+t.constructor.name+'" already defined in the metadata',e),c.value=e.value=l.value)),"readOnly"in e&&(c.readOnly=e.readOnly);var u=e.aliasOf;if(u){var p,d="string"==typeof u?u:u.source,h="string"==typeof u?null:!0===u.overridable;c.dependsOn=[d],c.get=function(){var e=i.default(this,d);if("function"==typeof e){p||(p=d.split(".").slice(0,-1).join("."));var t=i.default(this,p);t&&(e=e.bind(t))}return e},c.readOnly||(c.set=h?function(e){void 0!==e?this._override(r,e):this._clearOverride(r)}:function(e){a.default(this,d,e)})}var f,v,m=e.type,y=e.types;c.cast||(m?c.cast=function(e){var t=0,r=e;if(n.isLongFormType(e))return n.ensureLongFormType(e);for(;Array.isArray(r)&&1===r.length&&"string"!=typeof r[0]&&"number"!=typeof r[0];)r=r[0],t++;var i=r;if(n.isOneOf(i))return 0===t?n.ensureOneOf(i):n.ensureNArrayTyped(n.ensureOneOf(i),t);if(1===t)return n.ensureArray(i);if(t>1)return n.ensureNArray(i,t);var o=e;return o.from?o.from:n.default(o)}(m):y&&(Array.isArray(y)?c.cast=n.ensureArrayTyped(n.ensureOneOfType(y[0])):c.cast=n.ensureOneOfType(y))),e.range&&(c.cast=(f=c.cast,v=e.range,function(e){var t=+f(e);return null!=v.step&&(t=Math.round(t/v.step)*v.step),null!=v.min&&(t=Math.max(v.min,t)),null!=v.max&&(t=Math.min(v.max,t)),t})),o.mergeProperty(c,e)}},t.propertyJSONMeta=function(e,t,r){var n=o.getOwnPropertyMetadata(e,r);n.json||(n.json={});var i=n.json;return void 0!==t&&(i.origins||(i.origins={}),i.origins[t]||(i.origins[t]={}),i=i.origins[t]),i}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n){var i=null,o=1e3;"number"==typeof t?(o=t,n=r):(i=t,o=r);var a,s=0,l=function(){s=0,e.apply(n,a)},c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i&&i.apply(n,e),a=e,o?s||(s=setTimeout(l,o)):l()};return c.remove=function(){s&&(clearTimeout(s),s=0)},c.forceUpdate=function(){s&&(clearTimeout(s),l())},c.hasPendingUpdates=function(){return!!s},c}Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=r,t.default=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(121)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0});var l=void 0,c=void 0,u=null!==(o=null===(i=n.esriConfig)||void 0===i?void 0:i.locale)&&void 0!==o?o:null===(a=n.dojoConfig)||void 0===a?void 0:a.locale;function p(){var e,t;return null!==(t=null!=u?u:null===(e=n.navigator)||void 0===e?void 0:e.language)&&void 0!==t?t:"en"}function d(){return void 0===c&&(c=p()),c}t.getDefaultLocale=p,t.getLocale=d,t.setLocale=function(e){l=e||void 0,m()};var h={he:!0,ar:!0};t.prefersRTL=function(e){void 0===e&&(e=d());var t=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(e),r=null==t?void 0:t[1].toLowerCase();return h[r]||!1};var f=[];t.onLocaleChange=function(e){return f.push(e),{remove:function(){f.splice(f.indexOf(e),1)}}};var v=[];function m(){var e=null!=l?l:p();c!==e&&(c=e,r.__spreadArrays(v).forEach((function(t){t.call(null,e)})),r.__spreadArrays(f).forEach((function(t){t.call(null,e)})))}t.beforeLocaleChange=function(e){return v.push(e),{remove:function(){f.splice(v.indexOf(e),1)}}},null===(s=n.addEventListener)||void 0===s||s.call(n,"languagechange",m)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r}return r.__extends(t,e),r.__decorate([i.property({type:["attachments","custom","fields","media","text"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.popup.content.Content")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(118),r(151),r(763)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=new n.default({richtext:"rich-text",textarea:"text-area",textbox:"text-box"});return function(e){function t(t){var r=e.call(this,t)||this;return r.fieldName=null,r.format=null,r.isEditable=!1,r.label=null,r.stringFieldOption="text-box",r.statisticType=null,r.tooltip=null,r.visible=!0,r}var n;return r.__extends(t,e),n=t,t.prototype.writeStringFieldOption=function(e,t){t.stringFieldOption=l.toJSON(e)},t.prototype.readStringFieldOption=function(e){if(e)return l.fromJSON(e)},t.prototype.clone=function(){return new n({fieldName:this.fieldName,format:this.format?o.clone(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})},r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"fieldName",void 0),r.__decorate([a.property({type:s,json:{write:!0}})],t.prototype,"format",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0,default:!1}})],t.prototype,"isEditable",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([a.property({type:l.apiValues,json:{write:!0,default:"text-box",type:l.jsonValues}})],t.prototype,"stringFieldOption",void 0),r.__decorate([a.writer("stringFieldOption")],t.prototype,"writeStringFieldOption",null),r.__decorate([a.reader("stringFieldOption")],t.prototype,"readStringFieldOption",null),r.__decorate([a.property({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],t.prototype,"statisticType",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"tooltip",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"visible",void 0),n=r.__decorate([a.subclass("esri.popup.FieldInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(337)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.image=null,r.type="toggle",r.value=!1,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})},r.__decorate([n.property()],t.prototype,"image",void 0),r.__decorate([n.property()],t.prototype,"value",void 0),i=r.__decorate([n.subclass("esri.support.Action.ActionToggle")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163)],void 0===(i=function(e,t,r){function n(e){return e&&"upperLeft"===e.originPosition}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,r){return[t,r]},o=function(e,t,r){return[t,r,e[2]]},a=function(e,t,r){return[t,r,e[2],e[3]]};function s(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function l(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function c(e,t,r){for(var n,i,o,a,c=[],u=0;u<r.length;u++){var p=r[u];u>0?(o=s(e,p[0]),a=l(e,p[1]),o===n&&a===i||(c.push(t(p,o-n,a-i)),n=o,i=a)):(n=s(e,p[0]),i=l(e,p[1]),c.push(t(p,n,i)))}return c.length>0?c:null}function u(e,t,r,n){return c(e,r?n?a:o:n?o:i,t)}function p(e,t,r,n){for(var s=[],l=r?n?a:o:n?o:i,u=0;u<t.length;u++){var p=c(e,l,t[u]);p&&p.length>=3&&s.push(p)}return s.length?s:null}function d(e,t,r,n){for(var s=[],l=r?n?a:o:n?o:i,u=0;u<t.length;u++){var p=c(e,l,t[u]);p&&p.length>=2&&s.push(p)}return s.length?s:null}function h(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function f(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function v(e,t,r){var n=new Array(r.length);if(!r.length)return n;var i=e.scale,o=i[0],a=i[1],s=h(e,r[0][0]),l=f(e,r[0][1]);n[0]=t(r[0],s,l);for(var c=1;c<r.length;c++){var u=r[c];s+=u[0]*o,l-=u[1]*a,n[c]=t(u,s,l)}return n}function m(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=v(e,t,r[i]);return n}function y(e,t,r,n){return v(e,r?n?a:o:n?o:i,t)}function g(e,t,r,n){return m(e,r?n?a:o:n?o:i,t)}function _(e,t,r,n){return m(e,r?n?a:o:n?o:i,t)}function b(e,t,r){for(var n=r[0],i=n[0],o=n[1],a=Math.min(i,t[0]),s=Math.min(o,t[1]),l=Math.max(i,t[2]),c=Math.max(o,t[3]),u=1;u<r.length;u++){var p=r[u],d=p[0],h=p[1];i+=d,o+=h,d<0&&(a=Math.min(a,i)),d>0&&(l=Math.max(l,i)),h<0?s=Math.min(s,o):h>0&&(c=Math.max(c,o))}return e[0]=a,e[1]=s,e[2]=l,e[3]=c,e}function x(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)b(e,e,t[r]);return e}function w(e,t,r,n,i){return t.xmin=s(e,r.xmin),t.ymin=l(e,r.ymin),t.xmax=s(e,r.xmax),t.ymax=l(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function S(e,t,r,n,i){return t.points=u(e,r.points,n,i),t}function P(e,t,r,n,i){return t.x=s(e,r.x),t.y=l(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t}function T(e,t,r,n,i){var o=p(e,r.rings,n,i);return o?(t.rings=o,t):null}function O(e,t,r,n,i){var o=d(e,r.paths,n,i);return o?(t.paths=o,t):null}t.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(n(e)?(r=e.translate[0],i=e.translate[1],o=e.scale[0]):(r=e.extent.xmin,i=e.extent.ymax,o=e.tolerance),n(t)?(a=t.translate[0],s=t.translate[1],l=t.scale[0]):(a=t.extent.xmin,s=t.extent.ymax,l=t.tolerance),r===a&&i===s&&o===l);var r,i,o,a,s,l},t.quantizeX=s,t.quantizeY=l,t.quantizeBounds=function(e,t,r){return t[0]=s(e,r[0]),t[3]=l(e,r[1]),t[2]=s(e,r[2]),t[1]=l(e,r[3]),t},t.quantizePoints=u,t.quantizeRings=p,t.quantizePaths=d,t.hydrateX=h,t.hydrateY=f,t.hydrateCoordsArray=v,t.hydrateCoordsArrayArray=m,t.hydrateBounds=function(e,t,r){return r?(t[0]=h(e,r[0]),t[1]=f(e,r[3]),t[2]=h(e,r[2]),t[3]=f(e,r[1]),t):[h(e,t[0]),f(e,t[3]),h(e,t[2]),f(e,t[1])]},t.hydratePoints=y,t.hydratePaths=g,t.hydrateRings=_,t.getQuantizedBoundsCoordsArray=b,t.getQuantizedBoundsCoordsArrayArray=x,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return b(t,t,e)},t.getQuantizedBoundsPaths=function(e){return x([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return x([0,0,0,0],e)},t.quantizeExtent=w,t.quantizeMultipoint=S,t.quantizePoint=P,t.quantizePolygon=T,t.quantizePolyline=O,t.quantizeGeometry=function(e,t){return e&&t?r.isPoint(t)?P(e,{},t,!1,!1):r.isPolyline(t)?O(e,{},t,!1,!1):r.isPolygon(t)?T(e,{},t,!1,!1):r.isMultipoint(t)?S(e,{},t,!1,!1):r.isExtent(t)?w(e,{},t,!1,!1):null:null},t.hydrateExtent=function(e,t,r,n,i){return t.xmin=h(e,r.xmin),t.ymin=f(e,r.ymin),t.xmax=h(e,r.xmax),t.ymax=f(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,n,i){return t.points=y(e,r.points,n,i),t},t.hydratePoint=function(e,t,r,n,i){return t.x=h(e,r.x),t.y=f(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,n,i){return t.rings=_(e,r.rings,n,i),t},t.hydratePolyline=function(e,t,r,n,i){return t.paths=g(e,r.paths,n,i),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(154),r(118),r(151),r(777),r(779),r(431),r(432),r(628),r(882)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){var h=n.ofType({base:null,key:"type",typeMap:{icon:s,object:l,text:u}}),f=n.ofType({base:null,key:"type",typeMap:{icon:s,object:l}});return function(e){function t(t){var r=e.call(this,t)||this;return r.verticalOffset=null,r.callout=null,r.symbolLayers=new h,r.type="point-3d",r}var n;return r.__extends(t,e),n=t,t.prototype.writeSymbolLayers=function(e,t,r,n){var o=e.filter((function(e){return"text"!==e.type}));if(n&&n.messages&&o.length<e.length){var a=e.find((function(e){return"text"===e.type}));n.messages.push(new i("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PointSymbol3D",{symbolLayer:a}))}t[r]=o.map((function(e){return e.write({},n)})).toArray()},t.prototype.supportsCallout=function(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(var e=0,t=this.symbolLayers.items;e<t.length;e++)switch(t[e].type){case"icon":case"text":case"object":continue;default:return!1}return!0},t.prototype.hasVisibleCallout=function(){return p.hasVisibleCallout(this)},t.prototype.hasVisibleVerticalOffset=function(){return p.hasVisibleVerticalOffset(this)},t.prototype.clone=function(){return new n({verticalOffset:o.clone(this.verticalOffset),callout:o.clone(this.callout),styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})},t.fromSimpleMarkerSymbol=function(e){return new n({symbolLayers:[s.fromSimpleMarkerSymbol(e)]})},t.fromPictureMarkerSymbol=function(e){return new n({symbolLayers:[s.fromPictureMarkerSymbol(e)]})},t.fromCIMSymbol=function(e){return new n({symbolLayers:[s.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}})},t.fromTextSymbol=function(e){return new n({symbolLayers:[u.fromTextSymbol(e)]})},r.__decorate([a.property({type:d.default,json:{write:!0}})],t.prototype,"verticalOffset",void 0),r.__decorate([a.property(p.calloutProperty)],t.prototype,"callout",void 0),r.__decorate([a.property({type:h,json:{type:f,origins:{"web-scene":{type:f}}}})],t.prototype,"symbolLayers",void 0),r.__decorate([a.writer("web-scene","symbolLayers")],t.prototype,"writeSymbolLayers",null),r.__decorate([a.enumeration({PointSymbol3D:"point-3d"})],t.prototype,"type",void 0),n=r.__decorate([a.subclass("esri.symbols.PointSymbol3D")],t)}(c)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(154),r(118),r(152),r(151),r(872),r(430),r(777),r(778),r(779),r(431),r(432),r(879)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){var m=n.ofType({base:null,key:"type",typeMap:{extrude:l,fill:c,icon:u,line:p,object:d,text:f,water:v}}),y=n.ofType({base:null,key:"type",typeMap:{extrude:l,fill:c,icon:u,line:p,object:d,water:v}});return function(e){function t(t){var r=e.call(this,t)||this;return r.type="polygon-3d",r}var n;return r.__extends(t,e),n=t,t.prototype.writeSymbolLayers=function(e,t,r,n){var o=e.filter((function(e){return"text"!==e.type}));if(n&&n.messages&&o.length<e.length){var a=e.find((function(e){return"text"===e.type}));n.messages.push(new i("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PolygonSymbol3D",{symbolLayer:a}))}t[r]=o.map((function(e){return e.write({},n)})).toArray()},t.prototype.clone=function(){return new n({styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})},t.fromJSON=function(e){var t=new n;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.getItemAt(0).type&&"line"===t.symbolLayers.getItemAt(1).type){var r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&!1===e.symbolLayers[1].enable||(r.outline={size:i.size,color:a.isSome(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t},t.fromSimpleFillSymbol=function(e){return new n({symbolLayers:[c.fromSimpleFillSymbol(e)]})},r.__decorate([s.property({type:m,json:{type:y}})],t.prototype,"symbolLayers",void 0),r.__decorate([s.writer("web-scene","symbolLayers")],t.prototype,"writeSymbolLayers",null),r.__decorate([s.enumeration({PolygonSymbol3D:"polygon-3d"})],t.prototype,"type",void 0),n=r.__decorate([s.subclass("esri.symbols.PolygonSymbol3D")],t)}(h)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(198),r(151),r(1127)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=new n.default({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary"},{ignoreUnknown:!0});return function(e){function t(t){var r=e.call(this,t)||this;return r.authoringInfo=null,r.type=null,r}return r.__extends(t,e),t.prototype.getRequiredFields=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return this.collectRequiredFields?(t=new Set,[4,this.collectRequiredFields(t,e)]):[2,[]];case 1:return r.sent(),[2,o.valuesOfSet(t).sort()]}}))}))},t.prototype.getSymbol=function(e,t){},t.prototype.getSymbolAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.getSymbols=function(){return[]},t.prototype.getAttributeHash=function(){return JSON.stringify(this)},t.prototype.getMeshHash=function(){return JSON.stringify(this)},r.__decorate([a.property({type:s,json:{write:!0}})],t.prototype,"authoringInfo",void 0),r.__decorate([a.property({type:l.apiValues,readOnly:!0,json:{type:l.jsonValues,read:!1,write:{writer:l.write,ignoreOrigin:!0}}})],t.prototype,"type",void 0),r.__decorate([a.subclass("esri.renderers.Renderer")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(166),r(155),r(118),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=new i.default({upperLeft:"upper-left",lowerLeft:"lower-left"}),c=function(e){function t(t){var r=e.call(this,t)||this;return r.extent=null,r.mode="view",r.originPosition="upper-left",r.tolerance=1,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i(a.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))},r.__decorate([s.property({type:n.Extent,json:{write:!0}})],t.prototype,"extent",void 0),r.__decorate([s.property({type:["view","edit"],json:{write:!0}})],t.prototype,"mode",void 0),r.__decorate([s.property({type:String,json:{read:l.read,write:l.write}})],t.prototype,"originPosition",void 0),r.__decorate([s.property({type:Number,json:{write:!0}})],t.prototype,"tolerance",void 0),i=r.__decorate([s.subclass("esri.tasks.support.QuantizationParameters")],t)}(o.JSONSupport);t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.highlightsSupported=function(e){return e&&"function"==typeof e.highlight},t.occludeesSupported=function(e){return e&&"function"==typeof e.occlude},t.scaleBoundsPredicate=function(e,t,n){return r.isNone(e)||e>n&&(0===t||e<t)},t.extractSafeScaleBounds=function(e){var t=e.minScale,r=e.maxScale;return{minScale:t=t||0,maxScale:r=r||0}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(303),r(153),r(153),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.state="running",r.target=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(o.create((function(t,r){return e._dfd={resolve:t,reject:r}})))},Object.defineProperty(t.prototype,"done",{get:function(){return"finished"===this.state||"stopped"===this.state},enumerable:!0,configurable:!0}),t.prototype.stop=function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new n("ViewAnimation stopped")))},t.prototype.finish=function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())},t.prototype.update=function(e,t){t||(t=a.isPromiseLike(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)},r.__decorate([s.property({readOnly:!0,dependsOn:["state"]})],t.prototype,"done",null),r.__decorate([s.property({readOnly:!0,type:String})],t.prototype,"state",void 0),r.__decorate([s.property()],t.prototype,"target",void 0),r.__decorate([s.subclass("esri.views.ViewAnimation")],t)}(i.EsriPromise);return function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(l||(l={})),l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.eventMatchesPointerAction=function(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}},t.eventMatchesMousePointerAction=function(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(856)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=this;this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=r.before((function(){return t.reset()})),this.grow()}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.items=null},e.prototype.get=function(){return 0===this.itemsPtr&&r((function(){})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]},e.prototype.reset=function(){var e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*i);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0},e.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,i));e++)this.items.push(this.allocator())},e}();t.ObjectStack=n;var i=1024;t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(173),r(238),r(390)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){return e.basemapTerrain&&e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference)||0}function l(e,t,n){if(!e.state.isGlobal)return!1;var i=s(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic.compute(t,n,e.dataExtent,i,h).far,a=o*o;return r.vec3.squaredDistance(t,n)>a}Object.defineProperty(t,"__esModule",{value:!0}),t.eyeWithinExtent=function(e,t,r,n){return e.renderCoordsHelper.fromRenderCoords(t.eye,u,n)&&i.containsPoint(r,u)},t.surfaceElevationBelowEye=function(e,t){return s(e,t.eye)},t.cameraOnContentAlongViewDirection=function(e,t,i,s){var u=e.state.camera.clone();t&&(u.eye=t),i&&(u.center=i),s&&(u.up=s),function(e,t,i){void 0===i&&(i=n.vec3f64.create());var s=c[e.viewingMode];s||((s=new a.Intersector(e.viewingMode)).options.backfacesTerrain=!e.state.isGlobal,s.options.invisibleTerrain=!0,c[e.viewingMode]=s);var u=e.state.isGlobal;return!(!e.sceneIntersectionHelper.intersectRay(t,s,i)||l(e,t.origin,i))||(!(!e.renderCoordsHelper.intersectManifold(t,0,i)||l(e,t.origin,i))||!!u&&function(e,t){var n=r.vec3.dot(e.origin,e.origin)-o.earthRadius*o.earthRadius,i=n>0?Math.sqrt(n)/3:1;return r.vec3.scale(t,e.direction,i/r.vec3.length(e.direction)),r.vec3.add(t,t,e.origin),!0}(t,i))}(e,u.ray,p)||r.vec3.copy(p,u.center);var h=e.state.constraints,f=h.minimumPoiDistance;if(r.vec3.squaredDistance(u.eye,p)<f){var v=h.collision.enabled;r.vec3.copy(d,u.viewForward),r.vec3.scale(d,d,f),v?r.vec3.subtract(u.eye,p,d):r.vec3.add(p,u.eye,d);var m=e.renderCoordsHelper,y=m.getAltitude(u.eye),g=h.collision.elevationMargin;v&&y<g&&(r.vec3.subtract(d,p,u.eye),m.setAltitude(g,u.eye),r.vec3.add(p,u.eye,d))}return u.center=p,u};var c={},u=n.vec3f64.create(),p=n.vec3f64.create(),d=n.vec3f64.create(),h={near:0,far:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}();t.IdGen=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(536)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var r=e.call(this)||this;return r.material=t.material,r.techniqueRep=t.techniqueRep,r.output=t.output,r}return r.__extends(t,e),t.prototype.getTechnique=function(){return this.technique},t.prototype.getPipelineState=function(e,t){return this.getTechnique().pipeline},t.prototype.ensureResources=function(e){return 2},t.prototype.ensureParameters=function(e){},t}(n.AutoDisposable);t.GLMaterial=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDisposableMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDisposed=!1,t}return r.__extends(t,e),t.prototype.dispose=function(){for(var e=this.__proto__.__managedDisposables__||[],t=e.length-1;t>=0;t--){var r=e[t];this[r]&&"function"==typeof this[r].dispose&&this[r].dispose(),this[r]=null}this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t}(e)};var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(t.AutoDisposableMixin((function(){})));t.AutoDisposable=n,t.autoDispose=function(){return function(e,t){e.hasOwnProperty("__managedDisposables__")||(e.__managedDisposables__=e.__managedDisposables__?e.__managedDisposables__.slice():[]),e.__managedDisposables__.push(t)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "],["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?n.glsl(a||(a=r.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):e.vertex.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(n.glsl(u||(u=r.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < VV_COLOR_N; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ","\n    "])),t.vvInstancingEnabled?n.glsl(c||(c=r.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):e.vertex.code.add(n.glsl(p||(p=r.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}var o,a,s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.VisualVariables=i,function(e){function t(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}e.bindUniforms=t,e.bindUniformsWithOpacity=function(e,r){t(e,r),r.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",r.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",r.vvOpacityOpacities))},e.bindUniformsForSymbols=function(e,r){t(e,r),r.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",r.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",r.vvSymbolRotationMatrix))}}(i=t.VisualVariables||(t.VisualVariables={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n,i){var o;if(i===h(e,t,r,n)>0)for(var a=t;a<r;a+=n)o=s(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=s(a,e[a],e[a+1],o);return o&&y(o,o.next)&&(l(o),o=o.next),o}function n(e,t){if(void 0===t&&(t=e),!e)return e;var r,n=e;do{if(r=!1,n.steiner||!y(n,n.next)&&0!==p(n.prev,n,n.next))n=n.next;else{if(l(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function i(e,t,r,s,c,u,p){if(void 0===p&&(p=0),e){!p&&u&&(e=function e(t,r,n,i){for(var o=void 0;o!==t;o=o.next){if(null===(o=o||t).z&&(o.z=m(o.x,o.y,r,n,i)),o.prev.next!==o||o.next.prev!==o)return o.prev.next=o,o.next.prev=o,e(t,r,n,i);o.prevZ=o.prev,o.nextZ=o.next}return t.prevZ.nextZ=null,t.prevZ=null,function(e){for(var t,r=1;;){var n=e,i=void 0;e=null,t=null;for(var o=0;n;){o++,i=n;for(var a=0;a<r&&i;a++)i=i.nextZ;for(var s=r;a>0||s>0&&i;){var l=void 0;0===a?(l=i,i=i.nextZ,s--):0!==s&&i?n.z<=i.z?(l=n,n=n.nextZ,a--):(l=i,i=i.nextZ,s--):(l=n,n=n.nextZ,a--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}n=i}if(t.nextZ=null,r*=2,o<2)return e}}(t)}(e,s,c,u));for(var d=e;e.prev!==e.next;){var h=e.prev,f=e.next;if(u?a(e,s,c,u):o(e))t.push(h.index/r),t.push(e.index/r),t.push(f.index/r),l(e),e=f.next,d=f.next;else if((e=f)===d){p?1===p?i(e=_(e,t,r),t,r,s,c,u,2):2===p&&b(e,t,r,s,c,u):i(n(e),t,r,s,c,u,1);break}}}}function o(e){var t=e.prev,r=e,n=e.next;if(p(t,r,n)>=0)return!1;for(var i=e.next.next,o=i,a=0;i!==e.prev&&(0===a||i!==o);){if(a++,f(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&p(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,o=e,a=e.next;if(p(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=m(s,l,t,r,n),h=m(c,u,t,r,n),v=e.prevZ,y=e.nextZ;v&&v.z>=d&&y&&y.z<=h;){if(v!==e.prev&&v!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&p(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==e.prev&&y!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&p(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=d;){if(v!==e.prev&&v!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&p(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=h;){if(y!==e.prev&&y!==e.next&&f(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&p(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function s(e,t,r,n){var i=new S(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function u(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var l,c=r,u=r.x,p=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&f(o<p?i:a,o,u,p,o<p?a:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&v(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=w(t,e);n(r,r.next)}}function p(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function d(e,t,r,n){return!!(y(e,t)&&y(r,n)||y(e,n)&&y(r,t))||p(e,t,r)>0!=p(e,t,n)>0&&p(r,n,e)>0!=p(r,n,t)>0}function h(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function f(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function v(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function m(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e,t){return e.x===t.x&&e.y===t.y}function g(e,t){return e.x-t.x}function _(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!y(i,o)&&d(i,n,n.next,o)&&v(i,o)&&v(o,i)&&(t.push(i.index/r),t.push(n.index/r),t.push(o.index/r),l(n),l(n.next),n=e=o),n=n.next}while(n!==e);return n}function b(e,t,r,o,a,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.index!==c.index&&x(l,c)){var u=w(l,c);return l=n(l,l.next),u=n(u,u.next),i(l,t,r,o,a,s),void i(u,t,r,o,a,s)}c=c.next}l=l.next}while(l!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&d(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function w(e,t){var r=new S(e.index,e.x,e.y),n=new S(t.index,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}Object.defineProperty(t,"__esModule",{value:!0}),t.earcut=function(e,t,o){var a,s,l,p,d,h=t&&t.length,f=h?t[0]*o:e.length,v=r(e,0,f,o,!0),m=new Array;if(!v||v.next===v.prev)return m;if(h&&(v=function(e,t,i,o){for(var a=new Array,s=0,l=t.length;s<l;s++){var p=r(e,t[s]*o,s<l-1?t[s+1]*o:e.length,o,!1);p===p.next&&(p.steiner=!0),a.push(c(p))}a.sort(g);for(var d=0,h=a;d<h.length;d++)u(h[d],i),i=n(i,i.next);return i}(e,t,v,o)),e.length>80*o){a=l=e[0],s=p=e[1];for(var y=o;y<f;y+=o){var _=e[y],b=e[y+1];a=Math.min(a,_),s=Math.min(s,b),l=Math.max(l,_),p=Math.max(p,b)}d=0!==(d=Math.max(l-a,p-s))?1/d:0}return i(v,m,o,a,s,d),m},t.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(h(e,0,o,r));if(i)for(var s=0,l=t.length;s<l;s++){var c=t[s]*r,u=s<l-1?t[s+1]*r:e.length;a-=Math.abs(h(e,c,u,r))}var p=0;for(s=0;s<n.length;s+=3){var d=n[s]*r,f=n[s+1]*r,v=n[s+2]*r;p+=Math.abs((e[d]-e[v])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[v+1]-e[d+1]))}return 0===a&&0===p?0:Math.abs((p-a)/a)};var S=function(e,t,r){this.index=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(177),r(152),r(171),r(201)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){if(o.isNone(e))return null;var l=o.isSome(e.color)?s.vec4f64.fromArray(n.toUnitRGBA(e.color)):s.vec4f64.fromValues(0,0,0,0),u=a.pt2px(e.size),d=a.pt2px(e.extensionLength);switch(e.type){case"solid":return c(r.__assign({color:l,size:u,extensionLength:d},t));case"sketch":return function(e){return r.__assign(r.__assign(r.__assign({},p),e),{type:"sketch"})}(r.__assign({color:l,size:u,extensionLength:d},t));default:return void i.neverReached(e)}}function c(e){return r.__assign(r.__assign(r.__assign({},u),e),{type:"solid"})}Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t){return l(function(e){return e&&e.enabled&&e.edges||null}(e),t)},t.createMaterialFromEdges=l,t.createSolidEdgeMaterial=c;var u={color:s.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},p={color:s.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(276),r(162),r(160),r(317),r(319),r(591),r(391),r(344),r(373),r(195),r(592),r(249),r(372),r(1231),r(1695),r(217),r(217)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){var b=d.assert,x=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.techniqueConfig=new m.DefaultMaterialTechniqueConfiguration,i.params=f.copyParameters(r,S),i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.instanceBufferLayout=r.instanced?t.getInstanceBufferLayout(i.params):null,i}return r.__extends(t,e),t.prototype.isVisibleInPass=function(e){return 3!==e||this.params.castShadows},t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,n=t.vertexColors,i=t.symbolColors,o=!!r&&r.indexOf("color")>-1,a=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return n&&(o||a||i)?!!s||l:n?s?c:l:o||a||i?!!s||l:s?c:l},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"instanced"===r&&b(e.instanced===t.instanced,"Can not change instanced attributes"),"textureId"===r&&b(t.textureId,"Can only change texture of material that already has a texture"),"vertexColors"===r&&!0===e[r]&&e[r]!==t[r]&&b(t.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),t[r]=e[r];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,0===e&&(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0),this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic),this.techniqueConfig},t.prototype.intersect=function(e,t,r,n,o,a,s){if(null!==this.params.verticalOffset){var l=n.camera;i.vec3.set(R,r[12],r[13],r[14]);var u=null;switch(n.viewingMode){case"global":u=i.vec3.normalize(E,R);break;case"local":u=i.vec3.copy(E,A)}var p=0;if(null!==this.params.verticalOffset){var d=i.vec3.subtract(D,R,l.eye),h=i.vec3.length(d),v=i.vec3.scale(d,d,1/h),m=null;this.params.screenSizePerspective&&(m=i.vec3.dot(u,v)),p+=f.verticalOffsetAtDistance(l,h,this.params.verticalOffset,m,this.params.screenSizePerspective)}i.vec3.scale(u,u,p),i.vec3.transformMat3(I,u,n.transform.inverseRotation),o=i.vec3.subtract(C,o,I),a=i.vec3.subtract(M,a,I)}f.intersectTriangleGeometry(e,t,n,o,a,c.getVerticalOffsetObject3D(n.verticalOffset),s)},t.prototype.getGLMaterial=function(e){if(0===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new w(e)},t.prototype.createRenderer=function(e,t){return new v(e,t,this)},t.prototype.createBufferWriter=function(){return new P(this.vertexBufferLayout,this.instanceBufferLayout)},t.getVertexBufferLayout=function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=a.newLayout().vec3f("position").vec3f("normal");return e.vertexTangents&&r.vec4f("tangent"),t&&r.vec2f("uv0"),e.vertexColors&&r.vec4u8("color"),e.symbolColors&&r.vec4u8("symbolColor"),r},t.getInstanceBufferLayout=function(e){var t=a.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(u.Material),w=function(e){function t(t){var n=this,i=t.material;return(n=e.call(this,r.__assign(r.__assign({},t),i.getParameters()))||this).updateParameters(),n}return r.__extends(t,e),t.prototype.updateParameters=function(){this.selectPipelines(),this.selectSlot();var e=this.material.getParameters();this.updateTexture(e.textureId),this.technique=e.treeRendering?this.techniqueRep.acquireAndReleaseExisting(y.RealisticTreeTechnique,this.material.getTechniqueConfig(this.output),this.technique):this.techniqueRep.acquireAndReleaseExisting(m.DefaultMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.selectSlot=function(){this.slot=this.material.getParameters().transparent?this.material.getParameters().writeDepth?5:8:3},t.prototype.selectPipelines=function(){var e=this.material.getParameters(),t=0===this.output?T(e):null,r=function(r){return _.makePipelineState({blending:t,culling:O(e),depthTest:{func:513},depthWrite:e.writeDepth&&_.defaultDepthWriteParams,colorWrite:_.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null})};this.pipelineState=r(!1),this.occludeePipelineState=r(!0)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.material.getParameters().shadowMappingEnabled&&(this.material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled}),this.updateParameters())},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateOccludeeState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getParameters(),t),this.bindTexture(e,this.technique.program)},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getPipelineState=function(e,t){return t?this.occludeePipelineState:this.pipelineState},t}(l);!function(e){e.COLOR_GAMMA=2.1}(x||(x={}));var S={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:n.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:s.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},P=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,n){h.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n)},e}(),T=function(e){return e.transparent&&g.separateBlendingParams(770,1,771,771)},O=function(e){return function(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSided}(e)&&{face:1===e.cullFace?1028:1029,mode:2305}},C=o.vec3f64.create(),M=o.vec3f64.create(),A=o.vec3f64.fromValues(0,0,1),E=o.vec3f64.create(),I=o.vec3f64.create(),R=o.vec3f64.create(),D=o.vec3f64.create();return x}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(175),r(1232)],void 0===(i=function(e,t,r,n,i,o){var a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DoublePrecision=function(e,t){t.doublePrecisionRequiresObfuscation?e.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = dpPlusFrc(hiA, hiB);\n        vec3 e = dpMinusFrc(t1, hiA);\n        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = dpPlusFrc(hiA, hiB);\n        vec3 e = dpMinusFrc(t1, hiA);\n        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):e.vertex.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = hiA + hiB;\n        vec3 e = t1 - hiA;\n        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = hiA + hiB;\n        vec3 e = t1 - hiA;\n        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))},t.doublePrecisionRequiresObfuscation=function(e){return!!n("force-double-precision-obfuscation")||o.testWebGLDriver(e).doublePrecisionRequiresObfuscation}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(201)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2,t.TRANSPARENT_UNIT=r.vec4f64.ZEROS,t.WHITE_UNIT=r.vec4f64.ONES}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(317),r(195),r(592)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PositionLayout=r.newLayout().vec3f(n.VertexAttrConstants.POSITION),t.PositionUVLayout=r.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec2f(n.VertexAttrConstants.UV0),t.PositionColorLayout=r.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec4u8(n.VertexAttrConstants.COLOR);var o=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[n.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){i.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n)},e}();t.DefaultBufferWriter=o}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(179),r(615)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.prototype.toString;function o(e){var t="__accessorMetadata__"in e?r.ensureType(e):e;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.push(t),"number"==typeof e[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return a.apply(this,e)}}function a(e,t,r,i){n.getOwnPropertyMetadata(e,t).cast=i}function s(e){return function(t,r){n.getOwnPropertyMetadata(t,e).cast=t[r]}}t.cast=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(3!==e.length||"string"!=typeof e[1])return 1===e.length&&"[object Function]"===i.call(e[0])?o(e[0]):1===e.length&&"string"==typeof e[0]?s(e[0]):void 0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(121)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=function(){var e=n.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;var t=function(t){return e[t].toString(16)};return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)};var n=r.crypto||r.msCrypto}.apply(null,n))||(e.exports=i)},function(e,t,r){var n;
/*!
 * PEP v0.4.4-pre | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 */void 0===(n=function(){"use strict";var e=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],t=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function r(r,n){n=n||Object.create(null);var i=document.createEvent("Event");i.initEvent(r,n.bubbles||!1,n.cancelable||!1);for(var o,a=2;a<e.length;a++)i[o=e[a]]=n[o]||t[a];i.buttons=n.buttons||0;var s;return s=n.pressure&&i.buttons?n.pressure:i.buttons?.5:0,i.x=i.clientX,i.y=i.clientY,i.pointerId=n.pointerId||0,i.width=n.width||0,i.height=n.height||0,i.pressure=s,i.tiltX=n.tiltX||0,i.tiltY=n.tiltY||0,i.twist=n.twist||0,i.tangentialPressure=n.tangentialPressure||0,i.pointerType=n.pointerType||"",i.hwTimestamp=n.hwTimestamp||0,i.isPrimary=n.isPrimary||!1,i}var n=window.Map&&window.Map.prototype.forEach?Map:i;function i(){this.array=[],this.size=0}i.prototype={set:function(e,t){if(void 0===t)return this.delete(e);this.has(e)||this.size++,this.array[e]=t},has:function(e){return void 0!==this.array[e]},delete:function(e){this.has(e)&&(delete this.array[e],this.size--)},get:function(e){return this.array[e]},clear:function(){this.array.length=0,this.size=0},forEach:function(e,t){return this.array.forEach((function(r,n){e.call(t,r,n,this)}),this)}};var o=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],a=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],s={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},l="undefined"!=typeof SVGElementInstance,c={pointermap:new n,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(e,t){var r=t,n=r.events;n&&(n.forEach((function(e){r[e]&&(this.eventMap[e]=r[e].bind(r))}),this),this.eventSources[e]=r,this.eventSourceList.push(r))},register:function(e){for(var t,r=this.eventSourceList.length,n=0;n<r&&(t=this.eventSourceList[n]);n++)t.register.call(t,e)},unregister:function(e){for(var t,r=this.eventSourceList.length,n=0;n<r&&(t=this.eventSourceList[n]);n++)t.unregister.call(t,e)},contains:function(e,t){try{return e.contains(t)}catch(e){return!1}},down:function(e){e.bubbles=!0,this.fireEvent("pointerdown",e)},move:function(e){e.bubbles=!0,this.fireEvent("pointermove",e)},up:function(e){e.bubbles=!0,this.fireEvent("pointerup",e)},enter:function(e){e.bubbles=!1,this.fireEvent("pointerenter",e)},leave:function(e){e.bubbles=!1,this.fireEvent("pointerleave",e)},over:function(e){e.bubbles=!0,this.fireEvent("pointerover",e)},out:function(e){e.bubbles=!0,this.fireEvent("pointerout",e)},cancel:function(e){e.bubbles=!0,this.fireEvent("pointercancel",e)},leaveOut:function(e){this.out(e),this.propagate(e,this.leave,!1)},enterOver:function(e){this.over(e),this.propagate(e,this.enter,!0)},eventHandler:function(e){if(!e._handledByPE){var t=e.type,r=this.eventMap&&this.eventMap[t];r&&r(e),e._handledByPE=!0}},listen:function(e,t){t.forEach((function(t){this.addEvent(e,t)}),this)},unlisten:function(e,t){t.forEach((function(t){this.removeEvent(e,t)}),this)},addEvent:function(e,t){e.addEventListener(t,this.boundHandler)},removeEvent:function(e,t){e.removeEventListener(t,this.boundHandler)},makeEvent:function(e,t){this.captureInfo[t.pointerId]&&(t.relatedTarget=null);var n=new r(e,t);return t.preventDefault&&(n.preventDefault=t.preventDefault),n._target=n._target||t.target,n},fireEvent:function(e,t){var r=this.makeEvent(e,t);return this.dispatchEvent(r)},cloneEvent:function(e){for(var t,r=Object.create(null),n=0;n<o.length;n++)r[t=o[n]]=e[t]||a[n],!l||"target"!==t&&"relatedTarget"!==t||r[t]instanceof SVGElementInstance&&(r[t]=r[t].correspondingUseElement);return e.preventDefault&&(r.preventDefault=function(){e.preventDefault()}),r},getTarget:function(e){var t=this.captureInfo[e.pointerId];return t?e._target!==t&&e.type in s?void 0:t:e._target},propagate:function(e,t,r){for(var n=e.target,i=[];null!=n&&n!==document&&!n.contains(e.relatedTarget);)if(i.push(n),!(n=n.parentNode))return;r&&i.reverse(),i.forEach((function(r){e.target=r,t.call(this,e)}),this)},setCapture:function(e,t,n){this.captureInfo[e]&&this.releaseCapture(e,n),this.captureInfo[e]=t,this.implicitRelease=this.releaseCapture.bind(this,e,n),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var i=new r("gotpointercapture");i.pointerId=e,i._target=t,n||this.asyncDispatchEvent(i)},releaseCapture:function(e,t){var n=this.captureInfo[e];if(n){this.captureInfo[e]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var i=new r("lostpointercapture");i.pointerId=e,i._target=n,t||this.asyncDispatchEvent(i)}},dispatchEvent:function(e){var t=this.getTarget(e);if(t)return t.dispatchEvent(e)},asyncDispatchEvent:function(e){requestAnimationFrame(this.dispatchEvent.bind(this,e))}};c.boundHandler=c.eventHandler.bind(c);var u={shadow:function(e){if(e)return e.shadowRoot||e.webkitShadowRoot},canTarget:function(e){return e&&Boolean(e.elementFromPoint)},targetingShadow:function(e){var t=this.shadow(e);if(this.canTarget(t))return t},olderShadow:function(e){var t=e.olderShadowRoot;if(!t){var r=e.querySelector("shadow");r&&(t=r.olderShadowRoot)}return t},allShadows:function(e){for(var t=[],r=this.shadow(e);r;)t.push(r),r=this.olderShadow(r);return t},searchRoot:function(e,t,r){if(e){var n,i,o=e.elementFromPoint(t,r);for(i=this.targetingShadow(o);i;){if(n=i.elementFromPoint(t,r)){var a=this.targetingShadow(n);return this.searchRoot(a,t,r)||n}i=this.olderShadow(i)}return o}},owner:function(e){for(var t=e;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(e){var t=e.clientX,r=e.clientY,n=this.owner(e.target);return n.elementFromPoint(t,r)||(n=document),this.searchRoot(n,t,r)}},p=Array.prototype.forEach.call.bind(Array.prototype.forEach),d=Array.prototype.map.call.bind(Array.prototype.map),h=Array.prototype.slice.call.bind(Array.prototype.slice),f=Array.prototype.filter.call.bind(Array.prototype.filter),v=window.MutationObserver||window.WebKitMutationObserver,m={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function y(e,t,r,n){this.addCallback=e.bind(n),this.removeCallback=t.bind(n),this.changedCallback=r.bind(n),v&&(this.observer=new v(this.mutationWatcher.bind(this)))}function g(e){return"body /shadow-deep/ "+_(e)}function _(e){return'[touch-action="'+e+'"]'}function b(e){return"{ -ms-touch-action: "+e+"; touch-action: "+e+"; }"}y.prototype={watchSubtree:function(e){this.observer&&u.canTarget(e)&&this.observer.observe(e,m)},enableOnSubtree:function(e){this.watchSubtree(e),e===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(e)},installNewSubtree:function(e){p(this.findElements(e),this.addElement,this)},findElements:function(e){return e.querySelectorAll?e.querySelectorAll("[touch-action]"):[]},removeElement:function(e){this.removeCallback(e)},addElement:function(e){this.addCallback(e)},elementChanged:function(e,t){this.changedCallback(e,t)},concatLists:function(e,t){return e.concat(h(t))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(e){return e.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(e){var t=d(e,this.findElements,this);return t.push(f(e,this.isElement)),t.reduce(this.concatLists,[])},mutationWatcher:function(e){e.forEach(this.mutationHandler,this)},mutationHandler:function(e){"childList"===e.type?(this.flattenMutationTree(e.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(e.removedNodes).forEach(this.removeElement,this)):"attributes"===e.type&&this.elementChanged(e.target,e.oldValue)}};var x=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],w="",S=window.PointerEvent||window.MSPointerEvent,P=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,T=c.pointermap,O=[1,4,2,8,16],C=!1;try{C=1===new MouseEvent("test",{buttons:1}).buttons}catch(e){}var M,A={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(e){c.listen(e,this.events)},unregister:function(e){c.unlisten(e,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(e){for(var t,r=this.lastTouches,n=e.clientX,i=e.clientY,o=0,a=r.length;o<a&&(t=r[o]);o++){var s=Math.abs(n-t.x),l=Math.abs(i-t.y);if(s<=25&&l<=25)return!0}},prepareEvent:function(e){var t=c.cloneEvent(e),r=t.preventDefault;return t.preventDefault=function(){e.preventDefault(),r()},t.pointerId=this.POINTER_ID,t.isPrimary=!0,t.pointerType=this.POINTER_TYPE,t},prepareButtonsForMove:function(e,t){var r=T.get(this.POINTER_ID);0!==t.which&&r?e.buttons=r.buttons:e.buttons=0,t.buttons=e.buttons},mousedown:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=T.get(this.POINTER_ID),r=this.prepareEvent(e);C||(r.buttons=O[r.button],t&&(r.buttons|=t.buttons),e.buttons=r.buttons),T.set(this.POINTER_ID,e),t&&0!==t.buttons?c.move(r):c.down(r)}},mousemove:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);C||this.prepareButtonsForMove(t,e),t.button=-1,T.set(this.POINTER_ID,e),c.move(t)}},mouseup:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=T.get(this.POINTER_ID),r=this.prepareEvent(e);if(!C){var n=O[r.button];r.buttons=t?t.buttons&~n:0,e.buttons=r.buttons}T.set(this.POINTER_ID,e),r.buttons&=~O[r.button],0===r.buttons?c.up(r):c.move(r)}},mouseover:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);C||this.prepareButtonsForMove(t,e),t.button=-1,T.set(this.POINTER_ID,e),c.enterOver(t)}},mouseout:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);C||this.prepareButtonsForMove(t,e),t.button=-1,c.leaveOut(t)}},cancel:function(e){var t=this.prepareEvent(e);c.cancel(t),this.deactivateMouse()},deactivateMouse:function(){T.delete(this.POINTER_ID)}},E=c.captureInfo,I=u.findTarget.bind(u),R=u.allShadows.bind(u),D=c.pointermap,L={events:["touchstart","touchmove","touchend","touchcancel"],register:function(e){M.enableOnSubtree(e)},unregister:function(){},elementAdded:function(e){var t=e.getAttribute("touch-action"),r=this.touchActionToScrollType(t);r&&(e._scrollType=r,c.listen(e,this.events),R(e).forEach((function(e){e._scrollType=r,c.listen(e,this.events)}),this))},elementRemoved:function(e){e._scrollType=void 0,c.unlisten(e,this.events),R(e).forEach((function(e){e._scrollType=void 0,c.unlisten(e,this.events)}),this)},elementChanged:function(e,t){var r=e.getAttribute("touch-action"),n=this.touchActionToScrollType(r),i=this.touchActionToScrollType(t);n&&i?(e._scrollType=n,R(e).forEach((function(e){e._scrollType=n}),this)):i?this.elementRemoved(e):n&&this.elementAdded(e)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(e){var t=e,r=this.scrollTypes;return"none"===t?"none":t===r.XSCROLLER?"X":t===r.YSCROLLER?"Y":r.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(e){return this.firstTouch===e.identifier},setPrimaryTouch:function(e){(0===D.size||1===D.size&&D.has(1))&&(this.firstTouch=e.identifier,this.firstXY={X:e.clientX,Y:e.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(e){e.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var e=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(e,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(e){var t=0;return"touchstart"!==e&&"touchmove"!==e||(t=1),t},touchToPointer:function(e){var t=this.currentTouchEvent,r=c.cloneEvent(e),n=r.pointerId=e.identifier+2;r.target=E[n]||I(r),r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount,r.button=0,r.buttons=this.typeToButtons(t.type),r.width=2*(e.radiusX||e.webkitRadiusX||0),r.height=2*(e.radiusY||e.webkitRadiusY||0),r.pressure=e.force||e.webkitForce||.5,r.isPrimary=this.isPrimaryTouch(e),r.pointerType=this.POINTER_TYPE,r.altKey=t.altKey,r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.shiftKey=t.shiftKey;var i=this;return r.preventDefault=function(){i.scrolling=!1,i.firstXY=null,t.preventDefault()},r},processTouches:function(e,t){var r=e.changedTouches;this.currentTouchEvent=e;for(var n,i=0;i<r.length;i++)n=r[i],t.call(this,this.touchToPointer(n))},shouldScroll:function(e){if(this.firstXY){var t,r=e.currentTarget._scrollType;if("none"===r)t=!1;else if("XY"===r)t=!0;else{var n=e.changedTouches[0],i=r,o="Y"===r?"X":"Y";t=Math.abs(n["client"+i]-this.firstXY[i])>=Math.abs(n["client"+o]-this.firstXY[o])}return this.firstXY=null,t}},findTouch:function(e,t){for(var r,n=0,i=e.length;n<i&&(r=e[n]);n++)if(r.identifier===t)return!0},vacuumTouches:function(e){var t=e.touches;if(D.size>=t.length){var r=[];D.forEach((function(e,n){if(1!==n&&!this.findTouch(t,n-2)){var i=e.out;r.push(i)}}),this),r.forEach(this.cancelOut,this)}},touchstart:function(e){this.vacuumTouches(e),this.setPrimaryTouch(e.changedTouches[0]),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(e,this.overDown))},overDown:function(e){D.set(e.pointerId,{target:e.target,out:e,outTarget:e.target}),c.enterOver(e),c.down(e)},touchmove:function(e){this.scrolling||(this.shouldScroll(e)?(this.scrolling=!0,this.touchcancel(e)):(e.preventDefault(),this.processTouches(e,this.moveOverOut)))},moveOverOut:function(e){var t=e,r=D.get(t.pointerId);if(r){var n=r.out,i=r.outTarget;c.move(t),n&&i!==t.target&&(n.relatedTarget=t.target,t.relatedTarget=i,n.target=i,t.target?(c.leaveOut(n),c.enterOver(t)):(t.target=i,t.relatedTarget=null,this.cancelOut(t))),r.out=t,r.outTarget=t.target}},touchend:function(e){this.dedupSynthMouse(e),this.processTouches(e,this.upOut)},upOut:function(e){this.scrolling||(c.up(e),c.leaveOut(e)),this.cleanUpPointer(e)},touchcancel:function(e){this.processTouches(e,this.cancelOut)},cancelOut:function(e){c.cancel(e),c.leaveOut(e),this.cleanUpPointer(e)},cleanUpPointer:function(e){D.delete(e.pointerId),this.removePrimaryPointer(e)},dedupSynthMouse:function(e){var t=A.lastTouches,r=e.changedTouches[0];if(this.isPrimaryTouch(r)){var n={x:r.clientX,y:r.clientY};t.push(n);var i=function(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}.bind(null,t,n);setTimeout(i,2500)}}};M=new y(L.elementAdded,L.elementRemoved,L.elementChanged,L);var j,V,F,N=c.pointermap,k=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,z={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(e){c.listen(e,this.events)},unregister:function(e){c.unlisten(e,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(e){var t=e;return k&&((t=c.cloneEvent(e)).pointerType=this.POINTER_TYPES[e.pointerType]),t},cleanup:function(e){N.delete(e)},MSPointerDown:function(e){N.set(e.pointerId,e);var t=this.prepareEvent(e);c.down(t)},MSPointerMove:function(e){var t=this.prepareEvent(e);c.move(t)},MSPointerUp:function(e){var t=this.prepareEvent(e);c.up(t),this.cleanup(e.pointerId)},MSPointerOut:function(e){var t=this.prepareEvent(e);c.leaveOut(t)},MSPointerOver:function(e){var t=this.prepareEvent(e);c.enterOver(t)},MSPointerCancel:function(e){var t=this.prepareEvent(e);c.cancel(t),this.cleanup(e.pointerId)},MSLostPointerCapture:function(e){var t=c.makeEvent("lostpointercapture",e);c.dispatchEvent(t)},MSGotPointerCapture:function(e){var t=c.makeEvent("gotpointercapture",e);c.dispatchEvent(t)}};function U(e){if(!c.pointermap.has(e)){var t=new Error("NotFoundError");throw t.name="NotFoundError",t}}function B(e){for(var t=e.parentNode;t&&t!==e.ownerDocument;)t=t.parentNode;if(!t){var r=new Error("InvalidStateError");throw r.name="InvalidStateError",r}}function G(e){return 0!==c.pointermap.get(e).buttons}window.navigator.msPointerEnabled?(j=function(e){U(e),B(this),G(e)&&(c.setCapture(e,this,!0),this.msSetPointerCapture(e))},V=function(e){U(e),c.releaseCapture(e,!0),this.msReleasePointerCapture(e)}):(j=function(e){U(e),B(this),G(e)&&c.setCapture(e,this)},V=function(e){U(e),c.releaseCapture(e)}),F=function(e){return!!c.captureInfo[e]};var H=window.PointerEvent||window.MSPointerEvent;return{dispatcher:c,Installer:y,PointerEvent:r,PointerMap:n,targetFinding:u,applyGlobal:function(){!function(){if(S){x.forEach((function(e){String(e)===e?(w+=_(e)+b(e)+"\n",P&&(w+=g(e)+b(e)+"\n")):(w+=e.selectors.map(_)+b(e.rule)+"\n",P&&(w+=e.selectors.map(g)+b(e.rule)+"\n"))}));var e=document.createElement("style");e.textContent=w,document.head.appendChild(e)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=r,window.navigator.msPointerEnabled){var e=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:e,enumerable:!0}),c.registerSource("ms",z)}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),c.registerSource("mouse",A),void 0!==window.ontouchstart&&c.registerSource("touch",L);c.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:j},releasePointerCapture:{value:V},hasPointerCapture:{value:F}})},applyLocal:function(e){H||(window.PointerEvent||(window.navigator.msPointerEnabled?c.registerSource("ms",z):(c.registerSource("mouse",A),void 0!==window.ontouchstart&&c.registerSource("touch",L)),c.register(document)),function(e){window.Element&&!Element.prototype.setPointerCapture&&(e.setPointerCapture=j.bind(e),e.releasePointerCapture=V.bind(e),e.hasPointerCapture=F.bind(e))}(e),e.getAttribute("touch-action")||e.setAttribute("touch-action","none"))}}}.call(null,r,t,e))||(e.exports=n)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(476),r(180),r(164),r(156),r(1426),r(1427)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=o("esri-debug-messages"),u=a.getLogger("esri.widgets.support.widgetUtils");t.classes=function(e){for(var t=n.acquire(),r=0;r<arguments.length;r++){var i=arguments[r],o=typeof i;if("string"===o)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===o)for(var a in i)i[a]&&t.push(a)}var s=t.join(" ");return n.release(t),s},t.isRTL=function(){return"rtl"===document.dir},t.discardNode=function(e){var t=e.getAttribute("data-node-ref");if(c){if(!t)return void u.error("[Widget] node ref not found, did you forget the 'data-node-ref' attribute?");if(!(t in this))return void u.error("[Widget] cannot discard "+t+" if not defined on instance.")}this[t]=null},t.storeNode=function(e){var t=e.getAttribute("data-node-ref");if(c){if(!t)return void u.error("[Widget] node ref not found, did you forget the 'data-node-ref' attribute?");if(!(t in this))return void u.error("[Widget] cannot store "+t+" if not defined on instance.")}this[t]=e},t.cssTransition=function(e,t){return("enter"===e?l.createEnterCssTransition:l.createExitCssTransition)(t)},t.additionalWhiteListedTags=r.__spreadArrays(["h1","h2","h3","h4","h5","h6","sub","sup"],["animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"]);var p=t.additionalWhiteListedTags.reduce((function(e,t){return e[t]=[],e}),{});t.safeAttrs=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],t.renderingSanitizer=new s({whiteList:p,onTagAttr:function(e,r,n){var o=r+'="'+n+'"';if(i.includes(t.safeAttrs,r))return o},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151),r(351)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n.strict()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"}),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({href:this.href,primitive:this.primitive})},r.__decorate([o.property({type:String,json:{read:a.read,write:a.write}})],t.prototype,"href",void 0),r.__decorate([o.enumeration(s)],t.prototype,"primitive",void 0),n=r.__decorate([o.subclass("esri.symbols.support.ObjectSymbol3DLayerResource")],t)}(i.JSONSupport);t.ObjectSymbol3DLayerResource=l,t.defaultPrimitive="sphere",t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1129),r(888),r(630)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.types={key:"type",base:n,typeMap:{algorithmic:r,multipart:i}},t.fromJSON=function(e){return e&&e.type?"algorithmic"===e.type?r.fromJSON(e):"multipart"===e.type?i.fromJSON(e):null:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(156),r(200),r(366),r(434),r(1131)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=n.getLogger("esri.renderers.support.utils"),c={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},u={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function p(e,t,r){var n="";return 0===t?n="< ":t===r&&(n="> "),n+e}function d(e){var t=e.minValue,r=e.maxValue,n=e.isFirstBreak?"":"> ",i="percent-of-total"===e.normalizationType?"%":"";return n+(t=null==t?"":a.format(t))+i+" – "+(r=null==r?"":a.format(r))+i}function h(e,t){return"normalizationField"in e&&e.normalizationField?{type:"normalized-field",field:e.field,normalizationField:e.normalizationField}:"field"in e&&e.field?f(e.field):"valueExpression"in e&&e.valueExpression?{type:"expression",expression:e.valueExpression,title:e.valueExpressionTitle,returnType:t}:null}function f(e){return{type:"field",field:e}}t.meterIn={inches:i.convertUnit(1,"meters","inches"),feet:i.convertUnit(1,"meters","feet"),"us-feet":i.convertUnit(1,"meters","us-feet"),yards:i.convertUnit(1,"meters","yards"),miles:i.convertUnit(1,"meters","miles"),"nautical-miles":i.convertUnit(1,"meters","nautical-miles"),millimeters:i.convertUnit(1,"meters","millimeters"),centimeters:i.convertUnit(1,"meters","centimeters"),decimeters:i.convertUnit(1,"meters","decimeters"),meters:i.convertUnit(1,"meters","meters"),kilometers:i.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/i.lengthToDegrees(1,"meters")},t.timelineDateFormatOptions=o.convertDateFormatToIntlOptions("short-date"),t.createColorStops=function(e){var t=e.values,r=e.colors,n=e.labelIndexes,i=e.isDate,l=e.dateFormatOptions;return t.map((function(e,c){var u=null;if(!n||n.indexOf(c)>-1){var d;(d=i?o.formatDate(e,l):a.format(e))&&(u=p(d,c,t.length-1))}return new s({value:e,color:r[c],label:u})}))},t.updateColorStops=function(e){for(var t=e.stops,r=e.changes,n=e.isDate,i=e.dateFormatOptions,s=t.map((function(e){return e.value})),l=[],c=0,u=r;c<u.length;c++){var d=u[c];l.push(d.index),s[d.index]=d.value}var h=a.round(s,{indexes:l});t.forEach((function(e,r){if(e.value=s[r],null!=e.label){var l,c=null;(l=n?o.formatDate(h[r],i):a.format(h[r]))&&(c=p(l,r,t.length-1)),e.label=c}}))},t.createClassBreakLabel=d,t.setLabelsForClassBreaks=function(e){var t=e.classBreakInfos,r=e.normalizationType,n=[];if(t&&t.length)if("standard-deviation"!==e.classificationMethod)if(e.round){n.push(t[0].minValue);for(var i=0,o=t;i<o.length;i++){var s=o[i];n.push(s.maxValue)}n=a.round(n),t.forEach((function(e,t){e.label=d({minValue:0===t?n[0]:n[t],maxValue:n[t+1],isFirstBreak:0===t,normalizationType:r})}))}else t.forEach((function(e,t){e.label=d({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===t,normalizationType:r})}));else l.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")},t.updateClassBreak=function(e){if("standard-deviation"!==e.classificationMethod){var t=e.classBreaks,r=e.change,n=r.index,i=r.value,o=t.length,a=-1,s=-1;0===n?a=n:n===o?s=n-1:(s=n-1,a=n);var c=e.normalizationType,u=null;a>-1&&a<o&&((u=t[a]).minValue=i,u.label=d({minValue:u.minValue,maxValue:u.maxValue,isFirstBreak:0===a,normalizationType:c})),s>-1&&s<o&&((u=t[s]).maxValue=i,u.label=d({minValue:u.minValue,maxValue:u.maxValue,isFirstBreak:0===s,normalizationType:c}))}else l.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.")},t.calculateDateFormatInterval=function(e){for(var t=e.map((function(e){return new Date(e)})),r=t.length,n=1/0,i=null,o=0;o<r-1;o++){for(var a=t[o],s=[],l=1/0,u=null,p=o+1;p<r;p++){var d=t[p],h=(a.getFullYear()!==d.getFullYear()?"year":a.getMonth()!==d.getMonth()&&"month")||a.getDate()!==d.getDate()&&"day"||a.getHours()!==d.getHours()&&"hour"||a.getMinutes()!==d.getMinutes()&&"minute"||a.getSeconds()!==d.getSeconds()&&"second"||"millisecond",f=c[h];f<l&&(l=f,u=h),s.push(h)}l<n&&(n=l,i=u)}return i},t.createUniqueValueLabel=function(e){var t=e.value,r=e.domain,n=e.fieldInfo,i=e.dateFormatInterval,s=String(t),l=r&&"codedValues"in r&&r.codedValues?r.getName(t):null;return l?s=l:"number"==typeof t&&(s=n&&"date"===n.type?o.formatDate(t,i&&o.convertDateFormatToIntlOptions(u[i])):a.format(t)),s},t.getAttribute=h,t.getAttributes=function(e,t){var n=[];if("class-breaks"===e.type||"heatmap"===e.type)n.push(h(e,"number"));else if("unique-value"===e.type){var i=e.authoringInfo;if(i&&"relationship"===i.type){if(i.field1&&i.field2){var o=i.field1.field,a=i.field2.field,s=i.field1.normalizationField,l=i.field2.normalizationField;n.push(h({field:o,normalizationField:s})),n.push(h({field:a,normalizationField:l}))}}else{var c=e.uniqueValueInfos[0],u=null;if(c&&c.value){var p=typeof e.uniqueValueInfos[0].value;"string"!==p&&"number"!==p||(u=p)}n.push(h(e,u)),[e.field2,e.field3].forEach((function(e){return e&&n.push(f(e))}))}}else"dot-density"===e.type&&e.attributes.forEach((function(e){return n.push(h(e,"number"))}));var d=t?t(e):"visualVariables"in e?e.visualVariables:null;return d&&d.forEach((function(e){return n.push(h(e,"number"))})),r.unique(n.filter(Boolean),(function(e,t){return"field"===e.type&&"field"===t.type?e.field===t.field:"normalized-field"===e.type&&"normalized-field"===t.type?e.field===t.field&&e.normalizationField===t.normalizationField:"expression"===e.type&&"expression"===t.type&&e.expression===t.expression}))}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(579)],void 0===(i=function(e,t,r){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)},t.supportedUnits=((n=Object.keys(r.meterIn)).sort(),n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultColor=[252,146,31,255],t.defaultOutlineColor=[153,153,153,255],t.defaultPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",size:6,color:t.defaultColor,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},t.defaultPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t.defaultColor},t.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},t.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},t.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},t.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},t.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(414),r(286),r(587),r(640)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoView=r,t.TileKey=n,t.TileQueue=i,t.TileStrategy=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230)],void 0===(i=function(e,t,r){return function(){function e(){this.spans=[]}return e.prototype.acquire=function(e){this.lodInfo=e},e.prototype.release=function(){this.lodInfo=null,this.spans.length=0},e.prototype.forEach=function(e,t){var r=this.spans,n=this.lodInfo,i=n.level;if(0!==r.length)for(var o=0,a=r;o<a.length;o++)for(var s=a[o],l=s.row,c=s.colFrom,u=s.colTo,p=c;p<=u;p++)e.call(t,i,l,n.normalizeCol(p),n.getWorldForColumn(p))},e.pool=new r(e),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(198),r(151),r(205),r(1558)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=new Set,c=[],u=new Map,p=[0,0];return function(e){function t(t){var r=e.call(this,t)||this;return r._keyToItem=new Map,r.concurrency=6,r.strategy="scale-first",r.tileInfoView=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.concurrency,r=this.process,n=this.strategy;this._queue=new s.QueueProcessor({concurrency:t,process:function(t,n){var i=e._keyToItem.get(t);return r(i,{signal:n})},peeker:"scale-first"===n?function(t){return e._peekByScaleFirst(t)}:function(t){return e._peekByCenterFirst(t)}})},t.prototype.destroy=function(){this.clear(),this._queue.destroy(),this._queue=null},Object.defineProperty(t.prototype,"length",{get:function(){return this._queue?this._queue.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGoingCount",{get:function(){return this._keyToItem.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.length>0||this.onGoingCount>0},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)},t.prototype.clear=function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")},t.prototype.has=function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)},t.prototype.isOngoing=function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)},t.prototype.pause=function(){this._queue.pause()},t.prototype.push=function(e){var t=this,r=e.key.id;if(this.has(r))return this.get(r);var n=this._queue.push(r),i=function(){t._keyToItem.delete(r),t.notifyChange("updating")};return this._keyToItem.set(r,e),n.then(i,i),this.notifyChange("updating"),n},t.prototype.reset=function(){this._queue.reset(),this.notifyChange("updating")},t.prototype.resume=function(){this._queue.resume()},t.prototype._peekByScaleFirst=function(e){var t=this;if(!this.state)return i.firstOfSet(e);var r=this.tileInfoView,n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;e.forEach((function(e){var r=t._keyToItem.get(e),i=t.tileInfoView.getTileScale(r.key);u.has(i)||(u.set(i,[]),n=Math.max(i,n),o=Math.min(i,o)),u.get(i).push(r.key),l.add(i)}));var a,s,p=this.state.scale;u.has(p)||(s=l,(a=c).length=0,s.forEach((function(e){return a.push(e)})),c.sort(),p=c.reduce((function(e,t){return Math.abs(t-p)<Math.abs(e-p)?t:e}),c[0])),p=Math.min(p,n),p=Math.max(p,o);var d=u.get(p),h=r.getClosestInfoForScale(p),f=h.getColumnForX(this.state.center[0]),v=h.getRowForY(this.state.center[1]);return d.sort((function(e,t){var r=h.denormalizeCol(e.col,e.world),n=h.denormalizeCol(t.col,t.world);return Math.sqrt((f-r)*(f-r)+(v-e.row)*(v-e.row))-Math.sqrt((f-n)*(f-n)+(v-t.row)*(v-t.row))})),l.clear(),u.clear(),d[0].id},t.prototype._peekByCenterFirst=function(e){var t=this;if(!this.state)return i.firstOfSet(e);var r=this.tileInfoView,n=this.state.center,o=Number.POSITIVE_INFINITY,s=null;return e.forEach((function(e){var i=t._keyToItem.get(e);r.getTileCoords(p,i.key);var l=a.vec2.distance(p,n);l<o&&(o=l,s=i.key)})),s.id},r.__decorate([o.property({constructOnly:!0})],t.prototype,"concurrency",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"process",void 0),r.__decorate([o.property()],t.prototype,"state",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"strategy",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([o.subclass("esri.views.2d.tiling.TileQueue")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(159),r(154),r(168),r(200),r(170),r(173),r(237),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=c.webMercator.x2lon,p=c.webMercator.y2lat,d=function(){function e(t){var r=e.checkUnsupported(t);if(r)throw r;this.spatialReference=t.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isWGS84Comparable=c.canProjectToWGS84ComparableLonLat(this.spatialReference),this.origin=[t.origin.x,t.origin.y],this.pixelSize=t.size[0],this.dpi=t.dpi;var n=t.lods.reduce((function(e,t,r){return t.level<e.min&&(e.min=t.level,e.minIndex=r),e.max=Math.max(e.max,t.level),e}),{min:1/0,minIndex:0,max:-1/0}),i=t.lods[n.minIndex],o=Math.pow(2,i.level),a=i.resolution*o,s=i.scale*o;this.levels=new Array(n.max+1);for(var l=0;l<this.levels.length;l++)this.levels[l]={resolution:a,scale:s,tileSize:[a*t.size[0],a*t.size[1]]},a/=2,s/=2}return e.prototype.clone=function(){return new e(this.toTileInfo())},e.prototype.toTileInfo=function(){return new l({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((function(e,t){return{level:t,scale:e.scale,resolution:e.resolution}}))})},e.prototype.getExtent=function(e,t,r,n,o){void 0===n&&(n=s.create());var a=this.levels[e],l=a.tileSize[0],c=a.tileSize[1];return n[0]=this.origin[0]+r*l,n[2]=n[0]+l,n[3]=this.origin[1]-t*c,n[1]=n[3]-c,o&&(this._isWebMercator?(o[0]=u(n[0]),o[1]=p(n[1]),o[2]=u(n[2]),o[3]=p(n[3])):this._isWGS84Comparable&&(o[0]=i.deg2rad(n[0]),o[1]=i.deg2rad(n[1]),o[2]=i.deg2rad(n[2]),o[3]=i.deg2rad(n[3]))),n},e.prototype.getExtentGeometry=function(e,t,n,i){return void 0===i&&(i=new r.Extent),this.getExtent(e,t,n,h),i.spatialReference=this.spatialReference,i.xmin=h[0],i.ymin=h[1],i.xmax=h[2],i.ymax=h[3],i.zmin=void 0,i.zmax=void 0,i},e.prototype.ensureMaxLod=function(e){if(null==e)return!1;for(var t=!1;this.levels.length<=e;){var r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),t=!0}return t},e.prototype.capMaxLod=function(e){this.levels.length>e+1&&(this.levels.length=e+1)},e.prototype.getMaxLod=function(){return this.levels.length-1},e.prototype.scaleAtLevel=function(e){return this.levels[0].scale/Math.pow(2,e)},e.prototype.levelAtScale=function(e){var t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E},e.prototype.resolutionAtLevel=function(e){return this.levels[0].resolution/Math.pow(2,e)},e.prototype.compatibleWith=function(t){if(!(t instanceof e)){if(e.checkUnsupported(t))return!1;t=new e(t)}if(!t.spatialReference.equals(this.spatialReference))return!1;if(t.pixelSize!==this.pixelSize)return!1;var r=Math.min(this.levels.length,t.levels.length)-1,n=this.levels[r].resolution,o=.5*n;return!(!i.floatEqualAbsolute(t.origin[0],this.origin[0],o)||!i.floatEqualAbsolute(t.origin[1],this.origin[1],o))&&(o=.5*n/Math.pow(2,r)/this.pixelSize*12,i.floatEqualAbsolute(n,t.levels[r].resolution,o))},e.prototype.rootTilesInExtent=function(t,r,n){var i=this.levels[0].tileSize;if(0===i[0]||0===i[1])return[];e.computeRowColExtent(t,i,this.origin,h);var o=h[1],a=h[3],s=h[0],l=h[2],c=l-s,u=a-o;if(c*u>n){var p=Math.floor(Math.sqrt(n));u>p&&(a=(o=o+Math.floor(.5*u)-Math.floor(.5*p))+p),c>p&&(l=(s=s+Math.floor(.5*c)-Math.floor(.5*p))+p)}for(var d=[],f=o;f<a;f++)for(var v=s;v<l;v++)d.push([0,f,v]);return r&&(r[0]=this.origin[0]+s*i[0],r[1]=this.origin[1]-a*i[1],r[2]=this.origin[0]+l*i[0],r[3]=this.origin[1]-o*i[1]),d},e.computeRowColExtent=function(e,t,r,n){var i=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+i-r[0])/t[0])),n[2]=Math.max(0,Math.ceil((e[2]-i-r[0])/t[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+i)/t[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-i)/t[1]))},e.isPowerOfTwo=function(e){var t=e.lods,r=t[0].resolution*Math.pow(2,t[0].level);return!t.some((function(e){return!i.floatEqualRelative(e.resolution,r/Math.pow(2,e.level))}))},e.hasGapInLevels=function(e){var t=e.lods.map((function(e){return e.level}));t.sort((function(e,t){return e-t}));for(var r=1;r<t.length;r++)if(t[r]!==t[0]+r)return!0;return!1},e.tileSizeSupported=function(e){var t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512},e.checkUnsupported=function(t){return t?t.lods.length<1?new n("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(t)?e.hasGapInLevels(t)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(t)?null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two","Tiling scheme must be power of two"):new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")},e.fromExtent=function(t,r){var n=t[2]-t[0],i=t[3]-t[1],a=o.getMetersPerUnitForSR(r),s=1.2*Math.max(n,i),c=new e(new l({size:[256,256],origin:{x:t[0]-.5*(s-n),y:t[3]+.5*(s-i)},lods:[{level:0,resolution:s/256,scale:1/(256/96*.0254/(s*a))}],spatialReference:r}));return c.ensureMaxLod(20),c},e.makeWebMercatorAuxiliarySphere=function(t){var r=new e(e.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r},e.makeGCSWithTileSize=function(t,r,n){void 0===r&&(r=256),void 0===n&&(n=16);var i=256/r,o=new e(new l({size:[r,r],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*i,scale:295497598.570834*i}]}));return o.ensureMaxLod(n),o},Object.defineProperty(e.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0}),e.WebMercatorAuxiliarySphereTileInfo=new l({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:a.WebMercator},spatialReference:a.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),e.WebMercatorAuxiliarySphere=e.makeWebMercatorAuxiliarySphere(19),e}(),h=s.create();return d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e}function n(e){var t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return function(n){return n<r?e*n*n:t*n-t+1}}function i(e,t){return function(r){return r<t?t*e(r/t):1-e((1-r)/(1-t))*(1-t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.linear=r,t.inQuad=function(e){return e*e},t.outQuad=function(e){return 1-t.inQuad(1-e)},t.inOutQuad=function(e){return e<.5?t.inQuad(2*e)/2:(t.outQuad(2*(e-.5))+1)/2},t.inCubic=function(e){return e*e*e},t.outCubic=function(e){return 1-t.inCubic(1-e)},t.inOutCubic=function(e){return e<.5?t.inCubic(2*e)/2:(t.outCubic(2*(e-.5))+1)/2},t.inQuart=function(e){return e*e*e*e},t.outQuart=function(e){return 1-t.inQuart(1-e)},t.inOutQuart=function(e){return e<.5?t.inQuart(2*e)/2:(t.outQuart(2*(e-.5))+1)/2},t.inQuint=function(e){return e*e*e*e*e},t.outQuint=function(e){return 1-t.inQuint(1-e)},t.inOutQuint=function(e){return e<.5?t.inQuint(2*e)/2:(t.outQuint(2*(e-.5))+1)/2},t.inSine=function(e){return 1-Math.cos(e*Math.PI/2)},t.outSine=function(e){return 1-t.inSine(1-e)},t.inOutSine=function(e){return e<.5?t.inSine(2*e)/2:(t.outSine(2*(e-.5))+1)/2},t.inExpo=function(e){return Math.pow(2,10*(e-1))},t.outExpo=function(e){return 1-t.inExpo(1-e)},t.inOutExpo=function(e){return e<.5?t.inExpo(2*e)/2:(t.outExpo(2*(e-.5))+1)/2},t.inCirc=function(e){return-(Math.sqrt(1-e*e)-1)},t.outCirc=function(e){return 1-t.inCirc(1-e)},t.inOutCirc=function(e){return e<.5?t.inCirc(2*e)/2:(t.outCirc(2*(e-.5))+1)/2},t.inCoastQuad=i(n(1),1),t.outCoastQuad=i(n(1),0),t.inOutCoastQuad=i(n(1),.5),t.inCoastCubic=i(n(2),1),t.outCoastCubic=i(n(2),0),t.inOutCoastCubic=i(n(2),.5),t.inCoastQuart=i(n(3),1),t.outCoastQuart=i(n(3),0),t.inOutCoastQuart=i(n(3),.5),t.inCoastQuint=i(n(4),1),t.outCoastQuint=i(n(4),0),t.inOutCoastQuint=i(n(4),.5),t.named={linear:r,"in-quad":t.inQuad,"out-quad":t.outQuad,"in-out-quad":t.inOutQuad,"in-coast-quad":t.inCoastQuad,"out-coast-quad":t.outCoastQuad,"in-out-coast-quad":t.inOutCoastQuad,"in-cubic":t.inCubic,"out-cubic":t.outCubic,"in-out-cubic":t.inOutCubic,"in-coast-cubic":t.inCoastCubic,"out-coast-cubic":t.outCoastCubic,"in-out-coast-cubic":t.inOutCoastCubic,"in-quart":t.inQuart,"out-quart":t.outQuart,"in-out-quart":t.inOutQuart,"in-coast-quart":t.inCoastQuart,"out-coast-quart":t.outCoastQuart,"in-out-coast-quart":t.inOutCoastQuart,"in-quint":t.inQuint,"out-quint":t.outQuint,"in-out-quint":t.inOutQuint,"in-coast-quint":t.inCoastQuint,"out-coast-quint":t.outCoastQuint,"in-out-coast-quint":t.inOutCoastQuint,"in-sine":t.inSine,"out-sine":t.outSine,"in-out-sine":t.inOutSine,"in-expo":t.inExpo,"out-expo":t.outExpo,"in-out-expo":t.inOutExpo,"in-circ":t.inCirc,"out-circ":t.outCirc,"in-out-circ":t.inOutCirc}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(799),r(288)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.beginCamera=new o.default,t.currentCamera=new o.default,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.stepController=function(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)},t.prototype.onControllerStart=function(e){this.state=i.State.Running,this.beginCamera.copyFrom(e),this.currentCamera.copyFrom(e)},t.prototype.onControllerEnd=function(e){e.copyViewFrom(this.currentCamera)},r.__decorate([n.subclass("esri.views.3d.state.controllers.InteractiveController")],t)}(i.CameraController);t.InteractiveController=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(801),r(535)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r._textureIDs=new Set,r._textureRepository=t.textureRep,r._textureId=t.textureId,r._initTransparent=!!t.initTextureTransparent,r._texture=r._acquireIfNotUndefined(r._textureId),r._textureNormal=r._acquireIfNotUndefined(t.normalTextureId),r._textureEmissive=r._acquireIfNotUndefined(t.emissiveTextureId),r._textureOcclusion=r._acquireIfNotUndefined(t.occlusionTextureId),r._textureMetallicRoughness=r._acquireIfNotUndefined(t.metallicRoughnessTextureId),r}return r.__extends(t,e),t.prototype.dispose=function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()},t.prototype.updateTexture=function(e){e!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=e,this._texture=this._acquireIfNotUndefined(this._textureId))},t.prototype.bindTexture=function(e,t){n.isSome(this._texture)&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this._texture.glTexture,i.DefaultTextureUnits.DIFFUSE)),n.isSome(this._textureNormal)&&(t.setUniform1i("normalTexture",i.DefaultTextureUnits.NORMAL),e.bindTexture(this._textureNormal.glTexture,i.DefaultTextureUnits.NORMAL)),n.isSome(this._textureEmissive)&&(t.setUniform1i("texEmission",i.DefaultTextureUnits.EMISSION),e.bindTexture(this._textureEmissive.glTexture,i.DefaultTextureUnits.EMISSION)),n.isSome(this._textureOcclusion)&&(t.setUniform1i("texOcclusion",i.DefaultTextureUnits.OCCLUSION),e.bindTexture(this._textureOcclusion.glTexture,i.DefaultTextureUnits.OCCLUSION)),n.isSome(this._textureMetallicRoughness)&&(t.setUniform1i("texMetallicRoughness",i.DefaultTextureUnits.METALLIC_ROUGHNESS),e.bindTexture(this._textureMetallicRoughness.glTexture,i.DefaultTextureUnits.METALLIC_ROUGHNESS))},t.prototype.bindTextureScale=function(e,t){var r=n.isSome(this._texture)&&this._texture.glTexture;r&&r.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",r.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t.prototype._acquireIfNotUndefined=function(e){if(!n.isNone(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)},t.prototype._releaseIfNotUndefined=function(e){void 0!==e&&(this._textureIDs.delete(e),this._textureRepository.release(e))},t}(o.GLMaterial)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(195)],void 0===(i=function(e,t,r,n){function i(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var c=2*e[l];o[n]=t[c],o[n+1]=t[c+1],n+=a}else for(l=0;l<s;++l){c=2*e[l];for(var u=0;u<i;++u)o[n]=t[c],o[n+1]=t[c+1],n+=a}}function o(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var c=3*e[l];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],n+=a}else for(l=0;l<s;++l){c=3*e[l];for(var u=0;u<i;++u)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],n+=a}}function a(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var c=4*e[l];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=a}else for(l=0;l<s;++l){c=4*e[l];for(var u=0;u<i;++u)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=a}}function s(e,t,r,n,i,a){if(r){var s=r,l=n.typedBuffer,c=n.typedBufferStride,u=e.length;if(i*=c,null==a||1===a)for(var p=0;p<u;++p){var d=t[v=3*e[p]],h=t[v+1],f=t[v+2];l[i]=s[0]*d+s[4]*h+s[8]*f+s[12],l[i+1]=s[1]*d+s[5]*h+s[9]*f+s[13],l[i+2]=s[2]*d+s[6]*h+s[10]*f+s[14],i+=c}else for(p=0;p<u;++p){d=t[v=3*e[p]],h=t[v+1],f=t[v+2];for(var v,m=s[0]*d+s[4]*h+s[8]*f+s[12],y=s[1]*d+s[5]*h+s[9]*f+s[13],g=s[2]*d+s[6]*h+s[10]*f+s[14],_=0;_<a;++_)l[i]=m,l[i+1]=y,l[i+2]=g,i+=c}}else o(e,t,n,i,a)}function l(e,t,r,n,i,a){if(r){var s=r,l=n.typedBuffer,c=n.typedBufferStride,u=e.length,p=s[0],d=s[1],h=s[2],f=s[4],v=s[5],m=s[6],y=s[8],g=s[9],_=s[10],b=Math.abs(1-p*p+f*f+y*y)>1e-5||Math.abs(1-d*d+v*v+g*g)>1e-5||Math.abs(1-h*h+m*m+_*_)>1e-5;if(i*=c,null==a||1===a)for(var x=0;x<u;++x){var w=p*(O=t[T=3*e[x]])+f*(C=t[T+1])+y*(M=t[T+2]),S=d*O+v*C+g*M,P=h*O+m*C+_*M;b&&(A=w*w+S*S+P*P)<.999999&&A>1e-6&&(w/=E=Math.sqrt(A),S/=E,P/=E),l[i+0]=w,l[i+1]=S,l[i+2]=P,i+=c}else for(x=0;x<u;++x){var T,O,C,M,A,E,I=p*(O=t[T=3*e[x]])+f*(C=t[T+1])+y*(M=t[T+2]),R=d*O+v*C+g*M,D=h*O+m*C+_*M;b&&(A=I*I+R*R+D*D)<.999999&&A>1e-6&&(I/=E=Math.sqrt(A),R/=E,D/=E);for(var L=0;L<a;++L)l[i+0]=I,l[i+1]=R,l[i+2]=D,i+=c}}else o(e,t,n,i,a)}function c(e,t,r,n,i,o){var a=n.typedBuffer,s=n.typedBufferStride,l=e.length;if(i*=s,null==o||1===o){if(4===r)for(var c=0;c<l;++c){var u=4*e[c];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===r)for(c=0;c<l;++c)u=3*e[c],a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}else if(4===r)for(c=0;c<l;++c){u=4*e[c];for(var p=0;p<o;++p)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=s}else if(3===r)for(c=0;c<l;++c)for(u=3*e[c],p=0;p<o;++p)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=s}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=i,t.writeBufferVec3=o,t.writeBufferVec4=a,t.writeBufferMat3f=function(e,t,r,n){var i=r.typedBuffer,o=r.typedBufferStride,a=e.length;n*=o;for(var s=0;s<a;++s){for(var l=9*e[s],c=0;c<9;++c)i[n+c]=t[l+c];n+=o}},t.writeBufferMat4f=function(e,t,r,n){var i=r.typedBuffer,o=r.typedBufferStride,a=e.length;n*=o;for(var s=0;s<a;++s){for(var l=16*e[s],c=0;c<16;++c)i[n+c]=t[l+c];n+=o}},t.writePosition=s,t.writeNormal=l,t.writeColor=c,t.writeMultipliedColor=function(e,t,r,n,i,o,a){var s=i.typedBuffer,l=i.typedBufferStride,c=e.length;if(o*=l,null==a||1===a){if(4===r)for(var u=0;u<c;++u){var p=4*e[u];s[o]=t[p]*n[0],s[o+1]=t[p+1]*n[1],s[o+2]=t[p+2]*n[2],s[o+3]=t[p+3]*n[3],o+=l}else if(3===r){var d=255*n[3];for(u=0;u<c;++u)p=3*e[u],s[o]=t[p]*n[0],s[o+1]=t[p+1]*n[1],s[o+2]=t[p+2]*n[2],s[o+3]=d,o+=l}}else if(4===r)for(u=0;u<c;++u){p=4*e[u];for(var h=0;h<a;++h)s[o]=t[p]*n[0],s[o+1]=t[p+1]*n[1],s[o+2]=t[p+2]*n[2],s[o+3]=t[p+3]*n[3],o+=l}else if(3===r)for(d=255*n[3],u=0;u<c;++u)for(p=3*e[u],h=0;h<a;++h)s[o]=t[p]*n[0],s[o+1]=t[p+1]*n[1],s[o+2]=t[p+2]*n[2],s[o+3]=d,o+=l},t.writeDefaultAttributes=function(e,t,o,u,p,d){for(var h=0,f=t.fieldNames;h<f.length;h++){var v=f[h],m=e.vertexAttr[v],y=e.indices[v];if(m&&y)switch(v){case n.VertexAttrConstants.POSITION:n.assert(3===m.size);var g=p.getField(v,r.BufferViewVec3f);g&&s(y,m.data,o,g,d);break;case n.VertexAttrConstants.NORMAL:n.assert(3===m.size);var _=p.getField(v,r.BufferViewVec3f);_&&l(y,m.data,u,_,d);break;case n.VertexAttrConstants.UV0:n.assert(2===m.size);var b=p.getField(v,r.BufferViewVec2f);b&&i(y,m.data,b,d);break;case n.VertexAttrConstants.COLOR:n.assert(3===m.size||4===m.size);var x=p.getField(v,r.BufferViewVec4u8);x&&c(y,m.data,m.size,x,d);break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===m.size||4===m.size);var w=p.getField(v,r.BufferViewVec4u8);w&&c(y,m.data,m.size,w,d);break;case n.VertexAttrConstants.TANGENT:n.assert(4===m.size);var S=p.getField(v,r.BufferViewVec4f);S&&a(y,m.data,S,d)}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(152),r(577),r(936),r(195),r(937)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e){for(var t=0,r=0,n=!1,i={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},o=0,a=e;o<a.length;o++){var s=a[o];s&&(t+=s.primitivesPerFeature,r+=s.primitivesPerCoordinate,i.bytesPerFeature+=s.memory.bytesPerFeature,i.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,i.bytesPerCoordinate+=s.memory.bytesPerCoordinate,i.draped.bytesPerFeature+=s.memory.bytesPerFeature,i.draped.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,i.draped.bytesPerCoordinate+=s.memory.bytesPerCoordinate,n=n||s.estimated)}return{primitivesPerFeature:t,primitivesPerCoordinate:r,estimated:n,memory:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},t.defaultSymbolComplexity=function(e){return"web-style"===e.type?t.emptySymbolComplexity:c(e.symbolLayers.toArray().map((function(t){return p(e,t)})))},t.totalSymbolComplexities=c;var u={};function p(e,t){var c=d(e,t);switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:c};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:c}:i.isSome(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,estimated:!1,memory:c}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:c};case"object":if(t.resource&&t.resource.href)return{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:c};var p=t.resource&&t.resource.primitive||o.defaultPrimitive;return r.__assign(r.__assign({},function(e){var t=u[e];if(t)return t;var r=a.primitiveLodResources(e,null,null),n=l.geometriesFromLodLevelResources(r.levels[0]).reduce((function(e,t){return e+t.data.getIndices(s.VertexAttrConstants.POSITION).length/3}),0);return t={primitivesPerFeature:n,primitivesPerCoordinate:0,estimated:!1},u[e]=t,t}(p)),{memory:c});case"path":var h=0,f=0;switch(t.profile){case"circle":h=10;break;case"quad":h=4;break;default:return void n.neverReached(t.profile)}switch(t.join){case"round":f=3;break;case"miter":case"bevel":f=1;break;default:return void n.neverReached(t.join)}var v=2*h,m=h*f*2,y=-2*m-v;switch(t.cap){case"none":break;case"butt":case"square":y+=2*(h-1);break;case"round":y+=2*(2*h*2+h);break;default:return void n.neverReached(t.cap)}return{primitivesPerFeature:y,primitivesPerCoordinate:m+v,estimated:!1,memory:c};case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:c};default:return void n.neverReached(t)}}function d(e,r){var o="point-3d"===e.type;switch(r.type){case"extrude":return r.edges&&r.edges.size>0?t.memoryEstimators.EXTRUDE_EDGES:t.memoryEstimators.EXTRUDE;case"fill":return i.isSome(r.outline)&&r.outline.size>0?t.memoryEstimators.FILL_OUTLINE:t.memoryEstimators.FILL;case"water":return t.memoryEstimators.FILL;case"line":return"round"===r.join?t.memoryEstimators.LINE_ROUND:t.memoryEstimators.LINE_MITER;case"path":switch(r.join){case"round":switch(r.profile){case"circle":return t.memoryEstimators.PATH_ROUND_CIRCLE;case"quad":return t.memoryEstimators.PATH_ROUND_QUAD;default:return void n.neverReached(r.profile)}case"miter":case"bevel":switch(r.profile){case"circle":return t.memoryEstimators.PATH_MITER_CIRCLE;case"quad":return t.memoryEstimators.PATH_MITER_QUAD;default:return void n.neverReached(r.profile)}default:return void n.neverReached(r.join)}case"object":return o?t.memoryEstimators.OBJECT_POINT:t.memoryEstimators.OBJECT_POLYGON;case"icon":case"text":return o?t.memoryEstimators.ICON_POINT:t.memoryEstimators.ICON_POLYGON;default:return void n.neverReached(r)}}t.defaultSymbolLayerComplexity=p,t.defaultSymbolLayerMemoryComplexity=d,t.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexColor=function(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardVertexColor() { vColor = color; }\n    "],["\n      void forwardVertexColor() { vColor = color; }\n    "])))),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }\n    "]))))):e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(483)],void 0===(i=function(e,t,r){return function(){function e(e,t){this._storage=new r.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t){this._storage.put(e,t,1,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.parseColorMixMode=function(e){switch(e){case"multiply":return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4;default:return 1}},t.encodeSymbolColor=function(e,t,l){if(n.isNone(e)||2===t)return l[0]=255,l[1]=255,l[2]=255,void(l[3]=255);var c=r.clamp(Math.round(e[3]*o),0,o),u=0===c||4===t?0:3===t?a:s;l[0]=r.clamp(Math.round(e[0]*i),0,i),l[1]=r.clamp(Math.round(e[1]*i),0,i),l[2]=r.clamp(Math.round(e[2]*i),0,i),l[3]=c+u};var i=255,o=85,a=o,s=2*o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(154),r(121),r(225),r(153),r(172),r(172),r(151),r(184),r(170),r(208),r(902),r(339),r(244),r(240),r(265),r(1781),r(237),r(636),r(1782),r(663),r(1274),r(1784),r(1275)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._spriteSourceMap=new Map,n.currentStyleInfo=null,n.style=null,n.isReference=null,n.operationalLayerType="VectorTileLayer",n.type="vector-tile",n.url=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r.__assign({url:e},t):e},t.prototype.destroy=function(){this._spriteSourceMap.clear()},t.prototype.prefetchResources=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.loadSpriteSource(o.devicePixelRatio||1,e)];case 1:return t.sent(),[2]}}))}))},t.prototype.load=function(e){var t=this,i=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).then((function(){return r.__awaiter(t,void 0,void 0,(function(){var t;return r.__generator(this,(function(i){switch(i.label){case 0:return this.portalItem&&this.portalItem.id?(t=this.portalItem.itemUrl+"/resources/styles/root.json",[4,n(t,r.__assign(r.__assign({},e),{query:{f:"json"}}))]):[2];case 1:return i.sent().data&&this.read({url:t},S.createForItem(this.portalItem)),[2]}}))}))})).then((function(){return t._loadStyle(e)}),(function(){return t._loadStyle(e)}));return this.addResolvingPromise(i),s.resolve(this)},Object.defineProperty(t.prototype,"attributionDataUrl",{get:function(){var e=this.currentStyleInfo,t=e&&e.serviceUrl&&c.urlToObject(e.serviceUrl);return t?this._getDefaultAttribution(t.path):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){var e=this._getPrimarySource();return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullExtent",{get:function(){var e=this._getPrimarySource();return e?e.fullExtent:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedUrl",{get:function(){return this.serviceUrl?l.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0}),t.prototype.writeStyleUrl=function(e,t){e&&c.isProtocolRelative(e)&&(e="https:"+e),t.styleUrl=e},Object.defineProperty(t.prototype,"tileIndexType",{get:function(){var e=this._getPrimarySource();return e?e.type:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileIndexUrl",{get:function(){var e=this._getPrimarySource();return e?e.tileMapURL:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileInfo",{get:function(){var e=[];for(var t in this.sourceNameToSource)e.push(this.sourceNameToSource[t]);var r=this._getPrimarySource().tileInfo;if(e.length>1)for(var n=0;n<e.length;n++)T.areSchemasOverlapping(r,e[n].tileInfo)&&(r=T.unionTileInfos(r,e[n].tileInfo));return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tilemapCache",{get:function(){var e=this._getPrimarySource();return e&&e.capabilities.operations.supportsTileMap?e.tilemapCache:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileServers",{get:function(){var e=this._getPrimarySource();return e?e.tileServers:[]},enumerable:!0,configurable:!0}),t.prototype.readVersion=function(e,t){return t.version?parseFloat(t.version):parseFloat(t.currentVersion)},Object.defineProperty(t.prototype,"compatibleTileInfo256",{get:function(){return P.create256x256CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"compatibleTileInfo512",{get:function(){return P.create512x512CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0}),t.prototype.loadSpriteSource=function(e,t){return void 0===e&&(e=1),r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){return this._spriteSourceMap.has(e)||(n=new _.default(this.styleRepository.sprite,e),this._spriteSourceMap.set(e,n.load())),i=this._spriteSourceMap.get(e),[2,s.create((function(e,r){i.then(e,r),s.onAbortOrThrow(t,r)}))]}))}))},t.prototype.loadStyle=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a=this;return r.__generator(this,(function(r){return n=e||this.style||this.url,this._loadingPromise&&"string"==typeof n&&this.url===n&&!s.isAborted(this._abortController)||((i=this._abortController)&&i.abort(),o=s.createAbortController(),this._loadingPromise=s.create((function(e,r){var i={signal:o.signal};a._spriteSourceMap.clear(),a._getSourceAndStyle(n,i).then(e,r),s.onAbort(t,(function(){o.abort()}))})),this._abortController=o),[2,this._loadingPromise]}))}))},t.prototype.getStyleLayerId=function(e){return this.styleRepository.getStyleLayerId(e)},t.prototype.getPaintProperties=function(e){return this.styleRepository.getPaintProperties(e)},t.prototype.setPaintProperties=function(e,t){var r=this.styleRepository.isPainterDataDriven(e),n=this.styleRepository.setPaintProperties(e,t),i=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:n,paint:t}),(r||i)&&this.emit("layout-change",{layer:n,layout:this.styleRepository.getLayoutProperties(e)})},t.prototype.getLayoutProperties=function(e){return this.styleRepository.getLayoutProperties(e)},t.prototype.setLayoutProperties=function(e,t){var r=this.styleRepository.setLayoutProperties(e,t);this.emit("layout-change",{layer:r,layout:t})},t.prototype.getTileUrl=function(e,t,r){var n=this.tileServers[t%this.tileServers.length];return n.replace(/\{z\}/gi,e.toString()).replace(/\{y\}/gi,t.toString()).replace(/\{x\}/gi,r.toString())},t.prototype.write=function(t,r){return r&&r.origin&&!this.styleUrl?(r.messages&&r.messages.push(new i("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):e.prototype.write.call(this,t,r)},t.prototype._getSourceAndStyle=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:if(!e)throw new Error("invalid style!");return[4,w.loadMetadata(e,t)];case 1:return n=r.sent(),this._set("currentStyleInfo",{serviceUrl:n.serviceUrl,styleUrl:n.styleUrl,spriteUrl:n.spriteUrl,glyphsUrl:n.glyphsUrl,style:n.style,layerDefinition:n.layerDefinition}),"string"==typeof e?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",n.sourceNameToSource),this._set("primarySourceName",n.primarySourceName),this._set("styleRepository",new O(n.style,n)),this.read(n.layerDefinition,{origin:"service"}),[2]}}))}))},t.prototype._getDefaultAttribution=function(e){var t=e.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(t){var r=t[3]&&t[3].toLowerCase();if(r)for(var n=t[2]||"",i=0,o=["OpenStreetMap_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84"];i<o.length;i++){var a=o[i];if(a.toLowerCase().indexOf(r)>-1)return c.normalize("//static.arcgis.com/attribution/Vector"+n+"/"+a)}}},t.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null},t.prototype._loadStyle=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,e)]}))}))},r.__decorate([u.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],t.prototype,"attributionDataUrl",null),r.__decorate([u.property({type:["show","hide"]})],t.prototype,"listMode",void 0),r.__decorate([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"capabilities",null),r.__decorate([u.property({readOnly:!0})],t.prototype,"currentStyleInfo",void 0),r.__decorate([u.property({json:{read:!1},readOnly:!0,type:p,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"fullExtent",null),r.__decorate([u.property()],t.prototype,"style",void 0),r.__decorate([u.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],t.prototype,"isReference",void 0),r.__decorate([u.property({type:["VectorTileLayer"]})],t.prototype,"operationalLayerType",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["serviceUrl"]})],t.prototype,"parsedUrl",null),r.__decorate([u.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],t.prototype,"serviceUrl",null),r.__decorate([u.property({type:d,dependsOn:["tileInfo"],readOnly:!0})],t.prototype,"spatialReference",null),r.__decorate([u.property({readOnly:!0})],t.prototype,"styleRepository",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"sourceNameToSource",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"primarySourceName",void 0),r.__decorate([u.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],t.prototype,"styleUrl",null),r.__decorate([u.writer(["portal-item","web-document"],"styleUrl")],t.prototype,"writeStyleUrl",null),r.__decorate([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"tileIndexType",null),r.__decorate([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"tileIndexUrl",null),r.__decorate([u.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:b,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"tileInfo",null),r.__decorate([u.property({json:{read:!1},readOnly:!0,type:x.TilemapCache,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"tilemapCache",null),r.__decorate([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],t.prototype,"tileServers",null),r.__decorate([u.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],t.prototype,"type",void 0),r.__decorate([u.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],t.prototype,"url",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"version",void 0),r.__decorate([u.reader("version",["version","currentVersion"])],t.prototype,"readVersion",null),r.__decorate([u.property({readOnly:!0,dependsOn:["tileInfo"]})],t.prototype,"compatibleTileInfo256",null),r.__decorate([u.property({readOnly:!0,dependsOn:["tileInfo"]})],t.prototype,"compatibleTileInfo512",null),r.__decorate([u.subclass("esri.layers.VectorTileLayer")],t)}(g.ScaleRangeLayer(f.ArcGISCachedService(v.ArcGISService(m.OperationalLayer(y.PortalLayer(a.MultiOriginJSONMixin(h)))))))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(272),r(413),r(599),r(286)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,r,n,i){void 0===i&&(i=n);var a=e.call(this)||this;return a.transforms={dvs:o.mat3f32.create(),tileMat3:o.mat3f32.create()},a.triangleCount=0,a.key=s.pool.acquire(t),a.bounds=r,a.size=n,a.coordRange=i,a}return r.__extends(t,e),t.prototype.destroy=function(){s.pool.release(this.key),this.key=null,this.texture&&(this.texture.dispose(),this.texture=null)},Object.defineProperty(t.prototype,"coords",{get:function(){return this._coords},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e},enumerable:!0,configurable:!0}),t.prototype.setTransform=function(e,t){n("esri-2d-debug")&&null==t&&console.debug("Tried to set tile transform but lod resolution was null");var r=t/(e.resolution*e.pixelRatio),o=this.transforms.tileMat3,a=e.toScreenNoRotation([0,0],this.coords),s=a[0],l=a[1],c=this.size[0]/this.coordRange[0]*r,u=this.size[1]/this.coordRange[1]*r;i.mat3.set(o,c,0,0,0,u,0,s,l,1),i.mat3.multiply(this.transforms.dvs,e.displayViewMat3,o)},t}(a.DisplayObject);t.TiledDisplayObject=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._clips=null,t._isReady=!1,t._opacity=1,t._stage=null,t._visible=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"clips",{get:function(){return this._clips},set:function(e){this._clips=e,this.requestRender()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this._isReady},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=e,this.requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},set:function(e){if(this._stage!==e){var t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())},enumerable:!0,configurable:!0}),t.prototype.setTransform=function(e){},t.prototype.processRender=function(e){this.visible&&this.stage&&this.doRender(e)},t.prototype.requestRender=function(){this.stage&&this.stage.requestRender()},t.prototype.processDetach=function(){this.onDetach(),this.emit("detach")},t.prototype.onAttach=function(){},t.prototype.onDetach=function(){},t.prototype.doRender=function(e){},t.prototype.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())},t}(n);t.DisplayObject=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1832)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quatf32=r}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(322)],void 0===(i=function(e,t,r){function n(e,t,n){var i="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=n.getItemAt||Array.isArray(n)){var o=parseInt(i,10);if(!isNaN(o))return Array.isArray(n)?n[o]:n.getItemAt(o)}var a=r.getProperties(n);return t?r.isPropertyDeclared(a,i)?a.get(i):n[i]:r.isPropertyDeclared(a,i)?a.internalGet(i):n[i]}function i(e,t,i,o){return void 0===i&&(i=!1),void 0===o&&(o=0),"string"==typeof t&&-1===t.indexOf(".")?n(t,i,e):function e(t,r,i,o){if(null==t)return t;var a=n(r[o],i,t);return!a&&o<r.length-1?void 0:o===r.length-1?a:e(a,r,i,o+1)}(e,r.pathToArray(t),i,o)}function o(e,t){return i(e,t,!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.valueOf=i,t.get=o,t.exists=function(e,t){return void 0!==i(t,e,!0)},t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(322)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){this.autoDestroy=!1,this.properties=e};function o(e){var t=e.constructor.__accessorMetadata__,n=Object.getPrototypeOf(e).constructor.__accessorMetadata__;if(t){if(t===n){var o=Object.create(n.properties);for(var a in o)o[a]=r.clone(o[a]);(t=new i(o)).autoDestroy=n.autoDestroy,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!1,writable:!1})}}else Object.defineProperty(e.constructor,"__accessorMetadata__",{value:new i({}),enumerable:!1,configurable:!1,writable:!1});return e.constructor.__accessorMetadata__}function a(e){return o(e).properties}t.ClassMetadata=i,t.getOwnClassMetadata=o,t.getOwnPropertiesMetadata=a,t.getOwnPropertyMetadata=function(e,t){var r=a(e),n=r[t];return n||(n=r[t]={}),n},t.setPropertyMetadata=function(e,t,r){a(e)[t]=r},t.merge=function(e,t){return n.merge(e,t,u)},t.mergeProperty=function(e,t){return n.merge(e,t,l)};var s=/^[^.]+\.(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function l(e){return s.test(e)?"replace":"merge"}var c=/^properties\./;function u(e){return c.test(e)?l(e.slice(11)):"merge"}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(617),r(172),r(574),r(615),r(475),r(515),r(365),r(351),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d){function h(e,t,o,l,c,u,d,h){var m=s.generateUUID(),y=v(o,l,d),g=a.join(i.get(h,"prefix"),m),_=g+"."+p.resourceContentExtension(y),b=d.portalItem.resourceFromPath(_);a.isBlobProtocol(l)&&d.resources.pendingOperations.push(function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(165)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[4,t.sent()(e,{responseType:"blob"})];case 2:return[2,t.sent().data]}}))}))}(l).then((function(e){b.path=g+"."+p.resourceContentExtension(e),c[u]=b.itemRelativeUrl})).catch((function(){}))),f(e,t,b,y,d.resources.toAdd),c[u]=b.itemRelativeUrl}function f(e,t,r,n,i){i.push({resource:r,content:n,finish:function(r){!function(e,t,r){"string"==typeof e[t]?e[t]=r.url:e[t].url=r.url}(e,t,r)}})}function v(e,t,r){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(r))],{type:"application/json"})}Object.defineProperty(t,"__esModule",{value:!0}),t.persistable=function(e){var t=i.isSome(e)&&e.origins?e.origins:[void 0];return function(r,s){for(var m=function(e,t,r){if(i.isSome(e)&&"resource"===e.type)return function(e,t,r){var s=l.getOwnPropertyMetadata(t,r);return{read:function(e,t,r){var n=d.read(e,t,r);return s.type===String?n:"function"==typeof s.type?new s.type({url:n}):void 0},write:{writer:function(t,l,u,m){if(!m||!m.resources)return"string"==typeof t?void(l[u]=d.toJSON(t,m)):void(l[u]=t.write({},m));var y=function(e){return i.isNone(e)?null:"string"==typeof e?e:e.url}(t),g=y?d.toJSON(y,n.__assign(n.__assign({},m),{verifyItemRelativeUrls:m&&m.verifyItemRelativeUrls?{writtenUrls:m.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null})):null,_=s.type!==String&&(!o.isMultiOriginJSONMixin(this)||m&&m.origin&&this.originIdOf(r)>c.nameToId(m.origin));m&&m.portalItem&&i.isSome(g)&&!a.isAbsolute(g)?_?function(e,t,r,n,i,o,s,l){var c=s.portalItem.resourceFromPath(n),u=v(r,n,s);p.resourceContentExtension(u)===a.getPathExtension(c.path)?(f(e,t,c,u,s.resources.toUpdate),i[o]=n):h(e,t,r,n,i,o,s,l)}(this,r,t,g,l,u,m,e):function(e,t,r,n){n.resources.toKeep.push({resource:n.portalItem.resourceFromPath(e)}),t[r]=e}(g,l,u,m):m&&m.portalItem&&(i.isNone(g)||i.isSome(d.itemIdFromResourceUrl(g))||a.isBlobProtocol(g)||_)?h(this,r,t,g,l,u,m,e):l[u]=g}}}}(e,t,r);switch(i.isSome(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:d.read,write:d.write}}}(e,r,s),y=0,g=t;y<g.length;y++){var _=g[y],b=u.propertyJSONMeta(r,_,s);for(var x in m)b[x]=m[x]}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMultiOriginJSONMixin=function(e){return e&&"getAtOrigin"in e&&"originOf"in e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(121)],void 0===(i=function(e,t,r){function n(e){return{setTimeout:function(t,r){var n=e.setTimeout(t,r);return{remove:function(){return e.clearTimeout(n)}}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.wrap=n,t.default=n(r)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(154),r(156),r(153),r(475),r(322),r(852)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=i.getLogger("esri.core.accessorSupport.write");function u(e,t,i,o,s,l){if(!o||!o.write)return!1;var u=e.get(i);if(!s&&o.write.overridePolicy){var p=o.write.overridePolicy.call(e,u,i,l);void 0!==p&&(s=p)}if(s||(s=o.write),!s||!1===s.enabled)return!1;if((null===u&&!s.allowNull||void 0===u)&&s.isRequired){var d=new n("web-document-write:property-required","Missing value for required property '"+i+"' on '"+e.declaredClass+"'",{propertyName:i,target:e});return d&&l&&l.messages?l.messages.push(d):d&&!l&&c.error(d.name,d.message),!1}return void 0!==u&&(!(null===u&&!s.allowNull)&&(!function(e,t,n,i,o){var a=i.default;if(void 0===a)return!1;if(null!=i.defaultEquals)return i.defaultEquals(o);if("function"==typeof a){if(Array.isArray(o)){var s=a.call(e,t,n);return r.equals(s,o)}return!1}return a===o}(e,i,l,o,u)&&(void 0!==o.default||!(!s.ignoreOrigin&&l&&l.origin&&t.store.originOf(i)<a.nameToId(l.origin)))))}function p(e,t,r){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return s.merge(t,e.toJSON());var n=s.getProperties(e),i=n.metadatas,c=function(c){var p=l.originSpecificWritePropertyDefinition(i[c],r);if(!u(e,n,c,p,null,r))return"continue";var d=e.get(c),h="string"==typeof p.write.target?p.write.target:c,f=function(e,t,r,n,i){var o={};return t.write.writer.call(e,n,o,r,i),o}(e,p,h,d,r);Object.keys(f).length>0&&(t=s.merge(t,f),r&&r.resources&&r.resources.pendingOperations&&r.resources.pendingOperations.length&&o.all(r.resources.pendingOperations).then((function(){return s.merge(t,f)})),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:c,oldOrigin:a.idToReadableName(n.store.originOf(c)),newOrigin:r.origin}))};for(var p in i)c(p);return t}t.willPropertyWrite=function(e,t,r,n){var i=s.getProperties(e),o=i.metadatas,a=l.originSpecificWritePropertyDefinition(o[t],n);return!!a&&u(e,i,t,a,r,n)},t.write=p,t.default=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.byId=function(e){return"string"==typeof e?document.getElementById(e):e},t.empty=function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)},t.insertAfter=function(e,t){var r=t.parentNode;r&&(r.lastChild===t?r.appendChild(e):r.insertBefore(e,t.nextSibling))},t.insertBefore=function(e,t){var r=t.parentNode;r&&r.insertBefore(e,t)},t.reparent=function(e,t){for(;e.hasChildNodes();)t.appendChild(e.firstChild)},t.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},t.closest=function(){if(Element.prototype.closest)return function(e,t){return e.closest(t)};var e=Element.prototype.matches||Element.prototype.msMatchesSelector;return function(t,r){var n=t;do{if(e.call(n,r))return n;n=n.parentElement}while(null!==n&&1===n.nodeType);return null}}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1101),r(1428),r(1429),r(1430),r(1431)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.dom=r.dom,t.h=n.h,t.createProjector=i.createProjector,t.createCache=o.createCache,t.createMapping=a.createMapping}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(1442),r(762),r(1443),r(1444)],void 0===(i=function(e,t,r,n,i,o,a){var s;function l(e,t){switch(e.type){case"range":var r="range"in e?e.range[0]:e.minValue,n="range"in e?e.range[1]:e.maxValue;if(+t<r||+t>n)return s.VALUE_OUT_OF_RANGE;break;case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((function(e){return null==e||e.code!==t})))return s.INVALID_CODED_VALUE}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.CodedValueDomain=n,t.DomainBase=i,t.InheritedDomain=o,t.RangeDomain=a,function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(s=t.DomainValidationError||(t.DomainValidationError={})),t.isValidDomainValue=function(e,t){return null===l(e,t)},t.validateDomainValue=l,t.types={key:"type",base:i,typeMap:{range:a,"coded-value":n,inherited:o}},t.getDomainRange=function(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}},t.fromJSON=function(e){if(!e||!e.type)return null;switch(e.type){case"range":return a.fromJSON(e);case"codedValue":return n.fromJSON(e);case"inherited":return o.fromJSON(e);default:r.neverReached(e)}return null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(353)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=[];function i(e,t,r,n){return{xmin:e,ymin:t,xmax:r,ymax:n}}function o(e,t,r,n,i,o){return{xmin:e,ymin:t,zmin:r,xmax:n,ymax:i,zmax:o}}function a(e,t,r,n,i,o){return{xmin:e,ymin:t,mmin:r,xmax:n,ymax:i,mmax:o}}function s(e,t,r,n,i,o,a,s){return{xmin:e,ymin:t,zmin:r,mmin:n,xmax:i,ymax:o,zmax:a,mmax:s}}function l(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),t?r?s(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):o(e[0],e[1],e[2],e[3],e[4],e[5]):r?a(e[0],e[1],e[2],e[3],e[4],e[5]):i(e[0],e[1],e[2],e[3])}function c(e){var t=e.hasZ,i=e.hasM,o=e.points;return l(r.getPointsBounds(n,o,t,i),t,i)}function u(e){var t=e.x,r=e.y,n=e.z,l=e.m,c=null!=l;return null!=n?c?s(t,r,n,l,t,r,n,l):o(t,r,n,t,r,n):c?a(t,r,l,t,r,l):i(t,r,t,r)}function p(e){var t=e.hasZ,i=e.hasM,o=e.rings,a=r.getRingsOrPathsBounds(n,o,t,i);return a?l(a,t,i):null}function d(e){var t=e.hasZ,i=e.hasM,o=e.paths,a=r.getRingsOrPathsBounds(n,o,t,i);return a?l(a,t,i):null}t.getGeometryExtent=function(e){return e?void 0!==(t=e).xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?u(e):function(e){return void 0!==e.rings}(e)?p(e):function(e){return void 0!==e.paths}(e)?d(e):function(e){return void 0!==e.points}(e)?c(e):null:null;var t},t.getMultipointExtent=c,t.getPointExtent=u,t.getPolygonExtent=p,t.getPolylineExtent=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(166),r(118),r(151),r(184),r(170),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=new i.default({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});return function(e){function t(t){var r=e.call(this,t)||this;return r.categories=null,r.disableExtraQuery=!1,r.extent=null,r.num=10,r.query=null,r.sortField=null,r.start=1,r}var n;return r.__extends(t,e),n=t,Object.defineProperty(t.prototype,"sortOrder",{get:function(){return this._get("sortOrder")||"asc"},set:function(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({categories:this.categories?o.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})},t.prototype.toRequestOptions=function(e,t){var n,i;if(this.categories&&(n=this.categories.map((function(e){return Array.isArray(e)?JSON.stringify(e):e}))),this.extent){var o=c.project(this.extent,l.WGS84);o&&(i=o.xmin+","+o.ymin+","+o.xmax+","+o.ymax)}var a=this.query;!this.disableExtraQuery&&e.extraQuery&&(a="("+a+")"+e.extraQuery);var s={categories:n,bbox:i,q:a,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map((function(e){return u.toJSON(e.trim())})).join(","),s.sortOrder=this.sortOrder),{query:r.__assign(r.__assign({},t),s)}},r.__decorate([a.property()],t.prototype,"categories",void 0),r.__decorate([a.property()],t.prototype,"disableExtraQuery",void 0),r.__decorate([a.property({type:s})],t.prototype,"extent",void 0),r.__decorate([a.property()],t.prototype,"num",void 0),r.__decorate([a.property()],t.prototype,"query",void 0),r.__decorate([a.property()],t.prototype,"sortField",void 0),r.__decorate([a.property()],t.prototype,"sortOrder",null),r.__decorate([a.property()],t.prototype,"start",void 0),n=r.__decorate([a.subclass("esri.portal.PortalQueryParams")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=e,this.y=t,this.width=r,this.height=n}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.width<=0||this.height<=0},enumerable:!0,configurable:!0}),e.prototype.union=function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)},e}();t.default=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateValueOrFunction=function(e,t,r,n){return function(e){return"function"==typeof e}(e)?e(t,r,n):e},t.colorToArray=function(e){return[e.r,e.g,e.b,e.a]},t.createLabelOverrideFunction=function(e,t,n){var i=function(e){for(var t=e.length;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},o=[],a=0,s=-1;do{if((s=t.indexOf("[",a))>=a){if(s>a){var l=t.substr(a,s-a);o.push([l,null,i(l)])}if(a=s+1,(s=t.indexOf("]",a))>=a){if(s>a){var c=e[t.substr(a,s-a)];c&&o.push([null,c,!1])}a=s+1}}}while(-1!==s);return a<t.length-1&&(l=t.substr(a),o.push([l,null,i(l)])),function(e){for(var t="",i=null,a=0,s=o;a<s.length;a++){var l=s[a],c=l[0],u=l[1],p=l[2];if(c)p?i=c:(i&&(t+=i,i=null),t+=c);else{var d=e.attributes[u];d&&(i&&(t+=i,i=null),t+=d)}}return r(t,n)}},t._adjustTextCase=r,t.resampleHermite=function(e,t,r,n,i,o,a){void 0===a&&(a=!0);for(var s=t/i,l=r/o,c=Math.ceil(s/2),u=Math.ceil(l/2),p=0;p<o;p++)for(var d=0;d<i;d++){for(var h=4*(d+(a?o-p-1:p)*i),f=0,v=0,m=0,y=0,g=0,_=0,b=0,x=(p+.5)*l,w=Math.floor(p*l);w<(p+1)*l;w++)for(var S=Math.abs(x-(w+.5))/u,P=(d+.5)*s,T=S*S,O=Math.floor(d*s);O<(d+1)*s;O++){var C=Math.abs(P-(O+.5))/c,M=Math.sqrt(T+C*C);M>=-1&&M<=1&&(f=2*M*M*M-3*M*M+1)>0&&(b+=f*e[3+(C=4*(O+w*t))],m+=f,e[C+3]<255&&(f=f*e[C+3]/250),y+=f*e[C],g+=f*e[C+1],_+=f*e[C+2],v+=f)}n[h]=y/v,n[h+1]=g/v,n[h+2]=_/v,n[h+3]=b/m}},t.fromCIMColor=function(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}},t.toCIMSymbolJSON=function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.symbol},t.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type},t.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type},t.isCIMFill=function(e){return"CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type},t.isCIMMarkerStrokePlacement=function(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(172),r(151),r(351)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=n.strict()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"}),c=function(e){function t(t){return e.call(this,t)||this}var n;return r.__extends(t,e),n=t,t.prototype.readHref=function(e,t,r){return e?s.fromJSON(e,r):t.dataURI},t.prototype.writeHref=function(e,t,r,n){e&&(o.isDataProtocol(e)?t.dataURI=e:(t.href=s.toJSON(e,n),o.isAbsolute(t.href)&&(t.href=o.normalize(t.href))))},t.prototype.clone=function(){return new n({href:this.href,primitive:this.primitive})},r.__decorate([a.property({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],t.prototype,"href",void 0),r.__decorate([a.reader("href")],t.prototype,"readHref",null),r.__decorate([a.writer("href",{href:{type:String},dataURI:{type:String}})],t.prototype,"writeHref",null),r.__decorate([a.enumeration(l)],t.prototype,"primitive",void 0),n=r.__decorate([a.subclass("esri.symbols.support.IconSymbol3DLayerResource")],t)}(i.JSONSupport);t.IconSymbol3DLayerResource=c,t.defaultPrimitive="circle",t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1121),r(881)],void 0===(i=function(e,t,r,n){function i(e){if(!e)return!1;var t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function o(e,t,r){if(!e)return e;switch(e.type){case"line":var i=new n;return i.read(e,r),i}}Object.defineProperty(t,"__esModule",{value:!0}),t.hasVisibleVerticalOffset=i,t.hasVisibleCallout=function(e){if(!e)return!1;if(!e.supportsCallout||!e.supportsCallout())return!1;var t=e.callout;return!!t&&!!t.visible&&!!i(e)},t.isCalloutSupport=function(e){return"point-3d"===e.type||"label-3d"===e.type},t.read=o,t.calloutProperty={types:{key:"type",base:r,typeMap:{line:n}},json:{read:o,write:!0}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(166),r(118),r(151),r(875),r(429)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=new i.default({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.color=new n([0,0,0,.25]),i.outline=new l,i.type="simple-fill",i.style="solid",i}var i;return r.__extends(t,e),i=t,t.prototype.normalizeCtorArgs=function(e,t,r){if(e&&"string"!=typeof e)return e;var n={};return e&&(n.style=e),t&&(n.outline=t),r&&(n.color=r),n},t.prototype.clone=function(){return new i({color:o.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})},t.prototype.hash=function(){return""+e.prototype.hash.call(this)+this.style+"."+(this.color&&this.color.hash())},r.__decorate([a.property()],t.prototype,"color",void 0),r.__decorate([a.property()],t.prototype,"outline",void 0),r.__decorate([a.enumeration({esriSFS:"simple-fill"})],t.prototype,"type",void 0),r.__decorate([a.property({type:c.apiValues,json:{read:c.read,write:c.write}})],t.prototype,"style",void 0),i=r.__decorate([a.subclass("esri.symbols.SimpleFillSymbol")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(1129),r(888)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.colorRamps=null,r.type="multipart",r}var a;return r.__extends(t,e),a=t,t.prototype.clone=function(){return new a({colorRamps:n.clone(this.colorRamps)})},r.__decorate([i.property({type:[o],json:{write:!0}})],t.prototype,"colorRamps",void 0),r.__decorate([i.property({type:["multipart"]})],t.prototype,"type",void 0),a=r.__decorate([i.subclass("esri.tasks.support.MultipartColorRamp")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(191),r(889),r(1132),r(1133),r(433),r(632),r(1481)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p={base:c,key:"type",typeMap:{opacity:a,color:o,rotation:s,size:l}};t.VisualVariablesMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._vvFactory=new u,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"visualVariables",{set:function(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)},enumerable:!0,configurable:!0}),t.prototype.readVisualVariables=function(e,t,r){return this._vvFactory.readVariables(e,t,r)},t.prototype.writeVisualVariables=function(e,t,r,n){t[r]=this._vvFactory.writeVariables(e,n)},Object.defineProperty(t.prototype,"arcadeRequiredForVisualVariables",{get:function(){if(!this.visualVariables)return!1;for(var e=0,t=this.visualVariables;e<t.length;e++)if(t[e].arcadeRequired)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.hasVisualVariables=function(e,t){return e?!!this.getVisualVariablesForType(e,t):!!(this.getVisualVariablesForType("size",t)||this.getVisualVariablesForType("color",t)||this.getVisualVariablesForType("opacity",t)||this.getVisualVariablesForType("rotation",t))},t.prototype.getVisualVariablesForType=function(e,t){var r=this.visualVariables;if(r){var n=r.filter((function(r){return r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target)}));if(!n||0!==n.length)return n}},t.prototype.collectVVRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:n=[],this.visualVariables&&(n=n.concat(this.visualVariables)),o=0,a=n,r.label=1;case 1:return o<a.length?(s=a[o])?(s.field&&i.collectField(e,t,s.field),s.normalizationField&&i.collectField(e,t,s.normalizationField),s.valueExpression?[4,i.collectArcadeFieldNames(e,t,s.valueExpression)]:[3,3]):[3,3]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},r.__decorate([n.property({types:[p],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),r.__decorate([n.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),r.__decorate([n.writer("visualVariables")],t.prototype,"writeVisualVariables",null),r.__decorate([n.subclass("esri.renderers.mixins.VisualVariablesMixin")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(156),r(151),r(179),r(1130)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=o.getLogger("esri.renderers.visualVariables.VisualVariable"),u=new n.default({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});return function(e){function t(t){var r=e.call(this,t)||this;return r.index=null,r.type=null,r.field=null,r.valueExpression=null,r.valueExpressionTitle=null,r.legendOptions=null,r}return r.__extends(t,e),t.prototype.castField=function(e){return null==e?e:"function"==typeof e?(c.error(".field: field must be a string value"),null):s.ensureString(e)},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return!!this.valueExpression},enumerable:!0,configurable:!0}),t.prototype.clone=function(){},t.prototype.getAttributeHash=function(){return this.type+"-"+this.field+"-"+this.valueExpression},r.__decorate([a.property()],t.prototype,"index",void 0),r.__decorate([a.property({type:u.apiValues,readOnly:!0,json:{read:u.read,write:u.write}})],t.prototype,"type",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([a.cast("field")],t.prototype,"castField",null),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["valueExpression"]})],t.prototype,"arcadeRequired",null),r.__decorate([a.property({type:l,json:{write:!0}})],t.prototype,"legendOptions",void 0),r.__decorate([a.subclass("esri.renderers.visualVariables.VisualVariable")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(239),r(180),r(1137),r(154),r(153),r(172),r(273),r(624),r(1486),r(351),r(354),r(1120),r(880)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){Object.defineProperty(t,"__esModule",{value:!0});var y={};function g(e,t,r){return e.styleUrl?function(e,t){return x(e,t).then((function(t){return{data:t.data,baseUrl:c.removeFile(e),styleUrl:e}}))}(e.styleUrl,r):e.styleName?function(e,t,r){var n,i=t.portal||u.getDefault(),o=i.url+" - "+(i.user&&i.user.username)+" - "+e;return y[o]||(y[o]=function(e,t,r){return t.load(r).then((function(){var n=new p({disableExtraQuery:!0,query:"owner:"+w+" AND type:"+S+' AND typekeywords:"'+e+'"'});return t.queryItems(n,r)})).then((function(t){var n=t.results,i=null,o=e.toLowerCase();if(n&&Array.isArray(n))for(var a=0,l=n;a<l.length;a++){var c=l[a];if(c.typeKeywords.some((function(e){return e.toLowerCase()===o}))&&c.type===S&&c.owner===w){i=c;break}}if(!i)throw new s("symbolstyleutils:style-not-found","The style '"+e+"' could not be found",{styleName:e});return i.load(r)}))}(e,i,r).then((function(e){return n=e,e.fetchData()})).then((function(t){return{data:t,baseUrl:n.itemUrl,styleName:e}}))),y[o]}(e.styleName,t,r):l.reject(new s("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function _(e,t,r,n,u){var p=e.data,y={portal:r.portal,url:c.urlToObject(e.baseUrl),origin:"portal-item"},g=o.find(p.items,(function(e){return e.name===t}));if(!g){var _="The symbol name '"+t+"' could not be found";return l.reject(new s("symbolstyleutils:symbol-name-not-found",_,{symbolName:t}))}var w=h.fromJSON(function(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!d.enableWebStyleForceWOSR())for(var r=0,n=e.formatInfos;r<n.length;r++){var i=n[r];if("gltf"===i.type)return i.href}return e.webRef}(g,n),y),S=g.thumbnail&&g.thumbnail.href,P=g.thumbnail&&g.thumbnail.imageData;a.isDevEnvironment()&&(w=a.adjustStaticAGOUrl(w),S=a.adjustStaticAGOUrl(S));var T={portal:r.portal,url:c.urlToObject(c.removeFile(w)),origin:"portal-item"};return x(w,u).then((function(o){var a="cimRef"===n?b(o.data):o.data,s=f.fromJSON(a,T);if(s&&i.isSymbol3D(s)){if(S){var l=h.fromJSON(S,y);s.thumbnail=new m.default({url:l})}else P&&(s.thumbnail=new m.default({url:"data:image/png;base64,"+P}));e.styleUrl?s.styleOrigin=new v({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(s.styleOrigin=new v({portal:r.portal,styleName:e.styleName,name:t}))}return s}))}function b(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function x(e,t){var i=r.__assign({responseType:"json",query:{f:"json"}},t);return n(c.normalize(e),i)}t.fetchStyle=g,t.resolveWebStyleSymbol=function(e,t,r,n){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){var n=P.replace(/\{SymbolName\}/gi,e.name);return x(n,r).then((function(e){var r=b(e.data);return f.fromJSON(r,{portal:t.portal,url:c.urlToObject(c.removeFile(n)),origin:"portal-item"})}))}(e,t,n):g(e,t,n).then((function(i){return _(i,e.name,t,r,n)})):l.reject(new s("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))},t.fetchSymbolFromStyle=_,t.styleNameFromItem=function(e){for(var t=0,r=e.typeKeywords;t<r.length;t++){var n=r[t];if(/^Esri.*Style$/.test(n)&&"Esri Style"!==n)return n}};var w="esri_en",S="Style",P="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(158),r(154),r(167),r(156),r(890),r(214),r(153),r(231),r(172),r(157),r(151),r(1516)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){Object.defineProperty(t,"__esModule",{value:!0});var m=s.getLogger("esri.layers.support.TilemapCache"),y=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new a,r._pendingTilemapRequests={},r._availableLevels={},r.levels=5,r.cacheByteSize=2097152,r.request=n,r._prefetchingEnabled=!0,r}var i;return r.__extends(t,e),i=t,t.prototype.initialize=function(){var e=this;this._tilemapCache=new l(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),h.init(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.castLevels=function(e){return e<=2?(m.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),t.prototype.fetchTilemap=function(e,t,n,i){var a=this;if(!this._availableLevels[e])return u.reject(new o("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var s=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,n,s);if(l)return u.resolve(l);var c=i&&i.signal;return i=r.__assign(r.__assign({},i),{signal:null}),u.create((function(e,t){u.onAbort(c,(function(){return t(u.createAbortError())}));var r=v.tilemapDefinitionId(s),n=a._pendingTilemapRequests[r];if(!n){n=v.Tilemap.fromDefinition(s,i).then((function(e){return a._tilemapCache.put(r,e,e.byteSize),e}));var o=function(){return delete a._pendingTilemapRequests[r]};a._pendingTilemapRequests[r]=n,n.then(o,o)}n.then(e,t)}))},t.prototype.getAvailability=function(e,t,r){if(!this._availableLevels[e])return"unavailable";var n=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return n?n.getAvailability(t,r):"unknown"},t.prototype.getAvailabilityUpsample=function(e,t,r,n){n.level=e,n.row=t,n.col=r;var i=this.layer.tileInfo;for(i.updateTileInfo(n);;){var o=this.getAvailability(n.level,n.row,n.col);if("unavailable"!==o)return o;if(!i.upsampleTile(n))return"unavailable"}},t.prototype.fetchAvailability=function(e,t,r,n){return this._availableLevels[e]?this.fetchTilemap(e,t,r,n).catch((function(e){return e})).then((function(n){if(n instanceof v.Tilemap){var i=n.getAvailability(t,r);return"unavailable"===i?u.reject(new o("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):i}if(u.isAbortError(n))throw n;return"unknown"})):u.reject(new o("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},t.prototype.fetchAvailabilityUpsample=function(e,t,r,n,i){var o=this;n.level=e,n.row=t,n.col=r;var a=this.layer.tileInfo;a.updateTileInfo(n);var s=this.fetchAvailability(e,t,r,i).catch((function(e){if(u.isAbortError(e))throw e;if(a.upsampleTile(n))return o.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,r,i,s),s},t.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,n,o,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,d,h,f,v,m,y,g,_;return r.__generator(this,(function(b){switch(b.label){case 0:if(!this._prefetchingEnabled)return[2];if(l="prefetch-"+e,this._handles.has(l))return[2];c=u.createAbortController(),s.then((function(){return c.abort()}),(function(){return c.abort()})),d=!1,h={remove:function(){d||(d=!0,c.abort())}},this._handles.add(h,l),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,p.waitTicks(10,c.signal)];case 2:case 3:return b.sent(),[3,4];case 4:if(d||(d=!0,this._handles.remove(l)),u.isAborted(c))return[2];for(f={id:e,level:t,row:n,col:o},v=r.__assign(r.__assign({},a),{signal:c.signal}),m=this.layer.tileInfo,y=function(e){var t=g.fetchAvailability(f.level,f.row,f.col,v);i._prefetches.push(t);var r=function(){i._prefetches.removeUnordered(t)};t.then(r,r)},g=this,_=0;i._prefetches.length<i._maxPrefetch&&m.upsampleTile(f);++_)y();return[2]}}))}))},t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?d.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},t.prototype._tilemapFromCache=function(e,t,r,n){n.level=e,n.row=t-t%this.size,n.col=r-r%this.size;var i=v.tilemapDefinitionId(n);return this._tilemapCache.get(i)},t.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,n){return!!e._tilemapFromCache(t,r,n,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),t._maxPrefetch=4,t._prefetches=new c({initialSize:i._maxPrefetch}),r.__decorate([f.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0),r.__decorate([f.cast("levels")],t.prototype,"castLevels",null),r.__decorate([f.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null),r.__decorate([f.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0),r.__decorate([f.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([f.property({constructOnly:!0})],t.prototype,"request",void 0),i=r.__decorate([f.subclass("esri.layers.support.TilemapCache")],t)}(i);t.TilemapCache=y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(156),r(151),r(1145),r(1525)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=i.getLogger("esri.views.input.InputManager"),c=function(e){function n(t){var r=e.call(this,t)||this;return r._pointerCaptures=new Map,r._nameToGroup={},r._handlers=[],r._currentPropagation=null,r._sourceEvents=new Set,r._keyModifiers=new Set,r._activeKeyModifiers=new Set,r._stoppedPropagationEventIds=new Set,r.primaryKey=a.primaryKey,r.latestPointerType="mouse",r.test={timestamp:void 0},r}return r.__extends(n,e),n.prototype.initialize=function(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()},n.prototype.destroy=function(){for(var e=0,t=Object.keys(this._nameToGroup);e<t.length;e++){var r=t[e];this.uninstallHandlers(r)}this.eventSource=null},Object.defineProperty(n.prototype,"hasPendingInputs",{get:function(){return this._handlers.some((function(e){return e.handler.hasPendingInputs}))},enumerable:!0,configurable:!0}),n.prototype.installHandlers=function(e,r,n){var i=this;if(void 0===n&&(n=t.ViewEventPriorities.INTERNAL),this._nameToGroup[e])l.error("There is already an InputHandler group registered under the name `"+e+"`");else if(0!==r.length){var o={name:e,handlers:r.map((function(e){return{handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:n,eventCallback:null,uninstallCallback:null}}))};this._nameToGroup[e]=o;for(var a=function(e){var t=o.handlers[e];s._handlers.push(t),t.handler.onInstall({updateDependencies:function(){i.updateDependencies()},emit:function(e,r,n,o,a){i._emitInputEvent(t.priorityIndex,e,r,n,a,o)},setPointerCapture:function(e,r){i._setPointerCapture(o,t,e,r)},setEventCallback:function(e){t.eventCallback=e},setUninstallCallback:function(e){t.uninstallCallback=e},refreshHasPendingInputs:function(){i.notifyChange("hasPendingInputs")}})},s=this,c=o.handlers.length-1;c>=0;c--)a(c);this.updateDependencies()}else l.error("Can't register a group of zero handlers")},n.prototype.uninstallHandlers=function(e){var t=this._nameToGroup[e];t?(t.handlers.forEach((function(e){e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):l.error("There is no InputHandler group registered under the name `"+e+"`")},n.prototype.hasHandlers=function(e){return void 0!==this._nameToGroup[e]},n.prototype.updateDependencies=function(){var e=new Set,t=new Set;this._handlersPriority=[];for(var r=this._handlers.length-1;r>=0;r--){var n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}for(this._handlersPriority=this._sortHandlersPriority(this._handlersPriority),r=this._handlersPriority.length-1;r>=0;r--){var i=this._handlersPriority[r];i.priorityIndex=r;var o=i.handler.hasSideEffects;if(!o)for(var s=0,l=i.handler.outgoingEventTypes;s<l.length;s++){var c=l[s];if(e.has(c)){o=!0;break}}if(o)for(var u=0,p=i.handler.incomingEventMatches;u<p.length;u++){var d=p[u];e.add(d.eventType);for(var h=0,f=d.keyModifiers;h<f.length;h++){var v=f[h];a.isSystemModifier(v)||t.add(v)}}i.active=o}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)},n.prototype._setLatestPointerType=function(e){this._set("latestPointerType",e)},n.prototype._onEventReceived=function(e,t){if("pointer-capture-lost"===e){var r=t;this._pointerCaptures.delete(r.native.pointerId)}this._updateKeyModifiers(e,t);var n=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,n,i)},n.prototype._updateKeyModifiers=function(e,t){var r=this;if(t){var n=!1,i=function(){if(!n){var e=new Set;r._activeKeyModifiers.forEach((function(t){e.add(t)})),r._activeKeyModifiers=e,n=!0}},o=function(e,t){t&&!r._activeKeyModifiers.has(e)?(i(),r._activeKeyModifiers.add(e)):!t&&r._activeKeyModifiers.has(e)&&(i(),r._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){var a=t.key;this._keyModifiers.has(a)&&o(a,"key-down"===e)}var s=t.native;o("Alt",!(!s||!s.altKey)),o("Ctrl",!(!s||!s.ctrlKey)),o("Shift",!(!s||!s.shiftKey)),o("Meta",!(!s||!s.metaKey)),o("Primary",this._activeKeyModifiers.has(this.primaryKey))}},n.prototype._installRecognizers=function(){var e=this;this._latestPointerTypeHandler=new s.LatestPointerType((function(t){return e._setLatestPointerType(t)})),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,t.ViewEventPriorities.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],t.ViewEventPriorities.INTERNAL)},n.prototype._setPointerCapture=function(e,t,r,n){var i=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(i),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(i)&&(o.delete(i),0===o.size&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))},n.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter((function(e){return!e.removed})),this.updateDependencies()},n.prototype._emitInputEventFromSource=function(e,t,r,n){this._emitInputEvent(0,e,t,r,n)},n.prototype._emitInputEvent=function(e,t,r,n,i,o){var a=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),s=void 0!==i&&i,l=new u(t,r,a,o||this._activeKeyModifiers,s);this._currentPropagation?this._currentPropagation.addedEvents.push(l):this._doNewPropagation(e,l)},n.prototype._doNewPropagation=function(e,t){this._currentPropagation={events:[t],addedEvents:[],currentHandler:this._handlersPriority[e],needsHandlerGarbageCollect:!1,timestamp:t.timestamp};for(var r=this._currentPropagation;r.currentHandler;){if(r.currentHandler.removed)r.needsHandlerGarbageCollect=!0;else{var n=r.events,i=[];r.addedEvents=[];for(var o=0;o<n.length;o++){var a=n[o],s=a.data&&a.data.eventId;null!=s&&this._stoppedPropagationEventIds.has(s)||(r.currentHandler.active&&r.currentHandler.eventCallback(a),a.shouldStopPropagation()?null!=s&&this._stoppedPropagationEventIds.add(s):i.push(a))}r.events=i.concat(r.addedEvents)}r.currentHandler=this._handlersPriority[r.currentHandler.priorityIndex+1]}r.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null},n.prototype._compareHandlerPriority=function(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(var r=0,n=e.handler.incomingEventMatches;r<n.length;r++)for(var i=n[r],o=function(e){if(i.eventType!==e.eventType)return"continue";var t=i.keyModifiers.filter((function(t){return-1!==e.keyModifiers.indexOf(t)}));return t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length)?{value:i.keyModifiers.length>e.keyModifiers.length?-1:1}:void 0},a=0,s=t.handler.incomingEventMatches;a<s.length;a++){var l=o(s[a]);if("object"==typeof l)return l.value}return e.priorityIndex>t.priorityIndex?-1:1},n.prototype._sortHandlersPriority=function(e){for(var t=[],r=0,n=e;r<n.length;r++){for(var i=n[r],o=0;o<t.length&&this._compareHandlerPriority(i,t[o])>=0;)o++;t.splice(o,0,i)}return t},Object.defineProperty(n.prototype,"debug",{get:function(){var e=this,t=function(t){var r=e._setPointerCapture;e._setPointerCapture=function(){},t(),e._setPointerCapture=r};return{injectEvent:function(r,n){t((function(){e._onEventReceived(r,n)}))},disablePointerCapture:t}},enumerable:!0,configurable:!0}),r.__decorate([o.property({readOnly:!0})],n.prototype,"hasPendingInputs",null),r.__decorate([o.property()],n.prototype,"eventSource",void 0),r.__decorate([o.property()],n.prototype,"recognizers",void 0),r.__decorate([o.property({readOnly:!0})],n.prototype,"latestPointerType",void 0),r.__decorate([o.subclass("esri.views.input.InputManager")],n)}(n);t.InputManager=c;var u=function(){function e(e,t,r,n,i){this.type=e,this.data=t,this.timestamp=r,this.modifiers=n,this.cancelable=i,this._stopPropagation=!1}return e.prototype.stopPropagation=function(){this._stopPropagation=!0},e.prototype.shouldStopPropagation=function(){return this._stopPropagation},e.prototype.preventDefault=function(){this.data.native.preventDefault()},e}();t.ViewEventPriorities={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(168),r(151),r(179),r(202),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.position=new s([0,0,0]),n.heading=0,n.tilt=0,n.fov=55,n}var n;return r.__extends(t,e),n=t,t.prototype.normalizeCtorArgs=function(e,t,r,n){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){var i={position:e};return null!=t&&(i.heading=t),null!=r&&(i.tilt=r),null!=n&&(i.fov=n),i}return e},t.prototype.writePosition=function(e,t,r,n){var i=e.clone();i.x=a.ensureNumber(e.x||0),i.y=a.ensureNumber(e.y||0),i.z=e.hasZ?a.ensureNumber(e.z||0):e.z,t[r]=i.write(null,n)},t.prototype.readPosition=function(e,t){var r=new s;return r.read(e,t),r.x=a.ensureNumber(r.x||0),r.y=a.ensureNumber(r.y||0),r.z=r.hasZ?a.ensureNumber(r.z||0):r.z,r},t.prototype.equals=function(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)},t.prototype.clone=function(){return new n({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})},r.__decorate([o.property({type:s,json:{write:{isRequired:!0}}})],t.prototype,"position",void 0),r.__decorate([o.writer("position")],t.prototype,"writePosition",null),r.__decorate([o.reader("position")],t.prototype,"readPosition",null),r.__decorate([o.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),o.cast((function(e){return l.cyclicalDeg.normalize(a.ensureNumber(e))}))],t.prototype,"heading",void 0),r.__decorate([o.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),o.cast((function(e){return i.clamp(a.ensureNumber(e),-180,180)}))],t.prototype,"tilt",void 0),r.__decorate([o.property({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"fov",void 0),n=r.__decorate([o.subclass("esri.Camera")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){return[e,t,r]}function n(){return r(1,1,1)}function i(){return r(1,0,0)}function o(){return r(0,1,0)}function a(){return r(0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0,0]},t.clone=function(e){return[e[0],e[1],e[2]]},t.fromValues=r,t.fromArray=function(e){for(var t=[0,0,0],r=Math.min(3,e.length),n=0;n<r;++n)t[n]=e[n];return t},t.createView=function(e,t){return new Float64Array(e,t,3)},t.zeros=function(){return[0,0,0]},t.ones=n,t.unitX=i,t.unitY=o,t.unitZ=a,t.ZEROS=[0,0,0],t.ONES=n(),t.UNIT_X=i(),t.UNIT_Y=o(),t.UNIT_Z=a()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1560),r(586),r(286)],void 0===(i=function(e,t,r,n,i){var o=new i(0,0,0,0),a=new Map,s=[],l=[];function c(e,t){e.delete(t)}return function(){function e(e){var t=this;this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=null==e.resampling||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new r.default(e.cacheSize,this.tileInfoView,(function(e){t.releaseTile(e)})))}return e.prototype.destroy=function(){this.tileIndex.clear()},e.prototype.update=function(e){var t=this,r=this.resampling,i=this.tileIndex,u=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(l.length=0,s.length=0,a.clear(),u){var p=this.tileInfoView.tileInfo,d=p.minScale,h=p.maxScale,f=u.spans,v=u.lodInfo,m=v.level,y=e.state,g=y.scale,_=y.center,b=y.resolution,x=!e.stationary&&g>this._previousScale;if(this._previousScale=g,this.tiles.length=0,!r&&(g>d||g<h))return this.tiles.length=0,a.clear(),i.forEach((function(e){t.releaseTile(e)})),i.clear(),l.length=0,s.length=0,a.clear(),n.pool.release(u),!0;i.forEach((function(e){return e.visible=!0}));var w=0,S=0;if(f.length>0)for(var P=0,T=f;P<T.length;P++)for(var O=T[P],C=O.row,M=O.colFrom,A=O.colTo,E=M;E<=A;E++){w++;var I=o.set(m,C,v.normalizeCol(E),v.getWorldForColumn(E)).id;if(i.has(I))(R=i.get(I)).isReady?(a.set(I,R),S++):x||this._addParentTile(I,a);else{var R=void 0;if(this._tileCache&&this._tileCache.has(I)){if(R=this._tileCache.pop(I),this.tileIndex.set(I,R),R.isReady){a.set(I,R),S++;continue}}else R=this.acquireTile(o),this.tileIndex.set(I,R);x||this._addParentTile(I,a)}}var D=S===w;i.forEach((function(e,r){if(o.set(r),!a.has(r)){var n=t.tileInfoView.intersects(u,o);!n||!x&&D?"purge"===t.cachePolicy?o.level===m&&n||s.push(r):(o.level>m||!n)&&s.push(r):e.isReady?l.push(r):o.level>m&&s.push(r)}}));for(var L=0,j=l;L<j.length;L++)I=j[L],(R=i.get(I))&&R.isReady&&a.set(I,R);for(var V=0,F=s;V<F.length;V++)I=F[V],R=i.get(I),this._tileCache?this._tileCache.add(R):this.releaseTile(R),c(i,I);return a.forEach((function(e){return t.tiles.push(e)})),i.forEach((function(e){a.has(e.key.id)||(e.visible=!1)})),this._tileCache&&this._tileCache.prune(m,_,b),n.pool.release(u),D}},e.prototype.clear=function(e){var t=this;void 0===e&&(e=!0);var r=this.tileIndex;e&&r.forEach((function(e){t.releaseTile(e)})),r.clear()},e.prototype._addParentTile=function(e,t){for(var r=e,n=null;r=this.tileInfoView.getTileParentId(r);)if(this.tileIndex.has(r)){if((n=this.tileIndex.get(r))&&n.isReady){t.has(n.key.id)||t.set(n.key.id,n);break}}else if(this._tileCache&&this._tileCache.has(r)&&(n=this._tileCache.pop(r),this.tileIndex.set(r,n),n&&n.isReady)){t.has(n.key.id)||t.set(n.key.id,n);break}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=function(){return!0})}return e.prototype.handle=function(e){var t=e.data,r=t.pointers.size;switch(t.action){case"start":this.currentCount=r,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=r,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=r,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e},e.prototype.emitStart=function(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)},e.prototype.emitUpdate=function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)},e.prototype.emitEnd=function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null},e}();t.DragEventSeparator=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(171)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.manhattanDistance=function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},t.euclideanDistance=function(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)},t.fitCircleLSQ=function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:r.createScreenPoint()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){var n=e[0],i=e[1],o=[i.x-n.x,i.y-n.y],a=o[0],s=o[1];return t.radius=Math.sqrt(a*a+s*s)/2,t.center.x=(n.x+i.x)/2,t.center.y=(n.y+i.y)/2,t}for(var l=0,c=0,u=0;u<e.length;u++)l+=e[u].x,c+=e[u].y;l/=e.length,c/=e.length;var p=e.map((function(e){return e.x-l})),d=e.map((function(e){return e.y-c})),h=0,f=0,v=0,m=0,y=0,g=0,_=0;for(u=0;u<p.length;u++){var b=p[u],x=d[u],w=b*b,S=x*x;h+=w,f+=S,v+=b*x,m+=w*b,y+=S*x,g+=b*S,_+=x*w}var P=.5*(m+g),T=.5*(y+_),O=h*f-v*v,C=(P*f-T*v)/O,M=(h*T-v*P)/O,A=r.createScreenPoint(C+l,M+c);return{radius:Math.sqrt(C*C+M*M+(h+f)/e.length),center:A}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(168)],void 0===(i=function(e,t,r,n,i){function o(e,t){var r=e||{},o=r.format,a=r.quality,s=r.rotation,l=r.disableSlice,c=u(e,t.padding),p=function(e,t){var r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(r.x=Math.floor(e.area.x)),null!=e.area.y&&(r.y=Math.floor(e.area.y));var n=null!=e.area.width?Math.floor(e.area.width):null,i=null!=e.area.height?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,null!=n&&null!=i)r.width=Math.min(r.width,n),r.height=Math.min(r.height,i);else if(null==n&&null!=i){var o=Math.min(r.width,n);r.height=o/r.width*r.height,r.width=o}else if(null!=n&&null==i){var a=Math.min(r.height,i);r.width=a/r.height*r.width,r.height=a}}return function(e,t){var r=Math.floor(Math.max(e.x,0)),n=Math.floor(Math.max(e.y,0)),i={x:r,y:n,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-n))},o=i.width/i.height,a=e.width/e.height;if(a===o)return i;if(a>o){var s=Math.floor(i.width/a),l=i.height-s;return{x:i.x,y:Math.floor(i.y+l/2),width:i.width,height:s}}var c=Math.floor(i.height*a),u=i.width-c;return{x:Math.floor(i.x+u/2),y:i.y,width:c,height:i.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;var r=t.width/t.height,n=e.width/e.height;if(n===r)return e;if(n<r){var i=Math.floor(e.height*r);return e.x-=(i-e.width)/2,e.width=i,e}var o=Math.floor(e.width/r);return e.y-=(o-e.height)/2,e.height=o,e}(r,e),t)}(e,{width:t.width-c.left-c.right,height:t.height-c.top-c.bottom}),f=function(e,t){if(!e)return t;var r=e.width,n=e.height;if(null!=r&&null!=n)return{width:Math.floor(r),height:Math.floor(n)};if(null==r&&null==n)return t;var i=t.width/t.height;return null==n?{width:Math.floor(r),height:Math.floor(r/i)}:{width:Math.floor(n*i),height:Math.floor(n)}}(e,p),v=f.width,m=f.height,y=function(e){switch(e){case"png":case"jpg":case"jpeg":return e;case null:case void 0:return d;default:return n.neverReached(e),d}}(o),g=h[y];return{format:y,quality:i.clamp(null!=a?a:g,0,100),area:p,width:v,height:m,rotation:s,disableSlice:!!l,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function a(e,t){var r=p[t.format],n=t.quality/100;return e.toDataURL(r,n)}function s(e,t,r){return r||(l||((l=document.createElement("canvas")).width=1,l.height=1),r=l),r.getContext("2d").createImageData(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.completeUserSettings=o,t.toRenderSettings=function(e,t){var r=o(e,t),n=r.area,i=r.width/n.width,a=u(r,t.padding),s=a.left+a.right,l=a.top+a.bottom,c=t.width-s,p=t.height-l,d=Math.floor(c*i+s),h=Math.floor(p*i+l),f=e&&e.layers?e.layers:[],v=r.ignoreBackground,m=r.ignorePadding;return{framebufferWidth:d,framebufferHeight:h,region:{x:Math.floor(n.x*i)+a.left,y:Math.floor(n.y*i)+a.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:i,layers:f,disableSlice:r.disableSlice,ignoreBackground:v,ignorePadding:m}},t.encodeResult=function(e,t,r,n){n.premultipliedAlpha&&function(e){for(var t=e.data,r=t.length,n=0;n<r;n+=4){var i=t[n+3];if(i>0){var o=i/255;t[n+0]=t[n+0]/o,t[n+1]=t[n+1]/o,t[n+2]=t[n+2]/o}}}(e),r.width=e.width,r.height=e.height;var i=r.getContext("2d");i.putImageData(e,0,0),n.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(i);var o=i.getImageData(0,0,e.width,e.height),s=a(r,t);return r.width=0,r.height=0,{dataUrl:s,data:o}},t.toDataUrl=a,t.createEmptyImageData=function(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(e){c=!1}return s(e,t,r)},t.wrapImageData=function(e,t,r,n){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,r)}catch(e){c=!1}var i=s(t,r,n);return i.data.set(e,0),i},t.resampleHermite=function(e,t,r,n,i,o,a,s){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=e.width-n),void 0===a&&(a=e.height-i),void 0===s&&(s=!1);for(var l=e.data,c=t.width,u=t.height,p=t.data,d=o/c,h=a/u,f=Math.ceil(d/2),v=Math.ceil(h/2),m=e.width,y=0;y<u;y++)for(var g=0;g<c;g++){for(var _=4*(g+(s?u-y-1:y)*c),b=0,x=0,w=0,S=0,P=0,T=0,O=(y+.5)*h,C=Math.floor(y*h);C<(y+1)*h;C++)for(var M=Math.abs(O-(C+.5))/v,A=(g+.5)*d,E=M*M,I=Math.floor(g*d);I<(g+1)*d;I++){var R=Math.abs(A-(I+.5))/f,D=Math.sqrt(E+R*R);if(!(D>=1)){var L=2*D*D*D-3*D*D+1,j=4*(n+I+(i+C)*m);T+=L*l[j+3],x+=L,!r&&l[j+3]<255&&(L=L*l[j+3]/255),w+=L*l[j],S+=L*l[j+1],P+=L*l[j+2],b+=L}}p[_]=w/b,p[_+1]=S/b,p[_+2]=P/b,p[_+3]=T/x}return t},t.screenshotSuperSampleSettings=function(e,t,n){if(!t)return e;var i=e.framebufferWidth,o=e.framebufferHeight,a=e.pixelRatio,s=e.region,l=u(e,n),c=l.left+l.right,p=l.top+l.bottom,d=i-c,h=o-p,f=Math.min(8,Math.min((2048-c)/d,(2048-p)/h));return f<1.5?e:r.__assign(r.__assign({},e),{framebufferWidth:Math.round(d*f)+c,framebufferHeight:Math.round(h*f)+p,pixelRatio:a*f,resample:{region:{x:Math.round((s.x-l.left)*f)+l.left,y:Math.round((s.y-l.top)*f)+l.top,width:Math.round(s.width*f),height:Math.round(s.height*f)},width:i,height:o}})};var l=null,c=!0;function u(e,t){return!t||e&&e.ignorePadding?f:t}var p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},d="jpg",h={png:100,jpg:98,jpeg:98},f={top:0,right:0,bottom:0,left:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getElevationAtPoint=function(e,t,r){return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(156),r(168),r(168),r(151),r(238),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=i.getLogger("esri.views.3d.state.Constraints"),p=function(e){function n(t){var r=e.call(this,t)||this;return r.collision=new h,r.distance=1/0,r.minimumPoiDistance=4,r}return r.__extends(n,e),Object.defineProperty(n.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(e){"local"!==this.mode?this._set("altitude",e):u.warn("Altitude constraint is ignored in local scenes")},enumerable:!0,configurable:!0}),n.prototype.clampAltitude=function(e){return this.altitude?o.clamp(e,this.altitude.min,this.altitude.max):e},n.prototype.clampTilt=function(e,t){if(!this.tilt)return t;var r=this.tilt(e);return o.clamp(t,r.min,r.max)},n.prototype.clampDistance=function(e){return Math.min(e,this.distance)},n.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()},n.prototype.createConstantMaxTilt=function(e){return function(r,n){return void 0===n&&(n=d),n.min=t.TiltDefault.min,n.max=e,n}},n.prototype.createDefaultTiltLocal=function(){var e=this.collision.enabled?c.makePiecewiseLinearFunction([[4e3,t.TiltDefault.max],[1e4,a.deg2rad(88)],[6e6,a.deg2rad(88)]]):function(){return t.TiltDefault.max};return function(r,n){return void 0===n&&(n=d),n.min=t.TiltDefault.min,n.max=e(r),n}},n.prototype.createDefaultTiltGlobal=function(){var e=this.collision.enabled?c.makePiecewiseLinearFunction([[4e3,t.TiltDefault.max],[5e4,a.deg2rad(88)],[6e6,a.deg2rad(88)],[2e7,t.TiltDefault.min]]):c.makePiecewiseLinearFunction([[3e5,t.TiltDefault.max],[3e6,a.deg2rad(88)],[6e6,a.deg2rad(88)],[2e7,t.TiltDefault.min]]);return function(r,n){return void 0===n&&(n=d),n.min=t.TiltDefault.min,n.max=e(r),n}},r.__decorate([s.property()],n.prototype,"altitude",null),r.__decorate([s.property({readOnly:!0})],n.prototype,"collision",void 0),r.__decorate([s.property()],n.prototype,"distance",void 0),r.__decorate([s.property({readOnly:!0})],n.prototype,"minimumPoiDistance",void 0),r.__decorate([s.property()],n.prototype,"tilt",void 0),r.__decorate([s.property({constructOnly:!0})],n.prototype,"mode",void 0),r.__decorate([s.subclass("esri.views.3d.state.Constraints")],n)}(n);t.Constraints=p,t.AltitudeDefault={min:-2e5,max:4*l.earthRadius},t.TiltDefault={min:a.deg2rad(.5),max:a.deg2rad(179.5)};var d={min:0,max:0},h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.enabled=!0,t.elevationMargin=5,t}return r.__extends(t,e),r.__decorate([s.property({type:Boolean})],t.prototype,"enabled",void 0),r.__decorate([s.property({type:Number})],t.prototype,"elevationMargin",void 0),r.__decorate([s.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],t)}(n);t.default=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1607)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f32=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1174)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quatf64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(355)],void 0===(i=function(e,t,r,n,i){function o(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function a(e,t){return void 0===t&&(t=o()),s(e[0],e[1],e[2],e[3],t)}function s(e,t,r,n,i){return void 0===i&&(i=o()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function l(e,t,r){void 0===r&&(r=o()),n.vec3.copy(r,t);var i=n.vec3.dot(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&n.vec3.scale(r,r,1/Math.sqrt(i)),c(r,e,r),r}function c(e,t,r){return e!==r&&a(e,r),r[3]=-n.vec3.dot(r,t),r}function u(e,t,r,a){return void 0===a&&(a=o()),l(r,n.vec3.cross(i.sv3d.get(),t,e),a)}function p(e,t,r){var o=n.vec3.scale(i.sv3d.get(),e,n.vec3.dot(e,t));return n.vec3.subtract(r,t,o),r}function d(e,t){return n.vec3.dot(e,t)+e[3]}function h(e,t,i,o,a,s){var l=n.vec3.dot(e,i);if(0===l)return!1;var c=-(n.vec3.dot(e,t)+e[3])/l;return a&&(c=o?Math.max(0,c):r.clamp(c,0,1)),!(c<0||!o&&c>1||(n.vec3.add(s,t,n.vec3.scale(s,i,c)),0))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.wrap=function(e,t,r,n){return s(e,t,r,n,i.sv4d.get())},t.copy=a,t.fromValues=s,t.fromNormalAndOffset=function(e,t,r){return void 0===r&&(r=o()),n.vec3.copy(r,e),r[3]=t,r},t.fromPositionAndNormal=l,t.fromPoints=function(e,t,r,a){return void 0===a&&(a=o()),u(n.vec3.subtract(i.sv3d.get(),e,t),n.vec3.subtract(i.sv3d.get(),r,t),e,a)},t.setOffsetFromPoint=c,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=u,t.intersectRay=function(e,t,r){return h(e,t.origin,t.direction,!0,!1,r)},t.intersectLineSegment=function(e,t,r){return h(e,t.origin,t.vector,!1,!1,r)},t.intersectLineSegmentClamp=function(e,t,r){return h(e,t.origin,t.vector,!1,!0,r)},t.isSphereFullyInside=function(e,t){var r=t.center,n=t.radius;return d(e,r)-n>=0},t.isSphereFullyOutside=function(e,t){var r=t.center,n=t.radius;return d(e,r)+n<0},t.isPointInside=function(e,t){return d(e,t)>=0},t.isPointOutside=function(e,t){return d(e,t)<0},t.isAABBFullyInside=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5];return e[0]*(e[0]>0?r:o)+e[1]*(e[1]>0?n:a)+e[2]*(e[2]>0?i:s)+e[3]>=0},t.clip=function(e,t){var r=n.vec3.dot(e,t.ray.direction),i=-d(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;var o=i/r;return r>0?o<t.c1&&(t.c1=o):o>t.c0&&(t.c0=o),t.c0<=t.c1},t.clipInfinite=function(e,t){var r=n.vec3.dot(e,t.ray.direction),i=-d(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;var o=i/r;return r>0?o<t.c1&&(t.c1=o):o>t.c0&&(t.c0=o),t.c0<=t.c1},t.projectPoint=function(e,t,r){var o=n.vec3.scale(i.sv3d.get(),e,-e[3]),a=p(e,n.vec3.subtract(i.sv3d.get(),t,o),i.sv3d.get());return n.vec3.add(r,a,o),r},t.projectVector=p,t.distance=function(e,t){return Math.abs(d(e,t))},t.signedDistance=d,t.normal=function(e){return e},t.UP=[0,0,1,0]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(532),r(171),r(205),r(162),r(160),r(355)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){return e?{origin:a.vec3f64.clone(e.origin),direction:a.vec3f64.clone(e.direction)}:{origin:a.vec3f64.create(),direction:a.vec3f64.create()}}function c(e,t,r){return void 0===r&&(r=l()),o.vec3.copy(r.origin,e),o.vec3.copy(r.direction,t),r}function u(e,t,r){void 0===r&&(r=l());var a=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));a[2]=0,e.unprojectPoint(a,r.origin);var c=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));c[2]=1;var u=e.unprojectPoint(c,s.sv3d.get());return o.vec3.subtract(r.direction,u,r.origin),r}function p(e,t,r){void 0===r&&(r=l()),o.vec3.copy(r.origin,e.eye);var n=o.vec3.set(s.sv3d.get(),t[0],t[1],1),i=e.unprojectPoint(n,s.sv3d.get());return o.vec3.subtract(r.direction,i,r.origin),r}function d(e,t){var r=o.vec3.cross(s.sv3d.get(),o.vec3.normalize(s.sv3d.get(),e.direction),o.vec3.subtract(s.sv3d.get(),t,e.origin));return o.vec3.dot(r,r)}function h(){return{origin:null,direction:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t){var r=f.get();return r.origin=e,r.direction=t,r},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.origin,e.direction,t)},t.fromPoints=function(e,t,r){return void 0===r&&(r=l()),o.vec3.copy(r.origin,e),o.vec3.subtract(r.direction,t,e),r},t.fromValues=c,t.fromScreen=function(e,t,r){return void 0===r&&(r=l()),u(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRender=u,t.fromScreenAtEye=function(e,t,r){return void 0===r&&(r=l()),p(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRenderAtEye=p,t.distance2=d,t.distance=function(e,t){return Math.sqrt(d(e,t))},t.closestPoint=function(e,t,r){var n=o.vec3.dot(e.direction,o.vec3.subtract(r,t,e.origin));return o.vec3.add(r,e.origin,o.vec3.scale(r,e.direction,n)),r},t.createWrapper=h;var f=new r.ObjectStack(h)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(530),r(342),r(924),r(288)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.beginCamera=new s.default,r.elapsedTimeSec=0,r.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new s.default,interactionDirection:null,tiltMode:0},r}return r.__extends(t,e),t.prototype.initialize=function(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new i},Object.defineProperty(t.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0}),t.prototype.onControllerStart=function(t){this.beginCamera.copyFrom(t),this.constraintOptions.interactionStartCamera=this.beginCamera,e.prototype.onControllerStart.call(this,t)},t.prototype.stepController=function(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),o.applyAll(this.view,t,this.constraintOptions)},r.__decorate([n.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],t)}(a.AnimationController);t.MomentumController=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(238)],void 0===(i=function(e,t,r,n){function i(e,t,r){var n=r.parameters,i=r.paddingPixelsOverride;return u.scale=Math.min(n.divisor/(t-n.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u.minPixelSize=n.minPixelSize,u.paddingPixels=i,u}function o(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function a(e,t){return Math.max(r.lerp(e*t.scale,e,t.factor),o(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new s(e,l)},t.getLabelSettings=function(e){var t=l.curvatureDependent,r=l.scaleStart,n=l.scaleFallOffRange;return new s(e,{curvatureDependent:{min:{curvature:t.min.curvature,tiltAngle:t.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:t.max.curvature,tiltAngle:t.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:c.minPixelSize})},t.applyScaleFactor=a,t.applyScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var i=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return n[0]=r.lerp(e[0]*i,e[0],t.factor),n[1]=r.lerp(e[1]*i,e[1],t.factor),n},t.precomputeScaleFactor=function(e,t,r,n){n.scale=function(e,t,r){var n=i(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,a(1,n)}(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride},t.applyPrecomputedScaleFactor=function(e,t,r){void 0===r&&(r=[0,0]);var n=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r},t.scale=function(e,t,r,n){return a(e,i(t,r,n))};var s=function(){function e(e,t,r,n){void 0===r&&(r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=r,this._paddingPixelsOverride=n,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var r=this.description,n=r.scaleStart,i=r.scaleFallOffRange,o=r.minPixelSize,a=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),u=l.tiltAngle,p=l.scaleFallOffFactor,d=Math.sin(u)*s,h=.5*Math.PI-u-a*(.5-n*c),f=d/Math.cos(h),v=h+a*i*c,m=(f-p*(d/Math.cos(v)))/(1-p);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=m,t.divisor=f-m,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=p),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=p);var i=this.description.curvatureDependent,o=1+e.distance/n.earthRadius,a=Math.sqrt(o*o-1),s=[i.min.curvature,i.max.curvature],l=s[0],c=s[1],u=r.clamp((a-l)/(c-l),0,1),d=[i.min,i.max],h=d[0],f=d[1];return t.tiltAngle=r.lerp(h.tiltAngle,f.tiltAngle,u),t.scaleFallOffFactor=r.lerp(h.scaleFallOffFactor,f.scaleFallOffFactor,u),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var r=n.earthRadius*n.earthRadius,i=t.tiltAngle+.5*Math.PI,o=e.fovY,a=e.distance,s=a*a+r-2*Math.cos(i)*a*n.earthRadius,l=Math.sqrt(s),c=Math.sqrt(s-r);return(Math.acos(c/l)-Math.asin(n.earthRadius/(l/Math.sin(i)))+.5*o)/o},e}(),l={curvatureDependent:{min:{curvature:r.deg2rad(10),tiltAngle:r.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:r.deg2rad(70),tiltAngle:r.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},c={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},u={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(152),r(171),r(272),r(276),r(189),r(185),r(205),r(216),r(162),r(160),r(1666),r(173),r(317),r(443),r(591),r(344),r(651),r(195),r(592),r(249),r(372),r(446),r(804),r(1672)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function t(t,r){var n=e.call(this,r)||this;return n.techniqueConfig=new C.HUDMaterialTechniqueConfiguration,n.params=S.copyParameters(t,Y),n}return r.__extends(t,e),t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&x.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig},t.prototype.intersect=function(e,t,r,n,i,o,a,s,l){l?this.intersectDrapedHudGeometry(e,o,a,s):this.intersectHudGeometry(e,t,r,n,a,s)},t.prototype.intersectDrapedHudGeometry=function(e,t,r,n){var i=e.getAttribute(x.VertexAttrConstants.POSITION),o=e.getAttribute(x.VertexAttrConstants.SIZE),a=this.params,s=O.calculateAnchorPosForRendering(a),l=1,c=1;if(n){var u=n(q);l=u[0],c=u[5]}l*=e.pixelRatio,c*=e.pixelRatio;for(var p=J*e.pixelRatio,d=0;d<i.data.length/i.size;d++){var h=d*i.size,f=i.data[h],v=i.data[h+1],m=d*o.size;Z[0]=o.data[m]*l,Z[1]=o.data[m+1]*c;var y=void 0;a.textureIsSignedDistanceField&&(y=a.outlineSize*e.pixelRatio/2),R(t,f,v,Z,p,y,a,s)&&r()}},t.prototype.intersectHudGeometry=function(e,t,r,n,i,o){if(n.options.selectionMode&&n.options.hud&&!T.isInstanceHidden(t)){var s,c,u,p,f,v,m,y,g,_,w,S,P,C=e.data,M=this.params,A=1,E=1;if(a.mat3.fromMat4(z,r),o){var I=o(q);A=I[0],E=I[5],c=(s=z)[0],u=s[1],p=s[2],f=s[3],v=s[4],m=s[5],y=s[6],g=s[7],_=s[8],w=1/Math.sqrt(c*c+u*u+p*p),S=1/Math.sqrt(f*f+v*v+m*m),P=1/Math.sqrt(y*y+g*g+_*_),s[0]=c*w,s[1]=u*w,s[2]=p*w,s[3]=f*S,s[4]=v*S,s[5]=m*S,s[6]=y*P,s[7]=g*P,s[8]=_*P}var L=C.getVertexAttr()[x.VertexAttrConstants.POSITION],N=C.getVertexAttr()[x.VertexAttrConstants.SIZE],U=C.getVertexAttr()[x.VertexAttrConstants.NORMAL],J=C.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];x.assert(L.size>=3);var X=n.point,Y=n.camera,Q=O.calculateAnchorPosForRendering(M);A*=Y.pixelRatio,E*=Y.pixelRatio;for(var K="screen"===this.params.centerOffsetUnits,$=0;$<L.data.length/L.size;$++){var ee=$*L.size;d.vec3.set(j,L.data[ee],L.data[ee+1],L.data[ee+2]),d.vec3.transformMat4(j,j,r);var te=$*N.size;Z[0]=N.data[te]*A,Z[1]=N.data[te+1]*E,d.vec3.transformMat4(j,j,Y.viewMatrix);var re=$*J.size;if(d.vec3.set(G,J.data[re+0],J.data[re+1],J.data[re+2]),!K&&(j[0]+=G[0],j[1]+=G[1],0!==G[2])){var ne=G[2];d.vec3.normalize(G,j),d.vec3.subtract(j,j,d.vec3.scale(G,G,ne))}var ie=$*U.size;if(d.vec3.set(V,U.data[ie],U.data[ie+1],U.data[ie+2]),this.normalAndViewAngle(V,z,Y,H),this.applyVerticalOffsetTransformationView(j,H,Y,D),Y.applyProjection(j,F),F[0]>-1){var oe=Math.floor(F[0])+this.params.screenOffset[0],ae=Math.floor(F[1])+this.params.screenOffset[1];K&&(oe+=G[0],0!==G[1]&&(ae+=b.applyScaleFactor(G[1],D.factorAlignment))),b.applyPrecomputedScaleFactor(Z,D.factor,Z);var se=W*Y.pixelRatio,le=void 0;if(M.textureIsSignedDistanceField&&(le=M.outlineSize*Y.pixelRatio/2),R(X,oe,ae,Z,se,le,M,Q)){var ce=n.ray;d.vec3.transformMat4(k,j,l.mat4.invert(B,Y.viewMatrix)),F[0]=X[0],F[1]=X[1],Y.unprojectPoint(F,j);var ue=h.vec3f64.create();d.vec3.copy(ue,ce.direction);var pe=1/d.vec3.length(ue);d.vec3.scale(ue,ue,pe),i(d.vec3.distance(ce.origin,j)*pe,ue,-1,1,!0,k)}}}}},t.prototype.computeAttachmentOrigin=function(e,t){var r=e.data,n="getVertexAttr"in r?r.getVertexAttr():"vertexAttr"in r?r.vertexAttr:null;if(!n)return null;var i=x.VertexAttrConstants.POSITION,o=n[i],a="getIndices"in r?r.getIndices(i):"indices"in r?r.indices[i]:null;return y.computeAttachmentOriginPoints(o,a,t)},t.prototype.createBufferWriter=function(){return new K(this)},t.prototype.createRenderer=function(e,t){return new P(e,t,this)},t.prototype.normalAndViewAngle=function(e,t,r,n){return f.isMat4(t)&&(t=a.mat3.fromMat4(U,t)),d.vec3.transformMat3(n.normal,e,t),d.vec3.transformMat4(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=d.vec3.dot(N,X),n},t.prototype.updateScaleInfo=function(e,t,r){var n=this.params;n.screenSizePerspective?b.precomputeScaleFactor(r,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?b.precomputeScaleFactor(r,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyShaderOffsetsView=function(e,t,r,n,i,o,a){var s=this.normalAndViewAngle(t,r,i,H);return this.applyVerticalGroundOffsetView(e,s,i,a),this.applyVerticalOffsetTransformationView(a,s,i,o),this.applyPolygonOffsetView(a,s,n[3],i,a),this.applyCenterOffsetView(a,n,a),a},t.prototype.applyShaderOffsetsNDC=function(e,t,r,n,o){return this.applyCenterOffsetNDC(e,t,r,n),i.isSome(o)&&d.vec3.copy(o,n),this.applyPolygonOffsetNDC(n,t,r,n),n},t.prototype.applyPolygonOffsetView=function(e,t,r,i,o){var a=i.aboveGround?1:-1,s=n.sign(r);0===s&&(s=a);var l=a*s;if(this.params.shaderPolygonOffset<=0)return d.vec3.copy(o,e);var c=n.clamp(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/i.viewport[2];return l>0?d.vec3.scale(o,e,u):d.vec3.scale(o,e,1/u),o},t.prototype.applyVerticalGroundOffsetView=function(e,t,r,n){var i=d.vec3.length(e),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(i),s=d.vec3.scale(j,t.normal,o*a);return d.vec3.add(n,e,s),n},t.prototype.applyVerticalOffsetTransformationView=function(e,t,r,n){var i=this.params;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var o=d.vec3.length(e);this.updateScaleInfo(n,o,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}var a=d.vec3.length(e),s=i.screenSizePerspectiveAlignment||i.screenSizePerspective,l=S.verticalOffsetAtDistance(r,a,i.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(n,a,t.cosAngle),d.vec3.scale(t.normal,t.normal,l),d.vec3.add(e,e,t.normal)},t.prototype.applyCenterOffsetView=function(e,t,r){var n="screen"!==this.params.centerOffsetUnits;return r!==e&&d.vec3.copy(r,e),n&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(d.vec3.normalize(V,r),d.vec3.add(r,r,d.vec3.scale(V,V,t[2])))),r},t.prototype.applyCenterOffsetNDC=function(e,t,r,n){var i="screen"!==this.params.centerOffsetUnits;return n!==e&&d.vec3.copy(n,e),i||(n[0]+=t[0]/r.fullWidth*2,n[1]+=t[1]/r.fullHeight*2),n},t.prototype.applyPolygonOffsetNDC=function(e,t,r,i){var o=this.params.shaderPolygonOffset;if(e!==i&&d.vec3.copy(i,e),o){var a=r.aboveGround?1:-1,s=a*n.sign(t[3]);i[2]-=(s||a)*o}return i},t.prototype.getGLMaterial=function(e){return 0===e.output?new E(e):4===e.output?new I(e):void 0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=v.create()),function(e,t,r,n){void 0===n&&(n=L),u.vec2.copy(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(_.Material);t.default=M;var A=function(e){function t(t){var n=e.call(this,r.__assign(r.__assign({},t),t.material.getParameters()))||this;return n.updateParameters(),n}return r.__extends(t,e),t.prototype.beginSlot=function(e){return e===(this.params.drawInSecondSlot?19:18)},t.prototype.updateParameters=function(){this.params=S.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram()},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.params,t)},t}(g),E=function(e){function t(t){var n=e.call(this,r.__assign(r.__assign({},t),{output:0}))||this;return n.isOcclusionSlot=!1,n}return r.__extends(t,e),t.prototype.beginSlot=function(e){var t=this.params.drawInSecondSlot?19:18;return this.params.occlusionTest?(this.isOcclusionSlot=12===e,12===e||e===t):(this.isOcclusionSlot=!1,e===t)},t.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique},t.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique),this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(C.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)},t.prototype.bind=function(e,t){var r=this.getTechnique();e.bindProgram(r.program),this.isOcclusionSlot||(this.bindTexture(e,r.program),this.bindTextureScale(e,r.program)),r.bindPass(e,this.params,t)},t}(A),I=function(e){function t(t){return e.call(this,r.__assign(r.__assign({},t),{output:4}))||this}return r.__extends(t,e),t}(A);function R(e,t,r,n,i,o,a,s){var l=t-i-(s[0]>0?n[0]*s[0]:0),c=l+n[0]+2*i,u=r-i-(s[1]>0?n[1]*s[1]:0),p=u+n[1]+2*i;if(a.textureIsSignedDistanceField){var d=a.distanceFieldBoundingBox;l+=n[0]*d[0],u+=n[1]*d[1],c-=n[0]*(1-d[2]),p-=n[1]*(1-d[3]),l-=o,c+=o,u-=o,p+=o}return e[0]>l&&e[0]<c&&e[1]>u&&e[1]<p}var D={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=p.vec2f64.create(),j=h.vec3f64.create(),V=h.vec3f64.create(),F=o.createRenderScreenPointArray3(),N=h.vec3f64.create(),k=h.vec3f64.create(),z=s.mat3f64.create(),U=s.mat3f64.create(),B=c.mat4f64.create(),G=h.vec3f64.create(),H={normal:N,cosAngle:0},q=c.mat4f64.create(),W=1,J=2,Z=[0,0],X=h.vec3f64.fromValues(0,0,1),Y={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:p.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},Q=m.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),K=function(){function e(e){this.material=e,this.vertexBufferLayout=Q}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[x.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){w.writePosition(t.indices[x.VertexAttrConstants.POSITION],t.vertexAttr[x.VertexAttrConstants.POSITION].data,e.transformation,r.position,n,6),w.writeNormal(t.indices[x.VertexAttrConstants.NORMAL],t.vertexAttr[x.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,r.normal,n,6);var i=t.vertexAttr[x.VertexAttrConstants.UV0].data,o=void 0,a=void 0,s=void 0,l=void 0;if(null==i||i.length<4){var c=this.material.getParameters();o=0,a=0,s=c.texCoordScale[0],l=c.texCoordScale[1]}else o=i[0],a=i[1],s=i[2],l=i[3];s=Math.min(1.99999,s+1),l=Math.min(1.99999,l+1);for(var u=t.indices[x.VertexAttrConstants.POSITION].length,p=r.uv0,d=n,h=0;h<u;++h)p.set(d,0,o),p.set(d,1,a),d+=1,p.set(d,0,s),p.set(d,1,a),d+=1,p.set(d,0,s),p.set(d,1,l),d+=1,p.set(d,0,s),p.set(d,1,l),d+=1,p.set(d,0,o),p.set(d,1,l),d+=1,p.set(d,0,o),p.set(d,1,a),d+=1;w.writeColor(t.indices[x.VertexAttrConstants.COLOR],t.vertexAttr[x.VertexAttrConstants.COLOR].data,4,r.color,n,6);var f=t.indices[x.VertexAttrConstants.SIZE],v=t.vertexAttr[x.VertexAttrConstants.SIZE].data,m=f.length,y=r.size;for(d=n,h=0;h<m;++h)for(var g=v[2*f[h]],_=v[2*f[h]+1],b=0;b<6;++b)y.set(d,0,g),y.set(d,1,_),d+=1;t.indices[x.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS1],t.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,r.auxpos1,n,6),t.indices[x.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&w.writeBufferVec4(t.indices[x.VertexAttrConstants.AUXPOS2],t.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,r.auxpos2,n,6)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){e.setUniform3f("camPos",r[3]-t[0],r[7]-t[1],r[11]-t[2])}e.bindUniformsCustomOrigin=t,e.bindUniforms=function(e,r){t(e,r.origin,r.viewInvTransp)}}(t.Camera||(t.Camera={})),function(e){e.bindUniforms=function(e,t){e.setUniform1f("pixelRatio",t.pixelRatio||1),e.setUniform4fv("viewport",t.viewport)}}(t.Viewport||(t.Viewport={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardLinearDepth=function(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("uCameraNearFar","vec2"),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(806),r(175)],void 0===(i=function(e,t,r,n,i){function o(e,t){var o=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(n.ScreenSizePerspective),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),o.add(i.glsl(p||(p=r.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),0===t.viewingMode?i.glsl(s||(s=r.__makeTemplateObject(["vec3 worldNormal = normalize(worldPos + localOrigin);"],["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):i.glsl(l||(l=r.__makeTemplateObject(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),t.screenSizePerspectiveEnabled?i.glsl(c||(c=r.__makeTemplateObject(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):i.glsl(u||(u=r.__makeTemplateObject(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"],["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):o.add(i.glsl(d||(d=r.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function a(e,t,r,n){return void 0===n&&(n=h),n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalOffset=o,function(e){e.bindUniforms=function(e,t,r){if(t.verticalOffset){var n=a(t.verticalOffset,r.fovY,r.viewport[3]),i=r.pixelRatio||1;e.setUniform4f("verticalOffset",n.screenLength*i,n.perDistance,n.minWorldLength,n.maxWorldLength)}}}(o=t.VerticalOffset||(t.VerticalOffset={})),t.calculateVerticalOffsetFactors=a;var s,l,c,u,p,d,h={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(152),r(247)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){if(!e||e.symbol)return null;var r=t&&t.renderer;return e&&i.isSome(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function s(e,t){if(i.isSome(e.symbol))return e.symbol;var r=a(e,t);return i.isSome(r)?r.getSymbol(e,t):null}function l(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(o){return i.isSome(e.symbol)?[2,e.symbol]:(n=a(e,t),[2,i.isSome(n)&&n.getSymbolAsync(e,r.__assign(r.__assign({},t),{abortOptions:{signal:t.signal}}))])}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=a,t.getSymbol=s,t.getRenderingInfo=function(e,t){var r=a(e,t),n=s(e,t);if(!n)return null;var l={renderer:r,symbol:n};if(i.isNone(r)||!("visualVariables"in r)||!r.visualVariables)return l;for(var c=["proportional","proportional","proportional"],u=0,p=o.getVisualVariableValues(r,e,t);u<p.length;u++){var d=p[u],h=d.variable,f=d.value;switch(h.type){case"color":l.color=f.toRgba();break;case"size":if("outline"===h.target)l.outlineSize=f;else{var v=h.axis,m=h.useSymbolValue?"symbol-value":f;switch(v){case"width":c[0]=m;break;case"depth":c[1]=m;break;case"height":c[2]=m;break;case"width-and-depth":c[0]=c[1]=m;break;default:c[0]=c[1]=c[2]=m}}break;case"opacity":l.opacity=f;break;case"rotation":switch(h.axis){case"tilt":l.tilt=f;break;case"roll":l.roll=f;break;default:l.heading=f}}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(l.size=c),l},t.getSymbolAsync=l,t.getRenderingInfoAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,s,c,u,p,d,h,f,v,m,y,g;return r.__generator(this,(function(r){switch(r.label){case 0:return i=a(e,t),[4,l(e,t)];case 1:if(!(s=r.sent()))return[2,null];if(c={renderer:i,symbol:s},!(i&&"visualVariables"in i&&i.visualVariables))return[2,c];for(u=o.getVisualVariableValues(i,e,t),p=["proportional","proportional","proportional"],d=0,h=u;d<h.length;d++)f=h[d],v=f.variable,m=f.value,"color"===v.type?c.color=n.toUnitRGBA(m):"size"===v.type?"outline"===v.target?c.outlineSize=m:(y=v.axis,g=v.useSymbolValue?"symbol-value":m,"width"===y?p[0]=g:"depth"===y?p[1]=g:"height"===y?p[2]=g:p[0]=p[1]="width-and-depth"===y?g:p[2]=g):"opacity"===v.type?c.opacity=m:"rotation"===v.type&&"tilt"===v.axis?c.tilt=m:"rotation"===v.type&&"roll"===v.axis?c.roll=m:"rotation"===v.type&&(c.heading=m);return(isFinite(p[0])||isFinite(p[1])||isFinite(p[2]))&&(c.size=p),[2,c]}}))}))},t.getDriverAxisSizeValue=function(e,t){void 0===t&&(t=0);var r=e[t];return"number"==typeof r&&isFinite(r)?r:null},t.getDriverAxisSizeValueAny=function(e){for(var t=0;t<3;t++){var r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(156),r(210),r(152),r(214),r(198),r(157),r(151),r(189),r(160),r(261),r(1215),r(1216),r(536),r(288),r(1217),r(416),r(941),r(391),r(1222),r(931),r(1682),r(1224),r(797),r(1226),r(808),r(392),r(299),r(341)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R){Object.defineProperty(t,"__esModule",{value:!0});var D=o.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),L=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._hasHighlights=!1,t._rendersOccluded=!1,t._hasWater=!1,t._lighting=new M.SceneLighting,t._localOrigins=new x,t._handles=new i,t._layerRenderers=new Map,t._sortedLayerRenderersDirty=!1,t._sortedLayerRenderers=new l,t._stats=new P.RenderStatsAggregator,t._geometries=new Map,t._renderTargets={},t._uniqueIdx=0,t.longitudeCyclical=null,t}return r.__extends(n,e),n.prototype.initialize=function(){var e=this;this._rctx=this.renderView.renderingContext,this._renderContext=new S(this._rctx,null,null,null,null,null),this._stippleTextureRepository=new A.StippleTextureRepository,this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new m.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:1,commonUniformStore:new v.CommonUniformStore,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),u.init(this.waterTextureRepository,"loadingState",(function(){return e.emitContentChanged()})),this._materialRepository=new _(this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(r){(r.renderOccluded&t.overlayRenderOccludedFlag)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._bindParameters={slot:null,fovY:0,highlightDepthTexture:b.createEmptyDepthTexture(this._rctx),nearFar:[F.near,F.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1},this._lighting.set({lights:[new C.AmbientLight(h.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})},n.prototype.dispose=function(){for(var e in this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._bindParameters.highlightDepthTexture.dispose(),this._bindParameters.highlightDepthTexture=null,this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null},n.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},Object.defineProperty(n.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||a.someMap(this._layerRenderers,(function(e){return e.updating}))||this.waterTextureRepository.updating},enumerable:!0,configurable:!0}),n.prototype.commitChanges=function(){var e=this,t=!1;this._layerRenderers.forEach((function(r,n){r.commitChanges()&&(t=!0),r.isEmpty&&(e._layerRenderers.delete(n),e._sortedLayerRenderersDirty=!0,e._handles.remove(n))})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),this.notifyChange("updating"),t&&(this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())},n.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},n.prototype.addGeometries=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];null==o.origin&&(o.origin=this._localOrigins.getOrigin(o.center)),o.uniqueName||(o.uniqueName="ov:"+this._uniqueIdx++),this._geometries.set(o.uniqueName,o)}this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicUpdate(e,t,2)},n.prototype.removeGeometries=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];this._geometries.delete(o.uniqueName)}var a=this._layerRenderers.get(t);a?(a.remove(e),2===r&&this.notifyGraphicUpdate(e,t,2)):D.warn("Attempted to remove geometry for nonexistent layer")},n.prototype.updateGeometries=function(e,t,r){var n=this._layerRenderers.get(t);n?(n.modify(e,r),this.notifyUpdateGeometries(e,t,r)):D.warn("Attempted to update geometry for nonexistent layer")},n.prototype.notifyUpdateGeometries=function(e,t,r){var n=4===r||2===r?2:1===r?1:0;this.notifyGraphicUpdate(e,t,n)},n.prototype.notifyGraphicUpdate=function(e,t,r){if(0!==r)for(var n=-1,i=0,o=e;i<o.length;i++){var a=o[i].data.graphicUid;a!==n&&(t.notifyGraphicUpdate(a,r),n=a)}},n.prototype.updateHighlights=function(e,t){var r=this._layerRenderers.get(t);r?r.modify(e,8):D.warn("Attempted to update highlights for nonexistent layer")},n.prototype.isEmpty=function(){return 0===this._geometries.size&&!f.OVERLAY_DRAW_DEBUG_TEXTURE},Object.defineProperty(n.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!0,configurable:!0}),n.prototype.updateLogic=function(e){var t=!1;return this._layerRenderers.forEach((function(r){r.updateLogic(e)&&(t=!0)})),t},n.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0},n.prototype.draw=function(e,t){return this.drawPass(0,e,t)},n.prototype.drawWithoutRasterImage=function(e,t){return this.drawPass(0,e,t,2)},n.prototype.drawNormals=function(e,t){return this.drawPass(2,e,t)},n.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},n.prototype.drawOccluded=function(e,t){return this.drawPass(0,e,t,1)},n.prototype.drawPass=function(e,r,n,i){var o=this;if(void 0===i&&(i=0),0===n.numViews)return!1;if(this._pixelRatio=n.pixelRatio*Math.abs(n.views[0].extent[2]-n.views[0].extent[0])/Math.abs(n.views[0].viewport[2]-n.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights||2===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(n))return!1;var a=n.width,l=n.height,c=this._renderTargets[r];if(!c)return!1;c.resize(a,l);var u=this._rctx,p=F;if(p.pixelRatio=n.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.pixelRatio=p.pixelRatio,u.bindFramebuffer(c),u.setClearColor(0,0,0,0),u.clearSafe(16384),this.updateLightingUniforms(),1===i&&(this._renderContext.renderOccludedMask=t.overlayRenderOccludedFlag),f.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==i)for(var d=0;d<n.numViews;d++)this.setViewParameters(n.views[d],p),this.drawDebugTexture(a,l,V[n.index%V.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forEach((function(t){var r=t.layerView,d=t.renderer;if(2!==i||!s.isSome(r)||0!==r.drapeSourceType){var h=s.isSome(r)&&s.isSome(r.fullOpacity)&&r.fullOpacity<1&&0===e;h&&(o.bindTemporaryFramebuffer(a,l),u.clearSafe(16384));for(var f=0;f<n.numViews;f++)o.setViewParameters(n.views[f],p),d.draw(o._renderContext,o._bindParameters,o._stats);h&&(u.bindFramebuffer(c),o._compositingHelper.composite(o.temporaryTexture,2,s.unwrap(s.unwrap(r).fullOpacity)))}})),u.bindFramebuffer(null),c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap(),this._renderContext.resetRenderOccludedMask(),!0},n.prototype.createRenderTarget=function(e,t){for(var r=e,n=0;this._renderTargets[r];)r=e+"_"+ ++n;return this._renderTargets[r]=new E(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0}),r},n.prototype.disposeRenderTargetMemory=function(e){var t=this._renderTargets[e];t&&t.resize(0,0)},n.prototype.bindTemporaryFramebuffer=function(e,t){s.isNone(this._temporaryRenderTargetId)&&(this._temporaryRenderTargetId=this.createRenderTarget("temp",!1));var r=this._renderTargets[this._temporaryRenderTargetId];r.resize(e,t),this._rctx.bindFramebuffer(r)},Object.defineProperty(n.prototype,"temporaryTexture",{get:function(){return this._renderTargets[s.unwrap(this._temporaryRenderTargetId)].colorTexture},enumerable:!0,configurable:!0}),n.prototype.getGpuMemoryUsage=function(){var e=0;for(var t in this._renderTargets){var r=this._renderTargets[t];e+=R.getGpuMemoryUsage(r)}return e},n.prototype.getStats=function(){return this._stats.getAggregatedStats()},n.prototype.hotReloadShaders=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return e.sent(),[2]}}))}))},n.prototype.intersect=function(e,t,r){var n=this,i=0;this._geometries.forEach((function(o){if(!r||r(o)){n.intersectRenderGeometry(o,t,0,e,i);var a=n.longitudeCyclical;a&&(o.center[0]-o.bsRadius<a.min&&n.intersectRenderGeometry(o,t,a.range,e,i),o.center[0]+o.bsRadius>a.max&&n.intersectRenderGeometry(o,t,-a.range,e,i)),i++}}))},n.prototype.intersectRenderGeometry=function(e,t,r,n,i){var o=this,a=0;s.isSome(e.transformation)&&(r+=e.transformation[12],a=e.transformation[13]),N[0]=t[0]-r,N[1]=t[1]-a,N[2]=1,k[0]=t[0]-r,k[1]=t[1]-a,k[2]=0,e.pixelRatio=this._pixelRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,N,k,(function(t,r,a){o.addIntersectionResult(a,e.material.renderPriority,i,n,e.data.layerUid,e.data.graphicUid)}),e.calculateShaderTransformation,!0)},n.prototype.addIntersectionResult=function(e,t,r,n,i,o){var a={type:"external",metadata:{layerUid:i,graphicUid:o}},s=function(i){i.set(a,null,n.results.ground.dist,n.results.ground.normal,n.results.ground.transformation,t,null,null,e,r),i.intersector="OverlayRenderer"};if((null==n.results.min.drapedLayerOrder||t>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&s(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||t<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&s(n.results.max),2===n.options.store){var l=new w.IntersectorResult(n.ray);s(l),n.results.all.push(l)}},n.prototype.stopAnimationsAtTime=function(e){this._sortedLayerRenderers.forEach((function(t){return t.renderer.stopAnimationsAtTime(e)}))},n.prototype.ensureLayerRenderer=function(e){var t=this,r=this._layerRenderers.get(e);return r||(r=new T.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,r),this._sortedLayerRenderersDirty=!0,this._handles.add([e.watch("fullOpacity",(function(){return t.emitContentChanged()})),u.init(r,"updating",(function(){return t.notifyChange("updating")}))],e)),r},n.prototype.updateSortedLayerRenderers=function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=a.firstKeyOfMap(this._layerRenderers).view.allLayerViews,r=c.SetFromValues(a.valuesOfMap(this._layerRenderers));t.forEach((function(t){var n=t,i=e._layerRenderers.get(n);i&&(e._sortedLayerRenderers.push(new j(n,i)),r.delete(i))})),r.forEach((function(t){e._sortedLayerRenderers.push(new j(null,t))}))}},n.prototype.setViewParameters=function(e,t){t.viewport=e.viewport;var r=e.extent;d.mat4.ortho(t.projectionMatrix,0,r[2]-r[0],0,r[3]-r[1],t.near,t.far),d.mat4.identity(t.viewMatrix),d.mat4.translate(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,this._bindParameters.viewport=t.fullViewport,this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach((function(e){e.setUniformMatrix4fv("proj",t.projectionMatrix)}))},n.prototype.updateLightingUniforms=function(){var e=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach((function(t){e._lighting.setUniforms(t)}))},n.prototype.hasNonZeroSizedView=function(e){for(var t=0;t<e.numViews;t++){var r=e.views[t];if(r.extent[0]!==r.extent[2]&&r.extent[1]!==r.extent[3])return!0}return!1},n.prototype.emitContentChanged=function(){this.onContentChanged&&this.onContentChanged()},n.prototype.updateHasWater=function(){var e=a.someMap(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e)},n.prototype.updateHasHighlights=function(){var e=a.someMap(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))},n.prototype.updateRendersOccluded=function(){var e=a.someMap(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))},n.prototype.drawDebugTexture=function(e,t,r){var n=this._rctx;this.ensureDebugPatternResources(e,t);var i=this._debugPatternProgram;n.bindProgram(i),n.setPipelineState(this._debugPatternPipelineState),i.setUniform4f("color",r[0],r[1],r[2],1),i.setUniform1i("tex",0),n.bindTexture(this._debugPatternTexture,0),n.bindVAO(this._quadVAO),n.drawArrays(5,0,R.vertexCount(this._quadVAO,"geometry"))},n.prototype.ensureDebugPatternResources=function(e,t){if(!this._debugPatternTexture){for(var r=new Uint8Array(e*t*4),n=0,i=0;i<t;i++)for(var o=0;o<e;o++){var a=Math.floor(o/10),s=Math.floor(i/10);a<2||s<2||10*a>e-20||10*s>t-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&a&&1&s?1&o^1&i?0:255:1&a^1&s?0:128)}this._debugPatternTexture=new I(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);var l=new O.TextureTechniqueConfiguration;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(O.TextureTechnique,l,this._debugTextureTechnique),this._debugPatternProgram=this._debugTextureTechnique.program,this._debugPatternPipelineState=this._debugTextureTechnique.pipeline,this._quadVAO=b.createQuadVAO(this._rctx)}},Object.defineProperty(n.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0}),r.__decorate([y.autoDispose()],n.prototype,"_shaderTechniqueRepository",void 0),r.__decorate([y.autoDispose()],n.prototype,"_stippleTextureRepository",void 0),r.__decorate([p.property(),y.autoDispose()],n.prototype,"waterTextureRepository",void 0),r.__decorate([p.property()],n.prototype,"renderView",void 0),r.__decorate([p.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],n.prototype,"updating",null),r.__decorate([p.subclass("esri.views.3d.terrain.OverlayRenderer")],n)}(y.AutoDisposableMixin(n));t.OverlayRenderer=L;var j=function(e,t){this.layerView=e,this.renderer=t},V=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],F=new g.default;F.near=1,F.far=1e4;var N=h.vec3f64.create(),k=h.vec3f64.create();t.DRAPED_Z=-2,t.overlayRenderOccludedFlag=4}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TextureCoordinateAttribute=function(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n      }\n    "]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n        vuvRegion = uvRegion;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n        vuvRegion = uvRegion;\n      }\n    "]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void forwardTextureCoordinates() {}\n    "],["\n      void forwardTextureCoordinates() {}\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(809),r(449),r(175)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){0===t.normalType||1===t.normalType?(e.include(n.NormalAttribute,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      void forwardNormal() {\n        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "],["\n      void forwardNormal() {\n        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):2===t.normalType?(e.include(i.VertexPosition,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "],["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),0===t.viewingMode?o.glsl(l||(l=r.__makeTemplateObject(["normalize(vPositionWorldCameraRelative);"],["normalize(vPositionWorldCameraRelative);"]))):o.glsl(c||(c=r.__makeTemplateObject(["vec3(0.0, 0.0, 1.0);"],["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(o.glsl(p||(p=r.__makeTemplateObject(["\n      void forwardNormal() {}\n    "],["\n      void forwardNormal() {}\n    "]))))}var s,l,c,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexNormal=a,function(e){e.bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t.viewInvTransp)}}(a=t.VertexNormal||(t.VertexNormal={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1694),r(812),r(1240),r(803),r(934),r(447),r(175)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u,p,d,h,f,v,m,y,g,_,b,x,w;Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluateSceneLighting=function(e,t){var S=e.fragment;e.include(o.EvaluateMainLighting),e.include(i.EvaluateAmbientOcclusion,t),0!==t.pbrMode&&e.include(a.PhysicallyBasedRendering,t),e.include(n.EvaluateAmbientLighting,t),t.receiveShadows&&e.include(l.ReadShadowMap,t),S.uniforms.add("lightingGlobalFactor","float"),S.uniforms.add("ambientBoostFactor","float"),e.include(s.PiUtils),S.code.add(c.glsl(u||(u=r.__makeTemplateObject(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "],["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),t.useOldSceneLightInterface?S.code.add(c.glsl(p||(p=r.__makeTemplateObject(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot = -0.5;\n        float dotRange = 1.0 - minDot;\n        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight = mainLight + ambientLight + additionalLight;\n      totalLight = min(totalLight, vec3(PI));\n      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "],["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot = -0.5;\n        float dotRange = 1.0 - minDot;\n        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight = mainLight + ambientLight + additionalLight;\n      totalLight = min(totalLight, vec3(PI));\n      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "])))):(0===t.viewingMode?S.code.add(c.glsl(d||(d=r.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld = normalize(vPosWorld);\n        float vndl = -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld = normalize(vPosWorld);\n        float vndl = -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):S.code.add(c.glsl(h||(h=r.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),S.code.add(c.glsl(f||(f=r.__makeTemplateObject(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "],["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),0===t.pbrMode||4===t.pbrMode?S.code.add(c.glsl(v||(v=r.__makeTemplateObject(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight = mainLighting + ambientLighting + additionalLight;\n        totalLight = min(totalLight, vec3(PI));\n        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "],["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight = mainLighting + ambientLighting + additionalLight;\n        totalLight = min(totalLight, vec3(PI));\n        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "])))):1!==t.pbrMode&&2!==t.pbrMode||(S.code.add(c.glsl(m||(m=r.__makeTemplateObject(["\n      const float fillLightIntensity = 0.25;\n      const float horizonLightDiffusion = 0.4;\n      const float additionalAmbientIrradianceFactor = 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection = -viewDir;\n        vec3 mainLightDirection = -lightingMainDirection;\n        vec3 h = normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView = normalize(reflect(viewDirection, normal));\n        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao = ssao;\n\n        inputs.metalness = mrr[0];\n        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "],["\n      const float fillLightIntensity = 0.25;\n      const float horizonLightDiffusion = 0.4;\n      const float additionalAmbientIrradianceFactor = 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection = -viewDir;\n        vec3 mainLightDirection = -lightingMainDirection;\n        vec3 h = normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView = normalize(reflect(viewDirection, normal));\n        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao = ssao;\n\n        inputs.metalness = mrr[0];\n        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),S.code.add(c.glsl(y||(y=r.__makeTemplateObject(["\n        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0\n        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "],["\n        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0\n        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),S.code.add(c.glsl(g||(g=r.__makeTemplateObject(["\n        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir = abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "],["\n        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir = abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),S.code.add(c.glsl(_||(_=r.__makeTemplateObject(["\n        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon = dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "],["\n        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon = dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),S.code.add(c.glsl(w||(w=r.__makeTemplateObject(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "],["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?c.glsl(b||(b=r.__makeTemplateObject(["vec3 outColor = pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"],["vec3 outColor = pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"]))):c.glsl(x||(x=r.__makeTemplateObject(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"],["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(168),r(189),r(185),r(162),r(160),r(193),r(173),r(238),r(203),r(1183),r(251),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=.5*Math.PI,m=v/Math.PI*180,y=v*u.earthRadius,g=.9*u.earthRadius,_=function(){function e(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:s.vec3f64.create(),direction:s.vec3f64.create()};for(var t=0;t<4;t++)this.extent[t]={origin:s.vec3f64.create(),direction:s.vec3f64.create(),cap:{next:null,direction:s.vec3f64.create()}},this.planes[t]=p.plane.create();this.planes[4]=p.plane.create(),this.planes[5]=p.plane.create(),this.planesWithoutFar=this.planes.slice(0,5)}return e.prototype.update=function(e,t,r,n){void 0===n&&(n=!0);var i=this.extent;this.toRenderBoundingExtent(e,t,r),a.vec3.add(this.center.origin,i[0].origin,i[2].origin),a.vec3.scale(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),n||a.vec3.scale(this.center.direction,this.center.direction,-1);for(var o=0;o<4;o++){var s=i[o];this.renderCoordsHelper.worldUpAtPosition(s.origin,s.direction);var l=i[3===o?0:o+1];s.cap.next=l.origin,h.directionFromTo(s.cap.direction,s.origin,l.origin),p.plane.fromVectorsAndPoint(s.direction,s.cap.direction,s.origin,this.planes[o]),n||a.vec3.scale(s.direction,s.direction,-1)}p.plane.fromVectorsAndPoint(i[0].cap.direction,i[1].cap.direction,i[0].origin,this.planes[4]),n?p.plane.negate(this.planes[4],this.planes[5]):(p.plane.copy(this.planes[4],this.planes[5]),p.plane.negate(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t},e.prototype.isVisibleInFrustum=function(e,t){if(void 0===t&&(t=!1),null==e)return!1;if("global"===this.renderCoordsHelper.type){var r=this.maxSpanSpatialReference.isGeographic?m:y;if(this.maxSpan>r)return!0;if(e.altitude>=g)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){var n=this.extent[0];return!(t||!e.intersectsRay(p.ray.wrap(n.origin,n.direction)))}for(var i=0;i<this.extent.length;i++){if(n=this.extent[i],!t&&e.intersectsRay(p.ray.wrap(n.origin,n.direction)))return!0;if(e.intersectsLineSegment(p.lineSegment.fromPoints(n.origin,n.cap.next,T),n.cap.direction))return!0}var o=t?this.planes:this.planesWithoutFar;for(i=0;i<e.lines.length;i++){var a=e.lines[i];if(d.frustumLineSegment(o,a.origin,a.endpoint,a.direction))return!0}return!1},e.prototype.toRenderBoundingExtentGlobal=function(e,t,r){c.center(e,x),x[2]=r,f.computeLinearTransformation(t,x,w,this.renderCoordsHelper.spatialReference),i.mat4.invert(S,w),l.empty(P);for(var o=0,s=b;o<s.length;o++)for(var u=s[o],p=u.x0,d=u.x1,h=u.y0,v=u.y1,m=0;m<5;m++){var y=m/4;x[0]=n.lerp(e[p],e[d],y),x[1]=n.lerp(e[h],e[v],y),x[2]=r,f.vectorToVector(x,t,x,this.renderCoordsHelper.spatialReference),a.vec3.transformMat4(x,x,S),l.expandPointInPlace(P,x)}for(a.vec3.set(this.extent[0].origin,P[0],P[1],P[2]),a.vec3.set(this.extent[1].origin,P[3],P[1],P[2]),a.vec3.set(this.extent[2].origin,P[3],P[4],P[2]),a.vec3.set(this.extent[3].origin,P[0],P[4],P[2]),m=0;m<4;++m)a.vec3.transformMat4(this.extent[m].origin,this.extent[m].origin,w)},e.prototype.toRenderBoundingExtentLocal=function(e,t){a.vec3.set(this.extent[0].origin,e[0],e[1],t),a.vec3.set(this.extent[1].origin,e[2],e[1],t),a.vec3.set(this.extent[2].origin,e[2],e[3],t),a.vec3.set(this.extent[3].origin,e[0],e[3],t)},e.prototype.toRenderBoundingExtent=function(e,t,n){switch(this.renderCoordsHelper.type){case"global":this.toRenderBoundingExtentGlobal(e,t,n);break;case"local":this.toRenderBoundingExtentLocal(e,n);break;default:r.neverReached(this.renderCoordsHelper.type)}},e.prototype.isVisibleInFrustumGlobal=function(e){if(a.vec3.dot(this.center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this.extent[t];if(a.vec3.dot(r.direction,e.direction)<0)return!0}return!1},e}();t.FrustumExtentIntersection=_;var b=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],x=s.vec3f64.create(),w=o.mat4f64.create(),S=o.mat4f64.create(),P=l.create(),T=p.lineSegment.create();t.default=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(153),r(305)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.support.WorkerHandle"),s=function(){function e(e,t,n,i){var s=this;void 0===i&&(i={}),this._methodName=t,this._promise=o.open(e,r.__assign(r.__assign({},i),{scheduler:n})).then((function(e){void 0===s._thread?(s._thread=e,s._promise=null):e.close()})),this._promise.catch((function(t){return a.error("Failed to initialize "+e+" worker: "+t)}))}return e.prototype.destroy=function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null},e.prototype.invoke=function(e,t){var r=this;if(void 0===t&&(t=null),this._thread){var n=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:n,signal:t})}return this._promise?this._promise.then((function(){return i.throwIfAborted(t),r.invoke(e,t)})):i.reject(null)},e.prototype.broadcast=function(e,t){var r=this;return this._thread?i.all(this._thread.broadcast(t,e)).then((function(){})):this._promise?this._promise.then((function(){return r.broadcast(e,t)})):i.reject()},Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),e}();t.WorkerHandle=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(172),r(273)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createForItem=function(e){return{origin:"portal-item",url:r.urlToObject(e.itemUrl),portal:e.portal||n.getDefault(),portalItem:e,readResourcePaths:[]}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(204),r(1788),r(598)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n,i,o,a){var l=e.call(this,t,n,i,[4096,4096])||this;return l._referenced=0,l._symbolFadeHold=null,l._vectorTileData=null,l._symbolUpdateData=null,l._memoryUsed=s,l.rotation=0,l.layerData={},l.status="loading",l._referenced=1,l.styleLayers=r,l.id=t.id,l.rotation=o,l._cacheWorkerTiles=a,l}return r.__extends(t,e),Object.defineProperty(t.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<performance.now()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0}),t.prototype.setData=function(e,t,r){this._vectorTileData=e,this.client=t,this.refKeys=r,this._memoryUsed=s,this.ready()},t.prototype.updateSymbolData=function(e){e&&(this._symbolUpdateData=e,this.requestRender())},t.prototype.updateTileData=function(e){this._vectorTileData=e,this.stage.requestRender(),this._memoryUsed=s},t.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null},t.prototype.setSymbolHoldDuration=function(e){this._symbolFadeHold=performance.now()+e},t.prototype.hasData=function(){return Object.keys(this.layerData).length>0},t.prototype.dispose=function(){this._cacheWorkerTiles&&this.client&&this.client.invoke("destructTileData",this.id).catch((function(){})),this._deleteBufferMemory(),this.destroy(),this._memoryUsed=s},t.prototype.release=function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)},t.prototype.reference=function(){++this._referenced},Object.defineProperty(t.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0}),t.prototype.getMemoryUsage=function(){var e=this;return this._memoryUsed===s&&(this._memoryUsed=l.reduce((function(t,r){return e[r]?t+e[r].size:t}),0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce((function(e,t){return e+t.byteLength}),this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength))),this._memoryUsed/(this._referenced||1)},t.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)return this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),void(this._vectorTileData=null)):void(this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null))},t.prototype._deleteBufferMemory=function(){for(var e=0,t=["fillVertexArrayObject","fillDDVertexArrayObject","outlineVertexArrayObject","lineVertexArrayObject","lineDDVertexArrayObject","iconVertexArrayObject","iconDDVertexArrayObject","textVertexArrayObject","textDDVertexArrayObject","circleVertexArrayObject","fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer","texture"];e<t.length;e++){var r=t[e];this[r]&&(this[r].dispose(),this[r]=null)}this.layerData={},this.triangleCount=0},t.prototype._createRenderBuckets=function(){for(var e=new Uint32Array(this._vectorTileData.bucketDataInfo),t=e.length,r=0;r<t;){var n=e[r];switch(e[r+1]){case 0:(new i.BackgroundRenderBucket).layerID=n,r+=2;break;case 1:var o=new i.FillRenderBucket;o.layerID=n,o.triangleElementStart=e[r+2],o.triangleElementCount=e[r+3],o.outlineElementStart=e[r+4],o.outlineElementCount=e[r+5],0===o.triangleElementCount&&0===o.outlineElementCount||(this.layerData[n]=o),r+=6;break;case 2:var a=new i.LineRenderBucket;a.layerID=n,a.triangleElementStart=e[r+2],a.triangleElementCount=e[r+3],a.triangleElementCount>0&&(this.layerData[n]=a),r+=4;break;case 3:var s=new i.SymbolRenderBucket;s.layerID=n,s.isSDF=0!==e[r+2];var l=r+3,c=e[l];l++;for(var u=0;u<c;u++){var p=e[l],d=e[l+1],h=e[l+2];s.iconPerPageElementsMap.set(p,[d,h]),l+=3}var f=l,v=e[f];for(f++,u=0;u<v;u++)p=e[f],d=e[f+1],h=e[f+2],s.glyphPerPageElementsMap.set(p,[d,h]),f+=3;(s.iconPerPageElementsMap.size>0||s.glyphPerPageElementsMap.size>0)&&(this.layerData[n]=s),r+=5+3*c+3*v;break;case 4:var m=new i.CircleRenderBucket;m.layerID=n,m.triangleElementStart=e[r+2],m.triangleElementCount=e[r+3],m.triangleElementCount>0&&(this.layerData[n]=m),r+=4;break;default:console.error("Bad bucket type!"),r+=2}}},t.prototype.attachWithContext=function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}},t.prototype._updateSymbolData=function(e){if(!e||!e.bucketDataInfo)return!0;var t=new Uint32Array(e.bucketDataInfo),r=t.length;if(0===r)return!0;if(!this.isReady)return this.requestRender(),!1;for(var o=this.stage.context,a=new Uint32Array(e.bufferDataInfo),s=a.length,l=0,c=0;c<s;c+=2,l++)switch(a[c]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null),this.iconVertexBuffer=n.BufferObject.createVertex(o,35044,e.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null),this.iconDDVertexBuffer=n.BufferObject.createVertex(o,35044,e.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null),this.iconIndexBuffer=n.BufferObject.createIndex(o,35044,e.bufferData[l]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null),this.textVertexBuffer=n.BufferObject.createVertex(o,35044,e.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null),this.textDDVertexBuffer=n.BufferObject.createVertex(o,35044,e.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=n.BufferObject.createIndex(o,35044,e.bufferData[l])}var u={};for(var p in this.layerData)3!==this.layerData[p].type&&(u[p]=this.layerData[p]);this.layerData=u;for(var d,h=this.styleLayers.layers,f=0;f<r;){p=t[f],(d=new i.SymbolRenderBucket).layerID=p,d.isSDF=0!==t[f+2],h.length>d.layerID&&h[d.layerID].type===d.type&&(u[d.layerID]=d);var v=f+3,m=t[v];v++;for(var y=0;y<m;y++){var g=t[v],_=t[v+1],b=t[v+2];d.iconPerPageElementsMap.set(g,[_,b]),v+=3}var x=v,w=t[x];for(x++,y=0;y<w;y++)g=t[x],_=t[x+1],b=t[x+2],d.glyphPerPageElementsMap.set(g,[_,b]),x+=3;f+=5+3*m+3*w}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null),!0},t._createBufferToObject=function(){var e=[];return e[1]={create:n.BufferObject.createVertex,var:"fillVertexBuffer"},e[2]={create:n.BufferObject.createVertex,var:"fillDDVertexBuffer"},e[3]={create:n.BufferObject.createIndex,var:"fillIndexBuffer"},e[4]={create:n.BufferObject.createVertex,var:"outlineVertexBuffer"},e[5]={create:n.BufferObject.createVertex,var:"outlineDDVertexBuffer"},e[6]={create:n.BufferObject.createIndex,var:"outlineIndexBuffer"},e[7]={create:n.BufferObject.createVertex,var:"lineVertexBuffer"},e[8]={create:n.BufferObject.createVertex,var:"lineDDVertexBuffer"},e[9]={create:n.BufferObject.createIndex,var:"lineIndexBuffer"},e[10]={create:n.BufferObject.createVertex,var:"iconVertexBuffer"},e[11]={create:n.BufferObject.createVertex,var:"iconDDVertexBuffer"},e[12]={create:n.BufferObject.createIndex,var:"iconIndexBuffer"},e[13]={create:n.BufferObject.createVertex,var:"textVertexBuffer"},e[14]={create:n.BufferObject.createVertex,var:"textDDVertexBuffer"},e[15]={create:n.BufferObject.createIndex,var:"textIndexBuffer"},e[16]={create:n.BufferObject.createVertex,var:"circleVertexBuffer"},e[17]={create:n.BufferObject.createIndex,var:"circleIndexBuffer"},e},t.prototype._createBufferObjects=function(){for(var e=this.stage.context,r=new Uint32Array(this._vectorTileData.bufferDataInfo),n=r.length,i=0;i<n;i+=2){var o=i/2;if(!(r[i+1]<=0||0===this._vectorTileData.bufferData[o].byteLength)){var a=r[i],s=t.bufferToObject[a];s?this[s.var]?this[s.var].setData(this._vectorTileData.bufferData[o]):this[s.var]=s.create(e,35044,this._vectorTileData.bufferData[o]):console.error("Bad buffer type "+a)}}},t.bufferToObject=t._createBufferToObject(),t}(o.TiledDisplayObject);t.VectorTile=a;var s=-1,l=["fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer"]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(204)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createRasterTexture=function(e,t,n,i){void 0===n&&(n="nearest"),void 0===i&&(i=!1);var o=!(i&&"u8"===t.pixelType),a=o?5126:5121,s=null==t.pixels||0===t.pixels.length?null:o?t.getAsRGBAFloat():t.getAsRGBA(),l={width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===n||"cubic"===n?9729:9728,dataType:a,wrapMode:33071,flipped:!1};return new r.Texture(e,l,s)},t.createFrameBuffer=function(e,t,n,i){var o={width:t,height:n,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:i?5121:5126,wrapMode:33071,flipped:!1},a=new r.Texture(e,o);return new r.FramebufferObject(e,{colorTarget:0,depthStencilTarget:3,width:t,height:n},a)},t.createTransformTexture=function(e,t){for(var n=4*t.size[0],i=t.size[1],o={width:n,height:i,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},a=new Float32Array(n*i*4),s=0,l=0;l<t.coefficients.length;l++)a[s++]=t.coefficients[l],l%3==2&&(a[s++]=1);return new r.Texture(e,o,a)},t.createColormapTexture=function(e,t){var n={width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1};return new r.Texture(e,n,t)},t.getCommonUniforms=function(e,t,r,n,i,o){return void 0===n&&(n=1),void 0===i&&(i=!0),void 0===o&&(o=!1),{u_flipY:i,u_isFloatTexture:o,u_applyTransform:!!e,u_opacity:n,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:r}},t.getColormapUniforms=function(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}},t.getBasicGridUniforms=function(e,t){return{u_scale:e,u_offset:t}},t.getStretchUniforms=function(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}},t.getShadedReliefUniforms=function(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}},t.getUniformLocationInfos=function(e,t){for(var r,n=e.gl,i=t.glName,o=n.getProgramParameter(i,n.ACTIVE_UNIFORMS),a=new Map,s=0;s<o;s++)(r=n.getActiveUniform(i,s))&&a.set(r.name,{location:n.getUniformLocation(i,r.name),info:r});return a},t.setUniforms=function(e,t,r){Object.keys(r).forEach((function(n){var i=t.get(n)||t.get(n+"[0]");i&&function(e,t,r,n){if(null===n||null==r)return!1;var i=n.info;switch(i.type){case 5126:i.size>1?e.setUniform1fv(t,r):e.setUniform1f(t,r);break;case 35664:e.setUniform2fv(t,r);break;case 35665:e.setUniform3fv(t,r);break;case 35666:e.setUniform4fv(t,r);break;case 35675:e.setUniformMatrix3fv(t,r);break;case 35676:e.setUniformMatrix4fv(t,r);break;case 5124:i.size>1?e.setUniform1iv(t,r):e.setUniform1i(t,r);break;case 35670:e.setUniform1i(t,r?1:0);break;case 35667:case 35671:e.setUniform2iv(t,r);break;case 35668:case 35672:e.setUniform3iv(t,r);break;case 35669:case 35673:e.setUniform4iv(t,r);break;default:;}}(e,n,r[n],i)}))},t.setTextures=function(e,t,r,n){r.length===n.length&&(n.some((function(e){return null==e}))||r.some((function(e){return null==e}))||r.forEach((function(r,i){t.setUniform1i(r,i),e.bindTexture(n[i],i)})))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(153),r(157),r(151),r(453),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.TiledLayerView3D=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpaque",{get:function(){return this.fullOpacity>=1&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLevelRange",{get:function(){var e=this.tileInfo.lods,t=e[0].scale,r=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLevelRange",{get:function(){var e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,r=this.layer.maxScale||e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,r);return this.layer.maxScale&&n.maxLevel++,n},enumerable:!0,configurable:!0}),t.prototype.getTileUrl=function(e,t,r){return this.layer.getTileUrl(e,t,r)},t.prototype._addTilingSchemeMatchPromise=function(){var e=this,t=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);if(t)this.addResolvingPromise(i.reject(t));else{var r=o.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then((function(){var t=e.view.basemapTerrain.tilingScheme,r=e._getTileInfoCompatibilityError(e.tileInfo,t);if(r)throw r}));this.addResolvingPromise(r)}},t.prototype._getTileInfoSupportError=function(e,t){var r=l.checkIfTileInfoSupportedForView(e,t,this.view.spatialReference,this.view.basemapTerrain.manifold);if(r){var i={layer:this.layer,error:r},o=void 0;switch(r.name){case"tilingscheme:local-gcs-not-supported":o=new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",i);break;case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":o=new n("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",i);break;default:o=new n("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",i)}return o}return null},t.prototype._getTileInfoCompatibilityError=function(e,t){return t.compatibleWith(e)?null:new n("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")},t.prototype.levelRangeFromScaleRange=function(e,t){var r={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return r;var i=n.levels[0],o=function(e){var t=Math.log(i.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(r.minLevel=Math.max(0,o(e))),null!=t&&t>0&&(r.maxLevel=Math.max(0,o(t))),r},t.prototype.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)},r.__decorate([a.property({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),r.__decorate([a.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],t.prototype,"updating",void 0),r.__decorate([a.property(s.updatingProgress)],t.prototype,"updatingProgress",void 0),r.__decorate([a.property(s.updatingProgressValue)],t.prototype,"updatingProgressValue",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"fullExtent",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],t.prototype,"isOpaque",null),r.__decorate([a.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],t.prototype,"dataLevelRange",null),r.__decorate([a.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],t.prototype,"displayLevelRange",null),r.__decorate([a.property()],t.prototype,"layer",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([a.subclass("esri.views.3d.layers.TiledLayerView3D")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return{near:e,far:t}}function n(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?n(e,1/0,-1/0):r(1/0,-1/0)},t.set=n,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r},t.within=function(e,t){return e.near<=t&&t<=e.far}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(123),o=r(122),a=r(850);if(t.Symbol=o.default.Symbol,!i.default("es6-symbol")){var s=function(e){if(!v(e))throw new TypeError(e+" is not a symbol");return e},l=Object.defineProperties,c=Object.defineProperty,u=Object.create,p=Object.prototype,d={},h=(n=u(null),function(e){for(var t,r=0;n[String(e)+(r||"")];)++r;return e+=String(r||""),n[e]=!0,t="@@"+e,Object.getOwnPropertyDescriptor(p,t)||c(p,t,{set:function(e){c(this,t,a.getValueDescriptor(e))}}),t}),f=function e(t){if(this instanceof f)throw new TypeError("TypeError: Symbol is not a constructor");return e(t)};t.Symbol=o.default.Symbol=function e(t){if(this instanceof e)throw new TypeError("TypeError: Symbol is not a constructor");var r=Object.create(f.prototype);return t=void 0===t?"":String(t),l(r,{__description__:a.getValueDescriptor(t),__name__:a.getValueDescriptor(h(t))})},c(t.Symbol,"for",a.getValueDescriptor((function(e){return d[e]?d[e]:d[e]=t.Symbol(String(e))}))),l(t.Symbol,{keyFor:a.getValueDescriptor((function(e){var t;for(t in s(e),d)if(d[t]===e)return t})),hasInstance:a.getValueDescriptor(t.Symbol.for("hasInstance"),!1,!1),isConcatSpreadable:a.getValueDescriptor(t.Symbol.for("isConcatSpreadable"),!1,!1),iterator:a.getValueDescriptor(t.Symbol.for("iterator"),!1,!1),match:a.getValueDescriptor(t.Symbol.for("match"),!1,!1),observable:a.getValueDescriptor(t.Symbol.for("observable"),!1,!1),replace:a.getValueDescriptor(t.Symbol.for("replace"),!1,!1),search:a.getValueDescriptor(t.Symbol.for("search"),!1,!1),species:a.getValueDescriptor(t.Symbol.for("species"),!1,!1),split:a.getValueDescriptor(t.Symbol.for("split"),!1,!1),toPrimitive:a.getValueDescriptor(t.Symbol.for("toPrimitive"),!1,!1),toStringTag:a.getValueDescriptor(t.Symbol.for("toStringTag"),!1,!1),unscopables:a.getValueDescriptor(t.Symbol.for("unscopables"),!1,!1)}),l(f.prototype,{constructor:a.getValueDescriptor(t.Symbol),toString:a.getValueDescriptor((function(){return this.__name__}),!1,!1)}),l(t.Symbol.prototype,{toString:a.getValueDescriptor((function(){return"Symbol ("+s(this).__description__+")"})),valueOf:a.getValueDescriptor((function(){return s(this)}))}),c(t.Symbol.prototype,t.Symbol.toPrimitive,a.getValueDescriptor((function(){return s(this)}))),c(t.Symbol.prototype,t.Symbol.toStringTag,a.getValueDescriptor("Symbol",!1,!1,!0)),c(f.prototype,t.Symbol.toPrimitive,a.getValueDescriptor(t.Symbol.prototype[t.Symbol.toPrimitive],!1,!1,!0)),c(f.prototype,t.Symbol.toStringTag,a.getValueDescriptor(t.Symbol.prototype[t.Symbol.toStringTag],!1,!1,!0))}function v(e){return e&&("symbol"==typeof e||"Symbol"===e["@@toStringTag"])||!1}t.isSymbol=v,["hasInstance","isConcatSpreadable","iterator","species","replace","search","split","match","toPrimitive","toStringTag","unscopables","observable"].forEach((function(e){t.Symbol[e]||Object.defineProperty(t.Symbol,e,a.getValueDescriptor(t.Symbol.for(e),!1,!1))})),t.default=t.Symbol},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152)],void 0===(i=function(e,t,r){function n(e){return{remove:function(){e&&(e(),e=null)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.handlesGroup=function(e){return n((function(){return e.forEach((function(e){return r.isSome(e)&&e.remove()}))}))},t.makeHandle=n,t.refHandle=function(e){return n((function(){var t=e();r.isSome(t)&&t.remove()}))},t.destroyHandle=function(e){return n((function(){return e.destroy()}))},t.timeoutHandle=function(e,t){var r=setTimeout(e,t);return{remove:function(){return clearTimeout(r)}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(119),r(515)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.reader=function(e,t,i){var o,a;return void 0===t||Array.isArray(t)?(a=e,i=t,o=[void 0]):(a=t,o=Array.isArray(e)?e:[e]),function(e,t){var s=e.constructor.prototype;o.forEach((function(o){var l=n.propertyJSONMeta(e,o,a);l.read&&"object"!=typeof l.read&&(l.read={}),r.setDeepValue("read.reader",s[t],l),i&&(l.read.source=(l.read.source||[]).concat(i))}))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(117),o=r(122),a=r(853),s=r(123);if(r(758),t.WeakMap=o.default.WeakMap,!s.default("es6-weakmap")){var l={},c=(n=Math.floor(Date.now()%1e8),function(){return"__wm"+Math.floor(1e8*Math.random())+n+++"__"});t.WeakMap=function(){function e(e){if(this[Symbol.toStringTag]="WeakMap",this._name=c(),this._frozenEntries=[],e)if(a.isArrayLike(e))for(var t=0;t<e.length;t++){var r=e[t];this.set(r[0],r[1])}else try{for(var n=i.__values(e),o=n.next();!o.done;o=n.next()){var s=i.__read(o.value,2),l=s[0],u=s[1];this.set(l,u)}}catch(e){p={error:e}}finally{try{o&&!o.done&&(d=n.return)&&d.call(n)}finally{if(p)throw p.error}}var p,d}return e.prototype._getFrozenEntryIndex=function(e){for(var t=0;t<this._frozenEntries.length;t++)if(this._frozenEntries[t].key===e)return t;return-1},e.prototype.delete=function(e){if(null==e)return!1;var t=e[this._name];if(t&&t.key===e&&t.value!==l)return t.value=l,!0;var r=this._getFrozenEntryIndex(e);return r>=0&&(this._frozenEntries.splice(r,1),!0)},e.prototype.get=function(e){if(null!=e){var t=e[this._name];if(t&&t.key===e&&t.value!==l)return t.value;var r=this._getFrozenEntryIndex(e);return r>=0?this._frozenEntries[r].value:void 0}},e.prototype.has=function(e){if(null==e)return!1;var t=e[this._name];return!!Boolean(t&&t.key===e&&t.value!==l)||this._getFrozenEntryIndex(e)>=0},e.prototype.set=function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Invalid value used as weak map key");var r=e[this._name];return r&&r.key===e||(r=Object.create(null,{key:{value:e}}),Object.isFrozen(e)?this._frozenEntries.push(r):Object.defineProperty(e,this._name,{value:r})),r.value=t,this},e}()}t.default=t.WeakMap},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o){var a=new n.default({inherited:"inherited",codedValue:"coded-value",range:"range"});return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.type=null,r}return r.__extends(t,e),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([o.enumeration(a)],t.prototype,"type",void 0),r.__decorate([o.subclass("esri.layers.support.Domain")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1446),r(155),r(151),r(179),r(366),r(477)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.dateFormat=null,r.digitSeparator=!1,r.places=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})},t.prototype.format=function(e){return this.dateFormat?s.formatDate(e,s.convertDateFormatToIntlOptions(this.dateFormat)):l.formatNumber(e,l.convertNumberFormatToIntlOptions(this))},r.__decorate([o.enumeration(n.dictionary)],t.prototype,"dateFormat",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"digitSeparator",void 0),r.__decorate([o.property({type:a.Integer,json:{write:!0}})],t.prototype,"places",void 0),i=r.__decorate([o.subclass("esri.popup.support.FieldInfoFormat")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(1108),r(767),r(518),r(1109),r(1110),r(1111),r(1112)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){return function(e){function t(t){var r=e.call(this,t)||this;return r.mediaInfos=null,r.type="media",r}var s;return r.__extends(t,e),s=t,t.prototype.readMediaInfos=function(e){return e&&e.map((function(e){return"image"===e.type?l.fromJSON(e):"barchart"===e.type?o.fromJSON(e):"columnchart"===e.type?a.fromJSON(e):"linechart"===e.type?c.fromJSON(e):"piechart"===e.type?u.fromJSON(e):void 0})).filter(Boolean)},t.prototype.writeMediaInfos=function(e,t){t.mediaInfos=e&&e.map((function(e){return e.toJSON()}))},t.prototype.clone=function(){return new s({mediaInfos:this.mediaInfos?n.clone(this.mediaInfos):null})},r.__decorate([i.property({types:[p.types]})],t.prototype,"mediaInfos",void 0),r.__decorate([i.reader("mediaInfos")],t.prototype,"readMediaInfos",null),r.__decorate([i.writer("mediaInfos")],t.prototype,"writeMediaInfos",null),r.__decorate([i.property({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),s=r.__decorate([i.subclass("esri.popup.content.MediaContent")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(863),r(864)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r.value=null,r}return r.__extends(t,e),r.__decorate([n.property({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([n.property({type:o,json:{write:!0}})],t.prototype,"value",void 0),r.__decorate([n.subclass("esri.popup.content.mixins.ChartMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.chartTypeKebabDict=r.strict()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(765),r(766)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="column-chart",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,caption:this.caption,value:this.value?this.value.clone():null})},r.__decorate([n.property({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:o.chartTypeKebabDict.write}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.ColumnChartMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(518)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.text=null,r.type="text",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({text:this.text})},r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),r.__decorate([n.property({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.TextContent")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.title=null,r.expression=null,r.returnType=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),r.__decorate([i.property({type:["string","number"],json:{write:!0}})],t.prototype,"returnType",void 0),n=r.__decorate([i.subclass("esri.popup.ExpressionInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(239),r(166),r(118),r(156),r(152),r(153),r(151),r(179),r(191),r(524),r(631),r(1482),r(368),r(246),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){var _=s.getLogger("esri.renderers.ClassBreaksRenderer"),b=new o.default({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),x=p.ensureType(v);return function(e){function t(t){var r=e.call(this,t)||this;return r.backgroundFillSymbol=null,r.classBreakInfos=null,r.defaultLabel=null,r.defaultSymbol=null,r.field=null,r.isMaxInclusive=!0,r.legendOptions=null,r.normalizationField=null,r.normalizationTotal=null,r.type="class-breaks",r.valueExpression=null,r.valueExpressionTitle=null,r._set("classBreakInfos",[]),r}var o;return r.__extends(t,e),o=t,Object.defineProperty(t.prototype,"_cache",{get:function(){return{compiledFunc:null}},enumerable:!0,configurable:!0}),t.prototype.readClassBreakInfos=function(e,t,r){if(Array.isArray(e)){var n=t.minValue;return e.map((function(e){var t=new v;return t.read(e,r),null==t.minValue&&(t.minValue=n),null==t.maxValue&&(t.maxValue=t.minValue),n=t.maxValue,t}))}},t.prototype.writeClassBreakInfos=function(e,t,r,n){var i=e.map((function(e){return e.write({},n)}));this._areClassBreaksConsecutive()&&i.forEach((function(e){return delete e.classMinValue})),t[r]=i},t.prototype.readDefaultSymbol=function(e,t,r){return g.read(e,t,r)},t.prototype.writeDefaultSymbolWebScene=function(e,t,r,n){g.writeTarget(e,t,r,n)},t.prototype.writeDefaultSymbol=function(e,t,r,n){g.writeTarget(e,t,r,n)},t.prototype.castField=function(e){return null==e?e:"function"==typeof e?(_.error(".field: field must be a string value"),null):p.ensureString(e)},Object.defineProperty(t.prototype,"minValue",{get:function(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalizationType",{get:function(){var e=this._get("normalizationType"),t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=(t?"field":r&&"percent-of-total")||null,t&&r&&_.warn("warning: both normalizationField and normalizationTotal are set!")):"field"!==e&&"percent-of-total"!==e||(e=null),e},set:function(e){this._set("normalizationType",e)},enumerable:!0,configurable:!0}),t.prototype.addClassBreakInfo=function(e,t,r){var n;n="number"==typeof e?new v({minValue:e,maxValue:t,symbol:i.ensureType(r)}):x(a.clone(e)),this.classBreakInfos.push(n),1===this.classBreakInfos.length&&this.notifyChange("minValue")},t.prototype.removeClassBreakInfo=function(e,t){for(var r=this.classBreakInfos.length,n=0;n<r;n++){var i=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue];if(i[0]===e&&i[1]===t){this.classBreakInfos.splice(n,1);break}}},t.prototype.getBreakIndex=function(e,t){return this.valueExpression&&(l.isNone(t)||l.isNone(t.arcade))&&_.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)},t.prototype.getClassBreakInfo=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return n=t,this.valueExpression&&(l.isNone(t)||l.isNone(t.arcade))?(i=[r.__assign({},n)],o={},[4,y.loadArcade()]):[3,2];case 1:n=r.__assign.apply(void 0,i.concat([(o.arcade=s.sent(),o)])),s.label=2;case 2:return[2,-1!==(a=this.getBreakIndex(e,n))?this.classBreakInfos[a]:null]}}))}))},t.prototype.getSymbol=function(e,t){if(!this.valueExpression||!l.isNone(t)&&!l.isNone(t.arcade)){var r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used")},t.prototype.getSymbolAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return n=t,this.valueExpression&&(l.isNone(t)||l.isNone(t.arcade))?(i=[r.__assign({},n)],o={},[4,y.loadArcade()]):[3,2];case 1:n=r.__assign.apply(void 0,i.concat([(o.arcade=s.sent(),o)])),s.label=2;case 2:return[2,(a=this.getBreakIndex(e,n))>-1?this.classBreakInfos[a].symbol:this.defaultSymbol]}}))}))},t.prototype.getSymbols=function(){var e=[];return this.classBreakInfos.forEach((function(t){t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e},t.prototype.getAttributeHash=function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")},t.prototype.getMeshHash=function(){var e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.normalizationField+"."+this.normalizationType+"."+this.normalizationTotal;return e+"."+t+"."+this.classBreakInfos.reduce((function(e,t){return e+t.getMeshHash()}),"")+"."+r+"."+this.field+"."+this.valueExpression},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new o({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:a.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:a.clone(this.visualVariables),legendOptions:a.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)],[4,c.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.collectSymbolFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(i){switch(i.label){case 0:return n=r.__spreadArrays(this.getSymbols().map((function(r){return r.collectRequiredFields(e,t)})),[d.collectArcadeFieldNames(e,t,this.valueExpression)]),d.collectField(e,t,this.field),d.collectField(e,t,this.normalizationField),[4,c.all(n)];case 1:return i.sent(),[2]}}))}))},t.prototype._getBreakIndexForExpression=function(e,t){var r=l.unwrapOr(t,{}),n=r.viewingMode,i=r.scale,o=r.spatialReference,a=r.arcade,s=this._cache.compiledFunc,c=l.unwrap(a).arcadeUtils;if(!s){var u=c.createSyntaxTree(this.valueExpression);s=c.createFunction(u),this._cache.compiledFunc=s}var p=c.executeFunction(s,c.createExecContext(e,c.getViewInfo({viewingMode:n,scale:i,spatialReference:o})));return this._getBreakIndexfromInfos(p)},t.prototype._getBreakIndexForField=function(e){var t=this.field,r=e.attributes,n=this.normalizationType,i=parseFloat(r[t]);if(n){var o=this.normalizationTotal,a=parseFloat(r[this.normalizationField]);if("log"===n)i=Math.log(i)*Math.LOG10E;else if("percent-of-total"!==n||isNaN(o)){if("field"===n&&!isNaN(a)){if(isNaN(i)||isNaN(a))return-1;i/=a}}else i=i/o*100}return this._getBreakIndexfromInfos(i)},t.prototype._getBreakIndexfromInfos=function(e){var t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(var r=0;r<this.classBreakInfos.length;r++){var n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]<=e&&(t?e<=n[1]:e<n[1]))return r}return-1},t.prototype._areClassBreaksConsecutive=function(){for(var e=this.classBreakInfos,t=e.length,r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0},r.__decorate([u.property({readOnly:!0,dependsOn:["valueExpression"]})],t.prototype,"_cache",null),r.__decorate([u.property({types:{base:n.BaseSymbol,key:"type",typeMap:{"simple-fill":i.symbolTypesRenderer.typeMap["simple-fill"],"picture-fill":i.symbolTypesRenderer.typeMap["picture-fill"],"polygon-3d":i.symbolTypesRenderer.typeMap["polygon-3d"]}},json:{origins:{"web-scene":{type:n.PolygonSymbol3D,read:g.read,write:g.writeTarget}},read:g.read,write:g.writeTarget}})],t.prototype,"backgroundFillSymbol",void 0),r.__decorate([u.property({type:[v]})],t.prototype,"classBreakInfos",void 0),r.__decorate([u.reader("classBreakInfos")],t.prototype,"readClassBreakInfos",null),r.__decorate([u.writer("classBreakInfos")],t.prototype,"writeClassBreakInfos",null),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"defaultLabel",void 0),r.__decorate([u.property({types:i.symbolTypesRenderer})],t.prototype,"defaultSymbol",void 0),r.__decorate([u.reader("defaultSymbol")],t.prototype,"readDefaultSymbol",null),r.__decorate([u.writer("web-scene","defaultSymbol",{defaultSymbol:{types:i.symbolTypesRenderer3D}})],t.prototype,"writeDefaultSymbolWebScene",null),r.__decorate([u.writer("defaultSymbol")],t.prototype,"writeDefaultSymbol",null),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([u.cast("field")],t.prototype,"castField",null),r.__decorate([u.property({type:Boolean})],t.prototype,"isMaxInclusive",void 0),r.__decorate([u.property({type:m.default,json:{write:!0}})],t.prototype,"legendOptions",void 0),r.__decorate([u.property({type:Number,readOnly:!0,value:null,dependsOn:["classBreakInfos"],json:{read:!1,write:{overridePolicy:function(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],t.prototype,"minValue",null),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"normalizationField",void 0),r.__decorate([u.property({type:Number,cast:function(e){return p.ensureNumber(e)},json:{write:!0}})],t.prototype,"normalizationTotal",void 0),r.__decorate([u.property({type:b.apiValues,value:null,dependsOn:["normalizationField","normalizationTotal"],json:{type:b.jsonValues,read:b.read,write:b.write}})],t.prototype,"normalizationType",null),r.__decorate([u.enumeration({classBreaks:"class-breaks"})],t.prototype,"type",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),o=r.__decorate([u.subclass("esri.renderers.ClassBreaksRenderer")],t)}(f.VisualVariablesMixin(h))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(155),r(153),r(151),r(868),r(772),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.access=null,n.created=null,n.culture=null,n.description=null,n.email=null,n.fullName=null,n.modified=null,n.orgId=null,n.portal=null,n.preferredView=null,n.privileges=null,n.region=null,n.role=null,n.roleId=null,n.sourceJSON=null,n.units=null,n.username=null,n.userType=null,n}var o;return n.__extends(t,e),o=t,Object.defineProperty(t.prototype,"thumbnailUrl",{get:function(){var e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(e+"/info/"+t+"?f=json"):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userContentUrl",{get:function(){var e=this.get("portal.restUrl");return e?e+"/content/users/"+this.username:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){var e=this.get("portal.restUrl");return e?e+"/community/users/"+this.username:null},enumerable:!0,configurable:!0}),t.prototype.addItem=function(e){var t=this,r=e&&e.item,n=e&&e.data,i=e&&e.folder,o={method:"post"};r&&(o.query=r.createPostQuery(),null!=n&&("string"==typeof n?o.query.text=n:"object"==typeof n&&(o.query.text=JSON.stringify(n))));var a=this.userContentUrl;return i&&(a+="/"+("string"==typeof i?i:i.id)),this.portal._request(a+"/addItem",o).then((function(e){return r.id=e.id,r.portal=t.portal,r.loaded?r.reload():r.load()}))},t.prototype.deleteItem=function(e){var t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+"/items/"+e.id+"/delete",{method:"post"}).then((function(){e.id=null,e.portal=null}))},t.prototype.deleteItems=function(e){var t=this.userContentUrl+"/deleteItems",r=e.map((function(e){return e.id}));if(r.length){var n={method:"post",query:{items:r.join(",")}};return this.portal._request(t,n).then((function(){e.forEach((function(e){e.id=null,e.portal=null}))}))}return a.resolve(void 0)},t.prototype.fetchFolders=function(){var e=this;return this.portal._request(this.userContentUrl,{query:{num:1}}).then((function(t){return t&&t.folders?t.folders.map((function(t){var r=l.fromJSON(t);return r.portal=e.portal,r})):[]}))},t.prototype.fetchGroups=function(){var e=this;return this.portal._request(this.url).then((function(t){return t&&t.groups?t.groups.map((function(t){var r=c.fromJSON(t);return r.portal=e.portal,r})):[]}))},t.prototype.fetchItems=function(e){var t=this;e||(e={});var n,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(283)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){n=r;var o={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return t.portal._request(i,{query:o})})).then((function(e){var r;return e&&e.items?(r=e.items.map((function(e){var r=n.fromJSON(e);return r.portal=t.portal,r})),a.all(r.map((function(e){return e.load()}))).catch((function(e){return e})).then((function(){return{items:r,nextStart:e.nextStart,total:e.total}}))):{items:[],nextStart:-1,total:0}}))},t.prototype.fetchTags=function(){return this.portal._request(this.url+"/tags").then((function(e){return e.tags}))},t.prototype.getThumbnailUrl=function(e){var t=this.thumbnailUrl;return t&&e&&(t+="&w="+e),t},t.prototype.queryFavorites=function(e){return this.favGroupId?(this._favGroup||(this._favGroup=new c({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):a.reject(new i("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))},t.prototype.toJSON=function(){throw new i("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")},t.fromJSON=function(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");var t=new o;return t.sourceJSON=e,t.read(e),t},n.__decorate([s.property()],t.prototype,"access",void 0),n.__decorate([s.property({type:Date})],t.prototype,"created",void 0),n.__decorate([s.property()],t.prototype,"culture",void 0),n.__decorate([s.property()],t.prototype,"description",void 0),n.__decorate([s.property()],t.prototype,"email",void 0),n.__decorate([s.property()],t.prototype,"favGroupId",void 0),n.__decorate([s.property()],t.prototype,"fullName",void 0),n.__decorate([s.property({type:Date})],t.prototype,"modified",void 0),n.__decorate([s.property()],t.prototype,"orgId",void 0),n.__decorate([s.property()],t.prototype,"portal",void 0),n.__decorate([s.property()],t.prototype,"preferredView",void 0),n.__decorate([s.property()],t.prototype,"privileges",void 0),n.__decorate([s.property()],t.prototype,"region",void 0),n.__decorate([s.property()],t.prototype,"role",void 0),n.__decorate([s.property()],t.prototype,"roleId",void 0),n.__decorate([s.property()],t.prototype,"sourceJSON",void 0),n.__decorate([s.property()],t.prototype,"thumbnail",void 0),n.__decorate([s.property({dependsOn:["url","thumbnail","portal.credential.token"],readOnly:!0})],t.prototype,"thumbnailUrl",null),n.__decorate([s.property()],t.prototype,"units",void 0),n.__decorate([s.property({dependsOn:["portal.restUrl"],readOnly:!0})],t.prototype,"userContentUrl",null),n.__decorate([s.property({dependsOn:["portal.restUrl"],readOnly:!0})],t.prototype,"url",null),n.__decorate([s.property()],t.prototype,"username",void 0),n.__decorate([s.property()],t.prototype,"userType",void 0),o=n.__decorate([s.subclass("esri.portal.PortalUser")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(155),r(151),r(179),r(624)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.access=null,r.created=null,r.description=null,r.id=null,r.isInvitationOnly=!1,r.modified=null,r.owner=null,r.portal=null,r.snippet=null,r.sortField=null,r.sortOrder=null,r.tags=null,r.title=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"thumbnailUrl",{get:function(){var e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(e+"/info/"+t+"?f=json"):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){var e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null},enumerable:!0,configurable:!0}),t.prototype.fetchCategorySchema=function(e){var t=this;return this.portal._request(this.url+"/categorySchema",e).then((function(r){var n=r.categorySchema||[];return n.some((function(e){return"contentCategorySetsGroupQuery.LivingAtlas"===e.source}))?t._fetchCategorySchemaSet("LivingAtlas",e):n}))},t.prototype.fetchMembers=function(e){return this.portal._request(this.url+"/users",e)},t.prototype.getThumbnailUrl=function(e){var t=this.thumbnailUrl;return t&&e&&(t+="&w="+e),t},t.prototype.toJSON=function(){throw new n("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")},t.prototype.queryItems=function(e,t){var r=a.ensureType(s,e);return parseFloat(this.portal.currentVersion)>5?(r=r||new s,this.portal._queryPortal("/content/groups/"+this.id+"/search",r,"PortalItem",t)):((r=r?r.clone():new s).query="group:"+this.id+(r.query?" "+r.query:""),this.portal.queryItems(r,t))},t.prototype._fetchCategorySchemaSet=function(e,t){var r=this;return this.portal._fetchSelf(this.portal.authMode,!0,t).then((function(e){var i=e.contentCategorySetsGroupQuery;if(i){var o=new s;return o.disableExtraQuery=!0,o.num=1,o.query=i,r.portal.queryGroups(o,t)}throw new n("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((function(r){if(r.total){var i=r.results[0],o=new s;return o.num=1,o.query='typekeywords:"'+e+'"',i.queryItems(o,t)}throw new n("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((function(e){return e.total?e.results[0].fetchData("json",t).then((function(e){var t=e&&e.categorySchema;return t&&t.length?t:[]})):[]}))},r.__decorate([o.property()],t.prototype,"access",void 0),r.__decorate([o.property({type:Date})],t.prototype,"created",void 0),r.__decorate([o.property()],t.prototype,"description",void 0),r.__decorate([o.property()],t.prototype,"id",void 0),r.__decorate([o.property()],t.prototype,"isInvitationOnly",void 0),r.__decorate([o.property({type:Date})],t.prototype,"modified",void 0),r.__decorate([o.property()],t.prototype,"owner",void 0),r.__decorate([o.property()],t.prototype,"portal",void 0),r.__decorate([o.property()],t.prototype,"snippet",void 0),r.__decorate([o.property()],t.prototype,"sortField",void 0),r.__decorate([o.property()],t.prototype,"sortOrder",void 0),r.__decorate([o.property()],t.prototype,"tags",void 0),r.__decorate([o.property()],t.prototype,"thumbnail",void 0),r.__decorate([o.property({dependsOn:["url","thumbnail","portal.credential.token"],readOnly:!0})],t.prototype,"thumbnailUrl",null),r.__decorate([o.property()],t.prototype,"title",void 0),r.__decorate([o.property({dependsOn:["portal.restUrl"],readOnly:!0})],t.prototype,"url",null),r.__decorate([o.subclass("esri.portal.PortalGroup")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(156),r(153),r(869)],void 0===(i=function(e,t,r,n,i,o,a){var s=this;Object.defineProperty(t,"__esModule",{value:!0});var l=i.getLogger("esri/symbols/support/cimSymbolUtils"),c=function(){function e(e,t){this.layers=e,this.data=t}return Object.defineProperty(e.prototype,"type",{get:function(){return"expanded-cim"},enumerable:!0,configurable:!0}),e.prototype.hash=function(){for(var e="",t=0,r=this.layers;t<r.length;t++)e+=r[t].templateHash;return e},e}();t.expandSymbols=function(e,n,i){return r.__awaiter(s,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,o.all(e.map((function(e){return t.expandSymbol(e,n,i)})))]}))}))};var u=function(e,t){return r.__awaiter(s,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=c.bind,[4,a.analyzeCIMSymbol(e.data,t)];case 1:return[2,new(n.apply(c,[void 0,r.sent(),e.data]))]}}))}))};function p(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return!e.data&&e.styleUrl&&e.styleName?(n=e.styleName,i=e,[4,h(n,e.styleUrl,t)]):[2,e];case 1:return i.data=r.sent(),[2,e]}}))}))}t.expandSymbol=function(e,t,n){return r.__awaiter(s,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return e?"cim"!==e.type?[3,2]:(i=u,[4,p(e,n)]):[2,null];case 1:return[2,i.apply(void 0,[r.sent(),t])];case 2:return"web-style"!==e.type?[3,4]:(o=u,[4,e.fetchCIMSymbol(n)]);case 3:return[2,o.apply(void 0,[r.sent(),t])];case 4:return[2,e]}}))}))},t.fetchSymbol=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return e?"cim"===e.type?[2,p(e,t)]:"web-style"===e.type?[2,e.fetchCIMSymbol(t)]:[2,e]:[2,null]}))}))},t.fetchCIMData=p,t.makeSymbolRef=function(e,t){return null===e?null:"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e,primitiveOverrides:t}};var d=new Map;function h(e,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a;return r.__generator(this,(function(s){if(d.has(e))return[2,d.get(e).then((function(e){return t.makeSymbolRef(e.data)}))];try{return a=n(i+"/resources/styles/cim/"+e+".json",r.__assign({responseType:"json",query:{f:"json"}},o)),d.set(e,a),[2,a.then((function(e){return t.makeSymbolRef(e.data)}))]}catch(t){return l.error("error requesting "+e+", reason is "+t.message),d.has(e)&&d.delete(e),[2,null]}return[2]}))}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.setIdentity()}return e.prototype.getAngle=function(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz},e.prototype.setIdentity=function(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0},e.prototype.setTranslate=function(e,t){this.tx=e,this.ty=t},e.prototype.setTranslateZ=function(e){this.tz=e},e.prototype.setRotateCS=function(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t},e.prototype.setRotate=function(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0},e.prototype.setRotateY=function(e){this.ry=e},e.prototype.setScale=function(e){this.s=e},e.prototype.setMeasure=function(e){this.m=e},e}();t.Placement=r;var n=function(){function e(){}return e.prototype.next=function(){return null},e}();t.EmptyPlacementCursor=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}return e.prototype.isEmpty=function(){return 0===this._values.length},e.prototype.size=function(){return this._values.length},e.prototype.init=function(e,t,r){if(void 0===r&&(r=!0),this._setEmpty(),!e||0===e.length)return!1;for(var n=0;n<e.length;n++){var i=Math.abs(e[n]);r&&i<1e-7&&(i=1e-7),this._values.push(i),this._length+=i}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)},e.prototype.scale=function(e){for(var t=this._values?this._values.length:0,r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e},e.prototype.addValue=function(e){this._length+=e,this._values.push(e)},e.prototype.firstValue=function(){return this._values[0]},e.prototype.lastValue=function(){return this._values[this._values.length-1]},e.prototype.nextValue=function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]},e.prototype.reset=function(){this._currentValue=-1},e.prototype.length=function(){return this._length},e.prototype._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0},e}();t.DashPattern=o;var a=function(){function e(){this.reset()}return e.prototype.reset=function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1},e.prototype.isValid=function(){return-1!==this.segment},e.prototype.copyTo=function(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd},e}(),s=function(e){function t(t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var n=e.call(this,t,r)||this;return n._tolerance=i.PIXEL_TOLERANCE,n._currentPosition=new a,n}return r.__extends(t,e),t.prototype.updateTolerance=function(e){this._tolerance=i.PIXEL_TOLERANCE*e},t.prototype.init=function(e,t,r){return void 0===r&&(r=!0),r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this.setPosAtNextPart()},t.prototype.curPositionIsValid=function(){return this._currentPosition.isValid()},t.prototype.nextPosition=function(e,t){void 0===t&&(t=0);var r=new a;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)},t.prototype.curPointAndAngle=function(e){e.pt=this._getPoint(this._currentPosition);var t=this._getAngle(this._currentPosition),r=t[0],n=t[1];e.ca=r,e.sa=n},t.prototype.nextPointAndAngle=function(e,t,r){void 0===r&&(r=0);var n=new a;if(!this._nextPosition(e,n,null,r))return!1;n.copyTo(this._currentPosition),t.pt=this._getPoint(n);var i=this._getAngle(n),o=i[0],s=i[1];return t.ca=o,t.sa=s,!0},t.prototype.nextCurve=function(e){if(0===e)return null;var t=[],r=new a;return this._nextPosition(e,r,t,1)?(r.copyTo(this._currentPosition),t):null},t.prototype.isPathEnd=function(){return this._currentPosition.isPathEnd},t.prototype.getPathEnd=function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]},t.prototype._nextPosition=function(e,t,r,n){if(this._currentPosition.isPathEnd)return!1;var i=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(i/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.length)if(0===i){var o=this._path[t.segment];r.push([o[0],o[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,i));var a=this._path[t.segment+1];r.push([a[0],a[1]])}if(i=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this.nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==n&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,1===n?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){0===r.length&&(0===i?(a=this._path[t.segment],r.push([a[0],a[1]])):r.push(this.getSegCoord2D(this._path,t.segment,i)));var s=t.abscissa/t.segmentLength;1===s?(a=this._path[t.segment+1],r.push([a[0],a[1]])):r.push(this.getSegCoord2D(this._path,t.segment,s))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0},t.prototype._getPoint=function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)},t.prototype._getAngle=function(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)},t.prototype.setPosAtNextPart=function(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===n.getId(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}for(var e=this._partSegCount;e;)this.previousSegment(),--e;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;var t=this.getStartPointIndex();this._ctrlPtBegin=1===n.getId(this._path[t]);var r=t+this._partSegCount+1;if(r>=this._path.length&&(r=0),this._ctrlPtEnd=1===n.getId(this._path[r]),this._patternLength>0){var i=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,o=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,a=Math.round((this._partLength-(i+o))/this._patternLength);a<=0&&(a=i+o>0?0:1),this._partLengthRatio=this._partLength/(i+o+a*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0},t.prototype.hasNextSegment=function(){return this._seg<this._path.length-2},t.prototype.previousSegment=function(){return--this._seg},t.prototype.nextSegment=function(){return++this._seg},t.prototype.getStartPointIndex=function(){return this._seg},t.prototype.getEndPointIndex=function(){return this._seg+1},t}(i.CurveHelper);t.GeometryWalker=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(179)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.opacityToTransparency=function(e){var t=r.ensureInteger(100*(1-e));return Math.max(0,Math.min(t,100))},t.transparencyToOpacity=function(e){var t=1-e/100;return Math.max(0,Math.min(t,1))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(152),r(172),r(151),r(409),r(876),r(627),r(386),r(1118),r(482),r(1117)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f=n.getLogger("esri.symbols.IconSymbol3DLayer"),v=function(e){function t(t){var r=e.call(this,t)||this;return r.material=null,r.resource=null,r.type="icon",r.size=12,r.anchor="center",r.anchorPosition=void 0,r.outline=void 0,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:i.isSome(this.material)?this.material.clone():null,outline:i.isSome(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})},t.fromSimpleMarkerSymbol=function(e){var t=e.color||l.white,r=m(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||l.white).clone()}:null;return new n({size:e.size,resource:{primitive:_(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})},t.fromPictureMarkerSymbol=function(e){var t=!e.color||l.isBlack(e.color)?l.white:e.color,r=m(e);return new n({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})},t.fromCIMSymbol=function(e){return new n({resource:{href:o.makeData({mediaType:"application/json",data:JSON.stringify(e.data)})}})},r.__decorate([a.property({type:d.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([a.property({type:c.default,json:{write:!0}})],t.prototype,"resource",void 0),r.__decorate([a.enumeration({Icon:"icon"})],t.prototype,"type",void 0),r.__decorate([a.property(u.screenSizeProperty)],t.prototype,"size",void 0),r.__decorate([a.enumeration({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),a.property({json:{default:"center"}})],t.prototype,"anchor",void 0),r.__decorate([a.property({type:p.Symbol3DAnchorPosition2D,json:{type:[Number],read:{reader:function(e){return new p.Symbol3DAnchorPosition2D({x:e[0],y:e[1]})}},write:{writer:function(e,t){t.anchorPosition=[e.x,e.y]},overridePolicy:function(){return{enabled:"relative"===this.anchor}}}}})],t.prototype,"anchorPosition",void 0),r.__decorate([a.property({type:h.default,json:{write:!0}})],t.prototype,"outline",void 0),n=r.__decorate([a.subclass("esri.symbols.IconSymbol3DLayer")],t)}(s);function m(e){var t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,n=y(e.xoffset),i=y(e.yoffset);return(n||i)&&t&&r?{x:-n/t,y:i/r}:null}function y(e){return isFinite(e)?e:0}var g={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function _(e){return g[e]||(f.warn(e+' cannot be mapped to Icon symbol. Fallback to "circle"'),"circle")}return v}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(152),r(171),r(151),r(409),r(876),r(386),r(482)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.material=null,r.type="line",r.join="miter",r.cap="butt",r.size=o.px2pt(1),r.stipplePattern=null,r.stippleOffColor=null,r}var s;return r.__extends(t,e),s=t,t.prototype.clone=function(){return new s({enabled:this.enabled,material:i.isSome(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})},t.fromSimpleLineSymbol=function(e){return new s({size:e.width||1,cap:e.cap||"butt",join:e.join||"miter",material:{color:(e.color||l.white).clone()}})},r.__decorate([a.property({type:u.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([a.enumeration({Line:"line"})],t.prototype,"type",void 0),r.__decorate([a.property({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],t.prototype,"join",void 0),r.__decorate([a.property({type:["butt","square","round"],json:{write:!0,default:"butt"}})],t.prototype,"cap",void 0),r.__decorate([a.property(c.screenSizeProperty)],t.prototype,"size",void 0),r.__decorate([a.property(c.stipplePatternProperty)],t.prototype,"stipplePattern",void 0),r.__decorate([a.property({type:n})],t.prototype,"stippleOffColor",void 0),s=r.__decorate([a.subclass("esri.symbols.LineSymbol3DLayer")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(151),r(409),r(577),r(1476),r(482)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.material=null,r.castShadows=!0,r.resource=null,r.type="object",r.width=void 0,r.height=void 0,r.depth=void 0,r.anchor=void 0,r.anchorPosition=void 0,r.heading=void 0,r.tilt=void 0,r.roll=void 0,r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:n.isSome(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})},Object.defineProperty(t.prototype,"isPrimitive",{get:function(){return!this.resource||"string"!=typeof this.resource.href},enumerable:!0,configurable:!0}),r.__decorate([i.property({type:l.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([i.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t.prototype,"castShadows",void 0),r.__decorate([i.property({type:a.default,json:{write:!0}})],t.prototype,"resource",void 0),r.__decorate([i.enumeration({Object:"object"})],t.prototype,"type",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"height",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"depth",void 0),r.__decorate([i.enumeration({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),i.property({json:{default:"origin"}})],t.prototype,"anchor",void 0),r.__decorate([i.property({type:s.Symbol3DAnchorPosition3D,json:{type:[Number],read:{reader:function(e){return new s.Symbol3DAnchorPosition3D({x:e[0],y:e[1],z:e[2]})}},write:{writer:function(e,t){t.anchorPosition=[e.x,e.y,e.z]},overridePolicy:function(){return{enabled:"relative"===this.anchor}}}}})],t.prototype,"anchorPosition",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"heading",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"tilt",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"roll",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["resource","resource.href"]})],t.prototype,"isPrimitive",null),o=r.__decorate([i.subclass("esri.symbols.ObjectSymbol3DLayer")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(166),r(118),r(171),r(151),r(884),r(429)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=new i.default({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.color=new n([255,255,255,.25]),i.type="simple-marker",i.size=12,i.style="circle",i.outline=new c,i}var i;return r.__extends(t,e),i=t,t.prototype.normalizeCtorArgs=function(e,t,r,n){if(e&&"string"!=typeof e)return e;var i={};return e&&(i.style=e),null!=t&&(i.size=a.toPt(t)),r&&(i.outline=r),n&&(i.color=n),i},t.prototype.writeColor=function(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)},Object.defineProperty(t.prototype,"path",{set:function(e){this.style="path",this._set("path",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({angle:this.angle,color:o.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})},t.prototype.hash=function(){var t;return e.prototype.hash.call(this)+"."+(this.color&&this.color.hash())+"."+this.path+"."+this.style+"."+(null===(t=this.outline)||void 0===t?void 0:t.hash())},r.__decorate([s.property()],t.prototype,"color",void 0),r.__decorate([s.writer("color")],t.prototype,"writeColor",null),r.__decorate([s.enumeration({esriSMS:"simple-marker"})],t.prototype,"type",void 0),r.__decorate([s.property()],t.prototype,"size",void 0),r.__decorate([s.property({type:u.apiValues,json:{read:u.read,write:u.write}})],t.prototype,"style",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"path",null),r.__decorate([s.property({type:c,json:{default:null,write:!0}})],t.prototype,"outline",void 0),i=r.__decorate([s.subclass("esri.symbols.SimpleMarkerSymbol")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(1130)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customValues=null,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})},r.__decorate([n.property({type:[Number],json:{write:!0}})],t.prototype,"customValues",void 0),i=r.__decorate([n.subclass("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}Object.defineProperty(t,"__esModule",{value:!0}),t.isSizeVariable=function(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass},t.isValidNumber=function(e){return null!=e&&!isNaN(e)&&isFinite(e)},t.getInputValueType=r,t.getTransformationType=function(e,t){var n=t||r(e),i=e.valueUnit||"unknown";return"unknown"===n?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===i?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.ratio=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({color:this.color,ratio:this.ratio})},r.__decorate([o.property({type:n,json:{write:!0}})],t.prototype,"color",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"ratio",void 0),i=r.__decorate([o.subclass("esri.renderers.support.HeatmapColorStop")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(239),r(180),r(154),r(118),r(156),r(152),r(153),r(151),r(435),r(179),r(191),r(273),r(524),r(631),r(368),r(1485),r(246),r(351),r(354),r(633)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S){var P=l.getLogger("esri.renderers.UniqueValueRenderer"),T=h.ensureType(_);return function(e){function t(t){var r=e.call(this,t)||this;return r._valueInfoMap={},r._isDefaultSymbolDerived=!1,r.type="unique-value",r.backgroundFillSymbol=null,r.field=null,r.field2=null,r.field3=null,r.valueExpression=null,r.valueExpressionTitle=null,r.legendOptions=null,r.defaultLabel=null,r.fieldDelimiter=null,r.portal=null,r.styleOrigin=null,r.diff={uniqueValueInfos:function(e,t){if(e||t){if(!e||!t)return{type:"complete",oldValue:e,newValue:t};for(var r=!1,n={type:"collection",added:[],removed:[],changed:[],unchanged:[]},i=function(i){var a=o.find(e,(function(e){return e.value===t[i].value}));a?d.diff(a,t[i])?(n.changed.push({type:"complete",oldValue:a,newValue:t[i]}),r=!0):n.unchanged.push({oldValue:a,newValue:t[i]}):(n.added.push(t[i]),r=!0)},a=0;a<t.length;a++)i(a);var s=function(i){o.find(t,(function(t){return t.value===e[i].value}))||(n.removed.push(e[i]),r=!0)};for(a=0;a<e.length;a++)s(a);return r?n:void 0}}},r._set("uniqueValueInfos",[]),r}var l;return r.__extends(t,e),l=t,Object.defineProperty(t.prototype,"_cache",{get:function(){return{compiledFunc:null}},enumerable:!0,configurable:!0}),t.prototype.writeBackgroundFillSymbolWebScene=function(e,t,r,n){w.writeTarget(e,t,r,n)},t.prototype.castField=function(e){return null==e||"function"==typeof e?e:h.ensureString(e)},t.prototype.writeField=function(e,t,r,n){"string"==typeof e?t[r]=e:n&&n.messages?n.messages.push(new a("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):P.error(".field: cannot write field to JSON since it's not a string value")},Object.defineProperty(t.prototype,"defaultSymbol",{set:function(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)},enumerable:!0,configurable:!0}),t.prototype.readDefaultSymbol=function(e,t,r){return w.read(e,t,r)},t.prototype.writeDefaultSymbolWebScene=function(e,t,r,n){this._isDefaultSymbolDerived||w.writeTarget(e,t,r,n)},t.prototype.writeDefaultSymbol=function(e,t,r,n){this._isDefaultSymbolDerived||w.writeTarget(e,t,r,n)},t.prototype.readPortal=function(e,t,r){return r.portal||v.getDefault()},t.prototype.readStyleOrigin=function(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){var n=x.fromJSON(t.styleUrl,r);return Object.freeze({styleUrl:n})}},t.prototype.writeStyleOrigin=function(e,t,r,n){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=x.toJSON(e.styleUrl,n))},Object.defineProperty(t.prototype,"uniqueValueInfos",{set:function(e){this.styleOrigin?P.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())},enumerable:!0,configurable:!0}),t.prototype.addUniqueValueInfo=function(e,t){var r;this.styleOrigin?P.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(r="object"==typeof e?T(e):new _({value:e,symbol:i.ensureType(t)}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r)},t.prototype.removeUniqueValueInfo=function(e){if(this.styleOrigin)P.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}},t.prototype.getUniqueValueInfo=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(a){switch(a.label){case 0:return n=t,this.valueExpression&&(c.isNone(t)||c.isNone(t.arcade))?(i=[r.__assign({},n)],o={},[4,b.loadArcade()]):[3,2];case 1:n=r.__assign.apply(void 0,i.concat([(o.arcade=a.sent(),o)])),a.label=2;case 2:return[2,this._getUniqueValueInfo(e,n)]}}))}))},t.prototype.getSymbol=function(e,t){if(!this.valueExpression||!c.isNone(t)&&!c.isNone(t.arcade)){var r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}P.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used")},t.prototype.getSymbolAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return n=t,this.valueExpression&&(c.isNone(n)||c.isNone(n.arcade))?(i=[r.__assign({},n)],o={},[4,b.loadArcade()]):[3,2];case 1:n=r.__assign.apply(void 0,i.concat([(o.arcade=s.sent(),o)])),s.label=2;case 2:return[2,(a=this._getUniqueValueInfo(e,n))&&a.symbol||this.defaultSymbol]}}))}))},t.prototype.getSymbols=function(){for(var e=[],t=0,r=this.uniqueValueInfos;t<r.length;t++){var n=r[t];n.symbol&&e.push(n.symbol)}return this.defaultSymbol&&e.push(this.defaultSymbol),e},t.prototype.getAttributeHash=function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")},t.prototype.getMeshHash=function(){return JSON.stringify(this.backgroundFillSymbol)+"."+JSON.stringify(this.defaultSymbol)+"."+this.uniqueValueInfos.reduce((function(e,t){return e+t.getMeshHash()}),"")+"."+this.field+"."+this.field2+"."+this.field3+"."+this.fieldDelimiter+"."+this.valueExpression},t.prototype.clone=function(){var e=new l({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:s.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:s.clone(this.visualVariables),legendOptions:s.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:s.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);var t=s.clone(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(s.clone(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression},enumerable:!0,configurable:!0}),t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)],[4,u.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.collectSymbolFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(i){switch(i.label){case 0:return n=r.__spreadArrays(this.getSymbols().map((function(r){return r.collectRequiredFields(e,t)})),[f.collectArcadeFieldNames(e,t,this.valueExpression)]),f.collectField(e,t,this.field),f.collectField(e,t,this.field2),f.collectField(e,t,this.field3),[4,u.all(n)];case 1:return i.sent(),[2]}}))}))},t.prototype.populateFromStyle=function(){var e=this;return S.fetchStyle(this.styleOrigin,{portal:this.portal}).then((function(t){var r=[];return e._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach((function(i){var o=new n.WebStyleSymbol({styleUrl:t.styleUrl,styleName:t.styleName,portal:e.portal,name:i.name});e.defaultSymbol||i.name!==t.data.defaultItem||(e.defaultSymbol=o,e._isDefaultSymbolDerived=!0);var a=new _({value:i.name,symbol:o});r.push(a),e._valueInfoMap[i.name]=a})),e._set("uniqueValueInfos",Object.freeze(r)),!e.defaultSymbol&&e.uniqueValueInfos.length&&(e.defaultSymbol=e.uniqueValueInfos[0].symbol,e._isDefaultSymbolDerived=!0),e}))},t.prototype._updateValueInfoMap=function(){var e=this;this._valueInfoMap={},this.uniqueValueInfos.forEach((function(t){return e._valueInfoMap[t.value+""]=t}))},t.prototype._getUniqueValueInfo=function(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)},t.prototype._getUnqiueValueInfoForExpression=function(e,t){var r=c.unwrapOr(t,{}),n=r.viewingMode,i=r.scale,o=r.spatialReference,a=r.arcade,s=this._cache.compiledFunc,l=c.unwrap(a).arcadeUtils;if(!s){var u=l.createSyntaxTree(this.valueExpression);s=l.createFunction(u),this._cache.compiledFunc=s}var p=l.executeFunction(s,l.createExecContext(e,l.getViewInfo({viewingMode:n,scale:i,spatialReference:o})));return this._valueInfoMap[p+""]},t.prototype._getUnqiueValueInfoForFields=function(e){var t,r=this.field,n=e.attributes;if("function"!=typeof r&&this.field2){var i=this.field2,o=this.field3,a=[];r&&a.push(n[r]),i&&a.push(n[i]),o&&a.push(n[o]),t=a.join(this.fieldDelimiter||"")}else"function"==typeof r?t=r(e):r&&(t=n[r]);return this._valueInfoMap[t+""]},t.fromPortalStyle=function(e,t){var r=new l(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||v.getDefault());var n=r.populateFromStyle();return n.catch((function(t){P.error("#fromPortalStyle('"+e+"'[, ...])","Failed to create unique value renderer from style name",t)})),n},t.fromStyleUrl=function(e,t){var r=new l(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));var n=r.populateFromStyle();return n.catch((function(t){P.error("#fromStyleUrl('"+e+"'[, ...])","Failed to create unique value renderer from style URL",t)})),n},r.__decorate([p.property({readOnly:!0,dependsOn:["valueExpression"]})],t.prototype,"_cache",null),r.__decorate([p.enumeration({uniqueValue:"unique-value"})],t.prototype,"type",void 0),r.__decorate([p.property({types:{base:n.BaseSymbol,key:"type",typeMap:{"simple-fill":i.symbolTypesRenderer.typeMap["simple-fill"],"picture-fill":i.symbolTypesRenderer.typeMap["picture-fill"],"polygon-3d":i.symbolTypesRenderer.typeMap["polygon-3d"]}},json:{read:w.read,write:w.writeTarget}})],t.prototype,"backgroundFillSymbol",void 0),r.__decorate([p.writer("web-scene","backgroundFillSymbol",{backgroundFillSymbol:{type:n.PolygonSymbol3D}})],t.prototype,"writeBackgroundFillSymbolWebScene",null),r.__decorate([p.property({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],t.prototype,"field",void 0),r.__decorate([p.cast("field")],t.prototype,"castField",null),r.__decorate([p.writer("field")],t.prototype,"writeField",null),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"field2",void 0),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"field3",void 0),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),r.__decorate([p.property({type:g.default,json:{write:!0}})],t.prototype,"legendOptions",void 0),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"defaultLabel",void 0),r.__decorate([p.property({types:i.symbolTypesRenderer})],t.prototype,"defaultSymbol",null),r.__decorate([p.reader("defaultSymbol")],t.prototype,"readDefaultSymbol",null),r.__decorate([p.writer("web-scene","defaultSymbol",{defaultSymbol:{types:i.symbolTypesRenderer3D}})],t.prototype,"writeDefaultSymbolWebScene",null),r.__decorate([p.writer("defaultSymbol")],t.prototype,"writeDefaultSymbol",null),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"fieldDelimiter",void 0),r.__decorate([p.property({type:v,readOnly:!0})],t.prototype,"portal",void 0),r.__decorate([p.reader("portal",["styleName"])],t.prototype,"readPortal",null),r.__decorate([p.property({readOnly:!0,json:{write:{enabled:!1,overridePolicy:function(){return{enabled:!0}}}}})],t.prototype,"styleOrigin",void 0),r.__decorate([p.reader("styleOrigin",["styleName","styleUrl"])],t.prototype,"readStyleOrigin",null),r.__decorate([p.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],t.prototype,"writeStyleOrigin",null),r.__decorate([p.property({type:[_],json:{write:{overridePolicy:function(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],t.prototype,"uniqueValueInfos",null),l=r.__decorate([p.subclass("esri.renderers.UniqueValueRenderer")],t)}(y.VisualVariablesMixin(m))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.CONFIGURE=1]="CONFIGURE",e[e.CONFIGURED=2]="CONFIGURED",e[e.OPEN=3]="OPEN",e[e.OPENED=4]="OPENED",e[e.RESPONSE=5]="RESPONSE",e[e.INVOKE=6]="INVOKE",e[e.ABORT=7]="ABORT",e[e.CLOSE=8]="CLOSE",e[e.OPEN_PORT=9]="OPEN_PORT",e[e.ON=10]="ON"}(n=t.MessageType||(t.MessageType={}));var i=0;function o(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function a(e){if(!e||!e.length)return null;if(r("esri-workers-arraybuffer-transfer"))return e;var t=e.filter((function(e){return!((t=e)instanceof ArrayBuffer||t&&t.constructor&&"ArrayBuffer"===t.constructor.name);var t}));return t.length?t:null}t.newJobId=function(){return i++},t.isTranferableResult=o,t.toInvokeError=function(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details,stack:e.stack}):null},t.postMessage=function(e,t,r,i){var s;t.type!==n.OPEN_PORT?t.type===n.INVOKE||t.type===n.RESPONSE?(o(r)?(s=a(r.transferList),t.data=r.result):(s=a(i),t.data=r),s?e.postMessage(t,s):e.postMessage(t)):e.postMessage(t):e.postMessage(t,[t.port])},t.receiveMessage=function(e){if(!e)return null;var t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.kebabDict=new r.default({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(152),r(629),r(429),r(780),r(886),r(582)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPointSymbol2D=a.fromJSON(l.defaultPointSymbolJSON),t.defaultPolylineSymbol2D=o.fromJSON(l.defaultPolylineSymbolJSON),t.defaultPolygonSymbol2D=i.fromJSON(l.defaultPolygonSymbolJSON),t.defaultTextSymbol2D=s.fromJSON(l.defaultTextSymbolJSON),t.getDefaultSymbol2D=function(e){if(n.isNone(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return t.defaultPointSymbol2D;case"polyline":return t.defaultPolylineSymbol2D;case"polygon":case"extent":return t.defaultPolygonSymbol2D;default:r.neverReached(e)}return null},t.errorPointSymbol2D=a.fromJSON(l.errorPointSymbolJSON),t.errorPolylineSymbol2D=o.fromJSON(l.errorPolylineSymbolJSON),t.errorPolygonSymbol2D=i.fromJSON(l.errorPolygonSymbolJSON)}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(118)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MAPLAYER="map-layer",t.DATALAYER="data-layer";var i=new r.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),o=new r.default({mapLayer:t.MAPLAYER,dataLayer:t.DATALAYER}),a=new r.default({joinTable:"join-table",queryTable:"query-table",raster:"raster",table:"table"}),s=new r.default({esriLeftOuterJoin:"left-outer-join",esriLeftInnerJoin:"left-inner-join"});function l(e){return null!=e&&e.hasOwnProperty("mapLayerId")}function c(e){return null!=e&&e.hasOwnProperty("dataSource")}t.isMapLayerSource=l,t.isDataLayerSource=c,t.castSource=function e(r){return r?(l(r)&&(r.type=t.MAPLAYER),c(r)&&(r.type=t.DATALAYER,r.dataSource.type||((n=r.dataSource).workspaceId?n.gdbVersion?n.type="table":n.query||n.oidFields?n.type="query-table":n.type="raster":n.leftTableKey&&n.rightTableKey&&n.leftTableSource&&n.rightTableSource&&(n.type="join-table",n.leftTableSource=e(n.leftTableSource),n.rightTableSource=e(n.rightTableSource)))),r):r;var n},t.sourceToJSON=function e(r){var l={};return r.type===t.MAPLAYER?(l.mapLayerId=r.mapLayerId,r.gdbVersion&&(l.gdbVersion=r.gdbVersion)):r.type===t.DATALAYER&&(r.fields&&(l.fields=r.fields),l.dataSource=function(t){var r;switch(t.type){case"table":r={dataSourceName:t.dataSourceName,workspaceId:t.workspaceId,gdbVersion:t.gdbVersion};break;case"query-table":r={geometryType:i.toJSON(t.geometryType),workspaceId:t.workspaceId,query:t.query,oidFields:t.oidFields,spatialReference:t.spatialReference};break;case"join-table":r={leftTableSource:e(t.leftTableSource),rightTableSource:e(t.rightTableSource),leftTableKey:t.leftTableKey,rightTableKey:t.rightTableKey,joinType:s.toJSON(t.joinType)};break;case"raster":r={workspaceId:t.workspaceId,dataSourceName:t.dataSourceName}}return r.type=a.toJSON(t.type),n.fixJson(r)}(r.dataSource)),l.type=o.toJSON(r.type),n.fixJson(l)},t.sourceFromJSON=function e(r){var l={};return o.fromJSON(r.type)===t.MAPLAYER?(l.mapLayerId=r.mapLayerId,r.gdbVersion&&(l.gdbVersion=r.gdbVersion)):o.fromJSON(r.type)===t.DATALAYER&&(r.fields&&(l.fields=r.fields),l.dataSource=function(t){var r;switch(t.type){case"table":r={dataSourceName:t.dataSourceName,workspaceId:t.workspaceId,gdbVersion:t.gdbVersion};break;case"queryTable":r={geometryType:i.fromJSON(t.geometryType),workspaceId:t.workspaceId,query:t.query,oidFields:t.oidFields,spatialReference:t.spatialReference};break;case"joinTable":r={leftTableSource:e(t.leftTableSource),rightTableSource:e(t.rightTableSource),leftTableKey:t.leftTableKey,rightTableKey:t.rightTableKey,joinType:s.fromJSON(t.joinType)};break;case"raster":r={workspaceId:t.workspaceId,dataSourceName:t.dataSourceName}}return r.type=a.fromJSON(t.type),n.fixJson(r)}(r.dataSource)),l.type=o.fromJSON(r.type),n.fixJson(l)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.GoToMixin=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.goToOverride=null,n.view=null,n}return r.__extends(t,e),t.prototype.callGoTo=function(e){var t=this.view;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)},r.__decorate([n.property()],t.prototype,"goToOverride",void 0),r.__decorate([n.property()],t.prototype,"view",void 0),r.__decorate([n.subclass("esri.widgets.support.GoTo")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){function n(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1],p=r[2],d=r[3],h=r[4],f=r[5];return e[0]=n*c+o*u,e[1]=i*c+a*u,e[2]=n*p+o*d,e[3]=i*p+a*d,e[4]=n*h+o*f+s,e[5]=i*h+a*f+l,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.set=function(e,t,r,n,i,o,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=r*o-n*i;return l?(l=1/l,e[0]=o*l,e[1]=-n*l,e[2]=-i*l,e[3]=r*l,e[4]=(i*s-o*a)*l,e[5]=(n*a-r*s)*l,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=n,t.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*c,e[1]=i*u+a*c,e[2]=n*-c+o*u,e[3]=i*-c+a*u,e[4]=s,e[5]=l,e},t.scale=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1];return e[0]=n*c,e[1]=i*c,e[2]=o*u,e[3]=a*u,e[4]=s,e[5]=l,e},t.translate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=n*c+o*u+s,e[5]=i*c+a*u+l,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=t[0],u=t[1],p=t[2],d=t[3],h=t[4],f=t[5];return Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-p)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-h)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(l-f)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},t.mul=n,t.sub=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(618),r(210),r(241),r(642)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};var s=function(e){function o(r,i,o,a,s){void 0===r&&(r=t.DefaultParameters.maximumDoubleClickDelay),void 0===i&&(i=t.DefaultParameters.maximumDoubleClickDistance),void 0===o&&(o=t.DefaultParameters.maximumDoubleTouchDelay),void 0===a&&(a=t.DefaultParameters.maximumDoubleTouchDistance),void 0===s&&(s=n.default);var l=e.call(this,!1)||this;return l.maximumDoubleClickDelay=r,l.maximumDoubleClickDistance=i,l.maximumDoubleTouchDelay=o,l.maximumDoubleTouchDistance=a,l._clock=s,l._pointerState=new Map,l._click=l.registerOutgoing("click"),l._doubleClick=l.registerOutgoing("double-click"),l.registerIncoming("immediate-click",l._handleImmediateClick.bind(l)),l.registerIncoming("pointer-drag",l._handlePointerDrag.bind(l)),l.registerIncoming("drag",l._handleDrag.bind(l)),l}return r.__extends(o,e),o.prototype.onUninstall=function(){this._pointerState.forEach((function(e){null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))},Object.defineProperty(o.prototype,"hasPendingInputs",{get:function(){return i.someMap(this._pointerState,(function(e){return null!=e.doubleClickTimeout}))},enumerable:!0,configurable:!0}),o.prototype._pointerId=function(e){var t=e.native;return"mouse"===t.pointerType?t.pointerId+":"+t.button:""+t.pointerType},o.prototype._handleImmediateClick=function(e){var t=e.data,r=this._pointerId(t),n=this._pointerState.get(r);if(n){var i="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;a.manhattanDistance(n.event.data,t)>i?(this._clearDoubleClickTimeout(r,!0),this._startClick(e)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(n.event.data,void 0,n.event.modifiers))}else this._startClick(e)},o.prototype._startClick=function(e){var t=this,r=this._pointerId(e.data),n="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(r,{event:e,doubleClickTimeout:this._clock.setTimeout((function(){return t._doubleClickTimeoutExceeded(r)}),n)}),this.refreshHasPendingInputs()},o.prototype._handlePointerDrag=function(e){var t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)},o.prototype._handleDrag=function(e){var t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)},o.prototype._clearDoubleClickTimeout=function(e,t){var r=this._pointerState.get(e);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())},o.prototype._doubleClickTimeoutExceeded=function(e){var t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()},o}(o.InputHandler);t.SingleAndDoubleClick=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.projectPoint=function(e,t,r){var i=n.vec3.dot(e,t)/n.vec3.dot(e,e);return n.vec3.scale(r,e,i)},t.projectPointSignedLength=function(e,t){return n.vec3.dot(e,t)/n.vec3.length(e)},t.angle=function(e,t){var i=n.vec3.dot(e,t)/(n.vec3.length(e)*n.vec3.length(t));return-r.acosClamped(i)},t.angleAroundAxis=function(e,t,i){n.vec3.normalize(o,e),n.vec3.normalize(a,t);var s=n.vec3.dot(o,a),l=r.acosClamped(s),c=n.vec3.cross(o,o,a);return n.vec3.dot(c,i)<0?2*Math.PI-l:l};var o=i.vec3f64.create(),a=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConversion=function(e,t){var l=[n.glsl(i||(i=r.__makeTemplateObject(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),n.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),n.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),n.glsl(s||(s=r.__makeTemplateObject(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(t.stages){case 0:l.forEach((function(t){return e.vertex.code.add(t)}));break;case 1:l.forEach((function(t){return e.fragment.code.add(t)}));break;default:l.forEach((function(t){return e.vertex.code.add(t)})),l.forEach((function(t){return e.fragment.code.add(t)}))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(160)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});t.MainLight=function(e,t,n){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),void 0===n&&(n=!0),this.intensity=e,this.direction=t,this.castShadows=n};t.FillLight=function(e,t){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=r.vec3f64.create(),this.direction=r.vec3f64.create(),this.intensity=e,this.direction=t};t.AmbientLight=function(e){void 0===e&&(e=r.vec3f64.create()),this.intensity=e};t.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.hasConstraintType=function(e,t){return 0!=(e&t)},t.adjustRangeForInteraction=function(e,t,r,n,i,o){0!==e&&(r?(o.min=Math.min(o.min,t),o.max=Math.max(o.max,t)):null!=n?(o.min-=Math.max(0,(t-o.min)*(1-n)),o.max+=Math.max(0,(t-o.max)*(1-n))):i&&(o.min-=Math.max(0,t-o.min-i),o.max+=Math.max(0,t-o.max-i)))},t.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},t.interactionDirectionTowardsConstraintMinimization=function(e,t,i,o){return t=t||e.viewForward,n.vec3.copy(o,t),n.vec3.scale(o,o,r.sign(n.vec3.dot(t,i))),o}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"}(o=t.State||(t.State={}));var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=o.Ready,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"active",{get:function(){return this.state===o.Running},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.stopController=function(){return!!this.canStop&&(this.state=o.Stopped,!0)},t.prototype.finishController=function(){this.state=o.Finished},Object.defineProperty(t.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0}),r.__decorate([i.property({readOnly:!0,dependsOn:["state"]})],t.prototype,"active",null),r.__decorate([i.property()],t.prototype,"state",void 0),r.__decorate([i.subclass("esri.views.3d.state.controllers.CameraController")],t)}(n);t.CameraController=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this._initialVelocity=e,this._stopVelocity=t,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e.prototype.isFinished=function(e){return e>this.duration},Object.defineProperty(e.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0}),e.prototype.value=function(e){return this.valueFromInitialVelocity(this._initialVelocity,e)},e.prototype.valueDelta=function(e,t){var r=this.value(e);return this.value(e+t)-r},e.prototype.valueFromInitialVelocity=function(e,t){t=Math.min(t,this.duration);var r=1-this.friction;return e*(Math.pow(r,t)-1)/Math.log(r)},e}();t.Momentum=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(932),r(1668),r(175)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.include(n.ReadLinearDepth),e.include(i.Reprojection),e.fragment.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) +  abs(rayDiffZOld) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) +  abs(rayDiffZOld) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceReflections=a,function(e){e.bindUniforms=function(e,t,r){r.ssrEnabled&&(e.setUniform1i("depthMapView",r.linearDepthTextureID),t.bindTexture(r.linearDepthTexture,r.linearDepthTextureID),e.setUniform2f("nearFar",r.nearFar[0],r.nearFar[1]),e.setUniformMatrix4fv("ssrViewMat",r.ssrViewMat),i.Reprojection.bindUniforms(e,t,r))}}(a=t.ScreenSpaceReflections||(t.ScreenSpaceReflections={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1670),r(934),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l,c,u,p,d,h,f,v,m;Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicallyBasedRendering=function(e,t){var y=e.fragment.code;e.include(i.PiUtils),3===t.pbrMode||4===t.pbrMode?(y.add(o.glsl(a||(a=r.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),y.add(o.glsl(s||(s=r.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),y.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),y.add(o.glsl(c||(c=r.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),y.add(o.glsl(u||(u=r.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n.AnalyticalSkyModel),y.add(o.glsl(p||(p=r.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),y.add(o.glsl(d||(d=r.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),y.add(o.glsl(h||(h=r.__makeTemplateObject(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),y.add(o.glsl(f||(f=r.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),y.add(o.glsl(v||(v=r.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),y.add(o.glsl(m||(m=r.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(205),r(216),r(201),r(223),r(920),r(805),r(1207),r(345),r(537),r(319),r(795),r(494),r(806),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){function g(e,t){var r,i,o;return void 0===t&&(t=V),e.textureIsSignedDistanceField?(r=e.anchorPos,i=e.distanceFieldBoundingBox,(o=t)[0]=r[0]*(i[2]-i[0])+i[0],o[1]=r[1]*(i[3]-i[1])+i[1]):n.vec2.copy(t,e.anchorPos),t}Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new y.ShaderBuilder,n=e.signedDistanceFieldEnabled;if(t.include(s.AlignPixel),t.include(l.HUD,e),t.include(a.Slice,e),6===e.output)return t.include(c.HUDOcclusionPass,e),t;t.include(v.ScreenSizePerspective),t.include(f.RgbaFloatEncoding),t.include(h.ColorConversion,{stages:1}),t.include(p.VisualVariables,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),n&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m.glsl(x||(x=r.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?m.glsl(_||(_=r.__makeTemplateObject(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):m.glsl(b||(b=r.__makeTemplateObject(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"],["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var i=m.glsl(w||(w=r.__makeTemplateObject(["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],["\n      vec2 uv01 = floor(uv0);\n      vec2 uv = uv0 - uv01;\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),o=n?m.glsl(S||(S=r.__makeTemplateObject(["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):m.glsl(P||(P=r.__makeTemplateObject(["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"],["\n  posProj += quadOffset;\n  if (inputSize.x == size.x) {\n    posProj = alignToPixelOrigin(posProj, viewport.zw);\n  }"])));t.vertex.code.add(m.glsl(O||(O=r.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",i,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",m.glsl.float(d.symbolAlphaCutoff),n?"alphaDiscard = alphaDiscard && outlineColor.a < "+m.glsl.float(d.symbolAlphaCutoff)+";":"",o,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?m.glsl(T||(T=r.__makeTemplateObject(["} else { vtc = vec2(0.0);\n        ",""],["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),n&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var g=e.debugDrawBorder?m.glsl(C||(C=r.__makeTemplateObject(["(isBorder > 0.0 ? 0.0 : ",")"],["(isBorder > 0.0 ? 0.0 : ",")"])),m.glsl.float(d.defaultMaskAlphaCutoff)):m.glsl.float(d.defaultMaskAlphaCutoff),V=m.glsl(R||(R=r.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?m.glsl(M||(M=r.__makeTemplateObject(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?m.glsl(A||(A=r.__makeTemplateObject(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),g,m.glsl.float(d.symbolAlphaCutoff),g):m.glsl(E||(E=r.__makeTemplateObject(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "],["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),g),e.debugDrawBorder?m.glsl(I||(I=r.__makeTemplateObject(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 0===e.output&&t.fragment.code.add(m.glsl(D||(D=r.__makeTemplateObject(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),V)),4===e.output&&(t.include(u.OutputHighlight),t.fragment.code.add(m.glsl(j||(j=r.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),V,e.binaryHighlightOcclusionEnabled?m.glsl(L||(L=r.__makeTemplateObject(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t},function(e){e.bindUniforms=function(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",o.vec4f64.ZEROS),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize)));var n=r.pixelRatio||1;e.setUniform2f("screenOffset",2*t.screenOffset[0]*n,2*t.screenOffset[1]*n),e.setUniform2fv("anchorPos",g(t))}}(t.HUDMaterial||(t.HUDMaterial={})),t.calculateAnchorPosForRendering=g;var _,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V=i.vec2f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(806),r(175)],void 0===(i=function(e,t,r,n,i){function o(e,t){var o=e;o.include(n.ScreenSizePerspective),o.attributes.add("position","vec3"),o.attributes.add("normal","vec3"),o.attributes.add("auxpos1","vec4"),o.vertex.uniforms.add("proj","mat4"),o.vertex.uniforms.add("view","mat4"),o.vertex.uniforms.add("viewNormal","mat4"),o.vertex.uniforms.add("viewport","vec4"),o.vertex.uniforms.add("camPos","vec3"),o.vertex.uniforms.add("polygonOffset","float"),o.vertex.uniforms.add("cameraGroundRelative","float"),o.vertex.uniforms.add("pixelRatio","float"),o.vertex.uniforms.add("perDistancePixelRatio","float"),o.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&o.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&o.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),o.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),o.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208),o.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "])))),o.vertex.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = sign(pointGroundDistance);\n\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])))),o.vertex.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "],["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])))),o.vertex.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?i.glsl(c||(c=r.__makeTemplateObject(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"],["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?i.glsl(u||(u=r.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "],["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),o.vertex.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "],["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD > 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD = 0.75\n        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n  "]))))}var a,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=o,function(e){!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(e.TransparentRenderStyle||(e.TransparentRenderStyle={})),e.bindUniforms=function(t,r){t.setUniform1f("uRenderTransparentlyOccludedHUD",r.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.OCCLUDED?1:r.renderTransparentlyOccludedHUD===e.TransparentRenderStyle.NOTOCCLUDED?0:.75)},e.bindVisibilityTexture=function(e,t,r){t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(r.hudVisibilityTexture,1),e.setActiveTexture(0)}}(o=t.HUD||(t.HUD={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175),r(249)],void 0===(i=function(e,t,r,n,i){function o(e){e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize = 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "])))),e.vertex.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "])))),e.vertex.code.add(n.glsl(u||(u=r.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "])))),e.vertex.code.add(n.glsl(p||(p=r.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "])))),e.vertex.code.add(n.glsl(d||(d=r.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}var a,s,l,c,u,p,d;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSizePerspective=o,function(e){e.bindUniforms=function(e,t){if(t.screenSizePerspective){i.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective");var r=t.screenSizePerspectiveAlignment||t.screenSizePerspective;i.bindScreenSizePerspective(r,e,"screenSizePerspectiveAlignment")}}}(o=t.ScreenSizePerspective||(t.ScreenSizePerspective={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(185),r(160),r(193),r(427),r(207),r(277),r(277),r(262),r(192),r(417)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=i.vec3f64.create();t.createStageObjectForHUD=function(e,t,i,a,s,l,u,f,v,m,y){var g=i?i.length:0,_=e.clippingExtent;if(p.pointToVector(t,h,e.elevationProvider.spatialReference),r.isSome(_)&&!o.containsPoint(_,h))return null;var b=e.renderCoordsHelper.spatialReference;p.pointToVector(t,h,b);for(var x=e.localOriginFactory.getOrigin(h),w=new d({castShadow:!1,metadata:{layerUid:v,graphicUid:m,usesVerticalDistanceToGround:!0},idHint:f}),S=0;S<g;S++){var P=s?s[S]:n.mat4f64.IDENTITY;w.addGeometry(i[S],a[S],P,l,x,y)}return{object:w,sampledElevation:c.applyElevationAlignmentForHUD(w,t,e.elevationProvider,e.renderCoordsHelper,u)}},t.extendPointGraphicElevationContext=function(e,t,r){var n=e.elevationContext,i=r.spatialReference;p.pointToVector(t,h,i),n.centerPointInElevationSR=s.makeDehydratedPoint(h[0],h[1],t.hasZ?h[2]:0,i)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return u.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=a.getPointOnPath(t,a.getPathLength(t)/2);return s.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.geometryToRenderInfo=function(e,t,r,n,i){var o=new Float64Array(3*e.length),a=new Float64Array(o.length);e.forEach((function(e,t){o[3*t+0]=e[0],o[3*t+1]=e[1],o[3*t+2]=e.length>2?e[2]:0}));var s=l.applyPerVertexElevationAlignment(o,t,0,a,0,o,0,o.length/3,r,n,i),c=null!=s;return{numVertices:e.length,position:o,mapPosition:a,projectionSuccess:c,sampledElevation:s}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(204)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.cache=new Map}return e.prototype.dispose=function(){this.cache.forEach((function(e){r.isSome(e.texture)&&(e.texture.dispose(),e.texture=null)})),this.cache.clear()},e.prototype.acquire=function(e){if(r.isNone(e))return null;var t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;var o=this.patternToTextureData(e,2),a=o.length/2,s={refCount:1,texture:null,bind:function(e,t){return r.isNone(s.texture)&&(s.texture=new n.Texture(e,{width:o.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},o)),e.bindTexture(s.texture,t),a}};return this.cache.set(t,s),s.bind},e.prototype.release=function(e){if(!r.isNone(e)){var t=this.patternId(e),n=this.cache.get(t);n&&(n.refCount--,0===n.refCount&&(r.isSome(n.texture)&&n.texture.dispose(),this.cache.delete(t)))}},e.prototype.swap=function(e,t){var r=this.acquire(t);return this.release(e),r},e.prototype.bind=function(e,t,n,i,o){var a=r.isSome(i)?i(e,o)*t.pixelRatio:1;n.setUniform1i("stipplePatternTexture",o),n.setUniform1f("stipplePatternPixelSizeInv",1/a)},e.prototype.patternId=function(e){return e.join(",")},e.prototype.patternToTextureData=function(e,t){for(var r=e.reduce((function(e,t){return e+t}))*t,n=new Uint8Array(r),i=!0,o=0,a=0,s=e;a<s.length;a++){for(var l=s[a],c=0;c<l*t;c++)n[o++]=i?255:0;i=!i}return n},e}();t.StippleTextureRepository=i,t.createStipplePattern=function(e){return r.isNone(e)?e:e.slice()},t.createStipplePatternSimple=function(e){return[e,e]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1693),r(175)],void 0===(i=function(e,t,r,n,i){var o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalAttribute=function(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "],["\n      vec3 normalModel() {\n        return normal;\n      }\n    "]))))),1===t.normalType&&(e.include(n.DecodeNormal),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "],["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "],["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PositionAttribute=function(e){e.attributes.add("position","vec3"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 positionModel() { return position; }\n  "],["\n    vec3 positionModel() { return position; }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(494),r(175)],void 0===(i=function(e,t,r,n,i){var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.OutputDepth=function(e,t){e.include(n.RgbaFloatEncoding),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE = 2.0;\n        const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result = depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "],["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE = 2.0;\n        const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result = depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "]))))):1===t.output&&e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor = float2rgba(_linearDepth);\n      }\n    "],["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor = float2rgba(_linearDepth);\n      }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluateAmbientOcclusion=function(e,t){var a=e.fragment;t.receiveAmbientOcclusion?(a.uniforms.add("ssaoTex","sampler2D"),a.uniforms.add("viewportPixelSz","vec4"),a.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n      }\n    "],["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n      }\n    "]))))):a.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "],["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(153),r(171),r(229),r(163),r(869),r(773),r(1245),r(1696),r(626),r(1118)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Legend="legend",e.Preview="preview"}(f=t.GeometryStyle||(t.GeometryStyle={}));var v=function(e,t,r){if(e&&e.targetSize){var n=void 0;if(r){var i=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);n=e.targetSize/o.pt2px(i)}else n=e.targetSize/t.referenceSize;return n}return e?e.scaleFactor:1},m={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}},y=function(){function e(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new u.default,this._textRasterizer=new p.default,this._pictureMarkerCache=new Map}return e.prototype.rasterizeCIMSymbolAsync=function(e,t,n,i,o,a,l,c){return r.__awaiter(this,void 0,void 0,(function(){var u;return r.__generator(this,(function(r){switch(r.label){case 0:return i=i||(t?null!=t.centroid?"esriGeometryPolygon":s.getJsonType(t.geometry):null)||function(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}(e),[4,this.analyzeCIMSymbol(e,t?(p=t.attributes,d=p?Object.keys(p):[],h=d.map((function(e){return{name:e,alias:e,type:"string"==typeof p[e]?"esriFieldTypeString":"esriFieldTypeDouble"}})),h):null,n,i,c)];case 1:return u=r.sent(),[2,this.rasterizeCIMSymbol(u,t,i,o,a,l)]}var p,d,h}))}))},e.prototype.analyzeCIMSymbol=function(e,t,n,o,a){return r.__awaiter(this,void 0,void 0,(function(){var s,u,p,h,f,v,m;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,c.fetchSymbol(e,a)];case 1:return s=r.sent(),u=[],t?p=function(e,t,r){return{geometryType:t,spatialReference:r,fields:e}}(t,o,this._spatialReference):"CIMSymbolReference"===(s=s.clone()).data.type&&(s.data.primitiveOverrides=[],p=null),[4,l.analyzeCIMSymbol(s.data,p,u,this._avoidSDF)];case 2:for(r.sent(),i.throwIfAborted(a),f=0,v=u;f<v.length;f++)"CIMPictureMarker"!==(m=v[f]).cim.type&&"CIMPictureFill"!==m.cim.type&&"CIMPictureStroke"!==m.cim.type||(h||(h=[]),h.push(this.fetchPictureMarkerResource(m,a))),n&&"text"===m.type&&"string"==typeof m.text&&m.text.indexOf("[")>-1&&(m.text=d.createLabelOverrideFunction(n,m.text,m.cim.textCase));return h?[4,i.all(h)]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2,u]}}))}))},e.prototype.fetchPictureMarkerResource=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:return i=e.materialHash,this._pictureMarkerCache.get(i)?[3,2]:[4,n(e.cim.url,{responseType:"image",signal:t&&t.signal})];case 1:o=r.sent(),a=o.data,this._pictureMarkerCache.set(i,a),r.label=2;case 2:return[2]}}))}))},e.prototype.rasterizeCIMSymbol=function(e,t,r,n,i,o){for(var a=[],s=0,l=e;s<l.length;s++){var c=l[s];n&&"function"==typeof n.scaleFactor&&(n.scaleFactor=n.scaleFactor(t,i,o));var u=this._getRasterizedResource(c,t,r,n,i,o);if(u){var p=0,h=u.anchorX||0,f=u.anchorY||0,m=!1,y=0,g=0;if("esriGeometryPoint"===r){var _=v(n,c,null);if(y=d.evaluateValueOrFunction(c.offsetX,t,i,o)*_||0,g=d.evaluateValueOrFunction(c.offsetY,t,i,o)*_||0,"marker"===c.type)p=d.evaluateValueOrFunction(c.rotation,t,i,o)||0,m=!!c.rotateClockwise&&c.rotateClockwise;else if("text"===c.type){if(p=d.evaluateValueOrFunction(c.angle,t,i,o)||0,void 0!==c.horizontalAlignment)switch(c.horizontalAlignment){case"left":h=-.5;break;case"right":h=.5;break;default:h=0}if(void 0!==c.verticalAlignment)switch(c.verticalAlignment){case"top":f=.5;break;case"bottom":f=-.5;break;case"baseline":f=-.25;break;default:f=0}}}null!=u&&a.push({angle:p,rotateClockWise:m,anchorX:h,anchorY:f,offsetX:y,offsetY:g,rasterizedResource:u})}}return this.getSymbolImage(a)},e.prototype.getSymbolImage=function(e){for(var t=document.createElement("canvas"),r=t.getContext("2d"),n=0,i=0,a=0,s=0,l=[],c=0;c<e.length;c++){var u=e[c],p=u.rasterizedResource;if(p){var d=p.size,f=u.offsetX,v=u.offsetY,m=u.anchorX,y=u.anchorY,g=u.rotateClockWise||!1,_=u.angle,b=o.pt2px(f)-d[0]*(.5+m),x=o.pt2px(v)-d[1]*(.5+y),w=b+d[0],S=x+d[1];if(_){g&&(_=-_);var P=Math.sin(_*Math.PI/180),T=Math.cos(_*Math.PI/180),O=b*T-x*P,C=b*P+x*T,M=b*T-S*P,A=b*P+S*T,E=w*T-S*P,I=w*P+S*T,R=w*T-x*P,D=w*P+x*T;b=Math.min(O,M,E,R),x=Math.min(C,A,I,D),w=Math.max(O,M,E,R),S=Math.max(C,A,I,D)}n=b<n?b:n,i=x<i?x:i,a=w>a?w:a,s=S>s?S:s;var L=r.createImageData(p.size[0],p.size[1]);L.data.set(new Uint8ClampedArray(p.image.buffer));var j={offsetX:f,offsetY:v,rotateClockwise:g,angle:_,rasterizedImage:L,anchorX:m,anchorY:y};l.push(j)}}t.width=a-n,t.height=s-i;var V=-n,F=s;for(c=0;c<l.length;c++){j=l[c];var N=this._imageDataToCanvas(j.rasterizedImage),k=j.rasterizedImage.width,z=j.rasterizedImage.height,U=V-k*(.5+j.anchorX),B=F-z*(.5-j.anchorY);if(j.angle){var G=(360-j.angle)*Math.PI/180;r.save(),r.translate(o.pt2px(j.offsetX),-o.pt2px(j.offsetY)),r.translate(V,F),r.rotate(G),r.translate(-V,-F),r.drawImage(N,U,B),r.restore()}else r.drawImage(N,U+o.pt2px(j.offsetX),B-o.pt2px(j.offsetY))}var H=new h.default({x:V/t.width-.5,y:F/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:H}},e.prototype._imageDataToCanvas=function(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var t=this._imageDataCanvas,r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t},e.prototype._imageTo32Array=function(e,t,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var n=this._imageDataCanvas,i=n.getContext("2d");return n.width=t,n.height=r,i.drawImage(e,0,0,t,r),new Uint32Array(i.getImageData(0,0,t,r).data.buffer)},e.prototype._getRasterizedResource=function(e,t,r,n,i,o){var s,l,c,u,p,h,y,_,b,x;if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r){var w=n&&n.style?n.style:f.Legend,S="esriGeometryPolyline"===r?m.stroke[w]:m.fill[w];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){var P=d.evaluateValueOrFunction(e.width,t,i,o),T=void 0,O=void 0,C=void 0;return T=(l=this._getPictureResource(e,P)).image,O=l.width,C=l.height,this._rasterizePictureResource(e,T,O,C,S,P)}return null}y=(s=g(e,t,i,o)).analyzedCIM,b=s.hash,_=this._embedCIMLayerInVectorMarker(y,S)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=d.evaluateValueOrFunction(e.offsetX,t,i,o),e.cim.offsetY=d.evaluateValueOrFunction(e.offsetY,t,i,o),e.cim.rotation=d.evaluateValueOrFunction(e.rotation,t,i,o),e.cim.markerPlacement=e.markerPlacement,y=g(e,t,i,o).analyzedCIM,b=a.numericHash(JSON.stringify(y)).toString(),_=this._embedCIMLayerInVectorMarker(y,S)}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){if(P=e.cim.size||e.cim.height,T=void 0,O=void 0,C=void 0,"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)T=(c=this._getPictureResource(e,P)).image,O=c.width,C=c.height;else{y=(u=g(e,t,i,o)).analyzedCIM,b=u.hash;var M=this._rasterizer.rasterizeJSONResource(y,this._avoidSDF);T=M.image,O=M.size[0],C=M.size[1]}return this._rasterizePictureResource(e,T,O,C,S,null)}if("CIMSolidFill"!==e.cim.type)return null;y=(p=g(e,t,i,o)).analyzedCIM,b=p.hash,_=this._embedCIMLayerInVectorMarker(y,S)}}}else{if("text"===e.type)return this._rasterizeTextResource(e,t,n,i,o);y=(h=g(e,t,i,o)).analyzedCIM,b=h.hash;var A=v(n,e,null);if("CIMPictureMarker"===e.cim.type){P=d.evaluateValueOrFunction(e.size,t,i,o)*A;var E=this._getPictureResource(e,P);return{image:T=E.image,size:[O=E.width,C=E.height],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0}}y.size*=A,_=y}b+=r,n&&(b+=JSON.stringify(n));var I=this._resourceCache;return I.has(b)?I.get(b):(x=this._rasterizer.rasterizeJSONResource(_,this._avoidSDF),I.set(b,x),x)},e.prototype._rasterizeTextResource=function(e,t,r,n,i){var o=v(r,e,null),a=d.evaluateValueOrFunction(e.text,t,n,i);if(!a||0===a.length)return null;var s=d.evaluateValueOrFunction(e.fontName,t,n,i),l=d.evaluateValueOrFunction(e.style,t,n,i),c=d.evaluateValueOrFunction(e.weight,t,n,i),u=d.evaluateValueOrFunction(e.decoration,t,n,i),p=d.evaluateValueOrFunction(e.size,t,n,i)*o,h=d.evaluateValueOrFunction(e.horizontalAlignment,t,n,i),f=d.evaluateValueOrFunction(e.verticalAlignment,t,n,i),m=d.colorToArray(d.evaluateValueOrFunction(e.color,t,n,i)),y=d.colorToArray(d.evaluateValueOrFunction(e.outlineColor,t,n,i)),g={color:m,size:p,horizontalAlignment:h,verticalAlignment:f,font:{family:s,style:l,weight:c,decoration:u},halo:{size:d.evaluateValueOrFunction(e.outlineSize,t,n,i)||0,color:y,style:l},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(a,g)},e.prototype._rasterizePictureResource=function(e,t,r,n,i,a){var l=document.createElement("canvas"),c=l.getContext("2d");l.height=o.pt2px(Math.max(Math.abs(i.frame.ymax-i.frame.ymin),a)),l.width=o.pt2px(Math.abs(i.frame.xmax-i.frame.xmin));var u=c.createImageData(r,n);u.data.set(new Uint8ClampedArray(t.buffer));var p=this._imageDataToCanvas(u),d=c.createPattern(p,"repeat"),h=Math.cos((-e.cim.rotation||0)*Math.PI/180),f=Math.sin((-e.cim.rotation||0)*Math.PI/180);d.setTransform({m11:h,m12:f,m21:-f,m22:h,m41:o.pt2px(e.cim.offsetX)||0,m42:o.pt2px(e.cim.offsetY)||0});var v,m,y,g=i.canvasPaths;s.isPolygon(g)?(v=g.rings,c.fillStyle=d,m=c.fill,y=["evenodd"]):s.isPolyline(g)&&(v=g.paths,c.strokeStyle=d,c.lineWidth=a,m=c.stroke,v[0][0][1]=l.height/2,v[0][1][1]=l.height/2),c.beginPath();for(var _=0,b=v;_<b.length;_++){var x=b[_],w=x?x.length:0;if(w>1){var S=x[0];c.moveTo(o.pt2px(S[0]),o.pt2px(S[1]));for(var P=1;P<w;++P)S=x[P],c.lineTo(o.pt2px(S[0]),o.pt2px(S[1]));c.closePath()}}m.apply(c,y);var T=c.getImageData(0,0,l.width,l.height),O=new Uint8Array(T.data);return{size:[l.width,l.height],image:new Uint32Array(O.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}},e.prototype._getPictureResource=function(e,t){var r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;var n=r.height/r.width,i=t?n>1?o.pt2px(t):o.pt2px(t)/n:r.width,a=t?n>1?o.pt2px(t)*n:o.pt2px(t):r.height;return{image:this._imageTo32Array(r,i,a),width:i,height:a}},e.prototype._embedCIMLayerInVectorMarker=function(e,t){var r=s.isPolygon(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:t.frame,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}},e}();function g(e,t,r,n){var i,o;return"function"==typeof e.materialHash?(i=(0,e.materialHash)(t,r,n),o=l.analyzeCIMResource(e.cim,e.materialOverrides)):(i=e.materialHash,o=e.cim),{analyzedCIM:o,hash:i}}t.CIMSymbolRasterizer=y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(162),r(160),r(193),r(173),r(262)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(){function e(e,t,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}return e.prototype.initialize=function(e,t,r){this.stage=e,this._layerView=r,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer},e.prototype.setVisibility=function(e){if(null!=this.stage){if(this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,0),!0;if(!e&&!this._addedToStage)return!1;for(var t=0,r=this.renderGeometries;t<r.length;t++)r[t].instanceParameters.visible=this._visible;return this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1),!0}return!1}},e.prototype.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,1),this._addedToStage=!1,this._visible=!1,this.stage=null},e.prototype.getBSRadius=function(){return this.renderGeometries.reduce((function(e,t){return Math.max(e,t.bsRadius)}),0)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=i.vec3f64.create()),n.vec3.set(e,0,0,0)},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=o.create()),o.empty(e)},e.prototype.addObjectState=function(e,t){var r=this;0===e&&(this.renderGeometries.forEach((function(e){var n=e.addHighlight();t.addRenderGeometry(e,n,r)})),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))},e.prototype.removeObjectState=function(e){this.renderGeometries.forEach((function(t){e.removeRenderGeometry(t)}))},e.prototype.removeRenderGeometryObjectState=function(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)},e.prototype.computeAttachmentOrigin=function(e){for(var t=0,r=this.renderGeometries;t<r.length;t++)r[t].computeAttachmentOrigin(p)&&(e.draped.origin[0]+=p[0],e.draped.origin[1]+=p[1],e.draped.num++)},e.prototype.getProjectedBoundingBox=function(e,t,n,i,a){return r.__awaiter(this,void 0,void 0,(function(){var l,u,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:for(o.empty(a),l=0;l<this.renderGeometries.length;l++)u=this.renderGeometries[l],this._getRenderGeometryProjectedBoundingRect(u,e,c,n),o.expand(a,c);if(!t)return[3,5];o.center(a,p),d=void 0,h=s.demResolutionForBoundingBox(a,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.service.queryElevation(p[0],p[1],i,h)];case 2:return d=r.sent(),[3,4];case 3:return r.sent(),d=null,[3,4];case 4:null!=d&&(a[2]=Math.min(a[2],d),a[5]=Math.max(a[5],d)),r.label=5;case 5:return[2,a]}}))}))},e.prototype._getRenderGeometryProjectedBoundingRect=function(e,t,r,n){if(this.boundingBox)o.set(u,this.boundingBox);else{var i=e.center,a=e.bsRadius;u[0]=i[0]-a,u[1]=i[1]-a,u[2]=i[2]-a,u[3]=i[0]+a,u[4]=i[1]+a,u[5]=i[2]+a}return t(u,0,2),this.calculateRelativeScreenBounds&&n.push({location:o.center(u),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),o.toRect(u,r)},e}(),c=a.create(),u=o.create(),p=i.vec3f64.create();return l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(158),r(180),r(154),r(118),r(152),r(153),r(151),r(1271),r(1764),r(195),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tasks=new Map,t.onLoadQueue=new Array,t.doneQueue=new Array,t.updating=!1,t}return r.__extends(t,e),t.prototype.setup=function(e,t,r){var n=this;this.loadQueue=new p.AsyncWorkerQueue((function(e,t){return n.startLoading(e,t)}),(function(e,t){return n.doneLoadingCallback(e,t)}),e,t),r&&(this.taskHandle=r.registerTask(f.Task.STREAM_DATA_LOADER,(function(e){return n.update(e)}),(function(){return n.doneQueue.length>0||n.onLoadQueue.length>0})))},t.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null),this.tasks.forEach((function(e){e.abortController&&e.abortController.abort()})),this.loadQueue.clear(),this.loadQueue=null,this.onLoadQueue=null,this.doneQueue=null,this.tasks=null},Object.defineProperty(t.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0}),t.prototype.request=function(e,t,r,n){var i=this;void 0===n&&(n={});var o=c.createResolver();o.__signal=l.isSome(n)?n.signal:null;var a=this.createOrUpdateTask(e,t,r,n,o);return c.onAbort(n,(function(){return i.cancelRequest(a,o)})),o.promise},t.prototype.createTask=function(e,t,r,n,i,o){var a=new d.default(e,t,r,n,i);return this.updateTask(a,o),this.tasks.set(i,a),1===this.tasks.size&&this._set("updating",!0),this.loadQueue.push(a),a},t.prototype.cancelRequest=function(e,t){o.removeUnordered(e.resolvers,t),t.reject(c.createAbortError()),0===e.resolvers.length&&(2===e.status&&(e.status=4,this.loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=4,this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1))},t.prototype.taskKey=function(e,t,r){return e+":"+t+":"+r},t.prototype.updateTask=function(e,t){e.resolvers.push(t)},t.prototype.createOrUpdateTask=function(e,t,r,n,i){var o=l.isSome(n)&&n.uid||e,a=this.taskKey(o,t,r),s=this.tasks.get(a);return s?(this.updateTask(s,i),s):this.createTask(e,n,t,r,a,i)},t.prototype.doneLoadingCallback=function(e,t){this.loadQueue&&(h.assert(2===e.status),e.status=3,this.taskHandle?this.doneQueue.push({task:e,err:t}):this.doneLoading(e,t))},t.prototype.update=function(e){for(;!e.done&&this.onLoadQueue.length>0;){var t=this.onLoadQueue.shift();c.throwIfAborted(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this.doneQueue.length>0;){var r=this.doneQueue.shift();3!==r.task.status&&(r.err=r.err||c.createAbortError()),this.doneLoading(r.task,r.err),e.madeProgress()}},t.prototype.doneLoading=function(e,t){for(var r=e.result instanceof HTMLImageElement?0:e.resolvers.length,n=0,i=e.resolvers;n<i.length;n++){var o=i[n];if(t)c.isAbortError(t)?o.reject(t):o.reject(new a("stream-data-loader:request-error","Failed to request resource at '"+e.url+"'. "+t,{url:e.url,error:t}));else{var l=--r<=0?e.result:s.clone(e.result);o.resolve(l)}}this.tasks.delete(e.key),0===this.tasks.size&&this._set("updating",!1)},t.prototype.startLoading=function(e,t){var i,o,a=this;if(4===e.status)return!1;switch(e.startTime=performance.now(),e.status=2,e.docType){case"binary":o="array-buffer",i=0;break;case"image":o="image";break;case"image+type":o="array-buffer";break;default:o="json"}e.abortController=c.createAbortController();var s=e.abortController.signal;e.request=n(e.url,r.__assign(r.__assign({},e.options),{responseType:o,timeout:i,signal:s}));var l=function(){},u=function(r){e.duration=performance.now()-e.startTime,e.size=r instanceof ArrayBuffer?r.byteLength:e.size||0,e.result=r,a.taskHandle?a.onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},p=function(r){2===e.status&&t(e,r),l()};return"image+type"!==e.docType?(e.request.then((function(e){return u(e.data)}),p),!0):(e.request.then((function(t){var r=t.data,a=function(e){if(e.byteLength<2)return"unknown";var t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(r);if(o="image",e.size=r.byteLength,"unknown"===a)return e.request=n(e.url,{responseType:o,timeout:i,signal:s}),void e.request.then((function(e){return u(e.data)}),p);var c=new Blob([r],{type:a}),d=window.URL.createObjectURL(c);l=function(){return window.URL.revokeObjectURL(d)},e.request=n(d,{responseType:o,timeout:i,signal:s}),e.request.then((function(e){return u(new m(e.data,a,l))}),p)}),p),!0)},Object.defineProperty(t.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0}),r.__decorate([u.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([u.subclass("esri.views.3d.support.StreamDataLoader")],t)}(i);t.StreamDataLoader=v;var m=function(){function e(e,t,r){this.image=e,this.type=t,this.release=r}return Object.defineProperty(e.prototype,"isOpaque",{get:function(){return"image/jpeg"===this.type},enumerable:!0,configurable:!0}),e}();t.ImageWithType=m,t.default=v}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(415),r(375),r(454)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=new Error("Abstract method called on TileAgent"),l=function(){function e(){}return Object.defineProperty(e.prototype,"updating",{get:function(){return!!this._tileRequested},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,r,n){this.tile=e,this._layerIdx=t,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(t,r),this._tileRequested=null;var i=this._findAncestorWithData();this._setUpsampleTile(i)},e.prototype.startLoading=function(){return this._requestNext()},e.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null},e.prototype.setSuspension=function(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())},e.prototype.update=function(){var e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()},e.prototype.dataArrived=function(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()},e.prototype.dataMissing=function(){this._tileRequested=null,this._tileLayerInfo.disposeData(),this._requestNext()},e.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()},e.prototype._requestNext=function(){if(this._suspended)return!0;var e=this._findNextDownload();if(i.TILE_LOADING_DEBUGLOG&&console.log(a.tile2str(this.tile),"next",a.tile2str(e)),this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested},e.prototype._findNextDownload=function(){for(var e,t=this._layerIdx,r=this._layerClass,s=this.tile.surface.layerViewByIndex(t,r),l=o.getLayerWithExtentRange(s),c=s.dataLevelRange,u=c.minLevel,p=c.maxLevel,d=this._desiredMinLevelDelta,h=this._loadingLevelDelta+d,f=this._scaleRangeEnabled?a.fallsWithinLayer:function(){return!0},v=this.tile,m=0,y=this._tileLayerInfo.upsampleInfo,g=y?y.tile.level:-1,_=n.get(l,"tilemapCache");v&&f(v,l,!1)&&v.level>=u;){var b=v.level,x=v.layerInfo[r][t];if(x.data&&m>=d){b>g&&this._setUpsampleTile(v),x.dataInvalidated&&(e=v);break}if((n.isNone(_)||"unavailable"!==_.getAvailability(v.lij[0],v.lij[1],v.lij[2]))&&b<=p&&!x.data&&!x.dataMissing&&((!e||b%i.LOADING_LEVEL_MODULO==0||this.tile.level-e.level<d)&&(e=v),m>=h))break;v=v.parent,m++}return e&&this.tile.level-e.level<d&&this._tileLayerInfo.upsampleInfo&&(e=null),e},e.prototype._findAncestorWithData=function(){for(var e,t=this.tile.vlevel,r=this._desiredMinLevelDelta,n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(t-n.level>=r)return n;e=n}return e},e.prototype._setUpsampleTile=function(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{findNextDownload:function(){return e._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0}),e}();t.TileAgent=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"_desiredMinLevelDelta",{get:function(){throw s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_loadingLevelDelta",{get:function(){throw s},enumerable:!0,configurable:!0}),t}(l);t.TILE_AGENT_DONE=new c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(162),r(160),r(245),r(193),r(238),r(1803),r(317),r(1280),r(415),r(195),r(249)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=u.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec2f(h.VertexAttrConstants.UV0),m=new c.BufferPool((function(e){return v.createBuffer(e)}),(function(e){return e.count}));t.clearCaches=function(){m.clear(),y.clear()},t.releaseGeometry=function(e){m.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null},t.createSphericalGlobePatch=function(e,t,n,i,o,c,u){var h=o[0],f=o[1],v=o[2],y=o[3],w=.1*l.earthRadius*(y-f),S=e.numVertsPerRow-1,M=e.numVertsPerRow-1,A=e.numVertsPerRow*e.numVertsPerRow,E=2*S+2*M,I=m.acquire(A+E),R=I.position.typedBuffer,D=I.uv0.typedBuffer,L=i.geometryInfo.boundingBox;s.empty(L);for(var j=t[2]-t[0],V=t[3]-t[1],F=v-h,N=n[0],k=n[1],z=n[2],U=0;U<=S;U++){var B=h+(K=U/S)*F;P[U]=Math.sin(B),T[U]=Math.cos(B),O[U]=K,C[U]=t[0]+K*j}for(var G=c&&!!(1&u),H=c&&!!(2&u),q=0,W=0;W<=M;W++){var J=W/M,Z=r.lerp(f,y,J),X=Math.cos(Z),Y=Math.sin(Z),Q=void 0;for(c?J=((Q=l.halfEarthRadius*Math.log((1+Y)/(1-Y)))-t[1])/V:Q=180*Z/Math.PI,U=0;U<=S;U++){var K=O[U],$=P[U],ee=T[U],te=l.earthRadius;e.samplerData&&(te+=p.ElevationData.sample(C[U],Q,e.samplerData)||0);var re=ee*X*te-N,ne=$*X*te-k,ie=Y*te-z;_(re,ne,ie,L);var oe=d.GEOMETRY_VERTEX_STRIDE*q;R[oe+0]=re,R[oe+1]=ne,R[oe+2]=ie,D[oe+0]=K,D[oe+1]=J;var ae=x(U,W,S,M);if(ae>-1){var se=d.GEOMETRY_VERTEX_STRIDE*(A+ae),le=G&&0===W?-1:H&&W===M?1:0,ce=0===le?re:-N,ue=0===le?ne:-k,pe=0===le?ie:l.earthRadius*le-z;R[se+0]=ce,R[se+1]=ue,R[se+2]=pe,D[se+0]=0===le?b(K,J):K,D[se+1]=0===le?w:J,0!==le&&_(ce,ue,pe,L)}++q}}i.geometryInfo.numVertsPerRow=e.numVertsPerRow,i.geometryInfo.vertexAttributes=I,i.geometryInfo.skirtLength=w,a.vec4.set(i.geometryInfo.uvOffsetAndScale,0,0,1,1),g(i.geometryInfo,e.numVertsPerRow,c?u:0,e.wireframe)},t.createPlanarGlobePatch=function(e,t,r,n){var i=t[0],o=t[1],l=t[2]-i,c=t[3]-o,u=e.clippingArea,h=u?Math.max(0,(u[0]-t[0])/l):0,f=u?Math.max(0,(u[1]-t[1])/c):0,v=u?Math.min(1,(u[2]-t[0])/l):1,y=u?Math.min(1,(u[3]-t[1])/c):1,w=v>h?1/(v-h):1,S=y>f?1/(y-f):1,P=-h*w,T=-f*S,O=.1*l,C=e.numVertsPerRow-1,M=e.numVertsPerRow-1,A=e.numVertsPerRow*e.numVertsPerRow,E=2*C+2*M,I=m.acquire(A+E),R=I.position.typedBuffer,D=I.uv0.typedBuffer,L=n.geometryInfo.boundingBox;s.empty(L);for(var j=0,V=0;V<=M;V++){var F=V/M,N=T+F*S,k=o+F*c;u&&(k<u[1]?(k=u[1],N=0):k>u[3]&&(k=u[3],N=1));for(var z=0;z<=C;z++){var U=z/C,B=P+U*w,G=i+U*l;u&&(G<u[0]?(G=u[0],B=0):G>u[2]&&(G=u[2],B=1));var H=e.samplerData&&p.ElevationData.sample(G,k,e.samplerData)||0,q=G-r[0],W=k-r[1],J=H-r[2];_(q,W,J,L);var Z=d.GEOMETRY_VERTEX_STRIDE*j;R[Z+0]=q,R[Z+1]=W,R[Z+2]=J,D[Z+0]=B,D[Z+1]=N;var X=x(z,V,C,C);if(X>-1){var Y=d.GEOMETRY_VERTEX_STRIDE*(A+X);R[Y+0]=q,R[Y+1]=W,R[Y+2]=J,D[Y+0]=b(B,N),D[Y+1]=O}++j}}n.geometryInfo.numVertsPerRow=e.numVertsPerRow,n.geometryInfo.vertexAttributes=I,n.geometryInfo.skirtLength=O,a.vec4.set(n.geometryInfo.uvOffsetAndScale,h,f,v-h,y-f),g(n.geometryInfo,e.numVertsPerRow,0,e.wireframe)};var y=new Map;function g(e,t,r,n){var i=(2&r)>0,o=t+(n?1024:0)+(i?2048:0),a=y.get(o);a||(a=function(e,t,r){var n=e-1,i=e-1,o=e*e,a=2*n+2*i,s=n*i*2*3,l=6*a,c=6*(2*n+i-1);r&&(s*=2,l*=2,c*=2);for(var u,p,d,h,f=o+a>65536?new Uint32Array(s+l):new Uint16Array(s+l),v=0,m=0,y=s,g=0,_=0;_<=i;_++){t&&(g=0===_?c:_===i?-c:0),y+=g;for(var b=0;b<=n;b++){var S=x(b,_,n,i);if(S>-1){var P=w(b,_,n,i);0!==P&&(u=v,p=o+S,d=o+(0===b&&1===_?0:S+1),h=v+P,r?(f[y+0]=u,f[y+1]=p,f[y+2]=p,f[y+3]=d,f[y+4]=d,f[y+5]=u,f[y+6]=d,f[y+7]=h,f[y+8]=h,f[y+9]=u,f[y+10]=u,f[y+11]=d,y+=12):(f[y+0]=u,f[y+1]=p,f[y+2]=d,f[y+3]=d,f[y+4]=h,f[y+5]=u,y+=6))}++v,b<n&&_<i&&(h=(d=(p=(u=_*(n+1)+b)+1)+(n+1))-1,r?(f[m+0]=u,f[m+1]=p,f[m+2]=p,f[m+3]=d,f[m+4]=d,f[m+5]=u,f[m+6]=d,f[m+7]=h,f[m+8]=h,f[m+9]=u,f[m+10]=u,f[m+11]=d,m+=12):(f[m+0]=u,f[m+1]=p,f[m+2]=d,f[m+3]=d,f[m+4]=h,f[m+5]=u,m+=6))}y-=g}return{values:f,numSurfaceIndices:s,numSkirtIndices:l}}(t,i,n),y.set(o,a)),e.indices=a.values,e.numSurfaceIndices=a.numSurfaceIndices,e.numSkirtIndices=a.numSkirtIndices,e.numWithoutSkirtIndices=e.numSurfaceIndices+(r?6*(t-1)*(n?2:1):0)}function _(e,t,r,n){e<n[0]&&(n[0]=e),e>n[3]&&(n[3]=e),t<n[1]&&(n[1]=t),t>n[4]&&(n[4]=t),r<n[2]&&(n[2]=r),r>n[5]&&(n[5]=r)}function b(e,t){var r=t>e?1:0;return 2+4*r+(1-2*r)*(e+t)}function x(e,t,r,n){return 0===t?e:e===r?r+t:t===n?r+n+(r-e):0===e&&t>0?2*r+n+(n-t):-1}function w(e,t,r,n){return 0===t&&e!==r?1:e===r&&t!==n?r+1:t===n&&0!==e?-1:0===e&&0!==t?-(r+1):0}var S=Math.pow(2,-52);t.intersectSkirts=function(e,t,r,o,a,s,l,c,u){var p,d,h,v=s.position,m=s.uv0,y=e[0],g=e[1],_=e[2],b=t[0]-y,x=t[1]-g,w=t[2]-_;o*=3;for(var P=r*=3;P<o;P+=3){var T=a[P],O=a[P+1],C=a[P+2],E=v.get(T,0),I=v.get(T,1),R=v.get(T,2),D=v.get(O,0),L=v.get(O,1),j=v.get(O,2),V=v.get(C,0),F=v.get(C,1),N=v.get(C,2),k=m.get(T,0),z=m.get(O,0),U=m.get(C,0);k>=2&&(i.vec3.set(M,E,I,R),l(M),E+=M[0],I+=M[1],R+=M[2]),z>=2&&(i.vec3.set(M,D,L,j),l(M),D+=M[0],L+=M[1],j+=M[2]),U>=2&&(i.vec3.set(M,V,F,N),l(M),V+=M[0],F+=M[1],N+=M[2]),n.isSome(c)&&(E=(p=c.applyToVertex(E,I,R))[0],I=p[1],R=p[2],D=(d=c.applyToVertex(D,L,j))[0],L=d[1],j=d[2],V=(h=c.applyToVertex(V,F,N))[0],F=h[1],N=h[2]);var B=D-E,G=L-I,H=j-R,q=V-E,W=F-I,J=N-R,Z=x*J-W*w,X=w*q-J*b,Y=b*W-q*x,Q=B*Z+G*X+H*Y,K=y-E,$=g-I,ee=_-R,te=$*H-G*ee,re=ee*B-H*K,ne=K*G-B*$;if(Q>S){if((ie=K*Z+$*X+ee*Y)<0||ie>Q)continue;if((oe=b*te+x*re+w*ne)<0||ie+oe>Q)continue}else{if(!(Q<-S))continue;var ie,oe;if((ie=K*Z+$*X+ee*Y)>0||ie<Q)continue;if((oe=b*te+x*re+w*ne)>0||ie+oe<Q)continue}var ae=(q*te+W*re+J*ne)/Q;ae>=0&&u(ae,f.computeNormal(B,G,H,q,W,J,A))}};var P=new Array(d.MAX_PATCH_TESSELATION+1),T=new Array(d.MAX_PATCH_TESSELATION+1),O=new Array(d.MAX_PATCH_TESSELATION+1),C=new Array(d.MAX_PATCH_TESSELATION+1),M=o.vec3f64.create(),A=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(389),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._low=n.vec3f32.create(),this._high=n.vec3f32.create(),e&&this.set(e)}return Object.defineProperty(e.prototype,"low",{get:function(){return this._low},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"high",{get:function(){return this._high},enumerable:!0,configurable:!0}),e.prototype.set=function(e){var t=this._low,n=this._high;r.vec3.copy(t,e),r.vec3.sub(n,e,t)},e.prototype.setElements=function(e,t,n){r.vec3.set(a,e,t,n),this.set(a)},e.prototype.get=function(e){return r.vec3.add(e,this._low,this._high)},e.prototype.getLowScaled=function(e){return r.vec3.scale(e,this._low,1)},e}();t.TwoVectorPosition=o;var a=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1847)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter((function(e){return 0!==e.activeCount||(e.dispose(),!1)}))},e.prototype.getBuffer=function(e){for(var t=0,n=this.buffers;t<n.length;t++){var i=n[t];if(i.availableCount>=e)return i}if(e>r.MAX_INDEX_COUNT)return null;var o=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(o),o},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(541),r(175)],void 0===(i=function(e,t,r,n,i){function o(e,t){var o=e.vertex;o.uniforms.add("uDistanceFalloffFactor","float"),o.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "],["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "])))),o.uniforms.add("uComponentDataTex","sampler2D"),o.uniforms.add("uComponentDataTexInvDim","vec2"),e.attributes.add("componentIndex","float"),o.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0),o.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1),o.defines.addFloat("COMPONENT_FIELD_COUNT",2),o.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8),o.defines.addFloat("EXTENSION_LENGTH_OFFSET",128),o.defines.addFloat("COMPONENT_TEX_WIDTH",4096),o.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex = vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex = _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex = _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n      );\n    }\n  "],["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex = vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex = _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex = _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n      );\n    }\n  "])))),t.legacy?o.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "])))):(o.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),o.code.add(i.glsl(c||(c=r.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "]))))),t.silhouette?(e.attributes.add("normalA","vec3"),e.attributes.add("normalB","vec3"),o.code.add(i.glsl(u||(u=r.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "]))))):(e.attributes.add("normal","vec3"),o.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "]))))),t.legacy?o.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "],["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "])))):(e.include(n.DoublePrecision,t),o.code.add(i.glsl(h||(h=r.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel = dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "],["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel = dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "]))))),o.code.add(i.glsl(f||(f=r.__makeTemplateObject(["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "],["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "]))))}var a,s,l,c,u,p,d,h,f;Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeUtil=o,function(e){e.usesSketchLogic=function(e){return 1===e.mode||2===e.mode},e.usesSolidLogic=function(e){return 0===e.mode||2===e.mode}}(o=t.EdgeUtil||(t.EdgeUtil={}))}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){var n;switch(void 0===t&&(t={}),r){case"webgl":n=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case"webgl2":n=["webgl2"];break;default:n=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}for(var i=null,o=0,a=n;o<a.length;o++){var s=a[o];try{i=e.getContext(s,t)}catch(e){}if(i)break}return i}function n(e,t){var r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}Object.defineProperty(t,"__esModule",{value:!0}),t.createContextOrErrorHTML=function(e,t,a){return void 0===t&&(t={}),window.WebGLRenderingContext?r(e,t,a)||(n(e,o),null):(n(e,i),null)},t.createContext=r;var i='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',o='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValueDescriptor=function(e,t,r,n){return void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=!0),{value:e,enumerable:t,writable:r,configurable:n}},t.wrapNative=function(e){return function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.apply(t,r)}}},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(322)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.path=e,this.callback=t,this.chain=null,this.conditional=null,e.indexOf(".")>-1){var n=r.parseConditionalPath(e);n&&(this.path=n.fullPath,this.conditional=n.conditional),this.chain=r.pathToArray(this.path)}else"?"===e[e.length-1]&&(this.path=e.slice(0,e.length-1),this.conditional=[!0],this.chain=[this.path]);return this.callback=t,this}return e.prototype.install=function(e){return function(e,t){return e.chain?new o(e,t):new i(e,t)}(this,e)},e.prototype.notify=function(e){this.callback(e,this.path)},e}(),i=function(){function e(e,t){this.binding=e,this.target=t,r.getProperties(t).addCursor(this.binding.path,this)}return e.prototype.destroy=function(){this.target&&(r.getProperties(this.target).removeCursor(this.binding.path,this),this.target=this.binding=null)},e.prototype.propertyDestroyed=function(e,t){r.getProperties(this.target).removeCursor(t,this)},e.prototype.propertyInvalidated=function(){this.binding&&this.binding.notify(this.target)},e.prototype.propertyCommitted=function(){this.binding&&this.binding.notify(this.target)},e}(),o=function(){function e(e,t){return this.binding=e,this.target=t,this.stack=[],this.properties=r.getProperties(t),this.stack.push({properties:this.properties,propertyName:e.chain[0]}),this.properties.addCursor(e.chain[0],this),this.moveForward(),this}return e.prototype.destroy=function(){for(;;){var e=this.stack.pop();if(null==e)break;e.properties.removeCursor(e.propertyName,this)}this.target=this.binding=null},e.prototype.propertyDestroyed=function(e,t){this.moveBackward(e,t)},e.prototype.propertyInvalidated=function(){this.binding&&this.binding.notify(this.target)},e.prototype.propertyCommitted=function(e,t){this.binding&&(this.moveBackward(e,t),this.moveForward(),this.binding.notify(this.target))},e.prototype.moveBackward=function(e,t){for(var r=this.stack,n=r[r.length-1];n.properties!==e&&n.propertyName!==t;)n.properties.removeCursor(n.propertyName,this),r.pop(),n=r[r.length-1]},e.prototype.moveForward=function(){var e=this.stack,t=e[e.length-1];if(1!==e.length||!this.binding.conditional||!this.binding.conditional[e.length-1]||t.properties.metadatas[t.propertyName]){var n=t.properties.internalGet(t.propertyName),i=r.getProperties(n);if(i&&e.length<this.binding.chain.length){var o=this.binding.chain[e.length];if(this.binding.conditional&&this.binding.conditional[e.length]&&!i.metadatas[o])return;this.stack.push({properties:i,propertyName:o}),i.addCursor(o,this),this.moveForward()}}},e}(),a=function(){function e(e){this.cursors=e}return e.prototype.remove=function(){for(var e=this.cursors;e.length>0;)e.pop().destroy();this.cursors=null},e}(),s=function(){function e(e){this.cursor=e}return e.prototype.remove=function(){this.cursor.destroy(),this.cursor=null},e}();function l(e,t,i){var o=r.splitPath(t);if(Array.isArray(o)){for(var l=[],c=0,u=o;c<u.length;c++){var p=u[c];l.push(new n(p,i).install(e))}return new a(l)}var d=new n(o,i).install(e);return new s(d)}t.create=function(e,t){var i=r.splitPath(e);if(Array.isArray(i)){for(var o=[],l=0,c=i;l<c.length;l++){var u=c[l];o.push(new n(u,t))}return function(e){for(var t=[],r=0;r<o.length;r++)t[r]=o[r].install(e);return new a(t)}}var p=new n(i,t);return function(e){return new s(p.install(e))}},t.wire=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(179),r(1414),r(1415),r(1416),r(1095)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t,r){var n=e&&e.json;if(e&&e.json&&e.json.origins&&r){var i=e.json.origins[r.origin];i&&("any"===t||t in i)&&(n=i)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.originSpecificReadPropertyDefinition=function(e,t){return s(e,"read",t)},t.originSpecificWritePropertyDefinition=function(e,t){return s(e,"write",t)},t.originSpecificPropertyDefinition=s,t.SerializablePropertyExtension={processPrototypePropertyMetadata:function(e,t){o.process(t)&&(n.process(t),function(e,t){for(var n=t.type,o=0;Array.isArray(n)&&!r.isOneOf(n);)n=n[0],o++;if(t.json.origins)for(var s in t.json.origins){var l=t.json.origins[s];i.create(n,o,e,l),a.create(n,o,e,l)}i.create(n,o,e,t.json),a.create(n,o,e,t.json)}(e,t))}},t.default=t.SerializablePropertyExtension}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(758);var n=r(1089),i={done:!0,value:void 0},o=function(){function e(e){this._nextIndex=-1,a(e)?this._nativeIterator=e[Symbol.iterator]():this._list=e}return e.prototype.next=function(){return this._nativeIterator?this._nativeIterator.next():this._list&&++this._nextIndex<this._list.length?{done:!1,value:this._list[this._nextIndex]}:i},e.prototype[Symbol.iterator]=function(){return this},e}();function a(e){return e&&"function"==typeof e[Symbol.iterator]}function s(e){return e&&"number"==typeof e.length}function l(e){return a(e)?e[Symbol.iterator]():s(e)?new o(e):void 0}t.ShimIterator=o,t.isIterable=a,t.isArrayLike=s,t.get=l,t.forOf=function(e,t,r){var i=!1;function o(){i=!0}if(s(e)&&"string"==typeof e)for(var a=e.length,c=0;c<a;++c){var u=e[c];if(c+1<a){var p=u.charCodeAt(0);p>=n.HIGH_SURROGATE_MIN&&p<=n.HIGH_SURROGATE_MAX&&(u+=e[++c])}if(t.call(r,u,e,o),i)return}else{var d=l(e);if(d)for(var h=d.next();!h.done;){if(t.call(r,h.value,e,o),i)return;h=d.next()}}}},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){void 0===e&&(e=1),this._seed=e}return Object.defineProperty(e.prototype,"seed",{set:function(t){this._seed=null==t?Math.random()*e._m:t},enumerable:!0,configurable:!0}),e.prototype.getInt=function(){return this._seed=(e._a*this._seed+e._c)%e._m,this._seed},e.prototype.getFloat=function(){return this.getInt()/(e._m-1)},e.prototype.getIntRange=function(e,t){return Math.round(this.getFloatRange(e,t))},e.prototype.getFloatRange=function(t,r){var n=r-t,i=this.getInt()/e._m;return t+Math.floor(i*n)},e._m=2147483647,e._a=48271,e._c=0,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(476),r(118),r(1100),r(231),r(614),r(322),r(851)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c,u=function(){function e(){this.uid=0,this.target=null,this.path=null,this.oldValue=null,this.callback=null,this.removed=!1,this.propertyPath=null}return e.prototype.acquire=function(t,r,n,i){this.target=t,this.path=r,this.oldValue=n,this.callback=i,this.propertyPath=s.pathToStringOrArray(r),this.uid=++e.uid,this.removed=!1},e.prototype.release=function(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null,this.uid=++e.uid,this.removed=!0},e.pool=new i.ReentrantObjectPool(e),e.uid=0,e}(),p=new r,d=new Set,h=p.acquire();function f(e){d.has(e)?h.splice(h.indexOf(e),1):d.add(e),h.push(e),c||(c=o.schedule(y))}function v(e){if(!e.removed){var t=e.callback,r=e.path,n=e.propertyPath,i=e.oldValue,o=e.target,s=a.valueOf(o,n,!0);m(i,s)&&(e.oldValue=s,t.call(o,s,i,r,o))}}function m(e,t){return!n.equals(e,t)}function y(){for(var e=10;c&&e--;){c=null;var t=h;h=p.acquire(),d.clear();for(var r=p.acquire(),n=0,i=t;n<i.length;n++){var o=(s=i[n]).uid;v(s),o===s.uid&&s.removed&&r.push(s)}for(var a=0;a<h.length;a++){var s;(s=h[a]).removed&&(r.push(s),d.delete(s),h.splice(a,1),a-=1)}for(a=0;a<r.length;a++)u.pool.release(r[a]);p.release(t),p.release(r),g.forEach((function(e){return e()}))}}t.dispatchTarget=function(e){for(var t=p.copy(h),r=0;r<t.length;r++){var n=t[r];n.target===e&&(v(n),d.delete(n),h.splice(h.indexOf(n),1))}},t.removeTarget=function(e){for(var t=0;t<h.length;t++)(r=h[t]).target===e&&(r.removed=!0);var r},t.dispatch=y;var g=new Set;function _(e,t,r,n){return void 0===n&&(n=!1),!e.__accessor__||e.__accessor__.destroyed?{remove:function(){}}:n?function(e,t,r){var n=s.parse(e,t,r,(function(e,t,r){var i=a.valueOf(e,t,!0),o=!1;return l.wire(e,t,(function(e,t){if(e.__accessor__.destroyed)n.remove();else if(!o){o=!0;var s=a.valueOf(e,t,!0);m(i,s)&&r.call(e,s,i,t,e),i=a.valueOf(e,t,!0),o=!1}}))}));return n}(e,t,r):function(e,t,r){var n=s.parse(e,t,r,(function(e,t,r){var i,o,c=a.valueOf(e,t,!0),p=l.wire(e,t,(function(e,t){e.__accessor__.destroyed||i&&i.uid!==o?n.remove():(i||(i=u.pool.acquire(e,t,c,r),o=i.uid,c=null),f(i))}));return{remove:s.once((function(){p.remove(),i&&(i.uid!==o||i.removed||(i.removed=!0,f(i)),i=null),n=p=c=null}))}}));return n}(e,t,r)}t.afterDispatch=function(e){return g.add(e),{remove:function(){g.delete(e)}}},t.watch=_,t.isValueInUse=function(e){return h.some((function(t){return t.oldValue===e}))},t.default=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(121),r(161)],void 0===(i=function(e,t,r){var n=r.queueMicrotask?r.queueMicrotask:function(e){r.Promise.resolve().then(e)},i=[],o=[];function a(e){i.push(e),1===i.length&&n((function(){for(var e=0,t=o;e<t.length;e++)(0,t[e])();var r=i.slice();i.length=0;for(var n=0,a=r;n<a.length;n++)(0,a[n])()}))}return function(e){e.before=function(e){return o.push(e),{remove:function(){o=o.filter((function(t){return t!==e}))}}}}(a||(a={})),a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(614),r(322),r(852)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;var i=e.read.source;if("string"==typeof i){if(i===t)return!0;if(i.indexOf(".")>-1&&0===i.indexOf(t)&&n.exists(i,r))return!0}else for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s===t)return!0;if(s.indexOf(".")>-1&&0===s.indexOf(t)&&n.exists(s,r))return!0}return!1}function s(e,t,r,n,i){var s=o.originSpecificReadPropertyDefinition(t[r],i);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(s)&&(e[r]=!0);for(var l=0,c=Object.getOwnPropertyNames(t);l<c.length;l++){var u=c[l];a(s=o.originSpecificReadPropertyDefinition(t[u],i),r,n)&&(e[u]=!0)}}function l(e,t,r,n){var i=r.metadatas,a=o.originSpecificPropertyDefinition(i[t],"any",n),s=a&&a.default;if(void 0!==s){var l="function"==typeof s?s.call(e,t,n):s;void 0!==l&&r.set(t,l)}}Object.defineProperty(t,"__esModule",{value:!0});var c={origin:"service"};function u(e,t,r){if(void 0===r&&(r=c),t&&"object"==typeof t){for(var a=i.getProperties(e),u=a.metadatas,p={},d=0,h=Object.getOwnPropertyNames(t);d<h.length;d++)s(p,u,h[d],t,r);a.setDefaultOrigin(r.origin);for(var f=0,v=Object.getOwnPropertyNames(p);f<v.length;f++){var m=v[f],y=o.originSpecificReadPropertyDefinition(u[m],r).read,g=y&&y.source,_=void 0;_=g&&"string"==typeof g?n.valueOf(t,g):t[m],y&&y.reader&&(_=y.reader.call(e,_,t,r)),void 0!==_&&a.set(m,_)}if(!r||!r.ignoreDefaults)for(var b=0,x=Object.getOwnPropertyNames(u);b<x.length;b++)p[m=x[b]]||l(e,m,a,r);a.setDefaultOrigin("user")}}t.read=u,t.readLoadable=function(e,t,n,i){void 0===i&&(i=c);var o=r.__assign(r.__assign({},i),{messages:[]});n(o),o.messages.forEach((function(t){"warning"!==t.type||e.loaded?i&&i.messages.push(t):e.loadWarnings.push(t)}))},t.default=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(119),r(229),r(366),r(477)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=r.getLogger("esri.intl");function l(e){switch(typeof e){case"string":return e;case"number":return a.formatNumber(e);case"boolean":return""+e;default:return e instanceof Date?o.formatDate(e):""}}t.substitute=function(e,t,r){void 0===r&&(r={});var c=r.format,u=void 0===c?{}:c;return i.replace(e,(function(e){return function(e,t,r){var i,c,u=e.indexOf(":");if(-1===u?i=e.trim():(i=e.slice(0,u).trim(),c=e.slice(u+1).trim()),!i)return"";var p=n.getDeepValue(i,t);if(null==p)return"";var d=r[c]||r[i];return d?function(e,t){switch(t.type){case"date":return o.formatDate(e,t.intlOptions);case"number":return a.formatNumber(e,t.intlOptions);default:return s.warn("missing format descriptor for key {key}"),l(e)}}(p,d):c?function(e,t){switch(t.toLowerCase()){case"dateformat":return o.formatDate(e);case"numberformat":return a.formatNumber(e);default:return s.warn("inline format is unsupported since 4.12: "+t),/^(dateformat|datestring)/i.test(t)?o.formatDate(e):/^numberformat/i.test(t)?a.formatNumber(e):l(e)}}(p,c):l(p)}(e,t,u)}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(154),r(152),r(153),r(198),r(517),r(161)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,u=s.SetFromValues(["ar","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-BR","pt-PT","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),p=new Map;function d(e){if(!c.test(e))return null;var t=c.exec(e),r=t[1],n=t[2],i=r+(n?"-"+n.toUpperCase():"");return u.has(i)?i:u.has(r)?r:null}function h(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return o.isSome(t.test.fetchBundleAsset)?[2,t.test.fetchBundleAsset(e)]:[4,n.fetchAsset(e,{responseType:"json"})];case 1:return[2,r.sent().data]}}))}))}l.beforeLocaleChange((function(){p.clear()})),t.loadMessageBundle=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return p.has(e)||p.set(e,function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,a,s,c,u,p,f;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=/^(.*)\/t9n\/(.*)$/g.exec(e)))throw new i("esri-intl:invalid-bundle",'Missing "t9n" folder in locale bundle path "'+e+'"');n=t[1]+"/t9n/",o=t[2],a=l.getLocale(),s=d(a),c=""+n+o+".json",u=s?""+n+o+"_"+s+".json":c,r.label=1;case 1:return r.trys.push([1,3,,8]),[4,h(u)];case 2:return p=r.sent(),[3,8];case 3:if(f=r.sent(),u===c)throw f;r.label=4;case 4:return r.trys.push([4,6,,7]),[4,h(c)];case 5:return p=r.sent(),[3,7];case 6:throw r.sent(),new i("esri-intl:unknown-bundle",'Bundle "'+e+'" cannot be loaded',{error:f});case 7:return[3,8];case 8:return[2,p]}}))}))}(e)),t=p.get(e),[4,f.add(t)];case 1:return n.sent(),[2,t]}}))}))},t.getKnownMessageBundleLocale=d;var f=new(function(){function e(){this._numLoading=0}return e.prototype.waitForAll=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._dfd?[4,this._dfd.promise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.add=function(e){var t=this;return this._increase(),e.then((function(){return t._decrease()}),(function(){return t._decrease()})),this.waitForAll()},e.prototype._increase=function(){this._numLoading++,this._dfd||(this._dfd=a.createDeferred())},e.prototype._decrease=function(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)},e}());t.test={cache:p}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;!function(o){if("object"==typeof e.exports){var a=o();void 0!==a&&(e.exports=a)}else void 0===(i="function"==typeof(n=o)?n.call(null,r,t,e):n)||(e.exports=i)}((function(){"use strict";var e,t={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(e=2e3;e<=2045;e++)t[e]=0;for(e=2056;e<=2065;e++)t[e]=0;for(e=2067;e<=2135;e++)t[e]=0;for(e=2137;e<=2154;e++)t[e]=0;for(e=2161;e<=2170;e++)t[e]=0;for(e=2172;e<=2193;e++)t[e]=0;for(e=2195;e<=2198;e++)t[e]=0;for(e=2200;e<=2203;e++)t[e]=0;for(e=2205;e<=2217;e++)t[e]=0;for(e=2222;e<=2224;e++)t[e]=1;for(e=2225;e<=2250;e++)t[e]=2;for(e=2251;e<=2253;e++)t[e]=1;for(e=2257;e<=2264;e++)t[e]=2;for(e=2274;e<=2279;e++)t[e]=2;for(e=2280;e<=2282;e++)t[e]=1;for(e=2283;e<=2289;e++)t[e]=2;for(e=2290;e<=2292;e++)t[e]=0;for(e=2308;e<=2313;e++)t[e]=0;for(e=2315;e<=2491;e++)t[e]=0;for(e=2494;e<=2866;e++)t[e]=0;for(e=2867;e<=2869;e++)t[e]=1;for(e=2870;e<=2888;e++)t[e]=2;for(e=2891;e<=2895;e++)t[e]=2;for(e=2896;e<=2898;e++)t[e]=1;for(e=2902;e<=2908;e++)t[e]=2;for(e=2915;e<=2920;e++)t[e]=2;for(e=2921;e<=2923;e++)t[e]=1;for(e=2924;e<=2930;e++)t[e]=2;for(e=2931;e<=2962;e++)t[e]=0;for(e=2964;e<=2968;e++)t[e]=2;for(e=2969;e<=2973;e++)t[e]=0;for(e=2975;e<=2991;e++)t[e]=0;for(e=2995;e<=3051;e++)t[e]=0;for(e=3054;e<=3079;e++)t[e]=0;for(e=3081;e<=3088;e++)t[e]=0;for(e=3092;e<=3101;e++)t[e]=0;for(e=3106;e<=3138;e++)t[e]=0;for(e=3146;e<=3151;e++)t[e]=0;for(e=3153;e<=3166;e++)t[e]=0;for(e=3168;e<=3172;e++)t[e]=0;for(e=3174;e<=3203;e++)t[e]=0;for(e=3294;e<=3358;e++)t[e]=0;for(e=3367;e<=3403;e++)t[e]=0;for(e=3408;e<=3416;e++)t[e]=0;for(e=3417;e<=3438;e++)t[e]=2;for(e=3441;e<=3446;e++)t[e]=2;for(e=3447;e<=3450;e++)t[e]=0;for(e=3451;e<=3459;e++)t[e]=2;for(e=3460;e<=3478;e++)t[e]=0;for(e=3554;e<=3559;e++)t[e]=0;for(e=3560;e<=3570;e++)t[e]=2;for(e=3571;e<=3581;e++)t[e]=0;for(e=3594;e<=3597;e++)t[e]=0;for(e=3601;e<=3604;e++)t[e]=0;for(e=3637;e<=3639;e++)t[e]=0;for(e=3665;e<=3667;e++)t[e]=0;for(e=3693;e<=3695;e++)t[e]=0;for(e=3701;e<=3727;e++)t[e]=0;for(e=3728;e<=3739;e++)t[e]=2;for(e=3740;e<=3751;e++)t[e]=0;for(e=3753;e<=3760;e++)t[e]=2;for(e=3761;e<=3773;e++)t[e]=0;for(e=3775;e<=3777;e++)t[e]=0;for(e=3779;e<=3781;e++)t[e]=0;for(e=3783;e<=3785;e++)t[e]=0;for(e=3788;e<=3791;e++)t[e]=0;for(e=3797;e<=3802;e++)t[e]=0;for(e=3814;e<=3816;e++)t[e]=0;for(e=3825;e<=3829;e++)t[e]=0;for(e=3832;e<=3841;e++)t[e]=0;for(e=3844;e<=3852;e++)t[e]=0;for(e=3873;e<=3885;e++)t[e]=0;for(e=3890;e<=3893;e++)t[e]=0;for(e=3907;e<=3912;e++)t[e]=0;for(e=3942;e<=3950;e++)t[e]=0;for(e=3968;e<=3970;e++)t[e]=0;for(e=3973;e<=3976;e++)t[e]=0;for(e=3986;e<=3989;e++)t[e]=0;for(e=3994;e<=3997;e++)t[e]=0;for(e=4048;e<=4051;e++)t[e]=0;for(e=4056;e<=4063;e++)t[e]=0;for(e=4093;e<=4096;e++)t[e]=0;for(e=4390;e<=4398;e++)t[e]=0;for(e=4399;e<=4413;e++)t[e]=2;for(e=4418;e<=4433;e++)t[e]=2;for(e=4455;e<=4457;e++)t[e]=2;for(e=4484;e<=4489;e++)t[e]=0;for(e=4491;e<=4554;e++)t[e]=0;for(e=4568;e<=4589;e++)t[e]=0;for(e=4652;e<=4656;e++)t[e]=0;for(e=4766;e<=4800;e++)t[e]=0;for(e=5014;e<=5016;e++)t[e]=0;for(e=5069;e<=5072;e++)t[e]=0;for(e=5105;e<=5130;e++)t[e]=0;for(e=5173;e<=5188;e++)t[e]=0;for(e=5253;e<=5259;e++)t[e]=0;for(e=5269;e<=5275;e++)t[e]=0;for(e=5292;e<=5311;e++)t[e]=0;for(e=5329;e<=5331;e++)t[e]=0;for(e=5343;e<=5349;e++)t[e]=0;for(e=5355;e<=5357;e++)t[e]=0;for(e=5387;e<=5389;e++)t[e]=0;for(e=5459;e<=5463;e++)t[e]=0;for(e=5479;e<=5482;e++)t[e]=0;for(e=5518;e<=5520;e++)t[e]=0;for(e=5530;e<=5539;e++)t[e]=0;for(e=5550;e<=5552;e++)t[e]=0;for(e=5562;e<=5583;e++)t[e]=0;for(e=5623;e<=5625;e++)t[e]=2;for(e=5631;e<=5639;e++)t[e]=0;for(e=5649;e<=5653;e++)t[e]=0;for(e=5663;e<=5680;e++)t[e]=0;for(e=5682;e<=5685;e++)t[e]=0;for(e=5875;e<=5877;e++)t[e]=0;for(e=5896;e<=5899;e++)t[e]=0;for(e=5921;e<=5940;e++)t[e]=0;for(e=6050;e<=6125;e++)t[e]=0;for(e=6244;e<=6275;e++)t[e]=0;for(e=6328;e<=6348;e++)t[e]=0;for(e=6350;e<=6356;e++)t[e]=0;for(e=6366;e<=6372;e++)t[e]=0;for(e=6381;e<=6387;e++)t[e]=0;for(e=6393;e<=6404;e++)t[e]=0;for(e=6480;e<=6483;e++)t[e]=0;for(e=6511;e<=6514;e++)t[e]=0;for(e=6579;e<=6581;e++)t[e]=0;for(e=6619;e<=6624;e++)t[e]=0;for(e=6625;e<=6627;e++)t[e]=2;for(e=6628;e<=6632;e++)t[e]=0;for(e=6634;e<=6637;e++)t[e]=0;for(e=6669;e<=6692;e++)t[e]=0;for(e=6707;e<=6709;e++)t[e]=0;for(e=6720;e<=6723;e++)t[e]=0;for(e=6732;e<=6738;e++)t[e]=0;for(e=6931;e<=6933;e++)t[e]=0;for(e=6956;e<=6959;e++)t[e]=0;for(e=7005;e<=7007;e++)t[e]=0;for(e=7057;e<=7070;e++)t[e]=2;for(e=7074;e<=7082;e++)t[e]=0;for(e=7109;e<=7118;e++)t[e]=0;for(e=7119;e<=7127;e++)t[e]=1;for(e=7374;e<=7376;e++)t[e]=0;for(e=7528;e<=7586;e++)t[e]=0;for(e=7587;e<=7645;e++)t[e]=2;for(e=7692;e<=7696;e++)t[e]=0;for(e=7755;e<=7787;e++)t[e]=0;for(e=7791;e<=7795;e++)t[e]=0;for(e=7799;e<=7801;e++)t[e]=0;for(e=7803;e<=7805;e++)t[e]=0;for(e=7825;e<=7831;e++)t[e]=0;for(e=7845;e<=7859;e++)t[e]=0;for(e=8013;e<=8032;e++)t[e]=0;for(e=8065;e<=8068;e++)t[e]=1;for(e=8518;e<=8529;e++)t[e]=2;for(e=8533;e<=8536;e++)t[e]=2;for(e=8538;e<=8540;e++)t[e]=2;for(e=8677;e<=8679;e++)t[e]=0;for(e=8836;e<=8840;e++)t[e]=0;for(e=8857;e<=8859;e++)t[e]=0;for(e=8908;e<=8910;e++)t[e]=0;for(e=9154;e<=9159;e++)t[e]=0;for(e=9205;e<=9218;e++)t[e]=0;for(e=9271;e<=9273;e++)t[e]=0;for(e=20002;e<=20032;e++)t[e]=0;for(e=20062;e<=20092;e++)t[e]=0;for(e=20135;e<=20138;e++)t[e]=0;for(e=20248;e<=20258;e++)t[e]=0;for(e=20348;e<=20358;e++)t[e]=0;for(e=20436;e<=20440;e++)t[e]=0;for(e=20822;e<=20824;e++)t[e]=0;for(e=20934;e<=20936;e++)t[e]=0;for(e=21035;e<=21037;e++)t[e]=0;for(e=21095;e<=21097;e++)t[e]=0;for(e=21148;e<=21150;e++)t[e]=0;for(e=21413;e<=21423;e++)t[e]=0;for(e=21453;e<=21463;e++)t[e]=0;for(e=21473;e<=21483;e++)t[e]=0;for(e=21780;e<=21782;e++)t[e]=0;for(e=21891;e<=21894;e++)t[e]=0;for(e=21896;e<=21899;e++)t[e]=0;for(e=22171;e<=22177;e++)t[e]=0;for(e=22181;e<=22187;e++)t[e]=0;for(e=22191;e<=22197;e++)t[e]=0;for(e=22234;e<=22236;e++)t[e]=0;for(e=22521;e<=22525;e++)t[e]=0;for(e=22991;e<=22994;e++)t[e]=0;for(e=23028;e<=23038;e++)t[e]=0;for(e=23830;e<=23853;e++)t[e]=0;for(e=23866;e<=23872;e++)t[e]=0;for(e=23877;e<=23884;e++)t[e]=0;for(e=23886;e<=23894;e++)t[e]=0;for(e=23946;e<=23948;e++)t[e]=0;for(e=24311;e<=24313;e++)t[e]=0;for(e=24342;e<=24347;e++)t[e]=0;for(e=24370;e<=24374;e++)t[e]=10;for(e=24375;e<=24381;e++)t[e]=0;for(e=24718;e<=24721;e++)t[e]=0;for(e=24817;e<=24821;e++)t[e]=0;for(e=24877;e<=24882;e++)t[e]=0;for(e=24891;e<=24893;e++)t[e]=0;for(e=25391;e<=25395;e++)t[e]=0;for(e=25828;e<=25838;e++)t[e]=0;for(e=26191;e<=26195;e++)t[e]=0;for(e=26391;e<=26393;e++)t[e]=0;for(e=26701;e<=26722;e++)t[e]=0;for(e=26729;e<=26799;e++)t[e]=2;for(e=26801;e<=26803;e++)t[e]=2;for(e=26811;e<=26813;e++)t[e]=2;for(e=26847;e<=26870;e++)t[e]=2;for(e=26891;e<=26899;e++)t[e]=0;for(e=26901;e<=26923;e++)t[e]=0;for(e=26929;e<=26946;e++)t[e]=0;for(e=26948;e<=26998;e++)t[e]=0;for(e=27037;e<=27040;e++)t[e]=0;for(e=27205;e<=27232;e++)t[e]=0;for(e=27258;e<=27260;e++)t[e]=0;for(e=27391;e<=27398;e++)t[e]=0;for(e=27561;e<=27564;e++)t[e]=0;for(e=27571;e<=27574;e++)t[e]=0;for(e=27581;e<=27584;e++)t[e]=0;for(e=27591;e<=27594;e++)t[e]=0;for(e=28191;e<=28193;e++)t[e]=0;for(e=28348;e<=28358;e++)t[e]=0;for(e=28402;e<=28432;e++)t[e]=0;for(e=28462;e<=28492;e++)t[e]=0;for(e=29118;e<=29122;e++)t[e]=0;for(e=29168;e<=29172;e++)t[e]=0;for(e=29177;e<=29185;e++)t[e]=0;for(e=29187;e<=29195;e++)t[e]=0;for(e=29900;e<=29903;e++)t[e]=0;for(e=30161;e<=30179;e++)t[e]=0;for(e=30491;e<=30494;e++)t[e]=0;for(e=30729;e<=30732;e++)t[e]=0;for(e=31251;e<=31259;e++)t[e]=0;for(e=31265;e<=31268;e++)t[e]=0;for(e=31275;e<=31279;e++)t[e]=0;for(e=31281;e<=31297;e++)t[e]=0;for(e=31461;e<=31469;e++)t[e]=0;for(e=31491;e<=31495;e++)t[e]=0;for(e=31917;e<=31922;e++)t[e]=0;for(e=31965;e<=32e3;e++)t[e]=0;for(e=32001;e<=32003;e++)t[e]=2;for(e=32005;e<=32031;e++)t[e]=2;for(e=32033;e<=32060;e++)t[e]=2;for(e=32064;e<=32067;e++)t[e]=2;for(e=32074;e<=32077;e++)t[e]=2;for(e=32081;e<=32086;e++)t[e]=0;for(e=32107;e<=32130;e++)t[e]=0;for(e=32133;e<=32158;e++)t[e]=0;for(e=32164;e<=32167;e++)t[e]=2;for(e=32180;e<=32199;e++)t[e]=0;for(e=32201;e<=32260;e++)t[e]=0;for(e=32301;e<=32360;e++)t[e]=0;for(e=32601;e<=32662;e++)t[e]=0;for(e=32664;e<=32667;e++)t[e]=2;for(e=32701;e<=32761;e++)t[e]=0;for(e=53001;e<=53004;e++)t[e]=0;for(e=53008;e<=53019;e++)t[e]=0;for(e=53021;e<=53032;e++)t[e]=0;for(e=53034;e<=53037;e++)t[e]=0;for(e=53042;e<=53046;e++)t[e]=0;for(e=53074;e<=53080;e++)t[e]=0;for(e=54001;e<=54004;e++)t[e]=0;for(e=54008;e<=54019;e++)t[e]=0;for(e=54021;e<=54032;e++)t[e]=0;for(e=54034;e<=54037;e++)t[e]=0;for(e=54042;e<=54046;e++)t[e]=0;for(e=54048;e<=54053;e++)t[e]=0;for(e=54074;e<=54080;e++)t[e]=0;for(e=54098;e<=54101;e++)t[e]=0;for(e=102001;e<=102040;e++)t[e]=0;for(e=102042;e<=102063;e++)t[e]=0;for(e=102065;e<=102067;e++)t[e]=0;for(e=102070;e<=102117;e++)t[e]=0;for(e=102122;e<=102216;e++)t[e]=0;for(e=102221;e<=102377;e++)t[e]=0;for(e=102382;e<=102388;e++)t[e]=0;for(e=102389;e<=102398;e++)t[e]=2;for(e=102399;e<=102444;e++)t[e]=0;for(e=102445;e<=102447;e++)t[e]=2;for(e=102448;e<=102458;e++)t[e]=0;for(e=102459;e<=102468;e++)t[e]=2;for(e=102469;e<=102499;e++)t[e]=0;for(e=102500;e<=102519;e++)t[e]=1;for(e=102520;e<=102524;e++)t[e]=0;for(e=102525;e<=102529;e++)t[e]=2;for(e=102530;e<=102588;e++)t[e]=0;for(e=102590;e<=102598;e++)t[e]=0;for(e=102601;e<=102603;e++)t[e]=0;for(e=102605;e<=102628;e++)t[e]=0;for(e=102629;e<=102646;e++)t[e]=2;for(e=102648;e<=102700;e++)t[e]=2;for(e=102701;e<=102703;e++)t[e]=0;for(e=102707;e<=102730;e++)t[e]=2;for(e=102733;e<=102758;e++)t[e]=2;for(e=102767;e<=102900;e++)t[e]=0;for(e=102965;e<=102969;e++)t[e]=0;for(e=102971;e<=102973;e++)t[e]=0;for(e=102975;e<=102989;e++)t[e]=0;for(e=102990;e<=102992;e++)t[e]=1;for(e=102997;e<=103002;e++)t[e]=0;for(e=103003;e<=103008;e++)t[e]=2;for(e=103009;e<=103011;e++)t[e]=0;for(e=103012;e<=103014;e++)t[e]=2;for(e=103019;e<=103021;e++)t[e]=0;for(e=103022;e<=103024;e++)t[e]=2;for(e=103029;e<=103031;e++)t[e]=0;for(e=103032;e<=103034;e++)t[e]=2;for(e=103065;e<=103068;e++)t[e]=0;for(e=103074;e<=103076;e++)t[e]=0;for(e=103077;e<=103079;e++)t[e]=1;for(e=103080;e<=103082;e++)t[e]=0;for(e=103083;e<=103085;e++)t[e]=2;for(e=103090;e<=103093;e++)t[e]=0;for(e=103097;e<=103099;e++)t[e]=0;for(e=103100;e<=103102;e++)t[e]=2;for(e=103107;e<=103109;e++)t[e]=0;for(e=103110;e<=103112;e++)t[e]=2;for(e=103113;e<=103116;e++)t[e]=0;for(e=103117;e<=103120;e++)t[e]=2;for(e=103153;e<=103157;e++)t[e]=0;for(e=103158;e<=103162;e++)t[e]=2;for(e=103163;e<=103165;e++)t[e]=0;for(e=103166;e<=103168;e++)t[e]=1;for(e=103169;e<=103171;e++)t[e]=2;for(e=103186;e<=103188;e++)t[e]=0;for(e=103189;e<=103191;e++)t[e]=2;for(e=103192;e<=103195;e++)t[e]=0;for(e=103196;e<=103199;e++)t[e]=2;for(e=103200;e<=103224;e++)t[e]=0;for(e=103225;e<=103227;e++)t[e]=1;for(e=103232;e<=103237;e++)t[e]=0;for(e=103238;e<=103243;e++)t[e]=2;for(e=103244;e<=103246;e++)t[e]=0;for(e=103247;e<=103249;e++)t[e]=2;for(e=103254;e<=103256;e++)t[e]=0;for(e=103257;e<=103259;e++)t[e]=2;for(e=103264;e<=103266;e++)t[e]=0;for(e=103267;e<=103269;e++)t[e]=2;for(e=103300;e<=103375;e++)t[e]=0;for(e=103381;e<=103383;e++)t[e]=0;for(e=103384;e<=103386;e++)t[e]=1;for(e=103387;e<=103389;e++)t[e]=0;for(e=103390;e<=103392;e++)t[e]=2;for(e=103397;e<=103399;e++)t[e]=0;for(e=103400;e<=103471;e++)t[e]=2;for(e=103476;e<=103478;e++)t[e]=0;for(e=103479;e<=103481;e++)t[e]=2;for(e=103486;e<=103488;e++)t[e]=0;for(e=103489;e<=103491;e++)t[e]=2;for(e=103492;e<=103495;e++)t[e]=0;for(e=103496;e<=103499;e++)t[e]=2;for(e=103528;e<=103543;e++)t[e]=0;for(e=103544;e<=103548;e++)t[e]=2;for(e=103549;e<=103551;e++)t[e]=0;for(e=103552;e<=103554;e++)t[e]=1;for(e=103555;e<=103557;e++)t[e]=2;for(e=103558;e<=103560;e++)t[e]=0;for(e=103571;e<=103573;e++)t[e]=0;for(e=103574;e<=103576;e++)t[e]=2;for(e=103577;e<=103580;e++)t[e]=0;for(e=103581;e<=103583;e++)t[e]=2;for(e=103595;e<=103598;e++)t[e]=0;for(e=103600;e<=103694;e++)t[e]=0;for(e=103696;e<=103699;e++)t[e]=0;for(e=103700;e<=103793;e++)t[e]=2;for(e=103794;e<=103871;e++)t[e]=0;for(e=103900;e<=103971;e++)t[e]=2;return t}))},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updateSupportFromPoint=function(e,t,r){void 0===r&&(r=!1);var n=e.hasM,i=e.hasZ;Array.isArray(t)?4!==t.length||n||i?3===t.length&&r&&!n?(i=!0,n=!1):3===t.length&&n&&i&&(n=!1,i=!1):(n=!0,i=!0):(i=!i&&t.hasZ&&(!n||t.hasM),n=!n&&t.hasM&&(!i||t.hasZ)),e.hasZ=i,e.hasM=n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(427)],void 0===(i=function(e,t,r){function n(e,t){if(!e||!e.length)return null;for(var r=[],n=[],a=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0],s=0,l=e.length;s<l;s++){var c=i(e[s],t,a);c&&n.push(c)}if(n.sort((function(e,r){var n=e[2]-r[2];return 0===n&&t&&(n=e[4]-r[4]),n})),n.length){var u=6*n[0][2];r[0]=n[0][0]/u,r[1]=n[0][1]/u,t&&(u=6*n[0][4],r[2]=0!==u?n[0][3]/u:0),(r[0]<a[0]||r[0]>a[1]||r[1]<a[2]||r[1]>a[3]||t&&(r[2]<a[4]||r[2]>a[5]))&&(r.length=0)}if(!r.length){var p=e[0]&&e[0].length?o(e[0],t):null;if(!p)return null;r[0]=p[0],r[1]=p[1],t&&p.length>2&&(r[2]=p[2])}return r}function i(e,t,r){for(var n=0,i=0,o=0,a=0,s=0,l=0;l<e.length;l++){var c=e[l],u=c[0],p=c[1],d=c[2],h=e[(l+1)%e.length],f=h[0],v=h[1],m=h[2],y=u*v-f*p;a+=y,n+=(u+f)*y,i+=(p+v)*y,t&&c.length>2&&h.length>2&&(o+=(d+m)*(y=u*m-f*d),s+=y),u<r[0]&&(r[0]=u),u>r[1]&&(r[1]=u),p<r[2]&&(r[2]=p),p>r[3]&&(r[3]=p),t&&(d<r[4]&&(r[4]=d),d>r[5]&&(r[5]=d))}if(a>0&&(a*=-1),s>0&&(s*=-1),!a)return null;var g=[n,i,.5*a];return t&&(g[3]=o,g[4]=.5*s),g}function o(e,t){for(var n=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0],o=0,a=0,s=0,l=0,c=0,u=e.length;c<u-1;c++){var p=e[c],d=e[c+1];if(p&&d){n[0]=p[0],n[1]=p[1],i[0]=d[0],i[1]=d[1],t&&p.length>2&&d.length>2&&(n[2]=p[2],i[2]=d[2]);var h=r.getLength(n,i);if(h){o+=h;var f=r.getMidpoint(p,d);a+=h*f[0],s+=h*f[1],t&&f.length>2&&(l+=h*f[2])}}}return o>0?t?[a/o,s/o,l/o]:[a/o,s/o]:e.length?e[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.extentCentroid=function(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null},t.polygonCentroid=function(e){return e?n(e.rings,e.hasZ):null},t.ringsCentroid=n,t.lineCentroid=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.altText=null,r.caption="",r.title="",r.type=null,r}return r.__extends(t,e),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"altText",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"caption",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),r.__decorate([i.property({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.popup.content.mixins.MediaInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(865)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.fields=[],r.normalizeField=null,r.series=[],r.tooltipField=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({fields:i.clone(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})},r.__decorate([o.property({type:[String],json:{write:!0}})],t.prototype,"fields",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"normalizeField",void 0),r.__decorate([o.property({type:[a],json:{read:!1}})],t.prototype,"series",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"tooltipField",void 0),n=r.__decorate([o.subclass("esri.popup.content.support.ChartMediaInfoValue")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.tooltip=null,r.x=null,r.y=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({tooltip:this.tooltip,x:this.x,y:this.y})},r.__decorate([i.property()],t.prototype,"tooltip",void 0),r.__decorate([i.property()],t.prototype,"x",void 0),r.__decorate([i.property()],t.prototype,"y",void 0),n=r.__decorate([i.subclass("esri.popup.content.support.ChartMediaInfoValueSeries")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(153),r(151),r(191),r(273),r(428),r(773)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.data=null,r.portal=null,r.styleUrl="",r.type="cim",r}var l;return r.__extends(t,e),l=t,t.prototype.readData=function(e,t){return t},t.prototype.writeData=function(e,t){if(e)for(var r in e)t[r]=e[r]},t.prototype.readStyleUrl=function(e,t){return t.symbolUrl?t.symbolUrl:e},t.prototype.writeStyleUrl=function(e,t){e&&(t.symbolUrl=e)},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,c.fetchSymbol(this)];case 1:return r.sent(),"CIMSymbolReference"!==this.data.type?[3,3]:(n=this.data,(o=n.primitiveOverrides)?(s=o.map((function(r){var n=r.valueExpressionInfo;return a.collectArcadeFieldNames(e,t,n.expression)})),[4,i.all(s)]):[3,3]);case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.clone=function(){return new l({color:this.color.clone(),data:n.clone(this.data),portal:this.portal,styleName:this.styleName,styleUrl:this.styleUrl})},t.prototype.hash=function(){return this.color.hash()+"."+this.data+"."+this.portal+"."+this.styleName+"."+this.styleUrl},r.__decorate([o.property({json:{write:!1}})],t.prototype,"color",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"data",void 0),r.__decorate([o.reader("data",["symbol"])],t.prototype,"readData",null),r.__decorate([o.writer("data")],t.prototype,"writeData",null),r.__decorate([o.property({type:s,json:{write:!1}})],t.prototype,"portal",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"styleName",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"styleUrl",void 0),r.__decorate([o.reader("styleUrl",["styleUrl","symbolUrl"])],t.prototype,"readStyleUrl",null),r.__decorate([o.writer("styleUrl")],t.prototype,"writeStyleUrl",null),r.__decorate([o.enumeration({CIMSymbolReference:"cim"})],t.prototype,"type",void 0),l=r.__decorate([o.subclass("esri.symbols.CIMSymbol")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.nextQueryParams=null,r.queryParams=null,r.results=null,r.total=null,r}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"nextQueryParams",void 0),r.__decorate([i.property()],t.prototype,"queryParams",void 0),r.__decorate([i.property()],t.prototype,"results",void 0),r.__decorate([i.property()],t.prototype,"total",void 0),r.__decorate([i.subclass("esri.portal.PortalQueryResult")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.created=null,r.id=null,r.portal=null,r.title=null,r.username=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"url",{get:function(){var e=this.get("portal.restUrl");return e?e+"/content/users/"+this.username+"/"+this.id:null},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){throw new n("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")},r.__decorate([o.property({type:Date})],t.prototype,"created",void 0),r.__decorate([o.property()],t.prototype,"id",void 0),r.__decorate([o.property()],t.prototype,"portal",void 0),r.__decorate([o.property()],t.prototype,"title",void 0),r.__decorate([o.property({dependsOn:["portal.restUrl"],readOnly:!0})],t.prototype,"url",null),r.__decorate([o.property()],t.prototype,"username",void 0),r.__decorate([o.subclass("esri.portal.PortalFolder")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(156),r(153),r(171),r(229),r(246),r(870),r(1116),r(626),r(408)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=i.getLogger("esri.symbols.cim.cimAnalyzer");function f(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function v(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function m(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function y(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function g(e,t,r,n){var i;e[t]?i=e[t]:(i={},e[t]=i),i[r]=n}function _(e){var t=e.markerPlacement;return t&&t.angleToLine?1:0}function b(e,t,r,n,i){var o=e.primitiveName,a=p.fromCIMColor(e.color),l=s.numericHash(JSON.stringify(e)).toString();i.push({type:"fill",templateHash:l,materialHash:0===r.length?l:function(){return l},cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:j(o,t,"Color",n,a,L),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function x(e,t,r,n,i){var o=e.primitiveName,a=e.tintColor?p.fromCIMColor(e.tintColor):{r:255,g:255,b:255,a:1},l=s.numericHash(JSON.stringify(e)).toString(),c=s.numericHash(""+e.url+JSON.stringify(e.colorSubstitutions)).toString();i.push({type:"fill",templateHash:l,materialHash:0===r.length?c:function(){return c},cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:j(o,t,"TintColor",n,a,L),height:j(o,t,"Height",n,e.height),scaleX:j(o,t,"ScaleX",n,e.scaleX),angle:j(o,t,"Rotation",n,e.rotation),offsetX:j(o,t,"OffsetX",n,e.offsetX),offsetY:j(o,t,"OffsetY",n,e.offsetY)})}function w(e,t,r,n,i){var o=["Rotation","OffsetX","OffsetY"],a=r.filter((function(t){return t.primitiveName!==e.primitiveName&&-1===o.indexOf(t.propertyName)})),l=e.primitiveName,c=s.numericHash(JSON.stringify(e)).toString(),u=s.numericHash(""+e.separation+JSON.stringify(e.lineSymbol)).toString();i.push({type:"fill",templateHash:c,materialHash:0===r.length?u:V(u,t,a,n),cim:e,materialOverrides:a,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:j(l,t,"Separation",n,e.separation),scaleX:1,angle:j(l,t,"Rotation",n,e.rotation),offsetX:j(l,t,"OffsetX",n,e.offsetX),offsetY:j(l,t,"OffsetY",n,e.offsetY)})}function S(e,t,r,n,i){var o=s.numericHash(JSON.stringify(e)).toString();i.push({type:"fill",templateHash:o,materialHash:0===r.length?o:V(o,t,r,n),cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function P(e,t,r,n,i,o,a){var l=s.numericHash(JSON.stringify(e)).toString(),c=e.primitiveName,u=p.fromCIMColor(e.color),d=void 0!==e.width?e.width:4,h=f(e.capStyle),m=v(e.joinStyle),y=e.miterLimit;i.push({type:"line",templateHash:l,materialHash:0===r.length?l:function(){return l},cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:j(c,t,"Color",n,u,L),width:j(c,t,"Width",n,d),cap:j(c,t,"CapStyle",n,h),join:j(c,t,"JoinStyle",n,m),miterLimit:j(c,t,"MiterLimit",n,y),referenceWidth:a,zOrder:D(e.name),isDashed:!1})}function T(e,t,r,n,i,o,a){var l=s.numericHash(""+e.url+JSON.stringify(e.colorSubstitutions)).toString(),c=e.primitiveName,u=p.fromCIMColor(e.tintColor),d=void 0!==e.width?e.width:4,h=f(e.capStyle),m=v(e.joinStyle),y=e.miterLimit,g=s.numericHash(JSON.stringify(e)).toString();i.push({type:"line",templateHash:g,materialHash:0===r.length?l:function(){return l},cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:j(c,t,"TintColor",n,u,L),width:j(c,t,"Width",n,d),cap:j(c,t,"CapStyle",n,h),join:j(c,t,"JoinStyle",n,m),miterLimit:j(c,t,"MiterLimit",n,y),referenceWidth:a,zOrder:D(e.name),isDashed:!1})}function O(e,t,r,n,i,o,a){var l=e.primitiveName,c=void 0!==e.width?e.width:4,u=f(e.capStyle),p=v(e.joinStyle),d=e.miterLimit,h=s.numericHash(JSON.stringify(e)).toString();i.push({type:"line",templateHash:h,materialHash:0===r.length?h:V(h,t,r,n),cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:j(l,t,"Width",n,c),cap:j(l,t,"CapStyle",n,u),join:j(l,t,"JoinStyle",n,p),miterLimit:j(l,t,"MiterLimit",n,d),referenceWidth:a,zOrder:D(e.name),isDashed:!1})}function C(e,t,r,n,i){var o=e.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;var a=o,l=["Rotation","OffsetX","OffsetY"],c=r.filter((function(t){return t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName)})),u=s.numericHash(JSON.stringify(e)).toString();return i.push({type:"fill",templateHash:u,materialHash:0===r.length?u:V(u,t,c,n),cim:e,materialOverrides:c,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:j(a.primitiveName,t,"StepY",n,a.stepY),scaleX:1,angle:j(a.primitiveName,t,"GridAngle",n,a.gridAngle),offsetX:j(a.primitiveName,t,"OffsetX",n,a.offsetX),offsetY:j(a.primitiveName,t,"OffsetY",n,a.offsetY)}),!0}function M(e,t,r,n,i,o,a){for(var l=e.primitiveName,c=e.size,u=e.scaleX,d=e.rotation,h=e.offsetX,f=e.offsetY,v=p.fromCIMColor(e.tintColor),m=s.numericHash(""+e.url+JSON.stringify(e.colorSubstitutions)).toString(),y=!1,g="",_=0,b=r;_<b.length;_++){var x=b[_];x.primitiveName===l&&(void 0!==x.value?g+="-"+x.primitiveName+"-"+x.propertyName+"-"+JSON.stringify(x.value):x.valueExpressionInfo&&(y=!0))}i.push({type:"marker",templateHash:s.numericHash(JSON.stringify(e)+g).toString(),materialHash:y?function(){return m}:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:o,size:j(l,t,"Size",n,c),scaleX:j(l,t,"ScaleX",n,u),rotation:j(l,t,"Rotation",n,d),offsetX:j(l,t,"OffsetX",n,h),offsetY:j(l,t,"OffsetY",n,f),color:j(l,t,"TintColor",n,v,L),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:a,sizeRatio:1,markerPlacement:e.markerPlacement})}function A(e,t,r,n,i,o,a,s){var l=e.markerGraphics;if(l){var c=0;if(e.scaleSymbolsProportionally){var u=e.frame;u&&(c=u.ymax-u.ymin)}for(var p=0,d=l;p<d.length;p++){var h=d[p];if(h){var f=h.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":I(e,h,t,r,n,i,o,a,c,s);break;case"CIMTextSymbol":E(e,h,r,t,n,i,o,a,c)}}}}}function E(e,t,n,i,o,a,l,u,d){c.OverrideHelper.findApplicableOverrides(t,i,[]);var h=t.geometry;if("x"in h&&"y"in h){var f,v=t.symbol,g=(f=v).underline?"underline":f.strikethrough?"line-through":"none",_=function(e){var t="normal",r="normal";if(e){var n=e.toLowerCase();-1!==n.indexOf("italic")?t="italic":-1!==n.indexOf("oblique")&&(t="oblique"),-1!==n.indexOf("bold")?r="bold":-1!==n.indexOf("light")&&(r="lighter")}return{style:t,weight:r}}(v.fontStyleName);v.font=r.__assign({family:v.fontFamilyName,decoration:g},_);var b=e.frame,x=h.x-.5*(b.xmin+b.xmax),w=h.y-.5*(b.ymin+b.ymax),S=e.size/d,P=e.primitiveName,T=(v.height||0)*S,O=v.angle||0,C=((v.offsetX||0)+x)*S,M=((v.offsetY||0)+w)*S,A=p.fromCIMColor(c.CIMSymbolHelper.getFillColor(v)),E=p.fromCIMColor(c.CIMSymbolHelper.getStrokeColor(v)),I=c.CIMSymbolHelper.getStrokeWidth(v);I||(E=p.fromCIMColor(c.CIMSymbolHelper.getFillColor(v.haloSymbol)),I=v.haloSize*S);for(var R="",D=0,L=i;D<L.length;D++){var V=L[D];V.primitiveName===P&&void 0!==V.value&&(R+="-"+V.primitiveName+"-"+V.propertyName+"-"+JSON.stringify(V.value))}var F=Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits;a.push({type:"text",templateHash:s.numericHash(JSON.stringify(t)+F+R).toString(),materialHash:function(){return s.numericHash(JSON.stringify(v.font)).toString()},cim:v,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:l,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:v.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:j(P,n,"Size",o,T),angle:j(P,n,"Rotation",o,O),offsetX:j(P,n,"OffsetX",o,C),offsetY:j(P,n,"OffsetY",o,M),horizontalAlignment:m(v.horizontalAlignment),verticalAlignment:y(v.verticalAlignment),text:j(t.primitiveName,n,"TextString",o,t.textString,p._adjustTextCase,v.textCase),color:A,outlineColor:E,outlineSize:I,referenceSize:u,sizeRatio:1,markerPlacement:e.markerPlacement})}}function I(e,t,n,i,o,a,l,d,h,f){var v=t.symbol,m=t.geometry;if(m){var y=v.symbolLayers;if(y)if(f)R(e,t,i,n,o,a,l,d,h);else for(var g=y.length,_=function(){var f=y[g];if(!f||!1===f.enable)return"continue";switch(f.type){case"CIMSolidFill":case"CIMSolidStroke":var v=u.getExtent(m),_=u.getSDFMetrics(v,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),b=_[0],x=_[1],w=_[2],S="CIMSolidFill"===f.type,P={type:"sdf",geom:m,asFill:S},T=e.primitiveName,O=e.size,C=e.rotation||0,M=e.offsetX,A=e.offsetY,E=f.primitiveName,I=S?p.fromCIMColor(c.CIMSymbolHelper.getFillColor(f)):p.fromCIMColor(c.CIMSymbolHelper.getStrokeColor(f)),D=S?{r:0,g:0,b:0,a:0}:p.fromCIMColor(c.CIMSymbolHelper.getStrokeColor(f)),V=c.CIMSymbolHelper.getStrokeWidth(f);if(!S&&!V)break;for(var F=!1,N="",k=0,z=n;k<z.length;k++){var U=z[k];U.primitiveName!==E&&U.primitiveName!==T||(void 0!==U.value?N+="-"+U.primitiveName+"-"+U.propertyName+"-"+JSON.stringify(U.value):U.valueExpressionInfo&&(F=!0))}var B=JSON.stringify(r.__assign(r.__assign({},e),{markerGraphics:null})),G=s.numericHash(JSON.stringify(P)).toString(),H={type:"marker",templateHash:s.numericHash(JSON.stringify(t)+JSON.stringify(f)+B+N).toString(),materialHash:F?function(){return G}:G,cim:P,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:x,y:w},isAbsoluteAnchorPoint:!1,size:j(e.primitiveName,i,"Size",o,O),rotation:j(e.primitiveName,i,"Rotation",o,C),offsetX:j(e.primitiveName,i,"OffsetX",o,M),offsetY:j(e.primitiveName,i,"OffsetY",o,A),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:d,sizeRatio:b,color:j(E,i,"Color",o,I,L),outlineColor:j(E,i,"Color",o,D,L),outlineWidth:j(E,i,"Width",o,V),markerPlacement:e.markerPlacement};a.push(H);break;default:R(e,t,i,n,o,a,l,d,h)}};g--;)_()}}function R(e,t,r,n,i,o,l,u,p){var d,h=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t),f=["Rotation","OffsetX","OffsetY"];d=n.filter((function(t){return t.primitiveName!==e.primitiveName||-1===f.indexOf(t.propertyName)}));for(var v="",m=0,y=n;m<y.length;m++){var g=y[m];void 0!==g.value&&(v+="-"+g.primitiveName+"-"+g.propertyName+"-"+JSON.stringify(g.value))}var _=c.CIMSymbolHelper.getTextureAnchor(h),b=_[0],x=_[1],w=_[2],S=e.primitiveName,P=e.rotation||0,T=e.offsetX||0,O=e.offsetY||0,C=s.numericHash(JSON.stringify(h)+v).toString(),M={type:"marker",templateHash:C,materialHash:0===d.length?C:V(C,r,d,i),cim:h,materialOverrides:d,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:b,y:x},isAbsoluteAnchorPoint:!1,size:e.size,rotation:j(S,r,"Rotation",i,P),offsetX:j(S,r,"OffsetX",i,T),offsetY:j(S,r,"OffsetY",i,O),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:p,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:w/a.pt2px(e.size),markerPlacement:e.markerPlacement};o.push(M)}function D(e){if(e&&0===e.indexOf("Level_")){var t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function L(e){if(!e||0===e.length)return null;var t=new n(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function j(e,t,r,n,i,o,a){var s=t[e];if(s){var c=s[r];if("string"==typeof c||"number"==typeof c||c instanceof Array)return o?o.call(null,c,a):c;if(null!=c&&c instanceof l.default)return function(e,t,r){var s=d.callWithFeature(c,e,{$view:r},n.geometryType,t);return null!==s&&o&&(s=o.call(null,s,a)),null!==s?s:i}}return i}function V(e,t,r,n){for(var i=function(e){if(e.valueExpressionInfo){var r=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];r instanceof l.default&&(e.fn=function(e,t,i){return d.callWithFeature(r,e,{$view:i},n.geometryType,t)})}},o=0,a=r;o<a.length;o++)i(a[o]);return function(t,n,i){for(var o=0,a=r;o<a.length;o++){var l=a[o];l.fn&&(l.value=l.fn(t,n,i))}return s.numericHash(e+c.OverrideHelper.buildOverrideKey(r)).toString()}}t.analyzeCIMSymbol=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var a,s,u,p,d,f,v,m,y;return r.__generator(this,(function(r){switch(r.label){case 0:if(a=n||[],!e)return[2,a];if(p={},"CIMSymbolReference"!==e.type)return[3,3];if(s=e.symbol,!(u=e.primitiveOverrides))return[3,2];for(d=[],f=function(e){var r=e.valueExpressionInfo;if(r){var n=r.expression,i=l.createRendererExpression(n,t.spatialReference,t.fields).then((function(t){t&&g(p,e.primitiveName,e.propertyName,t)}));d.push(i)}else null!=e.value&&g(p,e.primitiveName,e.propertyName,e.value)},v=0,m=u;v<m.length;v++)y=m[v],f(y);return[4,o.all(d)];case 1:r.sent(),r.label=2;case 2:return[3,4];case 3:return h.error("Expect cim type to be 'CIMSymbolReference'"),[2,a];case 4:switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,r,n,i,o){if(e){var a,s=e.symbolLayers;if(s){var l=c.CIMSymbolHelper.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(a=1);for(var u=s.length;u--;){var p=s[u];if(p&&!1!==p.enable){var d=[];switch(c.OverrideHelper.findApplicableOverrides(p,t,d),p.type){case"CIMSolidFill":b(p,r,d,n,i);break;case"CIMPictureFill":x(p,r,d,n,i);break;case"CIMHatchFill":w(p,r,d,n,i);break;case"CIMGradientFill":S(p,r,d,n,i);break;case"CIMSolidStroke":P(p,r,d,n,i,"CIMPolygonSymbol"===e.type,l);break;case"CIMPictureStroke":T(p,r,d,n,i,"CIMPolygonSymbol"===e.type,l);break;case"CIMGradientStroke":O(p,r,d,n,i,"CIMPolygonSymbol"===e.type,l);break;case"CIMCharacterMarker":if(C(p,r,d,n,i))break;break;case"CIMPictureMarker":if(C(p,r,d,n,i))break;"CIMLineSymbol"===e.type&&(a=_(p)),M(p,r,d,n,i,a,l);break;case"CIMVectorMarker":if(C(p,r,d,n,i))break;"CIMLineSymbol"===e.type&&(a=_(p)),A(p,d,r,n,i,a,l,o);break;default:h.error("Cannot analyze CIM layer",p.type)}}}}}}(s,u,p,t,a,i)}return[2,a]}}))}))},t.analyzeCIMResource=function(e,t){if(!t||0===t.length)return e;var r=JSON.parse(JSON.stringify(e));return c.OverrideHelper.applyOverrides(r,t),r}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(156),r(774),r(1450),r(1115)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=Math.PI,c=l/2,u=i.getLogger("esri.symbols.cim.CIMSymbolHelper");function p(e,t){switch(t.type){case"CIMSymbolReference":var r={type:"point",x:0,y:0};e.drawSymbol(t.symbol,r);break;case"CIMPointSymbol":r={type:"point",x:0,y:0},e.drawSymbol(t,r);break;case"CIMTextSymbol":break;case"CIMVectorMarker":var n=new o.Placement;e.drawMarker(t,n)}return e.envelope()}var d=function(){function e(){}return e.getEnvelope=function(e){var t=new a.EnvDrawHelper;if(Array.isArray(e)){for(var r=void 0,n=0,i=e;n<i.length;n++){var o=i[n];r?r.union(p(t,o)):r=p(t,o)}return r}return p(t,e)},e.getTextureAnchor=function(e){var t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];var r=(t.x+.5*t.width)*(96/72),n=-(t.y+.5*t.height)*(96/72),i=t.width*(96/72)+2,o=t.height*(96/72)+2;return[r/i,n/o,o]},e.rasterize=function(e,t,r,n){void 0===n&&(n=!0);var i=r||this.getEnvelope(t);if(!i||i.width<=0||i.height<=0)return[null,0,0,0,0];var s=(i.x+.5*i.width)*(96/72),l=(i.y+.5*i.height)*(96/72);e.width=i.width*(96/72),e.height=i.height*(96/72),r||(e.width+=2,e.height+=2);var c=e.getContext("2d"),u=a.Transformation.createScale(96/72,-96/72);u.translate(.5*e.width-s,.5*e.height+l);var p=new a.CanvasDrawHelper(c,u);switch(t.type){case"CIMPointSymbol":p.drawSymbol(t,{type:"point",x:0,y:0});break;case"CIMVectorMarker":var d=new o.Placement;p.drawMarker(t,d)}var h=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(h.data);if(n)for(var v=void 0,m=0;m<f.length;m+=4)v=f[m+3]/255,f[m]=f[m]*v,f[m+1]=f[m+1]*v,f[m+2]=f[m+2]*v;return[f,e.width,e.height,-s/e.width,-l/e.height]},e.fromSimpleMarker=function(e){var t,r,n,i=e.style;if("circle"===i||"esriSMSCircle"===i){var o=Math.acos(.995),a=Math.ceil(l/o/4);0===a&&(a=1),o=c/a,a*=4;var s=[];s.push([50,0]);for(var u=1;u<a;u++)s.push([50*Math.cos(u*o),-50*Math.sin(u*o)]);s.push([50,0]),t={rings:[s]},r={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===i||"esriSMSCross"===i)t={rings:[[[p=0,50],[p,p],[50,p],[50,-p],[p,-p],[p,-50],[-p,-50],[-p,-p],[-50,-p],[-50,p],[-p,p],[-p,50],[p,50]]]},r={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===i||"esriSMSDiamond"===i)t={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},r={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===i||"esriSMSSquare"===i)t={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},r={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===i||"esriSMSX"===i){var p;t={rings:[[[0,p=0],[50-p,50],[50,50-p],[p,0],[50,p-50],[50-p,-50],[0,-p],[p-50,-50],[-50,p-50],[-p,0],[-50,50-p],[p-50,50],[0,p]]]},r={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("triangle"===i||"esriSMSTriangle"===i){var d=57.735026918962575,h=-d,f=2/3*100-100;t={rings:[[[h,f],[0,2/3*100],[d,f],[h,f]]]},r={xmin:h,ymin:f,xmax:d,ymax:2/3*100}}else"arrow"!==i&&"esriSMSArrow"!==i||(t={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-50,ymin:-50,xmax:50,ymax:50});if(t&&r){var v=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&v.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});var m={type:"CIMPolygonSymbol",symbolLayers:v};n={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t,symbol:m}]}]}}return n},e.fromCIMHatchFill=function(e){for(var t=void 0!==e.separation?e.separation:4,r=t/2,n=this._getLineSymbolPeriod(e.lineSymbol)||4;n<4;)n*=2;var i=n/2;return{type:"CIMVectorMarker",frame:{xmin:-i,xmax:i,ymin:-r,ymax:r},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-i,0],[i,0]]]},symbol:e.lineSymbol}],size:t}},e._getLineSymbolPeriod=function(e){if(e){var t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(var r=0,n=e.symbolLayers;r<n.length;r++){var i=n[r],o=this._getEffectsRepeat(i.effects);if(o)return o;if(i){var a=this._getPlacementRepeat(i.markerPlacement);if(a)return a}}}return 0},e._getEffectsRepeat=function(e){if(e)for(var t=0,r=e;t<r.length;t++){var n=r[t];if(n)switch(n.type){case"CIMGeometricEffectDashes":var i=n.dashTemplate;if(i&&i.length){for(var o=0,a=0,s=i;a<s.length;a++)o+=s[a];return 1&i.length&&(o*=2),o}break;case"CIMGeometricEffectWave":return n.period;default:u.error("unsupported geometric effect type "+n.type)}}return 0},e._getPlacementRepeat=function(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":var t=e.placementTemplate;if(t&&t.length){for(var r=0,n=0,i=t;n<i.length;n++)r+=i[n];return 1&t.length&&(r*=2),r}}return 0},e.fromCIMInsidePolygon=function(e){var t=e.markerPlacement,n=t.stepX/2,i=t.stepY/2,o={xmin:-n,xmax:n,ymin:-i,ymax:i},a=r.__assign({type:e.type},e);return a.markerPlacement=null,a.anchorPoint=null,{type:"CIMVectorMarker",frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[a]}}],size:t.stepY}},e.getFillColor=function(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(var r=0,n=t.symbolLayers;r<n.length;r++){var i=n[r],o=e.getFillColor(i);if(null!=o)return o}break;case"CIMTextSymbol":return e.getFillColor(t.symbol);case"CIMSolidFill":return t.color}},e.getStrokeColor=function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(var r=0,n=t.symbolLayers;r<n.length;r++){var i=n[r],o=e.getStrokeColor(i);if(void 0!==o)return o}break;case"CIMTextSymbol":return e.getStrokeColor(t.symbol);case"CIMSolidStroke":return t.color}},e.getStrokeWidth=function(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(var r=0,n=t.symbolLayers;r<n.length;r++){var i=n[r],o=e.getStrokeWidth(i);if(void 0!==o)return o}break;case"CIMTextSymbol":return e.getStrokeWidth(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}},e.getSize=function(t){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var r=0;if(t.symbolLayers)for(var n=0,i=t.symbolLayers;n<i.length;n++){var o=i[n],a=e.getSize(o);a>r&&(r=a)}return r;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return t.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return t.size}},e.getMarkerScaleRatio=function(e){if(e)switch(e.type){case"CIMVectorMarker":if(!1!==e.scaleSymbolsProportionally&&e.frame){var t=e.frame.ymax-e.frame.ymin;return e.size/t}}return 1},e}();t.CIMSymbolHelper=d;var h=function(){function e(){}return e.rasterizeSimpleFill=function(e,t){"solid"!==t&&"none"!==t&&"esriSFSSolid"!==t&&"esriSFSNull"!==t||console.error("Unexpected: style does not require rasterization"),e.width=8,e.height=8;var r=e.getContext("2d");r.strokeStyle="#FFFFFF",r.lineWidth=1,r.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(r.moveTo(0,0),r.lineTo(0,8)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(r.moveTo(0,0),r.lineTo(8,0)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(r.moveTo(0,0),r.lineTo(8,8)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(r.moveTo(8,0),r.lineTo(0,8)),r.stroke();for(var n,i=r.getImageData(0,0,e.width,e.height),o=new Uint8Array(i.data),a=0;a<o.length;a+=4)n=o[a+3]/255,o[a]=o[a]*n,o[a+1]=o[a+1]*n,o[a+2]=o[a+2]*n;return[o,e.width,e.height]},e.rasterizeSimpleLine=function(e,t){var r;switch(t){case"butt":r="Butt";break;case"square":r="Square";break;default:r="Round"}var n,i="Butt"===r;switch(e){case"dash":case"esriSLSDash":n=i?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":n=i?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":n=i?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":n=i?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":n=i?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":n=i?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":n=i?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":n=i?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":n=i?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":n=i?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":u.error("Unexpected: style does not require rasterization"),n=[0,0];break;default:u.error("Tried to rasterize SLS, but found an unexpected style: "+e+"!"),n=[0,0]}return this.rasterizeDash(n,r)},e.rasterizeDash=function(e,t){for(var r="Butt"===t,n="Square"===t,i=!r&&!n,o=0,a=0,l=e;a<l.length;a++)o+=l[a];for(var c=15*o,u=31*c,p=new Float32Array(u),d=i?225:15,h=0;h<u;++h)p[h]=d;for(var f=0,v=0,m=!0,y=0,g=e;y<g.length;y++){f=v,v+=15*g[y];for(var _=f;_<v;){for(var b=0;b<31;){h=b*c+_;var x=i?(b-15)*(b-15):Math.abs(b-15);p[h]=m?r?Math.max(Math.max(f+7.5-_,x),Math.max(_-v+7.5,x)):x:i?Math.min((_-f)*(_-f)+x,(_-v)*(_-v)+x):n?Math.min(Math.max(_-f,x),Math.max(v-_,x)):Math.min(Math.max(_-f+7.5,x),Math.max(v+7.5-_,x)),b++}_++}m=!m}var w=p.length,S=new Uint8Array(4*w);for(h=0;h<w;++h){var P=(i?Math.sqrt(p[h]):p[h])/15;s.packFloatRGBA(P,S,4*h)}return[S,c,31]},e}();t.SymbolHelper=h;var f=function(){function e(){}return e.findApplicableOverrides=function(t,r,n){if(r){if(t.primitiveName){for(var i=!1,o=0,a=n;o<a.length;o++)if((c=a[o]).primitiveName===t.primitiveName){i=!0;break}if(!i)for(var s=0,l=r;s<l.length;s++){var c;(c=l[s]).primitiveName===t.primitiveName&&n.push(c)}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects)for(var u=0,p=t.effects;u<p.length;u++){var d=p[u];e.findApplicableOverrides(d,r,n)}if(t.symbolLayers)for(var h=0,f=t.symbolLayers;h<f.length;h++){var v=f[h];e.findApplicableOverrides(v,r,n)}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(t.effects)for(var m=0,y=t.effects;m<y.length;m++)d=y[m],e.findApplicableOverrides(d,r,n);if(t.markerPlacement&&e.findApplicableOverrides(t.markerPlacement,r,n),"CIMVectorMarker"===t.type){if(t.markerGraphics)for(var g=0,_=t.markerGraphics;g<_.length;g++){var b=_[g];e.findApplicableOverrides(b,r,n),e.findApplicableOverrides(b.symbol,r,n)}}else"CIMCharacterMarker"===t.type?e.findApplicableOverrides(t.symbol,r,n):"CIMHatchFill"===t.type&&e.findApplicableOverrides(t.lineSymbol,r,n)}}},e.applyOverrides=function(t,r,n,i){if(r){var o;if(t.primitiveName)for(var a=0,s=r;a<s.length;a++){var l=s[a];if(l.primitiveName===t.primitiveName){var c=(o=l.propertyName)?o.charAt(0).toLowerCase()+o.substr(1):o;if(i&&i.push({cim:t,nocapPropertyName:c,value:t[c]}),l.expression&&(l.value=e.toValue(l.propertyName,l.expression)),n){for(var u=!1,p=0,d=n;p<d.length;p++)d[p].primitiveName===t.primitiveName&&(u=!0);u||n.push(l)}t[c]=l.value}}switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.effects)for(var h=0,f=t.effects;h<f.length;h++){var v=f[h];e.applyOverrides(v,r,n,i)}if(t.symbolLayers)for(var m=0,y=t.symbolLayers;m<y.length;m++){var g=y[m];e.applyOverrides(g,r,n,i)}break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(t.effects)for(var _=0,b=t.effects;_<b.length;_++)v=b[_],e.applyOverrides(v,r,n,i);if("CIMVectorMarker"===t.type&&t.markerGraphics)for(var x=0,w=t.markerGraphics;x<w.length;x++){var S=w[x];e.applyOverrides(S,r,n,i),e.applyOverrides(S.symbol,r,n,i)}}}},e.restoreOverrides=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];n.cim[n.nocapPropertyName]=n.value}},e.buildOverrideKey=function(e){for(var t="",r=0,n=e;r<n.length;r++){var i=n[r];void 0!==i.value&&(t+=""+i.primitiveName+i.propertyName+JSON.stringify(i.value))}return t},e.toValue=function(e,t){if("DashTemplate"===e)return t.split(" ").map((function(e){return Number(e)}));if("Color"===e){var r=new n(t).toRgba();return r[3]*=255,r}return t},e}();t.OverrideHelper=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1451),r(1452),r(1453),r(1454),r(1455),r(1456),r(1457),r(1458),r(1459),r(1460),r(1461),r(1462),r(1463),r(1464),r(1466),r(1467),r(1468),r(1469),r(1470)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectOperator=function(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return r.EffectAddControlPoints.local();case"CIMGeometricEffectArrow":return n.EffectArrow.local();case"CIMGeometricEffectBuffer":return i.EffectBuffer.local();case"CIMGeometricEffectCut":return o.EffectCut.local();case"CIMGeometricEffectDashes":return a.EffectDashes.local();case"CIMGeometricEffectDonut":return s.EffectDonut.local();case"CIMGeometricEffectJog":return l.EffectJog.local();case"CIMGeometricEffectMove":return c.EffectMove.local();case"CIMGeometricEffectOffset":return u.EffectOffset.local();case"CIMGeometricEffectReverse":return p.EffectReverse.local();case"CIMGeometricEffectRotate":return d.EffectRotate.local();case"CIMGeometricEffectScale":return h.EffectScale.local();case"CIMGeometricEffectWave":return f.EffectWave.local()}return null},t.getPlacementOperator=function(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return v.PlacementAlongLineSameSize.local();case"CIMMarkerPlacementAtExtremities":return m.PlacementAtExtremities.local();case"CIMMarkerPlacementAtRatioPositions":return y.PlacementAtRatioPositions.local();case"CIMMarkerPlacementOnLine":return g.PlacementOnLine.local();case"CIMMarkerPlacementOnVertices":return _.PlacementOnVertices.local();case"CIMMarkerPlacementPolygonCenter":return b.PlacementPolygonCenter.local()}return null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(151),r(409),r(873),r(482)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="extrude",r.size=void 0,r.material=null,r.castShadows=!0,r.edges=null,r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:n.isSome(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})},r.__decorate([i.enumeration({Extrude:"extrude"})],t.prototype,"type",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"size",void 0),r.__decorate([i.property({type:s.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([i.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t.prototype,"castShadows",void 0),r.__decorate([i.property(a.symbol3dEdgesProperty)],t.prototype,"edges",void 0),o=r.__decorate([i.subclass("esri.symbols.ExtrudeSymbol3DLayer")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(874),r(1471),r(1472)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){if(!e)return e;switch(e.type){case"solid":return(o=new i).read(e,r),o;case"sketch":var o;return(o=new n).read(e,r),o}}Object.defineProperty(t,"__esModule",{value:!0}),t.read=o,t.symbol3dEdgesProperty={types:{key:"type",base:r,typeMap:{solid:i,sketch:n}},json:{read:o,write:!0}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(171),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=new n([0,0,0,1]),r.extensionLength=0,r.size=a.px2pt(1),r}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e){if(e&&e.type){var t=r.__assign({},e);return delete t.type,t}return e},t.prototype.clone=function(){},t.prototype.cloneProperties=function(){return{color:o.clone(this.color),size:this.size,extensionLength:this.extensionLength}},r.__decorate([s.property({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],t.prototype,"type",void 0),r.__decorate([s.property(l.colorAndTransparencyProperty)],t.prototype,"color",void 0),r.__decorate([s.property(r.__assign(r.__assign({},l.screenSizeProperty),{json:{write:{overridePolicy:function(e){return{enabled:!!e}}}}}))],t.prototype,"extensionLength",void 0),r.__decorate([s.property(l.screenSizeProperty)],t.prototype,"size",void 0),r.__decorate([s.subclass("esri.symbols.edges.Edges3D")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(151),r(429),r(428)],void 0===(i=function(e,t,r,n,i,o,a){var s=new n.default({esriSFS:"simple-fill",esriPFS:"picture-fill"});return function(e){function t(t){var r=e.call(this,t)||this;return r.outline=null,r.type=null,r}return r.__extends(t,e),t.prototype.hash=function(){return this.type+"."+(this.outline&&this.outline.hash())},r.__decorate([i.property({type:o,json:{default:null,write:!0}})],t.prototype,"outline",void 0),r.__decorate([i.property({type:s.apiValues,readOnly:!0,json:{type:s.jsonValues}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.symbols.FillSymbol")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.white=new r("white"),t.black=new r("black"),t.transparentWhite=new r([255,255,255,0]),t.isBlack=function(e){return 0===e.r&&0===e.g&&0===e.b}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(171),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.decoration="none",r.family="sans-serif",r.size=9,r.style="normal",r.weight="normal",r}var n;return r.__extends(t,e),n=t,t.prototype.castSize=function(e){return i.toPt(e)},t.prototype.clone=function(){return new n({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})},t.prototype.hash=function(){return this.decoration+"."+this.family+"."+this.size+"."+this.style+"."+this.weight},r.__decorate([o.property({type:["underline","line-through","none"],json:{default:"none",write:!0}})],t.prototype,"decoration",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"family",void 0),r.__decorate([o.property({type:Number,json:{write:{overridePolicy:function(e,t,r){return{enabled:!r||!r.textSymbol3D}}}}})],t.prototype,"size",void 0),r.__decorate([o.cast("size")],t.prototype,"castSize",null),r.__decorate([o.property({type:["normal","italic","oblique"],json:{default:"normal",write:!0}})],t.prototype,"style",void 0),r.__decorate([o.property({type:["normal","bold","bolder","lighter"],json:{default:"normal",write:!0}})],t.prototype,"weight",void 0),n=r.__decorate([o.subclass("esri.symbols.Font")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(151),r(409),r(482)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.material=null,r.castShadows=!0,r.type="path",r.profile="circle",r.join="miter",r.cap="butt",r.width=void 0,r.height=void 0,r.anchor="center",r.profileRotation="all",r}var o;return r.__extends(t,e),o=t,Object.defineProperty(t.prototype,"size",{get:function(){return this.width&&this.height?this.width===this.height?this.width:void 0:this.width?this.width:this.height?this.height:void 0},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),t.prototype.readSize=function(e,t){return t.height||t.width?e:t.size},t.prototype.clone=function(){return new o({enabled:this.enabled,material:n.isSome(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})},r.__decorate([i.property({type:a.default,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([i.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t.prototype,"castShadows",void 0),r.__decorate([i.enumeration({Path:"path"})],t.prototype,"type",void 0),r.__decorate([i.property({type:Number})],t.prototype,"size",null),r.__decorate([i.reader("size")],t.prototype,"readSize",null),r.__decorate([i.property({type:["circle","quad"],json:{write:!0,default:"circle"}})],t.prototype,"profile",void 0),r.__decorate([i.property({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],t.prototype,"join",void 0),r.__decorate([i.property({type:["none","butt","square","round"],json:{write:!0,default:"butt"}})],t.prototype,"cap",void 0),r.__decorate([i.property({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],t.prototype,"width",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"height",void 0),r.__decorate([i.property({type:["center","bottom","top"],json:{write:!0,default:"center"}})],t.prototype,"anchor",void 0),r.__decorate([i.property({type:["heading","all"],json:{write:!0,default:"all"}})],t.prototype,"profileRotation",void 0),o=r.__decorate([i.subclass("esri.symbols.PathSymbol3DLayer")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(151),r(179),r(409)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.color=c.clone(),r.type="water",r.waterbodySize="medium",r.waveDirection=null,r.waveStrength="moderate",r}var s;return r.__extends(t,e),s=t,t.prototype.clone=function(){return new s({color:i.clone(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})},r.__decorate([o.property({type:n,nonNullable:!0,json:{type:[a.Integer],write:function(e,t,r){return t[r]=e.toArray(1)},default:function(){return c.clone()},defaultEquals:function(e){return e.toCss(!0)===c.toCss(!0)}}})],t.prototype,"color",void 0),r.__decorate([o.enumeration({Water:"water"})],t.prototype,"type",void 0),r.__decorate([o.property({type:["small","medium","large"],json:{write:!0,default:"medium"}})],t.prototype,"waterbodySize",void 0),r.__decorate([o.property({type:Number,json:{write:!0,default:null}})],t.prototype,"waveDirection",void 0),r.__decorate([o.property({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],t.prototype,"waveStrength",void 0),s=r.__decorate([o.subclass("esri.symbols.WaterSymbol3DLayer")],t)}(s),c=new n([0,119,190]);return l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({url:this.url})},r.__decorate([i.property({type:String})],t.prototype,"url",void 0),n=r.__decorate([i.subclass("esri.symbols.support.Thumbnail")],t)}(n);t.Thumbnail=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(152),r(171),r(151),r(1121),r(1122),r(386)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="line",r.color=new n([0,0,0,1]),r.size=a.px2pt(1),r.border=null,r}var l;return r.__extends(t,e),l=t,Object.defineProperty(t.prototype,"visible",{get:function(){return this.size>0&&o.isSome(this.color)&&this.color.a>0},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new l({color:i.clone(this.color),size:this.size,border:i.clone(this.border)})},r.__decorate([s.property({type:["line"]})],t.prototype,"type",void 0),r.__decorate([s.property(u.colorAndTransparencyProperty)],t.prototype,"color",void 0),r.__decorate([s.property(u.screenSizeProperty)],t.prototype,"size",void 0),r.__decorate([s.property({type:c.default,json:{write:!0}})],t.prototype,"border",void 0),r.__decorate([s.property({dependsOn:["size","color"],readOnly:!0})],t.prototype,"visible",null),l=r.__decorate([s.subclass("esri.symbols.callouts.LineCallout3D")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.screenLength=0,t.minWorldLength=0,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})},r.__decorate([i.property(o.screenSizeProperty)],t.prototype,"screenLength",void 0),r.__decorate([i.property({type:Number,json:{write:!0,default:0}})],t.prototype,"minWorldLength",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maxWorldLength",void 0),n=r.__decorate([i.subclass("esri.symbols.support.Symbol3DVerticalOffset")],t)}(n.JSONSupport);t.Symbol3DVerticalOffset=a,t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(118),r(151),r(778),r(878),r(431)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=n.ofType({base:null,key:"type",typeMap:{line:a,path:s}}),u=n.ofType({base:null,key:"type",typeMap:{line:a,path:s}});return function(e){function t(t){var r=e.call(this,t)||this;return r.symbolLayers=new c,r.type="line-3d",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})},t.fromSimpleLineSymbol=function(e){return new n({symbolLayers:[a.fromSimpleLineSymbol(e)]})},r.__decorate([o.property({type:c,json:{type:u}})],t.prototype,"symbolLayers",void 0),r.__decorate([o.enumeration({LineSymbol3D:"line-3d"})],t.prototype,"type",void 0),n=r.__decorate([o.subclass("esri.symbols.LineSymbol3D")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(171),r(151),r(428)],void 0===(i=function(e,t,r,n,i,o,a){var s=new n.default({esriSMS:"simple-marker",esriPMS:"picture-marker"});return function(e){function t(t){var r=e.call(this,t)||this;return r.angle=0,r.type=null,r.xoffset=0,r.yoffset=0,r.size=9,r}return r.__extends(t,e),t.prototype.hash=function(){return this.type+"."+this.angle+"."+this.size+"."+this.xoffset+"."+this.yoffset},r.__decorate([o.property({type:Number,json:{read:function(e){return e&&-1*e},write:function(e,t){return t.angle=e&&-1*e}}})],t.prototype,"angle",void 0),r.__decorate([o.property({type:s.apiValues,readOnly:!0,json:{type:s.jsonValues}})],t.prototype,"type",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"xoffset",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"yoffset",void 0),r.__decorate([o.property({type:Number,cast:function(e){return"auto"===e?e:i.toPt(e)},json:{write:!0}})],t.prototype,"size",void 0),r.__decorate([o.subclass("esri.symbols.MarkerSymbol")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(118),r(151),r(430),r(431)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=n.ofType({base:null,key:"type",typeMap:{fill:a}});return function(e){function t(t){var r=e.call(this,t)||this;return r.symbolLayers=new l,r.type="mesh-3d",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})},r.__decorate([o.property({type:l})],t.prototype,"symbolLayers",void 0),r.__decorate([o.enumeration({MeshSymbol3D:"mesh-3d"})],t.prototype,"type",void 0),n=r.__decorate([o.subclass("esri.symbols.MeshSymbol3D")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(171),r(151),r(877),r(428)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.backgroundColor=null,n.borderLineColor=null,n.borderLineSize=null,n.font=new s,n.horizontalAlignment="center",n.kerning=!0,n.haloColor=null,n.haloSize=null,n.rightToLeft=null,n.rotated=!1,n.text="",n.type="text",n.verticalAlignment=null,n.xoffset=0,n.yoffset=0,n.angle=0,n.width=null,n.lineWidth=192,n.lineHeight=1,n}var l;return r.__extends(t,e),l=t,t.prototype.normalizeCtorArgs=function(e,t,r){if(e&&"string"!=typeof e)return e;var n={};return e&&(n.text=e),t&&(n.font=t),r&&(n.color=r),n},t.prototype.writeLineWidth=function(e,t,r,n){n&&"string"!=typeof n?n.origin:t[r]=e},t.prototype.castLineWidth=function(e){return o.toPt(e)},t.prototype.writeLineHeight=function(e,t,r,n){n&&"string"!=typeof n?n.origin:t[r]=e},t.prototype.clone=function(){return new l({angle:this.angle,backgroundColor:i.clone(this.backgroundColor),borderLineColor:i.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:i.clone(this.color),font:this.font&&this.font.clone(),haloColor:i.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})},t.prototype.hash=function(){return(this.backgroundColor&&this.backgroundColor.hash())+"."+this.borderLineColor+"."+this.borderLineSize+"."+this.color.hash()+"."+(this.font&&this.font.hash())+"."+(this.haloColor&&this.haloColor.hash())+"."+this.haloSize+"."+this.horizontalAlignment+"."+this.kerning+"."+this.rightToLeft+"."+this.rotated+"."+this.text+"."+this.verticalAlignment+"."+this.width+"."+this.xoffset+"."+this.yoffset+"."+this.lineHeight+"."+this.lineWidth+"."+this.angle},r.__decorate([a.property({type:n,json:{write:!0}})],t.prototype,"backgroundColor",void 0),r.__decorate([a.property({type:n,json:{write:!0}})],t.prototype,"borderLineColor",void 0),r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"borderLineSize",void 0),r.__decorate([a.property({type:s,json:{write:!0}})],t.prototype,"font",void 0),r.__decorate([a.property({type:["left","right","center","justify"],json:{write:!0}})],t.prototype,"horizontalAlignment",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"kerning",void 0),r.__decorate([a.property({type:n,json:{write:!0}})],t.prototype,"haloColor",void 0),r.__decorate([a.property({type:Number,cast:o.toPt,json:{write:!0}})],t.prototype,"haloSize",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"rightToLeft",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"rotated",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),r.__decorate([a.property({type:String,readOnly:!0})],t.prototype,"type",void 0),r.__decorate([a.property({type:["baseline","top","middle","bottom"],json:{write:!0}})],t.prototype,"verticalAlignment",void 0),r.__decorate([a.property({type:Number,cast:o.toPt,json:{write:!0}})],t.prototype,"xoffset",void 0),r.__decorate([a.property({type:Number,cast:o.toPt,json:{write:!0}})],t.prototype,"yoffset",void 0),r.__decorate([a.property({type:Number,json:{read:function(e){return e&&-1*e},write:function(e,t){return t.angle=e&&-1*e}}})],t.prototype,"angle",void 0),r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([a.property({type:Number})],t.prototype,"lineWidth",void 0),r.__decorate([a.writer("lineWidth")],t.prototype,"writeLineWidth",null),r.__decorate([a.cast("lineWidth")],t.prototype,"castLineWidth",null),r.__decorate([a.property({type:Number})],t.prototype,"lineHeight",void 0),r.__decorate([a.writer("lineHeight")],t.prototype,"writeLineHeight",null),l=r.__decorate([a.subclass("esri.symbols.TextSymbol")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(239),r(154)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.to3D=function(e,t,i,o){if(void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===o&&(o=!0),!e)return{symbol:null};var a;if(r.isSymbol3D(e)||e instanceof r.WebStyleSymbol)a=e.clone();else if("cim"===e.type)a=r.PointSymbol3D.fromCIMSymbol(e);else if(e instanceof r.SimpleLineSymbol)a=r.LineSymbol3D.fromSimpleLineSymbol(e);else if(e instanceof r.SimpleMarkerSymbol)a=r.PointSymbol3D.fromSimpleMarkerSymbol(e);else if(e instanceof r.PictureMarkerSymbol)a=r.PointSymbol3D.fromPictureMarkerSymbol(e);else if(e instanceof r.SimpleFillSymbol)a=r.PolygonSymbol3D.fromSimpleFillSymbol(e);else{if(!(e instanceof r.TextSymbol))return{error:new n("symbol-conversion:unsupported-2d-symbol","2D symbol of type '"+(e.type||e.declaredClass)+"' is unsupported in 3D",{symbol:e})};a=o?r.LabelSymbol3D.fromTextSymbol(e):r.PointSymbol3D.fromTextSymbol(e)}if(t&&(a.id=e.id),i&&r.isSymbol3D(a))for(var s=0;s<a.symbolLayers.length;++s)a.symbolLayers.getItemAt(s)._ignoreDrivers=!0;return{symbol:a}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r}return r.__extends(t,e),r.__decorate([i.property({readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.tasks.support.ColorRamp")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(632),r(1131)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="color",r.normalizationField=null,r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"cache",{get:function(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stops",{set:function(e){e&&Array.isArray(e)&&(e=e.filter((function(e){return!!e}))).sort((function(e,t){return e.value-t.value})),this._set("stops",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((function(e){return e.clone()})),legendOptions:this.legendOptions&&this.legendOptions.clone()})},t.prototype.getAttributeHash=function(){return e.prototype.getAttributeHash.call(this)+"-"+this.normalizationField},t.prototype._interpolateData=function(){return this.stops&&this.stops.map((function(e){return e.value||0}))},r.__decorate([n.property({readOnly:!0,dependsOn:["valueExpression","stops"]})],t.prototype,"cache",null),r.__decorate([n.property({type:["color"],json:{type:["colorInfo"]}})],t.prototype,"type",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"normalizationField",void 0),r.__decorate([n.property({type:[o],json:{write:!0}})],t.prototype,"stops",null),i=r.__decorate([n.subclass("esri.renderers.visualVariables.ColorVariable")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(483)],void 0===(i=function(e,t,r){return function(){function e(e,t){this._storage=new r.MemCacheStorage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t,r){this._storage.put(e,t,r,1)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(151),r(191),r(524),r(631),r(1483),r(1484),r(629),r(429)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){return function(e){function t(t){var r=e.call(this,t)||this;return r.attributes=null,r.backgroundColor=new n([0,0,0,0]),r.blendDots=!0,r.dotBlendingEnabled=!0,r.dotShape="square",r.dotSize=1,r.legendOptions=null,r.outline=new d,r.dotValue=null,r.referenceDotValue=null,r.referenceScale=null,r.seed=1,r.type="dot-density",r}var s;return r.__extends(t,e),s=t,t.prototype.calculateDotValue=function(e){if(null==this.referenceScale)return this.dotValue;var t=e/this.referenceScale*this.dotValue;return t<1?1:t},t.prototype.getSymbol=function(){return new p({outline:this.outline})},t.prototype.getSymbolAsync=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,this.getSymbol()]}))}))},t.prototype.getSymbols=function(){return[this.getSymbol()]},t.prototype.getAttributeHash=function(){return this.attributes&&this.attributes.reduce((function(e,t){return e+t.getAttributeHash()}),"")},t.prototype.getMeshHash=function(){return JSON.stringify(this.outline)},t.prototype.clone=function(){return new s({attributes:i.clone(this.attributes),backgroundColor:i.clone(this.backgroundColor),dotBlendingEnabled:i.clone(this.dotBlendingEnabled),dotShape:i.clone(this.dotShape),dotSize:i.clone(this.dotSize),dotValue:i.clone(this.dotValue),legendOptions:i.clone(this.legendOptions),outline:i.clone(this.outline),referenceScale:i.clone(this.referenceScale),visualVariables:i.clone(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},t.prototype.getControllerHash=function(){return this.attributes.map((function(e){return e.field||e.valueExpression||""}))+"-"+(this.outline&&JSON.stringify(this.outline.toJSON())||"")},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.collectVVRequiredFields(e,t)];case 1:r.sent(),n=0,i=this.attributes,r.label=2;case 2:return n<i.length?(o=i[n]).valueExpression?[4,a.collectArcadeFieldNames(e,t,o.valueExpression)]:[3,4]:[3,6];case 3:r.sent(),r.label=4;case 4:o.field&&e.add(o.field),r.label=5;case 5:return n++,[3,2];case 6:return[2]}}))}))},r.__decorate([o.property({type:[c],json:{write:!0}})],t.prototype,"attributes",void 0),r.__decorate([o.property({type:n,json:{write:!0}})],t.prototype,"backgroundColor",void 0),r.__decorate([o.property({type:Boolean}),o.aliasOf("dotBlendingEnabled")],t.prototype,"blendDots",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"dotBlendingEnabled",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"dotShape",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"dotSize",void 0),r.__decorate([o.property({type:u,json:{write:!0}})],t.prototype,"legendOptions",void 0),r.__decorate([o.property({type:d,json:{default:null,write:!0}})],t.prototype,"outline",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"dotValue",void 0),r.__decorate([o.property({type:Number}),o.aliasOf("dotValue")],t.prototype,"referenceDotValue",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"referenceScale",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"seed",void 0),r.__decorate([o.enumeration({dotDensity:"dot-density"})],t.prototype,"type",void 0),s=r.__decorate([o.subclass("esri.renderers.DotDensityRenderer")],t)}(l.VisualVariablesMixin(s))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(118),r(153),r(151),r(524),r(631),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.description=null,r.label=null,r.symbol=null,r.type="simple",r}var s;return r.__extends(t,e),s=t,t.prototype.writeSymbolWebScene=function(e,t,r,n){c.writeTarget(e,t,r,n)},t.prototype.writeSymbol=function(e,t,r,n){c.writeTarget(e,t,r,n)},t.prototype.readSymbol=function(e,t,r){return c.read(e,t,r)},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,o.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])];case 1:return r.sent(),[2]}}))}))},t.prototype.collectSymbolFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,o.all(this.getSymbols().map((function(r){return r.collectRequiredFields(e,t)})))];case 1:return r.sent(),[2]}}))}))},t.prototype.getSymbol=function(e,t){return this.symbol},t.prototype.getSymbolAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,this.symbol]}))}))},t.prototype.getSymbols=function(){return this.symbol?[this.symbol]:[]},t.prototype.getAttributeHash=function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")},t.prototype.getMeshHash=function(){return this.getSymbols().reduce((function(e,t){return e+JSON.stringify(t)}),"")},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return this.arcadeRequiredForVisualVariables},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new s({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:i.clone(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([a.property({types:n.symbolTypesRenderer})],t.prototype,"symbol",void 0),r.__decorate([a.writer("web-scene","symbol",{symbol:{types:n.symbolTypesRenderer3D}})],t.prototype,"writeSymbolWebScene",null),r.__decorate([a.writer("symbol")],t.prototype,"writeSymbol",null),r.__decorate([a.reader("symbol")],t.prototype,"readSymbol",null),r.__decorate([a.enumeration({simple:"simple"})],t.prototype,"type",void 0),s=r.__decorate([a.subclass("esri.renderers.SimpleRenderer")],t)}(l.VisualVariablesMixin(s))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(270),r(153),r(1505),r(785),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=a.MessageType.CLOSE,c=a.MessageType.ABORT,u=a.MessageType.INVOKE,p=a.MessageType.RESPONSE,d=a.MessageType.OPEN_PORT,h=a.MessageType.ON,f=function(){function e(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}return e.prototype.push=function(e){e.type===a.MessageType.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))},e.prototype.clear=function(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null},e.prototype._process=function(){this._timer=null;for(var e=0,t=this._invokeMessages;e<t.length;e++){var r=t[e];this._cancelledJobIds.has(r.jobId)||this._invoke(r)}this._cancelledJobIds.clear(),this._invokeMessages.length=0},e}();return function(){function e(e,t){var r=this;this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new f((function(e){return r._onInvokeMessage(e)})),this._responseQueue=[],this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,t.scheduler&&(this._frameTask=t.scheduler.registerTask(s.Task.REMOTE_CLIENT,(function(e){return r._update(e)}),(function(){return r._responseQueue.length>0}))),this._port.addEventListener("message",this._onMessage),this._port.start()}return e.connect=function(t){var r,n=new MessageChannel;r="function"==typeof t?new t:"default"in t&&"function"==typeof t.default?new t.default:t;var i=new e(n.port1,{channel:n,client:r});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=i),e.clients.set(i,r),n.port2},e.loadWorker=function(e){var t=o.registry[e];return t?t():i.resolve(null)},e.prototype.close=function(){this._post({type:l}),this._close()},e.prototype.isBusy=function(){return this._outJobs.size>0},e.prototype.invoke=function(e,t,n){var o=this,s=n&&n.signal,l=n&&n.transferList;if(!this._port)return i.reject(new r("remote-client:port-closed","Can't invoke(), port is closed"));var p=a.newJobId();return i.create((function(r,n){i.onAbortOrThrow(s,(function(){o._outJobs.get(p)&&(o._outJobs.delete(p),o._post({type:c,jobId:p}),n(i.createAbortError()))}));var a={resolve:r,reject:n};o._outJobs.set(p,a),o._post({type:u,jobId:p,methodName:e,abortable:null!=s},t,l)}))},e.prototype.on=function(e,t){var r=new MessageChannel;function n(e){t(e.data)}return this._port.postMessage({type:a.MessageType.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),{remove:function(){r.port1.postMessage({type:a.MessageType.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}}},e.prototype.openPort=function(){var e=new MessageChannel;return this._post({type:d,port:e.port2}),e.port1},e.prototype._close=function(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((function(e){return e.reject(i.createAbortError("Abort job: worker closing"))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=null,this._frameTask&&this._frameTask.remove(),this._frameTask=null,this._responseQueue=null},e.prototype._onMessage=function(e){var t=a.receiveMessage(e);if(t)switch(t.type){case p:this._onResponseMessage(t);break;case u:this._invokeQueue.push(t);break;case c:this._onAbortMessage(t);break;case l:this._onCloseMessage();break;case d:this._onOpenPortMessage(t);break;case h:this._onOnMessage(t)}},e.prototype._onAbortMessage=function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),t.delete(r))},e.prototype._onCloseMessage=function(){var t=this._client;this._close(),t&&"destroy"in t&&e.clients.get(this)===t&&t.destroy(),e.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)},e.prototype._onInvokeMessage=function(e){var t,r=this,n=e.methodName,o=e.jobId,s=e.data,l=e.abortable?i.createAbortController():null,c=this._inJobs,u=this._client,d=u[n];try{if(!d&&n&&-1!==n.indexOf("."))for(var h=n.split("."),f=0;f<h.length-1;f++)d=(u=u[h[f]])[h[f+1]];if("function"!=typeof d)throw new TypeError(n+" is not a function");t=d.call(u,s,{client:this,signal:l?l.signal:null})}catch(e){return void this._post({type:p,jobId:o,error:a.toInvokeError(e)})}i.isPromiseLike(t)?(c.set(o,{controller:l,promise:t}),t.then((function(e){c.has(o)&&(c.delete(o),r._post({type:p,jobId:o},e))}),(function(e){c.has(o)&&(c.delete(o),i.isAbortError(e)||r._post({type:p,jobId:o,error:a.toInvokeError(e||{message:"Error encountered at method "+n})}))}))):this._post({type:p,jobId:o},t)},e.prototype._onOpenPortMessage=function(t){new e(t.port,{client:this._client})},e.prototype._onOnMessage=function(e){var t=e.port,r=this._client.on(e.eventType,(function(e){t.postMessage(e)})),i=n.on(e.port,"message",(function(e){a.receiveMessage(e).type===a.MessageType.CLOSE&&(i.remove(),r.remove(),t.close())}))},e.prototype._onResponseMessage=function(e){this._frameTask?this._responseQueue.push(e):this._handleResponse(e)},e.prototype._update=function(e){for(;!e.done&&this._responseQueue.length>0;)this._handleResponse(this._responseQueue.shift()),e.madeProgress()},e.prototype._handleResponse=function(e){var t=e.jobId,n=e.error,i=e.data,o=this._outJobs;if(o.has(t)){var a=o.get(t);o.delete(t),n?a.reject(r.fromJSON(JSON.parse(n))):a.resolve(i)}},e.prototype._post=function(e,t,r){return a.postMessage(this._port,e,t,r)},e.clients=new Map,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(152),r(151),r(1512),r(581)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=n.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),u=new n.JSONMap({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offset=null,t}var n;return r.__extends(t,e),n=t,t.prototype.readFeatureExpressionInfo=function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0},t.prototype.writeFeatureExpressionInfo=function(e,t,r,n){t[r]=e.write(null,n),"0"===e.expression&&(t.featureExpression={value:0})},Object.defineProperty(t.prototype,"mode",{get:function(){return this._isOverridden("mode")?this._get("mode"):o.isSome(this.offset)||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unit",{set:function(e){this._set("unit",e)},enumerable:!0,configurable:!0}),t.prototype.write=function(t,r){return this.offset||this.mode||this.featureExpressionInfo||this.unit?e.prototype.write.call(this,t,r):null},t.prototype.clone=function(){return new n({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})},r.__decorate([a.property({type:s,json:{write:!0}})],t.prototype,"featureExpressionInfo",void 0),r.__decorate([a.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t.prototype,"readFeatureExpressionInfo",null),r.__decorate([a.writer("featureExpressionInfo",{featureExpressionInfo:{type:s},"featureExpression.value":{type:[0]}})],t.prototype,"writeFeatureExpressionInfo",null),r.__decorate([a.property({type:c.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:c.jsonValues,read:c.read,write:{writer:c.write,isRequired:!0}}})],t.prototype,"mode",null),r.__decorate([a.property({type:Number,json:{write:!0}})],t.prototype,"offset",void 0),r.__decorate([a.property({type:l.supportedUnits,json:{type:String,read:u.read,write:u.write}})],t.prototype,"unit",null),n=r.__decorate([a.subclass("esri.layers.support.ElevationInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(154),r(156),r(152),r(172),r(151),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c){var u=a.getLogger("esri.portal.PortalItemResource");return function(e){function t(t){var r=e.call(this,t)||this;return r.portalItem=null,r}return n.__extends(t,e),t.prototype.normalizeCtorArgs=function(e){return e&&e.portalItem&&e.path?n.__assign(n.__assign({},e),{path:this.normalizePath(e.path,e.portalItem)}):e},Object.defineProperty(t.prototype,"path",{set:function(e){s.isSome(e)&&l.isAbsolute(e)?u.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)},enumerable:!0,configurable:!0}),t.prototype._castPath=function(e){return this.normalizePath(e,this.portalItem)},Object.defineProperty(t.prototype,"url",{get:function(){return this.portalItem&&this.path?this.portalItem.itemUrl+"/resources/"+this.path:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemRelativeUrl",{get:function(){return this.portalItem&&this.path?"./resources/"+this.path:null},enumerable:!0,configurable:!0}),t.prototype.fetch=function(e,t){void 0===e&&(e="json");var r=this.url;if(s.isNone(r))throw new o("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:e,signal:s.get(t,"signal")})},t.prototype.update=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(365)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,n.sent().addOrUpdateResource(this,"update",e,t)]}}))}))},t.prototype.hasPath=function(){return s.isSome(this.path)},t.prototype.normalizePath=function(e,t){return s.isNone(e)?e:(e=e.replace(/^\/+/,""),s.isSome(t)&&l.isAbsolute(e)&&(e=l.makeRelative(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))},n.__decorate([c.property()],t.prototype,"portalItem",void 0),n.__decorate([c.property({type:String,value:null})],t.prototype,"path",null),n.__decorate([c.cast("path")],t.prototype,"_castPath",null),n.__decorate([c.property({type:String,readOnly:!0,dependsOn:["portalItem","path"]})],t.prototype,"url",null),n.__decorate([c.property({type:String,readOnly:!0,dependsOn:["portalItem","path"]})],t.prototype,"itemRelativeUrl",null),n.__decorate([c.subclass("esri.portal.PortalItemResource")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.created=null,r.rating=null,r}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"created",void 0),r.__decorate([i.property()],t.prototype,"rating",void 0),r.__decorate([i.subclass("esri.portal.PortalRating")],t)}(n)}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(229)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new RegExp("__begin__","ig"),i=new RegExp("__end__","ig"),o=new RegExp("^__begin__","i"),a=new RegExp("__end__$","i");t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,(function(e){return'__begin__$feature["'+e+'"]__end__'})),t=o.test(t)?t.replace(o,""):'"'+t,t=(t=a.test(t)?t.replace(a,""):t+'"').replace(n,'" + ').replace(i,' + "')):t='""',t};var s=/^\s*\{([^}]+)\}\s*$/i;t.getSingleFieldTemplatedString=function(e){var t=e.match(s);return t&&t[1].trim()||null};var l=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,c=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,u=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;t.getSingleFieldArcadeExpression=function(e){if(!e)return null;var t=l.exec(e)||c.exec(e);return t?t[1]||t[3]:(t=u.exec(e))?t[2]:null}}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(622),r(1140)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.id=null,r.name=null,r.domains=null,r.templates=null,r}return r.__extends(t,e),t.prototype.readDomains=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(n.type){case"range":t[r]=a.RangeDomain.fromJSON(n);break;case"codedValue":t[r]=a.CodedValueDomain.fromJSON(n);break;case"inherited":t[r]=a.InheritedDomain.fromJSON(n)}}return t},t.prototype.writeDomains=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());i.fixJson(r),t.domains=r},t.prototype.readTemplates=function(e){return e&&e.map((function(e){return new s(e)}))},t.prototype.writeTemplates=function(e,t){t.templates=e&&e.map((function(e){return e.toJSON()}))},r.__decorate([o.property({json:{write:!0}})],t.prototype,"id",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"domains",void 0),r.__decorate([o.reader("domains")],t.prototype,"readDomains",null),r.__decorate([o.writer("domains")],t.prototype,"writeDomains",null),r.__decorate([o.property({json:{write:!0}})],t.prototype,"templates",void 0),r.__decorate([o.reader("templates")],t.prototype,"readTemplates",null),r.__decorate([o.writer("templates")],t.prototype,"writeTemplates",null),r.__decorate([o.subclass("esri.layers.support.FeatureType")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(151),r(903),r(636)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISCachedService=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return r.__extends(t,e),t.prototype.readMinScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},t.prototype.readMaxScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new a.TilemapCache({layer:this}):null},r.__decorate([i.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),r.__decorate([i.property()],t.prototype,"minScale",void 0),r.__decorate([i.reader("service","minScale")],t.prototype,"readMinScale",null),r.__decorate([i.property()],t.prototype,"maxScale",void 0),r.__decorate([i.reader("service","maxScale")],t.prototype,"readMaxScale",null),r.__decorate([i.property({type:n.SpatialReference})],t.prototype,"spatialReference",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),r.__decorate([i.property(o.serviceTileInfoProperty)],t.prototype,"tileInfo",void 0),r.__decorate([i.property()],t.prototype,"tilemapCache",void 0),r.__decorate([i.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),r.__decorate([i.property()],t.prototype,"version",void 0),r.__decorate([i.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(237)],void 0===(i=function(e,t,r,n){function i(e,t,i,o){if(!e)return null;var a=t.minScale,s=t.maxScale,l=t.minLOD,c=t.maxLOD;if(null!=l&&null!=c)return o&&o.ignoreMinMaxLOD?n.fromJSON(e):n.fromJSON(r.__assign(r.__assign({},e),{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=l&&t<=c}))}));if(0!==a&&0!==s){var u=function(e){return Math.round(1e4*e)/1e4},p=a?u(a):1/0,d=s?u(s):-1/0;return n.fromJSON(r.__assign(r.__assign({},e),{lods:e.lods.filter((function(e){var t=u(e.scale);return t<=p&&t>=d}))}))}return n.fromJSON(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.serviceTileInfoProperty={type:n,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:i}}}}},t.readServiceTileInfo=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(153),r(172),r(151),r(184),r(170),r(233)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0}),t.ArcGISMapService=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.capabilities=void 0,t.copyright=null,t.fullExtent=null,t.legendEnabled=!0,t.spatialReference=null,t.version=null,t}return r.__extends(t,e),t.prototype.readCapabilities=function(e,t){var r=t.capabilities&&t.capabilities.split(",").map((function(e){return e.toLowerCase().trim()}));if(!r)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var n=this.type,i=-1!==r.indexOf("query"),o=-1!==r.indexOf("map"),a=!!t.exportTilesAllowed,s=-1!==r.indexOf("tilemap"),l="tile"!==n&&!!t.supportsDynamicLayers,c="tile"!==n&&(!t.tileInfo||l),u="tile"!==n&&(!t.tileInfo||l);return{operations:{supportsQuery:i,supportsExportMap:o,supportsExportTiles:a,supportsTileMap:s},exportMap:o?{supportsSublayersChanges:"tile"!==n,supportsDynamicLayers:l,supportsSublayerVisibility:c,supportsSublayerDefinitionExpression:u}:null,exportTiles:a?{maxExportTilesCount:+t.maxExportTilesCount}:null}},t.prototype.readVersion=function(e,t){var r=t.currentVersion;return r||(r=t.hasOwnProperty("capabilities")||t.hasOwnProperty("tables")?10:t.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),r},t.prototype.fetchSublayerInfo=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.fetchAllLayersAndTables(t)];case 1:return r.sent(),[2,this._allLayersAndTablesMap.get(e)]}}))}))},t.prototype.fetchAllLayersAndTables=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.load(e)];case 1:return r.sent(),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=n(o.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json"}}).then((function(e){a._allLayersAndTablesMap=new Map;for(var t=0,r=e.data.layers;t<r.length;t++){var n=r[t];a._allLayersAndTablesMap.set(n.id,n)}return{result:e.data}}),(function(e){return{error:e}}))),[4,this._allLayersAndTablesPromise];case 2:if(t=r.sent(),i.throwIfAborted(e),"result"in t)return[2,t.result];throw t.error}}))}))},r.__decorate([a.property({readOnly:!0})],t.prototype,"capabilities",void 0),r.__decorate([a.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),r.__decorate([a.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),r.__decorate([a.property({type:s})],t.prototype,"fullExtent",void 0),r.__decorate([a.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0),r.__decorate([a.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),r.__decorate([a.property(c.popupEnabled)],t.prototype,"popupEnabled",void 0),r.__decorate([a.property({type:l})],t.prototype,"spatialReference",void 0),r.__decorate([a.property()],t.prototype,"version",void 0),r.__decorate([a.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),r.__decorate([a.subclass("esri.layers.mixins.ArcGISMapService")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(487),r(154),r(156),r(151),r(475),r(322),r(438),r(439)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=a.getLogger("esri.layers.TileLayer"),h=n.ofType(u);function f(e,t){e&&e.forEach((function(e){t(e),e.sublayers&&e.sublayers.length&&f(e.sublayers,t)}))}t.forEachSublayer=f,t.SublayersOwner=function(e){return function(e){function t(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=e.apply(this,r)||this;return o.allSublayers=new i({root:o,rootCollectionNames:["sublayers"],getChildrenFunction:function(e){return e.sublayers}}),o.sublayersSourceJSON=((t={})[2]={},t[3]={},t[4]={},t[5]={},t),o.watch("sublayers",(function(e,t){return o._handleSublayersChange(e,t)}),!0),o}return r.__extends(t,e),t.prototype.readSublayers=function(e,t){if(t&&e){var r=this.sublayersSourceJSON,n=l.nameToId(t.origin);if(!(n<2||(r[n]={context:t,visibleLayers:e.visibleLayers||r[n].visibleLayers,layers:e.layers||r[n].layers},n>2))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var i=this.createSublayersForOrigin("web-document"),o=i.sublayers,a=i.origin,s=c.getProperties(this);s.setDefaultOrigin(a),this._set("sublayers",new h(o)),s.setDefaultOrigin("user")}}},t.prototype.findSublayerById=function(e){return this.allSublayers.find((function(t){return t.id===e}))},t.prototype.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers},t.prototype.createSublayersForOrigin=function(e){for(var t="web-document"===e?l.nameToId("web-map"):l.nameToId(e),r=2,n=this.sublayersSourceJSON[2].layers,i=this.sublayersSourceJSON[2].context,o=null,a=0,s=[3,4,5].filter((function(e){return e<=t}));a<s.length;a++){var c=s[a],d=this.sublayersSourceJSON[c];p.isSublayerOverhaul(d.layers)&&(r=c,n=d.layers,i=d.context,d.visibleLayers&&(o={visibleLayers:d.visibleLayers,context:d.context}))}for(var v=[3,4,5].filter((function(e){return e>r&&e<=t})),m=null,y=0,g=v;y<g.length;y++){var _=g[y],b=this.sublayersSourceJSON[_],x=b.layers,w=b.visibleLayers,S=b.context;x&&(m={layers:x,context:S}),w&&(o={visibleLayers:w,context:S})}var P=function(e,t){var r=[],n={};return e?(e.forEach((function(e){var i=new u;if(i.read(e,t),n[i.id]=i,null!=e.parentLayerId&&-1!==e.parentLayerId){var o=n[e.parentLayerId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(i)}else r.unshift(i)})),r):r}(n,i),T=new Map,O=new Set;if(m)for(var C=0,M=m.layers;C<M.length;C++){var A=M[C];T.set(A.id,A)}if(o)for(var E=0,I=o.visibleLayers;E<I.length;E++){var R=I[E];O.add(R)}return f(P,(function(e){m&&e.read(T.get(e.id),m.context),o&&e.read({defaultVisibility:O.has(e.id)},o.context)})),{origin:l.idToName(r),sublayers:new h({items:P})}},t.prototype.read=function(t,r){e.prototype.read.call(this,t,r),this.readSublayers(t,r)},t.prototype._handleSublayersChange=function(e,t){var r=this;t&&(t.forEach((function(e){e.parent=null,e.layer=null})),this.handles.remove("sublayers-owner")),e&&(e.forEach((function(e){e.parent=r,e.layer=r})),this.handles.add([e.on("after-add",(function(e){var t=e.item;t.parent=r,t.layer=r})),e.on("after-remove",(function(e){var t=e.item;t.parent=null,t.layer=null}))],"sublayers-owner"),"tile"===this.type&&this.handles.add(e.on("before-changes",(function(e){d.error(new o("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:r})),e.preventDefault()})),"sublayers-owner"))},r.__decorate([s.property({readOnly:!0})],t.prototype,"allSublayers",void 0),r.__decorate([s.property({readOnly:!0,type:n.ofType(u)})],t.prototype,"serviceSublayers",void 0),r.__decorate([s.property({value:null,type:h,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),r.__decorate([s.subclass("esri.layers.mixins.SublayersOwner")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(118),r(152),r(119),r(1095)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=new Set;["bing-maps","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"].forEach((function(e){return s.add(e)}));var l=new Set;function c(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function u(e,t){if(function(e,t){if(c(e)){var r=o.getDeepValue("featureCollection.layers",t),n=r&&r[0]&&r[0].layerDefinition;n&&("maxScale"in e&&(n.maxScale=a.numberToJSON(e.maxScale)),"minScale"in e&&(n.minScale=a.numberToJSON(e.minScale)))}else"group"!==e.type&&("maxScale"in e&&(t.maxScale=a.numberToJSON(e.maxScale)),"minScale"in e&&(t.minScale=a.numberToJSON(e.minScale)))}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=a.numberToJSON(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if(c(e)){var r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}["feature","group","tile","unknown","unsupported","vector-tile","web-tile"].forEach((function(e){return l.add(e)})),t.enableRestrictedWriting=function(e){s.delete(e),l.delete(e)},t.disableRestrictedWriting=function(e){s.add(e),l.add(e)},t.getLayerJSON=function(e,t,o){if(!("write"in e)||!e.write)return o&&o.messages&&o.messages.push(new r("layer:unsupported","Layers ("+e.title+", "+e.id+") of type '"+e.declaredClass+"' cannot be persisted",{layer:e})),null;if(function(e,t){if(t.restrictedWebMapWriting){var r=function(e){return"basemap"===e.layerContainerType?s:"operational-layers"===e.layerContainerType?l:null}(t);return!i.isSome(r)||r.has(e.type)&&!c(e)}return!0}(e,o)){var a={};return e.write(a,o)?a:null}return i.isSome(t)&&u(e,t=n.clone(t)),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(169),r(254),r(177),r(154),r(155),r(118),r(323),r(489),r(156),r(153),r(151),r(179),r(1518),r(776),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){var _=h.getLogger("esri.Ground");function b(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}return function(e){function t(t){var r=e.call(this,t)||this;return r.opacity=1,r.surfaceColor=null,r.navigationConstraint=null,r.layers=new o,r.layers.on("after-add",(function(e){return(t=e.item).parent&&t.parent!==r&&"remove"in t.parent&&t.parent.remove(t),t.parent=r,void("elevation"!==t.type&&"base-elevation"!==t.type&&_.error("Layer '"+t.title+", id:"+t.id+"' of type '"+t.type+"' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported."));var t})),r.layers.on("after-remove",(function(e){e.item.parent=null})),r}var c;return n.__extends(t,e),c=t,t.prototype.initialize=function(){this.when().catch((function(e){_.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)},t.prototype.normalizeCtorArgs=function(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=n.__assign({},e)).resourceInfo),e},Object.defineProperty(t.prototype,"layers",{set:function(e){this._set("layers",a.referenceSetter(e,this._get("layers")))},enumerable:!0,configurable:!0}),t.prototype.writeLayers=function(e,t,r,i){var o=[];e?(i=n.__assign(n.__assign({},i),{layerContainerType:"ground"}),e.forEach((function(e){if("write"in e){var t={};s.typeCast(e)().write(t,i)&&o.push(t)}else i&&i.messages&&i.messages.push(new l("layer:unsupported","Layers ("+e.title+", "+e.id+") of type '"+e.declaredClass+"' cannot be persisted in the ground",{layer:e}))})),t.layers=o):t.layers=o},t.prototype.load=function(e){return this.addResolvingPromise(this._loadFromSource(e)),f.resolve(this)},t.prototype.loadAll=function(){var e=this;return d.loadAll(this,(function(t){t(e.layers)}))},t.prototype.queryElevation=function(e,t){var r=this;return this._importElevationQuery().then((function(n){var i=new n.ElevationQuery,o=r.layers.filter(b).toArray();return i.queryAll(o,e,t)}))},t.prototype.createElevationSampler=function(e,t){var r=this.layers.filter(b).toArray();return 1===r.length?r[0].createElevationSampler(e,t):this._importElevationQuery().then((function(n){return(new n.ElevationQuery).createSamplerAll(r,e,t)}))},t.prototype.clone=function(){var e={opacity:this.opacity,surfaceColor:u.clone(this.surfaceColor),navigationConstraint:u.clone(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new c({resourceInfo:this.resourceInfo}).set(e)},t.prototype.read=function(t,r){this.resourceInfo||this._set("resourceInfo",{data:t,context:r}),e.prototype.read.call(this,t,r)},t.prototype._loadFromSource=function(e){var t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):f.resolve(null)},t.prototype._loadLayersFromJSON=function(e,t,n){var i=this,o=t&&t.origin||"web-scene",a=t&&t.portal||null,s=t&&t.url||null;return new Promise((function(e,t){r.e(24).then(function(){var t=[r(718)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(t){f.throwIfAborted(n);var r=[];if(e.layers&&Array.isArray(e.layers)){var l={context:{origin:o,url:s,portal:a,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};r.push(t.populateOperationalLayers(i.layers,e.layers,l))}return f.eachAlways(r)})).then((function(){}))},t.prototype._importElevationQuery=function(){return new Promise((function(e,t){r.e(26).then(function(){var t=[r(1344)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},n.__decorate([v.property({json:{read:!1}})],t.prototype,"layers",null),n.__decorate([v.writer("layers")],t.prototype,"writeLayers",null),n.__decorate([v.property({readOnly:!0})],t.prototype,"resourceInfo",void 0),n.__decorate([v.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:m.Integer,read:{reader:g.transparencyToOpacity,source:"transparency"},write:{writer:function(e,t){t.transparency=g.opacityToTransparency(e)},target:"transparency"}}})],t.prototype,"opacity",void 0),n.__decorate([v.property({type:i,json:{type:[m.Integer],write:function(e,t){t.surfaceColor=e.toJSON().slice(0,3)}}})],t.prototype,"surfaceColor",void 0),n.__decorate([v.property({type:y.NavigationConstraint,json:{write:!0}})],t.prototype,"navigationConstraint",void 0),c=n.__decorate([v.subclass("esri.Ground")],t)}(c.JSONSupportMixin(p))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(254),r(156),r(153),r(151),r(208)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e){return e&&"group"===e.type}function u(e,t,r){var n,i;if(e)for(var o=0,a=e.length;o<a;o++){if((n=e.getItemAt(o))[t]===r)return n;if(c(n)&&(i=u(n.layers,t,r)))return i}}Object.defineProperty(t,"__esModule",{value:!0});var p=o.getLogger("esri.support.LayersMixin");t.LayersMixin=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;i.layers=new n;var o=function(e){e.parent&&e.parent!==i&&"remove"in e.parent&&e.parent.remove(e),e.parent=i,i.layerAdded(e),"elevation"===e.type&&p.error("Layer '"+e.title+", id:"+e.id+"' of type '"+e.type+"' is not supported as an operational layer and will therefore be ignored.")},a=function(e){e.parent=null,i.layerRemoved(e)};return i.layers.on("after-add",(function(e){return o(e.item)})),i.layers.on("after-remove",(function(e){return a(e.item)})),i}return r.__extends(t,e),t.prototype.destroy=function(){this.layers.drain(this.layerRemoved,this)},Object.defineProperty(t.prototype,"layers",{set:function(e){this._set("layers",i.referenceSetter(e,this._get("layers")))},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t){var r=this,n=this.layers;t=n.getNextIndex(t),e instanceof l?(e.parent===this&&this.reorder(e,t),n.add(e,t)):a.isPromiseLike(e)?e.then((function(e){r.destroyed||r.add(e,t)})):p.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")},t.prototype.addMany=function(e,t){var r=this,n=this.layers;t=n.getNextIndex(t),e.slice().forEach((function(e){e.parent!==r?(n.add(e,t),t+=1):r.reorder(e,t)}))},t.prototype.findLayerById=function(e){return u(this.layers,"id",e)},t.prototype.findLayerByUid=function(e){return u(this.layers,"uid",e)},t.prototype.remove=function(e){return this.layers.remove(e)},t.prototype.removeMany=function(e){return this.layers.removeMany(e)},t.prototype.removeAll=function(){return this.layers.removeAll()},t.prototype.reorder=function(e,t){return this.layers.reorder(e,t)},t.prototype.layerAdded=function(e){},t.prototype.layerRemoved=function(e){},r.__decorate([s.property()],t.prototype,"layers",null),r.__decorate([s.subclass("esri.support.LayersMixin")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(620),r(231),r(157),r(151),r(1520),r(1521)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=[0,0];function u(e){e&&(n.empty(e),e.parentNode&&e.parentNode.removeChild(e))}t.DOMContainer=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._freqInfo={freq:16,time:750},n._overlayRenderTaskHandle=null,n.height=0,n.position=null,n.resizing=!1,n.root=null,n.surface=null,n.suspended=!0,n.ui=null,n.userContent=null,n.width=0,n.widthBreakpoint=null,n.handles.add([n.watch("cursor",(function(e){var t=n.surface;t&&t.setAttribute("data-cursor",e)})),n.watch("interacting",(function(e){var t=n.surface;t&&t.setAttribute("data-interacting",e.toString())}))]),n}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(this.watch("ui",(function(t,r){return e._handleUIChange(t,r)}))),this._wireUI(this.ui),this.handles.add([this.on("focus",(function(){return e.notifyChange("focused")})),this.on("blur",(function(){return e.notifyChange("focused")}))])},t.prototype.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)},Object.defineProperty(t.prototype,"container",{set:function(e){var t=this,r=this._get("container");if(r!==e)if(this.handles.remove("dom-size"),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),u(this.root),this._set("root",null),n.reparent(this.userContent,r),u(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");var a=document.createElement("div");a.className="esri-view-user-storage",n.reparent(e,a),e.appendChild(a),this._set("userContent",a);var l=document.createElement("div");l.className="esri-view-root",e.insertBefore(l,e.firstChild),this._set("root",l);var c=document.createElement("div");c.className="esri-view-surface",c.setAttribute("role","application"),c.tabIndex=0,l.appendChild(c),this._set("surface",c);var p=new s;l.appendChild(p.surface),this._set("overlay",p),p.watch("needsRender",(function(e){e&&!t._overlayRenderTaskHandle?t._overlayRenderTaskHandle=i.addFrameTask({render:function(){t.overlay.render()}}):t._overlayRenderTaskHandle&&(t._overlayRenderTaskHandle.remove(),t._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(o.init(this,"size",(function(e){var t=e[0],r=e[1];t>=document.body.clientWidth||r>=document.body.clientHeight?c.classList.add("esri-view-surface--inset-outline"):c.classList.remove("esri-view-surface--inset-outline")})),"dom-size"),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focused",{get:function(){var e=document.activeElement===this.surface;return document.hasFocus()&&e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"popup",{get:function(){return this._get("popup")||new l({view:this})},set:function(e){var t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0}),t.prototype.blur=function(){this.surface&&this.surface.blur()},t.prototype.focus=function(){this.surface&&this.surface.focus()},t.prototype.pageToContainer=function(e,t,r){var n=this.position;return e-=n[0],t-=n[1],r?(r[0]=e,r[1]=t):r=[e,t],r},t.prototype.containerToPage=function(e,t,r){var n=this.position;return e+=n[0],t+=n[1],r?(r[0]=e,r[1]=t):r=[e,t],r},t.prototype._handleUIChange=function(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)},t.prototype._wireUI=function(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([o.init(this,"root",(function(t){var r,n;e.container=t?(r=t,n=document.createElement("div"),r.appendChild(n),n):null})),o.init(this,"popup",(function(t,r){r&&e.remove(r,"popup"),t&&(t.view=e.view,e.add(t,{key:"popup",position:"manual"}))}))],"ui"))},t.prototype._stopMeasuring=function(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)},t.prototype._startMeasuring=function(){var e,t=this,r=this._freqInfo;r.freq=16,r.time=750,this.handles.add([(e=function(){r.freq=16,r.time=750},window.addEventListener("resize",e),{remove:function(){window.removeEventListener("resize",e)}}),i.addFrameTask({prepare:function(e){var r=t._measure(),n=t._freqInfo;if(n.time+=e.deltaTime,r&&(n.freq=16,t._get("resizing")||t._set("resizing",!0)),!(n.time<n.freq)){n.time=0;var i=t._position();n.freq=i||r?16:Math.min(750,2*n.freq),!r&&n.freq>=512&&t._get("resizing")&&t._set("resizing",!1)}}})],"measuring"),this._measure(),this._position()},t.prototype._measure=function(){var e=this.container,t=e?e.clientWidth:0,r=e?e.clientHeight:0;if(0===t||0===r)return this.suspended||this._set("suspended",!0),!1;var n=this.width,i=this.height;return t===n&&r===i?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",r),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:i,width:t,height:r}),!0)},t.prototype._position=function(){var e=this.container,t=this.position,r=function(e){var t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return c[0]=r.left+t.pageXOffset,c[1]=r.top+t.pageYOffset,c}(e);return!(t&&r[0]===t[0]&&r[1]===t[1]||(this._set("position",[r[0],r[1]]),0))},t.prototype.forceDOMReadyCycle=function(){},r.__decorate([a.property({value:null,cast:function(e){return n.byId(e)}})],t.prototype,"container",null),r.__decorate([a.property({readOnly:!0,dependsOn:["surface"]})],t.prototype,"focused",null),r.__decorate([a.property({readOnly:!0})],t.prototype,"height",void 0),r.__decorate([a.property({type:l})],t.prototype,"popup",null),r.__decorate([a.property({type:s})],t.prototype,"overlay",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"position",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"resizing",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"root",void 0),r.__decorate([a.property({value:null,dependsOn:["width","height"],readOnly:!0})],t.prototype,"size",null),r.__decorate([a.property({readOnly:!0})],t.prototype,"surface",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r.__decorate([a.property()],t.prototype,"ui",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"userContent",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"width",void 0),r.__decorate([a.property()],t.prototype,"widthBreakpoint",void 0),r.__decorate([a.subclass("esri.views.DOMContainer")],t)}(e)},t.isDOMContainer=function(e){return e&&"focus"in e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(183)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureContentMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderNodeContent=function(e){return i.isWidget(e)&&!e.destroyed?i.tsx("div",{key:e},e.render()):e instanceof HTMLElement?i.tsx("div",{key:e,bind:e,afterCreate:t._attachToNode}):i.hasDomNode(e)?i.tsx("div",{key:e,bind:e.domNode,afterCreate:t._attachToNode}):null},t}return r.__extends(t,e),t.prototype._attachToNode=function(e){e.appendChild(this)},r.__decorate([n.subclass("esri.widgets.Feature.ContentMixin")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){var o=function(e){function t(t){var r=e.call(this)||this;return r.nativeIndex=null,r._detectedDeviceType="unknown","standard"===t.mapping?r._detectedDeviceType="standard":a.test(t.id)?r._detectedDeviceType="spacemouse":r._detectedDeviceType="unknown",r.nativeIndex=t.index,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"native",{get:function(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceType",{get:function(){return this._detectedDeviceType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"axisThreshold",{get:function(){return s[this.deviceType]},enumerable:!0,configurable:!0}),r.__decorate([i.property({nonNullable:!0,readOnly:!0})],t.prototype,"nativeIndex",void 0),r.__decorate([i.property({type:String,readOnly:!0})],t.prototype,"deviceType",null),r.__decorate([i.property({type:Number,readOnly:!0})],t.prototype,"axisThreshold",null),r.__decorate([i.subclass("esri.views.input.gamepad.GamepadInputDevice")],t)}(n),a=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),s={standard:.15,spacemouse:.025,unknown:0};return o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.common=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1542)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2df64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(369),r(155),r(151),r(912),r(441),r(370),r(913),r(272),r(413),r(205),r(306),r(216),r(1555),r(440)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){var g=[0,0];return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i._viewpoint2D={center:v.vec2f64.create(),rotation:0,scale:0,spatialReference:null},i.center=[0,0],i.extent=new n.Extent,i.id=0,i.inverseTransform=u.mat2df64.create(),i.resolution=0,i.rotation=0,i.scale=0,i.transform=u.mat2df64.create(),i.transformNoRotation=u.mat2df64.create(),i.displayMat3=d.mat3f32.create(),i.displayViewMat3=d.mat3f32.create(),i.viewMat3=d.mat3f32.create(),i.viewMat2d=c.mat2df32.create(),i.worldScreenWidth=0,i.size=[0,0],i}var o;return r.__extends(t,e),o=t,Object.defineProperty(t.prototype,"pixelRatio",{set:function(e){this._set("pixelRatio",e),this._update()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{set:function(e){this._set("size",e),this._update()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewpoint",{set:function(e){if(e){var t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()},enumerable:!0,configurable:!0}),t.prototype.copy=function(e){var t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=y.copy(r,e.viewpoint),this._set("size",h.vec2.copy(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this},t.prototype.clone=function(){return new o({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})},t.prototype.toMap=function(e,t,r){return m.isVec2(t)?h.vec2.transformMat2d(e,t,this.inverseTransform):(g[0]=t,g[1]=r,h.vec2.transformMat2d(e,g,this.inverseTransform))},t.prototype.toScreen=function(e,t,r){return m.isVec2(t)?h.vec2.transformMat2d(e,t,this.transform):(g[0]=t,g[1]=r,h.vec2.transformMat2d(e,g,this.transform))},t.prototype.toScreenNoRotation=function(e,t,r){return m.isVec2(t)?h.vec2.transformMat2d(e,t,this.transformNoRotation):(g[0]=t,g[1]=r,h.vec2.transformMat2d(e,g,this.transformNoRotation))},t.prototype.getScreenTransform=function(e,t){var r=this._viewpoint2D.center,n=this._get("pixelRatio")||1,i=this._get("size");return y.getMatrix(e,r,i,t,0,n),e},t.prototype._update=function(){var e=this._viewpoint2D,t=e.center,r=e.spatialReference,o=e.scale,a=e.rotation,c=this._get("pixelRatio")||1,u=this._get("size"),d=new i({targetGeometry:new n.Point(t[0],t[1],r),scale:o,rotation:a});if(this._set("viewpoint",d),u&&r&&o){this.resolution=y.getResolution(d),this.rotation=a,this.scale=o,this.spatialReference=r,h.vec2.copy(this.center,t);var v=0!==u[0]?2/u[0]:0,m=0!==u[1]?-2/u[1]:0;p.mat3.set(this.displayMat3,v,0,0,0,m,0,-1,1,1);var g=p.mat3.identity(this.viewMat3),_=f.vec2f32.fromValues(u[0]/2,u[1]/2),b=f.vec2f32.fromValues(-u[0]/2,-u[1]/2),x=s.common.toRadian(a);p.mat3.translate(g,g,_),p.mat3.rotate(g,g,x),p.mat3.translate(g,g,b),p.mat3.multiply(this.displayViewMat3,this.displayMat3,g);var w=l.mat2d.identity(this.viewMat2d);return l.mat2d.translate(w,w,_),l.mat2d.rotate(w,w,x),l.mat2d.translate(w,w,b),y.getExtent(this.extent,d,u),y.getTransform(this.transform,d,u,c),l.mat2d.invert(this.inverseTransform,this.transform),y.getTransformNoRotation(this.transformNoRotation,d,u,c),this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution),this._set("id",this.id+1),this}},r.__decorate([a.property({readOnly:!0})],t.prototype,"id",void 0),r.__decorate([a.property({value:1,json:{write:!0}})],t.prototype,"pixelRatio",null),r.__decorate([a.property({json:{write:!0}})],t.prototype,"size",null),r.__decorate([a.property({type:i,json:{write:!0}})],t.prototype,"viewpoint",null),o=r.__decorate([a.subclass("esri.views.2d.ViewState")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.date=null,r.directShadowsEnabled=!1,r.displayUTCOffset=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readDate=function(e,t){return null!=t.datetime&&new Date(t.datetime)||null},t.prototype.writeDate=function(e,t,r){t[r]=e.getTime()},t.prototype.readDirectShadowsEnabled=function(e,t){return!!t.directShadows},t.prototype.writedirectShadowsEnabled=function(e,t,r){e&&(t[r]=e)},t.prototype.writeDisplayUTCOffset=function(e,t){null!=e&&(t.displayUTCOffset=e)},t.prototype.clone=function(){return new n(this.cloneConstructProperties())},t.prototype.cloneConstructProperties=function(){var e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e},r.__decorate([i.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],t.prototype,"date",void 0),r.__decorate([i.reader("date",["datetime"])],t.prototype,"readDate",null),r.__decorate([i.writer("date")],t.prototype,"writeDate",null),r.__decorate([i.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],t.prototype,"directShadowsEnabled",void 0),r.__decorate([i.reader("directShadowsEnabled",["directShadows"])],t.prototype,"readDirectShadowsEnabled",null),r.__decorate([i.writer("directShadowsEnabled")],t.prototype,"writedirectShadowsEnabled",null),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"displayUTCOffset",void 0),r.__decorate([i.writer("displayUTCOffset")],t.prototype,"writeDisplayUTCOffset",null),n=r.__decorate([i.subclass("esri.webscene.Lighting")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeSize=function(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:return void r.neverReached(e)}},t.isSigned=function(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return void r.neverReached(e)}},t.isInteger=function(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return void r.neverReached(e)}},t.maximumValue=function(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return void r.neverReached(e)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(156),r(168),r(532),r(189),r(185),r(162),r(160),r(251),r(355),r(918),r(648),r(649),r(794)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){Object.defineProperty(t,"__esModule",{value:!0});var m=n.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function y(e){return void 0===e&&(e=t.UP),{plane:h.create(e.plane),origin:c.vec3f64.clone(e.origin),basis1:c.vec3f64.clone(e.basis1),basis2:c.vec3f64.clone(e.basis2)}}function g(e,t){return void 0===t&&(t=y()),_(e.origin,e.basis1,e.basis2,t)}function _(e,t,r,n){return void 0===n&&(n=y()),l.vec3.copy(n.origin,e),l.vec3.copy(n.basis1,t),l.vec3.copy(n.basis2,r),b(n),function(e,t){Math.abs(l.vec3.dot(e.basis1,e.basis2)/(l.vec3.length(e.basis1)*l.vec3.length(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(l.vec3.dot(e.basis1,E(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-l.vec3.dot(E(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(n,"fromValues()"),n}function b(e){h.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,r){e!==r&&g(e,r);var n=l.vec3.scale(p.sv3d.get(),E(e),t);return l.vec3.add(r.origin,r.origin,n),r.plane[3]-=t,r}function w(e,t){void 0===t&&(t=y());var r=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return l.vec3.set(t.origin,e[0]+r,e[1]+n,0),l.vec3.set(t.basis1,r,0,0),l.vec3.set(t.basis2,0,n,0),h.fromValues(0,0,1,0,t.plane),t}function S(e,t,r){return!!h.intersectRay(e.plane,t,r)&&I(e,r)}function P(e,t,r){var n=j.get();L(e,t,n,j.get());for(var o=Number.POSITIVE_INFINITY,a=0,s=k;a<s.length;a++){var c=D(e,s[a],V.get()),d=p.sv3d.get();if(h.intersectLineSegment(n,c,d)){var f=u.directionFromTo(p.sv3d.get(),t.origin,d),v=Math.abs(i.acosClamped(l.vec3.dot(t.direction,f)));v<o&&(o=v,l.vec3.copy(r,d))}}return o===Number.POSITIVE_INFINITY?T(e,t,r):r}function T(e,t,r){if(S(e,t,r))return r;var n=j.get(),i=j.get();L(e,t,n,i);for(var o=Number.POSITIVE_INFINITY,a=0,s=k;a<s.length;a++){var c=D(e,s[a],V.get()),u=p.sv3d.get();if(h.intersectLineSegmentClamp(n,c,u)){var d=f.distance2(t,u);if(!h.isPointInside(i,u))continue;d<o&&(o=d,l.vec3.copy(r,u))}}return M(e,t.origin)<o&&O(e,t.origin,r),r}function O(e,t,r){var n=h.projectPoint(e.plane,t,p.sv3d.get()),i=d.projectPointClamp(R(e,e.basis1),n,-1,1,p.sv3d.get()),o=d.projectPointClamp(R(e,e.basis2),n,-1,1,p.sv3d.get());return l.vec3.subtract(r,l.vec3.add(p.sv3d.get(),i,o),e.origin),r}function C(e,t,r){var n=e.origin,i=e.basis1,o=e.basis2,a=l.vec3.subtract(p.sv3d.get(),t,n),s=v.projectPointSignedLength(i,a),c=v.projectPointSignedLength(o,a),u=v.projectPointSignedLength(E(e),a);return l.vec3.set(r,s,c,u)}function M(e,t){var r=C(e,t,p.sv3d.get()),n=e.basis1,i=e.basis2,o=l.vec3.length(n),a=l.vec3.length(i),s=Math.max(Math.abs(r[0])-o,0),c=Math.max(Math.abs(r[1])-a,0),u=r[2];return s*s+c*c+u*u}function A(e,t){var r=-e.plane[3];return v.projectPointSignedLength(E(e),t)-r}function E(e){return h.normal(e.plane)}function I(e,t){var r=l.vec3.subtract(p.sv3d.get(),t,e.origin),n=l.vec3.squaredLength(e.basis1),i=l.vec3.squaredLength(e.basis2),o=l.vec3.dot(e.basis1,r),a=l.vec3.dot(e.basis2,r);return-o-n<0&&o-n<0&&-a-i<0&&a-i<0}function R(e,t){var r=V.get();return l.vec3.copy(r.origin,e.origin),l.vec3.copy(r.vector,t),r}function D(e,t,r){var n=e.basis1,i=e.basis2,o=e.origin,a=l.vec3.scale(p.sv3d.get(),n,t.origin[0]),s=l.vec3.scale(p.sv3d.get(),i,t.origin[1]);l.vec3.add(r.origin,a,s),l.vec3.add(r.origin,r.origin,o);var c=l.vec3.scale(p.sv3d.get(),n,t.direction[0]),u=l.vec3.scale(p.sv3d.get(),i,t.direction[1]);return l.vec3.scale(r.vector,l.vec3.add(c,c,u),2),r}function L(e,t,r,n){var i=E(e);h.fromVectorsAndPoint(i,t.direction,t.origin,r),h.fromVectorsAndPoint(h.normal(r),i,t.origin,n)}t.BoundedPlaneClass=function(){this.plane=h.create(),this.origin=c.vec3f64.create(),this.basis1=c.vec3f64.create(),this.basis2=c.vec3f64.create()},t.create=y,t.wrap=function(e,t,r){var n=N.get();return n.origin=e,n.basis1=t,n.basis2=r,n.plane=h.wrap(0,0,0,0),b(n),n},t.copy=g,t.fromValues=_,t.updateUnboundedPlane=b,t.elevate=x,t.setExtent=function(e,t,r){return w(t,r),x(r,A(e,e.origin),r),r},t.fromAABoundingRect=w,t.intersectRay=S,t.intersectRayClosestSilhouette=function(e,t,r){if(S(e,t,r))return r;var n=P(e,t,p.sv3d.get());return l.vec3.add(r,t.origin,l.vec3.scale(p.sv3d.get(),t.direction,l.vec3.distance(t.origin,n)/l.vec3.length(t.direction))),r},t.closestPointOnSilhouette=P,t.closestPoint=T,t.projectPoint=O,t.projectPointLocal=C,t.distance2=M,t.distance=function(e,t){return Math.sqrt(M(e,t))},t.distanceToSilhouette=function(e,t){for(var r=Number.NEGATIVE_INFINITY,n=0,i=k;n<i.length;n++){var o=D(e,i[n],V.get()),a=d.distance2(o,t);a>r&&(r=a)}return Math.sqrt(r)},t.extrusionContainsPoint=function(e,t){return h.isPointInside(e.plane,t)&&I(e,t)},t.axisAt=function(e,t,n,i){return function(e,t,n){switch(t){case 0:l.vec3.copy(n,e.basis1),l.vec3.normalize(n,n);break;case 1:l.vec3.copy(n,e.basis2),l.vec3.normalize(n,n);break;case 2:l.vec3.copy(n,E(e));break;default:r.neverReached(t)}return n}(e,n,i)},t.altitudeAt=A,t.setAltitudeAt=function(e,t,r,n){var i=A(e,t),o=l.vec3.scale(F,E(e),r-i);return l.vec3.add(n,t,o),n},t.equals=function(e,t){return l.vec3.equals(e.basis1,t.basis1)&&l.vec3.equals(e.basis2,t.basis2)&&l.vec3.equals(e.origin,t.origin)},t.transform=function(e,t,r){return e!==r&&g(e,r),a.mat4.invert(z,t),a.mat4.transpose(z,z),l.vec3.transformMat4(r.basis1,e.basis1,z),l.vec3.transformMat4(r.basis2,e.basis2,z),l.vec3.transformMat4(r.plane,e.plane,z),l.vec3.transformMat4(r.origin,e.origin,t),h.setOffsetFromPoint(r.plane,r.origin,r.plane),r},t.rotate=function(e,t,r,n){return e!==n&&g(e,n),a.mat4.rotate(U,a.mat4.identity(U),t,r),l.vec3.transformMat4(n.basis1,e.basis1,U),l.vec3.transformMat4(n.basis2,e.basis2,U),b(n),n},t.normal=E,t.UP={plane:h.create(),origin:c.vec3f64.fromValues(0,0,0),basis1:c.vec3f64.fromValues(1,0,0),basis2:c.vec3f64.fromValues(0,1,0)};var j=new o.ObjectStack(h.create),V=new o.ObjectStack(d.create),F=c.vec3f64.create(),N=new o.ObjectStack((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),k=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],z=s.mat4f64.create(),U=s.mat4f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(532),r(162),r(160),r(355)],void 0===(i=function(e,t,r,n,i,o,a){function s(e){return e?{origin:o.vec3f64.clone(e.origin),vector:o.vec3f64.clone(e.vector)}:{origin:o.vec3f64.create(),vector:o.vec3f64.create()}}function l(e,t){var r=f.get();return r.origin=e,r.vector=t,r}function c(e,t,r){return void 0===r&&(r=s()),i.vec3.copy(r.origin,e),i.vec3.copy(r.vector,t),r}function u(e,t){var n=i.vec3.subtract(a.sv3d.get(),t,e.origin),o=i.vec3.dot(e.vector,n),s=i.vec3.dot(e.vector,e.vector),l=r.clamp(o/s,0,1),c=i.vec3.subtract(a.sv3d.get(),i.vec3.scale(a.sv3d.get(),e.vector,l),n);return i.vec3.dot(c,c)}function p(e,t,n,o,s){var l=e.vector,c=e.origin,u=i.vec3.subtract(a.sv3d.get(),t,c),p=i.vec3.length(l),d=i.vec3.dot(l,u)/p;return i.vec3.scale(s,l,r.clamp(d,n,o)),i.vec3.add(s,s,e.origin)}function d(e,t,n,o){var s=e.origin,l=i.vec3.add(a.sv3d.get(),s,e.vector),c=t.origin,u=i.vec3.add(a.sv3d.get(),c,t.vector),p=a.sv3d.get(),d=a.sv3d.get();if(p[0]=s[0]-c[0],p[1]=s[1]-c[1],p[2]=s[2]-c[2],d[0]=u[0]-c[0],d[1]=u[1]-c[1],d[2]=u[2]-c[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;var h=a.sv3d.get();if(h[0]=l[0]-s[0],h[1]=l[1]-s[1],h[2]=l[2]-s[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;var f=p[0]*d[0]+p[1]*d[1]+p[2]*d[2],v=d[0]*h[0]+d[1]*h[1]+d[2]*h[2],m=p[0]*h[0]+p[1]*h[1]+p[2]*h[2],y=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],g=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*y-v*v;if(Math.abs(g)<1e-6)return!1;var _=(f*v-m*y)/g,b=(f+v*_)/y;n&&(_=r.clamp(_,0,1),b=r.clamp(b,0,1));var x=a.sv3d.get(),w=a.sv3d.get();return x[0]=s[0]+_*h[0],x[1]=s[1]+_*h[1],x[2]=s[2]+_*h[2],w[0]=c[0]+b*d[0],w[1]=c[1]+b*d[1],w[2]=c[2]+b*d[2],o.tA=_,o.tB=b,o.pA=x,o.pB=w,o.distance2=i.vec3.squaredDistance(x,w),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.wrap=l,t.copy=function(e,t){return void 0===t&&(t=s()),c(e.origin,e.vector,t)},t.fromValues=c,t.fromPoints=function(e,t,r){return void 0===r&&(r=s()),i.vec3.copy(r.origin,e),i.vec3.subtract(r.vector,t,e),r},t.distance2=u,t.distance=function(e,t){return Math.sqrt(u(e,t))},t.projectPoint=function(e,t,r){return p(e,t,0,1,r)},t.pointAt=function(e,t,r){return i.vec3.add(r,e.origin,i.vec3.scale(r,e.vector,t))},t.projectPointClamp=p,t.closestRayDistance2=function(e,t){if(d(e,l(t.origin,t.direction),!1,h)){var r=h.tA,n=h.pB,o=h.distance2;if(r>=0&&r<=1)return o;if(r<0)return i.vec3.squaredDistance(e.origin,n);if(r>1)return i.vec3.squaredDistance(i.vec3.add(a.sv3d.get(),e.origin,e.vector),n)}return null},t.closestLineSegmentPoint=function(e,t,r){return!!d(e,t,!0,h)&&(i.vec3.copy(r,h.pA),!0)},t.closestLineSegmentDistance2=function(e,t){return d(e,t,!0,h)?h.distance2:null};var h={tA:0,tB:0,pA:o.vec3f64.create(),pB:o.vec3f64.create(),distance2:0},f=new n.ObjectStack((function(){return{origin:null,vector:null}}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(156),r(168),r(532),r(189),r(162),r(160),r(203),r(251),r(355),r(649)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=n.getLogger("esri.views.3d.support.geometryUtils.sphere");function f(e){return e?{radius:e.radius,center:l.vec3f64.clone(e.center)}:{radius:1,center:l.vec3f64.create()}}function v(e,t){return void 0===t&&(t=f()),m(e.radius,e.center,t)}function m(e,t,r){return void 0===r&&(r=f()),s.vec3.copy(r.center,t),r.radius=e,r}function y(e,t,r){var n=s.vec3.subtract(p.sv3d.get(),t.origin,e.center),i=s.vec3.dot(t.direction,t.direction),o=2*s.vec3.dot(t.direction,n),a=o*o-4*i*(s.vec3.dot(n,n)-e.radius*e.radius);if(a<0)return!1;var l=Math.sqrt(a),c=(-o-l)/(2*i),u=(-o+l)/(2*i);return(c<0||u<c&&u>0)&&(c=u),!(c<0||(r&&s.vec3.add(r,t.origin,s.vec3.scale(p.sv3d.get(),t.direction,c)),0))}function g(e,t,r){var n=p.sv3d.get(),i=p.sm4d.get();s.vec3.cross(n,t.origin,t.direction),s.vec3.cross(r,n,t.origin),s.vec3.scale(r,r,1/s.vec3.length(r)*e.radius);var o=b(e,t.origin),l=c.vector.angle(t.origin,r);return a.mat4.identity(i),a.mat4.rotate(i,i,l+o,n),s.vec3.transformMat4(r,r,i),r}function _(e,t,r){var n=s.vec3.subtract(p.sv3d.get(),t,e.center),i=s.vec3.scale(p.sv3d.get(),n,e.radius/s.vec3.length(n));return s.vec3.add(r,i,e.center)}function b(e,t){var r=s.vec3.subtract(p.sv3d.get(),t,e.center),n=s.vec3.length(r),o=e.radius+Math.abs(e.radius-n);return i.acosClamped(e.radius/o)}t.create=f,t.wrap=function(e,t){var r=P.get();return r.radius=e,r.center=t||O,r},t.copy=v,t.fromValues=m,t.elevate=function(e,t,r){return e!==r&&s.vec3.copy(r.center,e.center),r.radius=e.radius+t,r},t.setExtent=function(e,t,r){return h.error("sphere.setExtent is not yet supported"),e===r?r:v(e,r)},t.intersectRay=y,t.intersectScreen=function(e,t,r,n){return y(e,d.fromScreenAtEye(t,r,T),n)},t.intersectsRay=function(e,t){return y(e,t,null)},t.intersectRayClosestSilhouette=function(e,t,r){if(y(e,t,r))return r;var n=g(e,t,p.sv3d.get());return s.vec3.add(r,t.origin,s.vec3.scale(p.sv3d.get(),t.direction,s.vec3.distance(t.origin,n)/s.vec3.length(t.direction))),r},t.closestPointOnSilhouette=g,t.closestPoint=function(e,t,r){return y(e,t,r)?r:(d.closestPoint(t,e.center,r),_(e,r,r))},t.projectPoint=_,t.distanceToSilhouette=function(e,t){var r=s.vec3.subtract(p.sv3d.get(),t,e.center),n=s.vec3.squaredLength(r),i=e.radius*e.radius;return Math.sqrt(Math.abs(n-i))},t.angleToSilhouette=b;var x=l.vec3f64.create();function w(e,t,n,i){var o=s.vec3.subtract(x,t,e.center);switch(n){case 0:var a=(l=u.cartesianToSpherical(o,x))[2];return s.vec3.set(i,-Math.sin(a),Math.cos(a),0);case 1:var l,c=(l=u.cartesianToSpherical(o,x))[1],p=(a=l[2],Math.sin(c));return s.vec3.set(i,-p*Math.cos(a),-p*Math.sin(a),Math.cos(c));case 2:return s.vec3.normalize(i,o);default:return void r.neverReached(n)}}function S(e,t){var r=s.vec3.subtract(C,t,e.center);return s.vec3.length(r)-e.radius}t.axisAt=w,t.altitudeAt=S,t.setAltitudeAt=function(e,t,r,n){var i=S(e,t),o=w(e,t,2,C),a=s.vec3.scale(C,o,r-i);return s.vec3.add(n,t,a),n};var P=new o.ObjectStack((function(){return{center:null,radius:0}})),T=d.create(),O=l.vec3f64.create(),C=l.vec3f64.create();Object.freeze(O)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignPixel=function(e){var t=n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),a=n.glsl(o||(o=r.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz = vec2(1.0) / widthHeight;\n      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(t),e.vertex.code.add(a),e.fragment.code.add(t),e.fragment.code.add(a)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){for(var n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=r,t.decodeDoubleArray=function(e,t,r){for(var n=0;n<r;++n)t[n]=e[2*n]+e[2*n+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)n[0]=e[s],r(n,i,1),t[s]=i[0],o[s]=i[1]};var n=new Float64Array(1),i=new Float32Array(2)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.viewAngle=function(e,t,i){e.worldUpAtPosition(t,o),n.vec3.subtract(a,i,t);var s=n.vec3.length(a);return 0===s?0:r.acosClamped(n.vec3.dot(a,o)/s)};var o=i.vec3f64.create(),a=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(160),r(530),r(1634),r(924),r(288),r(390)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.mode="interaction",r.hasTarget=!1,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.animation=new a.default(this.view.state.mode),this.viewAnimation="interaction"===this.mode?null:new o},Object.defineProperty(t.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0}),t.prototype.begin=function(e,t){this.hasTarget=!0;var r=this.animationSettings(t);p.copyFrom(this.view.state.camera);var n=new c.Intersector(this.view.state.mode);this.intersectionHelper.intersectRay(p.ray,n,d)&&(p.center=d),this.animation.update(p,e,r),this.animation.finished&&this.finish()},t.prototype.finish=function(){this.animation.currentTime=this.animation.time,e.prototype.finish.call(this)},Object.defineProperty(t.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0}),t.prototype.stepController=function(e,t){this.hasTarget&&this.animation.step(e,t)},t.prototype.onControllerEnd=function(t){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,t),this.animation.currentTime=this.animation.time),e.prototype.onControllerEnd.call(this,t)},t.prototype.animationSettings=function(e){return void 0===e&&(e={}),{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:e.speedFactor,duration:e.duration,maxDuration:e.maxDuration,easing:e.easing}},r.__decorate([n.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"mode",void 0),r.__decorate([n.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],t)}(s.AnimationController);t.PointToPointAnimationController=u;var p=new l.default,d=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(153),r(151),r(530),r(799)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(e){this._asyncResult&&(this._asyncResult.reject(i.createAbortError()),this._asyncResult=null),this.state===s.State.Finished||this.state===s.State.Stopped?this.state===s.State.Finished?e.resolve():e.reject(i.createAbortError()):this._asyncResult=e},enumerable:!0,configurable:!0}),t.prototype.onControllerStart=function(){var e=this;this.state=s.State.Running,n.isSome(this.viewAnimation)&&this.viewAnimation.when((function(){return e.updateStateFromViewAnimation()}),(function(){return e.updateStateFromViewAnimation()}))},t.prototype.updateStateFromViewAnimation=function(){!n.isSome(this.viewAnimation)||this.state!==s.State.Ready&&this.state!==s.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&(this.state=s.State.Stopped))},t.prototype.onControllerEnd=function(){n.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===s.State.Finished?this.viewAnimation.finish():this.state===s.State.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===s.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(i.createAbortError()))},t.prototype.finish=function(){this.finishController()},r.__decorate([o.subclass("esri.views.3d.state.controllers.AnimationController")],t)}(s.CameraController);t.AnimationController=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(638),r(156),r(168),r(153),r(162),r(160),r(202),r(170),r(491),r(533),r(1648),r(1649),r(238),r(644),r(251),r(192),r(1193)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){Object.defineProperty(t,"__esModule",{value:!0});var b=i.getLogger("esri.views.3d.support.cameraUtils"),x=l.vec3f64.create(),w=l.vec3f64.create(),S=l.vec3f64.create(),P={heading:0,tilt:0},T=new c,O=new y.Cyclical(-20037508.342788905,20037508.342788905),C=new y.Cyclical(-180,180);function M(e){return e.spatialReference||u.WGS84}function A(e){return"global"===e.viewingMode?f:h}function E(e,t,r){var n=e.state.camera,i=n.fovX,a=n.width/2/n.pixelRatio;return"global"===e.viewingMode&&null!=r&&(t*=Math.cos(o.deg2rad(r))),a/(96*39.37/(t/=e.renderCoordsHelper.unitInMeters))/Math.tan(i/2)}function I(e,t,r){var n=e.state.camera,i=n.fovX,a=t*Math.tan(i/2),s=96*39.37/(n.width/2/n.pixelRatio/a);return"global"===e.viewingMode&&(s/=Math.cos(o.deg2rad(r))),s*e.renderCoordsHelper.unitInMeters}function R(e,t,r,n,i,o){if(z(o)){var a=k(o.signal);return L(e,n.heading,n.tilt,t,r,i,a),void a.resolver.promise.then((function(t){return o.resolver.resolve(N(e,t,n.fov))}),(function(e){return o.resolver.reject(e)}))}var s=L(e,n.heading,n.tilt,t,r,i);return N(e,s,n.fov,o)}function D(e,t,r,n,i){return A(e).directionToHeadingTilt(t,r,n,i)}function L(e,t,n,i,o,a,u){var p=i&&i instanceof c?i:null;if(!z(u)){var d=function(e,t){var r=l.vec3f64.create();if(t&&t instanceof c){if(g.pointToVector(t,r,e.renderSpatialReference),null==t.z&&null!=e.basemapTerrain){var n=m.getElevationAtPoint(e.elevationProvider,t);null!=n&&e.renderCoordsHelper.setAltitude(n,r)}}else t?s.vec3.copy(r,t):s.vec3.copy(r,e.state.camera.center);return r}(e,i);return j(e,t,n,p,d,o,a,u)}(function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return i=l.vec3f64.create(),t?[3,1]:(s.vec3.copy(i,e.state.camera.center),[3,5]);case 1:return t instanceof c?(g.pointToVector(t,i,e.renderSpatialReference),null!=t.z||null==e.basemapTerrain?[3,3]:[4,e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,n)]):[3,4];case 2:return null!=(o=r.sent())&&e.renderCoordsHelper.setAltitude(o,i),[2,i];case 3:return[3,5];case 4:s.vec3.copy(i,t),r.label=5;case 5:return[2,i]}}))}))})(e,i,u.signal).then((function(r){j(e,t,n,p,r,o,a,u)}),(function(e){return u.resolver.reject(e)}))}function j(e,t,n,i,o,a,s,c){if(!i){var u=e.renderSpatialReference,p=M(e);i=g.vectorToPoint(o,u,p)}a=Math.max(a,e.state.constraints.minimumPoiDistance);var d=function(e,t,r,n,i,o){var a=0;return 1===o&&function(e,t,r){var n=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/n)/Math.LN2>8)return!0;var i=e.renderSpatialReference,o=M(e),a=g.vectorToPoint(t,i,o),s=g.vectorToPoint(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,i,o),l=Math.tan(.5*e.state.camera.fov)*n;return s.distance(a)/l>5}(e,n,i)?(t=0,a=function(e,t,r,n){var i=e.state.constraints.tilt(t);i.max=Math.min(i.max,.5*Math.PI);var o=i.min*(1-.7)+.7*i.max,a=F(e,n,t,r);return Math.min(a,o)}(e,i,r,n)):a=F(e,n,i,r),a=e.state.constraints.clampTilt(i,a),{heading:t,tilt:r=V(e,n,i,a)}}(e,t,n,o,a,s),h=(0,A(e).eyeForCenterWithHeadingTilt)(o,a,d.heading,d.tilt);if(1===s&&"global"===e.viewingMode&&n>0){var f=function(){var r=V(e,o,a,function(e,t,r,n){var i=e.state.constraints.tilt(t),o=F(e,n,t,r);return o=Math.min(o,.5*Math.PI),i.min*(1-.7)+.7*o}(e,a,n,o));return j(e,t,r,i,o,a,s=n-r<1?0:1,c)},v=e.map.ground.navigationConstraint;if(!v||"stay-above"===v.type){if(function(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,T,e.spatialReference)&&m.getElevationAtPoint(e.elevationProvider,T)>T.z-1)}(e,h.eye))return f();if(z(c))return void function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return e.renderCoordsHelper.fromRenderCoords(t,T,e.spatialReference)?[4,e.elevationProvider.queryElevation(T.x,T.y,T.z,T.spatialReference,n)]:[2,!1];case 1:return[2,r.sent()>T.z-1]}}))}))}(e,h.eye,c.signal).then((function(e){if(e)return f();c.resolver.resolve({eye:h.eye,up:h.up,center:l.vec3f64.clone(o),heading:h.heading,tilt:h.tilt})}))}}var y=!c||z(c)?{center:l.vec3f64.create(),eye:l.vec3f64.create(),up:l.vec3f64.create(),tilt:0,heading:0}:c;return y.eye=h.eye,y.up=h.up,y.center=l.vec3f64.clone(o),y.heading=h.heading,y.tilt=h.tilt,z(c)&&c.resolver.resolve(y),y}function V(e,t,r,n){return A(e).lookAtTiltToEyeTilt(n,t,r)}function F(e,t,r,n){return A(e).eyeTiltToLookAtTilt(n,t,r)}function N(e,t,r,i){var o=e.renderSpatialReference,a=M(e),s=g.vectorToPoint(t.eye,o,a);return s?i?(i.position=s,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new n(s,t.heading,t.tilt,r):null}function k(e){return{resolver:a.createResolver(),signal:e}}function z(e){return e&&"resolver"in e}t.headingTiltToDirectionUp=function(e,t,r,n,i){return A(e).headingTiltToDirectionUp(t,r,n,i)},t.externalToInternal=function(e,t){var r=e.renderSpatialReference,n=A(e).headingTiltToDirectionUp,i=l.vec3f64.create();if(!g.pointToVector(t.position,i,r))return null;var a=n(i,t.heading,t.tilt);s.vec3.scale(a.direction,a.direction,e.state.camera.distance),s.vec3.add(a.direction,a.direction,i);var c=d.cameraOnContentAlongViewDirection(e,i,a.direction,a.up);return c.fov=o.deg2rad(t.fov),c},t.internalToExternal=function(e,t,r){var i=e.renderSpatialReference,a=s.vec3.copy(S,t.viewForward),l=D(e,t.eye,a,t.up,P),p=M(e);return g.vectorToVector(t.eye,i,x,p)||(p=u.WGS84,g.vectorToVector(t.eye,i,x,p)),r?(r.position.x=x[0],r.position.y=x[1],r.position.z=x[2],r.position.spatialReference=p,r.heading=l.heading,r.tilt=l.tilt,r.fov=o.rad2deg(t.fov),r):new n(new c(x,p),l.heading,l.tilt,o.rad2deg(t.fov))},t.scaleToDistance=E,t.distanceToScale=I,t.fromCenterScale=function(e,t,r,n,i,o){return R(e,t,E(e,r,t.latitude),n,i,o)},t.fromCenterDistance=R,t.directionToHeadingTilt=D,t.getObserverForPointAtDistance=L,t.fromExtent=function(e,t,r,n,i,o){var a,s,l,u,p=0;if(null!=t.zmax&&null!=t.zmin&&(a=(t.zmax+t.zmin)/2,p=t.zmax-t.zmin),"global"===e.viewingMode){if(!_.isSpatialReferenceSupported(t.spatialReference,"global"))return z(o)&&o.resolver.reject(),null;var d=new c(t.xmin,t.ymin,t.spatialReference),h=new c(t.xmax,t.ymax,t.spatialReference),f=t.spatialReference.isGeographic?C:O;s=new c(f.center(d.x,h.x),(h.y+d.y)/2,t.spatialReference),null!=a&&(s.z=a);var m=v.getGreatCircleSpanAt(s,d,h);l=m.lon,u=m.lat,f.diff(d.x,h.x)>f.range/2&&(l+=v.halfEarthCircumference),l=Math.min(l,v.halfEarthCircumference),u=Math.min(u,v.halfEarthCircumference)}else{var y=M(e);l=t.xmax-t.xmin,u=t.ymax-t.ymin,s=new c({x:t.xmin+.5*l,y:t.ymin+.5*u,z:a,spatialReference:y})}var g=e.state.camera,b=1/Math.tan(g.fovX/2),x=1/Math.tan(g.fovY/2),w=1/Math.tan(g.fov/2),S=Math.max(.5*l*b,.5*u*x,.5*p*w)/1;if(z(o)){var P=k(o.signal);return L(e,r,n,s,S,i,P),void P.resolver.promise.then((function(t){return o.resolver.resolve(N(e,t,e.camera.fov))}),(function(e){return o.resolver.reject(e)}))}var T=L(e,r,n,s,S,i);return N(e,T,e.camera.fov,o)},t.toExtent=function(e,t,r){var n=e.renderSpatialReference,i=s.vec3.dist(t.eye,r),o=g.vectorToPoint(r,n,M(e)),a=2*i*Math.tan(t.fovX/2)*1,l=2*i*Math.tan(t.fovY/2)*1;return"global"===e.viewingMode?f.toExtent(e,o,a,l):h.toExtent(e,o,a,l)},t.observerToCamera=N,t.scaleToZoom=function(e,t){var r=e.basemapTerrain&&e.basemapTerrain.tilingScheme;if(r)return r.levelAtScale(t);b.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")},t.zoomToScale=function(e,t){var r=e.basemapTerrain&&e.basemapTerrain.tilingScheme;if(r)return r.scaleAtLevel(t);b.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")},t.scaleToResolution=function(e,t){return e.spatialReference?p.getResolutionForScale(t,e.spatialReference):void 0},t.computeScale=function(e,t,r){var i,o,a=e.renderSpatialReference;t||(t=e.state.camera);var l=u.WGS84;return t instanceof n?(i=t.position.latitude,g.pointToVector(t.position,x,a),g.pointToVector(r,w,a),o=s.vec3.distance(x,w)):(g.vectorToVector(t.center,a,w,l),i=w[1],o=t.distance),I(e,o,i)},t.createAsyncContext=k,t.isAsyncContext=z}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=i.vec3f64.create(),a=i.vec3f64.create();t.createDirectionUp=function(){return{direction:i.vec3f64.create(),up:i.vec3f64.create()}},t.directionToHeadingTilt=function(e,t,i,s,l){var c=o;n.vec3.normalize(c,e);var u=n.vec3.dot(c,s),p=u>0;(u=Math.abs(u))>.99&&((u=Math.abs(n.vec3.dot(t,s)))<.99?(n.vec3.copy(c,t),p&&n.vec3.scale(c,c,-1)):c=null);var d=0;if(c){n.vec3.scale(a,s,n.vec3.dot(s,c)),n.vec3.subtract(c,c,a);var h=n.vec3.dot(c,l)/(n.vec3.length(c)*n.vec3.length(l));n.vec3.cross(a,c,l),d=(n.vec3.dot(a,s)>0?1:-1)*r.rad2deg(r.acosClamped(h))}var f=r.rad2deg(r.acosClamped(-n.vec3.dot(s,e)/n.vec3.length(e)));return i?(i.heading=d,i.tilt=f,i):{heading:d,tilt:f}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(162),r(160),r(928),r(800)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,n,i,o){var a=e.call(this,t,r,n)||this;return a.sceneVelocity=i,a.direction=o,a}return r.__extends(t,e),t.prototype.value=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,t)},t}(a.Momentum);t.PanPlanarMomentum=s;var l=function(){function e(e,t,r){void 0===e&&(e=300),void 0===t&&(t=12),void 0===r&&(r=.84),this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.enabled=!0,this.time=new o.FilteredFiniteDifference(.6),this.screen=[new o.FilteredFiniteDifference(.4),new o.FilteredFiniteDifference(.4)],this.scene=[new o.FilteredFiniteDifference(.6),new o.FilteredFiniteDifference(.6),new o.FilteredFiniteDifference(.6)],this.tmpDirection=i.vec3f64.create()}return e.prototype.add=function(e,t,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(r)}},e.prototype.reset=function(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()},e.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,r=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)},e.prototype.createMomentum=function(e,t,r){n.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var i=n.vec3.length(this.tmpDirection);i>0&&n.vec3.scale(this.tmpDirection,this.tmpDirection,1/i);var o=i/this.time.filteredDelta;return new s(e,t,r,o,this.tmpDirection)},e}();t.PanPlanarMomentumEstimator=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.gain=e}return e.prototype.update=function(e){if(this.hasLastValue){var t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e},e.prototype.reset=function(){this.lastValue=void 0,this.filteredDelta=void 0},Object.defineProperty(e.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0}),e.prototype.computeDelta=function(e){return e-this.lastValue},e.prototype.updateDelta=function(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e},e}();t.FilteredFiniteDifference=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1198)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n,i){return void 0===t&&(t=3),void 0===r&&(r=.01),void 0===n&&(n=.95),void 0===i&&(i=12),e.call(this,t,r,n,i)||this}return r.__extends(t,e),t.prototype.add=function(t,r){if(this.value.hasLastValue){for(var n=this.value.lastValue,i=t-n;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;t=n+i}e.prototype.add.call(this,t,r)},t}(n.MomentumEstimator);t.RotationMomentumEstimator=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(800),r(1198)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return r.__extends(t,e),t.prototype.value=function(t){var r=e.prototype.value.call(this,t);return Math.exp(r)},t.prototype.valueDelta=function(t,r){var n=e.prototype.value.call(this,t),i=e.prototype.value.call(this,t+r)-n;return Math.exp(i)},t}(n.Momentum);t.ZoomMomentum=o;var a=function(e){function t(t,r,n,i){return void 0===t&&(t=2.5),void 0===r&&(r=.01),void 0===n&&(n=.95),void 0===i&&(i=12),e.call(this,t,r,n,i)||this}return r.__extends(t,e),t.prototype.add=function(t,r){e.prototype.add.call(this,Math.log(t),r)},t.prototype.createMomentum=function(e,t,r){return new o(e,t,r)},t}(i.MomentumEstimator);t.ZoomMomentumEstimator=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNewRenderStats=function(){return{triangles:0,drawCalls:0}},t.addToRenderStats=function(e,t,r){r&&(r.drawCalls+=e,r.triangles+=t)};var r=function(){function e(){this.materialRenderStats=new Map,this.reset()}return e.prototype.getMaterialRenderStatsObject=function(e){var t=this.materialRenderStats.get(e);return t||(t={triangles:0,drawCalls:0},this.materialRenderStats.set(e,t)),t},e.prototype.getAggregatedStats=function(){var e={materialRenderers:{},total:{triangles:0,drawCalls:0}};return this.materialRenderStats.forEach((function(t,r){e.materialRenderers[r]=t,e.total.drawCalls+=t.drawCalls,e.total.triangles+=t.triangles})),e},e.prototype.reset=function(){this.materialRenderStats.forEach((function(e){e.drawCalls=0,e.triangles=0}))},e}();t.RenderStatsAggregator=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(494),r(175)],void 0===(i=function(e,t,r,n,i){function o(e){e.include(n.RgbaFloatEncoding),e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadLinearDepth=o,function(e){e.bindUniforms=function(e,t){e.setUniform2fv("nearFar",t.nearFar)}}(o=t.ReadLinearDepth||(t.ReadLinearDepth={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NormalUtils=function(e,t){0===t.viewingMode?e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),0===t.viewingMode?e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PiUtils=function(e){e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n  "],["\n    const float PI = 3.141592653589793;\n  "])))),e.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "],["\n    const float PI = 3.141592653589793;\n    const float LIGHT_NORMALIZATION = 1.0 / PI;\n    const float INV_PI = 0.3183098861837907;\n    const float HALF_PI = 1.570796326794897;\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}return Object.defineProperty(e.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0}),e.prototype.load=function(e,t){var n=this;return 1===this._loadStatus?(e&&e(),this._loader):2===this._loadStatus?(t&&t(this._loadError),this._loader):(this._loader||(this._abortController=r.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then((function(){n._abortController=null,n._loadStatus=1}),(function(e){throw n._loadError=e,n._abortController=null,n._loadStatus=2,!r.isAbortError(e)&&n.logger&&e.message&&n.logger.warn(e.message),e}))),this._loader.then(e,t).catch((function(){})),this._loader)},e.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2),this._loader=null},e}();t.Loadable=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(193),r(356),r(442)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.fromValues(-.5,-.5,-.5,.5,.5,.5),s=n.fromValues(-.5,-.5,0,.5,.5,1),l=n.fromValues(-.5,-.5,0,.5,.5,.5);t.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},t.primitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return a;case"cylinder":case"cone":case"inverted-cone":return s;case"tetrahedron":return l;default:return void r.neverReached(e)}},t.primitiveGeometryData=function(e){switch(e){case"sphere":return o.createPolySphereGeometry(.5,2,!0);case"cube":return o.createBoxGeometry(1);case"cylinder":return o.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case"cone":return o.cgToGIS(o.createConeGeometry(1,.5,15,!1));case"inverted-cone":return o.cgToGIS(o.createConeGeometry(1,.5,15,!0));case"tetrahedron":return o.cgToGIS(o.createTetrahedronGeometry(1));case"diamond":return o.cgToGIS(o.createDiamondGeometry(1));default:return void r.neverReached(e)}},t.primitiveLodResources=function(e,t,n){var a=function(e,r,a){return void 0===a&&(a=!1),{levels:e.map((function(e,s){var l=r(e.tesselation);return a&&o.cgToGIS(l),{components:[{geometry:new i(l,n+"_lod"+s),material:t}],faceCount:l.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}}))}};switch(e){case"sphere":return a([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(function(e){return o.createPolySphereGeometry(.5,e,!0)}));case"cube":return a([{tesselation:0,minScreenSpaceRadius:0}],(function(){return o.createBoxGeometry(1)}));case"cone":return a(c,(function(e){return o.createConeGeometry(1,.5,e,!1)}),!0);case"inverted-cone":return a(c,(function(e){return o.createConeGeometry(1,.5,e,!0)}),!0);case"cylinder":return a(c,(function(e){return o.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])}));case"tetrahedron":return a([{tesselation:0,minScreenSpaceRadius:0}],(function(){return o.createTetrahedronGeometry(1)}),!0);case"diamond":return a([{tesselation:0,minScreenSpaceRadius:0}],(function(){return o.createDiamondGeometry(1)}),!0);default:return void r.neverReached(e)}};var c=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180)],void 0===(i=function(e,t,r){function n(e){var t=[];return e.components.forEach((function(e){t.push(e.geometry)})),r.unique(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.materialsFromLodResources=function(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){t.push(e.material)}))})),r.unique(t)},t.texturesFromLodResources=function(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){e.textures&&t.push.apply(t,e.textures)}))})),r.unique(t)},t.geometriesFromLodLevelResources=n,t.geometriesFromLodResources=function(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){t.push(e.geometry)}))})),r.unique(t)},t.computeFaceCount=function(e){var t=0;return n(e).forEach((function(e){t+=e.data.indexCount/3})),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(920),r(805),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s){var l,c,u,p,d,h,f,v,m,y,g;function _(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(i.AlignPixel),t.include(o.HUD,e),t.include(n.Slice,e),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),t.vertex.code.add(a.glsl(v||(v=r.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint = projectPositionHUD(projectAux);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint = proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize = lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n    }\n  "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint = projectPositionHUD(projectAux);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint = proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize = lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n    }\n  "])),e.occlusionTestEnabled?a.glsl(l||(l=r.__makeTemplateObject(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"],["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",e.screenSizePerspectiveEnabled?a.glsl(c||(c=r.__makeTemplateObject(["\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "],["\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):a.glsl(u||(u=r.__makeTemplateObject(["\n      vec2 screenOffsetScaled = screenOffset;\n        "],["\n      vec2 screenOffsetScaled = screenOffset;\n        "]))),e.depthHudEnabled?e.depthHudAlignStartEnabled?a.glsl(p||(p=r.__makeTemplateObject(["endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"],["endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):a.glsl(d||(d=r.__makeTemplateObject(["startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"],["startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",e.screenSizePerspectiveEnabled?a.glsl(h||(h=r.__makeTemplateObject(["\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "],["\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):a.glsl(f||(f=r.__makeTemplateObject(["\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n        "],["\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n        "]))))),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("borderColor","vec4"),t.fragment.code.add(a.glsl(g||(g=r.__makeTemplateObject(["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha = color.a * borderColor.a * coverage.y;\n      float colorAlpha = color.a * coverage.x;\n\n      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n    ","\n  }\n  "],["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha = color.a * borderColor.a * coverage.y;\n      float colorAlpha = color.a * coverage.x;\n\n      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n    ","\n  }\n  "])),e.depthHudEnabled?a.glsl(m||(m=r.__makeTemplateObject(["\n      if (finalAlpha < 0.01) {\n        discard;\n      }\n      "],["\n      if (finalAlpha < 0.01) {\n        discard;\n      }\n      "]))):a.glsl(y||(y=r.__makeTemplateObject(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor = vec4(finalRgb, finalAlpha);\n      "],["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor = vec4(finalRgb, finalAlpha);\n      "]))))),t},function(e){e.bindUniforms=function(e,t,r){_(e,"color",t.color);var n=r.pixelRatio||1;e.setUniform1f("pixelRatio",n),e.setUniform2f("screenOffset",t.screenOffset[0]*n,t.screenOffset[1]*n),null!==t.borderColor?(_(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",n)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))}}(t.LineCallout||(t.LineCallout={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(226),r(152),r(153),r(1212),r(418),r(1678),r(935),r(593)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=function(e){function t(t,r,n){var i=e.call(this)||this;return i._symbol=t,i._context=r,i._backgroundLayers=n,i._destroyed=!1,i.symbolLayers=[],i.referenced=0,i}return r.__extends(t,e),Object.defineProperty(t.prototype,"symbol",{get:function(){return this._symbol},set:function(e){if(this._symbol=e,this.symbolLayers)for(var t=0;t<e.symbolLayers.length;t++){var r=this.symbolLayers[t];i.isNone(r)||(r.symbol=e,r.symbolLayer=e.symbolLayers.items[t])}},enumerable:!0,configurable:!0}),t.prototype.doLoad=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a,s,c,u,p=this;return r.__generator(this,(function(h){switch(h.label){case 0:for(t=this._symbol.symbolLayers,this._backgroundLayers&&(t=this._backgroundLayers.concat(t)),a=t.length;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);for(this.symbolLayers.length=t.length,s=function(r){var n=t.getItemAt(r);if(!1===n.enabled)return"continue";d.renderPriority=1-(1+r)/a,d.renderPriorityStep=1/a,d.ignoreDrivers=n._ignoreDrivers;var i=l.make(c.symbol,n,c._context,d);o.onAbortOrThrow(e,(function(){p.symbolLayers[r]=null,i.destroy()})),c.symbolLayers[r]=i},c=this,u=0;u<a;u++)s(u);return[4,n.forEach(this.symbolLayers,(function(e,t){return r.__awaiter(p,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:if(!i.isSome(e))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.load()];case 2:return r.sent(),[3,4];case 3:return r.sent(),this.symbolLayers[t]=null,[3,4];case 4:return[2]}}))}))}))];case 1:if(h.sent(),o.throwIfAborted(e),this.symbolLayers.length&&!this.symbolLayers.some((function(e){return!!e})))throw new Error;return[2]}}))}))},t.prototype.getSymbolLayerSize=function(e){var t=this.symbolLayers[e];return i.isSome(t)?t.getCachedSize():null},t.prototype.createGraphics3DGraphic=function(e,t){for(var r=e.graphic,n=new Array(this.symbolLayers.length),o=0;o<this.symbolLayers.length;o++){var s=this.symbolLayers[o];n[o]=i.isSome(s)?s.createGraphics3DGraphic(e):null}var l=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new a(r,t||this,n,e.layer,l)},Object.defineProperty(t.prototype,"complexity",{get:function(){return u.totalSymbolComplexities(this.symbolLayers.map((function(e){return i.isSome(e)&&e.complexity})))},enumerable:!0,configurable:!0}),t.prototype.globalPropertyChanged=function(e,t){for(var r=this.symbolLayers.length,n=function(r){var n=o.symbolLayers[r];if(i.isSome(n)&&!n.globalPropertyChanged(e,t,(function(e){var t=e._graphics[r];return t instanceof s?t:null})))return{value:!1}},o=this,a=0;a<r;a++){var l=n(a);if("object"==typeof l)return l.value}return!0},t.prototype.applyRendererDiff=function(e,t){return 1===this.loadStatus&&this.symbolLayers.reduce((function(r,n){return r&&(i.isNone(n)||n.applyRendererDiff(e,t))}),!0)},t.prototype.prepareSymbolPatch=function(e){if(2!==this.loadStatus&&"partial"===e.diff.type){var t=e.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var r=t.symbolLayers.diff;this.symbolLayers.forEach((function(t,n){var o;if(!i.isNone(t)){var a=r[n];if(a){var s={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(s),(o=e.symbolStatePatches).push.apply(o,s.symbolLayerStatePatches),s.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((function(e,t){var r=e._graphics[n];i.isSome(r)&&s.graphics3DGraphicPatches.forEach((function(e){return e(r,t)}))}))}}}))}}},t.prototype.updateGeometry=function(e,t){for(var r=0;r<this.symbolLayers.length;r++){var n=this.symbolLayers[r];if(!i.isNone(n)){var o=e._graphics[r];if(i.isSome(o)&&!n.updateGeometry(o,t))return!1}}return!0},t.prototype.onRemoveGraphic=function(e){for(var t=0;t<this.symbolLayers.length;t++){var r=this.symbolLayers[t];if(!i.isNone(r)){var n=e._graphics[t];i.isSome(n)&&r.onRemoveGraphic(n)}}},t.prototype.getFastUpdateStatus=function(){var e=0,t=0,r=0;return this.symbolLayers.forEach((function(n){i.isNone(n)||(0===n.loadStatus?e++:n.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}},t.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var e=0,t=this.symbolLayers;e<t.length;e++){var r=t[e];i.isSome(r)&&r.destroy()}this.symbolLayers.length=0,this._destroyed=!0}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),t}(c.Loadable),d={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(159),r(152),r(1213),r(277),r(192),r(657),r(326),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){function u(e,t,r){for(var n=new Array,i=0,o=e;i<o.length;i++){var a=o[i],s=a.index,l=a.count;if(!(l<=1)){var c=3*s,u=c+3*l;n.push({index:s,count:l,position:t.subarray(c,u),mapPosition:r?r.subarray(c,u):void 0})}}return n}function p(e,t,r){for(var n=new Array,i=function(e,i,o,a){if(i<=1)return"continue";var s=3*e,l=s+3*i,c=o.map((function(t){return t-e}));n.push({index:e,count:i,holeIndices:c,pathLengths:a,position:t.subarray(s,l),mapPosition:r?r.subarray(s,l):void 0})},o=0,a=e;o<a.length;o++){var s=a[o];i(s.index,s.count,s.holeIndices,s.pathLengths)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.createColorGeometryData=function(e){var t={},r={};if(r[c.VertexAttrConstants.POSITION]={size:3,data:e.attributeData.position},t[c.VertexAttrConstants.POSITION]=e.indices,n.isSome(e.attributeData.color)){var i=new Uint32Array(e.indices.length);r[c.VertexAttrConstants.COLOR]={size:4,data:e.attributeData.color},t[c.VertexAttrConstants.COLOR]=i}return n.isSome(e.attributeData.mapPosition)&&(r.mapPos={size:3,data:e.attributeData.mapPosition},t.mapPos=e.indices),new l.GeometryData(r,t)},t.createWaterGeometryData=function(e){var t={},r={};return r[c.VertexAttrConstants.POSITION]={size:3,data:e.attributeData.position},t[c.VertexAttrConstants.POSITION]=e.indices,r[c.VertexAttrConstants.UV0]={size:2,data:e.attributeData.uv0},t[c.VertexAttrConstants.UV0]=e.indices,n.isSome(e.attributeData.mapPosition)&&(r.mapPos={size:3,data:e.attributeData.mapPosition},t.mapPos=e.indices),new l.GeometryData(r,t)},t.geometryAsPolygon=function(e){switch(e.type){case"extent":if(e instanceof r.Extent)return r.Polygon.fromExtent(e);break;case"polygon":return e}return null},t.geometryToRenderInfo=function(e,t,r,n){var a=i.pathsToTriangulationInfo(e.rings,e.hasZ,1),s=new Float64Array(a.position.length),l=o.applyPerVertexElevationAlignment(a.position,e.spatialReference,0,s,0,a.position,0,a.position.length/3,t,r,n),c=null!=l;return{position:a.position,mapPosition:s,polygons:p(a.polygons,a.position,s),outlines:u(a.outlines,a.position,s),projectionSuccess:c,sampledElevation:l}},t.geometryToRenderInfoDraped=function(e,t){for(var r=i.pathsToTriangulationInfo(e.rings,!1,1),n=a.bufferToBuffer(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3),o=2;o<r.position.length;o+=3)r.position[o]=s.DRAPED_Z;return{position:r.position,polygons:p(r.polygons,r.position),outlines:u(r.outlines,r.position),projectionSuccess:n}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(185),r(162),r(160),r(170),r(192),r(356),r(326),r(942),r(943),r(417),r(195),r(944)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){var v=0,m=function(){function e(){this.ROOT_ORIGIN_ID="rg_root_"+v++,this._origins=new Map,this._gridSize=42e5}return e.prototype.getOrigin=function(t){var n=this._origins.get(this.ROOT_ORIGIN_ID);if(null==n){if(r.isSome(e.testOrigin)){var o=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,p.fromValues(o[0],o[1],o[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var a=p.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,a),a}i.vec3.subtract(y,t,n.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]);var s=this._gridSize;if(y[0]<s&&y[1]<s&&y[2]<s)return n;var l=Math.round(t[0]/s),c=Math.round(t[1]/s),u=Math.round(t[2]/s),d="rg_"+l+"/"+c+"/"+u,h=this._origins.get(d);return h||(h=p.fromValues(l*s,c*s,u*s,d),this._origins.set(d,h)),h},e.prototype._drawOriginBox=function(e){var t=window.view,r=t._stage;if(null==this._object){this._material=new f({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),r.add(3,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});r.add(0,i),this._object=new d({idHint:"GridLocalOrigin",castShadow:!1}),r.add(1,this._object),i.addObject(this._object),r.addToViewContent([i.id])}for(var o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=o.length,v=new Float32Array(3*p),m=new Uint32Array(2*(p-1)),y=.5*this._gridSize,g=0;g<p;g++)v[3*g+0]=e[0]+(1&o[g]?y:-y),v[3*g+1]=e[1]+(2&o[g]?y:-y),v[3*g+2]=e[2]+(4&o[g]?y:-y),g>0&&(m[2*g+0]=g-1,m[2*g+1]=g);s.bufferToBuffer(v,a.WebMercator,0,v,t.spatialReference,0,p);var _={};_[h.VertexAttrConstants.POSITION]={size:3,data:v};var b={};b[h.VertexAttrConstants.POSITION]=m;var x=new c.GeometryData(_,b,"line"),w=new l(x,"GridLocalOriginBox");r.add(2,w),this._object.addGeometry(w,this._material,n.mat4f64.IDENTITY),console.log(this._origins.size,e)},e}(),y=o.vec3f64.create();return function(e){e.testOrigin=null}(m||(m={})),m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(190),r(160),r(534),r(1218)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(r,n,i){var a=e.call(this)||this;return a._parentStages=new Map,a._objects=new Set,a.id=t._idGen.gen(r),a.apiLayerUid=i,a.name=r,n=n||{},a.group=n.group||"",a.isVisible=null==n.isVisible||n.isVisible,a.isPickable=null==n.isPickable||n.isPickable,a.isSliceable=!1,a.translation=n.translation?o.vec3f64.clone(n.translation):o.vec3f64.create(),a}return r.__extends(t,e),t.prototype.addParentStage=function(e){if(!this._parentStages.has(e)){var t=this.on("dirty",(function(t){e.notifyDirty(t.origin,t.dirtyType,t.subObject)}));this._parentStages.set(e,t)}},t.prototype.removeParentStage=function(e){var t=this._parentStages.get(e);t&&(t.remove(),this._parentStages.delete(e)),this.invalidateSpatialQueryAccelerator()},t.prototype.getName=function(){return this.name},t.prototype.getGroup=function(){return this.group},t.prototype.getTranslation=function(){return this.translation},t.prototype.getObjectIds=function(){return n.keysOfSet(this._objects,(function(e){return e.id}))},t.prototype.getObjects=function(){return n.keysOfSet(this._objects)},t.prototype.addObject=function(e){this._objects.add(e),e.parentLayer=this,this.notifyDirty("layerObjectAdded",e),this._octree&&this._octree.add(e)},t.prototype.hasObject=function(e){return this._objects.has(e)},t.prototype.removeObject=function(e){return!!this._objects.delete(e)&&(e.parentLayer=null,this.notifyDirty("layerObjectRemoved",e),this._octree&&this._octree.remove(e),!0)},t.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},t.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._objects.size>50&&this._createOctree(),this._octree},t.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},t.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},t.prototype.notifyDirty=function(e,t,r,n){r=r||0;var i={origin:n||this,dirtyType:e,subObject:t};this.emit("dirty",i)},t.prototype._createOctree=function(){this._octree=new s({getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(n.keysOfSet(this._objects))},t._idGen=new a.IdGen,t}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(160)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.fromVector=function(e,t){return{vec3:r.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,n,i){return{vec3:r.vec3f64.fromValues(e,t,n),id:i}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(168),r(152),r(171),r(205),r(162),r(160),r(203),r(317),r(443),r(535),r(344),r(195),r(1219),r(249),r(372),r(446),r(945),r(945)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){var w=n.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),S=function(e){function t(t,r){var n=e.call(this,r)||this;return n.techniqueConfig=new x.RibbonLineTechniqueConfiguration,n.params=y.copyParameters(t,T),n.validateParams(),n.params.transparent=n.params.color[3]<1||n.params.transparent,n.layout=n.createLayout(),n}return r.__extends(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)if("cap"!==t){if("join"===t&&"round"===this.params[t]!=("round"===e[t])){w.error("join cannot be changed after creation");continue}if("stipplePattern"===t&&!!this.params[t]!=!!e[t]){w.error("stippledness cannot be changed after creation");continue}this.params[t]=e[t]}else w.error("cap cannot be changed after creation");this.validateParams(),this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getPassParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){this.techniqueConfig.output=e;var t=o.isSome(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=t&&o.isSome(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&o.isSome(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.renderOccluded,this.techniqueConfig},t.prototype.intersect=function(e,t,r,n,i,o,a,s,l){l?this.intersectDrapedLineGeometry(e,n,o,a):this.intersectLineGeometry(e,t,r,n,this.params.width,a)},t.prototype.intersectDrapedLineGeometry=function(e,t,r,n){if(t.options.selectionMode){var o=e.getAttribute(x.RibbonVertexAttributeConstants.POSITION).data,a=e.getAttribute(x.RibbonVertexAttributeConstants.SIZE),s=this.params.width;if(this.params.vvSizeEnabled){var l=e.getAttribute(x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0];s*=i.clamp(this.params.vvSizeOffset[0]+l*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else a&&(s*=a.data[0]);for(var c=r[0],u=r[1],p=(s/2+4)*e.pixelRatio,d=Number.MAX_VALUE,h=0;h<o.length-5;h+=3){var f=o[h],v=o[h+1],m=c-f,y=u-v,g=o[h+3]-f,_=o[h+4]-v,b=g*m+_*y,w=g*g+_*_,S=i.clamp(b/w,0,1),P=g*S-m,T=_*S-y,O=P*P+T*T;O<d&&(d=O)}d<p*p&&n()}},t.prototype.intersectLineGeometry=function(e,t,r,n,o,a){if(n.options.selectionMode&&!_.isInstanceHidden(t))if(v.isTranslationMatrix(r)){var c=e.data.getVertexAttr(),p=c[x.RibbonVertexAttributeConstants.POSITION].data,d=o;if(this.params.vvSizeEnabled){var h=c[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0];d*=i.clamp(this.params.vvSizeOffset[0]+h*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else c[x.RibbonVertexAttributeConstants.SIZE]&&(d*=c[x.RibbonVertexAttributeConstants.SIZE].data[0]);var f=n.camera,m=L;s.vec2.copy(m,n.point);var y=d*f.pixelRatio/2+4*f.pixelRatio;l.vec3.set(H[0],m[0]-y,m[1]+y,0),l.vec3.set(H[1],m[0]+y,m[1]+y,0),l.vec3.set(H[2],m[0]+y,m[1]-y,0),l.vec3.set(H[3],m[0]-y,m[1]-y,0);for(var g=0;g<4;g++)f.unprojectPoint(H[g],q[g]);u.plane.fromPoints(f.eye,q[0],q[1],W),u.plane.fromPoints(f.eye,q[1],q[2],J),u.plane.fromPoints(f.eye,q[2],q[3],Z),u.plane.fromPoints(f.eye,q[3],q[0],X);var b=Number.MAX_VALUE,S=this.params.isClosed?p.length-2:p.length-5;for(g=0;g<S;g+=3){E[0]=p[g]+r[12],E[1]=p[g+1]+r[13],E[2]=p[g+2]+r[14];var P=(g+3)%p.length;if(I[0]=p[P]+r[12],I[1]=p[P+1]+r[13],I[2]=p[P+2]+r[14],!(u.plane.signedDistance(W,E)<0&&u.plane.signedDistance(W,I)<0||u.plane.signedDistance(J,E)<0&&u.plane.signedDistance(J,I)<0||u.plane.signedDistance(Z,E)<0&&u.plane.signedDistance(Z,I)<0||u.plane.signedDistance(X,E)<0&&u.plane.signedDistance(X,I)<0)){if(f.projectPoint(E,j),f.projectPoint(I,V),j[2]<0&&V[2]>0){l.vec3.subtract(R,E,I);var T=f.frustum,O=-u.plane.signedDistance(T.planes[4],E)/l.vec3.dot(R,u.plane.normal(T.planes[4]));l.vec3.scale(R,R,O),l.vec3.add(E,E,R),f.projectPoint(E,j)}else if(j[2]>0&&V[2]<0)l.vec3.subtract(R,I,E),T=f.frustum,O=-u.plane.signedDistance(T.planes[4],I)/l.vec3.dot(R,u.plane.normal(T.planes[4])),l.vec3.scale(R,R,O),l.vec3.add(I,I,R),f.projectPoint(I,V);else if(j[2]<0&&V[2]<0)continue;j[2]=0,V[2]=0;var C=u.lineSegment.distance2(u.lineSegment.fromPoints(j,V,k),m);C<b&&(b=C,l.vec3.copy(F,E),l.vec3.copy(N,I))}}var M=n.rayBeginPoint,A=n.rayEndPoint;if(b<y*y){var U=Number.MAX_VALUE;if(u.lineSegment.closestLineSegmentPoint(u.lineSegment.fromPoints(F,N,k),u.lineSegment.fromPoints(M,A,z),D)){l.vec3.subtract(D,D,M);var B=l.vec3.length(D);l.vec3.scale(D,D,1/B),U=B/l.vec3.distance(M,A)}a(U,D)}}else w.error("intersection assumes a translation-only matrix")},t.prototype.computeAttachmentOrigin=function(e,t){var r=e.data,n="getVertexAttr"in r?r.getVertexAttr():"vertexAttr"in r?r.vertexAttr:null;if(!n)return null;var i=x.RibbonVertexAttributeConstants.POSITION,o="getVertexAttr"in r?r.getIndices(i):null,a=n[i];return d.computeAttachmentOriginLines(a,o,o&&this.params.isClosed,t)},t.prototype.createLayout=function(){var e=p.newLayout().vec3f(x.RibbonVertexAttributeConstants.POSITION).f32(x.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(x.RibbonVertexAttributeConstants.UV0).vec3f(x.RibbonVertexAttributeConstants.AUXPOS1).vec3f(x.RibbonVertexAttributeConstants.AUXPOS2);return this.params.vvSizeEnabled?e.f32(x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):e.f32(x.RibbonVertexAttributeConstants.SIZE),this.params.vvColorEnabled?e.f32(x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):e.vec4f(x.RibbonVertexAttributeConstants.COLOR),this.params.vvOpacityEnabled&&e.f32(x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE),e},t.prototype.createBufferWriter=function(){return new O(this.layout,this.params)},t.prototype.createRenderer=function(e,t){return new g(e,t,this,x.ribbonVertexAttributeLocations)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new P(e):void 0},t.prototype.validateParams=function(){"miter"!==this.params.join&&(this.params.miterLimit=0)},t}(f.Material),P=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(b.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return this.technique.configuration.occluder?3===e||10===e||11===e:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.occludeePipeline:this.technique.configuration.occluder?11===e?this.technique.occluderPipelineTransparent:10===e?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline},t}(h.GLMaterial),T=r.__assign({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},m.Default),O=function(){function e(e,t){if(this.params=t,this.numCapSubdivisions=0,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,!t.isClosed)switch(this.params.cap){case"butt":this.numCapSubdivisions=0;break;case"square":this.numCapSubdivisions=1;break;case"round":this.numCapSubdivisions=M}switch(this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=A}}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){var t=2*this.numCapSubdivisions+2,r=e.indices[x.RibbonVertexAttributeConstants.POSITION].length/2+1,n=this.params.isClosed,i=n?2:2*t,o=n?0:1,a=n?r:r-1;if(e.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS])for(var s=e.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data,l=o;l<a;++l)i+=4+2*s[l];else i+=(a-o)*(2*this.numJoinSubdivisions+4);return i+2},e.prototype.write=function(e,t,r,n){var i=this,o=U,a=B,s=G,c=t.vertexAttr[x.RibbonVertexAttributeConstants.POSITION].data,u=t.indices&&t.indices[x.RibbonVertexAttributeConstants.POSITION];u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var p=null;t.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(p=t.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var d=1,h=0;this.params.vvSizeEnabled?h=t.vertexAttr[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:t.vertexAttr[x.RibbonVertexAttributeConstants.SIZE]&&(d=t.vertexAttr[x.RibbonVertexAttributeConstants.SIZE].data[0]);var f=[1,1,1,1],v=0;this.params.vvColorEnabled?v=t.vertexAttr[x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:t.vertexAttr[x.RibbonVertexAttributeConstants.COLOR]&&(f=t.vertexAttr[x.RibbonVertexAttributeConstants.COLOR].data);var m=0;this.params.vvOpacityEnabled&&(m=t.vertexAttr[x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);var y=c.length/3,g=e.transformation,_=new Float32Array(r.buffer),b=this.vertexBufferLayout.stride/4,w=n*b,S=w,P=function(e,t,r,n,o,a){_[w++]=t[0],_[w++]=t[1],_[w++]=t[2],_[w++]=n,_[w++]=o,_[w++]=a,_[w++]=e[0],_[w++]=e[1],_[w++]=e[2],_[w++]=r[0],_[w++]=r[1],_[w++]=r[2],i.params.vvSizeEnabled?_[w++]=h:_[w++]=d,i.params.vvColorEnabled?_[w++]=v:(_[w++]=f[0],_[w++]=f[1],_[w++]=f[2],_[w++]=f[3]),i.params.vvOpacityEnabled&&(_[w++]=m)};w+=b,l.vec3.set(a,c[0],c[1],c[2]),g&&l.vec3.transformMat4(a,a,g);var T=this.params.isClosed;if(T){var O=c.length-3;l.vec3.set(o,c[O],c[O+1],c[O+2]),g&&l.vec3.transformMat4(o,o,g)}else{l.vec3.copy(o,a),l.vec3.set(s,c[3],c[4],c[5]),g&&l.vec3.transformMat4(s,s,g);for(var M=0;M<this.numCapSubdivisions;++M)P(o,a,s,D=1-M/this.numCapSubdivisions,1,-4),P(o,a,s,D,1,4);P(o,a,s,0,0,-4),P(o,a,s,0,0,4),l.vec3.copy(o,a),l.vec3.copy(a,s)}var A=T?y:y-1;for(M=T?0:1;M<A;M++){var E=(M+1)%y*3;l.vec3.set(s,c[E+0],c[E+1],c[E+2]),g&&l.vec3.transformMat4(s,s,g),P(o,a,s,0,1,-1),P(o,a,s,0,1,1);for(var I=p?p[M]:this.numJoinSubdivisions,R=0;R<I;++R)P(o,a,s,D=(R+1)/(I+1),1,-2),P(o,a,s,D,1,2);P(o,a,s,1,0,-2),P(o,a,s,1,0,2),l.vec3.copy(o,a),l.vec3.copy(a,s)}if(T)w=C(_,S+b,_,w,2*b);else for(P(o,a,s,0,1,-5),P(o,a,s,0,1,5),M=0;M<this.numCapSubdivisions;++M){var D;P(o,a,s,D=(M+1)/this.numCapSubdivisions,1,-5),P(o,a,s,D,1,5)}C(_,S+b,_,S,b),w=C(_,w-b,_,w,b)},e}();function C(e,t,r,n,i){for(var o=0;o<i;o++)r[n++]=e[t++];return n}var M=3,A=1,E=c.vec3f64.create(),I=c.vec3f64.create(),R=c.vec3f64.create(),D=c.vec3f64.create(),L=c.vec3f64.create(),j=a.createRenderScreenPointArray3(),V=a.createRenderScreenPointArray3(),F=c.vec3f64.create(),N=c.vec3f64.create(),k=u.lineSegment.create(),z=u.lineSegment.create(),U=c.vec3f64.create(),B=c.vec3f64.create(),G=c.vec3f64.create(),H=[a.createRenderScreenPointArray3(),a.createRenderScreenPointArray3(),a.createRenderScreenPointArray3(),a.createRenderScreenPointArray3()],q=[c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create()],W=u.plane.create(),J=u.plane.create(),Z=u.plane.create(),X=u.plane.create();return S}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(152),r(223),r(256),r(345),r(537),r(253),r(257),r(260),r(373),r(1220),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m){Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"},t.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};var y=function(e){function p(t,r){var n=e.call(this,t,r)||this;return n.stipplePattern=null,n.stippleTextureBind=null,n.stippleTextureRepository=t.stippleTextureRepository,n}return n.__extends(p,e),p.prototype.initializeProgram=function(e){var r=p.shader.get(),n=this.configuration,i=r.build({output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:n.stippleEnabled,stippleOffColorEnabled:n.stippleOffColorEnabled,stippleUVMaxEnabled:n.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:n.stippleIntegerRepeatsEnabled,roundCaps:n.roundCaps,roundJoins:n.roundJoins,vvColor:n.vvColor,vvSize:n.vvSize,vvInstancingEnabled:!0,vvOpacity:n.vvOpacity,falloffEnabled:n.falloffEnabled,innerColorEnabled:n.innerColorEnabled});return new v(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),t.ribbonVertexAttributeLocations)},p.prototype.dispose=function(){e.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},p.prototype.bindPass=function(e,t,r){if(4===this.configuration.output&&l.OutputHighlight.bindOutputHighlight(e,this.program,r),this.program.setUniform1f("intrinsicWidth",t.width),this.program.setUniform4fv("intrinsicColor",t.color),this.program.setUniform1f("miterLimit","miter"!==t.join?0:t.miterLimit),this.program.setUniform1f("nearPlane",r.nearFar[0]),this.program.setUniform1f("pixelRatio",r.pixelRatio),this.program.setUniform2fv("screenSize",[r.viewport[2],r.viewport[3]]),c.VisualVariables.bindUniformsWithOpacity(this.program,t),this.stipplePattern!==t.stipplePattern){var n=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.configuration.stippleEnabled){var a=o.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*r.pixelRatio:1;if(this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/a),this.configuration.stippleOffColorEnabled){var s=i.unwrap(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",t.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",i.unwrapOr(t.innerColor,t.color)),this.program.setUniform1f("innerWidth",t.innerWidth*r.pixelRatio))},p.prototype.bindDraw=function(e){s.Transform.bindUniforms(this.program,e),a.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},p.prototype.initializePipeline=function(){var e=this.configuration,t=m.separateBlendingParams(770,1,771,771),r=e.polygonOffset&&g;if(e.occluder&&(this._occluderPipelineTransparent=m.makePipelineState({blending:t,polygonOffset:r,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:null,stencilTest:h.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=m.makePipelineState({polygonOffset:r,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:m.defaultColorWriteParams,stencilWrite:h.stencilWriteMaskOff,stencilTest:h.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=m.makePipelineState({polygonOffset:r,depthTest:h.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:h.stencilWriteMaskOn,stencilTest:h.stencilToolMaskBaseParams})),0===e.output){var n=function(n){return m.makePipelineState({blending:t,polygonOffset:r,depthTest:h.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?n?h.stencilToolMaskBaseParams:e.sceneHasOcludees?h.stencilBaseAllZerosParams:null:null})};return this._occludeePipeline=n(!0),n(!1)}return m.makePipelineState({polygonOffset:r,depthTest:h.depthCompareLess,depthWrite:!e.transparent&&e.writeDepth&&m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})},Object.defineProperty(p.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0}),p.shader=new u.ReloadableShaderModule(f,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1220)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),p}(p.ShaderTechnique);t.RibbonLineTechnique=y;var g={factor:0,units:-4},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occluder=!1,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.roundCaps=!1,t.roundJoins=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.falloffEnabled=!1,t.innerColorEnabled=!1,t.sceneHasOcludees=!1,t}return n.__extends(t,e),n.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([d.parameter()],t.prototype,"occluder",void 0),n.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"sliceHighlightDisabled",void 0),n.__decorate([d.parameter()],t.prototype,"vertexColors",void 0),n.__decorate([d.parameter()],t.prototype,"transparent",void 0),n.__decorate([d.parameter()],t.prototype,"polygonOffset",void 0),n.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),n.__decorate([d.parameter()],t.prototype,"stippleEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"stippleOffColorEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"stippleIntegerRepeatsEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"roundCaps",void 0),n.__decorate([d.parameter()],t.prototype,"roundJoins",void 0),n.__decorate([d.parameter()],t.prototype,"vvSize",void 0),n.__decorate([d.parameter()],t.prototype,"vvColor",void 0),n.__decorate([d.parameter()],t.prototype,"vvOpacity",void 0),n.__decorate([d.parameter()],t.prototype,"falloffEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"innerColorEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(d.ShaderTechniqueConfiguration);t.RibbonLineTechniqueConfiguration=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpacePass=function(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "],["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    } \n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){return function(){function e(t,n){this._context=t,this._desc=n,this._glName=null,this._id=-1;var i=this._context.gl;r("esri-webgl-debug")&&this._context.instanceCounter.increment(5,this),this._id=++e._nextId,this._glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,n.internalFormat,n.width,n.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var r=this._context.gl,n=this._desc;n.width===e&&n.height===t||(n.width=e,n.height=t,this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,n.internalFormat,n.width,n.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context&&this._context.instanceCounter.decrement(5,this),this._context=null},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(242)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.glslifyDefineMap=function(e){var t="";for(var r in e){var n=e[r];if("boolean"==typeof n)n&&(t+="#define "+r+"\n");else if("number"==typeof n)t+="#define "+r+" "+n.toFixed()+"\n";else if("object"==typeof n){var i=n.options,o=0;for(var a in i)t+="#define "+i[a]+" "+(o++).toFixed()+"\n";t+="#define "+r+" "+i[n.value]+"\n"}}return t},t.createProgram=function(e,t,n,i){n=n||{},i=i||"";var o="function"==typeof t.shaders?t.shaders(n):t.shaders;return new r(e,i+o.vertexShader,i+o.fragmentShader,t.attributes)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(160),r(541),r(175),r(921)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.include(i.DoublePrecision,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var n=[o.glsl(l||(l=r.__makeTemplateObject(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "],["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),o.glsl(u||(u=r.__makeTemplateObject(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "],["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?o.glsl(c||(c=r.__makeTemplateObject(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"],["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),o.glsl(p||(p=r.__makeTemplateObject(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),o.glsl(d||(d=r.__makeTemplateObject(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangets?o.glsl(h||(h=r.__makeTemplateObject(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n      \n    }\n    "],["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n      \n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):o.glsl(f||(f=r.__makeTemplateObject([""],[""])))];e.vertex.code.add(n[0]),e.vertex.code.add(n[1]),e.vertex.code.add(n[2]),2===t.output&&e.vertex.code.add(n[3]),e.vertex.code.add(n[4])}Object.defineProperty(t,"__esModule",{value:!0}),t.InstancedDoublePrecision=s,function(e){e.Uniforms=function(){},e.bindCustomOrigin=function(e,t){a.encodeDoubleArraySplit(t,v,m,3),e.setUniform3fv("viewOriginHi",v),e.setUniform3fv("viewOriginLo",m)}}(s=t.InstancedDoublePrecision||(t.InstancedDoublePrecision={}));var l,c,u,p,d,h,f,v=n.vec3f64.create(),m=n.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(658),r(1233),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexTextureCoordinates=function(e,t){e.include(n.TextureCoordinateAttribute,t),e.fragment.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "],["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "],["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "])))),2===t.attributeTextureCoordinates&&(e.include(i.TextureAtlasLookup),e.fragment.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "],["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(795),r(175)],void 0===(i=function(e,t,r,n,i){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MixExternalColor=function(e,t){e.include(n.ColorConversion,t);var a=i.glsl(o||(o=r.__makeTemplateObject(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "],["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),i.glsl.int(1),i.glsl.int(2),i.glsl.int(3),i.glsl.int(2),i.glsl.int(3));switch(t.stages){case 0:e.vertex.code.add(a);break;case 1:e.fragment.code.add(a);break;default:e.vertex.code.add(a),e.fragment.code.add(a)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(916),r(1715),r(1716),r(1717),r(1718),r(1719),r(1720)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=n,t.mat4=i,t.scalar=o,t.vec2=a,t.vec3=s,t.vec4=l,t.createBuffer=function(e,t){return new e(new ArrayBuffer(t*e.ElementCount*r.elementTypeSize(e.ElementType)))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182),r(152),r(171),r(1167)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.fillStyle=this.colorToRGBA(e.color),this.haloStyle=this.colorToRGB(e.halo.color)}return e.prototype.colorToRGB=function(e){return"rgb("+e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString()+")"},e.prototype.colorToRGBA=function(e){return"rgba("+e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString()+","+e[3]+")"},e.fromSymbol=function(t,a){void 0===a&&(a=1);var s=n.get(t,"material","color"),l=n.isSome(s)?r.toUnitRGBA(s):o.ZEROS,c=t.halo;return new e({size:null!=t.size?i.pt2px(t.size):12,color:l,font:{family:t.font&&t.font.family?t.font.family:"sans-serif",weight:t.font&&t.font.weight?t.font.weight:"normal",style:t.font&&t.font.style?t.font.style:"normal"},halo:n.isSome(c)&&n.isSome(c.color)&&c.size>0?{size:i.pt2px(c.size),color:r.toUnitRGBA(c.color)}:{size:0,color:o.ZEROS},pixelRatio:a})},e}();t.TextRenderParameters=a,t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(156),r(151),r(163)],void 0===(i=function(e,t,r,n,i,o,a){var s=i.getLogger("esri.tasks.support.ProjectParameters");return function(e){function t(t){var r=e.call(this,t)||this;return r.geometries=null,r.outSpatialReference=null,r.transformation=null,r.transformForward=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"outSR",{get:function(){return s.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead."),this.outSpatialReference},set:function(e){s.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead."),this.outSpatialReference=e},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){var e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:a.getJsonType(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r},r.__decorate([o.property()],t.prototype,"geometries",void 0),r.__decorate([o.property({json:{read:{source:"outSR"}}})],t.prototype,"outSpatialReference",void 0),r.__decorate([o.property({json:{read:!1}})],t.prototype,"outSR",null),r.__decorate([o.property()],t.prototype,"transformation",void 0),r.__decorate([o.property()],t.prototype,"transformForward",void 0),r.__decorate([o.subclass("esri.tasks.support.ProjectParameters")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153),r(636),r(286)],void 0===(i=function(e,t,r,n,i){return function(){function e(e){if(e instanceof n.TilemapCache)this._tilemapCache=e;else{if(!e||!("index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}return e.prototype.dataKey=function(e,t){if(this._tilemapCache){var n=e.level,o=e.row,a=e.col,s=new i(e);return this._tilemapCache.fetchAvailabilityUpsample(n,o,a,s,t).then((function(){return s})).catch((function(e){if(r.isAbortError(e))throw e;return null}))}return this._getIndexedDataKey(e)},e.prototype.forEach=function(e,t,r,n,i){this._callback=i,this._maxLevel=t+e,this._forEach(this._tilemap,t,r,n)},e.prototype._forEach=function(e,t,r,n){0!==e&&(this._callback(t,r,n),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*r,2*n),this._forEach(e[1],t+1,2*r,2*n+1),this._forEach(e[2],t+1,2*r+1,2*n),this._forEach(e[3],t+1,2*r+1,2*n+1)))},e.prototype._getIndexedDataKey=function(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return r.resolve(null);for(var n=e;0!==n.level;)n=new i(n.level-1,n.row>>1,n.col>>1,n.world),t.push(n);var o,a,s=this._tilemap,l=t.pop();if(1===s)return r.resolve(l);for(;t.length;)if(a=(1&(o=t.pop()).col)+((1&o.row)<<1),s){if(0===s[a]){l=null;break}if(1===s[a]){l=o;break}l=o,s=s[a]}return r.resolve(l)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1785),r(1786),r(1787),r(206)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=r,e){case 0:this._layoutDefinition=i.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=i.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=i.StyleDefinition.fillLayoutDefinition,this._paintDefinition=i.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=i.StyleDefinition.lineLayoutDefinition,this._paintDefinition=i.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=i.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=i.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=i.StyleDefinition.circleLayoutDefinition,this._paintDefinition=i.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}return e.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=n.createFilter(this.filter)},e.prototype.getLayoutProperty=function(e){var t=this._layoutProperties;if(t)return t[e]},e.prototype.getPaintProperty=function(e){var t=this._paintProperties;if(t)return t[e]},e.prototype.getLayoutValue=function(e,t,r){var n,i=this._layoutProperties;if(i){var o=i[e];o&&(n=o.getValue(t,r))}var a=this._layoutDefinition[e];return void 0===n&&(n=a.default),"enum"===a.type?n=a.values.indexOf(n):"array"===a.type&&"enum"===a.value&&(n=n.map((function(e){return a.values.indexOf(e)}))),n},e.prototype.getPaintValue=function(e,t,r){var n,i=this._paintProperties;if(i){var o=i[e];o&&(n=o.getValue(t,r))}var a=this._paintDefinition[e];return void 0===n&&(n=a.default),"enum"===a.type&&(n=a.values.indexOf(n)),n},e.prototype.isPainterDataDriven=function(){var e=this._paintProperties;if(e)for(var t in e)if(e[t].isDataDriven)return!0;return!1},e.prototype._parseLayout=function(e){var t={};for(var r in e){var n=this._layoutDefinition[r];n&&(t[r]=new o(n,e[r]))}return t},e.prototype._parsePaint=function(e){var t={};for(var r in e){var n=this._paintDefinition[r];n&&(t[r]=new o(n,e[r]))}return t},e}();t.StyleLayer=s;var l=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return r.__extends(t,e),t}(s);t.BackgroundStyleLayer=l;var c=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this,o=i.getPaintProperty("fill-color");i.hasDataDrivenColor=!!o&&o.isDataDriven;var a=i.getPaintProperty("fill-opacity");i.hasDataDrivenOpacity=!!a&&a.isDataDriven,i.hasDataDrivenFill=i.hasDataDrivenColor||i.hasDataDrivenOpacity;var s=i.getPaintProperty("fill-outline-color");return i.outlineUsesFillColor=!s,i.hasDataDrivenOutlineColor=!!s&&s.isDataDriven,i.hasDataDrivenOutline=(s?i.hasDataDrivenOutlineColor:i.hasDataDrivenColor)||i.hasDataDrivenOpacity,i}return r.__extends(t,e),t}(s);t.FillStyleLayer=c;var u=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this,s=o.getPaintProperty("line-color");o.hasDataDrivenColor=!!s&&s.isDataDriven;var l=o.getPaintProperty("line-opacity");o.hasDataDrivenOpacity=!!l&&l.isDataDriven;var c=o.getPaintProperty("line-width");o.hasDataDrivenWidth=!!c&&c.isDataDriven,o.hasDataDrivenLine=o.hasDataDrivenColor||o.hasDataDrivenOpacity||o.hasDataDrivenWidth;var u=r.paint["line-width"];return u||(u=i.StyleDefinition.linePaintDefinition["line-width"].default),o.isThinLine=!o.hasDataDrivenWidth&&"number"==typeof u&&u<a.THIN_LINE_THRESHOLD,o}return r.__extends(t,e),t}(s);t.LineStyleLayer=u;var p=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this,o=i.getPaintProperty("icon-color");i.hasDataDrivenIconColor=!!o&&o.isDataDriven;var a=i.getPaintProperty("icon-opacity");i.hasDataDrivenIconOpacity=!!a&&a.isDataDriven;var s=i.getLayoutProperty("icon-size");i.hasDataDrivenIconSize=!!s&&s.isDataDriven,i.hasDataDrivenIcon=i.hasDataDrivenIconColor||i.hasDataDrivenIconOpacity||i.hasDataDrivenIconSize;var l=i.getPaintProperty("text-color");i.hasDataDrivenTextColor=!!l&&l.isDataDriven;var c=i.getPaintProperty("text-opacity");i.hasDataDrivenTextOpacity=!!c&&c.isDataDriven;var u=i.getLayoutProperty("text-size");return i.hasDataDrivenTextSize=!!u&&u.isDataDriven,i.hasDataDrivenText=i.hasDataDrivenTextColor||i.hasDataDrivenTextOpacity||i.hasDataDrivenTextSize,i}return r.__extends(t,e),t}(s);t.SymbolStyleLayer=p;var d=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this,o=i.getPaintProperty("circle-radius");i.hasDataDrivenRadius=!!o&&o.isDataDriven;var a=i.getPaintProperty("circle-color");i.hasDataDrivenColor=!!a&&a.isDataDriven;var s=i.getPaintProperty("circle-opacity");i.hasDataDrivenOpacity=!!s&&s.isDataDriven;var l=i.getPaintProperty("circle-stroke-width");i.hasDataDrivenStrokeWidth=!!l&&l.isDataDriven;var c=i.getPaintProperty("circle-stroke-color");i.hasDataDrivenStrokeColor=!!c&&c.isDataDriven;var u=i.getPaintProperty("circle-stroke-opacity");i.hasDataDrivenStrokeOpacity=!!u&&u.isDataDriven;var p=i.getPaintProperty("circle-blur");return i.hasDataDrivenBlur=!!p&&p.isDataDriven,i}return r.__extends(t,e),t}(s);t.CircleStyleLayer=d;t.LineLayout=function(e,t,r){this.cap=e.getLayoutValue("line-cap",t,r),this.join=e.getLayoutValue("line-join",t,r),this.miterLimit=e.getLayoutValue("line-miter-limit",t,r),this.roundLimit=e.getLayoutValue("line-round-limit",t,r)};t.IconLayout=function(e,t,r,n){this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t,n),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t,n),this.optional=e.getLayoutValue("icon-optional",t,n),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t,n),this.size=e.getLayoutValue("icon-size",t,n),this.rotate=e.getLayoutValue("icon-rotate",t,n),this.padding=e.getLayoutValue("icon-padding",t,n),this.keepUpright=e.getLayoutValue("icon-keep-upright",t,n),this.offset=e.getLayoutValue("icon-offset",t,n),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1)};t.TextLayout=function(e,t,r,n){this.allowOverlap=e.getLayoutValue("text-allow-overlap",t,n),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t,n),this.optional=e.getLayoutValue("text-optional",t,n),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t,n),this.fontArray=e.getLayoutValue("text-font",t,n),this.maxWidth=e.getLayoutValue("text-max-width",t,n),this.lineHeight=e.getLayoutValue("text-line-height",t,n),this.letterSpacing=e.getLayoutValue("text-letter-spacing",t,n),this.justify=e.getLayoutValue("text-justify",t,n),this.anchor=e.getLayoutValue("text-anchor",t,n),this.maxAngle=e.getLayoutValue("text-max-angle",t,n),this.size=e.getLayoutValue("text-size",t,n),this.rotate=e.getLayoutValue("text-rotate",t,n),this.padding=e.getLayoutValue("text-padding",t,n),this.keepUpright=e.getLayoutValue("text-keep-upright",t,n),this.transform=e.getLayoutValue("text-transform",t,n),this.offset=e.getLayoutValue("text-offset",t,n),this.writingMode=e.getLayoutValue("text-writing-mode",t,n),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(665)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"},o=function(){function e(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null),this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.scale=1,this.offset=[0,0],this.opacity=1,this.lij=e,this.source=t,this.width=r||t.width,this.height=n||t.height}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._memoryUsed=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||i},set:function(e){this._symbolizerParameters=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bandIds",{get:function(){return this._bandIds},set:function(e){var t=this;r.isSome(e)&&e.length>0?this._bandIds&&e.every((function(e,r){return!!t._bandIds[r]&&e===t._bandIds[r]}))||(this._bandIds=e,this._dirty=!0):this._bandIds=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interpolation",{get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===e?9729:9728)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)},enumerable:!0,configurable:!0}),e.prototype.bind=function(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(this._rasterTexture&&!this._dirty||this._updateRasterTexture(e,this.bandIds),this._rasterTexture&&(this._updateColormapTexture(e),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=n.createTransformTexture(e,this.transformGrid))),!0)},e.prototype.getUniforms=function(){var e=n.getBasicGridUniforms(this.scale,this.offset),t=this,r=t.symbolizerParameters,i=t.transformGrid,o=t.width,a=t.height,s=t.opacity;return{basic:e,common:n.getCommonUniforms(i,[o,a],[this.source.width,this.source.height],s),colormap:r.colormap?n.getColormapUniforms(r.colormap,r.colormapOffset):null,stretch:"stretch"===this.symbolizerParameters.type?n.getStretchUniforms(this.symbolizerParameters):null,hillshade:"hillshade"===this.symbolizerParameters.type?n.getShadedReliefUniforms(this.symbolizerParameters):null}},e.prototype.getTextures=function(){if(!this._rasterTexture)return null;var e=[],t=[];return this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap")),{names:e,textures:t}},e.prototype.getMemoryUsage=function(){if(r.isNone(this._memoryUsed)){var e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((function(e){return e.descriptor.width*e.descriptor.height*4})).reduce((function(e,t){return e+t}))}return this._memoryUsed},e.prototype.release=function(){return this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null),this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null),this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0},e.prototype._updateRasterTexture=function(e,t){var i=this.source?this.source.extractBands(t):null;if(i&&i.pixels&&i.pixels.length>0){var o=r.isNone(t)&&r.isNone(this.bandIds)||r.isSome(t)&&r.isSome(this.bandIds)&&t.join("")===this.bandIds.join("");if(this._rasterTexture){if(o)return;this._rasterTexture.dispose(),this._rasterTexture=null}this._rasterTexture=n.createRasterTexture(e,i,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)},e.prototype._updateColormapTexture=function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=n.createColormapTexture(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=n.createColormapTexture(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))},e}();t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._texture=e,this._refCount=1}return e.prototype.retain=function(){++this._refCount},e.prototype.release=function(){--this._refCount,0===this._refCount&&this._texture.dispose()},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),e.prototype.generateMipmap=function(){this._texture.generateMipmap()},Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._texture.descriptor},enumerable:!0,configurable:!0}),e}();t.TileTexture=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(151),r(1276)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new i,r}return r.__extends(t,e),t.prototype.destroy=function(){a.default(this,"handles")},r.__decorate([o.property({constructOnly:!0})],t.prototype,"renderCoordsHelper",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"surface",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"state",void 0),r.__decorate([o.subclass("esri.views.3d.support.PointOfInterest")],t)}(n);t.PointOfInterest=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(168),r(153),r(205),r(216),r(162),r(160),r(245),r(201),r(173),r(664),r(815),r(1279),r(1281),r(1282),r(957),r(415),r(375),r(816),r(1804),r(958),r(454),r(341)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){Object.defineProperty(t,"__esModule",{value:!0});var T=_.weakAssert,O=l.vec3f64.create(),C=l.vec3f64.create(),M=l.vec3f64.create(),A=u.vec4f64.create();t.SplitLimits=function(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0};var E=function(){function e(e){this._numSubdivisionAtLevel=e,this.lij=[0,0,0],this._children=[null,null,null,null],this._dirty=!0,this._previouslyRendered=!1,this.extent=p.create(),this._elevationBounds=a.vec2f64.create(),this.layerInfo=new Array(2),this.extentInRadians=p.create(),this.centerAtSeaLevel=l.vec3f64.create(),this._center=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create()],this.up=l.vec3f64.unitZ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._maxTesselation=0,this._usedMemory=L,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._radius=0,this._curvatureHeight=0}return Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._usedMemory===L&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cachedMemory",{get:function(){return this.isCached?this.mapTileMemory:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapTileMemory",{get:function(){this._usedMemory===L&&this._updateMemoryUsed();for(var e=this._mapTileMemory,t=0,r=this.layerInfo[1];t<r.length;t++){var n=r[t].data;n instanceof d.VectorTile&&(e+=n.getMemoryUsage())}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCached",{get:function(){return!this.shouldRender&&this._mapDataRefCount<=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingArea",{get:function(){return this._clippingArea},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenDepth",{get:function(){return this._screenDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){if(this._dirty){var e=this._isVisible();e!==this._visible&&(this._visible=e,this.updateAgentSuspension(),this.surface.emit("tiles-visibility-changed"),this.surface.renderer.setNeedsRender()),this._dirty=!1}return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rendered",{get:function(){var e=!!this.renderData;return e!==this._previouslyRendered&&(this.surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this.surface.renderer.setNeedsRender()),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(0===this.surface.lodSnapping){var e=this.level-this._surface.snapLevel;if(0===e)return!0;if(1===e)return!1}return this.isLeaf},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(S.tile2str(this)),this._edgeLen=0,this._edgeLen2=0,this._radius=0,this.vlevel=e?e[0]:0,t&&t._elevationBounds?o.vec2.copy(this._elevationBounds,t.elevationBounds):o.vec2.set(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=r,this.updateVisibility();for(var n=0;n<2;n++){var i=r.numLayers(n),a=this.layerInfo[n];this.layerInfo[n]?a.length=i:(a=new Array(i),this.layerInfo[n]=a);for(var s=0;s<i;s++)a[s]=x.TilePerLayerInfo.makeEmptyLayerInfo(n,this._surface.upsampleInfoPool,a[s]),0===n&&this.findElevationBoundsForLayer(s,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,g.MAX_PATCH_TESSELATION)},e.prototype.release=function(){T(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(S.tile2str(this));for(var e=0;e<2;e++)for(var t=0,r=this.layerInfo[e];t<r.length;t++)r[t].dispose();this._parent=null,this._surface=null,this._usedMemory=L},e.prototype.refMapData=function(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(S.tile2str(this))},e.prototype.unrefMapData=function(){if(--this._mapDataRefCount,this.isCached){var e=this.cachedMemory;e>0&&(this._surface.upsampleMapCache.put(S.tile2str(this),this,e),this.setMemoryDirty())}},e.prototype.setMemoryDirty=function(){this._usedMemory=L},Object.defineProperty(e.prototype,"cpuImageMemorySize",{get:function(){var e=this._surface.tilingScheme.pixelSize;return e*e*4},enumerable:!0,configurable:!0}),e.prototype._updateMemoryUsed=function(){this._usedMemory=0,this._mapTileMemory=0;for(var e=this.cpuImageMemorySize,t=0,r=this.layerInfo[1];t<r.length;t++){var n=(a=r[t]).data;n instanceof w.TileTexture?this._mapTileMemory+=P.getGpuMemoryUsage(n.texture):n instanceof HTMLImageElement||n instanceof h.ImageWithType?this._mapTileMemory+=e:n instanceof y.default&&(this._mapTileMemory+=n.getMemoryUsage())}for(var i=0,o=this.layerInfo[0];i<o.length;i++){var a=o[i];this._usedMemory+=a.data?e:0}if(this.renderData){this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage;var s=this.renderData.textureDescriptor;s&&(this._mapTileMemory+=P.getGpuMemoryUsage(s))}this.isCached&&this._surface.upsampleMapCache.updateSize(S.tile2str(this),this,this.cachedMemory)},e.prototype.getUsedMemoryForLayer=function(e,t){var r=this.layerInfo[e][t];if(!r||!r.data)return 0;if(1!==e||this.isCached){if(0===e)return this.cpuImageMemorySize}else{var n=r.data;if(n instanceof w.TileTexture)return P.getGpuMemoryUsage(n.texture);if(n instanceof HTMLImageElement||n instanceof h.ImageWithType)return this.cpuImageMemorySize;if(n instanceof d.VectorTile||n instanceof y.default)return n.getMemoryUsage()}return 0},e.prototype.updateScreenDepth=function(e){s.vec3.copy(A,this._center[0]),A[3]=1,c.vec4.transformMat4(A,A,e),this._screenDepth=A[2]<0?0:A[2]/A[3]},e.prototype.shouldSplit=function(e,t,r){var i=this.level;s.vec3.subtract(O,this._center[0],t);var o=s.vec3.squaredLength(O),a=0;s.vec3.subtract(C,this._center[1],t);var l=s.vec3.squaredLength(C);l<o&&(o=l,a=1),s.vec3.subtract(C,this._center[2],t);var c=s.vec3.squaredLength(C);if(c<o&&(o=c,a=2),this._edgeLen2>o&&i<e.maxLod)return 2;if(0===r&&1==this._surface.snapLevel-i)return 2;var u=Math.sqrt(o),p=s.vec3.dot(this.up,O),d=this._elevationBounds[1]-this._elevationBounds[0],h=d/this.edgeLen;if(e.aboveGround&&p>0&&h<.001&&p/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-h>0)return 0;var f=e.fovX*u*2,v=this._edgeLen/f;if(v<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,4):0;if(i>=e.maxLod){var m=i+Math.ceil(-n.log2(e.relativeWidthLimit/v));return m!==this.vlevel?(this.vlevel=m,4):1}if(i>6){s.vec3.subtract(C,this._center[a],t),s.vec3.scale(M,this.up,p),s.vec3.subtract(M,M,C);var y=s.vec3.squaredLength(M);if(y>this._radius*this._radius){s.vec3.scale(M,M,this._radius/Math.sqrt(y)),s.vec3.add(M,M,this._center[a]),s.vec3.subtract(M,t,M);var g=Math.min(1,(Math.abs(s.vec3.dot(M,this.up))+.5*d+this._curvatureHeight)/s.vec3.length(M)),_=.1/e.angledSplitBias,b=e.fovY*u*2;if(g*(this._edgeLen/b)<_*e.relativeHeightLimit)return 0}}return 2},e.prototype.setChildren=function(e,t,r,n){T(!!(e&&t&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=r,this._children[3]=n},e.prototype.unsetChildren=function(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null},e.prototype.load=function(e){this.refMapData();for(var t=0;t<2;t++)this.layerInfo[t]&&this._createOrUpdateAgents(0,t);e.loadTile(this)},e.prototype.unload=function(e){e.unloadTile(this);for(var t=0;t<2;t++)for(var r=0,n=this.layerInfo[t];r<n.length;r++){var i=n[r];i.loadingAgent&&i.loadingAgent!==b.TILE_AGENT_DONE&&(R(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0}this.resetPendingUpdate(32),this.resetPendingUpdate(64),this.unrefMapData()},e.prototype.unloadMapData=function(){for(var e=0,t=this.layerInfo[1];e<t.length;e++){var r=t[e];r.loadingAgent&&r.loadingAgent!==b.TILE_AGENT_DONE&&(R(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()},e.prototype.updateClippingStatus=function(e){if(p.equals(e,this._clippingArea))return!1;var t=this._intersectsClippingArea,r=this._isWithinClippingArea;e?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this.isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();var n=r&&this._isWithinClippingArea,i=!(r||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||i||this.setPendingUpdate(32),!0},e.prototype.updateVisibility=function(){this._dirty=!0,this._surface.setPendingUpdates()},e.prototype.getLayerInfo=function(e,t){return this.layerInfo[t][e]},e.prototype.hasLayerData=function(e,t){var r=this.layerInfo[t][e];return!(!r||!r.data||r.dataInvalidated)},Object.defineProperty(e.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var e=0;e<2;e++)for(var t=0,r=this.layerInfo[e];t<r.length;t++){var n=r[t];if(n.loadingAgent&&n.loadingAgent!==b.TILE_AGENT_DONE&&n.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.isSuspended=function(e){return!!this.hasPendingUpdate(2)||0!==e&&!this.visible},Object.defineProperty(e.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0}),e.prototype.hasPendingUpdate=function(e){return(this._pendingUpdates&e)===e},e.prototype.setPendingUpdate=function(e){this._pendingUpdates|=e,this._surface.setPendingUpdates()},e.prototype.resetPendingUpdate=function(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)},e.prototype.requestLayerData=function(e,t,r){g.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),t,e,r.tile.lij.toString());var n=this.layerInfo[t][e];if(n.waitingAgents.indexOf(r)>-1)return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),r.dataArrived(this),!0;if(n.requestPromise)return!0;n.requestAbort=i.createAbortController();var o=this._surface.requestTileData(this,e,t,n.requestAbort);if(!o)return n.requestAbort=null,!1;var a=function(){n.requestPromise===o&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=o,o.then(a,a),!!n.requestPromise},Object.defineProperty(e.prototype,"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0}),e.prototype.hasLij=function(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]},e.prototype.findByLij=function(e){return this.hasLij(e)?this:this.isLeaf?null:this._children[0].findByLij(e)||this._children[1].findByLij(e)||this._children[2].findByLij(e)||this._children[3].findByLij(e)||null},e.prototype.distanceToSquared=function(e){return s.vec3.squaredLength(s.vec3.subtract(M,this._center[0],e))},e.prototype.containsPoint=function(e){var t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]},e.prototype.unrequestLayerData=function(e,t,n){g.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),t,e,n.tile.lij.toString());var i=this.layerInfo[t][e],o=i.waitingAgents,a=null!=r.removeUnordered(o,n);T(a,"agent has not requested this piece of map data"),o.length<1&&(i.abortRequest(),g.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),t,e),this._updateMemoryUsed())},e.prototype.dataArrived=function(e,t,r){var n=this.layerInfo[t][e];n.data=r,n.dataInvalidated=!1;for(var i=0;i<n.waitingAgents.length;i++)n.waitingAgents[i].dataArrived(this);n.waitingAgents.length=0,this._updateMemoryUsed()},e.prototype.dataMissing=function(e,t,r){r.notInTilemap||console.error("Tile "+this.lij.toString()+" layer "+t+"/"+e+" error "+r);var n=this.layerInfo[t][e];n.dataMissing=!0;for(var i=0;i<n.waitingAgents.length;i++)n.waitingAgents[i].dataMissing();n.waitingAgents.length=0,this._updateMemoryUsed()},e.prototype.updateRenderData=function(e){switch(e){case 1:return this.updateTexture();case 0:return this.updateGeometry()}},e.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)},e.prototype.updateGeometry=function(){this.setPendingUpdate(32);for(var e=0,t=this.layerInfo[0];e<t.length;e++)t[e].pendingUpdates|=32},e.prototype.invalidateLayerData=function(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)},e.prototype.computeElevationBounds=function(){o.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var e=!0,t=0,r=this.layerInfo[0];t<r.length;t++){var n=r[t];n.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],n.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],n.elevationBounds.max),n.elevationBounds.hasNoDataValues||(e=!1))}e&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0)),this.updateRadiusAndCenter()},e.prototype._updateCenter=function(){var e=.5*(this._elevationBounds[0]+this._elevationBounds[1]);s.vec3.scale(M,this.up,e),s.vec3.add(this._center[0],this.centerAtSeaLevel,M),s.vec3.scale(M,this.up,this._elevationBounds[0]),s.vec3.add(this._center[1],this.centerAtSeaLevel,M),s.vec3.scale(M,this.up,this._elevationBounds[1]),s.vec3.add(this._center[2],this.centerAtSeaLevel,M)},e.prototype.findElevationBoundsForLayer=function(e,t){var r=this.layerInfo[0][e];if(!r.elevationBounds||r.elevationBounds.level<t){var n=this._surface.layerViewByIndex(e,0),i=_.getLayerWithExtentRange(n);if(S.fallsWithinLayer(this,i,!1)){var o=D,a=!1;if(r.data){var s=r.data;o.min=s.bounds[0],o.max=s.bounds[1],o.hasNoDataValues=s.hasNoDataValues,o.level=this.lij[0],a=!0}else{for(var l=0,c=void 0,u=(s=void 0,this._parent);u&&(!s||l<g.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&(l=this.vlevel-u.level,c=s||c,!(!(s=u.layerInfo[0][e].data)&&c&&l>=g.ELEVATION_DESIRED_RESOLUTION_LEVEL));u=u._parent);(s=s||c)&&(s.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=s.level,a=!0))}a&&(r.elevationBounds||(r.elevationBounds=new f.ElevationBounds),r.elevationBounds.copyFrom(o))}}},e.prototype.modifyLayers=function(e,t,r){for(var n=this.layerInfo[r],i=0,o=n;i<o.length;i++){var a=o[i];a.loadingAgent&&a.loadingAgent!==b.TILE_AGENT_DONE&&(R(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.length=0}if(1===r)for(var s=0;s<n.length;++s)void 0===e[s]&&n[s].dispose();var l=t.length,c=new Array(l);for(s=0;s<l;s++){var u=t[s];c[s]=u>-1?n[u]:x.TilePerLayerInfo.makeEmptyLayerInfo(r,this._surface.upsampleInfoPool)}this.layerInfo[r]=c,this._updateMemoryUsed()},e.prototype.restartAgents=function(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e))},e.prototype.updateAgents=function(e){if(this.renderData){for(var t=this.layerInfo[e],r=0;r<t.length;r++){var n=t[r];n.loadingAgent===b.TILE_AGENT_DONE&&(n.loadingAgent=null)}this._createOrUpdateAgents(0,e)}},e.prototype.updateAgentSuspension=function(){for(var e=0;e<2;e++)for(var t=this.isSuspended(e),r=0,n=this.layerInfo[e];r<n.length;r++){var i=n[r];i.loadingAgent&&i.loadingAgent!==b.TILE_AGENT_DONE&&(i.loadingAgent.setSuspension(t),i.loadingAgent===b.TILE_AGENT_DONE&&this.updateRenderData(e))}},e.prototype.removeLayerAgent=function(e,t){var r=this.layerInfo[t][e];r.loadingAgent&&r.loadingAgent!==b.TILE_AGENT_DONE&&r.loadingAgent.dispose(),r.loadingAgent=null},e.prototype.agentDone=function(e,t){var r=this.layerInfo[t][e];r.loadingAgent=b.TILE_AGENT_DONE,r.data||r.upsampleInfo||this._createOrUpdateAgents(e+1,t)},e.prototype._createOrUpdateAgents=function(e,t){for(var r=this.isSuspended(t),n=this.layerInfo[t],i=e;i<n.length;++i){var o=n[i],a=!1,s=this._surface.layerViewByIndex(i,t),l=_.getLayerWithExtentRange(s);if(o.loadingAgent?S.fallsWithinLayer(this,l,!1)?(o.loadingAgent!==b.TILE_AGENT_DONE&&(g.TILE_LOADING_DEBUGLOG&&console.log(S.tile2str(this),"update suspended",r),o.loadingAgent.setSuspension(r)),o.loadingAgent!==b.TILE_AGENT_DONE&&(a=o.loadingAgent.update(),g.TILE_LOADING_DEBUGLOG&&console.log(S.tile2str(this),"update"))):o.dispose():S.fallsWithinLayer(this,l,!1)&&(o.loadingAgent=I(this,i,t,r),a=o.loadingAgent.startLoading(),g.TILE_LOADING_DEBUGLOG&&console.log(S.tile2str(this),"start"),a?o.loadingAgent===b.TILE_AGENT_DONE&&(g.TILE_LOADING_DEBUGLOG&&console.log(S.tile2str(this),"done"),this.setPendingUpdate(32)):(R(o.loadingAgent),o.loadingAgent=b.TILE_AGENT_DONE,g.TILE_LOADING_DEBUGLOG&&console.log(S.tile2str(this),"done"))),o.loadingAgent===b.TILE_AGENT_DONE&&this.updateRenderData(t),a&&s.isOpaque)return}},e.prototype.isWithinExtent=function(e){var t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]},e.prototype.intersectsExtent=function(e){var t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]},Object.defineProperty(e.prototype,"test",{get:function(){return{cachedMemory:this.cachedMemory}},enumerable:!0,configurable:!0}),e}();function I(e,t,r,n){var i=0===r?v.Pool.acquire():m.Pool.acquire();return i.init(e,t,r,n),i}function R(e){e.dispose(),e instanceof v?v.Pool.release(e):e instanceof m&&m.Pool.release(e)}t.Tile=E;var D=new f.ElevationBounds,L=-1}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(317)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createVertexBufferLayout=function(e){var t=r.newLayout().vec3f("position");return e.normals&&t.vec2i16("normalCompressed",{glNormalized:!0}),1===e.textureCoordinates?t.vec2f("uv0"):2===e.textureCoordinates&&(t.vec2f("uv0"),t.vec4u16("uvRegion",{glNormalized:!0})),e.colors&&t.vec4u8("color",{glNormalized:!0}),t.alignTo(4)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(276),r(201),r(963),r(223),r(449),r(345),r(497),r(802),r(541),r(253),r(257),r(260),r(373),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){Object.defineProperty(t,"__esModule",{value:!0}),t.TextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9};var b=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.bindPass=function(e,r){var n=this.program;c.VertexPosition.bindViewProjTransform(n,r.viewTransform),l.Slice.bindUniforms(this.program,this.configuration,r.slicePlane),0===r.identifier&&void 0!==r.ssrParams&&(r.ssrParams.lastFrameColorTextureID=t.TextureUnits.LAST_FRAME_COLOR,r.ssrParams.linearDepthTextureID=t.TextureUnits.PREPASS_LINEAR_DEPTH,d.ScreenSpaceReflections.bindUniforms(this.program,e,r.ssrParams)),0===r.identifier&&(n.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",r.transformNormal_ViewFromGlobal),1===r.subPass&&n.setUniform2fv("uCameraNearFar",r.cameraNearFar),0===r.subPass&&(r.ambientOcclusionEnabled&&r.ambientOcclusion.bind(n,t.TextureUnits.SSAO),r.shadowsEnabled&&r.shadowMap.bind(n,t.TextureUnits.SHADOW_MAP),r.lighting.setUniforms(this.program,r.integratedMesh))),1===r.identifier&&this.program.setUniform2fv("uCameraNearFar",r.cameraNearFar),2===r.identifier&&u.OutputHighlight.bindOutputHighlight(e,this.program,r)},o.prototype.bindDraw=function(e,t){if(c.VertexPosition.bindModelTransform(this.program,e),this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",e.transformNormal_GlobalFromModel),t.isIntegratedMesh){var r=t.overlayTexScale,n=t.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[e.toMapSpace[0]*r[0]+n[0],e.toMapSpace[1]*r[1]+n[1],e.toMapSpace[0]*r[2]+n[2],e.toMapSpace[1]*r[3]+n[3]]),this.program.setUniform4fv("overlayTexScale",[e.toMapSpace[2]*r[0],e.toMapSpace[3]*r[1],e.toMapSpace[2]*r[2],e.toMapSpace[3]*r[3]])}},o.prototype.bindMaterial=function(e,r,n){var o=this.program;o.setUniform4fv("uBaseColor",r.baseColor),o.setUniform1f("uObjectOpacity",r.objectOpacity),o.setUniform1f("textureAlphaCutoff",r.alphaCutoff),1===r.componentParameters.type?r.componentParameters.texture.bind(o,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:t.TextureUnits.COMPONENT_COLOR}):(o.setUniform4fv("uExternalColor",r.componentParameters.externalColor),o.setUniform1i("uExternalColorMixMode",r.componentParameters.externalColorMixMode)),i.isSome(r.baseColorTexture)&&r.baseColorTexture.bind(e,o,"uBaseColorTexture",t.TextureUnits.DIFFUSE,"uBaseColorTextureSize"),0===this.configuration.output&&(p.PhysicallyBasedRenderingParameters.bindUniforms(this.program,r),i.isSome(r.metallicRoughnessTexture)&&r.metallicRoughnessTexture.bind(e,o,"texMetallicRoughness",t.TextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),i.isSome(r.emissionTexture)&&r.emissionTexture.bind(e,o,"texEmission",t.TextureUnits.EMISSION,"texEmissionSize"),i.isSome(r.occlusionTexture)&&r.occlusionTexture.bind(e,o,"texOcclusion",t.TextureUnits.OCCLUSION,"texOcclusionSize"),i.isSome(r.normalTexture)&&r.normalTexture.bind(e,o,"normalTexture",t.TextureUnits.NORMAL,"normalTextureSize")),r.isIntegratedMesh&&(0===n.identifier&&0===n.subPass?(e.bindTexture(i.unwrap(r.overlayColorInner),t.TextureUnits.OVERLAY0_COLOR),e.bindTexture(i.unwrap(r.overlayColorOuter),t.TextureUnits.OVERLAY1_COLOR),e.bindTexture(i.unwrap(r.overlayNormalInner),t.TextureUnits.OVERLAY0_NORMAL),e.bindTexture(i.unwrap(r.overlayNormalOuter),t.TextureUnits.OVERLAY1_NORMAL),o.setUniform1i("ovInnerNormalTex",t.TextureUnits.OVERLAY0_NORMAL),o.setUniform1i("ovOuterNormalTex",t.TextureUnits.OVERLAY1_NORMAL)):2===n.identifier&&(e.bindTexture(i.unwrap(r.overlayHighlightInner),t.TextureUnits.OVERLAY0_COLOR),e.bindTexture(i.unwrap(r.overlayHighlightOuter),t.TextureUnits.OVERLAY1_COLOR)),o.setUniform1i("ovInnerColorTex",t.TextureUnits.OVERLAY0_COLOR),o.setUniform1i("ovOuterColorTex",t.TextureUnits.OVERLAY1_COLOR),o.setUniform1f("overlayOpacity",1))},o.prototype.initializeProgram=function(e){var t=o.shader.get(),r=this.configuration,n=t.build({output:r.output,normalType:0===r.integratedMeshMode?r.hasNormals?1:3:2,attributeColor:r.hasVertexColors,attributeTextureCoordinates:r.vertexTextureCoordinates,componentData:r.componentData,alphaDiscardMode:r.alphaDiscardMode,baseColorTexture:r.baseColorTexture,doubleSidedMode:r.doubleSidedMode,receiveAmbientOcclusion:r.receiveAmbientOcclusion,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:e.viewingMode,vertexDiscardMode:r.vertexDiscardMode,pbrMode:3===r.integratedMeshMode?4:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:h.doublePrecisionRequiresObfuscation(e.rctx),overlayEnabled:2===r.integratedMeshMode||3===r.integratedMeshMode,ssrEnabled:r.ssrEnabled,highStepCount:!1});return new g(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),t.attributeLocations)},o.prototype.initializePipeline=function(){var e=this.configuration,t=0!==e.integratedMeshMode;return _.makePipelineState({blending:0===e.output&&e.blendingEnabled?x:null,culling:S[e.cullFace],depthTest:{func:513},depthWrite:_.defaultDepthWriteParams,colorWrite:_.defaultColorWriteParams,stencilWrite:t||e.sceneHasOcludees?y.stencilWriteMaskOn:null,stencilTest:t?y.replaceBitWhenDepthTestPasses(1):e.sceneHasOcludees?y.stencilBaseAllZerosParams:null,polygonOffset:e.polygonOffsetEnabled?w:null})},o.shader=new f.ReloadableShaderModule(s,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(963)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),o}(v.ShaderTechnique);t.ComponentTechnique=b;var x=_.separateBlendingParams(770,1,771,771),w={factor:2,units:2},S=[];S[0]=null,S[2]={face:1029,mode:2305},S[1]={face:1028,mode:2305};var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transformNormal_GlobalFromModel=o.mat3f64.create(),t.toMapSpace=a.vec4f64.create(),t}return n.__extends(t,e),t}(c.VertexPosition.ModelTransform);t.ComponentDrawParameters=P;var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.hasVertexColors=!1,t.hasNormals=!1,t.vertexTextureCoordinates=0,t.componentData=0,t.slicePlaneEnabled=!1,t.cullFace=2,t.baseColorTexture=!1,t.receiveAmbientOcclusion=!0,t.receiveShadows=!0,t.vertexDiscardMode=0,t.doubleSidedMode=2,t.blendingEnabled=!0,t.alphaDiscardMode=1,t.integratedMeshMode=0,t.ssrEnabled=!1,t.polygonOffsetEnabled=!1,t.usePBR=!1,t.hasMetalnessAndRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.sceneHasOcludees=!1,t}return n.__extends(t,e),n.__decorate([m.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([m.parameter()],t.prototype,"hasVertexColors",void 0),n.__decorate([m.parameter()],t.prototype,"hasNormals",void 0),n.__decorate([m.parameter({count:3})],t.prototype,"vertexTextureCoordinates",void 0),n.__decorate([m.parameter({count:2})],t.prototype,"componentData",void 0),n.__decorate([m.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([m.parameter({count:3})],t.prototype,"cullFace",void 0),n.__decorate([m.parameter()],t.prototype,"baseColorTexture",void 0),n.__decorate([m.parameter()],t.prototype,"receiveAmbientOcclusion",void 0),n.__decorate([m.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([m.parameter({count:3})],t.prototype,"vertexDiscardMode",void 0),n.__decorate([m.parameter({count:3})],t.prototype,"doubleSidedMode",void 0),n.__decorate([m.parameter()],t.prototype,"blendingEnabled",void 0),n.__decorate([m.parameter({count:4})],t.prototype,"alphaDiscardMode",void 0),n.__decorate([m.parameter({count:4})],t.prototype,"integratedMeshMode",void 0),n.__decorate([m.parameter()],t.prototype,"ssrEnabled",void 0),n.__decorate([m.parameter()],t.prototype,"polygonOffsetEnabled",void 0),n.__decorate([m.parameter()],t.prototype,"usePBR",void 0),n.__decorate([m.parameter()],t.prototype,"hasMetalnessAndRoughnessTexture",void 0),n.__decorate([m.parameter()],t.prototype,"hasEmissionTexture",void 0),n.__decorate([m.parameter()],t.prototype,"hasOcclusionTexture",void 0),n.__decorate([m.parameter()],t.prototype,"hasNormalTexture",void 0),n.__decorate([m.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(m.ShaderTechniqueConfiguration);t.ComponentTechniqueConfiguration=T}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(238),r(1839),r(1840),r(654),r(223),r(658),r(594),r(659),r(449),r(811),r(345),r(1841),r(1239),r(1842),r(660),r(497),r(1843),r(447),r(1289),r(319),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){var T,O,C,M,A,E,I,R,D,L,j,V,F,N,k,z,U,B,G,H,q,W,J,Z,X,Y,Q,K,$,ee,te;Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLocations={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5},t.build=function(e){var t=new P.ShaderBuilder;t.include(p.VertexPosition,e),t.include(u.VertexNormal,e),t.include(c.VertexColor,e),t.include(l.TextureCoordinateAttribute,e),t.include(a.ForwardLinearDepth,e),t.include(i.ComponentData,e),t.include(w.DiscardOrAdjustAlpha,e),t.include(s.Slice,e),t.include(_.ReadBaseColorTexture,e),t.include(o.VertexDiscardByOpacity,e),t.fragment.uniforms.add("view","mat4"),1!==e.pbrMode&&2!==e.pbrMode||(t.include(g.PhysicallyBasedRenderingParameters,e),t.include(v.ComputeNormalTexture,e)),3===e.output&&1===e.componentData?t.vertex.code.add(S.glsl(T||(T=r.__makeTemplateObject(["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "],["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "])))):t.vertex.code.add(S.glsl(O||(O=r.__makeTemplateObject(["\n      #define discardShadows(castShadows) {}\n    "],["\n      #define discardShadows(castShadows) {}\n    "]))));var re=e.overlayEnabled&&0===e.output&&4===e.pbrMode;return e.overlayEnabled&&(t.include(x.Overlay,e),0===e.viewingMode?t.vertex.code.add(S.glsl(C||(C=r.__makeTemplateObject(["\n      const float invEarthRadius = ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "],["\n      const float invEarthRadius = ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "])),S.glsl.float(1/n.earthRadius))):t.vertex.code.add(S.glsl(M||(M=r.__makeTemplateObject(["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "],["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "]))))),re&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"),t.varyings.add("positionView","vec3")),t.vertex.code.add(S.glsl(D||(D=r.__makeTemplateObject(["\n    void main() {\n      bool castShadows;\n      vec4 externalColor = forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a < ",") {\n        // Discard this vertex\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ","\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "],["\n    void main() {\n      bool castShadows;\n      vec4 externalColor = forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a < ",") {\n        // Discard this vertex\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ","\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "])),S.glsl.float(w.symbolAlphaCutoff),re?S.glsl(I||(I=r.__makeTemplateObject(["\n        positionView = position_view();\n        ","\n        "],["\n        positionView = position_view();\n        ","\n        "])),0===e.viewingMode?S.glsl(A||(A=r.__makeTemplateObject(["\n        groundNormal = normalize(positionWorld());\n        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));"],["\n        groundNormal = normalize(positionWorld());\n        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));"]))):S.glsl(E||(E=r.__makeTemplateObject(["\n        groundNormal = vec3(0.0, 0.0, 1.0);\n        tbnTangent = vec3(1.0, 0.0, 0.0);\n        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));"],["\n        groundNormal = vec3(0.0, 0.0, 1.0);\n        tbnTangent = vec3(1.0, 0.0, 0.0);\n        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));"])))):"",e.overlayEnabled?S.glsl(R||(R=r.__makeTemplateObject(["setOverlayVTC(projectOverlay(position));"],["setOverlayVTC(projectOverlay(position));"]))):"")),0===e.output&&(t.include(f.ComputeMaterialColor,e),t.include(m.ComputeShadingNormal,e),t.include(y.EvaluateSceneLighting,e),re&&(t.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),t.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),e.receiveShadows?(t.include(b.ReadShadowMap,e),t.fragment.code.add(S.glsl(L||(L=r.__makeTemplateObject(["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "],["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "]))))):t.fragment.code.add(S.glsl(j||(j=r.__makeTemplateObject(["\n        float evaluateShadow() { return 0.0; }\n      "],["\n        float evaluateShadow() { return 0.0; }\n      "])))),t.fragment.code.add(S.glsl(F||(F=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor = computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ","\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor = computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ","\n    "])),e.overlayEnabled?S.glsl(V||(V=r.__makeTemplateObject(["\n        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor = overlayOpacity * overlayColorOpaque;\n        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;"],["\n        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor = overlayOpacity * overlayColorOpaque;\n        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;"]))):"")),1===e.pbrMode||2===e.pbrMode?(t.fragment.code.add(S.glsl(k||(k=r.__makeTemplateObject(["\n        ","\n        vec3 normalVertex = shadingNormalWorld();\n        float additionalIrradiance = 0.02 * lightingMainIntensity[2];\n      "],["\n        ","\n        vec3 normalVertex = shadingNormalWorld();\n        float additionalIrradiance = 0.02 * lightingMainIntensity[2];\n      "])),1===e.pbrMode?S.glsl(N||(N=r.__makeTemplateObject(["\n        applyPBRFactors();\n        if (int(externalColorMixMode) == 3) {\n          mrr = vec3(0.0, 0.6, 0.2);\n        }"],["\n        applyPBRFactors();\n        if (int(externalColorMixMode) == 3) {\n          mrr = vec3(0.0, 0.6, 0.2);\n        }"]))):"")),e.hasNormalTexture?t.fragment.code.add(S.glsl(z||(z=r.__makeTemplateObject(["\n        mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);\n        "],["\n        mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);\n        "])))):t.fragment.code.add(S.glsl(U||(U=r.__makeTemplateObject(["\n        vec3 shadingNormal = normalVertex;\n        "],["\n        vec3 shadingNormal = normalVertex;\n        "])))),t.fragment.code.add(S.glsl(H||(H=r.__makeTemplateObject(["","\n      "],["","\n      "])),0===e.viewingMode?S.glsl(B||(B=r.__makeTemplateObject(["vec3 normalGround = normalize(positionWorld());"],["vec3 normalGround = normalize(positionWorld());"]))):S.glsl(G||(G=r.__makeTemplateObject(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"],["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))))),t.fragment.code.add(S.glsl(q||(q=r.__makeTemplateObject(["\n        vec3 viewDir = normalize(vPositionWorldCameraRelative);\n        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "],["\n        vec3 viewDir = normalize(vPositionWorldCameraRelative);\n        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "]))))):(e.receiveShadows?t.fragment.code.add(S.glsl(W||(W=r.__makeTemplateObject(["\n      float shadow = evaluateShadow();\n        "],["\n      float shadow = evaluateShadow();\n        "])))):0===e.viewingMode?t.fragment.code.add(S.glsl(J||(J=r.__makeTemplateObject(["\n      float additionalAmbientScale = _oldHeuristicLighting(positionWorld());\n      float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "],["\n      float additionalAmbientScale = _oldHeuristicLighting(positionWorld());\n      float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "])))):t.fragment.code.add(S.glsl(Z||(Z=r.__makeTemplateObject(["\n      float shadow = 0.0;\n      "],["\n      float shadow = 0.0;\n      "])))),t.fragment.code.add(S.glsl(Y||(Y=r.__makeTemplateObject(["\n      float ambientOcclusion = evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ","\n      "],["\n      float ambientOcclusion = evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ","\n      "])),re?S.glsl(X||(X=r.__makeTemplateObject(["\n          vec4 overlayWaterMask = getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength = length(overlayWaterMask);\n          if (waterNormalLength > 0.95) {\n            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"],["\n          vec4 overlayWaterMask = getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength = length(overlayWaterMask);\n          if (waterNormalLength > 0.95) {\n            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"]))):""))),t.fragment.code.add(S.glsl(Q||(Q=r.__makeTemplateObject(["\n        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "],["\n        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "]))))),1!==e.output&&3!==e.output||(t.include(d.OutputDepth,e),t.fragment.code.add(S.glsl(K||(K=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "]))))),2===e.output&&(t.include(m.ComputeShadingNormal,e),t.fragment.code.add(S.glsl($||($=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha = ",";\n        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha = ",";\n        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "])),2===e.normalType?"0.0":"1.0"))),4===e.output&&(t.include(h.OutputHighlight),t.fragment.code.add(S.glsl(te||(te=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ","\n\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor = readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ","\n\n        outputHighlight();\n      }\n    "])),e.overlayEnabled?S.glsl(ee||(ee=r.__makeTemplateObject(["\n        vec4 overlayColor = getCombinedOverlayColor();\n\n        if (overlayColor.a == 0.0) {\n          gl_FragColor = vec4(0.0);\n          return;\n        }"],["\n        vec4 overlayColor = getCombinedOverlayColor();\n\n        if (overlayColor.a == 0.0) {\n          gl_FragColor = vec4(0.0);\n          return;\n        }"]))):""))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(371),r(317)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeInputBufferLayout=n.newLayout().vec3f("position").u16("componentIndex").u16("_padding"),t.VertexLayout=n.newLayout().vec2u8("sideness"),t.glVertexLayout=r.glLayout(t.VertexLayout),t.CommonInstancesLayout=n.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0}),t.RegularEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normal"),t.SilhouetteEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB"),t.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175),r(820)],void 0===(i=function(e,t,r,n,i){var o,a,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.UnpackAttributes=function(e,t){var u=e.vertex;switch(e.include(i.EdgeUtil,t),e.attributes.add("sideness","vec2"),2===t.mode?u.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "])))):u.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "])))),t.mode){case 2:u.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float fType = component.type;\n          float extensionLengthPixels = component.extensionLength;\n          float lineWidth = component.lineWidth;\n\n          if (fType <= 0.0) {\n            extensionLengthPixels *= variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float fType = component.type;\n          float extensionLengthPixels = component.extensionLength;\n          float lineWidth = component.lineWidth;\n\n          if (fType <= 0.0) {\n            extensionLengthPixels *= variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "]))));break;case 1:u.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels = component.extensionLength;\n          extensionLengthPixels *= variantExtension * 2.0 - 1.0;\n          float lineWidth = component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels = component.extensionLength;\n          extensionLengthPixels *= variantExtension * 2.0 - 1.0;\n          float lineWidth = component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))));break;case 0:u.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels = component.extensionLength;\n          float lineWidth = component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm = sideness;\n          vec2 sideness = sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels = component.extensionLength;\n          float lineWidth = component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))))}}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(117),i=r(122),o=r(123),a=r(850);if(t.HIGH_SURROGATE_MIN=55296,t.HIGH_SURROGATE_MAX=56319,t.LOW_SURROGATE_MIN=56320,t.LOW_SURROGATE_MAX=57343,o.default("es6-string")&&o.default("es6-string-raw"))t.fromCodePoint=i.default.String.fromCodePoint,t.raw=i.default.String.raw,t.codePointAt=a.wrapNative(i.default.String.prototype.codePointAt),t.endsWith=a.wrapNative(i.default.String.prototype.endsWith),t.includes=a.wrapNative(i.default.String.prototype.includes),t.normalize=a.wrapNative(i.default.String.prototype.normalize),t.repeat=a.wrapNative(i.default.String.prototype.repeat),t.startsWith=a.wrapNative(i.default.String.prototype.startsWith);else{var s=function(e,t,r,n,i){if(void 0===i&&(i=!1),null==t)throw new TypeError("string."+e+" requires a valid string to search against.");var o=t.length;return n=n!=n?i?o:0:n,[t,String(r),Math.min(Math.max(n,0),o)]};t.fromCodePoint=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=arguments.length;if(!n)return"";for(var i=String.fromCharCode,o=16384,a=[],s=-1,l="";++s<n;){var c=Number(arguments[s]),u=isFinite(c)&&Math.floor(c)===c&&c>=0&&c<=1114111;if(!u)throw RangeError("string.fromCodePoint: Invalid code point "+c);if(c<=65535)a.push(c);else{var p=((c-=65536)>>10)+t.HIGH_SURROGATE_MIN,d=c%1024+t.LOW_SURROGATE_MIN;a.push(p,d)}(s+1===n||a.length>o)&&(l+=i.apply(null,a),a.length=0)}return l},t.raw=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=e.raw,i="",o=t.length;if(null==e||null==e.raw)throw new TypeError("string.raw requires a valid callSite object with a raw value");for(var a=0,s=n.length;a<s;a++)i+=n[a]+(a<o&&a<s-1?t[a]:"");return i},t.codePointAt=function(e,r){if(void 0===r&&(r=0),null==e)throw new TypeError("string.codePointAt requries a valid string.");var n=e.length;if(r!=r&&(r=0),!(r<0||r>=n)){var i=e.charCodeAt(r);if(i>=t.HIGH_SURROGATE_MIN&&i<=t.HIGH_SURROGATE_MAX&&n>r+1){var o=e.charCodeAt(r+1);if(o>=t.LOW_SURROGATE_MIN&&o<=t.LOW_SURROGATE_MAX)return 1024*(i-t.HIGH_SURROGATE_MIN)+o-t.LOW_SURROGATE_MIN+65536}return i}},t.endsWith=function(e,t,r){if(""===t)return!0;if(void 0===r)r=e.length;else if(null===r||isNaN(r))return!1;e=(i=n.__read(s("endsWith",e,t,r,!0),3))[0],t=i[1];var i,o=(r=i[2])-t.length;return!(o<0)&&e.slice(o,r)===t},t.includes=function(e,t,r){return void 0===r&&(r=0),e=(i=n.__read(s("includes",e,t,r),3))[0],t=i[1],r=i[2],-1!==e.indexOf(t,r);var i},t.repeat=function(e,t){if(void 0===t&&(t=0),null==e)throw new TypeError("string.repeat requires a valid string.");if(t!=t&&(t=0),t<0||t===1/0)throw new RangeError("string.repeat requires a non-negative finite count.");for(var r="";t;)t%2&&(r+=e),t>1&&(e+=e),t>>=1;return r},t.startsWith=function(e,t,r){void 0===r&&(r=0),t=String(t),e=(i=n.__read(s("startsWith",e,t,r),3))[0],t=i[1];var i,o=(r=i[2])+t.length;return!(o>e.length)&&e.slice(r,o)===t}}o.default("es2017-string")?(t.padEnd=a.wrapNative(i.default.String.prototype.padEnd),t.padStart=a.wrapNative(i.default.String.prototype.padStart)):(t.padEnd=function(e,r,n){if(void 0===n&&(n=" "),null==e)throw new TypeError("string.repeat requires a valid string.");if(r===1/0)throw new RangeError("string.padEnd requires a non-negative finite count.");(null==r||r<0)&&(r=0);var i=String(e),o=r-i.length;return o>0&&(i+=t.repeat(n,Math.floor(o/n.length))+n.slice(0,o%n.length)),i},t.padStart=function(e,r,n){if(void 0===n&&(n=" "),null==e)throw new TypeError("string.repeat requires a valid string.");if(r===1/0)throw new RangeError("string.padStart requires a non-negative finite count.");(null==r||r<0)&&(r=0);var i=String(e),o=r-i.length;return o>0&&(i=t.repeat(n,Math.floor(o/n.length))+n.slice(0,o%n.length)+i),i})},function(e,t,r){var n="undefined"!=typeof global&&global||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(1407),t.setImmediate="undefined"!=typeof self&&self.setImmediate||"undefined"!=typeof global&&global.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||"undefined"!=typeof global&&global.clearImmediate||this&&this.clearImmediate},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(156),r(614)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=n.getLogger("esri.core.accessorSupport.set");function a(e,t,n){if(e&&t)if("object"==typeof t)for(var s=0,l=Object.getOwnPropertyNames(t);s<l.length;s++)a(e,u=l[s],t[u]);else{if(-1!==t.indexOf(".")){var c=t.split("."),u=c.splice(c.length-1,1)[0];return void a(i.default(e,c),u,n)}if(r("esri-debug-messages")){var p=e.__accessor__;null==p||p.metadatas[t]||o.warn("setting unknown property '"+t+"' on instance of "+p.host.declaredClass)}e[t]=n}}t.set=a,t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1093),r(615)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=new Set,a=new Set;function s(e,t){return null==t.get?function(){return this.__accessor__?this.__accessor__.getterStatic(e,t):t.value}:function(){return this.__accessor__?this.__accessor__.getterComputed(e,t):t.value}}function l(e){var t=e.prototype,r=t.declaredClass,o=i.getOwnClassMetadata(t).properties;n.processClassMetadatas(o,r);for(var a={},l=function(e){var t=o[e];a[e]={enumerable:!0,configurable:!0,get:s(e,t),set:function(r){var n=this.__accessor__;if(n){if(!Object.isFrozen(this)){if(n.initialized&&t.readOnly)throw new TypeError("[accessor] cannot assign to read-only property '"+e+"' of "+this.declaredClass);if(2===n.lifecycle&&t.constructOnly)throw new TypeError("[accessor] cannot assign to construct-only property '"+e+"' of "+this.declaredClass);n.set(e,r)}}else Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:r})}}},c=0,u=Object.getOwnPropertyNames(o);c<u.length;c++)l(u[c]);Object.defineProperties(e.prototype,a)}t.subclass=function(e){return function(t){t.prototype.declaredClass=e,n.processPrototypeMetadatas(i.getOwnClassMetadata(t.prototype).properties,e),l(t);for(var s=[],c=[],u=t.prototype;u;)u.hasOwnProperty("initialize")&&!o.has(u.initialize)&&(o.add(u.initialize),s.push(u.initialize)),u.hasOwnProperty("destroy")&&!a.has(u.destroy)&&(a.add(u.destroy),c.push(u.destroy)),u=Object.getPrototypeOf(u);o.clear(),a.clear();var p=function(e){function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return i.constructor===t&&"function"==typeof i.postscript&&(s.length&&Object.defineProperty(i,"initialize",{enumerable:!1,configurable:!0,value:function(){for(var e=s.length-1;e>=0;e--)s[e].call(this)}}),c.length&&Object.defineProperty(i,"destroy",{enumerable:!1,configurable:!0,value:function(){for(var e=0;e<c.length;e++)c[e].call(this)}}),i.postscript.apply(i,r)),i}return r.__extends(t,e),t}(t);return p.__accessorMetadata__=i.getOwnClassMetadata(t.prototype),p.prototype.declaredClass=e,p}},t.processClass=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1413),r(852)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=[r.default,n.default];t.processPrototypeMetadatas=function(e,t){for(var r=0,n=i;r<n.length;r++){var o=n[r];if(o.processPrototypePropertyMetadata)for(var a in e){var s=e[a];o.processPrototypePropertyMetadata(a,s,e,t)}}},t.processClassMetadatas=function(e,t){for(var r=0,n=i;r<n.length;r++){var o=n[r];if(o.processClassPropertyMetadata)for(var a in e){var s=e[a];o.processClassPropertyMetadata(a,s,e,t)}}},t.instanceCreated=function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0,o=i;n<o.length;n++){var a=o[n];a.instanceCreated&&a.instanceCreated(e,t,r)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCollection=function(e){return!!e&&e.prototype&&e.prototype.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(119),r(1094)],void 0===(i=function(e,t,r,n){function i(e,t,n,i){r.setDeepValue(n,o(e,i),t)}function o(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?a(e):e}function a(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function s(e,t,n,i){var a;null===e?a=null:e&&"function"==typeof e.map?"function"==typeof(a=e.map((function(e){return o(e,i)}))).toArray&&(a=a.toArray()):a=[o(e,i)],r.setDeepValue(n,a,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e,t,a,l){var c;!l.write||l.write.writer||!1===l.write.enabled&&!l.write.overridePolicy||(1===t||n.isCollection(e)?l.write.writer=s:l.write.writer=t>1?(c=t,function(e,t,n,i){var a;if(null===e)a=null;else{a=function e(t,r,n){return 0!==n&&Array.isArray(t)?t.map((function(t){return e(t,r,n-1)})):o(t,r)}(e,i,c);for(var s=c,l=a;s>0&&Array.isArray(l);)s--,l=l[0];if(void 0!==l)for(var u=0;u<s;u++)a=[a]}r.setDeepValue(n,a,t)}):i)},t.numberToJSON=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(119),r(515)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.writer=function(e,t,i){var o,a;return void 0===t?(a=e,o=[void 0]):"string"!=typeof t?(a=e,o=[void 0],i=t):(a=t,o=Array.isArray(e)?e:[e]),function(e,t){var s=e.constructor.prototype;o.forEach((function(o){var l=n.propertyJSONMeta(e,o,a);l.write&&"object"!=typeof l.write&&(l.write={}),i&&r.setDeepValue("write.target",i,l),r.setDeepValue("write.writer",s[t],l)}))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(119)],void 0===(i=function(e,t,r){return function(){function e(t,n,i){var o;this instanceof e&&(this.name=t,this.message=n&&(o=i,n.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(function(e,t){if(""===t)return"$";var n=r.getDeepValue(t,o),i=null==n?"":n;if(void 0===i)throw new Error('could not find key "'+t+'" in template');return i.toString()})))||"",this.details=i)}return e.prototype.toString=function(){return"["+this.name+"]: "+this.message},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(122);function i(e){return"number"==typeof e&&n.default.isFinite(e)}function o(e){return i(e)&&Math.floor(e)===e}t.EPSILON=1,t.MAX_SAFE_INTEGER=Math.pow(2,53)-1,t.MIN_SAFE_INTEGER=-t.MAX_SAFE_INTEGER,t.isNaN=function(e){return"number"==typeof e&&n.default.isNaN(e)},t.isFinite=i,t.isInteger=o,t.isSafeInteger=function(e){return o(e)&&Math.abs(e)<=t.MAX_SAFE_INTEGER}},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(152),r(153)],void 0===(i=function(e,t,r,n,i){function o(){try{return new DOMException("Aborted","AbortError")}catch(t){var e=new Error;return e.name="AbortError",e}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageAsync=function(e,t,a,s){return void 0===a&&(a=!1),i.create((function(l,c){if(i.isAborted(s))c(o());else{var u=function(){h(),c(new Error("Unable to load "+t))},p=function(){var t=e;h(),l(t)},d=function(){if(e){var t=e;h(),t.src="",c(o())}},h=function(){r("esri-image-decode")||(e.removeEventListener("error",u),e.removeEventListener("load",p)),u=null,p=null,e=null,n.isSome(s)&&s.removeEventListener("abort",d),d=null,a&&URL.revokeObjectURL(t)};n.isSome(s)&&s.addEventListener("abort",d),r("esri-image-decode")?e.decode().then(p,u):(e.addEventListener("error",u),e.addEventListener("load",p))}}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(230)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new Set,t}return r.__extends(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this._set=null},t.prototype.acquire=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.prototype.acquire.apply(this,t);return this._set.delete(n),n},t.prototype.release=function(t){t&&!this._set.has(t)&&(e.prototype.release.call(this,t),this._set.add(t))},t.prototype._dispose=function(t){this._set.delete(t),e.prototype._dispose.call(this,t)},t}(n);t.ReentrantObjectPool=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1425)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,styleApplyer:function(e,t,r){e.style[t]=r}};t.applyDefaultProjectionOptions=function(e){return r.extend(n,e)},t.dom={create:function(e,n){return n=t.applyDefaultProjectionOptions(n),r.createDom(e,document.createElement("div"),void 0,n),r.createProjection(e,n)},append:function(e,n,i){return i=t.applyDefaultProjectionOptions(i),r.createDom(n,e,void 0,i),r.createProjection(n,i)},insertBefore:function(e,n,i){return i=t.applyDefaultProjectionOptions(i),r.createDom(n,e.parentNode,e,i),r.createProjection(n,i)},merge:function(e,n,i){return i=t.applyDefaultProjectionOptions(i),n.domNode=e,r.initPropertiesAndChildren(e,n,i),r.createProjection(n,i)},replace:function(e,n,i){return i=t.applyDefaultProjectionOptions(i),r.createDom(n,e.parentNode,e,i),e.parentNode.removeChild(e),r.createProjection(n,i)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.splitProps=function(e){return e.split(",").map((function(e){return e.trim()}))},t.normalizePropNames=function(e,t){return e.map((function(e){return function(e,t){return 0===e.indexOf(t)?e:t+"."+e}(e,t)}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.code=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({name:this.name,code:this.code})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([i.property({type:[String,Number],json:{write:!0}})],t.prototype,"code",void 0),n=r.__decorate([i.subclass("esri.layers.support.CodedValue")],t)}(n.JSONSupport);t.CodedValue=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1105),r(518),r(1106),r(1107),r(764),r(768)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsContent=r,t.BaseContent=n,t.CustomContent=i,t.FieldsContent=o,t.MediaContent=a,t.TextContent=s,t.isContent=function(e){return e instanceof n},t.types={base:null,key:"type",typeMap:{attachment:r,custom:i,fields:o,media:a,text:s}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(518)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.displayType=null,r.type="attachments",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({displayType:this.displayType})},r.__decorate([n.property({type:["preview","list"],json:{write:!0}})],t.prototype,"displayType",void 0),r.__decorate([n.property({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.AttachmentsContent")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(518)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.creator=null,r.destroyer=null,r.outFields=null,r.type="custom",r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?n.clone(this.outFields):null})},r.__decorate([i.property()],t.prototype,"creator",void 0),r.__decorate([i.property()],t.prototype,"destroyer",void 0),r.__decorate([i.property()],t.prototype,"outFields",void 0),r.__decorate([i.property({type:["custom"],readOnly:!0})],t.prototype,"type",void 0),o=r.__decorate([i.subclass("esri.popup.content.CustomContent")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(519),r(518)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.fieldInfos=null,r.type="fields",r}var a;return r.__extends(t,e),a=t,t.prototype.writeFieldInfos=function(e,t){t.fieldInfos=e&&e.map((function(e){return e.toJSON()}))},t.prototype.clone=function(){return new a({fieldInfos:Array.isArray(this.fieldInfos)?n.clone(this.fieldInfos):null})},r.__decorate([i.property({type:[o]})],t.prototype,"fieldInfos",void 0),r.__decorate([i.writer("fieldInfos")],t.prototype,"writeFieldInfos",null),r.__decorate([i.property({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),a=r.__decorate([i.subclass("esri.popup.content.FieldsContent")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(765),r(766)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="bar-chart",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,caption:this.caption,value:this.value?this.value.clone():null})},r.__decorate([n.property({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:o.chartTypeKebabDict.write}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.BarChartMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(863),r(1447)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.refreshInterval=null,r.type="image",r.value=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})},r.__decorate([n.property({type:Number,json:{write:!0}})],t.prototype,"refreshInterval",void 0),r.__decorate([n.property({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([n.property({type:o,json:{write:!0}})],t.prototype,"value",void 0),i=r.__decorate([n.subclass("esri.popup.content.ImageMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(765),r(766)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="line-chart",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,caption:this.caption,value:this.value?this.value.clone():null})},r.__decorate([n.property({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:o.chartTypeKebabDict.write}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.LineChartMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(765),r(766)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="pie-chart",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,caption:this.caption,value:this.value?this.value.clone():null})},r.__decorate([n.property({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:o.chartTypeKebabDict.write}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.popup.content.PieChartMediaInfo")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1108),r(767),r(1109),r(1110),r(1111),r(863)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.types={base:s,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":r,"column-chart":n,"line-chart":o,"pie-chart":a,image:i}},t.default=t.types}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.field=null,r.order=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({field:this.field,order:this.order})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([i.property({type:["asc","desc"],json:{write:!0}})],t.prototype,"order",void 0),n=r.__decorate([i.subclass("esri.popup.support.RelatedRecordsInfoFieldOrder")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._geometry=e}return e.prototype.next=function(){var e=this._geometry;return this._geometry=null,e},e}();t.SimpleGeometryCursor=n,t.clone=function(e){return r.clone(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=[1,256,65536,16777216],n=[1/256,1/65536,1/16777216,1/4294967296],i=function(e,t){void 0===t&&(t=0);for(var r=0,i=0;i<4;i++)r+=e[t+i]*n[i];return r}(new Uint8ClampedArray([255,255,255,255]));t.packFloatRGBA=function(e,t,n){void 0===n&&(n=0);for(var o,a=function(e,t,r){return e<0?0:e>r?r:e}(e,0,i),s=0;s<4;s++)t[n+s]=Math.floor(256*((o=a*r[s])-Math.floor(o)))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163),r(1115),r(625)],void 0===(i=function(e,t,r,n,i){function o(e){for(var t=1/0,r=-1/0,n=1/0,i=-1/0,o=0,a=e;o<a.length;o++)for(var s=0,l=a[o];s<l.length;s++){var c=l[s];c[0]<t&&(t=c[0]),c[0]>r&&(r=c[0]),c[1]<n&&(n=c[1]),c[1]>i&&(i=c[1])}return[t,n,r,i]}function a(e,t){for(var r=2*t,i=e.length,o=new Uint8Array(4*i),a=0;a<i;++a){var s=.5-e[a]/r;n.packFloatRGBA(s,o,4*a)}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.getSDFInfo=function e(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":var r=t.symbolLayers;return r&&1===r.length?e(r[0]):null;case"CIMVectorMarker":var n=t.markerGraphics;if(!n||1!==n.length)return null;var i=n[0];if(!i)return null;var o=i.geometry;if(!o)return null;var a=i.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:{geom:o,asFill:"CIMPolygonSymbol"===a.type};case"sdf":return{geom:t.geom,asFill:t.asFill}}return null},t.getSDFSymbol=function(e){var t=e.markerGraphics;if(!t||1!==t.length)return null;var r=t[0];if(!r)return null;var n=r.symbol;return!n||"CIMPolygonSymbol"!==n.type&&"CIMLineSymbol"!==n.type?null:n},t.getExtent=function(e){return e?e.rings?o(e.rings):e.paths?o(e.paths):r.isExtent(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null},t.getSDFMetrics=function(e,t,r,n,i){var o=e[0],a=e[1],s=e[2],l=e[3];if(s<o||l<a)return[0,0,0];var c=s-o,u=l-a,p=Math.floor(31.5),d=(128-2*(p+1))/Math.max(c,u),h=Math.round(c*d)+2*p,f=Math.round(u*d)+2*p,v=1;t&&(v=f/d/(t.ymax-t.ymin));var m=0,y=0;if(n)if(i){if(t&&r&&t.ymax-t.ymin>0){var g=(t.xmax-t.xmin)/(t.ymax-t.ymin);m=n.x/(r*g),y=n.y/r}}else m=n.x,y=n.y;return m=.5*(t.xmax+t.xmin)+m*(t.xmax-t.xmin),y=.5*(t.ymax+t.ymin)+y*(t.ymax-t.ymin),m-=o,y-=a,m*=d,y*=d,[v,(m+=p)/h-.5,-((y+=p)/f-.5)]},t.buildSDF=function(e){for(var t,r=(t=e.geom)?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null,n=function(e){for(var t=1/0,r=-1/0,n=1/0,o=-1/0,a=0,s=e;a<s.length;a++)for(var l=0,c=s[a];l<c.length;l++){var u=c[l];u[0]<t&&(t=u[0]),u[0]>r&&(r=u[0]),u[1]<n&&(n=u[1]),u[1]>o&&(o=u[1])}return new i.default(t,n,r-t,o-n)}(r),o=Math.floor(31.5),s=(128-2*(o+1))/Math.max(n.width,n.height),l=Math.round(n.width*s)+2*o,c=Math.round(n.height*s)+2*o,u=[],p=0,d=r;p<d.length;p++){var h=d[p];if(h&&h.length>1){for(var f=[],v=0,m=h;v<m.length;v++){var y=m[v],g=y[0],_=y[1];g-=n.x,_-=n.y,g*=s,_*=s,g+=o-.5,_+=o-.5,f.push([g,_])}if(e.asFill){var b=f.length-1;f[0][0]===f[b][0]&&f[0][1]===f[b][1]||f.push(f[0])}u.push(f)}}var x=function(e,t,r,n){for(var i=t*r,o=new Array(i),a=n*n+1,s=0;s<i;++s)o[s]=a;for(var l=0,c=e;l<c.length;l++){var u=c[l],p=u.length;for(s=1;s<p;++s){var d=u[s-1],h=u[s],f=void 0,v=void 0;d[0]<h[0]?(f=d[0],v=h[0]):(f=h[0],v=d[0]);var m=void 0,y=void 0;d[1]<h[1]?(m=d[1],y=h[1]):(m=h[1],y=d[1]);var g=Math.floor(f)-n,_=Math.floor(v)+n,b=Math.floor(m)-n,x=Math.floor(y)+n;g<0&&(g=0),_>t&&(_=t),b<0&&(b=0),x>r&&(x=r);for(var w=h[0]-d[0],S=h[1]-d[1],P=w*w+S*S,T=g;T<_;T++)for(var O=b;O<x;O++){var C=(T-d[0])*w+(O-d[1])*S,M=void 0,A=void 0;C<0?(M=d[0],A=d[1]):C>P?(M=h[0],A=h[1]):(C/=P,M=d[0]+C*w,A=d[1]+C*S);var E=(T-M)*(T-M)+(O-A)*(O-A),I=(r-O-1)*t+T;E<o[I]&&(o[I]=E)}}}for(s=0;s<i;++s)o[s]=Math.sqrt(o[s]);return o}(u,l,c,o);return e.asFill&&function(e,t,r,n,i){for(var o=0,a=e;o<a.length;o++)for(var s=a[o],l=s.length,c=1;c<l;++c){var u=s[c-1],p=s[c],d=void 0,h=void 0;u[0]<p[0]?(d=u[0],h=p[0]):(d=p[0],h=u[0]);var f=void 0,v=void 0;u[1]<p[1]?(f=u[1],v=p[1]):(f=p[1],v=u[1]);var m=Math.floor(d),y=Math.floor(h)+1,g=Math.floor(f),_=Math.floor(v)+1;m<n&&(m=n),y>t-n&&(y=t-n),g<n&&(g=n),_>r-n&&(_=r-n);for(var b=g;b<_;++b)if(u[1]>b!=p[1]>b){for(var x=(r-b-1)*t,w=m;w<y;++w)w<(p[0]-u[0])*(b-u[1])/(p[1]-u[1])+u[0]&&(i[x+w]=-i[x+w]);for(w=n;w<m;++w)i[x+w]=-i[x+w]}}}(u,l,c,o,x),[a(x,o),l,c]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(152),r(171),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=new n([0,0,0,1]),t.size=a.px2pt(1),t.stipplePattern=null,t.stippleOffColor=null,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({color:o.isSome(this.color)?this.color.clone():null,size:this.size,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})},r.__decorate([s.property(l.colorAndTransparencyProperty)],t.prototype,"color",void 0),r.__decorate([s.property(l.screenSizeProperty)],t.prototype,"size",void 0),r.__decorate([s.property(l.stipplePatternProperty)],t.prototype,"stipplePattern",void 0),r.__decorate([s.property({type:n})],t.prototype,"stippleOffColor",void 0),i=r.__decorate([s.subclass("esri.symbols.support.Symbol3DOutline")],t)}(i.JSONSupport);t.Symbol3DOutline=c,t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=0,t.y=0,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({x:this.x,y:this.y})},r.__decorate([i.property({type:Number})],t.prototype,"x",void 0),r.__decorate([i.property({type:Number})],t.prototype,"y",void 0),n=r.__decorate([i.subclass("esri.symbols.support.Symbol3DAnchorPosition2D")],t)}(n);t.Symbol3DAnchorPosition2D=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(169),r(118),r(151),r(431),r(432),r(628),r(882)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=n.ofType({base:null,key:"type",typeMap:{text:s}});return function(e){function t(t){var r=e.call(this,t)||this;return r.verticalOffset=null,r.callout=null,r.styleOrigin=null,r.symbolLayers=new u,r.type="label-3d",r}var n;return r.__extends(t,e),n=t,t.prototype.supportsCallout=function(){return!0},t.prototype.hasVisibleCallout=function(){return l.hasVisibleCallout(this)},t.prototype.hasVisibleVerticalOffset=function(){return l.hasVisibleVerticalOffset(this)},t.prototype.clone=function(){return new n({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail),callout:i.clone(this.callout),verticalOffset:i.clone(this.verticalOffset)})},t.fromTextSymbol=function(e){return new n({symbolLayers:[s.fromTextSymbol(e)]})},r.__decorate([o.property({type:c.default,json:{write:!0}})],t.prototype,"verticalOffset",void 0),r.__decorate([o.property(l.calloutProperty)],t.prototype,"callout",void 0),r.__decorate([o.property({json:{read:!1,write:!1}})],t.prototype,"styleOrigin",void 0),r.__decorate([o.property({type:u})],t.prototype,"symbolLayers",void 0),r.__decorate([o.enumeration({LabelSymbol3D:"label-3d"})],t.prototype,"type",void 0),n=r.__decorate([o.subclass("esri.symbols.LabelSymbol3D")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(273)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.portal=null,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})},r.__decorate([i.property({type:String})],t.prototype,"name",void 0),r.__decorate([i.property({type:String})],t.prototype,"styleUrl",void 0),r.__decorate([i.property({type:String})],t.prototype,"styleName",void 0),r.__decorate([i.property({type:o})],t.prototype,"portal",void 0),n=r.__decorate([i.subclass("esri.symbols.support.StyleOrigin")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.visible=!0,r}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e){if(e&&e.type){var t=r.__assign({},e);return delete t.type,t}return e},t.prototype.clone=function(){},r.__decorate([i.property({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],t.prototype,"type",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"visible",void 0),r.__decorate([i.subclass("esri.symbols.callouts.Callout3D")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=new n("white"),t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({color:o.clone(this.color)})},r.__decorate([a.property(s.colorAndTransparencyProperty)],t.prototype,"color",void 0),i=r.__decorate([a.subclass("esri.symbols.callouts.LineCallout3DBorder")],t)}(i.JSONSupport);t.LineCallout3DBorder=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(171),r(151),r(875),r(1124)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.type="picture-fill",n.url=null,n.xscale=1,n.yscale=1,n.width=12,n.height=12,n.xoffset=0,n.yoffset=0,n.source=null,n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t,r,n){if(e&&"string"!=typeof e&&null==e.imageData)return e;var o={};return e&&(o.url=e),t&&(o.outline=t),null!=r&&(o.width=i.toPt(r)),null!=n&&(o.height=i.toPt(n)),o},t.prototype.clone=function(){var e=new a({color:n.clone(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",n.clone(this.source)),e},t.prototype.hash=function(){return e.prototype.hash.call(this)+"."+this.color.hash()+"."+this.height+"."+this.url+"."+this.width+"."+this.xoffset+"."+this.xscale+"."+this.yoffset+"."+this.yscale},r.__decorate([o.enumeration({esriPFS:"picture-fill"})],t.prototype,"type",void 0),r.__decorate([o.property(s.urlPropertyDefinition)],t.prototype,"url",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"xscale",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"yscale",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"height",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"xoffset",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"yoffset",void 0),r.__decorate([o.property(s.sourcePropertyDefinition)],t.prototype,"source",void 0),a=r.__decorate([o.subclass("esri.symbols.PictureFillSymbol")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(172),r(351)],void 0===(i=function(e,t,r,n){function i(e,t,n){return t.imageData?r.makeData({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):o(t.url,n)}function o(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!r.isAbsolute(e)&&t.layer.parsedUrl?r.join(t.layer.parsedUrl.path,"images",e):n.fromJSON(e,t)}function a(e,t,i,o){if(r.isDataProtocol(e)){var a=r.dataComponents(e);t.contentType=a.mediaType,t.imageData=a.data,i&&i.imageData===t.imageData&&i.url&&n.write(i.url,t,"url",o)}else n.write(e,t,"url",o)}Object.defineProperty(t,"__esModule",{value:!0}),t.readImageDataOrUrl=i,t.read=o,t.writeImageDataAndUrl=a,t.urlPropertyDefinition={json:{read:{source:["imageData","url"],reader:i},write:{writer:function(e,t,r,n){a(e,t,this.source,n)}}}},t.sourcePropertyDefinition={readOnly:!0,json:{read:{source:["imageData","url"],reader:function(e,t,r){var n={};return t.imageData&&(n.imageData=t.imageData),t.contentType&&(n.contentType=t.contentType),t.url&&(n.url=o(t.url,r)),n}}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(171),r(151),r(884),r(1124)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.color=null,n.type="picture-marker",n.url=null,n.source=null,n.height=12,n.width=12,n.size=null,n}var a;return r.__extends(t,e),a=t,t.prototype.normalizeCtorArgs=function(e,t,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;var n={};return e&&(n.url=e),null!=t&&(n.width=i.toPt(t)),null!=r&&(n.height=i.toPt(r)),n},t.prototype.readHeight=function(e,t){return t.size||e},t.prototype.readWidth=function(e,t){return t.size||e},t.prototype.clone=function(){var e=new a({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",n.clone(this.source)),e},t.prototype.hash=function(){return e.prototype.hash.call(this)+"."+this.height+"."+this.url+"."+this.width},r.__decorate([o.property({json:{write:!1}})],t.prototype,"color",void 0),r.__decorate([o.enumeration({esriPMS:"picture-marker"})],t.prototype,"type",void 0),r.__decorate([o.property(s.urlPropertyDefinition)],t.prototype,"url",void 0),r.__decorate([o.property(s.sourcePropertyDefinition)],t.prototype,"source",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"height",void 0),r.__decorate([o.reader("height",["height","size"])],t.prototype,"readHeight",null),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([o.property({json:{write:!1}})],t.prototype,"size",void 0),a=r.__decorate([o.subclass("esri.symbols.PictureMarkerSymbol")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(156),r(153),r(151),r(273),r(351),r(428),r(880),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){var d=o.getLogger("esri.symbols.WebStyleSymbol"),h=i.strict()({styleSymbolReference:"web-style"});return function(e){function t(t){var r=e.call(this,t)||this;return r.styleName=null,r.portal=null,r.styleUrl=null,r.thumbnail=null,r.name=null,r.type="web-style",r}var i;return n.__extends(t,e),i=t,t.prototype.read=function(t,r){this.portal=r?r.portal:void 0,e.prototype.read.call(this,t,r)},t.prototype.clone=function(){return new i({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})},t.prototype.fetchSymbol=function(e){return this._fetchSymbol("webRef",e)},t.prototype.fetchCIMSymbol=function(e){return this._fetchSymbol("cimRef",e)},t.prototype._fetchSymbol=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(633)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return i=n.sent(),a.throwIfAborted(t),(o=i.resolveWebStyleSymbol(this,{portal:this.portal},e,t)).catch((function(e){d.error("#fetchSymbol()","Failed to create symbol from style",e)})),[2,o]}}))}))},n.__decorate([s.property({json:{write:!1}})],t.prototype,"color",void 0),n.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"styleName",void 0),n.__decorate([s.property({type:l,json:{write:!1}})],t.prototype,"portal",void 0),n.__decorate([s.property({type:String,json:{read:c.read,write:c.write}})],t.prototype,"styleUrl",void 0),n.__decorate([s.property({type:p.default,json:{read:!1}})],t.prototype,"thumbnail",void 0),n.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),n.__decorate([s.property({type:h.apiValues,readOnly:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],t.prototype,"type",void 0),i=n.__decorate([s.subclass("esri.symbols.WebStyleSymbol")],t)}(u)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(118),r(151),r(179),r(1478),r(1128),r(578)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=new n.default({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),d=new n.default({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),h=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];return function(e){function t(t){var r=e.call(this,t)||this;return r.colorRamp=null,r.lengthUnit=null,r.maxSliderValue=null,r.minSliderValue=null,r.visualVariables=null,r}var n;return r.__extends(t,e),n=t,Object.defineProperty(t.prototype,"classificationMethod",{get:function(){var e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e},set:function(e){this._set("classificationMethod",e)},enumerable:!0,configurable:!0}),t.prototype.readColorRamp=function(e){if(e)return u.fromJSON(e)},Object.defineProperty(t.prototype,"fields",{get:function(){return this.type&&"predominance"!==this.type?null:this._get("fields")},set:function(e){this._set("fields",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field1",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field1")},set:function(e){this._set("field1",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field2",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field2")},set:function(e){this._set("field2",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focus",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("focus")},set:function(e){this._set("focus",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numClasses",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")},set:function(e){this._set("numClasses",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDeviationInterval",{get:function(){var e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")},set:function(e){this._set("standardDeviationInterval",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._get("type")},set:function(e){var t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({classificationMethod:this.classificationMethod,colorRamp:o.clone(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:o.clone(this.field1),field2:o.clone(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((function(e){return e.clone()}))})},r.__decorate([a.property({type:p.apiValues,value:null,dependsOn:["type"],json:{type:p.jsonValues,read:p.read,write:p.write,origins:{"web-document":{default:"manual",type:p.jsonValues,read:p.read,write:p.write}}}})],t.prototype,"classificationMethod",null),r.__decorate([a.property({types:u.types,json:{write:!0}})],t.prototype,"colorRamp",void 0),r.__decorate([a.reader("colorRamp")],t.prototype,"readColorRamp",null),r.__decorate([a.property({type:[String],value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"fields",null),r.__decorate([a.property({type:l.default,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field1",null),r.__decorate([a.property({type:l.default,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field2",null),r.__decorate([a.property({type:["HH","HL","LH","LL"],value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"focus",null),r.__decorate([a.property({type:Number,value:null,dependsOn:["type"],json:{type:s.Integer,write:!0}})],t.prototype,"numClasses",null),r.__decorate([a.property({type:h,json:{type:h,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],t.prototype,"lengthUnit",void 0),r.__decorate([a.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],t.prototype,"maxSliderValue",void 0),r.__decorate([a.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],t.prototype,"minSliderValue",void 0),r.__decorate([a.property({type:[.25,.33,.5,1],value:null,dependsOn:["classificationMethod","type"],json:{type:[.25,.33,.5,1],write:!0}})],t.prototype,"standardDeviationInterval",null),r.__decorate([a.property({type:String,value:null,json:{type:d.jsonValues,read:d.read,write:d.write,origins:{"web-scene":{type:d.jsonValues.filter((function(e){return"dotDensity"!==e})),read:d.read,write:d.write}}}})],t.prototype,"type",null),r.__decorate([a.property({type:[c],json:{write:!0}})],t.prototype,"visualVariables",void 0),n=r.__decorate([a.subclass("esri.renderers.support.AuthoringInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151),r(573)],void 0===(i=function(e,t,r,n,i,o,a){var s=new n.default({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),l=new n.default({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),c={key:function(e){return"number"==typeof e?"number":"string"},typeMap:{number:Number,string:String},base:null},u=["high-to-low","above-and-below","centered-on","extremes"],p=["seconds","minutes","hours","days","months","years"];return function(e){function t(t){var r=e.call(this,t)||this;return r.endTime=null,r.field=null,r.maxSliderValue=null,r.minSliderValue=null,r.startTime=null,r.type=null,r.units=null,r}var n;return r.__extends(t,e),n=t,t.prototype.castEndTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},t.prototype.castStartTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},Object.defineProperty(t.prototype,"style",{get:function(){return"color"===this.type?this._get("style"):null},set:function(e){this._set("style",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return"color"===this.type?this._get("theme")||"high-to-low":null},set:function(e){this._set("theme",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})},r.__decorate([o.property({types:c,json:{write:!0}})],t.prototype,"endTime",void 0),r.__decorate([a.cast("endTime")],t.prototype,"castEndTime",null),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"maxSliderValue",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"minSliderValue",void 0),r.__decorate([o.property({types:c,json:{write:!0}})],t.prototype,"startTime",void 0),r.__decorate([a.cast("startTime")],t.prototype,"castStartTime",null),r.__decorate([o.property({type:s.apiValues,value:null,dependsOn:["type"],json:{type:s.jsonValues,read:s.read,write:s.write}})],t.prototype,"style",null),r.__decorate([o.property({type:u,value:null,dependsOn:["type"],json:{type:u,write:!0}})],t.prototype,"theme",null),r.__decorate([o.property({type:l.apiValues,json:{type:l.jsonValues,read:l.read,write:l.write}})],t.prototype,"type",void 0),r.__decorate([o.property({type:p,json:{type:p,write:!0}})],t.prototype,"units",void 0),n=r.__decorate([o.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(151),r(179),r(888)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.algorithm=null,r.fromColor=null,r.toColor=null,r.type="algorithmic",r}var s;return r.__extends(t,e),s=t,t.prototype.clone=function(){return new s({fromColor:i.clone(this.fromColor),toColor:i.clone(this.toColor),algorithm:this.algorithm})},r.__decorate([o.enumeration({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],t.prototype,"algorithm",void 0),r.__decorate([o.property({type:n,json:{type:[a.Integer],write:!0}})],t.prototype,"fromColor",void 0),r.__decorate([o.property({type:n,json:{type:[a.Integer],write:!0}})],t.prototype,"toColor",void 0),r.__decorate([o.property({type:["algorithmic"]})],t.prototype,"type",void 0),s=r.__decorate([o.subclass("esri.tasks.support.AlgorithmicColorRamp")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(368)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showLegend=null,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title,showLegend:this.showLegend})},r.__decorate([n.property({type:Boolean,json:{write:!0}})],t.prototype,"showLegend",void 0),i=r.__decorate([n.subclass("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],t)}(i.default)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.label=null,r.value=null,r}var i;return r.__extends(t,e),i=t,t.prototype.writeValue=function(e,t,r){t[r]=null==e?0:e},t.prototype.clone=function(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})},r.__decorate([o.property({type:n,json:{type:[a.Integer],write:!0}})],t.prototype,"color",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([o.property({type:Number,json:{write:{allowNull:!0}}})],t.prototype,"value",void 0),r.__decorate([o.writer("value")],t.prototype,"writeValue",null),i=r.__decorate([o.subclass("esri.renderers.visualVariables.support.ColorStop")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(632),r(1480)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="opacity",r.normalizationField=null,r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"cache",{get:function(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stops",{set:function(e){e&&Array.isArray(e)&&(e=e.filter((function(e){return!!e}))).sort((function(e,t){return e.value-t.value})),this._set("stops",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((function(e){return e.clone()})),legendOptions:this.legendOptions&&this.legendOptions.clone()})},t.prototype.getAttributeHash=function(){return e.prototype.getAttributeHash.call(this)+"-"+this.normalizationField},t.prototype._interpolateData=function(){return this.stops&&this.stops.map((function(e){return e.value||0}))},r.__decorate([n.property({readOnly:!0,dependsOn:["valueExpression","stops"]})],t.prototype,"cache",null),r.__decorate([n.property({type:["opacity"],json:{type:["transparencyInfo"]}})],t.prototype,"type",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"normalizationField",void 0),r.__decorate([n.property({type:[o],json:{write:!0}})],t.prototype,"stops",null),i=r.__decorate([n.subclass("esri.renderers.visualVariables.OpacityVariable")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(151),r(632)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.axis=null,r.type="rotation",r.rotationType="geographic",r.valueExpressionTitle=null,r}var o;return r.__extends(t,e),o=t,Object.defineProperty(t.prototype,"cache",{get:function(){return{hasExpression:!!this.valueExpression,compiledFunc:null}},enumerable:!0,configurable:!0}),t.prototype.writeValueExpressionTitleWebScene=function(e,t,r,i){if(i&&i.messages){var o="visualVariables["+this.index+"]";i.messages.push(new n("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:o+".valueExpressionTitle",context:i}))}},t.prototype.clone=function(){return new o({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})},r.__decorate([i.property({readOnly:!0,dependsOn:["valueExpression"]})],t.prototype,"cache",null),r.__decorate([i.property({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],t.prototype,"axis",void 0),r.__decorate([i.property({type:["rotation"],json:{type:["rotationInfo"]}})],t.prototype,"type",void 0),r.__decorate([i.property({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],t.prototype,"rotationType",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),r.__decorate([i.writer("web-scene","valueExpressionTitle")],t.prototype,"writeValueExpressionTitleWebScene",null),o=r.__decorate([i.subclass("esri.renderers.visualVariables.RotationVariable")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(171),r(151)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.label=null,r.size=null,r.value=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({label:this.label,size:this.size,value:this.value})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],t.prototype,"size",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"value",void 0),n=r.__decorate([o.subclass("esri.renderers.visualVariables.support.SizeStop")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(165),r(154),r(118),r(156),r(890),r(152),r(153),r(198),r(229),r(151),r(191),r(524),r(631),r(246),r(866)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){var _=s.getLogger("esri.renderers.DictionaryRenderer");return function(e){function t(t){var r=e.call(this,t)||this;return r._ongoingRequests=new Map,r._symbolCache=new l(100),r.config=null,r.description=null,r.fieldMap=null,r.label=null,r.scaleExpression=null,r.url=null,r.type="dictionary",r}var s;return r.__extends(t,e),s=t,t.prototype.clone=function(){return new s({config:a.clone(this.config),scaleExpression:a.clone(this.scaleExpression),description:a.clone(this.description),fieldMap:a.clone(this.fieldMap),label:a.clone(this.label),url:a.clone(this.url),visualVariables:a.clone(this.visualVariables)})},t.prototype.getSymbolAsync=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a,s,l,c,p,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R=this;return r.__generator(this,(function(r){switch(r.label){case 0:this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t)),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._dictionaryPromise];case 2:return i=r.sent(),[3,4];case 3:return o=r.sent(),u.isAbortError(o)?(this._dictionaryPromise=null,[2,null]):[3,4];case 4:for(a={},s=0,l=this._symbolAttributes;s<l.length;s++)c=l[s],(p=this.fieldMap[c])&&null!==e.attributes[p]&&void 0!==e.attributes[p]?(h=""+e.attributes[p],a[c]=h):a[c]="";if(!(f=i(a,t))||"string"!=typeof f)return[2,null];if(v=d.numericHash(f).toString(),m=this._symbolCache.get(v))return m.catch((function(){R._symbolCache.pop(v)})),[2,m];for(y=f.split(";"),g=[],_=[],b=0,x=y;b<x.length;b++)if((w=x[b])&&0!==w.length)if(-1===w.indexOf("po:"))if(-1!==w.indexOf("|"))for(M=0,A=w.split("|");M<A.length;M++)E=A[M],this._itemNames.has(E)&&g.push(E);else this._itemNames.has(w)&&g.push(w);else 3===(S=w.substr(3).split("|")).length&&(P=S[0],T=S[1],O=S[2],"DashTemplate"===T?O=O.split(" ").map((function(e){return Number(e)})):"Color"===T?(C=new n(O).toRgba(),O=[C[0],C[1],C[2],255*C[3]]):O=Number(O),_.push({primitiveName:P,propertyName:T,value:O}));return I=this._cimPartsToCIMSymbol(g,_,t),this._symbolCache.put(v,I,1),[2,I]}}))}))},t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.collectVVRequiredFields(e,t)];case 1:return r.sent(),this.scaleExpression?[4,f.collectArcadeFieldNames(e,t,this.scaleExpression)]:[3,3];case 2:r.sent(),r.label=3;case 3:for(i in n=t.map((function(e){return e.name})),this.fieldMap)n.indexOf(this.fieldMap[i])<0||e.add(this.fieldMap[i]);return[2]}}))}))},Object.defineProperty(t.prototype,"arcadeRequired",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.fetchResources=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,l,d,h,f,v,m,g,b,x,w,S,P,T;return r.__generator(this,(function(O){switch(O.label){case 0:return this.url?(t=c.isSome(e)?e.abortOptions:null,n=i(this.url+"/resources/styles/dictionary-info.json",r.__assign({responseType:"json",query:{f:"json"}},t)),[4,u.all([n,y.loadArcade()])]):(_.error("no valid URL!"),[2,void 0]);case 1:if(!(a=O.sent()[0].data))throw new o("esri.renderers.DictionaryRenderer","Bad dictionary data!");if(s=a.expression,l=a.authoringInfo,this._refSymbolUrlTemplate=this.url+"/"+a.cimRefTemplateUrl,this._itemNames=p.SetFromValues(a.itemsNames),this._symbolAttributes=l.symbol,d={},this.config)for(S in h=this.config)d[S]=h[S];for(f=0,v=l.configuration;f<v.length;f++)S=v[f],d.hasOwnProperty(S.name)||(d[S.name]=S.value);if(m=[],c.isSome(e)&&e.fields)for(g=function(t){var n=b.fieldMap[t],i=e.fields.filter((function(e){return e.name===n}));i.length>0&&m.push(r.__assign(r.__assign({},i[0]),{name:t}))},b=this,x=0,w=this._symbolAttributes;x<w.length;x++)S=w[x],g(S);return[4,y.createDictionaryExpression(s,c.isSome(e)?e.spatialReference:null,m,d)];case 2:return P=O.sent(),T={scale:0},[2,function(e,t){var r=P.repurposeFeature({geometry:null,attributes:e});return T.scale=c.isSome(t)?t.scale:void 0,P.evaluate({$feature:r,$view:T})}]}}))}))},t.prototype.getSymbol=function(){return null},t.prototype.getSymbols=function(){return[]},t.prototype.getAttributeHash=function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")},t.prototype.getMeshHash=function(){return this.url+"-"+JSON.stringify(this.fieldMap)},t.prototype._getSymbolPart=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:if(this._ongoingRequests.has(e))return[2,this._ongoingRequests.get(e).then((function(e){return e.data}))];n=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),o=i(n,r.__assign({responseType:"json",query:{f:"json"}},t)),this._ongoingRequests.set(e,o),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,o];case 2:return[2,s.sent().data];case 3:return a=s.sent(),this._ongoingRequests.delete(e),[2,u.reject(a)];case 4:return[2]}}))}))},t.prototype._combineSymbolParts=function(e,t){var n;if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:t};var i=r.__assign({},e[0]);i.symbolLayers=[];for(var o=0,a=e;o<a.length;o++){var s=a[o];(n=i.symbolLayers).unshift.apply(n,s.symbolLayers)}return{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}},t.prototype._cimPartsToCIMSymbol=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:for(i=new Array(e.length),o=0;o<e.length;o++)i[o]=this._getSymbolPart(e[o],n);return[4,u.all(i)];case 1:return a=r.sent(),[2,new g({data:this._combineSymbolParts(a,t)})]}}))}))},r.__decorate([h.property({type:Object,json:{write:!0}})],t.prototype,"config",void 0),r.__decorate([h.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([h.property({type:Object,json:{write:!0}})],t.prototype,"fieldMap",void 0),r.__decorate([h.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([h.property({type:String,json:{write:!0}})],t.prototype,"scaleExpression",void 0),r.__decorate([h.property({type:String,json:{write:!0}})],t.prototype,"url",void 0),s=r.__decorate([h.subclass("esri.renderers.DictionaryRenderer")],t)}(m.VisualVariablesMixin(v))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(151),r(191),r(524),r(783)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.blurRadius=10,r.colorStops=[new l({ratio:0,color:new n("rgba(255, 140, 0, 0)")}),new l({ratio:.75,color:new n("rgba(255, 140, 0, 1)")}),new l({ratio:.9,color:new n("rgba(255, 0,   0, 1)")})],r.field=null,r.fieldOffset=0,r.maxPixelIntensity=100,r.minPixelIntensity=0,r.type="heatmap",r}var s;return r.__extends(t,e),s=t,t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return(n=this.field)&&"string"==typeof n&&a.collectField(e,t,n),[2]}))}))},t.prototype.getAttributeHash=function(){return null},t.prototype.getMeshHash=function(){return JSON.stringify(this.colorStops)+"."+this.blurRadius+"."+this.field},t.prototype.clone=function(){return new s({blurRadius:this.blurRadius,colorStops:i.clone(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})},r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"blurRadius",void 0),r.__decorate([o.property({type:[l],json:{write:!0}})],t.prototype,"colorStops",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([o.property({type:Number,json:{write:{overridePolicy:function(e,t,r){return{enabled:null==r}}}}})],t.prototype,"fieldOffset",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"maxPixelIntensity",void 0),r.__decorate([o.property({type:Number,json:{write:!0}})],t.prototype,"minPixelIntensity",void 0),r.__decorate([o.enumeration({heatmap:"heatmap"})],t.prototype,"type",void 0),s=r.__decorate([o.subclass("esri.renderers.HeatmapRenderer")],t)}(s)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(121)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isDevEnvironment=function(e){return e=e||r.location.hostname,s.some((function(t){return null!=e.match(t)}))},t.adjustStaticAGOUrl=function(e,t){return e?null!=(t=t||r.location.hostname).match(n)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(i)||null!=t.match(a)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e},t.isTelemetryDevEnvironment=function(e){return e=e||r.location.hostname,[/^zrh-.+?\.esri\.com$/].concat(s).some((function(t){return null!=e.match(t)}))};var n=/^devext.arcgis.com$/,i=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,a=/^[\w-]*\.mapsqa.arcgis.com$/,s=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,n,i,/^jsapps.esri.com$/,o,a]}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(118),r(151)],void 0===(i=function(e,t,r,n,i,o,a){var s=new n.default({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.description=null,r.drawingTool=null,r.prototype=null,r.thumbnail=null,r}return r.__extends(t,e),t.prototype.writeDrawingTool=function(e,t){t.drawingTool=s.toJSON(e)},t.prototype.writePrototype=function(e,t){t.prototype=o.fixJson(o.clone(e),!0)},t.prototype.writeThumbnail=function(e,t){t.thumbnail=o.fixJson(o.clone(e))},r.__decorate([a.property({json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([a.property({json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([a.property({json:{read:s.read,write:s.write}})],t.prototype,"drawingTool",void 0),r.__decorate([a.writer("drawingTool")],t.prototype,"writeDrawingTool",null),r.__decorate([a.property({json:{write:!0}})],t.prototype,"prototype",void 0),r.__decorate([a.writer("prototype")],t.prototype,"writePrototype",null),r.__decorate([a.property({json:{write:!0}})],t.prototype,"thumbnail",void 0),r.__decorate([a.writer("thumbnail")],t.prototype,"writeThumbnail",null),r.__decorate([a.subclass("esri.layers.support.FeatureTemplate")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(859)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getBasemapTitle=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return e?(t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,[4,i.loadMessageBundle("esri/t9n/basemaps")]):[2,void 0];case 1:return[2,(n=r.sent())[e]||n[t]]}}))}))},t.esriBasemapDefinitions={streets:{id:"streets",thumbnailUrl:n.getAssetUrl("esri/images/basemap/streets.jpg"),baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",thumbnailUrl:n.getAssetUrl("esri/images/basemap/satellite.jpg"),baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",thumbnailUrl:n.getAssetUrl("esri/images/basemap/hybrid.jpg"),baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",thumbnailUrl:n.getAssetUrl("esri/images/basemap/terrain.jpg"),baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",thumbnailUrl:n.getAssetUrl("esri/images/basemap/topo.jpg"),baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",thumbnailUrl:n.getAssetUrl("esri/images/basemap/gray.jpg"),baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",thumbnailUrl:n.getAssetUrl("esri/images/basemap/dark-gray.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",thumbnailUrl:n.getAssetUrl("esri/images/basemap/oceans.jpg"),baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",thumbnailUrl:n.getAssetUrl("esri/images/basemap/national-geographic.jpg"),baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",thumbnailUrl:n.getAssetUrl("esri/images/basemap/osm.jpg"),baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/gray-vector.jpg"),baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/streets-vector.jpg"),baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/topo-vector.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/streets-night.jpg"),baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/streets-relief.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",showLegend:!1,visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",thumbnailUrl:n.getAssetUrl("esri/images/basemap/streets-navigation.jpg"),baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(488),r(169),r(156),r(172),r(179),r(1141)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=i.getLogger("esri.support.basemapUtils");function c(e,t){var n;if("string"==typeof e){if(!(e in s.esriBasemapDefinitions)){var i=Object.keys(s.esriBasemapDefinitions).map((function(e){return'"'+e+'"'})).join(", ");return l.warn("Unable to find basemap definition for: "+e+". Try one of these: "+i),null}t&&(n=t[e]),n||(n=r.fromId(e),t&&(t[e]=n))}else n=a.default(r,e);return n}function u(e,t){var r=new n;return e.forEach((function(e){var n=t.find((function(t){return g(h(e),h(t))}))||e;r.some((function(e){return e===n}))?r.push(e):r.push(n)})),r}function p(e){return e?!e.loaded&&e.resourceInfo?f(e.resourceInfo.data):{baseLayers:d(e.baseLayers),referenceLayers:d(e.referenceLayers)}:null}function d(e){return(n.isCollection(e)?e.toArray():e).map(h)}function h(e){return{type:e.type,url:_("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible}}function f(e){return e?{baseLayers:v(e.baseMapLayers.filter((function(e){return!e.isReference}))),referenceLayers:v(e.baseMapLayers.filter((function(e){return e.isReference})))}:null}function v(e){return e.map((function(e){return function(e){var t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:_(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility}}(e)}))}function m(e,t,r){return null!=e!=(null!=t)?"not-equal":e?y(e.baseLayers,t.baseLayers)?y(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function y(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!g(e[r],t[r]))return!1;return!0}function g(e,t){return e.type===t.type&&e.url===t.url&&e.minScale===t.minScale&&e.maxScale===t.maxScale&&e.visible===t.visible&&e.opacity===t.opacity}function _(e){return e?o.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}t.createCache=function(){return{}},t.ensureType=c,t.clonePreservingTiledLayers=function(e,t){void 0===t&&(t=null);var n=c(e);if(!n)return null;var i=new r({id:n.id,title:n.title,baseLayers:n.baseLayers.slice(),referenceLayers:n.referenceLayers.slice()});return t&&(i.baseLayers=u(i.baseLayers,t.baseLayers),i.referenceLayers=u(i.referenceLayers,t.referenceLayers)),i.load().catch((function(){})),i.portalItem=n.portalItem,i},t.getWellKnownBasemapId=function(e){var t=null,r=p(e);for(var n in s.esriBasemapDefinitions){var i=m(r,f(s.esriBasemapDefinitions[n]),{mustMatchReferences:!1});if("equal"===i){t=n;break}"base-layers-equal"===i&&(t=n)}return t},t.contentEquals=function(e,t){return e===t||"equal"===m(p(e),p(t),{mustMatchReferences:!0})}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(476),r(167),r(157),r(151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s={widthBreakpoint:{getValue:function(e){var t=e.viewSize[0],r=e.breakpoints,n=this.values;return t<=r.xsmall?n.xsmall:t<=r.small?n.small:t<=r.medium?n.medium:t<=r.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(e){var t=e.viewSize[1],r=e.breakpoints,n=this.values;return t<=r.xsmall?n.xsmall:t<=r.small?n.small:t<=r.medium?n.medium:t<=r.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(e){var t=e.viewSize,r=t[0],n=t[1],i=this.values;return n>=r?i.portrait:i.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},l={xsmall:544,small:768,medium:992,large:1200};function c(e,t){return t?s[e].valueToClassName[t].split(" "):[]}t.BreakpointsOwner=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._breakpointsHandles=new i,n.orientation=null,n.widthBreakpoint=null,n.heightBreakpoint=null,n.breakpoints=l,n}return r.__extends(t,e),t.prototype.initialize=function(){this._breakpointsHandles.add(o.init(this,["breakpoints","size"],this._updateClassNames))},t.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)},Object.defineProperty(t.prototype,"breakpoints",{set:function(e){if(e!==this._get("breakpoints")){var t,n=(t=e)&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large;if(!n){var i=JSON.stringify(l,null,2);console.warn("provided breakpoints are not valid, using defaults:"+i)}e=n?e:l,this._set("breakpoints",r.__assign({},e))}},enumerable:!0,configurable:!0}),t.prototype._updateClassNames=function(){if(this.container){var e,t=n.acquire(),r=n.acquire(),i=!1;for(e in s){var o=this[e],a=s[e].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(i=!0,this[e]=a,c(e,o).forEach((function(e){return r.push(e)})),c(e,a).forEach((function(e){return t.push(e)})))}i&&(this._applyClassNameChanges(t,r),n.release(t),n.release(r))}},t.prototype._applyClassNameChanges=function(e,t){var r=this.container;r&&(t.forEach((function(e){return r.classList.remove(e)})),e.forEach((function(e){return r.classList.add(e)})))},t.prototype._removeActiveClassNames=function(){var e,t=this.container;if(t)for(e in s)c(e,this[e]).forEach((function(e){return t.classList.remove(e)}))},r.__decorate([a.property()],t.prototype,"breakpoints",null),r.__decorate([a.property()],t.prototype,"orientation",void 0),r.__decorate([a.property()],t.prototype,"widthBreakpoint",void 0),r.__decorate([a.property()],t.prototype,"heightBreakpoint",void 0),r.__decorate([a.subclass("esri.views.BreakpointsOwner")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(167),r(157),r(157),r(151)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._anchorHandles=new i,n.location=null,n.screenLocation=null,n.screenLocationEnabled=!1,n.view=null,n._anchorHandles.add([a.watch(n,["screenLocationEnabled","location","view.size","view.stationary"],(function(){return n._updateScreenPointAndHandle()})),a.watch(n,["view","view.ready"],(function(){return n._wireUpView()}))]),n}return r.__extends(t,e),t.prototype.destroy=function(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null},t.prototype._wireUpView=function(){var e=this;if(this._anchorHandles.remove("view"),this._viewpointHandle=null,this.get("view.ready")){this._setScreenLocation();var t=this.view,r="3d"===t.type?"camera":"viewpoint",n=o.pausable(t,r,(function(){return e._viewpointChange()}));this._anchorHandles.add(n,"view"),this._viewpointHandle=n,this._toggleWatchingViewpoint()}},t.prototype._viewpointChange=function(){this._setScreenLocation(),this.emit("view-change")},t.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation(),this._toggleWatchingViewpoint()},t.prototype._toggleWatchingViewpoint=function(){var e=this._viewpointHandle,t=this.location,r=this.screenLocationEnabled;e&&(t&&r?e.resume():e.pause())},t.prototype._setScreenLocation=function(){var e=this.location,t=this.view,r=this.screenLocationEnabled,n=this.get("view.ready"),i=r&&e&&n?t.toScreen(e):null;this._set("screenLocation",i)},r.__decorate([s.property()],t.prototype,"location",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"screenLocation",void 0),r.__decorate([s.property()],t.prototype,"screenLocationEnabled",void 0),r.__decorate([s.property()],t.prototype,"view",void 0),r.__decorate([s.subclass("esri.widgets.support.AnchorElementViewModel")],t)}(n.EventedAccessor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(270),r(164)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.primaryKey=n("mac")?"Meta":"Ctrl";for(var i={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"},o=48;o<58;o++)i[o]=String.fromCharCode(o);for(o=1;o<25;o++)i[111+o]="F"+o;for(o=65;o<91;o++)i[o]=[String.fromCharCode(o+32),String.fromCharCode(o)];t.eventKey=function(e){if(void 0!==e.key)return r.eventKey(e);var t=i[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t},t.isSystemModifier=function(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(639),r(412)],void 0===(i=function(e,t,r,n){function i(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function c(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function p(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function d(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.length=i,t.copy=o,t.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=a,t.multiply=s,t.divide=l,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},t.distance=c,t.squaredDistance=u,t.squaredLength=p,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=d,t.dot=h,t.cross=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2];return e[0]=i*l-o*s,e[1]=o*a-n*l,e[2]=n*s-i*a,e},t.lerp=function(e,t,r,n){var i=t[0],o=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e},t.hermite=function(e,t,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),u=a*(3-2*o);return e[0]=t[0]*s+r[0]*l+n[0]*c+i[0]*u,e[1]=t[1]*s+r[1]*l+n[1]*c+i[1]*u,e[2]=t[2]*s+r[2]*l+n[2]*c+i[2]*u,e},t.bezier=function(e,t,r,n,i,o){var a=1-o,s=a*a,l=o*o,c=s*a,u=3*o*s,p=3*l*a,d=l*o;return e[0]=t[0]*c+r[0]*u+n[0]*p+i[0]*d,e[1]=t[1]*c+r[1]*u+n[1]*p+i[1]*d,e[2]=t[2]*c+r[2]*u+n[2]*p+i[2]*d,e},t.random=function(e,t){t=t||1;var r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=i*t,e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12],e[1]=r[1]*n+r[5]*i+r[9]*o+r[13],e[2]=r[2]*n+r[6]*i+r[10]*o+r[14],e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e},t.transformQuat=function(e,t,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=t[0],l=t[1],c=t[2],u=i*c-o*l,p=o*s-n*c,d=n*l-i*s,h=i*d-o*p,f=o*u-n*d,v=n*p-i*u,m=2*a;return u*=m,p*=m,d*=m,h*=2,f*=2,v*=2,e[0]=s+u+h,e[1]=l+p+f,e[2]=c+d+v,e},t.rotateX=function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},t.rotateY=function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},t.rotateZ=function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},t.angle=function(e,t){o(f,e),o(v,t),d(f,f),d(v,v);var r=h(f,v);return r>1?0:r<-1?Math.PI:Math.acos(r)};var f=r.create(),v=r.create();t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],a=t[0],s=t[1],l=t[2];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},t.sub=a,t.mul=s,t.div=l,t.dist=c,t.sqrDist=u,t.len=i,t.sqrLen=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(152),r(153),r(151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.PopupView=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.fetchPopupFeatures=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,a,s,l,c,u,p,d,h;return r.__generator(this,(function(f){switch(f.label){case 0:return[4,this.when()];case 1:return f.sent(),[4,this._prepareFetchPopupFeatures(e,t)];case 2:return i=f.sent(),a=i.location,s=i.queryArea,l=i.layerViewsAndGraphics,c=i.clientOnlyGraphics,u=o.resolve(c),p=this._queryLayerPopupFeatures({queryArea:s,layerViewsAndGraphics:l,options:t}),d=p.map((function(e){return e.promise})),h=o.eachAlwaysValues(r.__spreadArrays([u],d)).then(n.flatten),[2,{location:a,clientOnlyGraphics:c,allGraphicsPromise:h,promisesPerLayerView:p}]}}))}))},t.prototype._queryLayerPopupFeatures=function(e){var t=e.queryArea,r=e.layerViewsAndGraphics,n=e.options;return r.map((function(e){var r=e.layerView,o={clientGraphics:e.graphics,event:i.isSome(n)?n.event:null,signal:i.isSome(n)?n.signal:null,defaultPopupTemplateEnabled:!!i.isSome(n)&&!!n.defaultPopupTemplateEnabled},a=r.fetchPopupFeatures(t,o);return{layerView:r,promise:a}}))},t.prototype._isValidPopupGraphic=function(e,t){return e&&!!e.getEffectivePopupTemplate(i.isSome(t)&&t.defaultPopupTemplateEnabled)},t.prototype._prepareFetchPopupFeatures=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._popupHitTestGraphics(e,t)];case 1:return n=r.sent(),i=n.clientGraphics,o=n.queryArea,a=n.location,s=this._getFetchPopupLayerViews(),l=this._graphicsPerFetchPopupLayerView(i,s),c=l.layerViewsAndGraphics,[2,{clientOnlyGraphics:l.clientOnlyGraphics,layerViewsAndGraphics:c,queryArea:o,location:a}]}}))}))},t.prototype._popupHitTestGraphics=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.popupHitTest(e)];case 1:return n=r.sent(),i=n.results,o=n.mapPoint,a=i.filter((function(e){return l._isValidPopupGraphic(e.graphic,t)})),s=a.length?a[0].mapPoint:null,[2,{clientGraphics:a.map((function(e){return e.graphic})),queryArea:o,location:o||s}]}}))}))},t.prototype._getFetchPopupLayerViews=function(){var e=this,t=[];return this.allLayerViews.forEach((function(r){e._isValidPopupLayerView(r)&&t.push(r)})),i.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()},t.prototype._isValidPopupLayerView=function(e){return i.isSome(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e},t.prototype._graphicsPerFetchPopupLayerView=function(e,t){for(var r=[],n=new Map,i=t.map((function(e){var t=[];return"layer"in e?n.set(e.layer,t):n.set(e.graphics,t),{layerView:e,graphics:t}})),o=0,a=e;o<a.length;o++){var s=a[o],l=n.get(s.layer)||null;l?l.push(s):r.push(s)}return{layerViewsAndGraphics:i,clientOnlyGraphics:r}},r.__decorate([a.subclass("esri.views.PopupView")],t)}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(174),r(169),r(254),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=i.ofType(n),c=function(e){function t(t){var r=e.call(this,t)||this;return r.on("before-add",(function(e){e.item||e.preventDefault()})),r.on("after-add",(function(e){return r._own(e.item)})),r.on("after-remove",(function(e){e.item.layer=null})),r}return r.__extends(t,e),t.prototype.destroy=function(){this._unownAll()},Object.defineProperty(t.prototype,"owner",{get:function(){return this._get("owner")},set:function(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())},enumerable:!0,configurable:!0}),t.prototype._createNewInstance=function(e){return new l(e)},t.prototype._ownAll=function(){var e=this;this.items.forEach((function(t){return e._own(t)}))},t.prototype._own=function(e){e.layer&&"group"!==e.layer.type&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner},t.prototype._unownAll=function(){var e=this;this.items.forEach((function(t){return e._unown(t)}))},t.prototype._unown=function(e){e.layer===this.owner&&(e.layer=null)},r.__decorate([a.property()],t.prototype,"owner",null),r.__decorate([a.subclass("esri.support.GraphicsCollection")],t)}(l);t.GraphicsCollection=c,t.castGraphicsCollection=function(e){var t=s.default(c,e);return t&&(t.owner=this),t},t.graphicsCollectionProperty={type:c,cast:o.castForReferenceSetter,set:function(e){var t=o.referenceSetter(e,this._get("graphics"),c);t.owner=this,this._set("graphics",t)}},t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(168),r(171),r(241),r(637)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.eventTypes=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"];var l={};function c(e){return!!l[e]}t.eventTypes.forEach((function(e){l[e]=!0}));var u=function(){function e(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}return e.prototype.connect=function(e){var t=this;e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((function(e,r){var n=e.handler,i=e.priority;return t.inputManager.installHandlers(r,[n],i)}))},e.prototype.disconnect=function(){var e=this;this.inputManager&&this.handlers.forEach((function(t,r){return e.inputManager.uninstallHandlers(r)})),this.inputManager=null},e.prototype.destroy=function(){this.disconnect(),this.handlers.clear(),this.view=null},e.prototype.on=function(e,t,r,n){var i,o,a=this,l=Array.isArray(e)?e:e.split(",");if(!function(e){for(var t=0,r=e;t<r.length;t++)if(!c(r[t]))return!1;return!0}(l))return l.some(c)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;Array.isArray(t)?o=t:(i=t,o=[]),"function"==typeof r?i=r:n=r,n=null!=n?n:s.ViewEventPriorities.DEFAULT;var u=this.createUniqueGroupName(),d=new p(this.view,l,o,i);this.handlers.set(u,{handler:d,priority:n});for(var h=0,f=l;h<f.length;h++){var v=f[h],m=this.handlerCounts.get(v)||0;this.handlerCounts.set(v,m+1)}return this.inputManager&&this.inputManager.installHandlers(u,[d],n),{remove:function(){return a.removeHandler(u,l)}}},e.prototype.hasHandler=function(e){return!!this.handlerCounts.get(e)},e.prototype.removeHandler=function(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(var r=0,n=t;r<n.length;r++){var i=n[r],o=this.handlerCounts.get(i);void 0===o?console.error("Trying to remove handler for event that has no handlers registered: ",i):1===o?this.handlerCounts.delete(i):this.handlerCounts.set(i,o-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)},e.prototype.createUniqueGroupName=function(){return this.counter+=1,"viewEvents_"+this.counter},e}();t.ViewEvents=u;var p=function(e){function t(t,r,i,o){var a=e.call(this,!0)||this;a.view=t;for(var s=0,l=r;s<l.length;s++){var c=l[s];switch(c){case"click":a.registerIncoming("click",i,(function(e){return o(a.wrapClick(e))}));break;case"double-click":a.registerIncoming("double-click",i,(function(e){return o(a.wrapDoubleClick(e))}));break;case"immediate-click":a.registerIncoming("immediate-click",i,(function(e){return o(a.wrapImmediateClick(e))}));break;case"immediate-double-click":a.registerIncoming("immediate-double-click",i,(function(e){return o(a.wrapImmediateDoubleClick(e))}));break;case"hold":a.registerIncoming("hold",i,(function(e){return o(a.wrapHold(e))}));break;case"drag":a.registerIncoming("drag",i,(function(e){var t=a.wrapDrag(e);t&&o(t)}));break;case"key-down":a.registerIncoming("key-down",i,(function(e){return o(a.wrapKeyDown(e))}));break;case"key-up":a.registerIncoming("key-up",i,(function(e){return o(a.wrapKeyUp(e))}));break;case"pointer-down":a.registerIncoming("pointer-down",i,(function(e){return o(a.wrapPointer(e,"pointer-down"))}));break;case"pointer-move":a.registerIncoming("pointer-move",i,(function(e){return o(a.wrapPointer(e,"pointer-move"))}));break;case"pointer-up":a.registerIncoming("pointer-up",i,(function(e){return o(a.wrapPointer(e,"pointer-up"))}));break;case"pointer-drag":a.registerIncoming("pointer-drag",i,(function(e){return o(a.wrapPointerDrag(e))}));break;case"mouse-wheel":a.registerIncoming("mouse-wheel",i,(function(e){return o(a.wrapMouseWheel(e))}));break;case"pointer-enter":a.registerIncoming("pointer-enter",i,(function(e){return o(a.wrapPointer(e,"pointer-enter"))}));break;case"pointer-leave":a.registerIncoming("pointer-leave",i,(function(e){return o(a.wrapPointer(e,"pointer-leave"))}));break;case"gamepad":a.registerIncoming("gamepad",i,(function(e){o(a.wrapGamepad(e))}));break;case"focus":a.registerIncoming("focus",i,(function(e){o(a.wrapFocus(e))}));break;case"blur":a.registerIncoming("blur",i,(function(e){o(a.wrapBlur(e))}));break;default:n.neverReached(c)}}return a}return r.__extends(t,e),t.prototype.wrapFocus=function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapBlur=function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapClick=function(e){var t=e.data,r=t.pointerType,n=t.button,i=t.buttons,a=t.x,s=t.y,l=t.native,c=t.eventId,u=e.cancelable;return{type:"click",pointerType:r,button:n,buttons:i,x:a,y:s,native:l,timestamp:e.timestamp,screenPoint:o.createScreenPoint(a,s),mapPoint:this.getMapPoint(a,s),eventId:c,cancelable:u,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapDoubleClick=function(e){var t=e.data,r=t.pointerType,n=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,l=t.eventId,c=e.cancelable;return{type:"double-click",pointerType:r,button:n,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:l,cancelable:c,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapImmediateClick=function(e){var t=e.data,r=t.pointerType,n=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,l=t.eventId,c=s.pointerId,u=e.cancelable;return{type:"immediate-click",pointerId:c,pointerType:r,button:n,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:l,cancelable:u,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapImmediateDoubleClick=function(e){var t=e.data,r=t.pointerType,n=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,l=t.eventId,c=s.pointerId,u=e.cancelable;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:n,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:l,cancelable:u,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapHold=function(e){var t=e.data,r=t.pointerType,n=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,l=e.cancelable;return{type:"hold",pointerType:r,button:n,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),cancelable:l,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.getMapPoint=function(e,t){return this.view.toMap(o.createScreenPoint(e,t),{exclude:[]})},t.prototype.wrapDrag=function(e){var t=e.data,r=t.center,n=r.x,o=r.y,a=t.action,s=t.pointerType,l=t.button;if("start"===a&&(this.latestDragStart=t),this.latestDragStart){var c=t.pointer.native,u=t.buttons,p=e.cancelable,d=e.timestamp,h={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===a&&(this.latestDragStart=void 0),{type:"drag",action:a,x:n,y:o,origin:h,pointerType:s,button:l,buttons:u,radius:t.radius,angle:i.rad2deg(t.angle),native:c,timestamp:d,cancelable:p,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}}},t.prototype.wrapKeyDown=function(e){var t=e.data,r=t.key,n=t.repeat,i=t.native,o=e.cancelable;return{type:"key-down",key:r,repeat:n,native:i,timestamp:e.timestamp,cancelable:o,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapKeyUp=function(e){var t=e.data,r=t.key,n=t.native,i=e.cancelable;return{type:"key-up",key:r,native:n,timestamp:e.timestamp,cancelable:i,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapPointer=function(e,t){var r=e.data,n=r.x,i=r.y,o=r.button,a=r.buttons,s=r.native,l=r.eventId,c=s.pointerId,u=s.pointerType,p=e.cancelable;return{type:t,x:n,y:i,pointerId:c,pointerType:u,button:o,buttons:a,native:s,timestamp:e.timestamp,eventId:l,cancelable:p,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapPointerDrag=function(e){var t=e.data.currentEvent,r=t.x,n=t.y,i=t.buttons,o=t.native,a=t.eventId,s=e.data.startEvent.button,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},d=e.cancelable;return{type:"pointer-drag",x:r,y:n,pointerId:l,pointerType:c,button:s,buttons:i,action:u,origin:p,native:o,timestamp:e.timestamp,eventId:a,cancelable:d,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapMouseWheel=function(e){var t=e.cancelable,r=e.data,n=e.timestamp;return{type:"mouse-wheel",x:r.x,y:r.y,deltaY:r.deltaY,native:r.native,timestamp:n,cancelable:t,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t.prototype.wrapGamepad=function(e){var t=e.data,r=t.action,n=t.state,i=t.device,o=e.cancelable;return{type:"gamepad",device:i,timestamp:e.timestamp,action:r,buttons:n.buttons,axes:n.axes,cancelable:o,stopPropagation:function(){return e.stopPropagation()},preventDefault:function(){return e.preventDefault()}}},t}(a.InputHandler)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(169),r(152),r(909)],void 0===(i=function(e,t,r,n,i){function o(e,t){var r=e.view;r&&(t&&r.ready&&r.activeTool!==e?(r.activeTool=e,i.isDOMContainer(r)&&r.focus()):t||r.activeTool!==e||(r.activeTool=null))}Object.defineProperty(t,"__esModule",{value:!0}),t.setActive=o,t.swap=function(e,t,r){var i=e.activeTool;t!==i&&(n.isSome(i)&&i.deactivate&&i.deactivate(),r(t),n.isSome(t)&&t.activate&&t.activate())},t.newToolCollection=function(){var e=new r;return e.on("after-add",(function(e){var t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(function(e){var t=e.item;o(t,!1),t.destroyed||t.detach()})),e},t.areToolManipulatorsEditable=function(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))},t.evaluateToolConstructorArguments=function(e){return n.isNone(e)?{}:"function"==typeof e?e():e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(154),r(436),r(324)],void 0===(i=function(e,t,r,n,i,o){function a(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function s(e){var t=e.url&&o.parse(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&t&&"ImageServer"===t.serverType||!l(e)||!e.heightModelInfo?u(e)?i.deriveUnitFromSR(d,e.spatialReference):null:e.heightModelInfo}function l(e){return"heightModelInfo"in e}function c(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"tile":case"vector-tile":case null:return!1;default:return r.neverReached(e),!1}}function u(e){return c(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):p(e)}function p(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"web-tile":case"wms":case"wmts":case null:return!1;default:r.neverReached(e)}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.validateWebSceneError=function(e,t){if(!e)return null;if(!a(e))return new n("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});var r=e.heightUnit,o=i.deriveUnitFromSR(e,t).heightUnit;return r!==o?new n("webscene:incompatible-height-unit","The vertical units of the scene ("+r+") must match the horizontal units of the scene ("+o+")",{verticalUnit:r,horizontalUnit:o}):null},t.rejectLayerError=function(e,t,r){var o=s(e),l=t,c=function(e,t,r){if(!a(e)||!a(t))return 4;if(null==e||null==t)return 0;if(!r&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}(o,l,r),p=null;if(o){var d=i.deriveUnitFromSR(o,e.spatialReference).heightUnit;r||d===o.heightUnit||(p=new n("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units ("+d+")",{horizontalUnit:d}))}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!u(e)}(e)||4===c||p)return new n("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o,error:p});switch(p=null,c){case 1:var h=o.heightUnit||"unknown",f=l.heightUnit||"unknown";p=new n("layerview:incompatible-height-unit","The vertical units of the layer ("+h+") must match the vertical units of the scene ("+f+")",{layerUnit:h,sceneUnit:f});break;case 2:var v=o.heightModel||"unknown",m=l.heightModel||"unknown";p=new n("layerview:incompatible-height-model","The height model of the layer ("+v+") must match the height model of the scene ("+m+")",{layerHeightModel:v,sceneHeightModel:m});break;case 3:var y=o.vertCRS||"unknown",g=l.vertCRS||"unknown";p=new n("layerview:incompatible-vertical-datum","The vertical datum of the layer ("+y+") must match the vertical datum of the scene ("+g+")",{layerDatum:y,sceneDatum:g})}return p?new n("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:p}):null},t.deriveHeightModelInfoFromLayer=s,t.mayHaveHeightModelInfo=function(e){return null!=e.layers||p(e)||c(e)||l(e)};var d=new i({heightModel:"gravity-related-height"})}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._names=new Map}return e.prototype.begin=function(e){this._names.has(e)||(this._names.set(e,!1),function(e){return-1!==e.indexOf("Brush")}(e)&&this.record("Esri.FirstDraw"),performance.mark("Esri."+e+".Start"))},e.prototype.end=function(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark("Esri."+e+".End"))},e.prototype.record=function(e){this._names.has(e)||(this._names.set(e,!0),performance.mark("Esri."+e))},e}();t.Timeline=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162)],void 0===(i=function(e,t,r){function n(e){var t=e*e;return e<0&&(t*=-1),t}Object.defineProperty(t,"__esModule",{value:!0}),t.quadraticAccentuation=n,t.resetTransformation=function(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e},t.extractTransformation=function(e,t,i){var o=i,a=e.state,s=e.device,l="forward-down"===t.tiltDirection?1:-1;return"standard"===s.deviceType?(o.translation[0]=n(a.axes[0]),o.translation[1]=n(a.axes[1]),o.translation[2]=n(a.buttons[7])-n(a.buttons[6]),o.heading=n(a.axes[2]),o.tilt=n(a.axes[3])):"spacemouse"===s.deviceType&&(o.translation[0]=1.2*n(a.axes[0]),o.translation[1]=1.2*n(a.axes[1]),o.translation[2]=2*-n(a.axes[2]),o.heading=1.2*n(a.axes[5]),o.tilt=1.2*n(a.axes[3])),o.tilt*=l,r.vec3.scale(o.translation,o.translation,1),o},t.extractTransformationKeyboard=function(e,t){var r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r},t.isZeroTransformation=function(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(171),r(575),r(1145),r(1572)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=r("trident"),l=r("edge"),c=r("chrome"),u=r("ff"),p=r("safari"),d="esri-view-surface--touch-none",h="esri-view-surface--touch-pan",f=function(){function e(e,t){var r=this;this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,i.applyLocal(e),e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new a.GamepadSource(e,this.input),this._gamepadSource.onEvent=function(e){return r._callback("gamepad",e)}}return e.prototype.destroy=function(){var e=this;this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((function(t){e._releasePointerCaptureSafe(t)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)},Object.defineProperty(e.prototype,"browserTouchPanningEnabled",{get:function(){return this._browserTouchPanningEnabled},set:function(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onEventReceived",{set:function(e){this._callback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeEvents",{set:function(e){var t=this;for(var r in this._active)if(!e||!e.has(r)){var n=this._active[r];this._element.removeEventListener(v[r],n),delete this._active[r]}e&&e.forEach((function(e){if(!t._active[e]&&v[e]){var r=(t._eventHandlers[e]||t._handleDefault).bind(t,e);t._element.addEventListener(v[e],r),t._active[e]=r}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")},enumerable:!0,configurable:!0}),e.prototype.setPointerCapture=function(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))},e.prototype._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?d:h),this._element.classList.add(this._browserTouchPanningEnabled?h:d)},e.prototype._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)},e.prototype._removeTouchAction=function(){this._element.classList.remove(d),this._element.classList.remove(h),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)},e.prototype._releasePointerCaptureSafe=function(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(e){}},e.prototype._updateNormalizedPointerLikeEvent=function(t,r){var i=n.createScreenPointFromNativeEvent(this._element,t);return e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r},e.prototype._handleKey=function(e,t){var r=o.eventKey(t);r&&"key-up"===e&&this._keyDownState.delete(r);var n={native:t,key:r,repeat:r&&this._keyDownState.has(r)};r&&"key-down"===e&&this._keyDownState.add(n.key),this._callback(e,n)},e.prototype._handlePointer=function(e,t){var r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,r)},e.prototype._handlePointerPreventDefault=function(e,t){var r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,r)},e.prototype._handleMouseWheel=function(e,t){var r=t.deltaY;switch(t.deltaMode){case 0:(s||l)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}s||l?r*=.7:c||p?r*=.6:u&&(r*=1.375);var n=Math.abs(r);n>100&&(r=r/n*200/(1+Math.exp(-.02*(n-100))));var i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:r});this._callback(e,i)},e.prototype._handlePointerCaptureLost=function(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)},e.prototype._handleDefault=function(e,t){var r={native:t};t.preventDefault(),this._callback(e,r)},e.prototype._preventAltKeyDefault=function(e){"Alt"===e.key&&e.preventDefault()},e.prototype._preventMultiTouchPanning=function(e){e.touches.length>1&&e.preventDefault()},e.test={disableSubpixelCoordinates:!1},e}();t.BrowserEventSource=f;var v={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this,!0)||this;return t.registerIncoming("context-menu",(function(e){e.data.native.preventDefault()})),t}return r.__extends(t,e),t}(n.InputHandler);t.PreventContextMenu=i,t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(235),r(241),r(642)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,!1)||this;return r.navigationTouch=t,r.startStateModifiers=new Set,r.activePointerMap=new Map,r.isDragging=!1,r.isCurrentDragSuppressed=!1,r.drag=r.registerOutgoing("drag"),r.registerIncoming("pointer-drag",r.handlePointerDrag.bind(r)),r.registerIncoming("pointer-up",r.handlePointerUpAndPointerLost.bind(r)),r.registerIncoming("pointer-capture-lost",r.handlePointerUpAndPointerLost.bind(r)),r.registerIncoming("pointer-cancel",r.handlePointerUpAndPointerLost.bind(r)),r}return r.__extends(t,e),t.prototype.createPayload=function(e,t,r,n){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:n,pointers:u(this.activePointerMap),pointer:t,angle:r.angle,radius:r.radius,center:r.center}},t.prototype.addPointer=function(e){var t=e.native.pointerId,r=c(this.activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,n);var i=p(n,l(this.activePointerMap));n.initialAngle=i,n.lastAngle=i,this.updatePointerAngles(r)},t.prototype.updatePointer=function(e){if(!e||null!=e.x||null!=e.y){var t=e.native.pointerId,r=this.activePointerMap.get(t);r?r.event=e:this.addPointer(e)}},t.prototype.removePointer=function(e){var t=c(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)},t.prototype.updatePointerAngles=function(e){var t=c(this.activePointerMap);this.activePointerMap.forEach((function(r){r.initialAngle=p(r,t)-e,r.lastAngle=p(r,t)-e}))},t.prototype.emitEvent=function(e,t,r){var n=c(this.activePointerMap);this.drag.emit(this.createPayload(e,t,n,r),void 0,this.startStateModifiers)},t.prototype.handlePointerUpAndPointerLost=function(e){var t=e.data.native.pointerId,r=i.Milliseconds(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,i.Milliseconds(e.timestamp))))},t.prototype.handlePointerDrag=function(e){var t=e.data,r=t.currentEvent,n=i.Milliseconds(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this.updatePointer(r),!this.isCurrentDragSuppressed&&this.emitEvent("update",r,n)):(this.addPointer(r),this.emitEvent("added",r,n),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(r),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",r,n))}},Object.defineProperty(t.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!0,configurable:!0}),t}(o.InputHandler);function l(e){var t=[];return e.forEach((function(e){t.push(n.createScreenPoint(e.event.x,e.event.y))})),a.fitCircleLSQ(t)}function c(e){var t=l(e),r=0;return e.forEach((function(e){for(var n=p(e,t),i=n-e.lastAngle;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;n=e.lastAngle+i,e.lastAngle=n;var o=n-e.initialAngle;r+=o})),{angle:r/=e.size||1,radius:t.radius,center:t.center}}function u(e){var t=new Map;return e.forEach((function(e,r){return t.set(r,e.event)})),t}function p(e,t){var r=e.event,n=r.x-t.center.x,i=r.y-t.center.y;return Math.atan2(i,n)}t.Drag=s,function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(t.Button||(t.Button={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(618),r(241),r(793),r(642)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,i,a,s){void 0===t&&(t=o.DefaultParameters.maximumDoubleClickDelay),void 0===r&&(r=o.DefaultParameters.maximumDoubleClickDistance),void 0===i&&(i=o.DefaultParameters.maximumDoubleTouchDelay),void 0===a&&(a=o.DefaultParameters.maximumDoubleTouchDistance),void 0===s&&(s=n.default);var l=e.call(this,!1)||this;return l.maximumDoubleClickDelay=t,l.maximumDoubleClickDistance=r,l.maximumDoubleTouchDelay=i,l.maximumDoubleTouchDistance=a,l._clock=s,l._pointerState=new Map,l._immediateDoubleClick=l.registerOutgoing("immediate-double-click"),l.registerIncoming("pointer-down",l._handlePointerDown.bind(l)),l.registerIncoming("pointer-up",(function(e){l._handlePointerLoss(e,"pointer-up")})),l.registerIncoming("pointer-capture-lost",(function(e){l._handlePointerLoss(e,"pointer-capture-lost")})),l.registerIncoming("pointer-cancel",(function(e){l._handlePointerLoss(e,"pointer-cancel")})),l}return r.__extends(t,e),t.prototype.onUninstall=function(){this._pointerState.forEach((function(e){e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),e.prototype.onUninstall.call(this)},t.prototype._handlePointerDown=function(e){var t=e.data,r=this._pointerId(t);if(!this._pointerState.has(r)){var n={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(t.native)}},t.prototype._handlePointerLoss=function(e,t){var r=e.data,n=this._pointerId(r),i=this._pointerState.get(n);if(i&&"pointer-up"===t&&i.downButton===r.native.button){var o=i.immediateDoubleClick;if(o){o.timeoutHandle.remove();var s="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;a.manhattanDistance(o,e.data)>s?this._startImmediateDoubleClick(e,i):(this._immediateDoubleClick.emit(e.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,i)}},t.prototype._startImmediateDoubleClick=function(e,t){var r=this,n="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((function(){return r._removeState(e.data)}),n)}},t.prototype._pointerId=function(e){var t=e.native;return"mouse"===t.pointerType?t.pointerId+":"+t.button:""+t.pointerType},t.prototype._removeState=function(e){var t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()},t}(i.InputHandler);t.ImmediateDoubleClick=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(618),r(241),r(642)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};var a=function(e){function i(r,i,o,a,s,l){void 0===r&&(r=t.DefaultParameters.maximumClickDelay),void 0===i&&(i=t.DefaultParameters.movementUntilMouseDrag),void 0===o&&(o=t.DefaultParameters.movementUntilPenDrag),void 0===a&&(a=t.DefaultParameters.movementUntilTouchDrag),void 0===s&&(s=t.DefaultParameters.holdDelay),void 0===l&&(l=n.default);var c=e.call(this,!1)||this;return c.maximumClickDelay=r,c.movementUntilMouseDrag=i,c.movementUntilPenDrag=o,c.movementUntilTouchDrag=a,c.holdDelay=s,c._clock=l,c._pointerState=new Map,c._pointerDrag=c.registerOutgoing("pointer-drag"),c._immediateClick=c.registerOutgoing("immediate-click"),c._pointerHold=c.registerOutgoing("hold"),c.registerIncoming("pointer-down",c._handlePointerDown.bind(c)),c.registerIncoming("pointer-up",(function(e){c._handlePointerLoss(e,"pointer-up")})),c.registerIncoming("pointer-capture-lost",(function(e){c._handlePointerLoss(e,"pointer-capture-lost")})),c.registerIncoming("pointer-cancel",(function(e){c._handlePointerLoss(e,"pointer-cancel")})),c._moveHandle=c.registerIncoming("pointer-move",c._handlePointerMove.bind(c)),c._moveHandle.pause(),c}return r.__extends(i,e),i.prototype.onUninstall=function(){this._pointerState.forEach((function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),e.prototype.onUninstall.call(this)},i.prototype._handlePointerDown=function(e){var t=this,r=e.data,n=r.native.pointerId,i=null;0===this._pointerState.size&&(i=this._clock.setTimeout((function(){var r=t._pointerState.get(n);if(r){if(!r.isDragging){var i=r.previousEvent;t._pointerHold.emit(i,void 0,e.modifiers),r.holdEmitted=!0}r.holdTimeout=null}}),this.holdDelay));var o={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:i,modifiers:new Set};this._pointerState.set(n,o),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)},i.prototype._createPointerDragData=function(e,t,r){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:r}},i.prototype._handlePointerMove=function(e){var t=e.data,r=t.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,t),void 0,n.modifiers):o.euclideanDistance(t,n.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),n.previousEvent=t)},i.prototype._getDragThreshold=function(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}},i.prototype.startDragging=function(e){var t=this,r=e.data,n=r.native.pointerId;this._pointerState.forEach((function(i){null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging||(i.modifiers=e.modifiers,i.isDragging=!0,n===i.startEvent.native.pointerId?t._pointerDrag.emit(t._createPointerDragData("start",i,r)):t._pointerDrag.emit(t._createPointerDragData("start",i,i.previousEvent),e.timestamp))}))},i.prototype._handlePointerLoss=function(e,t){var r=e.data,n=r.native.pointerId,i=this._pointerState.get(n);i&&(null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",i,"pointer-up"===t?r:i.previousEvent),void 0,i.modifiers):"pointer-up"===t&&i.downButton===r.native.button&&e.timestamp-i.startTimestamp<=this.maximumClickDelay&&!i.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),0===this._pointerState.size&&this._moveHandle.pause())},i}(i.InputHandler);t.PointerClickHoldAndDrag=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(164)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o={checkMajorWebPerformanceCaveat:!0};t.check=function(e){return e=r.__assign(r.__assign({},o),e),i("esri-webgl")?e.checkMajorWebPerformanceCaveat&&i("esri-webgl-major-performance-caveat")?new n("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):i("esri-webgl-high-precision-fragment")?i("esri-webgl-vertex-shader-samplers")?i("esri-webgl-element-index-uint")?i("esri-webgl-standard-derivatives")?i("esri-webgl-instanced-arrays")?null:new n("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new n("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new n("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new n("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new n("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new n("webgl:required","WebGL is required but not supported.")}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(157),r(151),r(1161),r(1577),r(1578),r(1580),r(1582),r(1584)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){return function(e){function t(t){var r=e.call(this,t)||this;return r._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},r.components=[],r}return r.__extends(t,e),t.prototype.initialize=function(){this._handles.add([n.init(this,"components",this._componentsWatcher.bind(this)),n.init(this,"view",this._updateViewAwareWidgets.bind(this))])},t.prototype._removeComponents=function(e){var t=this;e.forEach((function(e){var r=t._find(e);r&&(t.remove(r),r.destroy())}))},t.prototype._updateViewAwareWidgets=function(e){var t=this;this.components.forEach((function(r){var n=t._find(r),i=n&&n.widget;(function(e){return e&&void 0!==e.view})(i)&&(i.view=e)}))},t.prototype._componentsWatcher=function(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)},t.prototype._adjustPadding=function(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){var t=this.padding.top;this.padding=t}},t.prototype._addComponents=function(e){var t=this;this.initialized&&e.forEach((function(e){return t.add(t._createComponent(e),t._defaultPositionLookup[e])}))},t.prototype._createComponent=function(e){var t=this._createWidget(e);if(t)return new o({id:e,node:t})},t.prototype._createWidget=function(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0},t.prototype._createAttribution=function(){return new s({view:this.view})},t.prototype._createCompass=function(){return new l({view:this.view})},t.prototype._createNavigationToggle=function(){return new c({view:this.view})},t.prototype._createZoom=function(){return new u({view:this.view})},r.__decorate([i.property()],t.prototype,"components",void 0),r.__decorate([i.subclass("esri.views.ui.DefaultUI")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(620),r(151)],void 0===(i=function(e,t,r,n,i,o){var a="esri-component";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.widget=null,t}return r.__extends(t,e),t.prototype.destroy=function(){this.widget&&this.widget.destroy(),this.node=null},Object.defineProperty(t.prototype,"id",{get:function(){return this.get("widget.id")||this.get("node.id")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"node",{set:function(e){var t=this._get("node");e!==t&&(e&&e.classList.add(a),t&&t.classList.remove(a),this._set("node",e))},enumerable:!0,configurable:!0}),t.prototype.castNode=function(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),i.byId(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)},r.__decorate([o.property()],t.prototype,"id",null),r.__decorate([o.property()],t.prototype,"node",null),r.__decorate([o.cast("node")],t.prototype,"castNode",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"widget",void 0),r.__decorate([o.subclass("esri.views.ui.Component")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(177),r(156),r(200),r(173),r(407),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=o.getLogger("esri.layers.support.ElevationSampler"),p=function(){function e(){}return e.prototype.queryElevation=function(e){return f(e.clone(),this)},e.prototype.on=function(){return y},e.prototype.projectIfRequired=function(e,t){return v(e,t)},e}();t.ElevationSamplerBase=p;var d=function(e){function t(t,r,n){var i=e.call(this)||this;i.tile=t,i.noDataValue=n,i.extent=s.toExtent(t.tile.extent,r.spatialReference);var o=a.getMetersPerUnitForSR(r.spatialReference),l=r.lodAt(t.tile.level).resolution*o;return i.demResolution={min:l,max:l},i}return r.__extends(t,e),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0}),t.prototype.contains=function(e){var t=this.projectIfRequired(e,this.spatialReference);return l.extentContainsPoint(this.extent,t)},t.prototype.elevationAt=function(e){var t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;if(!this.contains(e)){var r=this.extent,n=r.xmin+", "+r.ymin+", "+r.xmax+", "+r.ymax;u.warn("#elevationAt()","Point used to sample elevation ("+e.x+", "+e.y+") is outside of the sampler extent ("+n+")")}return this.tile.sample(t.x,t.y)},t}(p);t.TileElevationSampler=d;var h=function(e){function t(t,r,n){var i,o=e.call(this)||this;"number"==typeof r?(o.noDataValue=r,i=null):(i=r,o.noDataValue=n),o.samplers=i?t.map((function(e){return new d(e,i,o.noDataValue)})):t;var a=o.samplers[0];if(a){o.extent=a.extent.clone();var l=a.demResolution,c=l.min,u=l.max;o.demResolution={min:c,max:u};for(var p=1;p<o.samplers.length;p++){var h=o.samplers[p];o.extent.union(h.extent),o.demResolution.min=Math.min(o.demResolution.min,h.demResolution.min),o.demResolution.max=Math.max(o.demResolution.max,h.demResolution.max)}}else o.extent=s.toExtent(s.create(),i.spatialReference),o.demResolution={min:0,max:0};return o}return r.__extends(t,e),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0}),t.prototype.elevationAt=function(e){var t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;for(var r=0,n=this.samplers;r<n.length;r++){var i=n[r];if(i.contains(t))return i.elevationAt(t)}return u.warn("#elevationAt()","Point used to sample elevation ("+e.x+", "+e.y+") is outside of the sampler"),null},t}(p);function f(e,t){var r=v(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":!function(e,t,r){e.z=r.elevationAt(t)||0}(e,r,t);break;case"polyline":!function(e,t,r){m.spatialReference=t.spatialReference;for(var n=e.hasM&&!e.hasZ,i=0;i<e.paths.length;i++)for(var o=e.paths[i],a=t.paths[i],s=0;s<o.length;s++){var l=o[s],c=a[s];m.x=c[0],m.y=c[1];var u=r.elevationAt(m)||0;n&&(l[3]=l[2]),l[2]=u}e.hasZ=!0}(e,r,t);break;case"multipoint":!function(e,t,r){m.spatialReference=t.spatialReference;for(var n=e.hasM&&!e.hasZ,i=0;i<e.points.length;i++){var o=e.points[i],a=t.points[i];m.x=a[0],m.y=a[1];var s=r.elevationAt(m)||0;n&&(o[3]=o[2]),o[2]=s}e.hasZ=!0}(e,r,t);break;default:i.neverReached(e)}return e}function v(e,t){var r=e.spatialReference;return r.equals(t)?e:c.canProject(r,t)?c.project(e,t):(u.error("Cannot project geometry spatial reference (wkid:"+r.wkid+") to elevation sampler spatial reference (wkid:"+t.wkid+")"),null)}t.MultiTileElevationSampler=h,t.updateGeometryElevation=f;var m=new n.Point,y={remove:function(){}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.length=function(e,t){var r=e[t],n=e[t+1],i=e[t+2];return Math.sqrt(r*r+n*n+i*i)},e.normalize=function(e,t){var r=e[t],n=e[t+1],i=e[t+2],o=1/Math.sqrt(r*r+n*n+i*i);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,n,i,o){void 0===o&&(o=t),(i=i||e)[o]=e[t]+r[n],i[o+1]=e[t+1]+r[n+1],i[o+2]=e[t+2]+r[n+2]},e.subtract=function(e,t,r,n,i,o){void 0===o&&(o=t),(i=i||e)[o]=e[t]-r[n],i[o+1]=e[t+1]-r[n+1],i[o+2]=e[t+2]-r[n+2]}}(t.Vec3Compact||(t.Vec3Compact={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(915),r(1603)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e,t,r){return{enabled:!r||!r.isPresentation}};return function(e){function t(t){var r=e.call(this,t)||this;return r.lighting=new a,r.background=null,r.atmosphereEnabled=!0,r.starsEnabled=!0,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n(this.cloneConstructProperties())},t.prototype.cloneConstructProperties=function(){return{lighting:a.prototype.clone.call(this.lighting),background:i.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}},r.__decorate([o.property({type:a,json:{write:!0}})],t.prototype,"lighting",void 0),r.__decorate([o.property(s.backgroundProperty)],t.prototype,"background",void 0),r.__decorate([o.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],t.prototype,"atmosphereEnabled",void 0),r.__decorate([o.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],t.prototype,"starsEnabled",void 0),n=r.__decorate([o.subclass("esri.webscene.Environment")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(166),r(155),r(151)],void 0===(i=function(e,t,r,n,i,o){var a=n.strict()({color:"color"});return function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e){if(e&&e.type){var t=r.__assign({},e);return delete t.type,t}return e},t.prototype.clone=function(){},r.__decorate([o.property({type:a.apiValues,readOnly:!0,json:{type:a.jsonValues,read:!1,write:a.write}})],t.prototype,"type",void 0),r.__decorate([o.subclass("esri.webscene.background.Background")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(151),r(386),r(1165)],void 0===(i=function(e,t,r,n,i,o,a){var s=r.__assign(r.__assign({},o.colorAndTransparencyProperty),{nonNullable:!0});return function(e){function t(t){var r=e.call(this,t)||this;return r.type="color",r.color=new n([0,0,0,1]),r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o(this.cloneProperties())},t.prototype.cloneProperties=function(){return{color:this.color.clone()}},r.__decorate([i.enumeration({color:"color"})],t.prototype,"type",void 0),r.__decorate([i.property(s)],t.prototype,"color",void 0),o=r.__decorate([i.subclass("esri.webscene.background.ColorBackground")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n){return[e,t,r,n]}function n(){return r(1,1,1,1)}function i(){return r(1,0,0,0)}function o(){return r(0,1,0,0)}function a(){return r(0,0,1,0)}function s(){return r(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0,0,0]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=r,t.fromArray=function(e){for(var t=[0,0,0,0],r=Math.min(4,e.length),n=0;n<r;++n)t[n]=e[n];return t},t.createView=function(e,t){return new Float64Array(e,t,4)},t.zeros=function(){return[0,0,0,0]},t.ones=n,t.unitX=i,t.unitY=o,t.unitZ=a,t.unitW=s,t.ZEROS=[0,0,0,0],t.ONES=n(),t.UNIT_X=i(),t.UNIT_Y=o(),t.UNIT_Z=a(),t.UNIT_W=s()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){return[e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v]},t.createView=function(e,t){return new Float64Array(e,t,16)},t.IDENTITY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1170),r(253),r(257),r(260),r(228),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({geometry:n.geometry});return new c(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return 1===this.configuration.geometry?u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),culling:u.backFaceCullingParams,depthTest:{func:515},colorWrite:u.defaultColorWriteParams}):u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:u.defaultColorWriteParams})},t.shader=new o.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1170)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(a.ShaderTechnique);t.SimpleAtmosphereTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=0,t}return n.__extends(t,e),n.__decorate([s.parameter({count:3})],t.prototype,"geometry",void 0),t}(s.ShaderTechniqueConfiguration);t.SimpleAtmosphereTechniqueConfiguration=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(256),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o){var a,s,l,c,u,p,d,h,f,v;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new o.ShaderBuilder;return 2===e.geometry?(t.attributes.add("position","vec2"),t.varyings.add("color","vec4"),t.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),t.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      void main(void) {\n          float ndotl = dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color = vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "],["\n      void main(void) {\n          float ndotl = dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color = vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "])))),t.fragment.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      void main() {\n          gl_FragColor = color;\n      }\n  "],["\n      void main() {\n          gl_FragColor = color;\n      }\n  "]))))):(t.include(n.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float"),1!==e.geometry&&t.varyings.add("innerFactor","float"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==e.geometry&&t.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==e.geometry&&t.vertex.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n\t\t\tconst float TWICEPI = 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS = 128.0;\n\t\t"],["\n\t\t\tconst float TWICEPI = 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS = 128.0;\n\t\t"])))),t.vertex.code.add(i.glsl(c||(c=r.__makeTemplateObject(["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection = -lightingMainDirection;\n\t"],["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection = -lightingMainDirection;\n\t"])))),1===e.geometry?t.vertex.code.add(i.glsl(u||(u=r.__makeTemplateObject(["\n\t\t\tvec3 pos = position;\n\t\t\tfloat ndotl = lightDirection.z;\n\t\t\tvtc = vec2(0.0, position.z+0.05);\n\t\t\t"],["\n\t\t\tvec3 pos = position;\n\t\t\tfloat ndotl = lightDirection.z;\n\t\t\tvtc = vec2(0.0, position.z+0.05);\n\t\t\t"])))):t.vertex.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n\t\t\tinnerFactor = clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale = position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"],["\n\t\t\tinnerFactor = clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale = position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"])))),t.vertex.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n\t\tfalloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position = transformPosition(proj, view, pos);\n\t\tgl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"],["\n\t\tfalloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position = transformPosition(proj, view, pos);\n\t\tgl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"])))),t.fragment.uniforms.add("tex","sampler2D"),1!==e.geometry&&t.fragment.uniforms.add("altitudeFade","float"),t.fragment.code.add(i.glsl(h||(h=r.__makeTemplateObject(["\n\t\tvoid main() {\n\t\t\tvec4 texColor = texture2D(tex, vtc);\n\t"],["\n\t\tvoid main() {\n\t\t\tvec4 texColor = texture2D(tex, vtc);\n\t"])))),1===e.geometry?t.fragment.code.add(i.glsl(f||(f=r.__makeTemplateObject(["\n\t\t\tgl_FragColor = texColor * falloff;\n\t\t\t}\n\t\t"],["\n\t\t\tgl_FragColor = texColor * falloff;\n\t\t\t}\n\t\t"])))):t.fragment.code.add(i.glsl(v||(v=r.__makeTemplateObject(["\n\t\t\tvec4 atmosphereColor = texColor * falloff;\n\t\t\tvec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"],["\n\t\t\tvec4 atmosphereColor = texColor * falloff;\n\t\t\tvec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg=="}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function i(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function a(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function s(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function l(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function c(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.multiply=i,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.distance=a,t.squaredDistance=s,t.length=l,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=o*a),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e[3]=s+n*(r[3]-s),e},t.random=function(e,t){var n,i,o,a,s,l;t=t||1;do{s=(n=2*r.RANDOM()-1)*n+(i=2*r.RANDOM()-1)*i}while(s>=1);do{l=(o=2*r.RANDOM()-1)*o+(a=2*r.RANDOM()-1)*a}while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=t*n,e[1]=t*i,e[2]=t*o*c,e[3]=t*a*c,e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e},t.transformQuat=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2],c=r[3],u=c*n+s*o-l*i,p=c*i+l*n-a*o,d=c*o+a*i-s*n,h=-a*n-s*i-l*o;return e[0]=u*c+h*-a+p*-l-d*-s,e[1]=p*c+h*-s+d*-a-u*-l,e[2]=d*c+h*-l+u*-s-p*-a,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},t.sub=n,t.mul=i,t.div=o,t.dist=a,t.sqrDist=s,t.len=l,t.sqrLen=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,1,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.fromValues=function(e,t,r,n,i,o,a,s,l){return[e,t,r,n,i,o,a,s,l]},t.createView=function(e,t){return new Float64Array(e,t,9)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n){return[e,t,r,n]},t.createView=function(e,t){return new Float64Array(e,t,4)},t.IDENTITY=[0,0,0,1]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(532),r(162),r(355),r(649)],void 0===(i=function(e,t,r,n,i,o){function a(e){return e?{ray:o.create(e.ray),c0:e.c0,c1:e.c1}:{ray:o.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,r,n){return void 0===n&&(n=a()),o.copy(e,n.ray),n.c0=t,n.c1=r,n}function l(e,t,r){void 0===r&&(r=a());var i=n.vec3.length(e.vector);return o.fromValues(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function c(e,t,r){return n.vec3.add(r,e.ray.origin,n.vec3.scale(r,e.ray.direction,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.wrap=function(e,t,r){var n=u.get();return n.ray=e,n.c0=t,n.c1=r,n},t.copy=function(e,t){return void 0===t&&(t=a()),s(e.ray,e.c0,e.c1,t)},t.fromValues=s,t.fromRay=function(e,t){return void 0===t&&(t=a()),o.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},t.fromLineSegment=function(e,t){return void 0===t&&(t=a()),l(e,n.vec3.normalize(i.sv3d.get(),e.vector),t)},t.fromLineSegmentAndDirection=l,t.getStart=function(e,t){return c(e,e.c0,t)},t.getEnd=function(e,t){return c(e,e.c1,t)},t.getAt=c;var u=new r.ObjectStack((function(){return{c0:0,c1:0,ray:null}}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(532),r(189),r(162),r(160),r(245),r(201),r(355),r(1175),r(648)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){function p(e){if(e){var t=e.planes,r=e.points;return{planes:[u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3]),u.create(t[4]),u.create(t[5])],points:[o.vec3f64.clone(r[0]),o.vec3f64.clone(r[1]),o.vec3f64.clone(r[2]),o.vec3f64.clone(r[3]),o.vec3f64.clone(r[4]),o.vec3f64.clone(r[5]),o.vec3f64.clone(r[6]),o.vec3f64.clone(r[7])]}}return{planes:[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],points:[o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create(),o.vec3f64.create()]}}function d(e,t,r){void 0===r&&(r=p());for(var n=0;n<6;n++)u.copy(e[n],r.planes[n]);for(n=0;n<8;n++)i.vec3.copy(r.points[n],t[n]);return r}function h(e){var t=e.planes,r=e.points;u.fromPoints(r[4],r[0],r[3],t[0]),u.fromPoints(r[1],r[5],r[6],t[1]),u.fromPoints(r[4],r[5],r[1],t[2]),u.fromPoints(r[3],r[2],r[6],t[3]),u.fromPoints(r[0],r[1],r[2],t[4]),u.fromPoints(r[5],r[4],r[7],t[5])}function f(e,t){for(var r=0;r<6;r++)if(!u.clip(e[r],t))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=p,t.copy=function(e,t){return void 0===t&&(t=p()),d(e.planes,e.points,t)},t.fromValues=d,t.fromMatrix=function(e,t,r){void 0===r&&(r=p());var o=r.points,s=n.mat4.multiply(l.sm4d.get(),t,e);n.mat4.invert(s,s);for(var c=0;c<8;++c){var u=a.vec4.transformMat4(l.sv4d.get(),v[c],s);i.vec3.set(o[c],u[0]/u[3],u[1]/u[3],u[2]/u[3])}return h(r),r},t.recomputePlanes=h,t.intersectsSphere=function(e,t){for(var r=0;r<6;r++)if(u.isSphereFullyInside(e[r],t))return!1;return!0},t.intersectsRay=function(e,t){return f(e,c.fromRay(t,m.get()))},t.intersectClipRay=function(e,t){for(var r=0;r<6;r++){var n=e[r];if(!u.clipInfinite(n,t))return!1}return!0},t.intersectsLineSegment=function(e,t,r){return f(e,c.fromLineSegmentAndDirection(t,r,m.get()))},t.intersectsPoint=function(e,t){for(var r=0;r<6;r++)if(u.signedDistance(e[r],t)>0)return!1;return!0},t.intersectsAABB=function(e,t){for(var r=0;r<6;r++)if(u.isAABBFullyInside(e[r],t))return!1;return!0},t.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var v=[s.vec4f64.fromValues(-1,-1,-1,1),s.vec4f64.fromValues(1,-1,-1,1),s.vec4f64.fromValues(1,1,-1,1),s.vec4f64.fromValues(-1,1,-1,1),s.vec4f64.fromValues(-1,-1,1,1),s.vec4f64.fromValues(1,-1,1,1),s.vec4f64.fromValues(1,1,1,1),s.vec4f64.fromValues(-1,1,1,1)],m=new r.ObjectStack(c.create)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(532),r(205),r(162),r(160),r(355),r(918)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){return e?{p0:o.vec3f64.clone(e.p0),p1:o.vec3f64.clone(e.p1),p2:o.vec3f64.clone(e.p2)}:{p0:o.vec3f64.create(),p1:o.vec3f64.create(),p2:o.vec3f64.create()}}function c(e,t,r,n){return void 0===n&&(n=l()),i.vec3.copy(n.p0,e),i.vec3.copy(n.p1,t),i.vec3.copy(n.p2,r),n}function u(e,t,r){var i=n.vec2.distance(e,t),o=n.vec2.distance(t,r),a=n.vec2.distance(r,e),s=(i+o+a)/2,l=s*(s-i)*(s-o)*(s-a);return l<=0?0:Math.sqrt(l)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t,r){var n=d.get();return n.p0=e,n.p1=t,n.p2=r,n},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.p0,e.p1,e.p2,t)},t.fromValues=c,t.distance2=function(e,t){var r=e.p0,n=e.p1,o=e.p2,l=i.vec3.subtract(a.sv3d.get(),n,r),c=i.vec3.subtract(a.sv3d.get(),o,n),u=i.vec3.subtract(a.sv3d.get(),r,o),d=i.vec3.subtract(a.sv3d.get(),t,r),h=i.vec3.subtract(a.sv3d.get(),t,n),f=i.vec3.subtract(a.sv3d.get(),t,o),v=i.vec3.cross(l,l,u),m=i.vec3.dot(i.vec3.cross(a.sv3d.get(),l,v),d),y=i.vec3.dot(i.vec3.cross(a.sv3d.get(),c,v),h),g=i.vec3.dot(i.vec3.cross(a.sv3d.get(),u,v),f);if(m>0&&y>0&&g>0){var _=i.vec3.dot(v,d);return _*_/i.vec3.dot(v,v)}var b=s.distance2(s.fromValues(r,l,p.get()),t),x=s.distance2(s.fromValues(n,c,p.get()),t),w=s.distance2(s.fromValues(o,u,p.get()),t);return Math.min(b,x,w)},t.intersectRay=function(e,t,r){var n=t.direction,o=t.origin,a=e.p0,s=e.p1,l=e.p2,c=s[0]-a[0],u=s[1]-a[1],p=s[2]-a[2],d=l[0]-a[0],h=l[1]-a[1],f=l[2]-a[2],v=n[1]*f-h*n[2],m=n[2]*d-f*n[0],y=n[0]*h-d*n[1],g=c*v+u*m+p*y;if(g>-1e-5&&g<1e-5)return!1;var _=1/g,b=o[0]-a[0],x=o[1]-a[1],w=o[2]-a[2],S=_*(b*v+x*m+w*y);if(S<0||S>1)return!1;var P=x*p-u*w,T=w*c-p*b,O=b*u-c*x,C=_*(n[0]*P+n[1]*T+n[2]*O);if(C<0||S+C>1)return!1;if(r){var M=_*(d*P+h*T+f*O);i.vec3.scale(r,n,M),i.vec3.add(r,o,r)}return!0},t.areaPoints2d=u,t.area2d=function(e){return u(e.p0,e.p1,e.p2)},t.areaPoints3d=function(e,t,r){return i.vec3.subtract(h,t,e),i.vec3.subtract(f,r,e),i.vec3.length(i.vec3.cross(h,h,f))/2};var p=new r.ObjectStack(s.create),d=new r.ObjectStack((function(){return{p0:null,p1:null,p2:null}})),h=o.vec3f64.create(),f=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeInnerAltitudeFade=function(e){return Math.min(1,Math.max(0,(e-1e5)/9e5))},t.INNER_ATMOSPHERE_DEPTH=1e4}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(795),r(494),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a){var s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new a.ShaderBuilder;return t.attributes.add("position","vec2"),t.attributes.add("uv0","vec2"),t.varyings.add("worldRay","vec3"),t.varyings.add("vtc","vec2"),e.haze&&t.varyings.add("eyeDir","vec3"),t.vertex.uniforms.add("projectionInverse","mat4"),t.vertex.uniforms.add("viewInverse","mat4"),t.vertex.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    void main(void) {\n      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc = uv0;\n\n      ","\n\n      gl_Position = vec4(position, 1, 1);\n    }\n  "],["\n    void main(void) {\n      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc = uv0;\n\n      ","\n\n      gl_Position = vec4(position, 1, 1);\n    }\n  "])),e.haze?o.glsl(s||(s=r.__makeTemplateObject(["eyeDir = posViewNear;"],["eyeDir = posViewNear;"]))):"")),t.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4"),e.haze?t.fragment.uniforms.add("depthTex","sampler2D"):t.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float"),t.include(i.RgbaFloatEncoding),t.include(n.ColorConversion,{stages:1}),t.fragment.code.add(o.glsl(c||(c=r.__makeTemplateObject(["\n  // Atmosphere\n  const float krESun = 0.075;        // Kr * ESun = 0.005 * 15.0\n  const float kmESun = 0.015;        // Km * ESun = 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "],["\n  // Atmosphere\n  const float krESun = 0.075;        // Kr * ESun = 0.005 * 15.0\n  const float kmESun = 0.015;        // Km * ESun = 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "])))),e.haze||t.fragment.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "],["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "])))),t.fragment.code.add(o.glsl(p||(p=r.__makeTemplateObject(["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples = 5.0;\n    const int maxSamples = 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x = 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay = normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))\n      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart = 0.0;\n  "],["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples = 5.0;\n    const int maxSamples = 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x = 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay = normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))\n      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart = 0.0;\n  "])),e.haze?"// Camera HDR\n        const float exposure = 1.5;\n        const vec3 oneOverGamma = vec3(1.0); //Gamma = 1.0":"const float exposure = 2.0;\n        const vec3 oneOverGamma = vec3(0.454545); // Gamma = 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate = inputColor * _exposure;\n          intermediate /= ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        ")),e.haze||t.fragment.code.add(o.glsl(d||(d=r.__makeTemplateObject(["\n      float surfaceBlend = 0.0;\n      vec4 surfaceColor = vec4(0.0);\n      if (detSur >= 0.0) {\n        float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface == 0.0) {\n          minRayStart = farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle = dot(-lightingMainDirection, normalize(vPos));\n        float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist = (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist > 1.0) {\n          gl_FragColor = surfaceColor;\n          return;\n        }\n\n        surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "],["\n      float surfaceBlend = 0.0;\n      vec4 surfaceColor = vec4(0.0);\n      if (detSur >= 0.0) {\n        float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface == 0.0) {\n          minRayStart = farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle = dot(-lightingMainDirection, normalize(vPos));\n        float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist = (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist > 1.0) {\n          gl_FragColor = surfaceColor;\n          return;\n        }\n\n        surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "])))),t.fragment.code.add(o.glsl(h||(h=r.__makeTemplateObject(["\n    if (det >= 0.0) {\n    ","\n    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart < minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart = minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start = cameraPosition + worldSpaceRay * rayStart;\n  "],["\n    if (det >= 0.0) {\n    ","\n    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart < minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart = minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start = cameraPosition + worldSpaceRay * rayStart;\n  "])),e.haze?"\n          float depthSample = texture2D(depthTex, vtc).r;\n\n          float zNear = nearFar[0];\n          float zFar = nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm = 2.0 * depthSample - 1.0;\n          float linDepth = 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha = 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample < 1.0 && depthSample > 0.0) {\n            vec3 cameraSpaceRay = normalize(eyeDir);\n            cameraSpaceRay /= cameraSpaceRay.z;\n            cameraSpaceRay *= linDepth;\n\n            float cameraSpaceRayLength = length(cameraSpaceRay);\n\n            vec3 world = cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq = dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart = innerRadius + 20000.0;\n            float transitionHeight = 25000.0;\n            float transitionEnd = transitionStart + transitionHeight;\n\n            float edge0 = transitionStart * transitionStart;\n            float edge1 = transitionEnd * transitionEnd;\n\n            altitudeAlpha = 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd = cameraSpaceRayLength;\n\n            if (altitudeAlpha > 0.0 && detSur > 0.0) {\n              float nearSurface = 0.5 * ( -B - sqrt(detSur) );\n              float interp = clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd = mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":"",e.haze?"float near = abs(rayStart);\n        float far = abs(rayEnd);":"float rayEnd = 0.5 *(-B + sqrt(det)); //far intersection with atmosphere",e.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance = shellScale * min(0.0, innerRadius - cameraHeight);",e.haze?"":"else { // outside atmosphere\n          scatterDistance = -1.0;\n        }")),e.haze&&t.fragment.code.add(o.glsl(f||(f=r.__makeTemplateObject(["\n      vec3 end = cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength = length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x < 0.0) {\n        altitudeInterval = -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle = dot(-lightingMainDirection, end) / endLength;\n\n      if (near > far)\n      {\n        if (altitudeInterval.x < altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end = cameraPosition + worldSpaceRay * rayStart;\n          start = cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *= -1.0;\n          float tmp = altitudeInterval.x;\n          altitudeInterval.x = altitudeInterval.y;\n          altitudeInterval.y = tmp;\n        }\n        else if (altitudeInterval.x == altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x > outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance = innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance = altitudeInterval.y - altitudeInterval.x;\n      }\n    "],["\n      vec3 end = cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength = length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x < 0.0) {\n        altitudeInterval = -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle = dot(-lightingMainDirection, end) / endLength;\n\n      if (near > far)\n      {\n        if (altitudeInterval.x < altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end = cameraPosition + worldSpaceRay * rayStart;\n          start = cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *= -1.0;\n          float tmp = altitudeInterval.x;\n          altitudeInterval.x = altitudeInterval.y;\n          altitudeInterval.y = tmp;\n        }\n        else if (altitudeInterval.x == altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x > outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance = innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance = altitudeInterval.y - altitudeInterval.x;\n      }\n    "])))),t.fragment.code.add(o.glsl(v||(v=r.__makeTemplateObject(["\n    vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength = rayEnd - rayStart;\n    float sampleLength = rayLength / samples;\n    float scaledLength = sampleLength * shellScale;\n    vec3 sampleRay = worldSpaceRay * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n  "],["\n    vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength = rayEnd - rayStart;\n    float sampleLength = rayLength / samples;\n    float scaledLength = sampleLength * shellScale;\n    vec3 sampleRay = worldSpaceRay * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n  "])))),e.haze?t.fragment.code.add(o.glsl(m||(m=r.__makeTemplateObject(["\n      float cameraAngle = dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle = scale(cameraAngle);\n      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues = scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth = scaledValues * shellDepth;\n    "],["\n      float cameraAngle = dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle = scale(cameraAngle);\n      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues = scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth = scaledValues * shellDepth;\n    "])))):t.fragment.code.add(o.glsl(y||(y=r.__makeTemplateObject(["\n      float cameraAngle = dot(worldSpaceRay, start / length(start));\n      float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle = scale(cameraAngle);\n      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;\n    "],["\n      float cameraAngle = dot(worldSpaceRay, start / length(start));\n      float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle = scale(cameraAngle);\n      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;\n    "])))),t.fragment.code.add(o.glsl(g||(g=r.__makeTemplateObject(["\n    // Loop variables\n    vec3 frontColor = vec3(0.0);\n    vec3 frontColorBlue = vec3(0.0);\n    vec3 attenuate = vec3(0.0);\n    vec3 attenuateBlue = vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i=0; i<maxSamples; i++) {\n      float height = length(samplePoint);\n      float altitude = abs(height - innerRadius);\n\n      vec2 depth = exp(-altitude * scaleOverScaleDepth);\n  "],["\n    // Loop variables\n    vec3 frontColor = vec3(0.0);\n    vec3 frontColorBlue = vec3(0.0);\n    vec3 attenuate = vec3(0.0);\n    vec3 attenuateBlue = vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i=0; i<maxSamples; i++) {\n      float height = length(samplePoint);\n      float altitude = abs(height - innerRadius);\n\n      vec2 depth = exp(-altitude * scaleOverScaleDepth);\n  "])))),e.haze?t.fragment.code.add(o.glsl(_||(_=r.__makeTemplateObject(["\n      vec2 scatter = depth * scaledValuesDepth - cameraOffset;\n    "],["\n      vec2 scatter = depth * scaledValuesDepth - cameraOffset;\n    "])))):t.fragment.code.add(o.glsl(b||(b=r.__makeTemplateObject(["\n      float lightAngle = dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle = dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;\n    "],["\n      float lightAngle = dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle = dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;\n    "])))),t.fragment.code.add(o.glsl(x||(x=r.__makeTemplateObject(["\n      attenuate = exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue = exp(-scatter.y * invWavelengthScaled);\n\n      frontColor += attenuate * depth.x;\n      frontColorBlue += attenuateBlue * depth.y;\n\n      samplePoint += sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun\n    float LdotR = clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq = LdotR * LdotR + 1.0;\n  "],["\n      attenuate = exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue = exp(-scatter.y * invWavelengthScaled);\n\n      frontColor += attenuate * depth.x;\n      frontColorBlue += attenuateBlue * depth.y;\n\n      samplePoint += sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun\n    float LdotR = clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq = LdotR * LdotR + 1.0;\n  "])))),e.haze?t.fragment.code.add(o.glsl(w||(w=r.__makeTemplateObject(["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color = colorCoefficients * frontColor;\n      vec3 colorBlue = colorCoefficients * frontColorBlue;\n    "],["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color = colorCoefficients * frontColor;\n      vec3 colorBlue = colorCoefficients * frontColorBlue;\n    "])))):t.fragment.code.add(o.glsl(S||(S=r.__makeTemplateObject(["\n      vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "],["\n      vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "])))),t.fragment.code.add(o.glsl(P||(P=r.__makeTemplateObject(["\n    // HDR to LDR conversion\n    vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed = expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR = mix(ldrBlue, ldrRed, 0.2);\n  "],["\n    // HDR to LDR conversion\n    vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed = expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR = mix(ldrBlue, ldrRed, 0.2);\n  "])))),e.haze?t.fragment.code.add(o.glsl(T||(T=r.__makeTemplateObject(["\n      LDR *= (1.0 - cameraAngle);\n      vec3 hsv = rgb2hsv(LDR);\n      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR = hsv2rgb(hsv);\n      vec3 finalColor = LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor = oldDestColor*(1.0-finalColor) + finalColor\n    "],["\n      LDR *= (1.0 - cameraAngle);\n      vec3 hsv = rgb2hsv(LDR);\n      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR = hsv2rgb(hsv);\n      vec3 finalColor = LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor = oldDestColor*(1.0-finalColor) + finalColor\n    "])))):t.fragment.code.add(o.glsl(O||(O=r.__makeTemplateObject(["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard = reinhardTM(color, exposure);\n      LDR += angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side = (rayEnd + rayStart) * 0.5;\n      float atmoHeight = sqrt(cameraHeightSq - side * side);\n      float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor = LDR * h2;\n      vec3 hsv = rgb2hsv(finalColor);\n      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor = hsv2rgb(hsv);\n    "],["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard = reinhardTM(color, exposure);\n      LDR += angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side = (rayEnd + rayStart) * 0.5;\n      float atmoHeight = sqrt(cameraHeightSq - side * side);\n      float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor = LDR * h2;\n      vec3 hsv = rgb2hsv(finalColor);\n      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor = hsv2rgb(hsv);\n    "])))),t.fragment.code.add(o.glsl(C||(C=r.__makeTemplateObject(["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor = vec4(0.0);\n      }\n    }\n  "],["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor = vec4(0.0);\n      }\n    }\n  "])),e.haze?"gl_FragColor = vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength = clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor = vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend > 0.0) {\n            gl_FragColor = mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }")),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(920),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o){var a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(){var e=new o.ShaderBuilder;return e.attributes.add("position","vec3"),e.attributes.add("color","vec4"),e.attributes.add("size","float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float"),e.include(n.AlignPixel),e.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    void main(void) {\n      vec4 posProj = transform * vec4(position, 0);\n      gl_Position = alignToPixelCenter(posProj, viewport.zw);\n      vcolor = color / 1.2;\n      vsize = size * 5.0 * pixelRatio;\n      gl_PointSize = vsize;\n    }\n  "],["\n    void main(void) {\n      vec4 posProj = transform * vec4(position, 0);\n      gl_Position = alignToPixelCenter(posProj, viewport.zw);\n      vcolor = color / 1.2;\n      vsize = size * 5.0 * pixelRatio;\n      gl_PointSize = vsize;\n    }\n  "])))),e.fragment.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n    void main() {\n      float cap = 0.7;\n      float scale = 1.0 / cap;\n      float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha = clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity = alpha * alpha * alpha;\n      if (vsize < 3.0) {\n        intensity *= 0.5;\n      }\n      gl_FragColor = vec4(vcolor.xyz, intensity);\n    }\n  "],["\n    void main() {\n      float cap = 0.7;\n      float scale = 1.0 / cap;\n      float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha = clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity = alpha * alpha * alpha;\n      if (vsize < 3.0) {\n        intensity *= 0.5;\n      }\n      gl_FragColor = vec4(vcolor.xyz, intensity);\n    }\n  "])))),e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(162),r(160),r(342),r(923),r(343),r(203),r(288),r(390),r(589)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zoomLocation=o.vec3f64.create(),t.tmpCamera=new u.default,t.tmpViewDir=o.vec3f64.create(),t.targetOnSphere=o.vec3f64.create(),t.tmpCenter=o.vec3f64.create(),t.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new u.default,interactionDirection:null,tiltMode:0},t.sphere=c.sphere.create(),t}return r.__extends(t,e),t.prototype.initialize=function(){this.intersector=new p.Intersector(this.view.viewingMode)},t.prototype.zoomStep=function(e,t){if(this.active){var r=this.view.state,n=this.constraintOptions.interactionStartCamera;this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n);var o=!1;e>0&&this.intersectionHelper.intersectScreen(t,this.zoomLocation)&&(o=!0),this.tmpCamera.copyFrom(r.camera),o?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:i.vec3.copy(this.zoomLocation,this.tmpCamera.center);var a=Math.pow(.6,e);this.updateCamera(this.tmpCamera,a,this.zoomLocation,t),this.begin(this.tmpCamera)}},t.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:d.outExpo}},t.prototype.updateCamera=function(e,t,r,n){this.sphere.radius=i.vec3.length(r),i.vec3.subtract(this.tmpViewDir,e.center,e.eye);var o=i.vec3.length(this.tmpViewDir),s=o*t;if(t<=1&&s<4&&(t=(s=4)/o),!(Math.abs(o-s)<1e-6)){var u=i.vec3.length(e.center);if(this.sphere.radius!==u){var p=this.sphere.radius+t*(u-this.sphere.radius);i.vec3.scale(e.center,e.center,p/u)}i.vec3.scale(this.tmpViewDir,this.tmpViewDir,-t),i.vec3.add(e.eye,e.center,this.tmpViewDir),a.applyAll(this.view,e,this.constraintOptions),i.vec3.squaredDistance(r,e.center)>1e-12&&c.sphere.intersectScreen(this.sphere,e,n,this.targetOnSphere)&&l.panToPosition(this.sphere,e,r,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),a.applySurfaceCollisionConstraint(this.view,e)}},r.__decorate([n.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],t)}(s.PointToPointAnimationController);t.ZoomStepController=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160),r(798),r(203),r(1183)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t,n){if(void 0===n&&(n=o.defaultApplyOptions),!function(e,t){var r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(2!==t.interactionType||!o.hasConstraintType(t.selection,1))}(e,n))return 0;var i=function(e,t){return t.min=e.min,t.max=e.max,t}(e.state.constraints.altitude,c);!function(e,t,r){var n=t.interactionType;if(0!==n){var i=r.min,a=r.max,s=t.interactionStartCamera,c=t.interactionFactor,u=2===n||1===n,p=l(e,s),d=0===p?0:e.renderCoordsHelper.getAltitude(s.eye);r.min=i,r.max=a;var h=.05*d;o.adjustRangeForInteraction(p,d,u,c,h,r)}}(e,n,i);var a=e.renderCoordsHelper.getAltitude(t.eye),s=r.clamp(a,i.min,i.max)-a;return Math.abs(s)<=1e-6?0:s}Object.defineProperty(t,"__esModule",{value:!0}),t.applyAltitudeConstraint=function(e,t,i){void 0===i&&(i=o.defaultApplyOptions);var c=l(e,t,i);if(0===c)return!1;var h=e.renderCoordsHelper,f=h.getAltitude(t.eye)+c,v=o.interactionDirectionTowardsConstraintMinimization(t,i.interactionDirection,function(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),n.vec3.scale(i,i,r),i}(e,t,r.sign(c),p),u),m=n.vec3.copy(d,t.viewForward);return h.intersectInfiniteManifold(a.ray.wrap(t.eye,v),f,t.eye)||h.setAltitude(f,t.eye),s.closestPointOnRay(t.eye,m,t.center,t.center),t.markViewDirty(),!0},t.getAltitudeConstraintError=l;var c={min:0,max:0},u=i.vec3f64.create(),p=i.vec3f64.create(),d=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(216),r(162),r(160)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var n=t[0],i=t[1],o=t[2];return!(e[0][0]*n+e[0][1]*i+e[0][2]*o+e[0][3]>r||e[1][0]*n+e[1][1]*i+e[1][2]*o+e[1][3]>r||e[2][0]*n+e[2][1]*i+e[2][2]*o+e[2][3]>r||e[3][0]*n+e[3][1]*i+e[3][2]*o+e[3][3]>r||e[4][0]*n+e[4][1]*i+e[4][2]*o+e[4][3]>r||e[5][0]*n+e[5][1]*i+e[5][2]*o+e[5][3]>r)},t.frustumRay=function(e,t,r,n){return c(e,t,null,a(n,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(s(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,n){return c(e,t,r,a(n,t,r,!0))},t.closestPointOnRay=function(e,t,r,i){var o=n.vec3.dot(t,n.vec3.subtract(i,r,e));return n.vec3.add(i,e,n.vec3.scale(i,t,o)),i};var o={dir:i.vec3f64.create(),len:0,clip:r.vec2f64.create()};function a(e,t,r,i){var a=o;return e?(r&&i&&(a.len=n.vec3.distance(t,r)),n.vec3.copy(a.dir,e)):i?(a.len=n.vec3.distance(t,r),n.vec3.subtract(a.dir,r,t),n.vec3.scale(a.dir,a.dir,1/a.len)):(n.vec3.subtract(a.dir,r,t),n.vec3.normalize(a.dir,a.dir)),a}function s(e,t){return-n.vec3.dot(t,e)-e[3]}function l(e,t,r){var i=n.vec3.dot(e,r.dir),o=s(e,t);if(o<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return o>0;if((o<0||i<0)&&!(o<0&&i<0))return!0;var a=o/i;return i>0?a<r.clip[1]&&(r.clip[1]=a):a>r.clip[0]&&(r.clip[0]=a),r.clip[0]<=r.clip[1]}function c(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!l(e[i],t,n))return!1;return!0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(798),r(203),r(251)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t,r){if(void 0===r&&(r=i.defaultApplyOptions),!e.state.isLocal)return 0;var n=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||n===1/0)return 0;c.min=0,c.max=n,function(e,t,r){var n=t.interactionType;if(0!==n){var o=r.min,a=r.max,c=t.interactionStartCamera,u=t.interactionFactor,p=1===n||4===n,d=s(e,c),h=0===d?0:l(e,c);r.min=o,r.max=a;var f=.05*h;i.adjustRangeForInteraction(d,h,p,u,f,r)}}(e,r,c);var o=l(e,t),a=c.max-o;return a>=-1e-6?0:a}function l(e,t){var n=e.pointsOfInterest.surfaceOrigin;return r.vec3.distance(t.eye,n.renderLocation)}Object.defineProperty(t,"__esModule",{value:!0}),t.getDistanceConstraintError=s,t.applyDistanceConstraint=function(e,t,n){void 0===n&&(n=i.defaultApplyOptions);var c=s(e,t,n);if(0===c)return!1;var f=e.pointsOfInterest.surfaceOrigin,v=l(e,t)+c,m=r.vec3.copy(u,t.eye),y=i.interactionDirectionTowardsConstraintMinimization(t,n.interactionDirection,function(e,t,r){var n=e.pointsOfInterest.surfaceOrigin;return a.directionFromTo(r,t.eye,n.renderLocation)}(e,t,h),d);if(o.sphere.intersectRay(o.sphere.wrap(v,f.renderLocation),o.ray.wrap(t.eye,y),t.eye)){var g=r.vec3.subtract(p,t.eye,m);r.vec3.add(t.center,t.center,g),t.markViewDirty();var _=e.renderCoordsHelper.getAltitude(t.center);return e.renderCoordsHelper.intersectInfiniteManifold(t.ray,_,t.center),t.markViewDirty(),!0}return!1};var c={min:0,max:0},u=n.vec3f64.create(),p=n.vec3f64.create(),d=n.vec3f64.create(),h=n.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(533)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.applySurfaceCollisionConstraint=function(e,t,n){void 0===n&&(n=0);var a=e.state.constraints;if(!a.collision.enabled)return!1;var s=i.surfaceElevationBelowEye(e,t),l=e.renderCoordsHelper.getAltitude(t.eye),c=s+a.collision.elevationMargin;if(l>=c)return!1;var u=r.vec3.length(t.eye);if(r.vec3.subtract(o,t.center,t.eye),e.renderCoordsHelper.setAltitude(c,t.eye),1===n)r.vec3.add(t.center,t.eye,o);else if(2===n){var p=(u-l+c)/u;r.vec3.scale(t.center,t.center,p)}return t.markViewDirty(),!0};var o=n.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230),r(162),r(534)],void 0===(i=function(e,t,r,n,i){return function(){function e(){}return e.prototype.acquire=function(t,r,n,i,o,a){this.id=e._idGen.gen(t&&t.id),this.geometry=t,this.material=r,this.transformation=n,this.instanceParameters=i,this.origin=o,this.shaderTransformation=a},e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e.prototype.computeAttachmentOrigin=function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(n.vec3.transformMat4(e,e,this.getStaticTransformation()),!0)},e._idGen=new i.IdGen,e.pool=new r(e),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(168),r(189),r(185),r(162),r(160),r(798),r(922),r(238),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){function d(e,t,i,o,s){if(void 0===i&&(i=l.defaultApplyOptions),void 0===o&&(o=l.defaultApplyOptions),!e.state.constraints.tilt)return 0;var m=t.distance,y=e.state.constraints.tilt(m,b);return function(e,t,r){if(0!==t.interactionType){var n=t.interactionStartCamera,i=t.interactionFactor,o=r.min,a=r.max,s=d(e,n,l.defaultApplyOptions,t),u=0===s?0:c.viewAngle(e.renderCoordsHelper,n.center,n.eye);r.min=o,r.max=a,2===t.interactionType?(l.hasConstraintType(t.selection,2)&&v(e,n,r),l.adjustRangeForInteraction(s,u,!0,i,_,r)):l.adjustRangeForInteraction(s,u,!1,i,_,r)}}(e,i,y),2===o.interactionType&&l.hasConstraintType(o.selection,2)&&v(e,o.interactionStartCamera,y),1===i.tiltMode||1===o.tiltMode?function(e,t,i,o){switch(o&&(o.requiresTwoSteps=!1),e.viewingMode){case"global":return function(e,t,r,i){var o,s,l=function(e,t,r){var i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,o=i+u.earthRadius,s=e.renderCoordsHelper.intersectManifold(t.ray,i,g);return r.eyeCenterDistance=t.distance,s?(r.eyeCenterDistance=a.vec3.distance(t.eye,g),r.tiltAtCenter=c.viewAngle(e.renderCoordsHelper,g,t.eye)):e.state.isLocal?r.tiltAtCenter=c.viewAngle(e.renderCoordsHelper,t.center,t.eye):(p.sphere.closestPointOnSilhouette(p.sphere.wrap(o),t.ray,g),r.eyeCenterDistance=a.vec3.distance(t.eye,g),r.tiltAtCenter=n.acosClamped(-a.vec3.dot(t.viewForward,a.vec3.normalize(g,g)))),r.radius=o,r.eyeRadius=a.vec3.length(t.eye),r.constraints=e.state.constraints,r.centerIsOnSurface=s,r}(e,t,x),d=n.clamp(l.tiltAtCenter,r.min,r.max);return h(l.tiltAtCenter-d)?(l.centerIsOnSurface?(o=function(e){var t=e.constraints,r=e.eyeCenterDistance,n=e.tiltAtCenter,i=n,o=t.clampTilt(r,n),a=f(e,o);if(t.clampTilt(a,n)===o)return o;for(var s=0;s<10&&h(o-i);){var l=(i+o)/2,c=f(e,l);h(t.clampTilt(c,l)-l)?i=l:o=l,s++}return o}(l),s=function(e,t){var r=n.asinClamped(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=n.asinClamped(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}(l,o)):(o=l.constraints.clampTilt(l.eyeCenterDistance,l.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),s=function(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}(l,o)),i&&(i.eyeCenterDistance=f(l,o)),s):0}(e,t,i,o);case"local":return function(e,t,r,i){var o=c.viewAngle(e.renderCoordsHelper,t.center,t.eye),a=n.clamp(o,r.min,r.max),s=o-a;if(!h(s))return 0;if(i){var l=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=e.renderCoordsHelper.getAltitude(t.eye)-l,p=Math.cos(a);Math.abs(p)>1e-4?i.eyeCenterDistance=u/p:i.eyeCenterDistance=t.distance}return s}(e,t,i,o);default:return void r.neverReached(e.viewingMode)}}(e,t,y,s):function(e,t,r){var i=c.viewAngle(e.renderCoordsHelper,t.center,t.eye),o=i-n.clamp(i,r.min,r.max);return h(o)?o:0}(e,t,y)}function h(e){return Math.abs(e)>1e-9}function f(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;var r=Math.PI-n.clamp(t,0,Math.PI),i=n.asinClamped(e.radius/e.eyeRadius*Math.sin(r)),o=Math.PI-r-i,a=Math.sin(o)/Math.sin(r);if(e.eyeRadius<e.radius&&a>1){var s=Math.PI-i,l=Math.PI-r-s;return Math.sin(l)/Math.sin(r)*e.eyeRadius}return a*e.eyeRadius}function v(e,t,r){if(!e.state.isLocal){var i=e.state.constraints;if(i.altitude){var o=a.vec3.squaredLength(t.center),s=Math.sqrt(o),l=t.distance,c=i.altitude.min+u.earthRadius,p=i.altitude.max+u.earthRadius,d=(c*c-l*l-o)/(-2*s*l),h=(p*p-l*l-o)/(-2*s*l);r.min=Math.max(r.min,Math.min(Math.PI-n.acosClamped(h),r.max)),r.max=Math.min(r.max,Math.PI-n.acosClamped(d))}}}Object.defineProperty(t,"__esModule",{value:!0}),t.applyTiltConstraint=function e(t,n,o,s){void 0===o&&(o=l.defaultApplyOptions),void 0===s&&(s=!0),w.eyeCenterDistance=0,w.requiresTwoSteps=!1;var c=d(t,n,o,void 0,w);if(0===c)return!1;switch(i.mat4.identity(y),i.mat4.rotate(y,y,-c,n.viewRight),o.tiltMode){case 1:a.vec3.transformMat4(m,n.viewForward,y),a.vec3.scale(m,m,w.eyeCenterDistance),a.vec3.add(n.center,n.eye,m);break;case 0:a.vec3.subtract(m,n.center,n.eye),a.vec3.transformMat4(m,m,y),a.vec3.subtract(n.eye,n.center,m);break;default:r.neverReached(o.tiltMode)}return a.vec3.transformMat4(n.up,n.up,y),n.markViewDirty(),!w.requiresTwoSteps||!s||e(t,n,o,!1)},t.getTiltConstraintError=d;var m=s.vec3f64.create(),y=o.mat4f64.create(),g=s.vec3f64.create(),_=n.deg2rad(5),b={min:0,max:0},x={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},w={eyeCenterDistance:0,requiresTwoSteps:!1}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(189),r(162),r(160)],void 0===(i=function(e,t,r,n,i){function o(e){return{operations:e,value:e.create()}}function a(e,t,r,n){return e.operations.setAltitudeAt(e.value,t,r,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e){var t=e.value,r=e.operations;return{operations:r,value:r.create(t)}},t.setExtent=function(e,t,r){return e.operations.setExtent(e.value,t,r.value),r},t.createFromOperations=o,t.fromValues=function(e,t,r){return void 0===r&&(r=o(e)),r.operations=e,e.copy(t,r.value),r},t.wrap=function(e,t){return l.operations=e,l.value=t,l},t.normalAt=function(e,t,r){return e.operations.axisAt(e.value,t,2,r)},t.axisAt=function(e,t,r,n){return e.operations.axisAt(e.value,t,r,n)},t.intersectRay=function(e,t,r){return e.operations.intersectRay(e.value,t,r)},t.intersectsRay=function(e,t){return e.operations.intersectRay(e.value,t,null)},t.closestPoint=function(e,t,r){return e.operations.closestPoint(e.value,t,r)},t.intersectRayClosestSilhouette=function(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)},t.closestPointOnSilhouette=function(e,t,r){return e.operations.closestPointOnSilhouette(e.value,t,r)},t.distanceToSilhouette=function(e,t){return e.operations.distanceToSilhouette(e.value,t)},t.altitudeAt=function(e,t){return e.operations.altitudeAt(e.value,t)},t.setAltitudeAt=a,t.setAltitudeOfTransformation=function(e,t,i,o){return t!==o&&r.mat4.copy(o,t),n.vec3.set(s,o[12],o[13],o[14]),a(e,s,i,s),o[12]=s[0],o[13]=s[1],o[14]=s[2],o},t.elevate=function(e,t,r){return e.operations.elevate(e.value,t,r.value)};var s=i.vec3f64.create(),l={operations:null,value:null};t.vectorCoordinates=function(e,t,r,i,o){return o[0]=n.vec3.dot(e,t),o[1]=n.vec3.dot(e,r),o[2]=n.vec3.dot(e,i),o},t.coordinateSystemFromOneAxisAndNormalVector=function(e,t,r,i,o){n.vec3.copy(r,e),n.vec3.copy(c,t),n.vec3.normalize(c,c),n.vec3.cross(i,c,r),n.vec3.cross(o,i,r)};var c=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(162),r(160),r(342),r(923),r(288),r(390),r(589)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zoomLocation=o.vec3f64.create(),t.tmpCamera=new l.default,t.tmpRayDir=o.vec3f64.create(),t.tmpCenter=o.vec3f64.create(),t.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l.default,interactionDirection:null,tiltMode:0},t}return r.__extends(t,e),t.prototype.zoomStep=function(e,t){if(this.active){var r=this.view.state,n=this.constraintOptions.interactionStartCamera;this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n),this.tmpCamera.copyFrom(r.camera);var o=new c.Intersector(this.view.viewingMode);e>0?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,o,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,o,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:i.vec3.copy(this.zoomLocation,this.tmpCamera.center);var a=Math.pow(.6,e);this.updateCamera(this.tmpCamera,a,this.zoomLocation),this.begin(this.tmpCamera)}},t.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:u.outExpo}},t.prototype.updateCamera=function(e,t,r){i.vec3.subtract(this.tmpRayDir,r,e.eye);var n=i.vec3.length(this.tmpRayDir),o=n*t;t<=1&&o<4&&(t=(o=4)/n),Math.abs(n-o)<1e-6||(i.vec3.scale(this.tmpRayDir,this.tmpRayDir,t),i.vec3.subtract(e.eye,r,this.tmpRayDir),i.vec3.lerp(e.center,e.center,r,1-t),a.applyAll(this.view,e,this.constraintOptions))},r.__decorate([n.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],t)}(s.PointToPointAnimationController);t.ZoomStepController=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(151),r(189),r(185),r(205),r(216),r(162),r(160),r(342),r(645),r(590),r(343)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.pivot="center",r.lastPoint=l.vec2f64.create(),r.tmpWorldUp=u.vec3f64.create(),r.tmpViewDir=u.vec3f64.create(),r.tmpRotCurPoint=l.vec2f64.create(),r.tmpTransf=a.mat4f64.create(),r.tmpAxis=u.vec3f64.create(),r.pivotPos=u.vec3f64.create(),r.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.rotScale="center"===this.pivot?3:1.5},t.prototype.begin=function(e){if(this.active){switch(this.pivot){case"eye":c.vec3.copy(this.pivotPos,this.beginCamera.eye),this.constraintOptions.interactionType=3,this.constraintOptions.tiltMode=1,this.constraintOptions.selection=0;break;case"center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||c.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera,f.normalizeCoordinate(this.beginCamera,e,this.lastPoint)}},t.prototype.update=function(e){if(this.active){var t;switch(this.pivot){case"eye":t=this.currentCamera.center;break;case"center":this.currentCamera.center=this.pivotPos,t=this.currentCamera.eye}this.applyRotation(this.currentCamera,e,t,this.pivotPos),p.applyAll(this.view,this.currentCamera,this.constraintOptions)}},t.prototype.end=function(){this.active&&this.finishController()},t.prototype.applyRotation=function(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this.tmpWorldUp),f.normalizeCoordinate(e,t,this.tmpRotCurPoint);var a=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;c.vec3.subtract(this.tmpViewDir,r,i);var u=c.vec3.length(this.tmpViewDir),p=n.acosClamped(c.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/u);if("eye"===this.pivot){a*=-.5;var h=.5*Math.PI-p,v=.5*Math.PI*.99;a=h-Math.max(-v,Math.min(v,h+a))}a=n.clamp(a+p,d.TiltDefault.min,d.TiltDefault.max)-p,o.mat4.identity(this.tmpTransf),c.vec3.cross(this.tmpAxis,e.up,this.tmpViewDir),"center"===this.pivot&&(l=-l),o.mat4.rotate(this.tmpTransf,this.tmpTransf,l,this.tmpWorldUp),o.mat4.rotate(this.tmpTransf,this.tmpTransf,a,this.tmpAxis),c.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),c.vec3.add(r,i,this.tmpViewDir),c.vec3.transformMat4(e.up,e.up,this.tmpTransf),s.vec2.copy(this.lastPoint,this.tmpRotCurPoint),e.markViewDirty()},r.__decorate([i.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([i.property()],t.prototype,"pivot",void 0),r.__decorate([i.subclass("esri.views.3d.state.controllers.RotateController")],t)}(h.InteractiveController);t.RotateController=v}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(168),r(152),r(151),r(189),r(185),r(162),r(160),r(342),r(645),r(590),r(343),r(343),r(922),r(925),r(926),r(238),r(203),r(251),r(355),r(288),r(1153)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){Object.defineProperty(t,"__esModule",{value:!0});var T=function(e){function t(t){var r=e.call(this,t)||this;return r.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},r.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],r.tmpCamera=new S.default,r.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new S.default,interactionFactor:0,interactionDirection:null,tiltMode:1},r}return r.__extends(t,e),t.prototype.handleEventGamepad=function(e){var t=P.extractTransformation(e,this.view.navigation.gamepad,this.transformation);("end"===e.action||P.isZeroTransformation(t))&&this.finishController()},t.prototype.activateDirection=function(e){this.keysButtonState[e]=1,P.extractTransformationKeyboard(this.keysButtonState,this.transformation)},t.prototype.deactivateDirection=function(e){this.keysButtonState[e]=0;var t=P.extractTransformationKeyboard(this.keysButtonState,this.transformation);P.isZeroTransformation(t)&&this.finishController()},t.prototype.onControllerStart=function(t){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,e.prototype.onControllerStart.call(this,t)},t.prototype.updateFilteredSurfaceElevation=function(e){var t=this.view.pointsOfInterest.cameraOnSurface.location.z;this.filteredSurfaceElevation+=1*(t-this.filteredSurfaceElevation)*e},t.prototype.stepController=function(t,r){this.updateStartHeading(),this.updateFilteredSurfaceElevation(t),this.currentCamera.copyViewFrom(r),this.updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this.calculateControlTransformation(t,this.currentCamera,D),this.applyDisabledMovementTypes(D),this.applyPan(D.pan),this.applyRotate(D.rotate),this.applyZoom(D.zoom),this.applyAscend(D.ascend),this.constraintOptions.interactionType=0,this.constraintOptions.selection=8,p.applyAll(this.view,this.currentCamera,this.constraintOptions),e.prototype.stepController.call(this,t,r)},t.prototype.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)},t.prototype.applyRotate=function(e){if(e.enabled){var t=this.currentCamera,r=t.center,n=t.up,i=t.eye;c.vec3.subtract(r,r,i),c.vec3.transformMat4(r,r,e.matrix),c.vec3.add(r,r,i),c.vec3.transformMat4(n,n,e.matrix),t.markViewDirty(),this.constraintOptions.interactionType=3,this.constraintOptions.selection=7,p.applyAll(this.view,t,this.constraintOptions)}},t.prototype.applyPan=function(e,t){if(void 0===t&&(t=this.currentCamera),e.enabled){var r=t.center,n=t.eye,i=t.up;c.vec3.transformMat4(n,n,e.matrix),c.vec3.transformMat4(r,r,e.matrix),this.view.state.isGlobal&&c.vec3.transformMat4(i,i,e.matrix),t.markViewDirty(),this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,p.applyAll(this.view,t,this.constraintOptions)}},t.prototype.applyZoom=function(e){if(e){var t=this.currentCamera,r=t.eye,n=t.viewForward;c.vec3.add(r,r,c.vec3.scale(w.sv3d.get(),n,e)),this.currentCamera.markViewDirty(),c.vec3.copy(L,n),c.vec3.negate(L,L),this.constraintOptions.interactionDirection=L,this.constraintOptions.interactionType=1,this.constraintOptions.selection=7,p.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}},t.prototype.applyAscend=function(e){if(e){var t=this.currentCamera,r=t.center,n=t.eye,i=this.view.renderCoordsHelper.worldUpAtPosition(n,w.sv3d.get());if(this.constraintOptions.interactionDirection=c.vec3.copy(L,i),this.view.state.isGlobal){var o=c.vec3.length(n),a=(o+e)/o;c.vec3.scale(n,n,a),c.vec3.scale(r,r,a)}else{var s=c.vec3.scale(w.sv3d.get(),i,e);c.vec3.add(n,n,s),c.vec3.add(r,r,s)}this.currentCamera.markViewDirty(),this.updateCameraCenter(),this.constraintOptions.interactionType=5,this.constraintOptions.selection=8,p.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter(),this.constraintOptions.selection=7,p.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}},t.prototype.calculateControlTransformation=function(e,t,r){!function(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,s.mat4.identity(e.pan.matrix),e.rotate.enabled=!1,s.mat4.identity(e.rotate.matrix)}(r);var n=this.computeVelocities(e);this.view.state.isLocal?this.calculateControlTransformationLocal(n,t,r):this.calculateControlTransformationGlobal(n,t,r)},t.prototype.updateCameraCenter=function(){var e=this.currentCamera,t=e.ray,r=e.center,n=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(t,n,r),this.currentCamera.markViewDirty()},t.prototype.calculateControlTransformationLocal=function(e,t,r){var o=t.viewRight,a=t.viewForward,l=this.transformation,u=this.view.navigation.gamepad,p=c.vec3.set(w.sv3d.get(),a[0],a[1],0);c.vec3.normalize(p,p);var h=l.translation[0]*e.pan;if(0!==h){var f=c.vec3.scale(w.sv3d.get(),o,h);s.mat4.translate(r.pan.matrix,r.pan.matrix,f),r.pan.enabled=!0}switch(u.mode){case"pan":var v=-l.translation[1]*e.pan;if(0!==v){var y=c.vec3.scale(w.sv3d.get(),p,v);s.mat4.translate(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}r.zoom=l.zoom*e.zoom;break;case"zoom":r.zoom=(-l.translation[1]+l.zoom)*e.zoom;break;default:n.neverReached(u.mode)}var g=l.translation[2]*e.ascend;r.ascend=g;var _=-l.heading*e.rotate;0!==_&&(s.mat4.rotate(r.rotate.matrix,r.rotate.matrix,_,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,w.sv3d.get())),r.rotate.enabled=!0);var b=l.tilt*e.rotate,x=m.viewAngle(this.view.renderCoordsHelper,t.center,t.eye),S=i.clamp(x+b,d.TiltDefault.min,d.TiltDefault.max)-x;S&&(s.mat4.rotate(r.rotate.matrix,r.rotate.matrix,S,o),r.rotate.enabled=!0)},t.prototype.calculateControlTransformationGlobal=function(e,t,r){var n=t.eye,i=t.viewRight,o=this.transformation,a=this.view.navigation.gamepad,l=c.vec3.cross(w.sv3d.get(),i,n);c.vec3.normalize(l,l),c.vec3.negate(l,l),f.panMotionToRotationMatrix(this.beginCamera,t,o,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,r,a),this.tmpCamera.copyFrom(this.currentCamera),this.applyPan(D.pan,this.tmpCamera);var u=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,p=o.translation[2]*e.ascend;r.ascend=p;var d=-o.heading*e.rotate;0!==d&&(s.mat4.rotate(r.rotate.matrix,r.rotate.matrix,d,this.tmpCamera.eye),r.rotate.enabled=!0);var h=o.tilt*e.rotate,v=this.clampTiltDeltaGlobalToValidRange(h,t.ray,u);0!==v&&(s.mat4.rotate(r.rotate.matrix,r.rotate.matrix,v,this.tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom=o.zoom*e.zoom},t.prototype.clampTiltDeltaGlobalToValidRange=function(e,t,r){var n=v.onSurfaceTiltToEyeTiltGlobal(d.TiltDefault.min,t.origin,r),o=0,a=0,s=w.sv3d.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,s)){var l=m.viewAngle(this.view.renderCoordsHelper,s,t.origin);o=v.onSurfaceTiltToEyeTiltGlobal(l,t.origin,r),a=v.onSurfaceTiltToEyeTiltGlobal(d.TiltDefault.max,t.origin,r)}else b.sphere.closestPointOnSilhouette(b.sphere.wrap(r+_.earthRadius),t,s),l=i.acosClamped(-c.vec3.dot(t.direction,c.vec3.normalize(s,s))),o=v.offSurfaceTiltToEyeTiltGlobal(l,t.origin,r),a=v.offSurfaceTiltToEyeTiltGlobal(d.TiltDefault.max,t.origin,r);return i.clamp(o+e,n,a)-o},t.prototype.getPointAbsoluteSurfaceElevation=function(e,t,r){var n=this.view.renderCoordsHelper,i=n.getAltitude(e),o=t+Math.abs(i-t);return c.vec3.copy(r,e),n.setAltitude(o,r),o},t.prototype.clampedDistanceToSurface=function(e,t){var r=this.view.renderCoordsHelper,n=this.view.state.camera,i=y.headingTiltToDirectionUp(this.view,t,0,C,j).direction,o=r.intersectManifoldClosestSilhouette(b.ray.wrap(t,i),e,w.sv3d.get()),a=c.vec3.distance(t,o),s=r.intersectManifoldClosestSilhouette(b.ray.wrap(t,x.directionFromTo(w.sv3d.get(),t,n.center)),e,w.sv3d.get()),l=c.vec3.distance(t,s);return Math.min(a,l)},t.prototype.computeHeadingRotateRadius=function(e){var t=this.view,r=t.renderCoordsHelper,n=t.state,o=n.camera,a=n.isGlobal,s=r.intersectManifoldClosestSilhouette(o.ray,this.filteredSurfaceElevation,w.sv3d.get());if(a){var l=c.vec3.subtract(w.sv3d.get(),e,s),u=c.vec3.length(l);c.vec3.scale(l,l,1/u);var p=c.vec3.normalize(w.sv3d.get(),e),d=i.acosClamped(c.vec3.dot(p,l));return u*Math.sin(Math.min(M,d))}var h=c.vec3.copy(w.sv3d.get(),e);return r.setAltitude(this.filteredSurfaceElevation,h),c.vec3.distance(s,h)},t.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:E},t.prototype.computeVelocities=function(e){var t=this.filteredSurfaceElevation,r=t+_.earthRadius,n=this.view.state,o=n.camera,a=n.isGlobal,s=w.sv3d.get(),l=this.getPointAbsoluteSurfaceElevation(o.eye,t,s),c=this.clampedDistanceToSurface(t,s),u=o.width/2,p=A*o.width,d=A*o.width,h=c*Math.tan(.5*o.fovX)/u,f=h/r,v=h/this.computeHeadingRotateRadius(s),m=l-t;return{pan:(a?f:h)*p*e,ascend:Math.max(this.minimumAscendVelocity()*e,Math.pow(2,p*e/u)*m-m),zoom:Math.pow(2,p*e/u)*c-c,rotate:i.clamp(v*d,I,R)*e}},t.prototype.applyDisabledMovementTypes=function(e){!o.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&s.mat4.identity(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&s.mat4.identity(e.rotate.matrix))},t.activatesFor=function(e,t){var r=P.extractTransformation(t,e.navigation.gamepad,O);return!("end"===t.action||P.isZeroTransformation(r))},r.__decorate([a.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"gamepadDevice",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"disableMovements",void 0),r.__decorate([a.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],t)}(h.InteractiveController);t.GamepadKeyboardController=T;var O={translation:[0,0,0],heading:0,tilt:0,zoom:0},C=80,M=i.deg2rad(C),A=.75,E=5,I=i.deg2rad(30),R=i.deg2rad(80),D={zoom:0,ascend:0,pan:{enabled:!1,matrix:l.mat4f64.create()},rotate:{enabled:!1,matrix:l.mat4f64.create()}},L=u.vec3f64.create(),j=g.createDirectionUp()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isSpatialReferenceSupported=function(e,t){return null!=e&&("2d"===t||("local"===t?!e.isGeographic:e.isWebMercator||e.isWGS84||4490===e.wkid))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._gain=e}return e.prototype.reset=function(e){this._value=e},Object.defineProperty(e.prototype,"gain",{set:function(e){this._gain=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0}),e.prototype.update=function(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value},e}();t.ExponentialFalloff=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(162),r(160),r(650)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;return r.interactionType=4,r.tmpPan=o.vec3f64.create(),r}return r.__extends(t,e),t.prototype.momentumStep=function(e,t){var r=this.momentum.value(e);i.vec3.scale(this.tmpPan,this.momentum.direction,r),i.vec3.subtract(t.eye,t.eye,this.tmpPan),i.vec3.subtract(t.center,t.center,this.tmpPan),t.markViewDirty(),this.constraintOptions.interactionDirection=this.tmpPan},r.__decorate([n.property({constructOnly:!0})],t.prototype,"momentum",void 0),r.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],t)}(a.MomentumController);t.PanPlanarMomentumController=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(160),r(650),r(343),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.interactionType=2,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"center",{set:function(e){this._set("center",i.vec3f64.clone(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"axis",{set:function(e){this._set("axis",i.vec3f64.clone(e))},enumerable:!0,configurable:!0}),t.prototype.momentumStep=function(e,t){var r=this.momentum.value(e);a.applyRotation(t,this.center,s.axisAngle.wrapAxisAngle(this.axis,r))},r.__decorate([n.property({constructOnly:!0})],t.prototype,"momentum",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"center",null),r.__decorate([n.property({constructOnly:!0})],t.prototype,"axis",null),r.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],t)}(o.MomentumController);t.RotationMomentumController=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(162),r(160),r(650),r(343),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t){var r=e.call(this,t)||this;return r.interactionType=1,r.constraintOptions.interactionDirection=o.vec3f64.create(),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"zoomCenter",{set:function(e){this._set("zoomCenter",o.vec3f64.clone(e))},enumerable:!0,configurable:!0}),t.prototype.momentumStep=function(e,t){i.vec3.copy(this.constraintOptions.interactionDirection,t.eye);var r=this.momentum.valueDelta(0,e);s.applyZoomToPoint(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=l.directionFromTo(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)},r.__decorate([n.property({constructOnly:!0})],t.prototype,"momentum",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"zoomCenter",null),r.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],t)}(a.MomentumController);t.ZoomPlanarMomentumController=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(928),r(800)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r,i){void 0===e&&(e=2.5),void 0===t&&(t=.01),void 0===r&&(r=.95),void 0===i&&(i=12),this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.maxVelocity=i,this.enabled=!0,this.value=new n.FilteredFiniteDifference(.8),this.time=new n.FilteredFiniteDifference(.3)}return e.prototype.add=function(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){var r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}},e.prototype.reset=function(){this.value.reset(),this.time.reset()},e.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var e=this.value.filteredDelta/this.time.filteredDelta;return e=r.clamp(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)},e.prototype.createMomentum=function(e,t,r){return new i.Momentum(e,t,r)},e}();t.MomentumEstimator=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.key=t,n.registerIncoming("key-down",r,(function(e){return n._handleKeyDown(e)})),n}return r.__extends(t,e),t.prototype._handleKeyDown=function(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())},t}(n.InputHandler);t.SingleKey=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(210),r(168),r(152),r(214),r(151),r(189),r(185),r(216),r(162),r(160),r(245),r(201),r(639),r(173),r(1665),r(261),r(238),r(203),r(919),r(288),r(651),r(195),r(652)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O){Object.defineProperty(t,"__esModule",{value:!0});var C=h.vec3f64.create(),M=v.vec4f64.create(),A=v.vec4f64.create(),E=h.vec3f64.create(),I=u.mat4f64.create(),R=x.sphere.create(),D=x.ray.create(),L=h.vec3f64.create(),j=y.create(),V=function(){this.aabr=y.create(),this.distance=0,this.culled=!1,this.visible=!1};t.DeconflictorGraphic=function(e,t,r){void 0===r&&(r={}),this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info=r};var F=function(){function e(){this.active=new Map,this.visible=new Map}return e.prototype.clear=function(){this.active.clear(),this.visible.clear()},e}(),N=function(){},k=function(){this.sortArray=new s({allocator:function(e){return e||new N}})},z=function(){function e(){this.camera=new S.default,this.slicePlane=x.boundedPlane.create(),this.slicePlaneEnabled=!1}return e.prototype.copyFrom=function(e){this.camera.copyFrom(e.camera),x.boundedPlane.copy(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled},e}();t.DeconflictorViewState=z;var U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._dirty=!1,t._runningViewState=new z,t._state=0,t.graphics=new F,t.iterators=new k,t.accBinsNumX=15,t.accBinsNumY=20,t.accBinsSizeX=0,t.accBinsSizeY=0,t.accBins=null,t.accNumTests=0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.graphics.clear(),this.iterators=null},t.prototype.setDirty=function(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))},Object.defineProperty(t.prototype,"updating",{get:function(){return 0!==this._state||this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingProgress",{get:function(){if(!this.updating)return 1;var e=this._state/4;return this._dirty?.5*e:e},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating},t.prototype.update=function(e){switch(this._state){case 0:this.startUpdate(),e.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(e))return;case 2:if(this._state=2,!this.sortVisibleGraphics(e))return;case 3:if(this._state=3,!this.deconflictVisibleGraphics(e))return;default:g.drawAccelerationStruct(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}},t.prototype.modifyGraphics=function(e,t){var r=this;t?e.forEach((function(e){return r.addToActiveGraphics(e)})):e.forEach((function(e){return r.removeFromActiveGraphics(e)})),this.setDirty()},t.prototype.layerSupportsDeconfliction=function(e){if(a.isNone(e)||"object3d"!==e.type)return!1;var t=e.stageObject;return 1===(t?t.getNumGeometryRecords():0)&&t.getGeometryRecord(0).material instanceof O.default},t.prototype.startUpdate=function(){g.prepare(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);var e=this._runningViewState.camera,t=e.fullWidth,r=e.fullHeight;this.initBins(t,r),this.resetIterators()},t.prototype.addToActiveGraphics=function(e){e.info[this.visibilityGroup]=new V,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()},t.prototype.removeFromActiveGraphics=function(e){this.removeFromVisibleGraphics(e),function(e,t){var r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(3,t)}(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()},t.prototype.addToVisibleGraphics=function(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)},t.prototype.removeFromVisibleGraphics=function(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)},t.prototype.processActiveGraphics=function(e){var t=this.ensureActiveGraphicsIterator(),r=c.mat4.invert(I,this._runningViewState.camera.projectionMatrix),n="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?R:null,i=0;for(a.isSome(n)&&(d.vec3.transformMat4(n.center,m.ZEROS,this._runningViewState.camera.viewMatrix),n.radius=b.earthRadius,i=x.sphere.distanceToSilhouette(n,m.ZEROS));!e.done;){e.madeProgress();var o=t.next();if(o.done)return this.resetActiveGraphicsIterator(),!0;var s=o.value,l=s&&s.info[this.visibilityGroup];l&&(this.collectGraphics3DGraphics(s,r,n,i),l.culled?this.removeFromVisibleGraphics(s):this.addToVisibleGraphics(s))}return!1},t.prototype.sortVisibleGraphics=function(e){for(var t=this.ensureSortGraphicsIterator();!e.done;){var r=t.next();if(e.madeProgress(),r.done)return this.resetSortGraphicsIterator(),!0}return!1},t.prototype.deconflictVisibleGraphics=function(e){for(var t=this.ensureVisibleGraphicsIterator(),r=1===this.visibilityGroup;!e.done;){e.madeProgress();var n=t.next();if(n.done)return this.resetVisibleGraphicsIterator(),!0;var i=n.value,o=i.info[this.visibilityGroup];if(o&&!o.culled){var a=i.graphics3DGraphic,s=(!r||a.isVisible())&&!this.isConflicted(i);s&&this.addToBins(i),o.visible=s,this.setGraphicVisibility(i,s),g.drawPoly(o,s)}}return!1},t.prototype.resetIterators=function(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null},t.prototype.ensureActiveGraphicsIterator=function(){return this.iterators.active||(this.iterators.active=B(this.graphics.active)),this.iterators.active},t.prototype.resetActiveGraphicsIterator=function(){this.iterators.active=null},t.prototype.ensureVisibleGraphicsIterator=function(){return this.iterators.visible||(this.iterators.visible=B(this.graphics.visible)),this.iterators.visible},t.prototype.resetVisibleGraphicsIterator=function(){this.iterators.visible=null},t.prototype.ensureSortGraphicsIterator=function(){return this.iterators.sort||(this.iterators.sort=function(e,t,n){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t.clear(),e.forEach((function(e,r){var i=t.pushNew();i.id=r,i.prio=e.info?-e.info[n].distance:Number.MAX_VALUE})),[4];case 1:r.sent(),i=t.iterableSort((function(e,t){return t.prio-e.prio})),o=i.next(),r.label=2;case 2:return o.done?[3,5]:[4];case 3:r.sent(),r.label=4;case 4:return o=i.next(),[3,2];case 5:return t.forEach((function(t){var r=e.get(t.id);r&&(e.delete(t.id),e.set(t.id,r))})),t.clear(),[2]}}))}(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort},t.prototype.resetSortGraphicsIterator=function(){this.iterators.sort=null},t.prototype.collectGraphics3DGraphics=function(e,t,r,n){var i=e.graphics3DGraphic;if(!i.destroyed){var o=e.info[this.visibilityGroup];if(i.isVisible(0,3)){var s=this.getGraphicsLayers(i);y.empty(o.aabr);for(var l=null,c=0,u=s;c<u.length;c++){var p=u[c];if(this.layerSupportsDeconfliction(p)){var d=p.stageObject.getGeometryRecord(0).material;if(a.isNone(l)){if((l=this.getProjectionInfo(p,t,H)).isOutsideScreen||this.isCulledBySlice(e,C)||a.isSome(r)&&this.isCulledByHorizon(l,r,n))return void(o.culled=!0);!_.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&o.visible&&(l.distance*=.7)}this.expandBoundingRect(o,p,d,l)}}a.isNone(l)?o.culled=!0:(o.distance=l.distance,o.culled=!1)}else o.culled=!0}},t.prototype.getProjectionInfo=function(e,t,r){var n=this._runningViewState.camera,i=e.stageObject,o=i.getGeometryRecord(0),a=o.material,s=i.getCenter();d.vec3.transformMat4(C,s,n.viewMatrix);var l=o.geometry.data.getVertexAttr(),c=l[T.VertexAttrConstants.NORMAL].data,u=l[T.VertexAttrConstants.AUXPOS1].data;return a.applyShaderOffsetsView(C,c,i.objectTransformation,u,n,r.scaleInfo,C),f.vec4.set(M,C[0],C[1],C[2],1),f.vec4.transformMat4(A,M,n.projectionMatrix),d.vec3.scale(r.positionNDC,A,1/A[3]),a.applyShaderOffsetsNDC(r.positionNDC,u,n,r.positionNDC,E),r.distanceWithoutPolygonOffset=n.depthNDCToWorld(E[2]),r.distance=E[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:n.depthNDCToWorld(r.positionNDC[2]),f.vec4.set(A,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),f.vec4.transformMat4(M,A,t),f.vec4.scale(M,M,1/M[3]),d.vec3.set(r.positionView,C[0],C[1],C[2]),r},t.prototype.isCulledByHorizon=function(e,t,r){return d.vec3.copy(D.direction,e.positionView),d.vec3.set(D.origin,0,0,0),!!w.intersectRay(t,D,L)&&e.distanceWithoutPolygonOffset>r},t.prototype.isCulledBySlice=function(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&x.boundedPlane.extrusionContainsPoint(this._runningViewState.slicePlane,t)},t.prototype.expandBoundingRect=function(e,t,r,n){var i=n.positionNDC,a=n.scaleInfo,s=this._runningViewState.camera,l=t.getScreenSize(G);P.applyPrecomputedScaleFactor(l,a.factor,l),l[0]*=s.pixelRatio,l[1]*=s.pixelRatio;var c=y.offset(r.calculateRelativeScreenBounds(l,a.factorAlignment.scale,j),o.lerp(0,s.fullWidth,.5+.5*i[0]),o.lerp(0,s.fullHeight,.5+.5*i[1])),u=this.iconMarginFactor;if(0!==u){var p=u*Math.min(y.width(c),y.height(c));c[0]-=p,c[1]-=p,c[2]+=p,c[3]+=p}y.expand(e.aabr,c)},t.prototype.isConflicted=function(e){for(var t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup],n=Math.floor(r.aabr[0]/this.accBinsSizeX);n<=Math.floor(r.aabr[2]/this.accBinsSizeX);n++)if(!(n<0||n>=this.accBinsNumX))for(var i=Math.floor(r.aabr[1]/this.accBinsSizeY);i<=Math.floor(r.aabr[3]/this.accBinsSizeY);i++)if(!(i<0||i>=this.accBinsNumY))for(var o=this.accBins[n][i],a=0;a<o.length;a++){var s=o.data[a],l=s.info[this.visibilityGroup];if(l&&l.visible&&s.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,y.intersects(l.aabr,r.aabr)))return!0}return!1},t.prototype.initBins=function(e,t){if(null==this.accBins){this.accBins=[];for(var r=0;r<this.accBinsNumX;r++){this.accBins.push([]);for(var n=this.accBins[this.accBins.length-1],i=0;i<this.accBinsNumY;i++)n.push(new s)}}else for(r=0;r<this.accBinsNumX;r++)for(i=0;i<this.accBinsNumY;i++)this.accBins[r][i].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0},t.prototype.addToBins=function(e){for(var t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this.accBinsSizeX),n=Math.floor(t.aabr[2]/this.accBinsSizeX),i=Math.floor(t.aabr[1]/this.accBinsSizeY),o=Math.floor(t.aabr[3]/this.accBinsSizeY),a=r;a<=n;a++)if(!(a<0||a>=this.accBinsNumX))for(var s=i;s<=o;s++)s<0||s>=this.accBinsNumY||this.accBins[a][s].push(e)},t.prototype.setGraphicVisibility=function(e,t){var r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(3,t,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(r,t))},r.__decorate([l.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([l.property({type:Boolean,readOnly:!0})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Deconflictor")],t)}(n);function B(e){var t,n,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!Map.prototype.entries)return[3,5];t=e.entries(),s=t.next(),r.label=1;case 1:return s.done?[3,4]:[4,s.value[1]];case 2:r.sent(),r.label=3;case 3:return s=t.next(),[3,1];case 4:return[3,9];case 5:n=i.valuesOfMap(e),o=0,a=n,r.label=6;case 6:return o<a.length?[4,s=a[o]]:[3,9];case 7:r.sent(),r.label=8;case 8:return o++,[3,6];case 9:return[2]}}))}t.Deconflictor=U;var G=p.vec2f64.create(),H=new(function(){function e(){this.positionView=h.vec3f64.create(),this.positionNDC=h.vec3f64.create(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}return Object.defineProperty(e.prototype,"isOutsideScreen",{get:function(){var e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1},enumerable:!0,configurable:!0}),e}())}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(535),r(1202),r(249)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.params=o.copyParameters(this.material.getParameters()),this.technique=this.techniqueRep.acquireAndReleaseExisting(i.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;var t=3;return this.params.transparent&&(t=this.params.writeDepth?5:8),e===t},t.prototype.setElapsedTimeUniform=function(e){var t=.001*this.material.animation.time;e.setUniform1f("timeElapsed",t*this.params.animationSpeed)},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype._updateSSRState=function(e){e.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:e.ssrEnabled}),this.updateParameters())},t.prototype.ensureResources=function(e){return this.technique.ensureResource(e)},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)},t}(n.GLMaterial);t.WaterGLMaterial=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(447),r(802),r(1203),r(653),r(253),r(257),r(260),r(801),r(228),r(1205),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.waterTextureRepository=t.waterTextureRepository,n}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:n.useSSR,highStepCount:!0});return new m(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),f.Default3D)},t.prototype.ensureResource=function(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1},t.prototype.bindPass=function(e,t,r){0===this.configuration.output&&s.ScreenSpaceReflections.bindUniforms(this.program,e,r),0!==this.configuration.output&&2!==this.configuration.output||(l.WaterDistortion.bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",t.color)},t.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),0===this.configuration.output&&(c.Camera.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e),a.ReadShadowMap.bindUniforms(this.program,e,h.DefaultTextureUnits.SHADOW_MAP))},t.prototype.initializePipeline=function(){var e=this.configuration;return 2===e.output?y.makePipelineState({depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams}):y.makePipelineState({blending:e.transparent&&y.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.shader=new u.ReloadableShaderModule(v,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1205)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(p.ShaderTechnique);t.WaterTechnique=g;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.transparent=!1,t.writeDepth=!1,t.useSSR=!1,t.isDraped=!1,t}return n.__extends(t,e),n.__decorate([d.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([d.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([d.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([d.parameter()],t.prototype,"transparent",void 0),n.__decorate([d.parameter()],t.prototype,"writeDepth",void 0),n.__decorate([d.parameter()],t.prototype,"useSSR",void 0),n.__decorate([d.parameter()],t.prototype,"isDraped",void 0),t}(d.ShaderTechniqueConfiguration);t.WaterTechniqueConfiguration=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1204),r(175)],void 0===(i=function(e,t,r,n,i){function o(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(n.FoamIntensity),e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.WaterDistortion=o,function(e){e.bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}}(o=t.WaterDistortion||(t.WaterDistortion={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.FoamIntensity=function(e){e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))},t.FoamColor=function(e){e.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(654),r(223),r(256),r(933),r(447),r(1206),r(1203),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d,h,f,v,m,y,g,_,b;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new p.ShaderBuilder;return t.include(o.Transform,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),0===e.output&&(t.include(a.NormalUtils,e),t.include(n.ForwardLinearDepth,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.vertex.code.add(u.glsl(d||(d=r.__makeTemplateObject(["\n      void main(void) {\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),t.include(c.WaterDistortion,e),t.include(i.Slice,e),e.receiveShadows&&t.include(s.ReadShadowMap,e),t.include(l.Water,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.code.add(u.glsl(h||(h=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        "])))),e.receiveShadows?t.fragment.code.add(u.glsl(f||(f=r.__makeTemplateObject(["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow = 1.0 - readShadowMap(vpos, linearDepth);\n      "])))):t.fragment.code.add(u.glsl(v||(v=r.__makeTemplateObject(["\n        float shadow = 1.0;\n      "],["\n        float shadow = 1.0;\n      "])))),t.fragment.code.add(u.glsl(m||(m=r.__makeTemplateObject(["\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "]))))),2===e.output&&(t.include(a.NormalUtils,e),t.include(c.WaterDistortion,e),t.include(i.Slice,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(u.glsl(y||(y=r.__makeTemplateObject(["\n        void main(void) {\n          vuv = uv0;\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vuv = uv0;\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(u.glsl(g||(g=r.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "]))))),5===e.output&&(t.include(a.NormalUtils,e),t.varyings.add("vpos","vec3"),t.vertex.code.add(u.glsl(_||(_=r.__makeTemplateObject(["\n        void main(void) {\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(u.glsl(b||(b=r.__makeTemplateObject(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1204),r(1669),r(803),r(802),r(175)],void 0===(i=function(e,t,r,n,i,o,a,s){var l,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.Water=function(e,t){e.include(o.PhysicallyBasedRendering,t),e.include(i.Gamma),e.include(n.FoamColor),t.ssrEnabled&&e.include(a.ScreenSpaceReflections,t),e.fragment.code.add(s.glsl(l||(l=r.__makeTemplateObject(["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],["\n    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness = 0.015;\n    const float foamIntensityExternal = 1.7;\n    const float ssrIntensity = 0.65;\n    const float ssrHeightFadeStart = 300000.0;\n    const float ssrHeightFadeEnd = 500000.0;\n    const float waterDiffusion = 0.775;\n    const float waterSeeColorMod = 0.8;\n    const float correctionViewingPowerFactor = 0.4;\n\n    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor = vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "])))),t.ssrEnabled?e.fragment.code.add(s.glsl(c||(c=r.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])))):e.fragment.code.add(s.glsl(u||(u=r.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.HUDOcclusionPass=function(e){var t=e;t.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "],["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])))),t.fragment.uniforms.add("color","vec4"),t.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n  void main() {\n    gl_FragColor = color;\n  }\n  "],["\n  void main() {\n    gl_FragColor = color;\n  }\n  "]))))},function(e){e.bindUniforms=function(e){e.setUniform4f("color",1,1,1,1)}}(t.HUDOcclusion||(t.HUDOcclusion={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(156),r(366),r(477),r(255),r(191),r(899),r(246),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=o.getLogger("esri.layers.support.labelFormatUtils"),h={type:"simple",evaluate:function(){return null}};function f(e,t,r,n){var i=c.getField(n,e);if(!i)return t;if(null==r[i.name])return"";var o=i.domain;if(o)if("codedValue"===o.type||"coded-value"===o.type)for(var l=r[i.name],u=0,p=o.codedValues;u<p.length;u++){var d=p[u];if(d.code===l)return d.name}else if("range"===o.type){var h=+r[i.name],f="range"in o?o.range[0]:o.minValue,v="range"in o?o.range[1]:o.maxValue;if(f<=h&&h<=v)return o.name}var m=r[i.name];return"date"===i.type||"esriFieldTypeDate"===i.type?m=a.formatDate(m,a.convertDateFormatToIntlOptions("short-date")):c.isNumericField(i)&&(m=s.formatNumber(+m)),m||""}t.createLabelFunction=function(e,t,o){return n.__awaiter(this,void 0,void 0,(function(){var a,s,c,v,m,y,g,_;return n.__generator(this,(function(n){switch(n.label){case 0:return e&&e.symbol?(a=e.where,s=e.getLabelExpression(),a?[4,new Promise((function(e,t){r.e(5).then(function(){var t=[r(301)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:[3,2]):[2,h];case 1:return v=n.sent(),[3,3];case 2:v=null,n.label=3;case 3:return c=v,"arcade"!==s.type?[3,5]:[4,p.createLabelExpression(s.expression,o,t)];case 4:return y=n.sent(),m={type:"arcade",evaluate:function(e){try{var t=y.evaluate({$feature:y.repurposeFeature(e)});if(null!=t)return t.toString()}catch(t){d.error(new i("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:e,expression:s}))}return null},needsHydrationToEvaluate:function(){return null==u.getSingleFieldArcadeExpression(s.expression)}},[3,6];case 5:m={type:"simple",evaluate:function(e){var r=e&&e.attributes;return r?s.expression.replace(/{[^}]*}/g,(function(e){return f(e.slice(1,-1),e,r,t)})):null}},n.label=6;case 6:if(a){try{g=c.WhereClause.create(a,new l(t))}catch(e){return[2,h]}_=m.evaluate,m.evaluate=function(e){return g.testFeature(e)?_(e):null}}return[2,m]}}))}))},t.formatField=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(628),r(1675)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");t.make=function(e,t){if(!n.isCalloutSupport(e))return o.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+e.type+"' does not support callouts"),null;if(!e.callout)return null;var r=a[e.callout.type];return r?new r(e,t):(o.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)};var a={line:i.default}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(214),r(162),r(160),r(195)],void 0===(i=function(e,t,r,n,i,o){var a=function(){function e(t,r,a,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=a,this._position=s,this.center=i.vec3f64.create(),o.assert(t.length>=1),o.assert(a.length%this._numIndexPerPrimitive==0),o.assert(a.length>=t.length*this._numIndexPerPrimitive),o.assert(3===this._position.size||4===this._position.size);var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx,d=0,h=t.length,f=u+p*a[this._numIndexPerPrimitive*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(f),this.bbMin=i.vec3f64.fromValues(c[f],c[f+1],c[f+2]),this.bbMax=i.vec3f64.clone(this.bbMin);d<h;++d)for(var v=this._numIndexPerPrimitive*t[d],m=0;m<this._numIndexPerPrimitive;++m){f=u+p*a[v+m],e.tmpIndices.push(f);var y=c[f];this.bbMin[0]=Math.min(y,this.bbMin[0]),this.bbMax[0]=Math.max(y,this.bbMax[0]),y=c[f+1],this.bbMin[1]=Math.min(y,this.bbMin[1]),this.bbMax[1]=Math.max(y,this.bbMax[1]),y=c[f+2],this.bbMin[2]=Math.min(y,this.bbMin[2]),this.bbMax[2]=Math.max(y,this.bbMax[2])}n.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var g=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var _=c[f=e.tmpIndices.data[d]]-this.center[0],b=c[f+1]-this.center[1],x=c[f+2]-this.center[2],w=_*_+b*b+x*x;if(!(w<=g)){var S=Math.sqrt(w),P=.5*(S-this.bsRadius);this.bsRadius=this.bsRadius+P,g=this.bsRadius*this.bsRadius;var T=P/S;this.center[0]+=_*T,this.center[1]+=b*T,this.center[2]+=x*T}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this._children)return this._children;if(n.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=n.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,o=new Uint8Array(r),a=new Array(8),s=0;s<8;++s)a[s]=0;var l=this._position,c=l.data,u=l.offsetIdx,p=l.strideIdx;for(s=0;s<r;++s){for(var d=0,h=this._numIndexPerPrimitive*this.primitiveIndices[s],f=u+p*this.indices[h],v=c[f],m=c[f+1],y=c[f+2],g=1;g<this._numIndexPerPrimitive;++g){var _=c[f=u+p*this.indices[h+g]],b=c[f+1],x=c[f+2];_<v&&(v=_),b<m&&(m=b),x<y&&(y=x)}v<t[0]&&(d|=1),m<t[1]&&(d|=2),y<t[2]&&(d|=4),o[s]=d,++a[d]}var w=0;for(s=0;s<8;++s)a[s]>0&&++w;if(w<2)return;var S=new Array(8);for(s=0;s<8;++s)S[s]=a[s]>0?new Uint32Array(a[s]):void 0;for(s=0;s<8;++s)a[s]=0;for(s=0;s<r;++s)S[d=o[s]][a[d]++]=this.primitiveIndices[s];for(this._children=new Array(8),s=0;s<8;++s)void 0!==S[s]&&(this._children[s]=new e(S[s],this._numIndexPerPrimitive,this.indices,this._position))}return this._children},e}();return function(e){e.tmpIndices=new r({deallocator:null})}(a||(a={})),a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(939),r(1264)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getGraphics3DSymbol=function(e){return e instanceof n?e.graphics3DSymbol:e instanceof r?e:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(226),r(152),r(230),r(205),r(216),r(162),r(160),r(232),r(193),r(173),r(207),r(243),r(448),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){var y=new o(Array,(function(e){return p.set(e,p.ZERO)}),null,10,5),g=d.create();return function(){function e(e,t,r,n,o){this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function(e,t){for(var r=new Array(2),n=0;n<r.length;n++)r[n]=new Array(4);return r}(),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this.graphics3DSymbol=t,this.graphic=e,this._graphics=r,this._featureExpressionFeature=o?v.createFeature(o,e,n):null;for(var a=0,s=this._graphics;a<s.length;a++){var l=s[a];i.isSome(l)&&(this.isElevationSource=this.isElevationSource||l.isElevationSource)}}return Object.defineProperty(e.prototype,"labelGraphics",{get:function(){return this._labelGraphics},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent},enumerable:!0,configurable:!0}),e.prototype.initialize=function(e,t,r){var n=this;this._layer=t,this._stage=e,this.forEachSymbolLayerGraphic((function(i){i.initialize(e,t,r),i.setVisibility(n.isVisible())}))},e.prototype.destroy=function(){this.forEachSymbolLayerGraphic((function(e){return e.destroy()})),this._graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null},Object.defineProperty(e.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0}),e.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic((function(e){return e.destroy()})),this._labelGraphics.length=0},e.prototype.addLabelGraphic=function(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))},e.prototype.addAuxiliaryGraphic=function(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))},Object.defineProperty(e.prototype,"isDraped",{get:function(){var e=!1;return this.forEachSymbolLayerGraphic((function(t){"draped"===t.type&&(e=!0)})),e},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(e,t){void 0===e&&(e=0);for(var r=0;r<=e;r++)for(var n=this._visibilityFlags[r],i=0;i<n.length;++i)if(!1===n[i]&&i!==t)return!1;return!0},e.prototype.hasVisibilityFlag=function(e,t){return null!=this._visibilityFlags[t][e]},e.prototype.setVisibilityFlag=function(e,t,r){var n=this.isVisible(r);this._visibilityFlags[r][e]=t;var i=this.isVisible(r);if(n===i)return!1;if(1===r)this.forEachLabelGraphic((function(e){return e.setVisibility(i)}));else{this.forEachSymbolLayerGraphic((function(e){return e.setVisibility(i)}));var o=this.isVisible(1);this.forEachLabelGraphic((function(e){return e.setVisibility(o)}))}return!0},e.prototype.clearVisibilityFlag=function(e,t){return void 0===t&&(t=0),this.setVisibilityFlag(e,void 0,t)},e.prototype.getBSRadius=function(){var e=0;return this.forEachSymbolLayerGraphic((function(t){e=Math.max(e,t.getBSRadius())})),e},e.prototype.getCenterObjectSpace=function(e){if(void 0===e&&(e=c.vec3f64.create()),0===this._graphics.length)return l.vec3.set(e,0,0,0),e;var t=this._graphics[0];return i.isSome(t)?t.getCenterObjectSpace(e):e},e.prototype.computeExtent=function(e){if(!this._extent){var t=this.graphic.geometry;if(i.isNone(t))return!1;this._extent=d.create(),h.computeAABR(t,this._extent);var r=t.spatialReference;if(!r.equals(e)&&!m.boundingRectToBoundingRect(this._extent,r,this._extent,e))return this._extent=null,!1}return!0},e.prototype.getAsOptimizedGeometry=function(e,t){return this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry},e.prototype._convertGraphicToOptimizedGeometry=function(e,t,r){var n=e.geometry;return"mesh"!==n.type&&"extent"!==n.type||(n=u.fromExtent("mesh"===n.type?n.extent:n)),f.convertFromGeometry(n,t,r)},Object.defineProperty(e.prototype,"usedMemory",{get:function(){var e=this,t=h.estimateAttributesObjectSize(this.graphic.attributes);return this.forEachSymbolLayerGraphic((function(r){var n=r.graphics3DSymbolLayer.complexity,i="draped"===r.type?n.memory.draped:n.memory;t+=i.bytesPerFeature,i.bytesPerCoordinate&&(t+=h.numVertices(e.graphic.geometry)*i.bytesPerCoordinate)})),t},enumerable:!0,configurable:!0}),e.prototype.computeAttachmentOrigin=function(){for(var e={render:{origin:c.vec3f64.create(),num:0},draped:{origin:s.vec2f64.create(),num:0}},t=0,r=this._graphics;t<r.length;t++){var n=r[t];i.isNone(n)||n.computeAttachmentOrigin(e)}return e.render.num&&l.vec3.scale(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&a.vec2.scale(e.draped.origin,e.draped.origin,1/e.draped.num),e},e.prototype.getProjectedBoundingBox=function(e,t,o,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l=this;return r.__generator(this,(function(c){switch(c.label){case 0:return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?p.empty(s.boundingBox):s.boundingBox=p.empty(),s.requiresDrapedElevation=!1,[4,n.forEach(this._graphics,(function(n){return r.__awaiter(l,void 0,void 0,(function(){var l,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return i.isNone(n)?[2]:(l="draped"===n.type?t:e,c=y.acquire(),[4,n.getProjectedBoundingBox(l,o,s.screenSpaceObjects,a,c)]);case 1:return u=r.sent(),isFinite(u[2])&&isFinite(u[5])||(s.requiresDrapedElevation=!0),u&&p.expand(s.boundingBox,c),y.release(c),[2]}}))}))}))];case 1:return c.sent(),p.allFinite(s.boundingBox)||d.allFinite(p.toRect(s.boundingBox,g))?[2,s]:[2,null]}}))}))},e.prototype.needsElevationUpdates=function(){for(var e=0,t=this._graphics;e<t.length;e++){var r=t[e];if(i.isSome(r)&&("object3d"===r.type||"lod-instance"===r.type)&&r.needsElevationUpdates)return!0}for(var n=0,o=this._labelGraphics;n<o.length;n++)if((r=o[n])&&r.needsElevationUpdates)return!0;return!1},e.prototype.alignWithElevation=function(e,t,r){var n=this;this.forEachRenderedGraphic((function(i){"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,n._featureExpressionFeature,r)}))},e.prototype.addObjectStateSet=function(e,t){this.forEachSymbolLayerGraphic((function(r){return r.addObjectState(e,t)}))},e.prototype.removeObjectState=function(e){this.forEachSymbolLayerGraphic((function(t){return t.removeObjectState(e)}))},e.prototype.forEachGraphicList=function(e,t){e.forEach((function(e){return e&&t(e)}))},e.prototype.forEachSymbolLayerGraphic=function(e){this.forEachGraphicList(this._graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)},e.prototype.forEachLabelGraphic=function(e){this.forEachGraphicList(this._labelGraphics,e)},e.prototype.forEachRenderedGraphic=function(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(538),r(427),r(1214)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){for(var i=e.length,o=new Array(i),s=new Array(i),l=new Array(i),c=0,u=0,p=0,d=0,h=0;h<i;++h)d+=e[h].length;for(var f,v=new Float64Array(3*d),m=0,y=i-1;y>=0;y--){var g=e[y],_=1===r&&(f=g,!n.isClockwise(f,!1,!1));if(_&&1!==i)o[c++]=g;else{var b=g.length;for(h=0;h<c;++h)b+=o[h].length;var x={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};x.pathLengths[0]=g.length,g.length>0&&(l[p++]={index:m,count:g.length}),m=_?a(g,g.length-1,-1,v,m,g.length,t):a(g,0,1,v,m,g.length,t);for(var w=0;w<c;++w){var S=o[w];x.holeIndices[w]=m,x.pathLengths[w+1]=S.length,S.length>0&&(l[p++]={index:m,count:S.length}),m=a(S,0,1,v,m,S.length,t)}c=0,x.count>0&&(s[u++]=x)}}for(w=0;w<c;++w)(S=o[w]).length>0&&(l[p++]={index:m,count:S.length}),m=a(S,0,1,v,m,S.length,t);return u<i&&(s.length=u),p<i&&(l.length=p),{position:v,polygons:s,outlines:l}}function a(e,t,r,n,i,o,a){i*=3;for(var s=0;s<o;++s){var l=e[t];n[i++]=l[0],n[i++]=l[1],n[i++]=a?l[2]:0,t+=r}return i/3}Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){for(var t=o(e.rings,e.hasZ,1),n=[],a=0,s=0,l=function(e){var i=e.count,o=e.index,l=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*i),c=e.holeIndices.map((function(e){return e-o})),u=new Uint32Array(r.earcut(l,c,3));n.push({position:l,faces:u}),a+=l.length,s+=u.length},c=0,u=t.polygons;c<u.length;c++)l(u[c]);var p=function(e,t,r){if(1===e.length)return e[0];for(var n=new Float64Array(t),i=new Uint32Array(r),o=0,a=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],p=0;p<u.position.length;p++)n[o++]=u.position[p];for(p=0;p<u.faces.length;p++)i[a++]=u.faces[p]+s;s=o/3}return{position:n,faces:i}}(n,a,s),d=i.default(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(d.buffer),p.faces=d.indices,p},t.pathsToTriangulationInfo=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168)],void 0===(i=function(e,t,r){function n(e,t,n){var l=e.byteLength/(4*t),c=new Uint32Array(e,0,l*t),u=new Uint32Array(l),p=n&&n.minReduction||0,d=n&&n.originalIndices||null,h=n&&n.componentOffsets||null,f=0;if(h)for(var v=0;v<h.length-1;v++){var m=h[v+1]-h[v];m>f&&(f=m)}else f=l;var y=Math.floor(1.1*f)+1;for((null==s||s.length<2*y)&&(s=new Uint32Array(r.nextHighestPowerOfTwo(2*y))),v=0;v<2*y;v++)s[v]=0;var g=0,_=!!h&&!!d,b=_?d.length:l,x=_?new Uint32Array(d.length):null,w=1.96,S=0!==p?Math.ceil(7.84*w/(p*p)*p*(1-p)):b,P=1,T=h?h[1]:b;for(v=0;v<b;v++){if(v===S){var O=1-g/v;if(O+w*Math.sqrt(O*(1-O)/v)<p)return null;S*=2}if(v===T){for(var C=0;C<2*y;C++)s[C]=0;if(d)for(var M=h[P-1];M<h[P];M++)x[M]=u[d[M]];T=h[++P]}for(var A=_?d[v]:v,E=a(c,j=A*t,t),I=E%y,R=g;0!==s[2*I+1];){if(s[2*I]===E){var D=s[2*I+1]-1;if(i(c,j,D*t,t)){R=u[D];break}}++I>=y&&(I-=y)}R===g&&(s[2*I]=E,s[2*I+1]=A+1,g++),u[A]=R}if(0!==p&&1-g/l<p)return null;if(_){for(v=h[P-1];v<x.length;v++)x[v]=u[d[v]];u=x}var L=new Uint32Array(t*g);for(g=0,v=0;v<b;v++){var j;u[v]===g&&(o(c,j=(_?d[v]:v)*t,L,g*t,t),g++)}if(d&&!_){var V=new Uint32Array(d.length);for(v=0;v<V.length;v++)V[v]=u[d[v]];u=V}return{buffer:L.buffer,indices:u,uniqueCount:g}}function i(e,t,r,n){for(var i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}function o(e,t,r,n,i){for(var o=0;o<i;o++)r[n+o]=e[t+o]}function a(e,t,r){for(var n=0,i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}Object.defineProperty(t,"__esModule",{value:!0}),t.deduplicate=n;var s=null;t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._uniforms=null},e.prototype.getPrograms=function(e){return this._uniforms[e]||[]},e.prototype.subscribeProgram=function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)},e.prototype.unsubscribeProgram=function(e){for(var t in this._uniforms)r.removeUnordered(this._uniforms[t],e)},e}();t.CommonUniformStore=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(153)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0},a=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()},e.prototype.acquire=function(e,t){var r=t.key,n=this._perConstructorInstances.get(e);n||(n=new Map,this._perConstructorInstances.set(e,n));var i=n.get(r);return void 0===i&&(i=new o(new e(this._context,t)),n.set(r,i)),++i.refCount,i.technique},e.prototype.acquireAndReleaseExisting=function(e,t,r){return n.isNone(r)?this.acquire(e,t):t.key===r.key&&r instanceof e?r:(this.release(r),this.acquire(e,t))},e.prototype.release=function(e){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},e.prototype.frameUpdate=function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,r){t.forEach((function(r,n){0===r.refCount&&r.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(r.technique.dispose(),t.delete(n))})),0===t.size&&e._perConstructorInstances.delete(r)}))},e.prototype.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},e.prototype.hotReload=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(n){switch(n.label){case 0:return e=new Array,this._perConstructorInstances.forEach((function(n,i){e.push(function(e,n){return r.__awaiter(t,void 0,void 0,(function(){var t,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=n.shader)?[4,t.reload()]:[3,2];case 1:r.sent(),e.forEach((function(e){e.technique.reload(i._context)})),r.label=2;case 2:return[2]}}))}))}(n,i))})),[4,i.all(e)];case 1:return n.sent(),[2]}}))}))},e}();t.ShaderTechniqueRepository=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(152),r(1680),r(195)],void 0===(i=function(e,t,r,n,i,o){var a=r.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),s=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,o.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t,r){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=r,this._id2glMaterialRef=new Map}return e.prototype.acquire=function(e,t){this.ownMaterial(e);var r,n=i.getShaderOutputID(e.id,t),o=this._id2glMaterialRef.get(n);return null==o?(r=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t}),o=new s(r),this._id2glMaterialRef.set(n,o)):r=o.getGLMaterial(),o.incRefCnt(),r},e.prototype.release=function(e,t){var r=i.getShaderOutputID(e.id,t),n=this._id2glMaterialRef.get(r);if(n.decRefCnt(),0===n.getRefCnt()){var o=n.getGLMaterial();o&&o.dispose(),this._id2glMaterialRef.delete(r)}},e.prototype.materialChanged=function(e){for(var t=0,r=i.ShaderOutputTypes;t<r.length;t++){var n=r[t];if(5!==n.output&&6!==n.output){var o=this._id2glMaterialRef.get(i.getShaderOutputID(e.id,n.output));if(o&&o.getGLMaterial()){var a=o.getGLMaterial();a.updateParameters&&a.updateParameters()}}}this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.ownMaterial=function(e){n.isSome(e.materialRepository)&&e.materialRepository!==this&&a.error("Material is already owned by a different material repository"),e.materialRepository=this},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230),r(214),r(162),r(160),r(203),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(){function e(e,t){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=e,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth)),this._root=new c(null,o.vec3f64.fromValues(0,0,0),0)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,c.clearPool(),_[0]=null,T.prune(),I.prune(),R.prune()},e.prototype.add=function(e,t){var r=b(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r,t);for(var n=c.acquire(),i=0;i<t;i++){var o=r[i];this._isDegenerate(o)?this._degenerateObjects.add(o):(n.init(this._root),this._add(o,n))}c.release(n)},e.prototype.remove=function(e,t){var r=b(e);this._objectCount-=r.length;for(var n=c.acquire(),i=0,o=r;i<o.length;i++){var a=o[i],s=t||this._boundingSphereFromObject(a,O);this._isValidRadius(s.radius)?(n.init(this._root),this._remove(a,s,n)):this._degenerateObjects.delete(a)}c.release(n),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var n=this,i=a.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!n._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forEach((function(e){n._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forEach((function(e){n._intersectsObject(i,e)&&r(e)})),!0}))},e.prototype.forEachAlongRayWithVerticalOffset=function(e,t,r,n){var i=this,o=a.ray.wrap(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(o,e,n))return!1;var t=e.node;return t.terminals.forEach((function(e){i._intersectsObjectWithOffset(o,e,n)&&r(e)})),null!==t.residents&&t.residents.forEach((function(e){i._intersectsObjectWithOffset(o,e,n)&&r(e)})),!0}))},e.prototype.forEach=function(e){this._forEachNode(this._root,(function(t){var r=t.node;return r.terminals.forEach(e),null!==r.residents&&r.residents.forEach(e),!0})),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,n,i){return this._findClosest(e,"front-to-back"===t?1:-1,r,n,i)},e.prototype.forEachInDepthRange=function(e,t,r,n,i,o,a,s){this._forEachInDepthRange(e,t,"front-to-back"===r?1:-1,n,i,o,a,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.center,2*t.halfSize)}))},e.prototype._intersectsNode=function(e,t){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,P),s.rayBoxTest(e.origin,e.direction,S,P)},e.prototype._intersectsNodeWithOffset=function(e,t,r){return d(t.center,2*-t.halfSize,S),d(t.center,2*t.halfSize,P),r.applyToMinMax(S,P),s.rayBoxTest(e.origin,e.direction,S,P)},e.prototype._intersectsObject=function(e,t){var r=this._objectToBoundingSphere.getRadius(t);return!(r>0)||a.sphere.intersectsRay(a.sphere.wrap(r,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._intersectsObjectWithOffset=function(e,t,r){var n=this._objectToBoundingSphere.getRadius(t);return!(n>0)||a.sphere.intersectsRay(r.applyToBoundingSphere(n,this._objectToBoundingSphere.getCenter(t)),e)},e.prototype._forEachNode=function(e,t){for(var r=c.acquire().init(e),n=[r];0!==n.length;){if(t(r=n.pop())&&!r.isLeaf())for(var i=0;i<r.node.children.length;i++)r.node.children[i]&&n.push(c.acquire().init(r).advance(i));c.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,n){void 0===n&&(n=1);var i=c.acquire().init(e),o=[i];for(function(e,t,r){if(!I.length)for(var n=0;n<8;++n)I.push({index:0,distance:0});for(n=0;n<8;++n){var i=m[n];I.data[n].index=n,I.data[n].distance=v(e,t,i)}for(I.sort((function(e,t){return e.distance-t.distance})),r.clear(),n=0;n<8;++n)r.push(I.data[n].index)}(r,n,R);0!==o.length;){if(t(i=o.pop())&&!i.isLeaf())for(var a=7;a>=0;--a){var s=R.data[a];s>=i.node.children.length||i.node.children[s]&&o.push(c.acquire().init(i).advance(s))}c.release(i)}},e.prototype._findClosest=function(e,t,r,n,o){var a=this,s=1/0,l=1/0,c=null,u=f(e,t),p=0,d=function(i){if(++p,!n||n(i)){var o=a._objectToBoundingSphere.getCenter(i),u=a._objectToBoundingSphere.getRadius(i);if(!r||!h(o,u,r)){var d=v(e,t,o),f=d-u;f<s&&(s=f,l=d+u,c=i)}}};return this._forEachNodeDepthOrdered(this._root,(function(n){if(null!=o&&p>=o)return!1;if(r&&h(n.center,n.halfSize*g,r))return!1;if(i.vec3.scale(w,u,n.halfSize),i.vec3.add(w,w,n.center),v(e,t,w)>l)return!1;var a=n.node;return a.terminals.forEach((function(e){d(e)})),null!==a.residents&&a.residents.forEach((function(e){d(e)})),!0}),e,t),c},e.prototype._forEachInDepthRange=function(e,t,r,n,o,a,s,l){var c=this,u=-1/0,p=1/0,d={setRange:function(e){1===r?(u=Math.max(u,e.near),p=Math.min(p,e.far)):(u=Math.max(u,-e.far),p=Math.min(p,-e.near))}};d.setRange(n);var m=v(t,r,e),y=f(t,r),_=f(t,-1*r),b=0,x=function(e){if(++b,!s||s(e)){var n=c._objectToBoundingSphere.getCenter(e),i=c._objectToBoundingSphere.getRadius(e),l=v(t,r,n)-m;l-i>p||l+i<u||a&&h(n,i,a)||o(e,d)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(null!=l&&b>=l)return!1;if(a&&h(e.center,e.halfSize*g,a))return!1;if(i.vec3.scale(w,y,e.halfSize),i.vec3.add(w,w,e.center),v(t,r,w)-m>p)return!1;if(i.vec3.scale(w,_,e.halfSize),i.vec3.add(w,w,e.center),v(t,r,w)-m<u)return!1;var n=e.node;return n.terminals.forEach((function(e){x(e)})),null!==n.residents&&n.residents.forEach((function(e){x(e)})),!0}),t,r)},e.prototype._remove=function(e,t,r){T.clear();var n=r.advanceTo(t,(function(e,t){T.push(e.node),T.push(t)}))?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(var i=T.length-2;i>=0;i-=2){var o=T.data[i],a=T.data[i+1];if(!this._purge(o,a))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new n({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,O))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var n=c.acquire().init(e);this._add(t.data[r],n),c.release(n)}},e.prototype._grow=function(e,t){var r=this;if(0!==t){var n=this._boundingSphereFromObjects(e,t,(function(e,t){return r._boundingSphereFromObject(e,t)}),C);if(this._isValidRadius(n.radius)&&!this._fitsInsideTree(n))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,n.center),this._root.halfSize=1.25*n.radius;else{var o=c.acquire();this._rootBoundsForRootAsSubNode(n,o),this._placingRootViolatesMaxDepth(o)?this._rebuildTree(n,o):this._growRootAsSubNode(o),c.release(o)}}},e.prototype._rebuildTree=function(e,t){var r=this;i.vec3.copy(M.center,t.center),M.radius=t.halfSize;var n=this._boundingSphereFromObjects([e,M],2,(function(e){return e}),A),o=c.acquire().init(this._root);this._root.initFrom(null,n.center,1.25*n.radius),this._forEachNode(o,(function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0})),c.release(o)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,(function(e){return t=Math.max(t,e.depth),!0})),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,n=e.center,i=-1/0,o=this._root.center,a=this._root.halfSize,s=0;s<3;s++){var l=o[s]-a-(n[s]-r),c=n[s]+r-(o[s]+a),u=Math.max(0,Math.ceil(l/(2*a))),p=Math.max(0,Math.ceil(c/(2*a)))+1,d=Math.pow(2,Math.ceil(Math.log(u+p)*Math.LOG2E));i=Math.max(i,d),E[s].min=u,E[s].max=p}for(s=0;s<3;s++){var h=(i-((u=E[s].min)+(p=E[s].max)))/2;u+=Math.ceil(h),p+=Math.floor(h);var f=o[s]-a-u*a*2;x[s]=f+(p+u)*a}return t.initFrom(null,x,i*a,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(C.center,this._root.center),C.radius=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,n=0;n<t.length&&null==e;)e=t[r=n++];for(;n<t.length;)if(t[n++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,n=e.center;return e.radius<=r&&n[0]>=t[0]-r&&n[0]<=t[0]+r&&n[1]>=t[1]-r&&n[1]<=t[1]+r&&n[2]>=t[2]-r&&n[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r,n){if(1===t){var o=r(e[0],C);i.vec3.copy(n.center,o.center),n.radius=o.radius}else{S[0]=1/0,S[1]=1/0,S[2]=1/0,P[0]=-1/0,P[1]=-1/0,P[2]=-1/0;for(var a=0;a<t;a++)o=r(e[a],C),this._isValidRadius(o.radius)&&(u(S,o.center,o.radius),p(P,o.center,o.radius));i.vec3.lerp(n.center,S,P,.5),n.radius=Math.max(P[0]-S[0],P[1]-S[1],P[2]-S[2])/2}return n},e}(),c=function(){function e(e,t,r){void 0===r&&(r=0),this.center=o.vec3f64.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,n,o){return void 0===t&&(t=null),void 0===n&&(n=this.halfSize),void 0===o&&(o=this.depth),this.node=t||e.createEmptyNode(),r&&i.vec3.copy(this.center,r),this.halfSize=n,this.depth=o,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var n=m[t];return this.center[0]+=n[0]*this.halfSize,this.center[1]+=n[1]*this.halfSize,this.center[2]+=n[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var n=this._childIndex(e);t&&t(this,n),this.advance(n)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,n=0,i=0;i<3;i++)r[i]<t[i]&&(n|=1<<i);return n},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new n({shrink:!0}),residents:new n({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new r(e),e}();function u(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function p(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function d(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function h(e,t,r){return!a.frustum.intersectsSphere(r.planes,a.sphere.wrap(t,e))}function f(e,t){for(var r=1/0,n=null,i=0;i<8;++i){var o=v(e,t,y[i]);o<r&&(r=o,n=y[i])}return n}function v(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var m=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,1,1)],y=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(1,1,1)],g=Math.sqrt(3),_=[null];function b(e){return Array.isArray(e)?e:(_[0]=e,_)}var x=o.vec3f64.create(),w=o.vec3f64.create(),S=o.vec3f64.create(),P=o.vec3f64.create(),T=new n,O={center:o.vec3f64.create(),radius:0},C={center:o.vec3f64.create(),radius:0},M={center:o.vec3f64.create(),radius:0},A={center:o.vec3f64.create(),radius:0},E=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new n,R=new n;return l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(276),r(389)],void 0===(i=function(e,t,r,n){var i;return function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:n.vec3f32.fromValues(1,1,1),vvSizeMaxSize:n.vec3f32.fromValues(100,100,100),vvSizeOffset:n.vec3f32.fromValues(0,0,0),vvSizeFactor:n.vec3f32.fromValues(1,1,1),vvSizeValue:n.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:r.mat3f64.create()}}(i||(i={})),i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(1681),r(1221),r(934),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new l.ShaderBuilder;t.extensions.add("GL_OES_standard_derivatives"),t.include(a.PiUtils),t.include(i.RibbonVertexPosition,e),t.include(o.LineStipple,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3");var L=e.falloffEnabled,j=e.innerColorEnabled;return j&&t.varyings.add("vLineDistance","float"),L&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(s.glsl(c||(c=r.__makeTemplateObject(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s = sin(a);\n\t\t\tfloat c = cos(a);\n\t\t\tmat2 m = mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"])))),t.vertex.code.add(s.glsl(u||(u=r.__makeTemplateObject(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc = proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *= screenSize / posNdc.w;\n      return posNdc;\n    }\n"])))),t.vertex.code.add(s.glsl(p||(p=r.__makeTemplateObject(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"],["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -nearPlane) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -nearPlane) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -nearPlane) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -nearPlane) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])))),t.vertex.code.add(s.glsl(d||(d=r.__makeTemplateObject(["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "],["\n  void main(void) {\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n      bool isJoin = abs(uv0.y)-3.0 < 0.0;\n\n      float lineWidth = getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])))),e.stippleEnabled&&t.vertex.code.add(s.glsl(h||(h=r.__makeTemplateObject(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "],["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;\n    "])))),t.vertex.code.add(s.glsl(f||(f=r.__makeTemplateObject(['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '],['\n    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir = vec2(0, 0);\n    vec2 joinDisplacementDir = vec2(0, 0);\n    float displacementLen = lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside = ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir = normalize(left + right);\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen > 0.001 && rightLen > 0.001) {\n        float nDotSeg = dot(joinDisplacementDir, left);\n        displacementLen /= length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside && (displacementLen > miterLimit * lineWidth)) {\n    '])))),e.roundJoins?t.vertex.code.add(s.glsl(v||(v=r.__makeTemplateObject(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])))):t.vertex.code.add(s.glsl(m||(m=r.__makeTemplateObject(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "],["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen < 0.001) {\n          joinDisplacementDir = right;\n        }\n        else if (rightLen < 0.001) {\n          joinDisplacementDir = left;\n        }\n        else {\n          joinDisplacementDir = isStartVertex ? right : left;\n        }\n        joinDisplacementDir = normalize(joinDisplacementDir);\n        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n  "])))),t.vertex.code.add(s.glsl(y||(y=r.__makeTemplateObject(["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "],["\n        displacementLen = lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen < 0.001) {\n      joinDisplacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      joinDisplacementDir = left;\n    }\n    else {\n      joinDisplacementDir = isStartVertex ? right : left;\n    }\n    joinDisplacementDir = normalize(joinDisplacementDir);\n    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n    displacementLen = lineWidth;\n\n    capDisplacementDir = isStartVertex ? -right : left;\n  "])))),e.roundCaps?t.vertex.code.add(s.glsl(g||(g=r.__makeTemplateObject(["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "],["\n    float angle = subdivisionFactor*PI*0.5;\n    joinDisplacementDir *= cos(angle);\n    capDisplacementDir *= sin(angle);\n    "])))):t.vertex.code.add(s.glsl(_||(_=r.__makeTemplateObject(["\n    capDisplacementDir *= subdivisionFactor;\n    "],["\n    capDisplacementDir *= subdivisionFactor;\n    "])))),t.vertex.code.add(s.glsl(S||(S=r.__makeTemplateObject(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy += dpos;\n  "])),L||j?s.glsl(b||(b=r.__makeTemplateObject(["float lineDist = lineWidth * sign(uv0.y) * pos.w;"],["float lineDist = lineWidth * sign(uv0.y) * pos.w;"]))):"",j?s.glsl(x||(x=r.__makeTemplateObject(["vLineDistance = lineDist;"],["vLineDistance = lineDist;"]))):"",L?s.glsl(w||(w=r.__makeTemplateObject(["vLineDistanceNorm = lineDist / lineWidth;"],["vLineDistanceNorm = lineDist / lineWidth;"]))):"")),e.stippleEnabled&&(t.vertex.code.add(s.glsl(P||(P=r.__makeTemplateObject(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "],["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec = pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength = length(stippleSegmentDirection);\n    "])))),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(s.glsl(T||(T=r.__makeTemplateObject(["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats = max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax = roundedNumberOfPatternRepeats;\n      "])))),t.vertex.code.add(s.glsl(O||(O=r.__makeTemplateObject(["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength >= 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv = 1.0;\n        }\n      }\n    "])),e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"))),t.vertex.code.add(s.glsl(C||(C=r.__makeTemplateObject(["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "],["\n      // Convert back into NDC\n      pos.xy = pos.xy / screenSize * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      gl_Position = pos;\n    }\n  }\n  "])))),t.include(n.Slice,e),0===e.output&&(t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.code.add(s.glsl(M||(M=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color = intrinsicColor * vColor;\n    "])))),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(s.glsl(A||(A=r.__makeTemplateObject(["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "],["\n      float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\n      color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "]))))),t.fragment.code.add(s.glsl(E||(E=r.__makeTemplateObject(["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "],["\n      vec4 finalColor = blendStipple(color, stippleAlpha);\n    "])))),e.falloffEnabled&&t.fragment.code.add(s.glsl(I||(I=r.__makeTemplateObject(["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "],["\n      finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "])))),t.fragment.code.add(s.glsl(R||(R=r.__makeTemplateObject(["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "],["\n      gl_FragColor = highlightSlice(finalColor, vpos);\n    }\n    "]))))),4===e.output&&t.fragment.code.add(s.glsl(D||(D=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "])))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.LineStipple=function(e,t){e.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001),e.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),t.stippleOffColorEnabled?e.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])))):e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))}(e,t):function(e){e.fragment.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))}(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t,r,i,o,a){this.camera=null,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=n,this.hasOccludees=!1,this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=r,this.shadowMap=i,this.ssaoHelper=o,this.sliceHelper=a}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=n},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}(),n=13;return r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(195)],void 0===(i=function(e,t,r){function n(e){return t=e.data,r.getFirstObjectValue(t.indices).length>=1;var t}Object.defineProperty(t,"__esModule",{value:!0}),t.splitRenderGeometryChangeSetByMaterial=function(e){for(var t=new Map,r=null,i=null,o=function(e){if(e===r)return i;var n=t.get(e);return n||(n={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},t.set(e,n)),r=e,i=n,n},a=0;a<e.numToAdd;a++)n(s=e.toAdd[a])&&o(s.material).toAdd.push(s);for(a=0;a<e.numToRemove;a++){var s;n(s=e.toRemove[a])&&o(s.material).toRemove.push(s)}for(a=0;a<e.numToUpdate;a++){var l=e.toUpdate[a];n(l.renderGeometry)&&o(l.renderGeometry.material).toUpdate.push(l)}return t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1225),r(253),r(257),r(260),r(228),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build();return new c(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return this.configuration.hasAlpha?u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),colorWrite:u.defaultColorWriteParams}):u.makePipelineState({colorWrite:u.defaultColorWriteParams})},t.shader=new o.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1225)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(a.ShaderTechnique);t.TextureTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAlpha=!1,t}return n.__extends(t,e),n.__decorate([s.parameter()],t.prototype,"hasAlpha",void 0),t}(s.ShaderTechniqueConfiguration);t.TextureTechniqueConfiguration=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(946),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(){var e=new o.ShaderBuilder;return e.include(n.ScreenSpacePass),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(1683)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=n.vec3f64.create(),a=function(){function e(){this._renderLighting={main:{intensity:n.vec3f64.create(),direction:n.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:n.vec3f64.create(),ambient:{color:n.vec3f64.create(),intensity:0},diffuse:{color:n.vec3f64.create(),intensity:0}}}return e.prototype.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)},e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting),r.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var n=r.vec3.copy(o,this._oldSunlight.diffuse.color);r.vec3.scale(n,n,.4*this._info.globalFactor),r.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,n)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0}),e}();t.SceneLighting=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(152),r(1685),r(1686),r(217),r(496),r(1687)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function c(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){var n=this;this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=s.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=l.loadCapabilities(e,t);var i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]},r("esri-webgl-debug")&&(this.instanceCounter=new o.InstanceCounter),this._stateTracker=new a.StateTracker({setBlending:function(e){if(e){n.setBlendingEnabled(!0),n.setBlendEquationSeparate(e.opRgb,e.opAlpha),n.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);var t=e.color;n.setBlendColor(t.r,t.g,t.b,t.a)}else n.setBlendingEnabled(!1)},setCulling:function(e){e?(n.setFaceCullingEnabled(!0),n.setCullFace(e.face),n.setFrontFace(e.mode)):n.setFaceCullingEnabled(!1)},setPolygonOffset:function(e){e?(n.setPolygonOffsetFillEnabled(!0),n.setPolygonOffset(e.factor,e.units)):n.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(e){e?(n.setDepthTestEnabled(!0),n.setDepthFunction(e.func)):n.setDepthTestEnabled(!1)},setStencilTest:function(e){if(e){n.setStencilTestEnabled(!0);var t=e.function;n.setStencilFunction(t.func,t.ref,t.mask);var r=e.operation;n.setStencilOp(r.fail,r.zFail,r.zPass)}else n.setStencilTestEnabled(!1)},setDepthWrite:function(e){e?(n.setDepthWriteEnabled(!0),n.setDepthRange(e.zNear,e.zFar)):n.setDepthWriteEnabled(!1)},setColorWrite:function(e){e?n.setColorMask(e.r,e.g,e.b,e.a):n.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(e){e?n.setStencilWriteMask(e.mask):n.setStencilWriteMask(0)}}),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){if(!this._parameters){var e=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:e?this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},r("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setPipelineState=function(e){this._stateTracker.setPipeline(e)},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendColor=function(e,t,r,n){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&n===this._blendColorState.a||(this.gl.blendColor(e,t,r,n),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=n,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunctionSeparate=function(e,t,r,n){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===n||(this.gl.blendFuncSeparate(e,t,r,n),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=n,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setColorMask=function(e,t,r,n){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===n||(this.gl.colorMask(e,t,r,n),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=n,this._stateTracker.invalidateColorWrite())},e.prototype.setClearColor=function(e,t,r,n){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===n||(this.gl.clearColor(e,t,r,n),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=n)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,r,n){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===n||(this.gl.scissor(e,t,r,n),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=n)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilFunctionSeparate=function(e,t,r,n){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,t,r,n),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())},e.prototype.setStencilOp=function(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilOpSeparate=function(e,t,r,n){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,t,r,n),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(i.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.clearSafe=function(e,t){void 0===t&&(t=255),e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))},e.prototype.drawArrays=function(e,t,n){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=c(e,n)),this.gl.drawArrays(e,t,n)},e.prototype.drawElements=function(e,t,n,i){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=c(e,t)),5123!==n?5125===n&&this.gl.drawElements(e,t,n,i):this.gl.drawElements(e,t,n,i)},e.prototype.logIno=function(){r("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,r,n){var i=this._viewport;i.x===e&&i.y===t&&i.width===r&&i.height===n||(i.x=e,i.y=t,i.width=r,i.height=n,this.gl.viewport(e,t,r,n))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,r){void 0===r&&(r=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),(r>=e._MAX_TEXTURE_IMAGE_UNITS||r<0)&&console.error("Input texture unit is out of range of available units!");var n=this._textureUnitMap[r];if(this.setActiveTexture(r),null==t||null==t.glName)return null!=n&&(this.gl.bindTexture(n.descriptor.target,null),n.setBoundToUnit(r,!1)),void(this._textureUnitMap[r]=null);n&&n.id===t.id?t.applyChanges():(n&&n.setBoundToUnit(r,!1),this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(r,!0),t.applyChanges(),this._textureUnitMap[r]=t)},e.prototype.bindFramebuffer=function(e){if(n.isNone(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(var n=0;n<this.parameters.maxVertexAttributes;n++)e.disableVertexAttribArray(n);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var o=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(o)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var a=0;a<this.parameters.maxTextureImageUnits;a++){e.activeTexture(i.BASE_TEXTURE_UNIT+a),e.bindTexture(3553,null);var s=this._textureUnitMap[a];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(i.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),r("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,r,n){return t?n===t?n:(e.bindBuffer(r,t.glName),t):(e.bindBuffer(r,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(496)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var n=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return n?r.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(n.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return n.createQueryEXT()},resultAvailable:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return n.endQueryEXT(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1230)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformMat4=function(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[4],c=n[5],u=n[6],p=n[8],d=n[9],h=n[10],f=n[12],v=n[13],m=n[14],y=e.typedBuffer,g=e.typedBufferStride,_=t.typedBuffer,b=t.typedBufferStride,x=0;x<i;x++){var w=x*g,S=x*b,P=_[S],T=_[S+1],O=_[S+2];y[w]=o*P+l*T+p*O+f,y[w+1]=a*P+c*T+d*O+v,y[w+2]=s*P+u*T+h*O+m}else r.logger.error("source and destination buffers need to have the same number of elements")},t.transformMat3=function(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[3],c=n[4],u=n[5],p=n[6],d=n[7],h=n[8],f=e.typedBuffer,v=e.typedBufferStride,m=t.typedBuffer,y=t.typedBufferStride,g=0;g<i;g++){var _=g*v,b=g*y,x=m[b],w=m[b+1],S=m[b+2];f[_]=o*x+l*w+p*S,f[_+1]=a*x+c*w+d*S,f[_+2]=s*x+u*w+h*S}else r.logger.error("source and destination buffers need to have the same number of elements")},t.scale=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*o,u=l*s;i[c]=r*a[u],i[c+1]=r*a[u+1],i[c+2]=r*a[u+2]}},t.shiftRight=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*o,u=l*s;i[c]=a[u]>>r,i[c+1]=a[u+1]>>r,i[c+2]=a[u+2]>>r}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logger=r.getLogger("esri.views.3d.support.buffer.math")}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(160),r(223),r(256),r(949),r(655),r(345),r(497),r(447),r(537),r(653),r(541),r(253),r(257),r(260),r(228),r(249),r(1234),r(242),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:n.usePBR?n.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:n.hasMetalnessAndRoughnessTexture,hasEmissionTexture:n.hasEmissionTexture,hasOcclusionTexture:n.hasOcclusionTexture,hasNormalTexture:n.hasNormalTexture,hasColorTexture:n.hasColorTexture,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:n.normalsTypeDerivate?3:0,doubleSidedMode:n.doubleSidedMode,vertexTangets:n.vertexTangents,attributeTextureCoordinates:n.hasMetalnessAndRoughnessTexture||n.hasEmissionTexture||n.hasOcclusionTexture||n.hasNormalTexture||n.hasColorTexture?1:0,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:f.doublePrecisionRequiresObfuscation(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1});return new x(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),g.Default3D)},t.prototype.bindPass=function(e,t,r){var n=this.configuration.output;0===n?(this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",_.colorMixModes[t.colorMixMode]),this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.configuration.usePBR&&u.PhysicallyBasedRenderingParameters.bindUniforms(this.program,t,this.configuration.isSchematic)):1===n||3===n?this.program.setUniform2fv("nearFar",r.nearFar):4===n&&c.OutputHighlight.bindOutputHighlight(e,this.program,r),d.VisualVariables.bindUniformsForSymbols(this.program,t),l.VerticalOffset.bindUniforms(this.program,t,r),_.bindScreenSizePerspective(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==t.textureAlphaMode&&3!==t.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",t.textureAlphaCutoff)},t.prototype.bindDraw=function(e){var t=this.configuration.instancedDoublePrecision?i.vec3f64.fromValues(e.viewInvTransp[3],e.viewInvTransp[7],e.viewInvTransp[11]):e.origin;a.Transform.bindUniformsCustomOrigin(this.program,t,e.view),(0===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&h.Camera.bindUniformsCustomOrigin(this.program,t,e.viewInvTransp),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.viewInvTransp),this.configuration.instancedDoublePrecision&&s.InstancedDoublePrecision.bindCustomOrigin(this.program,t),o.Slice.bindUniforms(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&p.ReadShadowMap.bindViewCustomOrigin(this.program,e,t)},t.prototype.initializePipeline=function(){return null},t.shader=new v.ReloadableShaderModule(b,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1234)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(m.ShaderTechnique);t.DefaultMaterialTechnique=w;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.alphaDiscardMode=1,t.doubleSidedMode=0,t.isSchematic=!1,t.vertexColors=!1,t.offsetBackfaces=!1,t.symbolColors=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.receiveAmbientOcclusion=!1,t.screenSizePerspective=!1,t.textureAlphaPremultiplied=!1,t.hasColorTexture=!1,t.usePBR=!1,t.hasMetalnessAndRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.instanced=!1,t.instancedColor=!1,t.instancedDoublePrecision=!1,t.vertexTangents=!1,t.normalsTypeDerivate=!1,t}return n.__extends(t,e),n.__decorate([y.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([y.parameter({count:4})],t.prototype,"alphaDiscardMode",void 0),n.__decorate([y.parameter({count:3})],t.prototype,"doubleSidedMode",void 0),n.__decorate([y.parameter()],t.prototype,"isSchematic",void 0),n.__decorate([y.parameter()],t.prototype,"vertexColors",void 0),n.__decorate([y.parameter()],t.prototype,"offsetBackfaces",void 0),n.__decorate([y.parameter()],t.prototype,"symbolColors",void 0),n.__decorate([y.parameter()],t.prototype,"vvSize",void 0),n.__decorate([y.parameter()],t.prototype,"vvColor",void 0),n.__decorate([y.parameter()],t.prototype,"verticalOffset",void 0),n.__decorate([y.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([y.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([y.parameter()],t.prototype,"sliceHighlightDisabled",void 0),n.__decorate([y.parameter()],t.prototype,"receiveAmbientOcclusion",void 0),n.__decorate([y.parameter()],t.prototype,"screenSizePerspective",void 0),n.__decorate([y.parameter()],t.prototype,"textureAlphaPremultiplied",void 0),n.__decorate([y.parameter()],t.prototype,"hasColorTexture",void 0),n.__decorate([y.parameter()],t.prototype,"usePBR",void 0),n.__decorate([y.parameter()],t.prototype,"hasMetalnessAndRoughnessTexture",void 0),n.__decorate([y.parameter()],t.prototype,"hasEmissionTexture",void 0),n.__decorate([y.parameter()],t.prototype,"hasOcclusionTexture",void 0),n.__decorate([y.parameter()],t.prototype,"hasNormalTexture",void 0),n.__decorate([y.parameter()],t.prototype,"instanced",void 0),n.__decorate([y.parameter()],t.prototype,"instancedColor",void 0),n.__decorate([y.parameter()],t.prototype,"instancedDoublePrecision",void 0),n.__decorate([y.parameter()],t.prototype,"vertexTangents",void 0),n.__decorate([y.parameter()],t.prototype,"normalsTypeDerivate",void 0),t}(y.ShaderTechniqueConfiguration);t.DefaultMaterialTechniqueConfiguration=S}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(160),r(204),r(921),r(195)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.context=e,this._doublePrecisionRequiresObfuscation=null}return Object.defineProperty(e.prototype,"doublePrecisionRequiresObfuscation",{get:function(){if(r.isNone(this._doublePrecisionRequiresObfuscation)){var e=c(this.context,!1),t=c(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation},enumerable:!0,configurable:!0}),e}(),l=null;function c(e,t){var r=new i.FramebufferObject(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),s=i.BufferObject.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),l=new i.VertexArrayObject(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:s}),c=n.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),u=n.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),p=function(r,n){var a="\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",s=new i.Program(e,a,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",{a_pos:0}),l=new Float32Array(6);o.encodeDoubleArray(r,l,3);var c=new Float32Array(6);return o.encodeDoubleArray(n,c,3),e.bindProgram(s),s.setUniform3f("u_highA",l[0],l[2],l[4]),s.setUniform3f("u_lowA",l[1],l[3],l[5]),s.setUniform3f("u_highB",c[0],c[2],c[4]),s.setUniform3f("u_lowB",c[1],c[3],c[5]),s}(c,u),d=e.getBoundFramebufferObject(),h=e.getViewport(),f=h.x,v=h.y,m=h.width,y=h.height;e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(l),e.drawArrays(5,0,4);var g=new Uint8Array(4);r.readPixels(0,0,1,1,6408,5121,g),p.dispose(),l.dispose(!1),s.dispose(),r.dispose(),e.setViewport(f,v,m,y),e.bindFramebuffer(d);var _=(c[2]-u[2])/25,b=a.unpackFloatRGBA(g);return Math.abs(_-b)}t.testWebGLDriver=function(e){return(r.isNone(l)||l.context!==e)&&(l=new s(e)),l},t.clearTestWebGLDriver=function(e){r.isSome(l)&&l.context===e&&(l=null)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TextureAtlasLookup=function(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx = dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy = dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto = dFdx(uvAtlas);\n        vec2 dUVdyAuto = dFdy(uvAtlas);\n        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "],["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx = dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy = dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto = dFdx(uvAtlas);\n        vec2 dUVdyAuto = dFdy(uvAtlas);\n        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(654),r(1235),r(223),r(256),r(949),r(809),r(810),r(1236),r(658),r(594),r(659),r(655),r(1238),r(1239),r(812),r(660),r(1241),r(803),r(497),r(447),r(537),r(319),r(1242),r(951),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M){var A,E,I,R,D,L,j,V,F,N,k,z,U,B;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new M.ShaderBuilder,G=t.vertex.code,H=t.fragment.code;return t.include(T.HeaderComment,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(c.PositionAttribute),t.varyings.add("vpos","vec3"),t.include(S.VisualVariables,e),t.include(s.InstancedDoublePrecision,e),t.include(f.VerticalOffset,e),0===e.output&&(t.include(l.NormalAttribute,e),t.include(a.Transform,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(i.Offset),t.include(m.ComputeNormalTexture,e),t.include(h.VertexNormal,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(p.TextureCoordinateAttribute,e),t.include(n.ForwardLinearDepth,e),t.include(u.SymbolColor,e),t.include(d.VertexColor,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),G.add(C.glsl(E||(E=r.__makeTemplateObject(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",C.glsl.float(P.symbolAlphaCutoff),0===e.normalType?C.glsl(A||(A=r.__makeTemplateObject(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"],["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangets?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),t.include(o.Slice,e),t.include(g.EvaluateSceneLighting,e),t.include(y.EvaluateAmbientOcclusion,e),t.include(P.DiscardOrAdjustAlpha,e),e.receiveShadows&&t.include(w.ReadShadowMap,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(x.PhysicallyBasedRenderingParameters,e),t.include(b.PhysicallyBasedRendering,e),t.include(O.MixExternalColor,{stages:1}),t.include(_.Normals,e),H.add(C.glsl(B||(B=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),e.hasColorTexture?C.glsl(I||(I=r.__makeTemplateObject(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):C.glsl(R||(R=r.__makeTemplateObject(["vec4 texColor = vec4(1.0);"],["vec4 texColor = vec4(1.0);"]))),3===e.normalType?C.glsl(D||(D=r.__makeTemplateObject(["\n        vec3 normal = screenDerivativeNormal(localvpos);"],["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):C.glsl(L||(L=r.__makeTemplateObject(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"],["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":0===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?C.glsl(j||(j=r.__makeTemplateObject(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):C.glsl(V||(V=r.__makeTemplateObject(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?C.glsl(F||(F=r.__makeTemplateObject(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"],["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?0===e.viewingMode?C.glsl(N||(N=r.__makeTemplateObject(["vec3 normalGround = normalize(vpos + localOrigin);"],["vec3 normalGround = normalize(vpos + localOrigin);"]))):C.glsl(k||(k=r.__makeTemplateObject(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"],["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):C.glsl(z||(z=r.__makeTemplateObject([""],[""]))),1===e.pbrMode||2===e.pbrMode?C.glsl(U||(U=r.__makeTemplateObject(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"))),t.include(v.DefaultMaterialAuxiliaryPasses,e),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Offset=function(e){e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert = posWorld - camPosWorld;\n\n      bool isBackface = dot(camToVert, normalWorld) > 0.0;\n      if (isBackface) {\n        posClip.z += 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "],["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert = posWorld - camPosWorld;\n\n      bool isBackface = dot(camToVert, normalWorld) > 0.0;\n      if (isBackface) {\n        posClip.z += 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1237),r(175)],void 0===(i=function(e,t,r,n,i){var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolColor=function(e,t){t.symbolColor?(e.include(n.DecodeSymbolColor),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode = float(symbolColorMixMode) + 0.5;\n    }\n  "],["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode = float(symbolColorMixMode) + 0.5;\n    }\n  "])))):e.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "],["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeSymbolColor=function(e){e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "],["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),n.glsl.int(1),n.glsl.int(3),n.glsl.int(4),n.glsl.int(1)))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(809),r(658),r(659),r(811),r(345),r(537),r(319),r(175)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){var h,f,v,m,y,g,_,b,x,w,S,P;Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultMaterialAuxiliaryPasses=function(e,t){var T=e.vertex.code,O=e.fragment.code;1!==t.output&&3!==t.output||(e.include(i.Transform,{linearDepth:!0}),e.include(a.TextureCoordinateAttribute,t),e.include(u.VisualVariables,t),e.include(l.OutputDepth,t),e.include(n.Slice,t),e.vertex.uniforms.add("nearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),T.add(d.glsl(h||(h=r.__makeTemplateObject(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(p.DiscardOrAdjustAlpha,t),O.add(d.glsl(v||(v=r.__makeTemplateObject(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "],["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?d.glsl(f||(f=r.__makeTemplateObject(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(i.Transform,{linearDepth:!1}),e.include(o.NormalAttribute,t),e.include(s.VertexNormal,t),e.include(a.TextureCoordinateAttribute,t),e.include(u.VisualVariables,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),T.add(d.glsl(y||(y=r.__makeTemplateObject(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?d.glsl(m||(m=r.__makeTemplateObject(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"],["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(n.Slice,t),e.include(p.DiscardOrAdjustAlpha,t),O.add(d.glsl(x||(x=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?d.glsl(g||(g=r.__makeTemplateObject(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?d.glsl(_||(_=r.__makeTemplateObject(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"],["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):d.glsl(b||(b=r.__makeTemplateObject(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"],["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(i.Transform,{linearDepth:!1}),e.include(a.TextureCoordinateAttribute,t),e.include(u.VisualVariables,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),T.add(d.glsl(w||(w=r.__makeTemplateObject(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(n.Slice,t),e.include(p.DiscardOrAdjustAlpha,t),e.include(c.OutputHighlight),O.add(d.glsl(P||(P=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?d.glsl(S||(S=r.__makeTemplateObject(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(950),r(175)],void 0===(i=function(e,t,r,n,i){var o,a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ComputeNormalTexture=function(e,t){var c=e.fragment;c.uniforms.add("normalTexture","sampler2D"),c.uniforms.add("normalTextureSize","vec2"),t.vertexTangets?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?c.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):c.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(e.extensions.add("GL_OES_standard_derivatives"),c.code.add(i.glsl(s||(s=r.__makeTemplateObject(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 = dFdx(pos);\n      vec3 Q2 = dFdy(pos);\n\n      vec2 stx = dFdx(st);\n      vec2 sty = dFdy(st);\n\n      float det = stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent\n      T = T - normal * dot(normal, T); // orthogonalize tangent\n      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '],['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 = dFdx(pos);\n      vec3 Q2 = dFdy(pos);\n\n      vec2 stx = dFdx(st);\n      vec2 sty = dFdy(st);\n\n      float det = stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent\n      T = T - normal * dot(normal, T); // orthogonalize tangent\n      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  ']))))),0!==t.attributeTextureCoordinates&&(e.include(n.VertexTextureCoordinates,t),c.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "],["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluateMainLighting=function(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "],["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Normals=function(e,t){var l=e.fragment;l.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "],["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "])))),1===t.doubleSidedMode?l.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===t.doubleSidedMode?l.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):l.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(175)],void 0===(i=function(e,t,r,n,i){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderComment=function(e,t){var a=i.glsl(o||(o=r.__makeTemplateObject(["\n  /*\n  *  ","\n  *  ","\n  */\n  "],["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"");n("esri-validate-shaders")&&(e.fragment.code.add(a),e.vertex.code.add(a))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(654),r(1235),r(223),r(256),r(949),r(809),r(810),r(1236),r(658),r(594),r(655),r(1238),r(812),r(660),r(803),r(497),r(447),r(537),r(319),r(951),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){var T,O,C,M,A,E,I,R,D,L,j;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new P.ShaderBuilder,V=t.vertex.code,F=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(c.PositionAttribute),t.varyings.add("vpos","vec3"),t.include(b.VisualVariables,e),t.include(s.InstancedDoublePrecision,e),t.include(h.VerticalOffset,e),0===e.output&&(t.include(l.NormalAttribute,e),t.include(a.Transform,{linearDepth:!1}),e.offsetBackfaces&&t.include(i.Offset),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),t.include(p.TextureCoordinateAttribute,e),t.include(n.ForwardLinearDepth,e),t.include(u.SymbolColor,e),t.include(d.VertexColor,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),V.add(S.glsl(T||(T=r.__makeTemplateObject(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "],["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",S.glsl.float(x.symbolAlphaCutoff),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),t.include(o.Slice,e),t.include(m.EvaluateSceneLighting,e),t.include(v.EvaluateAmbientOcclusion,e),t.include(x.DiscardOrAdjustAlpha,e),e.receiveShadows&&t.include(_.ReadShadowMap,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(g.PhysicallyBasedRenderingParameters,e),t.include(y.PhysicallyBasedRendering,e),t.include(w.MixExternalColor,{stages:1}),F.add(S.glsl(j||(j=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),e.hasColorTexture?S.glsl(O||(O=r.__makeTemplateObject(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):S.glsl(C||(C=r.__makeTemplateObject(["vec4 texColor = vec4(1.0);"],["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":0===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?S.glsl(M||(M=r.__makeTemplateObject(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):S.glsl(A||(A=r.__makeTemplateObject(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),S.glsl(E||(E=r.__makeTemplateObject(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"],["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?0===e.viewingMode?S.glsl(I||(I=r.__makeTemplateObject(["vec3 normalGround = normalize(vpos + localOrigin);"],["vec3 normalGround = normalize(vpos + localOrigin);"]))):S.glsl(R||(R=r.__makeTemplateObject(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"],["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):S.glsl(D||(D=r.__makeTemplateObject([""],[""]))),1===e.pbrMode||2===e.pbrMode?S.glsl(L||(L=r.__makeTemplateObject(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"))),t.include(f.DefaultMaterialAuxiliaryPasses,e),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(239),r(226),r(177),r(154),r(164),r(118),r(152),r(153),r(171),r(172),r(185),r(216),r(160),r(201),r(193),r(246),r(813),r(627),r(357),r(408),r(542),r(495),r(277),r(346),r(814),r(418),r(419),r(262),r(807),r(1698),r(450),r(192),r(657),r(356),r(442),r(451),r(358),r(652)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V,F,N,k,z,U){Object.defineProperty(t,"__esModule",{value:!0});var B=f.mat4f64.create(),G=m.vec3f64.fromValues(0,0,1),H=[.25,.25,.75,.75],q=[64,64],W=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._cimLayers=null,o._cimSymbolMaterials=new Map,o._cimSymbolTextures=new Map,o._cimMaterialParametersInfo=null,o._cimRequiredFields=null,o._cimScaleFactorOrFunction=null,o._size=null,o._symbolTextureRatio=1,o._outlineSize=0,o._texture=null,o._releaseTexture=null,o._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},o}return r.__extends(t,e),t.prototype.getCachedSize=function(){return{size:this._getIconSize()}},t.prototype.doLoad=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return this._validateOrThrow(),t=this._prepareMaterialParameters(),n=this._getPrimitive(),u.isSome(n)?(this._prepareResourcesPrimitive(t,n),[3,5]):[3,1];case 1:return i=w.getIconHref(this.symbol,this.symbolLayer),(o=h.dataComponents(i))&&"application/json"===o.mediaType?[4,this._prepareResourcesCIM(t,JSON.parse(o.data),e)]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(t,i,e)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},t.prototype._validateOrThrow=function(){if(!this._drivenProperties.size){var e=I.validateSymbolLayerSize(this._getIconSize());if(e)throw new s("graphics3diconsymbollayer:invalid-size",e)}},t.prototype._getIconSize=function(){var e=this.symbolLayer,t=Math.round(null!=e.size?d.pt2px(e.size):16);return this._drivenProperties.size?Math.max(t,64):t},t.prototype._generateTextureCIM=function(e){var t=this._getGraphicHash(e),r=""===t?null:this._cimSymbolTextures.get(t);if(!r){var n={scaleFactor:this._cimScaleFactorOrFunction},i=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",n,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",i.anchorPosition);var o={width:i.imageData.width,height:i.imageData.height,powerOfTwoResizeMode:2};r=new z(i.imageData,"symbol",o),this._cimSymbolTextures.set(t,r),this._context.stage.add(4,r)}return r},t.prototype._computeSize=function(e,t){var r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]},t.prototype._prepareMaterialParameters=function(){var e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){var r=t.verticalOffset,n=r.screenLength,i=r.minWorldLength,o=r.maxWorldLength;e.verticalOffset={screenLength:d.pt2px(n),minWorldLength:i||0,maxWorldLength:null!=o?o:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e},t.prototype._prepareResourcesPrimitive=function(e,t){var r=this,n=this._getOutlineSize();if(J(t)&&0===n)throw new Error("Nothing to render");this._outlineSize=n,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;var i=this._context.sharedResources.textures.fromData(t,(function(){return function(e){var t;switch(e){case"circle":t=D.createCircle(128,64);break;case"square":t=D.createSquare(128,64);break;case"kite":t=D.createKite(128,64);break;case"cross":t=D.createCross(128,64);break;case"x":t=D.createX(128,64);break;case"triangle":t=D.createTriangle(128,64);break;default:a.neverReached(e)}return new z(t,"sdf_"+e,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})}(t)}));this._texture=i.texture,this._releaseTexture=function(){return r._context.sharedResources.textures.release(i.uid)},e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=H,e.textureId=this._texture.id;var o=this._getIconSize();this._size=[o,o],this._symbolTextureRatio=2,this._createMaterialAndAddToStage(e,this._context.stage)},t.prototype._prepareResourcesHref=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i,a,c,u,d,f,v,m=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!l("esri-canvas-svg-support")&&h.isSVG(t))throw new s("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");return this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1,i=this._getIconSize(),a=i*this._context.layerView.view.pixelRatio,[4,o.result(this._context.sharedResources.textures.fromUrl(t,a,{signal:n}))];case 1:if(!1===(c=r.sent()).ok)throw p.throwIfAbortError(c.error),new s("graphics3diconsymbollayer:request-failed","Failed to load (Request for icon resource failed: "+t+")");return u=c.value,d=u.uid,f=u.texture,this._releaseTexture=function(){return m._context.sharedResources.textures.release(d)},v=f.params,this._size=this._computeSize(v,i),e.textureId=f.id,this._createMaterialAndAddToStage(e,this._context.stage),[2]}}))}))},t.prototype._prepareResourcesCIM=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,c,u,d,h,f,v,m;return r.__generator(this,(function(r){switch(r.label){case 0:return o=new i.CIMSymbol({data:t}),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new b.CIMSymbolRasterizer(this._context.renderCoordsHelper.spatialReference,!0)),a=this._context.layer.fields?this._context.layer.fields.map((function(e){return e.toJSON()})):null,s=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(o,a,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:n})];case 1:return s._cimLayers=r.sent(),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression?(u=this._context.renderer,isNaN(u.scaleExpression)?(d=u.scaleExpression,[4,_.createRendererExpression(d,this._context.layer.spatialReference,a)]):[3,3]):[3,4];case 2:return h=r.sent(),c=function(e,t,r){var n=S.callWithFeature(h,e,{$view:r},"esriGeometryPoint",t);return null!==n?n:1},[3,4];case 3:l=Number(u.scaleExpression),r.label=4;case 4:return this._cimScaleFactorOrFunction=l||c||1,this._context.renderer?[3,5]:(v=[],[3,7]);case 5:return[4,this._context.renderer.getRequiredFields(this._context.layer.fields)];case 6:v=r.sent(),r.label=7;case 7:return f=v,p.throwIfAborted(n),m=this._context.layer.fieldsIndex,this._cimRequiredFields=f.map((function(e){return m.get(e).name})),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}}))}))},t.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||x.defaultPrimitive},t.prototype._getOutlineSize=function(){var e,t=this.symbolLayer;return u.isSome(t.outline)&&null!=t.outline.size?Math.max(d.pt2px(t.outline.size),0):(e=J(this._getPrimitive())?1.5:0,Math.max(e,0))},t.prototype._getOutlineColor=function(){var e=this._getLayerOpacity(),t=this.symbolLayer,r=u.get(t,"outline","color");if(u.isSome(r)){var i=n.toUnitRGB(r),o=r.a*e;return[i[0],i[1],i[2],o]}return[0,0,0,0]},t.prototype._getFillColor=function(){if(J(this._getPrimitive()))return P.TRANSPARENT_UNIT;var e=u.isNone(this._getPrimitive()),t=u.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})},t.prototype._getAnchorPos=function(e,t){return"relative"===e?v.vec2f64.fromValues((t.x||0)+.5,.5-(t.y||0)):e in I.namedAnchorToHUDMaterialAnchorPos?I.namedAnchorToHUDMaterialAnchorPos[e]:I.namedAnchorToHUDMaterialAnchorPos.center},t.prototype._createMaterialAndAddToStage=function(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=L.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&c.mixin(e,this._fastUpdates.materialParameters),this._cimLayers){var r=this._cimSymbolMaterials.get(e.textureId);return r||(r=new U.default(e,this._getIdHint("_icon")),this._cimSymbolMaterials.set(e.textureId,r),t.add(3,r)),r}return this._material=new U.default(e,this._getIdHint("_icon")),t.add(3,this._material),this._material},t.prototype._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial((function(e){e.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0})})),this.layerOpacityChanged())},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._forEachMaterial((function(e){t._context.stage.remove(3,e.id)})),u.isSome(this._material)&&(this._material=null),this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((function(e){t._context.stage.remove(4,e.id)})),this._cimSymbolTextures.clear(),this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)},t.prototype._getScaleFactor=function(e,t){if(this._drivenProperties.size&&e.size){for(var r=0;r<3;r++){var n=e.size[r];n&&"symbol-value"!==n&&"proportional"!==n&&(e.size[r]=d.pt2px(n))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1},t.prototype.createGraphics3DGraphic=function(e){var t,n,i=e.renderingInfo,o=e.graphic;if(this._cimLayers){if(!this._cimLayers.length)return null;var a=this._generateTextureCIM(o),s=r.__assign({textureId:a.id},this._cimMaterialParametersInfo);n=this._createMaterialAndAddToStage(s,this._context.stage),t=[a.params.width,a.params.height]}else t=this._size,n=u.unwrap(this._material);if(!this._validateGeometry(o.geometry))return null;var l=R.placePointOnGeometry(o.geometry);if(u.isNone(l))return this.logger.warn("unsupported geometry type for icon symbol: "+o.geometry.type),null;var c="graphic"+o.uid,p=this._getVertexOpacityAndColor(i),d=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){var h=t[0]>t[1]?t[0]:t[1];d=this._getScaleFactor(i,h)}d*=this._symbolTextureRatio;var f=[t[0]*d,t[1]*d],v=this.setGraphicElevationContext(o,new C.ElevationContext);return this.ensureDrapedStatus("on-the-ground"===v.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(o,l,n,p,f,e.layer.uid):this._createAs3DShape(o,l,n,p,f,v,c,o.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial((function(r){r.setParameterValues({color:e}),r.setParameterValues({outlineColor:t})})),!0},t.prototype.layerElevationInfoChanged=function(e,r,n){var i=this._elevationContext.mode,o=O.elevationModeChangeUpdateType(t.elevationModeChangeTypes,n,i);if(o!==O.SymbolUpdateType.UPDATE)return o;var a=O.needsElevationUpdates2D(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,r,(function(){return a}))},t.prototype.slicePlaneEnabledChanged=function(){var e=this;return this.draped||this._forEachMaterial((function(t){t.setParameterValues({slicePlaneEnabled:e._context.slicePlaneEnabled})})),!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!!this._getPrimitive()},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!L.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;u.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype._defaultElevationInfoNoZ=function(){return Z},t.prototype._createAs3DShape=function(e,t,r,n,i,o,a,s){var l=this,c=this.getFastUpdateAttrValues(e),u=c?function(e){return L.evaluateModelTransform(l._fastUpdates.materialParameters,c,e)}:null,p=N.createPointGeometry(G,null,n,i,X,null,c),d=[new F(p,a)],h=R.createStageObjectForHUD(this._context,t,d,[r],null,null,o,a,this._context.layer.uid,s,u);if(null===h)return null;var f=T.perObjectElevationAligner,v=new A(this,h.object,d,null,null,f,o);return v.alignedSampledElevation=h.sampledElevation,v.needsElevationUpdates=O.needsElevationUpdates2D(o.mode)||"absolute-height"===o.mode,v.getScreenSize=this._createScreenSizeGetter(i,u),v.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(v.getScreenSize(),1,e)},R.extendPointGraphicElevationContext(v,t,this._context.elevationProvider),v},t.prototype._createAsOverlay=function(e,t,r,n,i,o){var a=this;r.renderPriority=this._renderPriority;var s=m.vec3f64.create();j.pointToVector(t,s,this._context.overlaySR),s[2]=V.DRAPED_Z;var l=this._context.clippingExtent;if(u.isSome(l)&&!g.containsPoint(l,s))return null;var c=this.getFastUpdateAttrValues(e),p=c?function(e){return L.evaluateModelTransform(a._fastUpdates.materialParameters,c,e)}:null,d=N.createPointGeometry(G,s,n,i,null,null,c),h=new k(d);h.material=r,h.center=s,h.bsRadius=0,h.data.layerUid=o,h.data.graphicUid=e.uid,h.calculateShaderTransformation=p;var f=new M(this,[h],null);return f.getScreenSize=this._createScreenSizeGetter(i,p),f.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(f.getScreenSize(),1,e)},f},t.prototype._createScreenSizeGetter=function(e,t){var r=this._outlineSize+2;if(this._fastUpdates.enabled){var n=e[0]/this._symbolTextureRatio,i=e[1]/this._symbolTextureRatio;return function(e){void 0===e&&(e=v.vec2f64.create());var o=t(B);return e[0]=o[0]*n+r,e[1]=o[5]*i+r,e}}var o=e[0]/this._symbolTextureRatio+r,a=e[1]/this._symbolTextureRatio+r;return function(e){return void 0===e&&(e=v.vec2f64.create()),e[0]=o,e[1]=a,e}},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=m.vec3f64.fromValues(e,e,e),r=d.px2pt(1),n=e*r;return{modelSize:t,symbolSize:m.vec3f64.fromValues(n,n,n),unitInMeters:r,transformation:{anchor:m.vec3f64.ZEROS,scale:m.vec3f64.ONES,rotation:m.vec3f64.ZEROS}}},t.prototype._getGraphicHash=function(e){for(var t="",r=0,n=this._cimRequiredFields;r<n.length;r++){var i=n[r];t+=i+e.attributes[i]}return t},t.prototype._forEachMaterial=function(e){u.isSome(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)},t.PRIMITIVE_SIZE=q,t.elevationModeChangeTypes={definedChanged:O.SymbolUpdateType.UPDATE,staysOnTheGround:O.SymbolUpdateType.NONE,onTheGroundChanged:O.SymbolUpdateType.RECREATE},t}(E.default);function J(e){return!!u.isSome(e)&&("cross"===e||"x"===e)}t.Graphics3DIconSymbolLayer=W;var Z={mode:"relative-to-ground",offset:0},X=y.vec4f64.fromValues(0,0,0,1);t.default=W}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(870),r(625),r(1116),r(626)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.prototype.dispose=function(){this._rasterizationCanvas=null},e.prototype.rasterizeJSONResource=function(e,t){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){var o=r.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,e.style),a=o[0];return{size:[o[1],o[2]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){var s=r.SymbolHelper.rasterizeSimpleLine(e.style,e.cap),l=s[0];return{size:[s[1],s[2]],image:new Uint32Array(l.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}var c,u,p;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(c=r.CIMSymbolHelper.fromSimpleMarker(e),p=i.getSDFInfo(c)):"CIMHatchFill"===e.type?(c=r.CIMSymbolHelper.fromCIMHatchFill(e),u=new n.default(c.frame.xmin,-c.frame.ymax,c.frame.xmax-c.frame.xmin,c.frame.ymax-c.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(c=r.CIMSymbolHelper.fromCIMInsidePolygon(e),u=new n.default(c.frame.xmin,-c.frame.ymax,c.frame.xmax-c.frame.xmin,c.frame.ymax-c.frame.ymin)):(c=e,p=i.getSDFInfo(c)),p&&!t){var d=i.buildSDF(p),h=d[0],f=d[1],v=d[2];return h?{size:[f,v],image:new Uint32Array(h.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var m=r.CIMSymbolHelper.rasterize(this._rasterizationCanvas,c,u,!t),y=m[0],g=m[1],_=m[2],b=m[3],x=m[4];return y?{size:[g,_],image:new Uint32Array(y.buffer),sdf:!1,simplePattern:!1,anchorX:b,anchorY:x}:null},e.prototype.rasterizeImageResource=function(e,t){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e.width,this._rasterizationCanvas.height=e.height;var r=this._rasterizationCanvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):(e.setAttribute("width",e.width.toString()),e.setAttribute("height",e.height.toString()),r.drawImage(e,0,0,e.width,e.height));var n,i=r.getImageData(0,0,e.width,e.height),a=new Uint8Array(i.data);if(t)for(var s=0,l=t;s<l.length;s++){var c=l[s];if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&4===c.newColor.length){var u=c.oldColor,p=u[0],d=u[1],h=u[2],f=u[3],v=c.newColor,m=v[0],y=v[1],g=v[2],_=v[3];if(p===m&&d===y&&h===g&&f===_)continue;for(var b=0;b<a.length;b+=4)p===a[b]&&d===a[b+1]&&h===a[b+2]&&f===a[b+3]&&(a[b]=m,a[b+1]=y,a[b+2]=g,a[b+3]=_)}}for(b=0;b<a.length;b+=4)n=a[b+3]/255,a[b]=a[b]*n,a[b+1]=a[b+1]*n,a[b+2]=a[b+2]*n;var x=e.width,w=e.height,S=a;if(x>=512||w>=512){var P=e.width/e.height;P>1?(x=512,w=Math.round(512/P)):(w=512,x=Math.round(512*P)),S=new Uint8Array(4*x*w),o.resampleHermite(a,e.width,e.height,new Uint8ClampedArray(S.buffer),x,w,!1)}return{size:[x,w],image:new Uint32Array(S.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}},e}();t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(120),r(162),r(160),r(1213),r(542),r(277),r(192),r(657),r(326),r(945)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){function f(e,t,r){for(var n=new Array,i=0,o=e;i<o.length;i++){var a=o[i],s=a.index,l=a.count;if(!(l<=1)){var c=3*s,u=c+3*l;n.push({position:t.subarray(c,u),mapPosition:r?r.subarray(c,u):void 0})}}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.createGeometryData=function(e){var t={},a={};!function(e,t,r){for(var n=e.attributeData.position,o=e.removeDuplicateStartEnd,a=(void 0,f=(d=n).length,d[0]===d[f-3]&&d[1]===d[f-2]&&d[2]===d[f-1]&&1===o),s=n.length/3-(a?1:0),l=new Uint32Array(2*(s-1)),c=a?i.slice(n,0,n.length-3):n,u=0,p=0;p<s-1;p++)l[u++]=p,l[u++]=p+1;var d,f;t[h.RibbonVertexAttributeConstants.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3},r[h.RibbonVertexAttributeConstants.POSITION]=l}(e,a,t);var s=new Uint32Array(t[h.RibbonVertexAttributeConstants.POSITION].length);return function(e,t,r){var i=e.attributeData.mapPosition;n.isNone(i)||(r.mapPos=r[h.RibbonVertexAttributeConstants.POSITION],t.mapPos={size:3,data:i,offsetIdx:0,strideIdx:3})}(e,a,t),function(e,t,r,i){if(!n.isSome(e.attributeData.colorFeature)){var o=e.attributeData.color;t[h.RibbonVertexAttributeConstants.COLOR]={size:4,data:n.unwrapOr(o,l.WHITE_UNIT),offsetIdx:0,strideIdx:4},r[h.RibbonVertexAttributeConstants.COLOR]=i}}(e,a,t,s),function(e,t,r,i){if(!n.isSome(e.attributeData.sizeFeature)){var o=e.attributeData.size;t[h.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([n.unwrapOr(o,1)]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.SIZE]=i}}(e,a,t,s),function(e,t,r,i){var o=e.attributeData.colorFeature;n.isNone(o)||(t[h.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.COLOR]=i)}(e,a,t,s),function(e,t,r,i){var o=e.attributeData.sizeFeature;n.isNone(o)||(t[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=i)}(e,a,t,s),function(e,t,r,i){var o=e.attributeData.opacityFeature;n.isNone(o)||(t[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([o]),offsetIdx:0,strideIdx:1},r[h.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=i)}(e,a,t,s),function(e,t,i){if("round"===e.join){var a,s=t[h.RibbonVertexAttributeConstants.POSITION].data,l=s.length/3,c=new Float32Array(l),u=v,p=m;o.vec3.set(u,0,0,0);for(var d=n.unwrapOr(e.uniformSize,1),f=-1;f<l;++f){var g=f<0?l+f:f,_=(f+1)%l;if(o.vec3.set(p,s[3*_+0]-s[3*g+0],s[3*_+1]-s[3*g+1],s[3*_+2]-s[3*g+2]),o.vec3.normalize(p,p),f>=0){var b=(Math.PI-r.acosClamped(o.vec3.dot(u,p)))*y*1*(a=d,1.863798+-2.0062872/Math.pow(1+a/18.2313,.8856294));c[f]=Math.max(Math.floor(b),0)}o.vec3.scale(u,p,-1)}t[h.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:c,offsetIdx:0,strideIdx:1},i[h.RibbonVertexAttributeConstants.SUBDIVISIONS]=i[h.RibbonVertexAttributeConstants.POSITION]}}(e,a,t),new d.GeometryData(a,t,"line")},t.geometryToRenderInfo=function(e,t,r,n){var i="polygon"===e.type?1:0,o="polygon"===e.type?e.rings:e.paths,a=s.pathsToTriangulationInfo(o,e.hasZ,i),l=a.position,u=a.outlines,p=new Float64Array(l.length),d=c.applyPerVertexElevationAlignment(l,e.spatialReference,0,p,0,l,0,l.length/3,t,r,n),h=null!=d;return{lines:h?f(u,l,p):[],projectionSuccess:h,sampledElevation:d}},t.geometryToRenderInfoDraped=function(e,t){for(var r="polygon"===e.type?1:0,n="polygon"===e.type?e.rings:e.paths,i=s.pathsToTriangulationInfo(n,!1,r),o=i.position,a=i.outlines,l=u.bufferToBuffer(o,e.spatialReference,0,o,t,0,o.length/3),c=2;c<o.length;c+=3)o[c]=p.DRAPED_Z;return{lines:l?f(a,o):[],projectionSuccess:l}};var v=a.vec3f64.create(),m=a.vec3f64.create(),y=4/Math.PI}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(152),r(151),r(1248)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.colorTexture=null,r.normalTexture=null,r.alphaMode="auto",r.alphaCutoff=.5,r.doubleSided=!0,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)},t.prototype.cloneWithDeduplication=function(e,t){var r=a.isSome(e)?e.get(this):null;if(r)return r;var n=new i(this.clonePropertiesWithDeduplication(t));return a.isSome(e)&&e.set(this,n),n},t.prototype.clonePropertiesWithDeduplication=function(e){return{color:o.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}},r.__decorate([s.property({type:n,json:{write:!0}})],t.prototype,"color",void 0),r.__decorate([s.property({type:l,json:{write:!0}})],t.prototype,"colorTexture",void 0),r.__decorate([s.property({type:l,json:{write:!0}})],t.prototype,"normalTexture",void 0),r.__decorate([s.property({json:{write:!0}})],t.prototype,"alphaMode",void 0),r.__decorate([s.property({json:{write:!0}})],t.prototype,"alphaCutoff",void 0),r.__decorate([s.property({json:{write:!0}})],t.prototype,"doubleSided",void 0),i=r.__decorate([s.subclass("esri.geometry.support.MeshMaterial")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(761),r(177),r(155),r(151),r(179),r(351),r(643)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=new n.default,p=0;return function(e){function t(t){var r=e.call(this,t)||this;return r.wrap="repeat",r}var n;return r.__extends(t,e),n=t,Object.defineProperty(t.prototype,"url",{get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)},enumerable:!0,configurable:!0}),t.prototype.writeData=function(e,t,r,n){if(e instanceof HTMLImageElement){var i={type:"image-element",src:l.toJSON(e.src,n),crossOrigin:e.crossOrigin};t[r]=i}else if(e instanceof HTMLCanvasElement){var o=e.getContext("2d").getImageData(0,0,e.width,e.height);i={type:"canvas-element",imageData:this.encodeImageData(o)},t[r]=i}else e instanceof HTMLVideoElement?(i={type:"video-element",src:l.toJSON(e.src,n),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload},t[r]=i):(i={type:"image-data",imageData:this.encodeImageData(e)},t[r]=i)},t.prototype.readData=function(e){switch(e.type){case"image-element":var t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t;case"canvas-element":var r=this.decodeImageData(e.imageData),n=document.createElement("canvas");return n.width=r.width,n.height=r.height,n.getContext("2d").putImageData(r,0,0),n;case"image-data":return this.decodeImageData(e.imageData);case"video-element":var o=document.createElement("video");return o.src=e.src,o.crossOrigin=e.crossOrigin,o.autoplay=e.autoplay,o.loop=e.loop,o.muted=e.muted,o.preload=e.preload,o;default:return void i.neverReached(e)}},Object.defineProperty(t.prototype,"transparent",{get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===n)return!0}return!1},set:function(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentHash",{get:function(){var e=this,t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",r=function(r){return void 0===r&&(r=""),"d:"+r+",t:"+e.transparent+",w:"+t};return null!=this.url?r(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(u.has(this.data)||u.set(this.data,++p),r(u.get(this.data))):r()},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({url:this.url,data:this.data,wrap:this.cloneWrap()})},t.prototype.cloneWithDeduplication=function(e){var t=e.get(this);if(t)return t;var r=new n({url:this.url,data:this.data,wrap:this.cloneWrap()});return e.set(this,r),r},t.prototype.cloneWrap=function(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}},t.prototype.encodeImageData=function(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}},t.prototype.decodeImageData=function(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return c.wrapImageData(r,e.width,e.height)},t.prototype.imageDataContainsTransparent=function(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1},t.from=function(e){return"string"==typeof e?new n({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new n({data:e}):s.ensureClass(n,e)},r.__decorate([a.property({type:String,json:{write:l.write}})],t.prototype,"url",null),r.__decorate([a.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),a.property()],t.prototype,"data",null),r.__decorate([a.writer("data")],t.prototype,"writeData",null),r.__decorate([a.reader("data")],t.prototype,"readData",null),r.__decorate([a.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],t.prototype,"transparent",null),r.__decorate([a.property({json:{write:!0}})],t.prototype,"wrap",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],t.prototype,"contentHash",null),n=r.__decorate([a.subclass("esri.geometry.support.MeshTexture")],t)}(o.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(152),r(151),r(1247),r(1248)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.emissiveColor=null,r.emissiveTexture=null,r.occlusionTexture=null,r.metallic=1,r.roughness=1,r.metallicRoughnessTexture=null,r}var a;return r.__extends(t,e),a=t,t.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)},t.prototype.cloneWithDeduplication=function(e,t){var r=i.isSome(e)?e.get(this):null;if(r)return r;var n=new a(this.clonePropertiesWithDeduplication(t));return i.isSome(e)&&e.set(this,n),n},t.prototype.clonePropertiesWithDeduplication=function(t){return r.__assign(r.__assign({},e.prototype.clonePropertiesWithDeduplication.call(this,t)),{emissiveColor:this.emissiveColor?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:this.occlusionTexture?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(t):null})},r.__decorate([o.property({type:n,json:{write:!0}})],t.prototype,"emissiveColor",void 0),r.__decorate([o.property({type:s,json:{write:!0}})],t.prototype,"emissiveTexture",void 0),r.__decorate([o.property({type:s,json:{write:!0}})],t.prototype,"occlusionTexture",void 0),r.__decorate([o.property({type:Number,json:{write:!0},range:{min:0,max:1}})],t.prototype,"metallic",void 0),r.__decorate([o.property({type:Number,json:{write:!0},range:{min:0,max:1}})],t.prototype,"roughness",void 0),r.__decorate([o.property({type:s,json:{write:!0}})],t.prototype,"metallicRoughnessTexture",void 0),a=r.__decorate([o.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(152),r(171),r(205),r(162),r(160),r(203),r(340),r(443),r(535),r(344),r(195),r(592),r(543),r(249),r(372),r(446),r(1705)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){var x=n.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),w=function(e){function t(t,r){var n=e.call(this,r)||this;return n.techniqueConfig=new b.NativeLineTechniqueConfiguration,n.params=y.copyParameters(t,T),n}return r.__extends(t,e),t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)t[r]=e[r];this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;var t=i.isSome(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&i.isSome(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,n,i,o,a,s,l){l?y.intersectDrapedRenderLineGeometry(e,n,o,1,a):this.intersectLineGeometry(e,t,r,n,a)},t.prototype.intersectLineGeometry=function(e,t,r,n,i){if(n.options.selectionMode&&!_.isInstanceHidden(t))if(f.isTranslationMatrix(r)){var o=e.data.getVertexAttr().position.data,l=n.camera,u=V;a.vec2.copy(u,n.point),s.vec3.set(F[0],u[0]-2,u[1]+2,0),s.vec3.set(F[1],u[0]+2,u[1]+2,0),s.vec3.set(F[2],u[0]+2,u[1]-2,0),s.vec3.set(F[3],u[0]-2,u[1]-2,0);for(var p=0;p<4;p++)l.unprojectPoint(F[p],N[p]);c.plane.fromPoints(l.eye,N[0],N[1],k),c.plane.fromPoints(l.eye,N[1],N[2],z),c.plane.fromPoints(l.eye,N[2],N[3],U),c.plane.fromPoints(l.eye,N[3],N[0],B);var d=Number.MAX_VALUE;for(p=0;p<o.length-5;p+=3)if(O[0]=o[p]+r[12],O[1]=o[p+1]+r[13],O[2]=o[p+2]+r[14],C[0]=o[p+3]+r[12],C[1]=o[p+4]+r[13],C[2]=o[p+5]+r[14],!(c.plane.signedDistance(k,O)<0&&c.plane.signedDistance(k,C)<0||c.plane.signedDistance(z,O)<0&&c.plane.signedDistance(z,C)<0||c.plane.signedDistance(U,O)<0&&c.plane.signedDistance(U,C)<0||c.plane.signedDistance(B,O)<0&&c.plane.signedDistance(B,C)<0)){if(l.projectPoint(O,E),l.projectPoint(C,I),E[2]<0&&I[2]>0){s.vec3.subtract(M,O,C);var h=l.frustum,v=-c.plane.signedDistance(h.planes[4],O)/s.vec3.dot(M,c.plane.normal(h.planes[4]));s.vec3.scale(M,M,v),s.vec3.add(O,O,M),l.projectPoint(O,E)}else if(E[2]>0&&I[2]<0)s.vec3.subtract(M,C,O),h=l.frustum,v=-c.plane.signedDistance(h.planes[4],C)/s.vec3.dot(M,c.plane.normal(h.planes[4])),s.vec3.scale(M,M,v),s.vec3.add(C,C,M),l.projectPoint(C,I);else if(E[2]<0&&I[2]<0)continue;E[2]=0,I[2]=0;var m=c.lineSegment.distance2(c.lineSegment.fromPoints(E,I,L),u);m<d&&(d=m,s.vec3.copy(R,O),s.vec3.copy(D,C))}var y=n.rayBeginPoint,g=n.rayEndPoint;if(d<4){var b=Number.MAX_VALUE;if(c.lineSegment.closestLineSegmentPoint(c.lineSegment.fromPoints(R,D,L),c.lineSegment.fromPoints(y,g,j),A)){s.vec3.subtract(A,A,y);var w=s.vec3.length(A);s.vec3.scale(A,A,1/w),b=w/s.vec3.distance(y,g)}i(b,A)}}else x.error("intersection assumes a translation-only matrix")},t.prototype.computeAttachmentOrigin=function(e,t){var r=e.data,n="getVertexAttr"in r?r.getVertexAttr():"vertexAttr"in r?r.vertexAttr:null;if(!n)return null;var i=n[f.VertexAttrConstants.POSITION];return p.computeAttachmentOriginLines(i,null,!1,t)},t.prototype.createBufferWriter=function(){var e=this.params.vertexColors?m.PositionColorLayout:m.PositionLayout;return i.isNone(this.params.stipplePattern)?new m.DefaultBufferWriter(e):new P(e.clone().vec3f(f.VertexAttrConstants.AUXPOS1))},t.prototype.createRenderer=function(e,t){return new g(e,t,this)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new S(e):void 0},t}(h.Material),S=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(b.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 3===e},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(d.GLMaterial),P=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[f.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){v.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n),this.writeAuxpos1(e,t,r,n)},e.prototype.writeAuxpos1=function(e,t,r,n){var i=r.getField(f.VertexAttrConstants.AUXPOS1,u.BufferViewVec3f),o=t.indices[f.VertexAttrConstants.POSITION],a=t.vertexAttr[f.VertexAttrConstants.POSITION].data,s=e.transformation,l=i.typedBufferStride,c=i.typedBuffer;n*=l;for(var p=0;p<o.length;p+=2)for(var d=3*o[p],h=a[d],v=a[d+1],m=a[d+2],y=s[0]*h+s[4]*v+s[8]*m+s[12],g=s[1]*h+s[5]*v+s[9]*m+s[13],_=s[2]*h+s[6]*v+s[10]*m+s[14],b=0;b<2;++b)c[n]=y,c[n+1]=g,c[n+2]=_,n+=l},e}(),T={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},O=l.vec3f64.create(),C=l.vec3f64.create(),M=l.vec3f64.create(),A=l.vec3f64.create(),E=o.createRenderScreenPointArray3(),I=o.createRenderScreenPointArray3(),R=l.vec3f64.create(),D=l.vec3f64.create(),L=c.lineSegment.create(),j=c.lineSegment.create(),V=l.vec3f64.create(),F=[o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3(),o.createRenderScreenPointArray3()],N=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create()],k=c.plane.create(),z=c.plane.create(),U=c.plane.create(),B=c.plane.create();return w}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(594),r(345),r(1221),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u,p,d,h,f;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new c.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.include(o.VertexColor,e),t.include(s.LineStipple,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l.glsl(u||(u=r.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "],["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(l.glsl(p||(p=r.__makeTemplateObject(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "],["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(l.glsl(d||(d=r.__makeTemplateObject(["\n  }\n  "],["\n  }\n  "])))),0===e.output&&(t.include(n.Slice,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(l.glsl(h||(h=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color = ",";\n\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor = highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color = ",";\n\n      float stippleAlpha = getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor = highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "])),e.attributeColor?"vColor":"constantColor"))),4===e.output&&(t.include(n.Slice,e),t.include(a.OutputHighlight),t.fragment.code.add(l.glsl(f||(f=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1137),r(152),r(272),r(276),r(189),r(185),r(162),r(160),r(193),r(1253),r(1254),r(1721),r(1256),r(340),r(1722),r(952),r(356),r(326),r(358),r(540)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w){function S(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function P(e,t,n,s){var l=e.model,c=a.mat3f64.create(),u=new Array,d=new Map,h=new Map;return l.lods.forEach((function(e,a){if(void 0===s||a===s){var v=0,S={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:i.isSome(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:p.empty()};u.push(S),e.parts.forEach((function(a){var s=a.material+(a.attributes.normal?"_normal":"")+(a.attributes.color?"_color":"")+(a.attributes.texCoord0?"_texCoord0":"")+(a.attributes.tangent?"_tangent":""),u=l.materials.get(a.material),P=i.isSome(a.attributes.texCoord0),O=i.isSome(a.attributes.normal);if(!d.has(s)){if(P){if(i.isSome(u.textureColor)&&!h.has(u.textureColor)){var C=l.textures.get(u.textureColor),M=r.__assign(r.__assign({},C.parameters),{preMultiplyAlpha:!0});h.set(u.textureColor,new x(C.data,u.textureColor,M))}i.isSome(u.textureNormal)&&!h.has(u.textureNormal)&&(C=l.textures.get(u.textureNormal),M=r.__assign(r.__assign({},C.parameters),{preMultiplyAlpha:!0}),h.set(u.textureNormal,new x(C.data,u.textureNormal,M))),i.isSome(u.textureOcclusion)&&!h.has(u.textureOcclusion)&&(C=l.textures.get(u.textureOcclusion),M=r.__assign(r.__assign({},C.parameters),{preMultiplyAlpha:!0}),h.set(u.textureOcclusion,new x(C.data,u.textureOcclusion,M))),i.isSome(u.textureEmissive)&&!h.has(u.textureEmissive)&&(C=l.textures.get(u.textureEmissive),M=r.__assign(r.__assign({},C.parameters),{preMultiplyAlpha:!0}),h.set(u.textureEmissive,new x(C.data,u.textureEmissive,M))),i.isSome(u.textureMetallicRoughness)&&!h.has(u.textureMetallicRoughness)&&(C=l.textures.get(u.textureMetallicRoughness),M=r.__assign(r.__assign({},C.parameters),{preMultiplyAlpha:!0}),h.set(u.textureMetallicRoughness,new x(C.data,u.textureMetallicRoughness,M)))}var A=w.COLOR_GAMMA,E=Math.pow(u.color[0],1/A),I=Math.pow(u.color[1],1/A),R=Math.pow(u.color[2],1/A),D=Math.pow(u.emissiveFactor[0],1/A),L=Math.pow(u.emissiveFactor[1],1/A),j=Math.pow(u.emissiveFactor[2],1/A);d.set(s,new w(r.__assign(r.__assign(r.__assign({},t),{transparent:"BLEND"===u.alphaMode,textureAlphaMode:T(u.alphaMode),textureAlphaCutoff:u.alphaCutoff,diffuse:[E,I,R],ambient:[E,I,R],opacity:u.opacity,doubleSided:u.doubleSided,doubleSidedType:"winding-order",cullFace:u.doubleSided?0:2,vertexColors:!!a.attributes.color,vertexTangents:!!a.attributes.tangent,normals:O?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:i.isSome(u.textureColor)&&P?h.get(u.textureColor).id:void 0,colorMixMode:u.colorMixMode,normalTextureId:i.isSome(u.textureNormal)&&P?h.get(u.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:i.isSome(u.textureOcclusion)&&P?h.get(u.textureOcclusion).id:void 0,emissiveTextureId:i.isSome(u.textureEmissive)&&P?h.get(u.textureEmissive).id:void 0,metallicRoughnessTextureId:i.isSome(u.textureMetallicRoughness)&&P?h.get(u.textureMetallicRoughness).id:void 0,emissiveFactor:[D,L,j],mrrFactors:[u.metallicFactor,u.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),n),s))}var V=function(e,t){switch(t){case 4:return f.trianglesToTriangles(e);case 5:return f.triangleStripToTriangles(e);case 6:return f.triangleFanToTriangles(e)}}(a.indices||a.attributes.position.count,a.primitiveType),F={},N={},k=a.attributes.position.count,z=g.createBuffer(m.BufferViewVec3f,k);if(y.vec3.transformMat4(z,a.attributes.position,a.transform),N.position={data:z.typedBuffer,size:z.elementCount},F.position=V,i.isSome(a.attributes.normal)){var U=g.createBuffer(m.BufferViewVec3f,k);o.mat3.normalFromMat4(c,a.transform),y.vec3.transformMat3(U,a.attributes.normal,c),N.normal={data:U.typedBuffer,size:U.elementCount},F.normal=V}if(i.isSome(a.attributes.tangent)){var B=g.createBuffer(m.BufferViewVec4f,k);o.mat3.normalFromMat4(c,a.transform),y.vec4.transformMat3(B,a.attributes.tangent,c),N.tangent={data:B.typedBuffer,size:B.elementCount},F.tangent=V}if(i.isSome(a.attributes.texCoord0)){var G=g.createBuffer(m.BufferViewVec2f,k);g.vec2.normalizeIntegerBuffer(G,a.attributes.texCoord0),N.uv0={data:G.typedBuffer,size:G.elementCount},F.uv0=V}if(i.isSome(a.attributes.color)){var H=g.createBuffer(m.BufferViewVec4u8,k);if(4===a.attributes.color.elementCount)a.attributes.color instanceof m.BufferViewVec4f?y.vec4.scale(H,a.attributes.color,255):a.attributes.color instanceof m.BufferViewVec4u8?g.vec4.copy(H,a.attributes.color):a.attributes.color instanceof m.BufferViewVec4u16&&y.vec4.scale(H,a.attributes.color,1/256);else{g.vec4.fill(H,255,255,255,255);var q=new m.BufferViewVec3u8(H.buffer,0,4);a.attributes.color instanceof m.BufferViewVec3f?y.vec3.scale(q,a.attributes.color,255):a.attributes.color instanceof m.BufferViewVec3u8?g.vec3.copy(q,a.attributes.color):a.attributes.color instanceof m.BufferViewVec3u16&&y.vec3.scale(q,a.attributes.color,1/256)}N.color={data:H.typedBuffer,size:H.elementCount},F.color=V}var W=new _(new b.GeometryData(N,F),"gltf_"+e.name+"_"+v++);S.stageResources.geometries.push(W),S.stageResources.materials.push(d.get(s)),P&&(i.isSome(u.textureColor)&&S.stageResources.textures.push(h.get(u.textureColor)),i.isSome(u.textureNormal)&&S.stageResources.textures.push(h.get(u.textureNormal)),i.isSome(u.textureOcclusion)&&S.stageResources.textures.push(h.get(u.textureOcclusion)),i.isSome(u.textureEmissive)&&S.stageResources.textures.push(h.get(u.textureEmissive)),i.isSome(u.textureMetallicRoughness)&&S.stageResources.textures.push(h.get(u.textureMetallicRoughness))),S.numberOfVertices+=k;var J=W.boundingInfo;p.expand(S.boundingBox,J.getBBMin()),p.expand(S.boundingBox,J.getBBMax())}))}})),u}function T(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,a,p,f,y,_,b,x,w,T,O,C;return r.__generator(this,(function(M){switch(M.label){case 0:return"wosr"!==(o=S(n.adjustStaticAGOUrl(e))).fileType?[3,2]:[4,t.cache?t.cache.loadWOSR(o.url,t):v.load(o.url,t)];case 1:return a=M.sent(),[2,{lods:[p=v.processLoadResult(a,t)],referenceBoundingBox:p.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:a.remove}];case 2:return[4,t.cache?t.cache.loadGLTF(o.url,t):h.load(new d.DefaultLoadingContext(t.streamDataRequester),o.url,t)];case 3:return f=M.sent(),y=i.get(f.model.meta,"ESRI_proxyEllipsoid"),f.meta.isEsriSymbolResource&&i.isSome(y)&&-1!==f.meta.uri.indexOf("/RealisticTrees/")&&function(e,t){for(var r=0;r<e.model.lods.length;++r){var n=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(var o=0,a=n.parts;o<a.length;o++){var p=a[o],d=p.attributes.normal;if(i.isNone(d))return;for(var h=p.attributes.position,f=h.count,v=u.vec3f64.create(),y=u.vec3f64.create(),_=u.vec3f64.create(),b=g.createBuffer(m.BufferViewVec4u8,f),x=g.createBuffer(m.BufferViewVec3f,f),w=s.mat4.invert(l.mat4f64.create(),p.transform),S=0;S<f;S++){h.getVec(S,y),d.getVec(S,v),c.vec3.transformMat4(y,y,p.transform),c.vec3.subtract(_,y,t.center),c.vec3.divide(_,_,t.radius);var P=_[2],T=c.vec3.length(_),O=Math.min(.45+.55*T*T,1);c.vec3.divide(_,_,t.radius),c.vec3.transformMat4(_,_,w),c.vec3.normalize(_,_),r+1!==e.model.lods.length&&e.model.lods.length>1&&(P>-1?c.vec3.lerp(_,_,v,.2):c.vec3.lerp(_,_,v,Math.min(-4*P-3.8,1))),x.setVec(S,_),b.set(S,0,255*O),b.set(S,1,255*O),b.set(S,2,255*O),b.set(S,3,255)}p.attributes.normal=x,p.attributes.color=b}}}(f,y),_=f.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:f.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,1,.5]},b=r.__assign(r.__assign({},t.materialParamsMixin),{treeRendering:f.customMeta.esriTreeRendering}),null!=o.specifiedLodIndex?(x=P(f,_,b,o.specifiedLodIndex),w=x[0].boundingBox,0!==o.specifiedLodIndex&&(T=P(f,_,b,0),w=T[0].boundingBox),[2,{lods:x,referenceBoundingBox:w,isEsriSymbolResource:f.meta.isEsriSymbolResource,isWosr:!1,remove:f.remove}]):(O=P(f,_,b),C=O[0].boundingBox,[2,{lods:O,referenceBoundingBox:C,isEsriSymbolResource:f.meta.isEsriSymbolResource,isWosr:!1,remove:f.remove}])}}))}))},t.parseUrl=S,t.gltfToEngineResources=P}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(226),r(154),r(152),r(153),r(172)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.streamDataRequester=e}return e.prototype.loadJSON=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.load("json",e,t)]}))}))},e.prototype.loadBinary=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return l.isDataProtocol(e)?(s.throwIfAborted(t),[2,l.dataToArrayBuffer(e)]):[2,this.load("binary",e,t)]}))}))},e.prototype.loadImage=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.load("image",e,t)]}))}))},e.prototype.load=function(e,t,l){return r.__awaiter(this,void 0,void 0,(function(){var c;return r.__generator(this,(function(r){switch(r.label){case 0:return a.isNone(this.streamDataRequester)?[4,n(t,{responseType:u[e]})]:[3,2];case 1:return[2,r.sent().data];case 2:return[4,i.result(this.streamDataRequester.request(t,e,l))];case 3:if(!0===(c=r.sent()).ok)return[2,c.value];throw s.throwIfAbortError(c.error),new o("","Request for resource failed: "+c.error)}}))}))},e}();t.DefaultLoadingContext=c;var u={image:"image",binary:"array-buffer",json:"json"}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(153),r(185),r(1709),r(1710),r(1711)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=0;function u(e){var t=e.json,r=null;return t.nodes.forEach((function(e){var t=e.extras;n.isSome(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)})),r}function p(e,t){return r.__awaiter(this,void 0,void 0,(function(){function n(i,a){return r.__awaiter(this,void 0,void 0,(function(){var s,l,c,u,p,d,f,v;return r.__generator(this,(function(r){switch(r.label){case 0:if(s=o.nodes[i],l=e.getNodeTransform(i),h.warnUnsupportedIf(null!=s.weights,"Morph targets are not supported."),null==s.mesh)return[3,4];c=o.meshes[s.mesh],u=0,p=c.primitives,r.label=1;case 1:return u<p.length?(d=p[u],[4,t(d,l,a,c.name)]):[3,4];case 2:r.sent(),r.label=3;case 3:return u++,[3,1];case 4:f=0,v=s.children||[],r.label=5;case 5:return f<v.length?[4,n(v[f],a)]:[3,8];case 6:r.sent(),r.label=7;case 7:return f++,[3,5];case 8:return[2]}}))}))}var o,a,s,l,c,u,p,d,f,v;return r.__generator(this,(function(t){switch(t.label){case 0:o=e.json,a=o.scenes[o.scene||0],s=a.nodes,l=s.length>1,c=0,u=s,t.label=1;case 1:return c<u.length?(p=u[c],d=o.nodes[p],f=[n(p,0)],function(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}(d)&&!l&&(v=d.extensions.MSFT_lod.ids,f.push.apply(f,v.map((function(e,t){return n(e,t+1)})))),[4,i.all(f)]):[3,4];case 2:t.sent(),t.label=3;case 3:return c++,[3,1];case 4:return[2]}}))}))}function d(e){if(33071===e||33648===e||10497===e)return e;h.error("Unexpected TextureSampler WrapMode: "+e)}t.load=function(e,t,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var a,m,y,g,_=this;return r.__generator(this,(function(b){switch(b.label){case 0:return[4,l.Resource.load(e,h,t,i)];case 1:return a=b.sent(),m="gltf_"+c++,y={lods:[],materials:new Map,textures:new Map,meta:u(a)},g=!(!a.json.asset.extras||"symbolResource"!==a.json.asset.extras.ESRI_type),[4,p(a,(function(e,t,l,c){return r.__awaiter(_,void 0,void 0,(function(){var u,p,g,_,b,x,w,S,P,T,O;return r.__generator(this,(function(r){switch(r.label){case 0:return u=void 0!==e.mode?e.mode:4,p=function(e){switch(e){case 4:case 5:case 6:return e;default:return null}}(u),n.isNone(p)?(h.warnUnsupported("Unsupported primitive mode ("+v[u]+"). Skipping primitive."),[2]):a.hasPositions(e)?[4,a.getMaterial(e,i)]:(h.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return g=r.sent(),b={transform:o.mat4f64.clone(t)},x={},[4,a.getPositionData(e,i)];case 2:return b.attributes=(x.position=r.sent(),x.normal=null,x.texCoord0=null,x.color=null,x.tangent=null,x),[4,a.getIndexData(e,i)];case 3:return b.indices=r.sent(),b.primitiveType=p,b.material=function(e,t,r){var n=function(t){var n=r+"_tex_"+(t&&t.id)+(t&&t.name?"_"+t.name:"");if(t&&!e.textures.has(n)){var i=s.makeTextureSource(t.data,{wrap:{s:d(t.wrapS),t:d(t.wrapT)},mipmap:f.some((function(e){return e===t.minFilter})),noUnpackFlip:!0});e.textures.set(n,i)}return n},i=r+"_mat_"+t.id+"_"+t.name;if(!e.materials.has(i)){var o=s.makeMaterialParameters({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?n(t.colorTexture):void 0,textureNormal:t.normalTexture?n(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?n(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?n(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?n(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(i,o)}return i}(y,g,m),_=b,a.hasNormals(e)?(w=_.attributes,[4,a.getNormalData(e,i)]):[3,5];case 4:w.normal=r.sent(),r.label=5;case 5:return a.hasTangents(e)?(S=_.attributes,[4,a.getTangentData(e,i)]):[3,7];case 6:S.tangent=r.sent(),r.label=7;case 7:return a.hasTextureCoordinates(e)?(P=_.attributes,[4,a.getTextureCoordinates(e,i)]):[3,9];case 8:P.texCoord0=r.sent(),r.label=9;case 9:return a.hasVertexColors(e)?(T=_.attributes,[4,a.getVertexColors(e,i)]):[3,11];case 10:T.color=r.sent(),r.label=11;case 11:return O=null,n.isSome(y.meta)&&n.isSome(y.meta.ESRI_lod)&&"screenSpaceRadius"===y.meta.ESRI_lod.metric&&(O=y.meta.ESRI_lod.thresholds[l]),y.lods[l]=y.lods[l]||{parts:[],name:c,lodThreshold:O},y.lods[l].parts.push(_),[2]}}))}))}))];case 2:return b.sent(),[2,{model:y,meta:{isEsriSymbolResource:g,uri:a.uri},customMeta:{}}]}}))}))};var h=new a.DefaultErrorContext,f=[9987,9985],v=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){void 0===r&&(r=""),this.major=e,this.minor=t,this._context=r}return e.prototype.lessThan=function(e,t){return this.major<e||e===this.major&&this.minor<t},e.prototype.since=function(e,t){return!this.lessThan(e,t)},e.prototype.validate=function(e){if(this.major!==e.major){var t=this._context&&this._context+":",n=this._context&&this._context+" ";throw new r(t+"unsupported-version","Required major "+n+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:e})}},e.prototype.clone=function(){return new e(this.major,this.minor,this._context)},e.parse=function(t,n){void 0===n&&(n="");var i=t.split("."),o=i[0],a=i[1],s=/^\s*\d+\s*$/;if(!o||!o.match||!o.match(s))throw new r((n&&n+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!a||!a.match||!a.match(s))throw new r((n&&n+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});return new e(parseInt(o,10),parseInt(a,10),n)},e}();t.Version=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(226),r(154),r(118),r(156),r(152),r(153),r(1255),r(160),r(193),r(493),r(356),r(326),r(358),r(540)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){Object.defineProperty(t,"__esModule",{value:!0});var g=s.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function _(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=l.isSome(t)&&t.streamDataRequester)?[2,b(e,o,t)]:[4,i.result(n(e,l.unwrap(t)))];case 1:return!0===(a=r.sent()).ok?[2,a.value.data]:(c.throwIfAbortError(a.error),x(a.error),[2,void 0])}}))}))}function b(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.result(t.request(e,"json",n))];case 1:return!0===(o=r.sent()).ok?[2,o.value]:(c.throwIfAbortError(o.error),x(o.error.details.url),[2,void 0])}}))}))}function x(e){throw new o("","Request for object resource failed: "+e)}function w(e){var t=e.params,r=t.topology,n=!0;switch(t.vertexAttributes||(g.warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var i=t.faces;if(i){if(t.vertexAttributes)for(var o in t.vertexAttributes){var a=i[o];a&&a.values?(null!=a.valueType&&"UInt32"!==a.valueType&&(g.warn("Unsupported indexed geometry indices type '"+a.valueType+"', only UInt32 is currently supported"),n=!1),null!=a.valuesPerElement&&1!==a.valuesPerElement&&(g.warn("Unsupported indexed geometry values per element '"+a.valuesPerElement+"', only 1 is currently supported"),n=!1)):(g.warn("Indexed geometry does not specify face indices for '"+o+"' attribute"),n=!1)}}else g.warn("Indexed geometries must specify faces"),n=!1;break;default:g.warn("Unsupported topology '"+r+"'"),n=!1}e.params.material||(g.warn("Geometry requires material"),n=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(g.warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function S(e){var t=d.empty();return e.forEach((function(e){var r=e.boundingInfo;d.expand(t,r.getBBMin()),d.expand(t,r.getBBMax())})),t}function P(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,u,p,d;return r.__generator(this,(function(r){switch(r.label){case 0:for(o in n=[],i=function(r){var i=e[r],o=i.images[0].data;if(!o)return g.warn("Externally referenced texture data is not yet supported"),"continue";var a=i.encoding+";base64,"+o,s="/textureDefinitions/"+r,u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},p=l.isSome(t)&&t.disableTextures?c.resolve(null):h.requestImage(a,t);n.push(p.then((function(e){return{refId:s,image:e,params:u,alphaChannelUsage:"rgba"===i.channels?i.alphaChannelUsage||"transparency":"none"}})))},e)i(o);return[4,c.all(n)];case 1:for(a=r.sent(),s={},u=0,p=a;u<p.length;u++)d=p[u],s[d.refId]=d;return[2,s]}}))}))}function T(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function O(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}function C(e){for(var t=new Uint32Array(e),r=0;r<e;r++)t[r]=r;return t}t.load=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,_(e,t)];case 1:return[4,P((n=r.sent()).textureDefinitions,t)];case 2:return i=r.sent(),[2,{resource:n,textures:i}]}}))}))},t.processLoadResult=function(e,t){var r=[],n=[],i=[],o=[],s=e.resource,c=u.Version.parse(s.version||"1.0","wosr");M.validate(c);for(var d=s.model.name,h=s.model.geometries,g=s.materialDefinitions,_=e.textures,b=0,x=new Map,P=0;P<h.length;P++){var A=h[P];if(w(A)){var E=O(A),I=A.params.vertexAttributes,R={};for(var D in I){var L=I[D],j=L.values;R[D]={data:j,size:L.valuesPerElement}}var V={};if("PerAttributeArray"===A.params.topology){var F=C(R.position.data.length/R.position.size);for(var N in R)V[N]=F}else{var k=A.params.faces;for(var z in k)V[z]=new Uint32Array(k[z].values)}var U=_&&_[E.texture];if(U&&!x.has(E.texture)){var B=U.image,G=U.params,H=new m(B,d,G);o.push(H),x.set(E.texture,H)}var q=x.get(E.texture),W=q?q.id:void 0,J=i[E.material]?i[E.material][E.texture]:null;if(!J){var Z=g[E.material.substring(E.material.lastIndexOf("/")+1)].params;1===Z.transparency&&(Z.transparency=0);var X=U&&U.alphaChannelUsage,Y=Z.transparency>0||"transparency"===X||"maskAndTransparency"===X,Q={ambient:p.vec3f64.fromArray(Z.diffuse),diffuse:p.vec3f64.fromArray(Z.diffuse),opacity:1-(Z.transparency||0),transparent:Y,textureAlphaMode:U?T(U.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:W,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:Z.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};l.isSome(t)&&t.materialParamsMixin&&a.mixin(Q,t.materialParamsMixin),J=new y(Q,d),i[E.material]||(i[E.material]={}),i[E.material][E.texture]=J}n.push(J);var K=new f(new v.GeometryData(R,V),d);b+=V.position?V.position.length:0,r.push(K)}}return{name:d,stageResources:{textures:o,materials:n,geometries:r},pivotOffset:s.model.pivotOffset,boundingBox:S(r),numberOfVertices:b,lodThreshold:null}},t.createTextureResources=P;var M=new u.Version(1,2,"wosr")}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1731)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(1259),r(659),r(932),r(447),r(653),r(253),r(257),r(260),r(373),r(1260),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){Object.defineProperty(t,"__esModule",{value:!0}),t.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"},t.pathVertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};var g=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(d,e),d.prototype.initializeProgram=function(e){var r=d.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,vvOpacity:n.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:n.receiveSSAO,doubleSidedMode:n.doubleSidedMode});return new m(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),t.pathVertexAttributeLocations)},d.prototype.bindPass=function(e,t,r){this.program.setUniform3fv("size",t.size),0===this.configuration.output?(this.program.setUniform3fv("size",t.size),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform3fv("specular",t.specular),this.program.setUniform1f("opacity",t.opacity)):1!==this.configuration.output&&3!==this.configuration.output||l.ReadLinearDepth.bindUniforms(this.program,r),a.setVVUniforms(this.program,t)},d.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e),0===this.configuration.output&&(u.Camera.bindUniforms(this.program,e),c.ReadShadowMap.bindView(this.program,e)),2===this.configuration.output&&s.VertexNormal.bindUniforms(this.program,e)},d.prototype.initializePipeline=function(){var e=this.configuration,t=function(t){return y.makePipelineState({blending:t,culling:(r=e,function(e){return!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode)}(r)&&{face:1028,mode:2305}),depthTest:{func:513},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?f.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?f.stencilBaseAllZerosParams:null});var r};return 0===e.output?t(e.transparent&&y.separateBlendingParams(770,1,771,771)):t(null)},d.shader=new p.ReloadableShaderModule(v,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1260)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),d}(d.ShaderTechnique);t.PathTechnique=g;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.doubleSidedMode=0,t.receiveShadows=!1,t.receiveSSAO=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.slicePlaneEnabled=!1,t.shadowMap=!1,t.transparent=!1,t.sceneHasOcludees=!1,t}return n.__extends(t,e),n.__decorate([h.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([h.parameter({count:3})],t.prototype,"doubleSidedMode",void 0),n.__decorate([h.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([h.parameter()],t.prototype,"receiveSSAO",void 0),n.__decorate([h.parameter()],t.prototype,"vvSize",void 0),n.__decorate([h.parameter()],t.prototype,"vvColor",void 0),n.__decorate([h.parameter()],t.prototype,"vvOpacity",void 0),n.__decorate([h.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([h.parameter()],t.prototype,"shadowMap",void 0),n.__decorate([h.parameter()],t.prototype,"transparent",void 0),n.__decorate([h.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(h.ShaderTechniqueConfiguration);t.PathTechniqueConfiguration=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(810),r(175)],void 0===(i=function(e,t,r,n,i){var o,a,s,l,c,u,p,d,h,f,v;Object.defineProperty(t,"__esModule",{value:!0}),t.PathVertexPosition=function(e,t){e.attributes.add("featureValue","vec4"),e.vertex.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n  bool isCapVertex() {\n    return featureValue.w == 1.0;\n  }\n  "],["\n  bool isCapVertex() {\n    return featureValue.w == 1.0;\n  }\n  "])))),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "],["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "]))))):e.vertex.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "],["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "])))),t.vvOpacity?(e.vertex.defines.addInt("VV_OPACITY_N",8),e.vertex.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value = featureValue.z;\n      if (value <= vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "],["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value = featureValue.z;\n      if (value <= vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "]))))):e.vertex.code.add(i.glsl(c||(c=r.__makeTemplateObject(["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "])))),t.vvColor?(e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(i.glsl(u||(u=r.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value = featureValue.y;\n      if (value <= vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "],["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value = featureValue.y;\n      if (value <= vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "]))))):e.vertex.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "])))),e.include(n.PositionAttribute),e.attributes.add("profileRight","vec4"),e.attributes.add("profileUp","vec4"),e.attributes.add("profileVertexAndNormal","vec4"),e.vertex.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n  vec3 calculateVPos() {\n    vec2 size = getSize();\n    vec3 origin = position;\n    vec3 right = profileRight.xyz;\n    vec3 up = profileUp.xyz;\n    vec3 forward = cross(up, right);\n    vec2 profileVertex = profileVertexAndNormal.xy * size;\n    vec2 profileNormal = profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal = 0.0;\n    float normalOffsetAlongProfilePlaneNormal = 0.0;\n    "],["\n  vec3 calculateVPos() {\n    vec2 size = getSize();\n    vec3 origin = position;\n    vec3 right = profileRight.xyz;\n    vec3 up = profileUp.xyz;\n    vec3 forward = cross(up, right);\n    vec2 profileVertex = profileVertexAndNormal.xy * size;\n    vec2 profileNormal = profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal = 0.0;\n    float normalOffsetAlongProfilePlaneNormal = 0.0;\n    "])))),e.vertex.code.add(i.glsl(h||(h=r.__makeTemplateObject(["\n    if(!isCapVertex()) {\n      vec2 rotationRight = vec2(profileRight.w, profileUp.w);\n      float maxDistance = length(rotationRight);\n  "],["\n    if(!isCapVertex()) {\n      vec2 rotationRight = vec2(profileRight.w, profileUp.w);\n      float maxDistance = length(rotationRight);\n  "])))),e.vertex.code.add(i.glsl(f||(f=r.__makeTemplateObject(["\n      rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx = dot(profileVertex, rotationRight);\n      if (abs(rx) > maxDistance) {\n        // NB: we do the tangent by x=-y and y=x\n        vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);\n        float ry = dot(profileVertex, rotationUp);\n        profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal = profileUp.w;\n    }\n\n    vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "],["\n      rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx = dot(profileVertex, rotationRight);\n      if (abs(rx) > maxDistance) {\n        // NB: we do the tangent by x=-y and y=x\n        vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);\n        float ry = dot(profileVertex, rotationUp);\n        profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal = profileUp.w;\n    }\n\n    vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "])))),e.vertex.code.add(i.glsl(v||(v=r.__makeTemplateObject(["\n  vec3 localNormal() {\n    vec3 right = profileRight.xyz;\n    vec3 up = profileUp.xyz;\n    vec3 forward = cross(up, right);\n    vec2 profileNormal = profileVertexAndNormal.zw;\n\n    vec3 normal = right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal += forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "],["\n  vec3 localNormal() {\n    vec3 right = profileRight.xyz;\n    vec3 up = profileUp.xyz;\n    vec3 forward = cross(up, right);\n    vec2 profileNormal = profileVertexAndNormal.zw;\n\n    vec3 normal = right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal += forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "]))))},t.setVVUniforms=function(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(654),r(223),r(256),r(1259),r(811),r(345),r(812),r(660),r(1241),r(933),r(447),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){var m,y,g,_,b,x,w,S,P,T,O,C;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new v.ShaderBuilder;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(a.PathVertexPosition,e),0===e.output&&(t.include(o.Transform,{linearDepth:!1}),e.receiveShadows&&t.include(h.ReadShadowMap,e),t.include(n.ForwardLinearDepth,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),t.vertex.code.add(f.glsl(m||(m=r.__makeTemplateObject(["\n      void main() {\n        vpos = calculateVPos();\n        vnormal = normalize(localNormal());\n\n        gl_Position = transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor = getColor();\n      }\n    "],["\n      void main() {\n        vpos = calculateVPos();\n        vnormal = normalize(localNormal());\n\n        gl_Position = transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor = getColor();\n      }\n    "])))),t.include(i.Slice,e),t.include(u.EvaluateSceneLighting,e),t.include(c.EvaluateAmbientOcclusion,e),e.receiveShadows&&t.include(h.ReadShadowMap,e),t.include(p.Normals,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.code.add(f.glsl(y||(y=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        shadingParams.normalView = vnormal;\n        vec3 normal = shadingNormal(shadingParams);\n        float ssao = evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "],["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        shadingParams.normalView = vnormal;\n        vec3 normal = shadingNormal(shadingParams);\n        float ssao = evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "])))),e.receiveShadows?t.fragment.code.add(f.glsl(g||(g=r.__makeTemplateObject(["\n        float shadow = readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow = readShadowMap(vpos, linearDepth);\n      "])))):0===e.viewingMode?t.fragment.code.add(f.glsl(_||(_=r.__makeTemplateObject(["\n        float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "],["\n        float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "])))):t.fragment.code.add(f.glsl(b||(b=r.__makeTemplateObject(["\n        float shadow = 0.0;\n      "],["\n        float shadow = 0.0;\n      "])))),t.fragment.code.add(f.glsl(x||(x=r.__makeTemplateObject(["\n        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity = vcolor.a * opacity;\n        albedo += 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor = vec4(shadedColor, combinedOpacity);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity = vcolor.a * opacity;\n        albedo += 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor = vec4(shadedColor, combinedOpacity);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "]))))),1!==e.output&&3!==e.output||(t.include(o.Transform,{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(f.glsl(w||(w=r.__makeTemplateObject(["\n        void main() {\n          vpos = calculateVPos();\n          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "],["\n        void main() {\n          vpos = calculateVPos();\n          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "])))),t.include(i.Slice,e),t.include(s.OutputDepth,e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(f.glsl(S||(S=r.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "]))))),2===e.output&&(t.include(o.Transform,{linearDepth:!1}),t.include(d.NormalUtils,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(f.glsl(P||(P=r.__makeTemplateObject(["\n        void main(void) {\n          vpos = calculateVPos();\n          vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos = calculateVPos();\n          vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.include(i.Slice,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(f.glsl(T||(T=r.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal = normalize(vnormal);\n          if (gl_FrontFacing == false) normal = -normal;\n          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal = normalize(vnormal);\n          if (gl_FrontFacing == false) normal = -normal;\n          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "]))))),4===e.output&&(t.include(o.Transform,{linearDepth:!1}),t.include(d.NormalUtils,e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(f.glsl(O||(O=r.__makeTemplateObject(["\n        void main(void) {\n          vpos = calculateVPos();\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos = calculateVPos();\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])))),t.include(i.Slice,e),t.include(l.OutputHighlight),t.fragment.code.add(f.glsl(C||(C=r.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(594),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s){var l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(i.Transform,{linearDepth:!1}),t.include(o.VertexColor,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(a.glsl(l||(l=r.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(n.Slice,e),t.fragment.uniforms.add("eColor","vec4"),t.fragment.code.add(a.glsl(c||(c=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "])),e.attributeColor?"gl_FragColor = vColor * eColor;":"gl_FragColor = eColor;")),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(953)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){void 0===r&&(r=2048),this.text=e,this.maxSize=r,this._renderPixelRatio=null,this._displayWidth=null,t instanceof n.default?this.parameters=t:this.parameters=new n.default(t),this.key=this.parameters.key+"--"+e,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight()}return Object.defineProperty(e.prototype,"displayWidth",{get:function(){return r.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth()),this._displayWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPixelRatio",{get:function(){if(r.isNone(this._renderPixelRatio)){var e=this.parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0);var n,i,a=this.renderedLineHeight,s=this.renderedHaloSize,l=(n=e.textAlign,i=this.renderedWidth,("center"===n?.5*i:"right"===n?i:0)+s),c=s+o;e.save(),s>0&&this.renderHalo(e,l,c,t,r),this.setFontProperties(e,this.renderedFontSize),r+=c,t+=l;for(var u=0,p=this.textLines;u<p.length;u++){var d=p[u];e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",e.fillText(d,t,r),e.globalCompositeOperation="source-over",e.fillStyle=this.parameters.fillStyle,e.fillText(d,t,r),r+=a}e.restore()},e.prototype.renderHalo=function(e,t,r,n,i){var o=this.renderedWidth,a=this.renderedHeight,s=l(c,Math.max(o,u),Math.max(a,u)),p=s.getContext("2d");p.clearRect(0,0,o,a),this.setFontProperties(p,this.renderedFontSize),p.fillStyle=this.parameters.haloStyle,p.strokeStyle=this.parameters.haloStyle;var d=this.renderedHaloSize<3;p.lineJoin=d?"miter":"round",d?this.renderHaloEmulated(p,t,r):this.renderHaloNative(p,t,r),e.globalAlpha=this.parameters.definition.halo.color[3],e.drawImage(s,0,0,o,a,n,i,o,a),e.globalAlpha=1},e.prototype.renderHaloEmulated=function(e,t,r){for(var n=this.renderedLineHeight,i=this.renderedHaloSize,o=0,s=this.textLines;o<s.length;o++){for(var l=s[o],c=0,u=a;c<u.length;c++){var p=u[c],d=p[0],h=p[1];e.fillText(l,t+i*d,r+i*h)}r+=n}},e.prototype.renderHaloNative=function(e,t,r){for(var n=this.renderedLineHeight,i=this.renderedHaloSize,o=0,a=this.textLines;o<a.length;o++){for(var s=a[o],l=2*i,c=0;c<5;c++){var u=.6+.1*c;e.lineWidth=u*l,e.strokeText(s,t,r)}r+=n}},e.prototype.setFontProperties=function(e,t){var r=this.parameters.definition.font,n=r.style+" "+r.weight+" "+t+"px "+r.family+", sans-serif";e.font=n,e.textAlign="left",e.textBaseline="top"},e.prototype.computeTextWidth=function(){var e=l(c,u,u).getContext("2d");this.setFontProperties(e,this.parameters.definition.size);for(var t=0,r=0,n=this.textLines;r<n.length;r++){var i=n[r];t=Math.max(t,e.measureText(i).width)}var o=this.parameters.definition.font;return("italic"===o.style||"oblique"===o.style||"string"==typeof o.weight&&("bold"===o.weight||"bolder"===o.weight)||"number"==typeof o.weight&&o.weight>600)&&(t+=.3*e.measureText("A").width),t+=2*this.parameters.haloSize,Math.round(t)},e.prototype.computeLineHeight=function(){var e=1.275*this.parameters.definition.size;return Math.ceil(e+2*this.parameters.haloSize)+o},e}();t.TextRenderer=i;for(var o=1,a=[],s=0;s<360;s+=22.5)a.push([Math.cos(Math.PI*s/180),Math.sin(Math.PI*s/180)]);function l(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}t.getTextHelperCanvas=l;var c={canvas:null},u=512;t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(216)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultWaterMaterialParameters={waveStrength:.06,waveTextureRepeat:32,waveDirection:r.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1},t.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(935),r(593)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t,r){var n=e.call(this)||this;return n.symbol=t,n.convert=r,n.graphics3DSymbol=null,n.referenced=0,n}return r.__extends(t,e),t.prototype.getSymbolLayerSize=function(e){return n.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null},t.prototype.doLoad=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.symbol.fetchSymbol({signal:e})];case 1:return(t=r.sent()).id=this.symbol.id,this.graphics3DSymbol=this.convert(t),[4,this.graphics3DSymbol.load()];case 2:return r.sent(),[2]}}))}))},t.prototype.createGraphics3DGraphic=function(e){return n.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null},Object.defineProperty(t.prototype,"complexity",{get:function(){return n.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:o.emptySymbolComplexity},enumerable:!0,configurable:!0}),t.prototype.globalPropertyChanged=function(e,t){return!!n.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)},t.prototype.applyRendererDiff=function(e,t){return!!n.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.applyRendererDiff(e,t)},t.prototype.prepareSymbolPatch=function(e){n.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)},t.prototype.updateGeometry=function(e,t){return!!n.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)},t.prototype.onRemoveGraphic=function(){},t.prototype.getFastUpdateStatus=function(){return n.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}},t.prototype.destroy=function(){n.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,this.abortLoad()},Object.defineProperty(t.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0}),t}(i.Loadable)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(173)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i){void 0===i&&(i=null),this.lij=[0,0,0],this.extent=r.create(),this.resolution=0,this.loadPriority=0,this.measures={visibility:2,screenRect:r.create(),distance:0,shouldSplit:!1},this.used=!1,i&&this.acquire(e,t,n,i)}return e.prototype.acquire=function(t,r,n,i){this.tilingScheme=i,this.id=e.id(t,r,n),this.lij[0]=t,this.lij[1]=r,this.lij[2]=n,i.getExtent(t,r,n,this.extent),this.resolution=i.resolutionAtLevel(t)},e.prototype.release=function(){this.tilingScheme=null},e.prototype.getChildren=function(t){var r=this.lij[0]+1,n=2*this.lij[1],i=2*this.lij[2];return t?(t[0].acquire(r,n,i,this.tilingScheme),t[1].acquire(r,n+1,i,this.tilingScheme),t[2].acquire(r,n,i+1,this.tilingScheme),t[3].acquire(r,n+1,i+1,this.tilingScheme),t):[new e(r,n,i,this.tilingScheme),new e(r,n+1,i,this.tilingScheme),new e(r,n,i+1,this.tilingScheme),new e(r,n+1,i+1,this.tilingScheme)]},e.prototype.copyMeasurementsFrom=function(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,r.set(e.measures.screenRect,this.measures.screenRect)},e.id=function(e,t,r){return e+"/"+t+"/"+r},e}();t.FeatureTileDescriptor3D=n,t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(251),r(1176)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.frustum=o.create(),this.lines=new Array(12),this.origin=n.vec3f64.create(),this.direction=n.vec3f64.create(),this._altitude=null,this.renderCoordsHelper=e?e.renderCoordsHelper:null;for(var t=0;t<12;t++)this.lines[t]={origin:null,direction:n.vec3f64.create(),endpoint:null}}return Object.defineProperty(e.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0}),e.prototype.update=function(e){o.fromMatrix(e.viewMatrix,e.projectionMatrix,this.frustum),r.vec3.copy(this.origin,e.eye),r.vec3.copy(this.direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this.origin),this.updateLines()},e.prototype.updatePoints=function(e){for(var t=0;t<this.frustum.points.length;t++)r.vec3.copy(this.frustum.points[t],e[t]);o.recomputePlanes(this.frustum),this.updateLines()},Object.defineProperty(e.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0}),e.prototype.intersectsSphere=function(e){return o.intersectsSphere(this.frustum.planes,e)},e.prototype.intersectsRay=function(e){return o.intersectsRay(this.frustum.planes,e)},e.prototype.intersectsLineSegment=function(e,t){return o.intersectsLineSegment(this.frustum.planes,e,t)},e.prototype.intersectsPoint=function(e){return o.intersectsPoint(this.frustum.planes,e)},e.prototype.updateLines=function(){for(var e=this.frustum.points,t=0;t<4;t++){var r=t,n=t+4;this.updateLine(this.lines[t],e[r],e[n]),this.updateLine(this.lines[t+4],e[r],3===t?e[0]:e[r+1]),this.updateLine(this.lines[t+8],e[n],3===t?e[4]:e[n+1])}},e.prototype.updateLine=function(e,t,r){e.origin=t,e.endpoint=r,i.directionFromTo(e.direction,t,r)},e.planePointIndices=o.planePointIndices,e.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]],e}();t.Frustum=a,t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(180),r(226),r(152),r(153),r(231)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){this.spatialReference=e,this.view=t}return e.prototype.getElevation=function(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)},e.prototype.queryElevation=function(e,t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,i,o)]}))}))},e}();t.ViewElevationProvider=c;var u=function(){function e(e,t,n){this.spatialReference=e,this._getElevationQueryProvider=t,this._queries=[],this._isScheduled=!1,this._queryOptions=r.__assign(r.__assign({},n),{ignoreInvisibleLayers:!0})}return e.prototype.queryElevation=function(e,t,n,o){return void 0===o&&(o=0),r.__awaiter(this,void 0,void 0,(function(){var a=this;return r.__generator(this,(function(r){return[2,s.create((function(r,l){var c={x:e,y:t,minDemResolution:o,result:{resolve:r,reject:l},signal:n};a._queries.push(c),s.onAbort(n,(function(){i.remove(a._queries,c),l(s.createAbortError())})),a._scheduleDoQuery()}))]}))}))},e.prototype._scheduleDoQuery=function(){var e=this;this._isScheduled||(l.schedule((function(){return e._doQuery()})),this._isScheduled=!0)},e.prototype._doQuery=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,l,c,u,p,d,h,f,v,m;return r.__generator(this,(function(y){switch(y.label){case 0:return this._isScheduled=!1,e=this._queries,this._queries=[],0===e.length?[2]:(t=e.map((function(e){return[e.x,e.y]})),i=e.reduce((function(e,t){return Math.min(e,t.minDemResolution)}),1/0),l=new n.Multipoint({points:t,spatialReference:this.spatialReference}),(c=this._getElevationQueryProvider())?(u=e.length>1&&e.some((function(e){return!!e.signal}))?s.createAbortController():null,p=a.isSome(u)?u.signal:e[0].signal,a.isSome(u)&&(d=0,e.forEach((function(t){return s.onAbort(t.signal,(function(){d++,t.result.reject(s.createAbortError()),d===e.length&&u.abort()}))}))),h=r.__assign(r.__assign({},this._queryOptions),{minDemResolution:i,signal:p}),[4,o.result(c.queryElevation(l,h))]):(e.forEach((function(e){return e.result.reject()})),[2]));case 1:for(f=y.sent(),v=0;v<e.length;v++)m=e[v],a.isSome(m.signal)&&m.signal.aborted?m.result.reject(s.createAbortError()):!1===f.ok?m.result.reject(f.error):m.result.resolve(f.value.geometry.points[v][2]);return[2]}}))}))},e}();t.ElevationQuery=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(210),r(1763),r(1269)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceControllerMaster=n.ResourceControllerMaster,t.newResourceController=n.newResourceController,t.newMemoryController=i.newMemoryController,t.downloadSlotsPerClient=r.MapFromValues([[0,15],[1,15],[2,20],[3,5]]),t.maxDownloadSlots=30}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(190),r(156),r(483),r(1270)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.support.MemoryController");t.newMemoryController=function(e){return new s(e)};var s=function(){function e(e){this._view=e,this.events=new r,this.minQuality=.1,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryUsed=0,this._memoryPredicted=0,this._cacheStorage=new i.MemCacheStorage,this._numQualityChanges=0,this._updating=!1}return e.prototype.destroy=function(){this.events=null},e.prototype.getMemCache=function(e,t){return new i.MemCache(e,this._cacheStorage,t)},Object.defineProperty(e.prototype,"maxMemory",{get:function(){return this._maxMemory},set:function(e){null!=e&&e>0&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(1),this._maxMemory=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(e){null!=e&&e>=0&&(this._additionalCacheMemory=e)},enumerable:!0,configurable:!0}),e.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096},Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0}),e.prototype.resetStableQuality=function(){this._stableQuality=0},e.prototype.update=function(){if(this._updateMemory(),!(this._memoryPredicted<=0)||this._updating){var e=this._layersUpdating();this._memoryPredicted<.6&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1)):e?(this._memoryPredicted>1.1||this._memoryUsed>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._memoryUsed>1?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._memoryUsed<.75&&this._quality<1?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this.updating!==e&&(this._updating=e,this.events.emit("updating-changed",this.updating))}},e.prototype._updateQuality=function(e){return(e=Math.min(Math.max(e,this.minQuality),1))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),++this._numQualityChanges,!0)},e.prototype._layersUpdating=function(){return this._view.allLayerViews.some((function(e){return!!e.updating}))},e.prototype._updateMemory=function(){var e=this,t=0,r=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(t+=this._view.basemapTerrain.getUsedMemory());var n=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;n&&(t+=n.getUsedMemory()),this._view.allLayerViews&&this._view.allLayerViews.forEach((function(n){if(o.isMemoryManagedLayerView(n)){var i=n.ignoresMemoryFactor()?e._quality:1;t+=n.getUsedMemory()*i,r+=n.getUnloadedMemory()*i}}));var i=null==this._warnMemoryUsage||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),s=1048576*this._maxMemory;if(t>s&&i){this._warnMemoryUsage=t;var l=function(e){return(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},c=Math.round(100*this._quality);a.warn("Memory Limit exceeded! Limit: "+l(s)+" Current: "+l(t)+" Projected: "+l(t+r)+" Quality: "+c+"%")}this._memoryUsed=t/s,this._memoryPredicted=(t+r)/s;var u=s-t;this._cacheStorage.maxSize=Math.max(0,u+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)},Object.defineProperty(e.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMemoryManagedLayerView=function(e){return"function"==typeof e.getUsedMemory}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(195)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});t.BaseTask=function(e){this.clientType=e,this._cancelled=!1,this.size=0,this.duration=0};var n=function(){function e(e,t,r,n){var i=this;this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=r,this._type2id=new Map,this._tasks=new Array,this._typeNumWorkers=new Array,this._typeWorkerQuota=new Array,this._typeStatistics=new Array,this._totalNumWorkers=0,n.forEach((function(e,t){i._type2id.set(t,i._tasks.length),i._tasks.push([]),i._typeNumWorkers.push(0),i._typeStatistics.push({requests:0,size:0,duration:0,speed:0}),i._typeWorkerQuota.push(e)}))}return Object.defineProperty(e.prototype,"numTypes",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this,r=this._type2id.get(e.clientType);this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[r]++,this._totalNumWorkers++,this._workerFunc(e,(function(e,r){return t._taskCallback(e,r)}))):this._tasks[r].push(e)},e.prototype.getStatsForType=function(e){var t=this._type2id.get(e);return{quota:this._typeWorkerQuota[t],workers:this._typeNumWorkers[t],queueSize:this._tasks[t].length,requestStats:this._typeStatistics[t]}},e.prototype.cancel=function(e){this._taskFinished(e),e._cancelled=!0},e.prototype.clear=function(){for(var e=0;e<this._tasks.length;e++)this._tasks[e]=[]},e.prototype._taskFinished=function(e){var t=this._type2id.get(e.clientType);this._typeNumWorkers[t]--,this._totalNumWorkers--,this._typeStatistics[t].requests++,this._typeStatistics[t].size+=e.size||0,this._typeStatistics[t].duration+=e.duration||0,this._typeStatistics[t].speed=this._typeStatistics[t].duration>0?this._typeStatistics[t].size/this._typeStatistics[t].duration:0,r.assert(this._typeNumWorkers[t]>=0),this._next()},e.prototype._next=function(){for(var e=0;e<this.numTypes;++e){if(this._typeNumWorkers[e]<this._typeWorkerQuota[e]&&this._processQueue(e))return;++e}for(e=0;e<this.numTypes;++e)if(this._processQueue(e))return},e.prototype._processQueue=function(e){for(var t=this;this._tasks[e].length>0;)if(this._workerFunc(this._tasks[e].shift(),(function(e,r){return t._taskCallback(e,r)})))return this._typeNumWorkers[e]++,this._totalNumWorkers++,!0;return!1},e.prototype._taskCallback=function(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{set workerFunc(t){e._workerFunc=t}}},enumerable:!0,configurable:!0}),e}();t.AsyncWorkerQueue=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(165),r(166),r(151),r(179),r(163),r(327),r(1766),r(1767),r(1768),r(1769),r(1770),r(1771),r(1772),r(1773),r(954),r(1774),r(1775)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){var x=new o.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),w=s.ensureType(g);return function(e){function t(t){var r=e.call(this,t)||this;return r.url=null,r}return r.__extends(t,e),t.prototype.areasAndLengths=function(e,t){var n=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),e.toJSON()),o=this._asValidOptions(n,t);return i(this.parsedUrl.path+"/areasAndLengths",o).then((function(e){return e.data}))},t.prototype.autoComplete=function(e,t,o){var a=e[0].spatialReference,s=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(a.toJSON()),polygons:JSON.stringify(this._encodeGeometries(e).geometries),polylines:JSON.stringify(this._encodeGeometries(t).geometries)}),l=this._asValidOptions(s,o);return i(this.parsedUrl.path+"/autoComplete",l).then((function(e){return(e.data.geometries||[]).map((function(e){return new n.Polygon({spatialReference:a,rings:e.rings})}))}))},t.prototype.buffer=function(e,t){var o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),e.toJSON()),a=e.outSpatialReference||e.geometries[0].spatialReference,s=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/buffer",s).then((function(e){return(e.data.geometries||[]).map((function(e){return new n.Polygon({spatialReference:a,rings:e.rings})}))}))},t.prototype.convexHull=function(e,t){var n=e[0].spatialReference,o=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(n.toJSON()),geometries:JSON.stringify(this._encodeGeometries(e))}),a=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/convexHull",a).then((function(e){var t=e.data;return l.fromJSON(t.geometry).set({spatialReference:n})}))},t.prototype.cut=function(e,t,n){var o=e[0].spatialReference,a=e.map((function(e){return e.toJSON()})),s=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(o.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(e[0]),geometries:a}),cutter:JSON.stringify(t.toJSON())}),c=this._asValidOptions(s,n);return i(this.parsedUrl.path+"/cut",c).then((function(e){var t=e.data,r=t.geometries||[];return{cutIndexes:t.cutIndexes,geometries:r.map((function(e){return l.fromJSON(e).set({spatialReference:o})}))}}))},t.prototype.densify=function(e,t){var n=e.geometries[0].spatialReference,o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),e.toJSON()),a=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/densify",a).then((function(e){return(e.data.geometries||[]).map((function(e){return l.fromJSON(e).set({spatialReference:n})}))}))},t.prototype.difference=function(e,t,n){var o=e[0].spatialReference,a={query:r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(o.toJSON()),geometries:JSON.stringify(this._encodeGeometries(e)),geometry:JSON.stringify({geometryType:l.getJsonType(t),geometry:t.toJSON()})})};return(this.requestOptions||n)&&(a=r.__assign(r.__assign(r.__assign({},this.requestOptions),n),a)),i(this.parsedUrl.path+"/difference",a).then((function(e){return(e.data.geometries||[]).map((function(e){return l.fromJSON(e).set({spatialReference:o})}))}))},t.prototype.distance=function(e,t){var n=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),e.toJSON()),o=this._asValidOptions(n,t);return i(this.parsedUrl.path+"/distance",o).then((function(e){var t=e.data;return t&&t.distance}))},t.prototype.fromGeoCoordinateString=function(e,t){var n={};null!=e.sr&&"object"==typeof e.sr?n.sr=e.sr.wkid||JSON.stringify(e.sr):n.sr=e.sr,n.strings=JSON.stringify(e.strings);var o=e.conversionType||"mgrs";n.conversionType=x.toJSON(o),n.conversionMode=e.conversionMode;var a=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),n),s=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/fromGeoCoordinateString",s).then((function(e){return e.data.coordinates}))},t.prototype.generalize=function(e,t){var n=(e=v.from(e)).toJSON(),o=u.generalizeToRESTParameters(e),a=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),o),s=n.geometries[0].spatialReference,c=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/generalize",c).then((function(e){return(e.data.geometries||[]).map((function(e){return l.fromJSON(e).set({spatialReference:s})}))}))},t.prototype.intersect=function(e,t,n){var o=e[0].spatialReference,a=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(o.toJSON()),geometries:JSON.stringify(this._encodeGeometries(e)),geometry:JSON.stringify({geometryType:l.getJsonType(t),geometry:t.toJSON()})}),s=this._asValidOptions(a,n);return i(this.parsedUrl.path+"/intersect",s).then((function(e){return(e.data.geometries||[]).map((function(e){return l.fromJSON(e).set({spatialReference:o})}))}))},t.prototype.labelPoints=function(e,t){var n=e.map((function(e){return e.toJSON()})),o=e[0].spatialReference,a=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:o.wkid?o.wkid:JSON.stringify(o.toJSON()),polygons:JSON.stringify(n)}),s=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/labelPoints",s).then((function(e){return(e.data.labelPoints||[]).map((function(e){return l.fromJSON(e).set({spatialReference:o})}))}))},t.prototype.lengths=function(e,t){e=m.from(e);var n=p.lengthsToRESTParameters(e),o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),n),a=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/lengths",a).then((function(e){return e.data}))},t.prototype.offset=function(e,t){e=y.from(e);var n=d.offsetToRESTParameters(e),o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),n),a=e.geometries[0].spatialReference,s=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/offset",s).then((function(e){return(e.data.geometries||[]).map((function(e){return l.fromJSON(e).set({spatialReference:a})}))}))},t.prototype.project=function(e,t){var n=this;e=w(e);var o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),e.toJSON()),a=e.outSpatialReference,s=l.getJsonType(e.geometries[0]),c=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/project",c).then((function(e){var t=e.data;return n._decodeGeometries(t,s,a)}))},t.prototype.relation=function(e,t){e=_.from(e);var n=h.relationToRESTParameters(e),o=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),n),a=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/relation",a).then((function(e){return e.data.relations}))},t.prototype.reshape=function(e,t,n){var o=e.spatialReference,a=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(o.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(e),geometry:e.toJSON()}),reshaper:JSON.stringify(t.toJSON())}),s=this._asValidOptions(a,n);return i(this.parsedUrl.path+"/reshape",s).then((function(e){var t=e.data;return l.fromJSON(t.geometry).set({spatialReference:o})}))},t.prototype.simplify=function(e,t){var n=this,o=e[0].spatialReference,a=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:o.wkid?o.wkid:JSON.stringify(o.toJSON()),geometries:JSON.stringify(this._encodeGeometries(e))}),s=l.getJsonType(e[0]),c=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/simplify",c).then((function(e){var t=e.data;return n._decodeGeometries(t,s,o)}))},t.prototype.toGeoCoordinateString=function(e,t){var n={};null!=e.sr&&"object"==typeof e.sr?n.sr=e.sr.wkid||JSON.stringify(e.sr):n.sr=e.sr,n.coordinates=JSON.stringify(e.coordinates);var o=e.conversionType||"mgrs";n.conversionType=x.toJSON(o),n.conversionMode=e.conversionMode,n.numOfDigits=e.numOfDigits,n.rounding=e.rounding,n.addSpaces=e.addSpaces;var a=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),n),s=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/toGeoCoordinateString",s).then((function(e){return e.data.strings}))},t.prototype.trimExtend=function(e,t){e=b.from(e);var o=f.trimExtendToRESTParameters(e),a=r.__assign(r.__assign(r.__assign({},this.parsedUrl.query),{f:"json"}),o),s=e.sr,l=this._asValidOptions(a,t);return i(this.parsedUrl.path+"/trimExtend",l).then((function(e){return(e.data.geometries||[]).map((function(e){var t=e.paths;return new n.Polyline({spatialReference:s,paths:t})}))}))},t.prototype.union=function(e,t){var n=e[0].spatialReference,o=r.__assign(r.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(n.toJSON()),geometries:JSON.stringify(this._encodeGeometries(e))}),a=this._asValidOptions(o,t);return i(this.parsedUrl.path+"/union",a).then((function(e){var t=e.data;return l.fromJSON(t.geometry).set({spatialReference:n})}))},t.prototype._asValidOptions=function(e,t){var n={query:e};return(this.requestOptions||t)&&(n=r.__assign(r.__assign(r.__assign({},this.requestOptions),t),n)),n},t.prototype._encodeGeometries=function(e){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n].toJSON());return{geometryType:l.getJsonType(e[0]),geometries:t}},t.prototype._decodeGeometries=function(e,t,n){var i=l.getGeometryType(t),o=e.geometries,a=[],s={spatialReference:n.toJSON()};return o.forEach((function(e,t){a[t]=new i(r.__assign(r.__assign({},e),s))})),a},t.prototype._toProjectGeometry=function(e){var t=e.spatialReference.toJSON();return e instanceof n.Extent?new n.Polygon({rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],spatialReference:t}):new n.Polyline({paths:[[].concat(e.points)],spatialReference:t})},t.prototype._fromProjectedGeometry=function(e,t,r){if("extent"===t){var i=e.rings[0];return new n.Extent(i[0][0],i[0][1],i[2][0],i[2][1],r)}return new n.Multipoint({points:e.paths[0],spatialReference:r.toJSON()})},t.UNIT_METER=9001,t.UNIT_GERMAN_METER=9031,t.UNIT_FOOT=9002,t.UNIT_SURVEY_FOOT=9003,t.UNIT_CLARKE_FOOT=9005,t.UNIT_FATHOM=9014,t.UNIT_NAUTICAL_MILE=9030,t.UNIT_SURVEY_CHAIN=9033,t.UNIT_SURVEY_LINK=9034,t.UNIT_SURVEY_MILE=9035,t.UNIT_KILOMETER=9036,t.UNIT_CLARKE_YARD=9037,t.UNIT_CLARKE_CHAIN=9038,t.UNIT_CLARKE_LINK=9039,t.UNIT_SEARS_YARD=9040,t.UNIT_SEARS_FOOT=9041,t.UNIT_SEARS_CHAIN=9042,t.UNIT_SEARS_LINK=9043,t.UNIT_BENOIT_1895A_YARD=9050,t.UNIT_BENOIT_1895A_FOOT=9051,t.UNIT_BENOIT_1895A_CHAIN=9052,t.UNIT_BENOIT_1895A_LINK=9053,t.UNIT_BENOIT_1895B_YARD=9060,t.UNIT_BENOIT_1895B_FOOT=9061,t.UNIT_BENOIT_1895B_CHAIN=9062,t.UNIT_BENOIT_1895B_LINK=9063,t.UNIT_INDIAN_FOOT=9080,t.UNIT_INDIAN_1937_FOOT=9081,t.UNIT_INDIAN_1962_FOOT=9082,t.UNIT_INDIAN_1975_FOOT=9083,t.UNIT_INDIAN_YARD=9084,t.UNIT_INDIAN_1937_YARD=9085,t.UNIT_INDIAN_1962_YARD=9086,t.UNIT_INDIAN_1975_YARD=9087,t.UNIT_FOOT_1865=9070,t.UNIT_RADIAN=9101,t.UNIT_DEGREE=9102,t.UNIT_ARCMINUTE=9103,t.UNIT_ARCSECOND=9104,t.UNIT_GRAD=9105,t.UNIT_GON=9106,t.UNIT_MICRORADIAN=9109,t.UNIT_ARCMINUTE_CENTESIMAL=9112,t.UNIT_ARCSECOND_CENTESIMAL=9113,t.UNIT_MIL6400=9114,t.UNIT_BRITISH_1936_FOOT=9095,t.UNIT_GOLDCOAST_FOOT=9094,t.UNIT_INTERNATIONAL_CHAIN=109003,t.UNIT_INTERNATIONAL_LINK=109004,t.UNIT_INTERNATIONAL_YARD=109001,t.UNIT_STATUTE_MILE=9093,t.UNIT_SURVEY_YARD=109002,t.UNIT_50KILOMETER_LENGTH=109030,t.UNIT_150KILOMETER_LENGTH=109031,t.UNIT_DECIMETER=109005,t.UNIT_CENTIMETER=109006,t.UNIT_MILLIMETER=109007,t.UNIT_INTERNATIONAL_INCH=109008,t.UNIT_US_SURVEY_INCH=109009,t.UNIT_INTERNATIONAL_ROD=109010,t.UNIT_US_SURVEY_ROD=109011,t.UNIT_US_NAUTICAL_MILE=109012,t.UNIT_UK_NAUTICAL_MILE=109013,t.UNIT_SQUARE_INCHES="esriSquareInches",t.UNIT_SQUARE_FEET="esriSquareFeet",t.UNIT_SQUARE_YARDS="esriSquareYards",t.UNIT_ACRES="esriAcres",t.UNIT_SQUARE_MILES="esriSquareMiles",t.UNIT_SQUARE_MILLIMETERS="esriSquareMillimeters",t.UNIT_SQUARE_CENTIMETERS="esriSquareCentimeters",t.UNIT_SQUARE_DECIMETERS="esriSquareDecimeters",t.UNIT_SQUARE_METERS="esriSquareMeters",t.UNIT_ARES="esriAres",t.UNIT_HECTARES="esriHectares",t.UNIT_SQUARE_KILOMETERS="esriSquareKilometers",r.__decorate([a.property()],t.prototype,"url",void 0),r.__decorate([a.subclass("esri.tasks.GeometryService")],t)}(c)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(662),r(161)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,"LercWorker","_decode",t,{strategy:"dedicated"})||this;return r.scheduler=t,r}return r.__extends(t,e),t.prototype.decode=function(e,t,r){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},r):n.resolve(null)},t.prototype.getTransferList=function(e){return[e.buffer]},t}(i.WorkerHandle),a=new Map;t.acquireInstance=function(e){var t=a.get(e);return t||(t={instance:new o(e),ref:0},a.set(e,t)),++t.ref,t.instance},t.releaseInstance=function(e){if(null!=e){var t=e.scheduler,r=a.get(t);r&&--r.ref<=0&&(r.instance.destroy(),a.delete(t))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(486),r(237)],void 0===(i=function(e,t,r,n){return function(){function e(e,t){this.lockedSchemaPixelSize=e,this.isGCS=t}return e.prototype.getLevelRowColumn=function(e){return this.isGCS?[e[0],e[1]>>1,e[2]>>1]:256===this.lockedSchemaPixelSize&&e[0]>0?[e[0]-1,e[1]>>1,e[2]>>1]:e},e.prototype.adjustLevel=function(e){return this.isGCS?e:256===this.lockedSchemaPixelSize?e>0?e-1:0:e},e.prototype.getShift=function(e,t){var r=0,n=0;return(256===this.lockedSchemaPixelSize||this.isGCS)&&(e[2]%2&&(r=t),e[1]%2&&(n=t)),[r,n]},e.prototype.getScale=function(e){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===e)return 1;return 2},e.create256x256CompatibleTileInfo=function(e){if(!e)return null;if(256===e.size[0]&&256===e.size[1])return e;for(var t=e.spatialReference.isGeographic,i=[],o=e.lods.length,a=0;a<o;a++){var s=e.lods[a],l=t?s.resolution:2*s.resolution;i.push(new r({level:s.level,scale:s.scale,resolution:l}))}return new n({size:[256,256],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:i})},e.create512x512CompatibleTileInfo=function(e){if(!e)return null;if(256===e.size[0]||256===e.size[1])return null;for(var t=[],i=e.lods.length,o=0;o<i;o++){var a=e.lods[o],s=.5*a.resolution;t.push(new r({level:a.level,scale:a.scale,resolution:s}))}return new n({size:[512,512],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:t})},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(956)],void 0===(i=function(e,t,r,n){return function(){function e(t,n){if(this.backgroundBucketIds=[],this._layerByName={},this.styleJSON=t,this.version=parseFloat(t.version),this.sprite=n?n.spriteUrl:t.sprite,this.glyphs=n?n.glyphsUrl:t.glyphs,r("stable-symbol-rendering")){var i=(t.layers||[]).filter((function(e){return e.layout&&e.layout["text-font"]}))[0];i&&(t.layers||[]).forEach((function(e){e.layout&&e.layout["text-font"]&&(e.layout["text-font"]=i.layout["text-font"])}))}if(this.layers=(t.layers||[]).map(e._create),this.layers)for(var o=void 0,a=0;a<this.layers.length;a++)o=this.layers[a],this._layerByName[o.id.toLowerCase()]=o,0===o.type&&this.backgroundBucketIds.push(a);this._identifyRefLayers()}return e.prototype.isPainterDataDriven=function(e){var t=this._layerByName[e.toLowerCase()];return!!t&&t.isPainterDataDriven()},e.prototype.getStyleLayerId=function(e){return e>=this.layers.length?null:this.layers[e].id},e.prototype.getLayoutProperties=function(e){var t=this._layerByName[e.toLowerCase()];return t?t.layout:null},e.prototype.getPaintProperties=function(e){var t=this._layerByName[e.toLowerCase()];return t?t.paint:null},e.prototype.setPaintProperties=function(t,r){var n=this._layerByName[t.toLowerCase()];if(!n)return"";var i=this.layers.indexOf(n);this.styleJSON.layers[i].paint=r;var o={id:n.id,type:n.typeName,source:n.source,sourceLayer:n["source-layer"],minzoom:n.minzoom,maxzoom:n.maxzoom,filter:n.filter,layout:n.layout,paint:r},a=e._recreateLayer(o,n);return this.layers[i]=a,this._layerByName[n.id.toLowerCase()]=a,n.id},e.prototype.setLayoutProperties=function(t,r){var n=this._layerByName[t.toLowerCase()];if(!n)return"";var i=this.layers.indexOf(n);this.styleJSON.layers[i].layout=r;var o={id:n.id,type:n.typeName,source:n.source,sourceLayer:n["source-layer"],minzoom:n.minzoom,maxzoom:n.maxzoom,filter:n.filter,layout:r,paint:n.paint},a=e._recreateLayer(o,n);return this.layers[i]=a,this._layerByName[n.id.toLowerCase()]=a,n.id},e.prototype._identifyRefLayers=function(){for(var e=[],t=[],r=0,n=0,i=this.layers;n<i.length;n++){var o=i[n];if(1===o.type){var a=o,s=o.source+"|"+o.sourceLayer;s+="|"+JSON.stringify(o.layout&&o.layout.visibility),s+="|"+JSON.stringify(o.minzoom),s+="|"+JSON.stringify(o.maxzoom),s+="|"+JSON.stringify(o.filter),(a.hasDataDrivenFill||a.hasDataDrivenOutline)&&(s+="|"+JSON.stringify(r)),e.push({key:s,layer:o})}if(2===o.type){var l=o;s=o.source+"|"+o.sourceLayer,s+="|"+JSON.stringify(o.layout&&o.layout.visibility),s+="|"+JSON.stringify(o.minzoom),s+="|"+JSON.stringify(o.maxzoom),s+="|"+JSON.stringify(o.filter),s+="|"+JSON.stringify(o.layout&&o.layout["line-cap"]),s+="|"+JSON.stringify(o.layout&&o.layout["line-join"]),l.hasDataDrivenLine&&(s+="|"+JSON.stringify(r)),t.push({key:s,layer:o})}++r}this._assignRefLayers(e),this._assignRefLayers(t)},e.prototype._assignRefLayers=function(e){var t,r;e.sort((function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}));for(var n=e.length,i=0;i<n;i++){var o=e[i];if(o.key===t)o.layer.refLayerId=r;else if(t=o.key,r=o.layer.id,1===o.layer.type&&!o.layer.getPaintProperty("fill-outline-color"))for(var a=i+1;a<n;a++){var s=e[a];if(s.key!==t)break;if(s.layer.getPaintProperty("fill-outline-color")){e[i]=s,e[a]=o,r=s.layer.id;break}}}},e._create=function(e,t,r){var i=1-(1+t)*(1/(r.length+1));switch(e.type){case"background":return new n.BackgroundStyleLayer(0,e,i);case"fill":return new n.FillStyleLayer(1,e,i);case"line":return new n.LineStyleLayer(2,e,i);case"symbol":return new n.SymbolStyleLayer(3,e,i);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new n.CircleStyleLayer(4,e,i)}throw new Error("Unknown vector tile layer")},e._recreateLayer=function(e,t){switch(e.type){case"background":return new n.BackgroundStyleLayer(0,e,t.z);case"fill":return new n.FillStyleLayer(1,e,t.z);case"line":return new n.LineStyleLayer(2,e,t.z);case"symbol":return new n.SymbolStyleLayer(3,e,t.z);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new n.CircleStyleLayer(4,e,t.z)}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(158)],void 0===(i=function(e,t,r){function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(i(e)&&e.destroyed)try{throw new Error("instance is already destroyed")}catch(e){console.warn(e.stack)}else for(var n=0,o=t;n<o.length;n++){var a=o[n];if(!(a in e))throw new Error("Property '"+a+"' does not exist and cannot be disposed");var s=e[a];s&&("function"==typeof s.destroy?s.destroy():"function"==typeof s.dispose?s.dispose():"function"==typeof s.remove&&s.remove()),i(e)&&a in e.__accessor__.metadatas?e._set(a,null):e[a]=null}}function i(e){return e instanceof r}Object.defineProperty(t,"__esModule",{value:!0}),t.disposeMembers=n,t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(153),r(151),r(308),r(666),r(1278),r(218)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initialize=function(){var e=this.get("view.map.allLayers"),t=e&&e.includes(this.layer),r=this.get("view.map.ground.layers"),o=r&&r.includes(this.layer);if(t&&!o){var a=new n("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground");this.addResolvingPromise(i.reject(a))}this._addTilingSchemeMatchPromise(),this.addResolvingPromise(l.checkArcGISServiceVersionCompatibility(this.layer))},r.__decorate([o.property({readOnly:!0,aliasOf:"layer.fullExtent"})],t.prototype,"fullExtent",void 0),r.__decorate([o.property()],t.prototype,"layer",void 0),r.__decorate([o.property({readOnly:!0,aliasOf:"layer.tileInfo"})],t.prototype,"tileInfo",void 0),r.__decorate([o.subclass("esri.views.3d.layers.ElevationLayerView3D")],t)}(s.TiledLayerView3D(a.LayerView3D(c)))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156),r(153),r(324)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.layers.support.tiledLayerUtils");t.checkArcGISServiceVersionCompatibility=function(e){if(!o.isHostedAgolService(e.url)){if(e.version<10.22){var t=new r("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+e.version,{minVersion:10.22,detectedVersion:e.version});return i.reject(t)}return 10.22!==e.version||o.isHostedSecuredProxyService(e.url,e.get("portalItem.id"))||a.warnOnce("ArcGIS server version 10.2.2 needs the following patch installed in order for map layers to work properly: https://support.esri.com/en/download/2146"),i.resolve()}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}return e.prototype.copyFrom=function(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues},e}();t.ElevationBounds=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(251),r(415)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r){this.samplerData=null,this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t;for(var n=r.noDataValue,i=r.values,o=1/0,a=-1/0,s=!0,l=!1,c=0;c<i.length;c++){var u=i[c];u!==n?(o=u<o?u:o,a=u>a?u:a,s=!1):l=!0}s&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:n,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(t[2]-t[0]),dy:(r.width-1)/(t[3]-t[1]),x0:t[0],y1:t[3]},this.bounds=[o,a],this.hasNoDataValues=l}return e.prototype.release=function(){this.samplerData=null,this.bounds=null},e.prototype.computeMinMaxValue=function(e,t,r,o){o.min=1/0,o.max=-1/0,o.hasNoDataValues=!1;var a=e-this.level;if(a<=0)return o;var s=Math.pow(2,a);if(Math.floor(t/s)!==this.i||Math.floor(r/s)!==this.j)return o;var l=1/0,c=-1/0,u=this.samplerData.width,p=this.samplerData.pixelData,d=.5*i.ELEVATION_NODATA_VALUE,h=(u-1)/s,f=(r-this.j*s)*h,v=(t-this.i*s)*h;if(h<1){var m=Math.floor(f),y=Math.floor(v),g=p[E=m+y*u],_=p[E+1],b=p[E+u],x=p[E+u+1];if(g+_+b+x<d){var w=f-m,S=v-y,P=n.bilerp(g,_,b,x,w,S),T=n.bilerp(g,_,b,x,w+h,S),O=n.bilerp(g,_,b,x,w,S+h),C=n.bilerp(g,_,b,x,w+h,S+h);return o.min=Math.min(P,T,O,C),o.max=Math.max(P,T,O,C),o}f=m,v=y,h=1}else f=Math.floor(f),v=Math.floor(v),h=Math.ceil(h);for(var M=f;M<=f+h;M++)for(var A=v;A<=v+h;A++){var E,I=p[E=M+A*u];I<d?(l=Math.min(l,I),c=Math.max(c,I)):o.hasNoDataValues=!0}return o.min=l,o.max=c,o},e.sample=function(e,t,n){for(var o=0,a=n;o<a.length;o++){var s=a[o];if(s){var l=s.safeWidth,c=s.width,u=s.pixelData,p=r.clamp(s.dy*(s.y1-t),0,l),d=r.clamp(s.dx*(e-s.x0),0,l),h=Math.floor(p),f=Math.floor(d),v=h*c+f,m=v+c,y=u[v],g=u[m],_=u[v+1],b=u[m+1];if(y+g+_+b<.5*i.ELEVATION_NODATA_VALUE){var x=y+(_-y)*(d-=f);return x+(g+(b-g)*d-x)*(p-h)}}}return null},e}();t.ElevationData=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(230),r(415),r(816)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._scaleRangeEnabled=!1,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"_desiredMinLevelDelta",{get:function(){return i.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_loadingLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0}),t.Pool=new n(t),t}(o.TileAgent)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(230),r(816)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeEnabled=!0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"_desiredMinLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_loadingLevelDelta",{get:function(){return 8},enumerable:!0,configurable:!0}),t.Pool=new n(t),t}(i.TileAgent)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(235)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DESIRED_ANIMATION_FPS=25,t.DESIRED_ANIMATION_MS=r.Milliseconds(1e3/t.DESIRED_ANIMATION_FPS),t.DESIRED_DRAPED_ANIMATION_FPS=20,t.DESIRED_DRAPED_ANIMATION_MS=r.Milliseconds(1e3/t.DESIRED_DRAPED_ANIMATION_FPS)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(121)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.removeLoadedShaderModules=function(){var e,t=null===(e=r.require)||void 0===e?void 0:e.modules;if(t)for(var n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];-1!==o.search(".glsl")&&delete t[o]}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175),r(252)],void 0===(i=function(e,t,r,n,i){var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(){var e=new i.ShaderBuilder;return e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("scale","float"),e.vertex.uniforms.add("offset","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = uv0 * scale + offset;\n    }\n  "],["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = uv0 * scale + offset;\n    }\n  "])))),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("opacity","float"),e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    void main() {\n      vec4 color = texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "],["\n    void main() {\n      vec4 color = texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "])))),e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1815),r(1816),r(1817),r(795),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c,u,p,d,h,f,v,m,y,g;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new l.ShaderBuilder;return t.include(n.BasicGrid),t.include(o.Common),t.include(i.Colormap),0===e.output?function(e,t){e.fragment.uniforms.add("u_bandCount","int"),e.fragment.uniforms.add("u_minCutOff","float",3),e.fragment.uniforms.add("u_maxCutOff","float",3),e.fragment.uniforms.add("u_factor","float",3),e.fragment.uniforms.add("u_minOutput","float"),e.fragment.uniforms.add("u_maxOutput","float"),e.fragment.uniforms.add("u_useGamma","bool"),e.fragment.uniforms.add("u_gamma","float",3),e.fragment.uniforms.add("u_gammaCorrection","float",3),e.fragment.code.add(s.glsl(u||(u=r.__makeTemplateObject(["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val >= maxCutOff) {\n          return maxOutput;\n        } else if (val <= minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf = 1.0;\n          float outRange = maxOutput - minOutput;\n          float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma > 1.0) {\n            tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal = minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "],["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val >= maxCutOff) {\n          return maxOutput;\n        } else if (val <= minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf = 1.0;\n          float outRange = maxOutput - minOutput;\n          float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma > 1.0) {\n            tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal = minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "]))));var n=t?s.glsl(p||(p=r.__makeTemplateObject(["gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"],["gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"]))):s.glsl(d||(d=r.__makeTemplateObject(["gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"],["gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"])));e.fragment.code.add(s.glsl(h||(h=r.__makeTemplateObject(["\n      void main() {\n        vec2 pixelLocation = getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel = getPixel(pixelLocation);\n        if (currentPixel.a == 0.0) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount == 1) {\n          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ","\n        } else {\n          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "],["\n      void main() {\n        vec2 pixelLocation = getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel = getPixel(pixelLocation);\n        if (currentPixel.a == 0.0) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount == 1) {\n          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ","\n        } else {\n          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "])),n))}(t,e.applyColormap):1===e.output?function(e){e.fragment.code.add(s.glsl(c||(c=r.__makeTemplateObject(["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation = getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel = getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor = colormap(currentPixel, true);\n      }\n    "],["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation = getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel = getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor = colormap(currentPixel, true);\n      }\n    "]))))}(t):2===e.output&&function(e,t){e.fragment.uniforms.add("u_hillshadeType","int"),e.fragment.uniforms.add("u_sinZcosAs","float",6),e.fragment.uniforms.add("u_sinZsinAs","float",6),e.fragment.uniforms.add("u_cosZs","float",6),e.fragment.uniforms.add("u_weights","float",6),e.fragment.uniforms.add("u_factor","vec2"),e.fragment.uniforms.add("u_applyColormap","bool"),e.fragment.uniforms.add("u_minValue","float"),e.fragment.uniforms.add("u_maxValue","float"),e.fragment.uniforms.add("u_srcImageSize","vec2"),e.include(a.ColorConversion,{stages:1}),e.fragment.code.add(s.glsl(f||(f=r.__makeTemplateObject(["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb = colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv = rgb2hsv(rgb.xyz);\n    hsv.z = hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"],["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb = colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv = rgb2hsv(rgb.xyz);\n    hsv.z = hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"])))),e.fragment.code.add(s.glsl(v||(v=r.__makeTemplateObject(["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "],["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "]))));var n=t?s.glsl(m||(m=r.__makeTemplateObject(["gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"],["gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"]))):s.glsl(y||(y=r.__makeTemplateObject(["\n       hillshade *= alpha;\n       gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);\n       "],["\n       hillshade *= alpha;\n       gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);\n       "])));e.fragment.code.add(s.glsl(g||(g=r.__makeTemplateObject(["\n    void main() {\n      vec2 pixelLocation = getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel = getPixel(pixelLocation);\n      if (currentPixel.a == 0.0) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy = vec2(-1.0, -1.0);\n      vec2 bxy = vec2(0.0, -1.0);\n      vec2 cxy = vec2(1.0, -1.0);\n      vec2 dxy = vec2(-1.0, 0.0);\n      vec2 fxy = vec2(1.0, 0.0);\n      vec2 gxy = vec2(-1.0, 1.0);\n      vec2 hxy = vec2(0.0, 1.0);\n      vec2 ixy = vec2(1.0, 1.0);\n      vec2 onePixel = 1.0 / u_srcImageSize;\n      if (pixelLocation.s < onePixel.s) {\n        axy[0] = 1.0;\n        dxy[0] = 1.0;\n        gxy[0] = 1.0;\n      }\n      if (pixelLocation.t < onePixel.t) {\n        axy[1] = 1.0;\n        bxy[1] = 1.0;\n        cxy[1] = 1.0;\n      }\n      if (pixelLocation.s > 1.0 - onePixel.s) {\n        cxy[0] = -1.0;\n        fxy[0] = -1.0;\n        ixy[0] = -1.0;\n      }\n      if (pixelLocation.t > 1.0 - onePixel.t) {\n        gxy[1] = -1.0;\n        hxy[1] = -1.0;\n        ixy[1] = -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve = texture2D(u_image, pixelLocation);\n      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade = 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType == 0){\n        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z = (u_cosZs[0] + cosDelta) / dzd;\n        if (z < 0.0)  z = 0.0;\n        hillshade = z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k = 0; k < 6; k++) {\n        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z = (u_cosZs[k] + cosDelta) / dzd;\n        if (z < 0.0) z = 0.0;\n        hillshade = hillshade + z * u_weights[k];\n        if (k == 5) break;\n        }\n      }\n\n      // set color\n      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *= u_opacity;\n      ","\n    }\n  "],["\n    void main() {\n      vec2 pixelLocation = getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel = getPixel(pixelLocation);\n      if (currentPixel.a == 0.0) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy = vec2(-1.0, -1.0);\n      vec2 bxy = vec2(0.0, -1.0);\n      vec2 cxy = vec2(1.0, -1.0);\n      vec2 dxy = vec2(-1.0, 0.0);\n      vec2 fxy = vec2(1.0, 0.0);\n      vec2 gxy = vec2(-1.0, 1.0);\n      vec2 hxy = vec2(0.0, 1.0);\n      vec2 ixy = vec2(1.0, 1.0);\n      vec2 onePixel = 1.0 / u_srcImageSize;\n      if (pixelLocation.s < onePixel.s) {\n        axy[0] = 1.0;\n        dxy[0] = 1.0;\n        gxy[0] = 1.0;\n      }\n      if (pixelLocation.t < onePixel.t) {\n        axy[1] = 1.0;\n        bxy[1] = 1.0;\n        cxy[1] = 1.0;\n      }\n      if (pixelLocation.s > 1.0 - onePixel.s) {\n        cxy[0] = -1.0;\n        fxy[0] = -1.0;\n        ixy[0] = -1.0;\n      }\n      if (pixelLocation.t > 1.0 - onePixel.t) {\n        gxy[1] = -1.0;\n        hxy[1] = -1.0;\n        ixy[1] = -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve = texture2D(u_image, pixelLocation);\n      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade = 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType == 0){\n        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z = (u_cosZs[0] + cosDelta) / dzd;\n        if (z < 0.0)  z = 0.0;\n        hillshade = z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k = 0; k < 6; k++) {\n        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z = (u_cosZs[k] + cosDelta) / dzd;\n        if (z < 0.0) z = 0.0;\n        hillshade = hillshade + z * u_weights[k];\n        if (k == 5) break;\n        }\n      }\n\n      // set color\n      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *= u_opacity;\n      ","\n    }\n  "])),n))}(t,e.applyColormap),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1820),r(496)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=null,o=[];t.enabled=!1,t.setEnabled=function(e){t.enabled=e},t.begin=function(){t.enabled&&(i=[])},t.trace=function(e){t.enabled&&null!=i&&i.push(e)},t.end=function(){if(t.enabled){var e=i;return i=null,e&&(o.forEach((function(t){return t(e)})),o.length=0),e}return null},t.instrumentContext=function(e){return t.enabled?n.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,(function(e,n){t.enabled&&i&&i.push("gl."+e+"("+r.glFunctionArgsToString(e,n)+")")})):e},t.request=function(e){o.push(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(1822),r(811),r(345),r(660),r(933),r(1289),r(1823),r(1824),r(1242),r(494),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){var y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V,F,N,k,z;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new m.ShaderBuilder;if(t.include(h.HeaderComment,{name:"Terrain Shader",output:e.output}),t.include(p.Skirts),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float"),0===e.output){t.include(i.Transform,{linearDepth:!1}),t.include(c.NormalUtils,e),t.include(d.TerrainTexture,e);var U=0!==e.overlayMode,B=2===e.overlayMode;U&&t.include(u.Overlay,{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:e.ssrEnabled,highStepCount:e.highStepCount}),B&&t.include(o.VertexTangent,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),e.receiveShadows&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(t.vertex.uniforms.add("lightingMainDirection","vec3"),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.vertex.uniforms.add("screenSizePerspective","vec4"),t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),t.vertex.code.add(v.glsl(P||(P=r.__makeTemplateObject(["\n      void main(void) {\n        vpos = position;\n        vnormal = getLocalUp(vpos, origin);\n\n        vec2 uv = uv0;\n        vpos = applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ","\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ","\n        ","\n      }\n    "],["\n      void main(void) {\n        vpos = position;\n        vnormal = getLocalUp(vpos, origin);\n\n        vec2 uv = uv0;\n        vpos = applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ","\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ","\n        ","\n      }\n    "])),e.atmosphere?v.glsl(y||(y=r.__makeTemplateObject(["\n        wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight = (view  * vec4(-lightingMainDirection, 1.0)).xyz;"],["\n        wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight = (view  * vec4(-lightingMainDirection, 1.0)).xyz;"]))):"",e.tileBorders?v.glsl(g||(g=r.__makeTemplateObject(["vuv = uv;"],["vuv = uv;"]))):"",e.screenSizePerspective?v.glsl(_||(_=r.__makeTemplateObject(["\n        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera = length(viewPos);\n        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle = abs(viewSpaceNormal.z);"],["\n        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera = length(viewPos);\n        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle = abs(viewSpaceNormal.z);"]))):"",e.receiveShadows?v.glsl(b||(b=r.__makeTemplateObject(["linearDepth = gl_Position.w;"],["linearDepth = gl_Position.w;"]))):"",U?v.glsl(x||(x=r.__makeTemplateObject(["setOverlayVTC(uv);"],["setOverlayVTC(uv);"]))):"",B?v.glsl(w||(w=r.__makeTemplateObject(["forwardVertexTangent(vnormal);"],["forwardVertexTangent(vnormal);"]))):v.glsl(S||(S=r.__makeTemplateObject([""],[""]))))),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(n.Slice,e),t.include(l.EvaluateSceneLighting,e),t.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float"),e.screenSizePerspective&&t.fragment.uniforms.add("screenSizePerspective","vec4"),B&&(t.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),t.fragment.uniforms.add("ovOuterWaterTex","sampler2D"),t.fragment.uniforms.add("view","mat4")),t.fragment.code.add(v.glsl(T||(T=r.__makeTemplateObject(["\n      const vec3 ambient = vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse = vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness = 2.5;\n      const float sliceOpacity = 0.2;\n\n      float lum(vec3 c) {\n        float max = max(max(c.r, c.g), c.b);\n        float min = min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "],["\n      const vec3 ambient = vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse = vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness = 2.5;\n      const float sliceOpacity = 0.2;\n\n      float lum(vec3 c) {\n        float max = max(max(c.r, c.g), c.b);\n        float min = min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "])))),e.atmosphere&&t.fragment.code.add(v.glsl(O||(O=r.__makeTemplateObject(["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   = vec3(0.0);\n        vec3 fuzzySpecColor = vec3(1.0);\n        vec3 subColor       = vec3(0.0);\n        float rollOff       = 1.0;\n\n        vec3 Ln = normalize(lightPos);\n        vec3 Nn = normalize(normal);\n        vec3 Hn = normalize(view + Ln);\n\n        float ldn = dot(Ln, Nn);\n        float diffComp = max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv = dot(view, Ln);\n\n        vec3 diffContrib = surfaceColor * diffComp;\n        float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib = subLamb * subColor;\n        vec3 vecColor = vec3(vdn);\n\n        vec3 diffuseContrib = (subContrib + diffContrib);\n        vec3 specularContrib = (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "],["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   = vec3(0.0);\n        vec3 fuzzySpecColor = vec3(1.0);\n        vec3 subColor       = vec3(0.0);\n        float rollOff       = 1.0;\n\n        vec3 Ln = normalize(lightPos);\n        vec3 Nn = normalize(normal);\n        vec3 Hn = normalize(view + Ln);\n\n        float ldn = dot(Ln, Nn);\n        float diffComp = max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv = dot(view, Ln);\n\n        vec3 diffContrib = surfaceColor * diffComp;\n        float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib = subLamb * subColor;\n        vec3 vecColor = vec3(vdn);\n\n        vec3 diffuseContrib = (subContrib + diffContrib);\n        vec3 specularContrib = (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "])))),t.fragment.code.add(v.glsl(L||(L=r.__makeTemplateObject(["\n      void main() {\n        ","\n        float vndl = dot(normalize(vnormal), -lightingMainDirection);\n        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d = (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor = getTileColor() * opacity;\n        ","\n        if (rejectBySlice(vpos)) {\n          tileColor *= sliceOpacity;\n        }\n        vec3 atm = vec3(0.0);\n        ","\n        vec3 albedo = atm + tileColor.rgb;\n        vec3 normal = normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor = vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        ","\n        float vndl = dot(normalize(vnormal), -lightingMainDirection);\n        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d = (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor = getTileColor() * opacity;\n        ","\n        if (rejectBySlice(vpos)) {\n          tileColor *= sliceOpacity;\n        }\n        vec3 atm = vec3(0.0);\n        ","\n        vec3 albedo = atm + tileColor.rgb;\n        vec3 normal = normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor = vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      }\n    "])),e.receiveShadows?v.glsl(C||(C=r.__makeTemplateObject(["float shadow = readShadowMap(vpos, linearDepth);"],["float shadow = readShadowMap(vpos, linearDepth);"]))):v.glsl(M||(M=r.__makeTemplateObject(["float shadow = 0.0;"],["float shadow = 0.0;"]))),U?v.glsl(A||(A=r.__makeTemplateObject(["\n            vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor = overlayOpacity * overlayColorOpaque;\n            vec4 groundColor = tileColor;\n            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;"],["\n            vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor = overlayOpacity * overlayColorOpaque;\n            vec4 groundColor = tileColor;\n            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;"]))):"",e.atmosphere?v.glsl(E||(E=r.__makeTemplateObject(["\n            float ndotl = max(0.0, min(1.0, vndl));\n            atm = atmosphere(wlight, wnormal, -viewDirection);\n            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *= tileColor.a; // premultiply with tile alpha"],["\n            float ndotl = max(0.0, min(1.0, vndl));\n            atm = atmosphere(wlight, wnormal, -viewDirection);\n            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *= tileColor.a; // premultiply with tile alpha"]))):"",B?v.glsl(I||(I=r.__makeTemplateObject(["\n            vec4 overlayWaterMask = getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength = length(overlayWaterMask);\n            if (waterNormalLength > 0.95) {\n              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition = view*vec4(vpos, 1.0);\n              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"],["\n            vec4 overlayWaterMask = getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength = length(overlayWaterMask);\n            if (waterNormalLength > 0.95) {\n              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition = view*vec4(vpos, 1.0);\n              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"]))):"",e.screenSizePerspective?v.glsl(R||(R=r.__makeTemplateObject(["\n          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale <= 0.25) {\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale <= 0.5) {\n            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale >= 0.99) {\n            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"],["\n          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale <= 0.25) {\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale <= 0.5) {\n            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale >= 0.99) {\n            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"]))):"",e.tileBorders?v.glsl(D||(D=r.__makeTemplateObject(["\n            vec2 dVuv = fwidth(vuv);\n            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"],["\n            vec2 dVuv = fwidth(vuv);\n            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"]))):""))}return 1!==e.output&&3!==e.output||(t.include(i.Transform,{linearDepth:!0}),t.include(f.RgbaFloatEncoding),t.include(a.OutputDepth,{output:e.output}),t.include(c.NormalUtils,e),t.varyings.add("linearDepth","float"),t.vertex.uniforms.add("nearFar","vec2"),t.vertex.code.add(v.glsl(j||(j=r.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal = getLocalUp(position, origin);\n          vec2 uv = uv0;\n          vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "],["\n        void main(void) {\n          vec3 normal = getLocalUp(position, origin);\n          vec2 uv = uv0;\n          vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "])))),t.fragment.code.add(v.glsl(V||(V=r.__makeTemplateObject(["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "],["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "]))))),2===e.output&&(t.include(i.Transform,{linearDepth:!1}),t.include(c.NormalUtils,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("viewNormal","mat4"),t.vertex.code.add(v.glsl(F||(F=r.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal = getLocalUp(position, origin);\n          vec2 uv = uv0;\n          vpos = applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position = transformPosition(proj, view, vpos);\n          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "],["\n        void main(void) {\n          vec3 normal = getLocalUp(position, origin);\n          vec2 uv = uv0;\n          vpos = applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position = transformPosition(proj, view, vpos);\n          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "])))),t.fragment.code.add(v.glsl(N||(N=r.__makeTemplateObject(["\n        void main() {\n          vec3 normal = normalize(vnormal);\n          if (gl_FrontFacing == false) {\n            normal = -normal;\n          }\n          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "],["\n        void main() {\n          vec3 normal = normalize(vnormal);\n          if (gl_FrontFacing == false) {\n            normal = -normal;\n          }\n          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "]))))),4===e.output&&(t.include(i.Transform,{linearDepth:!1}),t.include(c.NormalUtils,e),t.include(u.Overlay,{pbrMode:0}),t.vertex.code.add(v.glsl(k||(k=r.__makeTemplateObject(["\n          void main() {\n            vec3 vnormal = getLocalUp(position, origin);\n            vec2 uv = uv0;\n            vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position = transformPosition(proj, view, vpos);\n          }\n      "],["\n          void main() {\n            vec3 vnormal = getLocalUp(position, origin);\n            vec2 uv = uv0;\n            vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position = transformPosition(proj, view, vpos);\n          }\n      "])))),t.include(s.OutputHighlight),t.fragment.code.add(v.glsl(z||(z=r.__makeTemplateObject(["\n        void main() {\n          vec4 overlayColor = getCombinedOverlayColor();\n\n          if (overlayColor.a == 0.0) {\n            gl_FragColor = vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "],["\n        void main() {\n          vec4 overlayColor = getCombinedOverlayColor();\n\n          if (overlayColor.a == 0.0) {\n            gl_FragColor = vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1240),r(1206),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.Overlay=function(e,t){3!==t.pbrMode&&4!==t.pbrMode||e.include(i.Water,t),e.vertex.uniforms.add("overlayTexOffset","vec4"),e.vertex.uniforms.add("overlayTexScale","vec4"),e.varyings.add("vtcOverlay","vec4"),e.vertex.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "],["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "])))),e.fragment.uniforms.add("ovInnerColorTex","sampler2D"),e.fragment.uniforms.add("ovOuterColorTex","sampler2D"),e.fragment.uniforms.add("overlayOpacity","float"),e.fragment.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color = vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 = texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 = texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x >= 0.0) && (texCoords.x <= 1.0) && (texCoords.y >= 0.0) && (texCoords.y <= 1.0)) {\n        color = color0;\n      } else if ((texCoords.z >= 0.0) && (texCoords.z <= 1.0) && (texCoords.w >= 0.0) && (texCoords.w <= 1.0)) {\n        color = color1;\n      }\n\n      return color;\n    }\n  "],["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color = vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 = texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 = texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x >= 0.0) && (texCoords.x <= 1.0) && (texCoords.y >= 0.0) && (texCoords.y <= 1.0)) {\n        color = color0;\n      } else if ((texCoords.z >= 0.0) && (texCoords.z <= 1.0) && (texCoords.w >= 0.0) && (texCoords.w <= 1.0)) {\n        color = color1;\n      }\n\n      return color;\n    }\n  "])))),e.fragment.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "],["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "])))),3!==t.pbrMode&&4!==t.pbrMode||(e.include(n.EvaluateMainLighting),e.fragment.code.add(o.glsl(c||(c=r.__makeTemplateObject(["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 => -1...1\n      // and project it to worldspace.\n      vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v = vposEyeDir;\n      vec3 l = normalize(-lightingMainDirection);\n      vec3 final = getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "],["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 => -1...1\n      // and project it to worldspace.\n      vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v = vposEyeDir;\n      vec3 l = normalize(-lightingMainDirection);\n      vec3 final = getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(946),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new o.ShaderBuilder;return t.include(n.ScreenSpacePass),t.fragment.uniforms.add("tex","sampler2D"),0===e.function&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      void main() {\n        gl_FragColor = texture2D(tex, uv) * opacity;\n      }"],["\n      void main() {\n        gl_FragColor = texture2D(tex, uv) * opacity;\n      }"]))))):t.fragment.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      void main() {\n        gl_FragColor = texture2D(tex, uv);\n      }"],["\n      void main() {\n        gl_FragColor = texture2D(tex, uv);\n      }"]))))),2===e.function&&t.fragment.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n    void main() {\n      gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);\n    }"],["\n    void main() {\n      gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);\n    }"])))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175),r(252)],void 0===(i=function(e,t,r,n,i){var o,a,s,l,c,u,p,d,h,f,v;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new i.ShaderBuilder,m=t.vertex.code,y=t.fragment.code;return t.attributes.add("position","vec2"),2===e.highlightStage&&(m.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    void main() {\n      gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"],["\n    void main() {\n      gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"])))),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("invFramebufferDim","vec2"),y.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      void main() {\n        vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n        vec4 value = texture2D(tex, coord);\n        float mx = floor(max(value.g, value.b));\n        gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n      }"],["\n      void main() {\n        vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n        vec4 value = texture2D(tex, coord);\n        float mx = floor(max(value.g, value.b));\n        gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n      }"]))))),0===e.highlightStage&&(t.attributes.add("uv0","vec2"),e.gridOptimization?(t.vertex.uniforms.add("coverageTex","sampler2D"),t.fragment.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinate","vec3")):(t.vertex.uniforms.add("blurSize","vec2"),t.varyings.add("blurCoordinates[5]","vec2")),m.add(n.glsl(c||(c=r.__makeTemplateObject(["\n    void main() {\n      gl_Position = vec4(position, 0.0, 1.0);\n      ","\n    }"],["\n    void main() {\n      gl_Position = vec4(position, 0.0, 1.0);\n      ","\n    }"])),e.gridOptimization?n.glsl(s||(s=r.__makeTemplateObject(["\n      vec4 cov = texture2D(coverageTex, uv0);\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0.0);\n      }\n      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "],["\n      vec4 cov = texture2D(coverageTex, uv0);\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0.0);\n      }\n      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "]))):n.glsl(l||(l=r.__makeTemplateObject(["\n      vec2 uv = position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n          "],["\n      vec2 uv = position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n          "]))))),t.fragment.uniforms.add("tex","sampler2D"),y.add(n.glsl(d||(d=r.__makeTemplateObject(["\n    void main() {\n      ","\n    }"],["\n    void main() {\n      ","\n    }"])),e.gridOptimization?n.glsl(u||(u=r.__makeTemplateObject(["\n          vec2 uv = blurCoordinate.xy;\n          vec4 center = texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z == 1.0) {\n            gl_FragColor = center;\n          } else {\n            vec4 sum = vec4(0.0);\n            sum += center * 0.204164;\n            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor = sum;\n          }"],["\n          vec2 uv = blurCoordinate.xy;\n          vec4 center = texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z == 1.0) {\n            gl_FragColor = center;\n          } else {\n            vec4 sum = vec4(0.0);\n            sum += center * 0.204164;\n            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor = sum;\n          }"]))):n.glsl(p||(p=r.__makeTemplateObject(["\n          vec4 sum = vec4(0.0);\n          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor = sum;"],["\n          vec4 sum = vec4(0.0);\n          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor = sum;"])))))),1===e.highlightStage&&(t.varyings.add("uv","vec2"),e.gridOptimization&&(t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("coverageTex","sampler2D")),m.add(n.glsl(f||(f=r.__makeTemplateObject(["\n      void main() {\n        ","\n        gl_Position = vec4(position, 0.0, 1.0);\n        uv = position.xy * 0.5 + vec2(0.5);\n      }"],["\n      void main() {\n        ","\n        gl_Position = vec4(position, 0.0, 1.0);\n        uv = position.xy * 0.5 + vec2(0.5);\n      }"])),e.gridOptimization?n.glsl(h||(h=r.__makeTemplateObject(["\n            vec4 cov = texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r == 0.0) {\n              gl_Position = vec4(0.0);\n              return;\n            }"],["\n            vec4 cov = texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r == 0.0) {\n              gl_Position = vec4(0.0);\n              return;\n            }"]))):"")),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("origin","sampler2D"),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("haloColor","vec4"),t.fragment.uniforms.add("outlineSize","float"),t.fragment.uniforms.add("blurSize","float"),t.fragment.uniforms.add("opacities","vec4"),y.add(n.glsl(v||(v=r.__makeTemplateObject(["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue = texture2D(tex, uv);\n        float highlightIntensity = blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity == 0.0) {\n          discard;\n        }\n\n        vec4 origin_color = texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g > blurredHighlightValue.b) {\n          outlineIntensity = haloColor.w * opacities[1];\n          fillIntensity = color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity = haloColor.w * opacities[0];\n          fillIntensity = color.w * opacities[2];\n        }\n\n        float inner = 1.0 - outlineSize / 9.0;\n        float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"],["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue = texture2D(tex, uv);\n        float highlightIntensity = blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity == 0.0) {\n          discard;\n        }\n\n        vec4 origin_color = texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g > blurredHighlightValue.b) {\n          outlineIntensity = haloColor.w * opacities[1];\n          fillIntensity = color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity = haloColor.w * opacities[0];\n          fillIntensity = color.w * opacities[2];\n        }\n\n        float inner = 1.0 - outlineSize / 9.0;\n        float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(946),r(932),r(1869),r(175),r(252)],void 0===(i=function(e,t,r,n,i,o,a,s){var l,c,u,p,d,h;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(n.ScreenSpacePass),1===e.output&&(t.include(i.ReadLinearDepth),t.fragment.code.add(a.glsl(l||(l=r.__makeTemplateObject(["\n      #ifndef RADIUS\n        #define RADIUS "],["\n      #ifndef RADIUS\n        #define RADIUS "])))+e.radius+"\n      #endif\n    "),t.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),t.fragment.code.add(a.glsl(c||(c=r.__makeTemplateObject(["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c = texture2D(tex, uv).r;\n        float d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff = d - center_d;\n\n        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total += w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b = 0.0;\n        float w_total = 0.0;\n\n        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r = -RADIUS; r <= RADIUS; ++r) {\n          float rf = float(r);\n          vec2 uvOffset = uv + rf*blurSize;\n          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor = vec4(b/w_total);\n      }\n    "],["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c = texture2D(tex, uv).r;\n        float d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff = d - center_d;\n\n        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total += w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b = 0.0;\n        float w_total = 0.0;\n\n        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r = -RADIUS; r <= RADIUS; ++r) {\n          float rf = float(r);\n          vec2 uvOffset = uv + rf*blurSize;\n          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor = vec4(b/w_total);\n      }\n    "]))))),0===e.output&&(t.include(i.ReadLinearDepth),t.include(o.CameraSpace),t.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),t.fragment.code.add(a.glsl(u||(u=r.__makeTemplateObject(["\n      #ifndef SAMPLES\n        #define SAMPLES "],["\n      #ifndef SAMPLES\n        #define SAMPLES "])))+e.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),t.fragment.code.add(a.glsl(p||(p=r.__makeTemplateObject(["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 = radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n      }\n    "],["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 = radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n      }\n    "])))),t.fragment.code.add(a.glsl(d||(d=r.__makeTemplateObject(["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v = Q - C;\n        float vv = dot(v, v);\n        float vn = dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "],["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v = Q - C;\n        float vv = dot(v, v);\n        float vn = dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "])))),t.fragment.code.add(a.glsl(h||(h=r.__makeTemplateObject(["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n        //ivec2 ssC = ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n          gl_FragColor = vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 = texture2D(normalMap, uv);\n        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain = norm4.w<0.5;\n\n        float sum = .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i = 0; i < SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset = reflect(pSphere[i], fres).xy;\n          vec2 offset = vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n          vec2 tc = vec2(gl_FragCoord.xy + offset);\n          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n          vec2 tcTap = tc/screenDimensions;\n          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A = max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor = vec4(tapPixelPos.x/100.0);\n        gl_FragColor = vec4(A);\n      }\n    "],["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n        //ivec2 ssC = ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n          gl_FragColor = vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 = texture2D(normalMap, uv);\n        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain = norm4.w<0.5;\n\n        float sum = .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i = 0; i < SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset = reflect(pSphere[i], fres).xy;\n          vec2 offset = vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n          vec2 tc = vec2(gl_FragCoord.xy + offset);\n          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n          vec2 tcTap = tc/screenDimensions;\n          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A = max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor = vec4(tapPixelPos.x/100.0);\n        gl_FragColor = vec4(A);\n      }\n    "]))))),t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,n=-e[0],i=-e[1],o=-e[2],a=r[3],s=r[7],l=r[11],c=r[15];r[0]+=a*n,r[1]+=a*i,r[2]+=a*o,r[4]+=s*n,r[5]+=s*i,r[6]+=s*o,r[8]+=l*n,r[9]+=l*i,r[10]+=l*o,r[12]+=c*n,r[13]+=c*i,r[14]+=c*o},t.applyToViewMatrix=function(e,t){var r=t,n=e[0],i=e[1],o=e[2];r[12]+=n*r[0]+i*r[4]+o*r[8],r[13]+=n*r[1]+i*r[5]+o*r[9],r[14]+=n*r[2]+i*r[6]+o*r[10],r[14]+=n*r[3]+i*r[7]+o*r[11]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(854),r(162),r(160),r(371),r(964)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.prototype.updateSettings=function(e){this.settings=e},e.prototype.write=function(e,t,r){var n=function(e){var t=l;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],u[0]=5381;for(var r=0;r<c.length;r++)u[0]=31*u[0]+c[r];return u[0]}(r);p.seed=n;var i,o,a=p.getIntRange(0,255),s=p.getIntRange(0,this.settings.variants-1),d=p.getFloat(),h=255*(.5*(1.2,o=(i=-(1-Math.min(d/.7,1))+Math.max(0,d-.7)/(1-.7))<0?-1:1,Math.pow(Math.abs(i),1.2)*o)+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,a),e.variantStroke.set(t,s),e.variantExtension.set(t,h)},e.prototype.trim=function(e,t){return e.slice(0,t)},e}();t.CommonBufferWriter=s;var l=new Float32Array(6),c=new Uint32Array(l.buffer),u=new Uint32Array(1),p=new r,d=function(){function e(){this.commonWriter=new s}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return a.RegularEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r),n.vec3.add(f,r.faceNormal0,r.faceNormal1),n.vec3.normalize(f,f),e.normal.setVec(t,f)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=a.RegularEdgeInstancesLayout,e.glLayout=o.glLayout(a.RegularEdgeInstancesLayout,{divisor:1}),e}();t.RegularEdgeBufferWriter=d;var h=function(){function e(){this.commonWriter=new s}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return a.SilhouetteEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r),e.normalA.setVec(t,r.faceNormal0),e.normalB.setVec(t,r.faceNormal1)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=a.SilhouetteEdgeInstancesLayout,e.glLayout=o.glLayout(a.SilhouetteEdgeInstancesLayout,{divisor:1}),e}();t.SilhouetteEdgeBufferWriter=h;var f=i.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(120),r(1214),r(1872),r(1873),r(964),r(1294),r(1874)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(){function e(){this.regularWriter=new l.RegularEdgeBufferWriter,this.silhouetteWriter=new l.SilhouetteEdgeBufferWriter}return e.prototype.process=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return t?(n=new Array,i=this.packInput(e,n),[4,t.invoke("wrappedWork",i,{transferList:n})]):[3,2];case 1:return o=r.sent(),[2,this.unpackOutput(o)];case 2:return[2,this.work(e)]}}))}))},e.prototype.wrappedWork=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){return t=this.unpackInput(e),n=this.work(t),i=new Array,this.packInputTransferables(t,i),[2,{result:this.packOutput(n,i),transferList:i}]}))}))},e.prototype.work=function(e){var t=this.extractEdgeInformation(e.data,e.skipDeduplicate,e.originalIndices);return this.regularWriter.updateSettings(e.writerSettings),this.silhouetteWriter.updateSettings(e.writerSettings),c.extractEdges(t,this.regularWriter,this.silhouetteWriter)},e.prototype.packInputTransferables=function(e,t){t.push(e.data.buffer)},e.prototype.packInput=function(e,t){this.packInputTransferables(e,t);var r={dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate};return e.originalIndices&&(r.originalIndicesBuffer=e.originalIndices.buffer,r.originalIndicesType=n.isUint32Array(e.originalIndices)?"Uint32Array":"Uint16Array"),r},e.prototype.unpackInput=function(e){return{data:s.EdgeInputBufferLayout.createView(e.dataBuffer),originalIndices:"Uint32Array"===e.originalIndicesType?new Uint32Array(e.originalIndicesBuffer):"Uint16Array"===e.originalIndicesType?new Uint16Array(e.originalIndicesBuffer):void 0,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}},e.prototype.packOutput=function(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:a.packInterleavedBuffer(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:a.packInterleavedBuffer(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}},e.prototype.unpackOutput=function(e){return{regular:{instancesData:a.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:a.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}},e.prototype.extractEdgeInformation=function(e,t,r){if(t&&r)return{faces:r,neighbors:a=o.computeNeighbors(r,e.count),vertices:e};var n=i.default(e.buffer,e.stride/4,{originalIndices:r}),a=o.computeNeighbors(n.indices,n.uniqueCount);return{faces:n.indices,neighbors:a,vertices:s.EdgeInputBufferLayout.createView(n.buffer)}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(175),r(252),r(1877),r(1879),r(1880),r(1881),r(820),r(1882),r(1883),r(965)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f,v,m,y;Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLocations={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9},t.build=function(e){var t=new o.ShaderBuilder,g=t.vertex,_=t.fragment;return e.legacy&&g.uniforms.add("uModel","mat4"),e.antialiasing&&(g.code.add(i.glsl(f||(f=r.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))),_.code.add(i.glsl(v||(v=r.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "]))))),t.include(a.AdjustProjectedPosition,e),t.include(p.LineAmplitude,e),t.include(u.EdgeUtil,e),t.include(h.UnpackAttributes,e),t.include(d.LineOffset,e),t.include(n.Slice,e),t.include(l.DiscardNonSilhouetteEdges,e),t.include(s.DiscardByCoverage,e),t.include(c.DiscardShortEdges,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),g.uniforms.add("uPixelToNDC","vec2"),g.uniforms.add("uNDCToPixel","vec2"),g.uniforms.add("uPixelRatio","float"),t.attributes.add("position0","vec3"),t.attributes.add("position1","vec3"),t.attributes.add("variantOffset","float"),t.attributes.add("variantStroke","float"),t.attributes.add("variantExtension","float"),g.code.add(i.glsl(m||(m=r.__makeTemplateObject(["\n    const float opaqueCutoff = 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness = unpackedAttributes.sideness;\n      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 = projFromViewPosition(viewPosV0);\n      vec4 projPosV1 = projFromViewPosition(viewPosV1);\n      vec4 projPos = projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels = length(screenSpaceLinePixels);\n\n      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor = falloffFactor;\n\n      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels = 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper <1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset = (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy += ndcOffset * projPos.w;\n      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition = vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius = lineWidthPixels * 0.5;\n      vLineLengthPixels = extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position = projPos;\n    }\n\n    void main() {\n      ComponentData component = readComponentData();\n      UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n      vec3 worldPosV0 = worldFromModelPosition(position0);\n      vec3 worldPosV1 = worldFromModelPosition(position1);\n      vec3 viewPosV0 = viewFromModelPosition(position0);\n      vec3 viewPosV1 = viewFromModelPosition(position1);\n\n      // Component color\n      vColor = component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a < opaqueCutoff) {\n        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "],["\n    const float opaqueCutoff = 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness = unpackedAttributes.sideness;\n      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 = projFromViewPosition(viewPosV0);\n      vec4 projPosV1 = projFromViewPosition(viewPosV1);\n      vec4 projPos = projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels = length(screenSpaceLinePixels);\n\n      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor = falloffFactor;\n\n      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels = 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper <1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset = (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy += ndcOffset * projPos.w;\n      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition = vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius = lineWidthPixels * 0.5;\n      vLineLengthPixels = extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position = projPos;\n    }\n\n    void main() {\n      ComponentData component = readComponentData();\n      UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n      vec3 worldPosV0 = worldFromModelPosition(position0);\n      vec3 worldPosV1 = worldFromModelPosition(position1);\n      vec3 viewPosV0 = viewFromModelPosition(position0);\n      vec3 viewPosV1 = viewFromModelPosition(position1);\n\n      // Component color\n      vColor = component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a < opaqueCutoff) {\n        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "])))),t.fragment.code.add(i.glsl(y||(y=r.__makeTemplateObject(["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset = calculateLineOffset();\n      float positionX = position.x - lineOffset;\n\n      if (radius < 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage = min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition = vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius = vRadius * calculateLinePressure();\n\n      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha = vColor.a * coverage;\n\n      gl_FragColor = vec4(vColor.rgb, alpha);\n\n    }\n  "],["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset = calculateLineOffset();\n      float positionX = position.x - lineOffset;\n\n      if (radius < 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage = min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition = vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius = vRadius * calculateLinePressure();\n\n      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha = vColor.a * coverage;\n\n      gl_FragColor = vec4(vColor.rgb, alpha);\n\n    }\n  "])))),t}}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,i,o=r(122),a=r(123);function s(e){e&&e.isActive&&e.callback&&e.callback()}function l(e,t){return{destroy:function(){this.destroy=function(){},e.isActive=!1,e.callback=null,t&&t()}}}if(t.queueTask=function(){var t,r;if(a.default("postmessage")){var i=[];o.default.addEventListener("message",(function(e){e.source===o.default&&"dojo-queue-message"===e.data&&(e.stopPropagation(),i.length&&s(i.shift()))})),r=function(e){i.push(e),o.default.postMessage("dojo-queue-message","*")}}else a.default("setimmediate")?(t=o.default.clearImmediate,r=function(t){return e(s.bind(null,t))}):(t=o.default.clearTimeout,r=function(e){return setTimeout(s.bind(null,e),0)});function c(e){var n={isActive:!0,callback:e},i=r(n);return l(n,t&&function(){t(i)})}return a.default("microtasks")?c:function(e){return n(),c(e)}}(),!a.default("microtasks")){var c=!1;i=[],n=function(){c||(c=!0,t.queueTask((function(){if(c=!1,i.length)for(var e=void 0;e=i.shift();)s(e)})))}}t.queueAnimationTask=function(){if(!a.default("raf"))return t.queueTask;function e(e){var t={isActive:!0,callback:e},r=requestAnimationFrame(s.bind(null,t));return l(t,(function(){cancelAnimationFrame(r)}))}return a.default("microtasks")?e:function(t){return n(),e(t)}}(),t.queueMicroTask=function(){var e;if(a.default("host-node"))e=function(e){o.default.process.nextTick(s.bind(null,e))};else if(a.default("es6-promise"))e=function(e){o.default.Promise.resolve(e).then(s)};else if(a.default("dom-mutationobserver")){var t=o.default.MutationObserver||o.default.WebKitMutationObserver,r=document.createElement("div"),c=[];new t((function(){for(;c.length>0;){var e=c.shift();e&&e.isActive&&e.callback&&e.callback()}})).observe(r,{attributes:!0}),e=function(e){c.push(e),r.setAttribute("queueStatus","1")}}else e=function(e){n(),i.push(e)};return function(t){var r={isActive:!0,callback:t};return e(r),l(r)}}()}).call(this,r(1090).setImmediate)},function(e,t){!function(e,t){"use strict";if(!e.setImmediate){var r,n,i,o,a,s=1,l={},c=!1,u=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?r=function(e){process.nextTick((function(){h(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){h(e.data)},r=function(e){i.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(n=u.documentElement,r=function(e){var t=u.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):r=function(e){setTimeout(h,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&h(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),r=function(t){e.postMessage(o+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return l[s]=i,r(s),s++},p.clearImmediate=d}function d(e){delete l[e]}function h(e){if(c)setTimeout(h,0,e);else{var t=l[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{d(e),c=!1}}}}}("undefined"==typeof self?"undefined"==typeof global?this:global:self)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(515)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.aliasOf=function(e,t){var i=t?r.__assign(r.__assign({},t),{source:e}):e;return n.property({aliasOf:i})}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(615)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.autoDestroy=function(){return function(e,t){return r.getOwnClassMetadata(e).autoDestroy=!0,e[t]}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(335),r(164),r(156)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.declared=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(t.length>0)throw new Error("Multi-inheritance unsupported since 4.16");return n("esri-deprecation-warnings")&&r.deprecated(i.getLogger("esri.core.accessorSupport.decorators"),"'extends declared(superclass)' syntax",{version:"4.16",see:"https://arcg.is/T8fr4"}),e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(515)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.enumeration=function(e,t){void 0===t&&(t={ignoreUnknown:!0});var i=e instanceof r.JSONMap?e:new r.JSONMap(e,t);return n.property({type:t&&t.ignoreUnknown?i.apiValues:String,json:{type:i.jsonValues,read:{reader:i.read},write:{writer:i.write}}})}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shared=function(e){return function(t,r){t[r]=e}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(156),r(322),r(851)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=r("esri-debug-messages"),s=n.getLogger("esri.core.accessorSupport.extensions.computedProperty");t.ComputedPropertyExtension={processClassPropertyMetadata:function(e,t,r,n){if(a){var l=t.dependsOn;l&&l.length&&l.map((function(e){return e.split(".")[0]})).forEach((function(t){"?"!==t[t.length-1]&&null==r[t]&&s.error("[accessor] class '"+n+"' - property '"+e+"' depends on unknown property '"+t+"' which hasn't been found during introspection. This can be fix by adding '"+t+"' to the metadata for example.")}))}t.dependsOn&&t.dependsOn.length&&(t.wire=o.create(t.dependsOn,(function(t){return i.getProperties(t).propertyInvalidated(e)})))},instanceCreated:function(e,t,r){for(var n=0,i=r;n<i.length;n++){var o=t[i[n]];o.wire&&o.wire(e)}}},t.default=t.ComputedPropertyExtension}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.process=function(e){if(e.json&&e.json.origins){var t=e.json.origins,r={"web-document":["web-scene","web-map"]},n=function(e){if(t[e]){var n=t[e];r[e].forEach((function(e){t[e]=n})),delete t[e]}};for(var i in r)n(i)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(119),r(1094)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function a(e){return e.prototype.read?function(t,r,n){if(null==t)return t;var i=typeof t;if("object"===i){var a=new e;return a.read(t,n),a}o.error("Expected JSON value of type 'object' to deserialize type '"+e.prototype.declaredClass+"', but got '"+i+"'")}:e.fromJSON}function s(e,t,r,n){return 0!==n&&Array.isArray(t)?t.map((function(t){return s(e,t,r,n-1)})):e(t,null,r)}function l(e){var t=a(e);return function(e,r,n){return null==e?e:Array.isArray(e)?e.map((function(e){return t(e,null,n)})):[t(e,null,n)]}}function c(e){if(!i.isCollection(e))return!1;var t=e.prototype.itemType;return!(!t||!t.Type||"function"!=typeof t.Type)&&u(t.Type)}function u(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||c(e))}t.create=function(e,t,r,i){i.read&&(i.read.reader||!1===i.read.enabled)||u(e)&&n.setDeepValue("read.reader",function(e,t){if(t>1)return function(e,t){var r=a(e),n=s.bind(null,r);return function(e,r,i){if(null==e)return e;e=n(e,i,t);for(var o=t,a=e;o>0&&Array.isArray(a);)o--,a=a[0];if(void 0!==a)for(var s=0;s<o;s++)e=[e];return e}}(e,t);if(1===t)return l(e);if(c(e)){var r=l(e.prototype.itemType.Type);return function(t,n,i){var o=r(t,n,i);return o?new e(o):o}}return a(e)}(e,t),i)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function n(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function i(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.process=function(e){if(e.json||(e.json={}),n(e.json),i(e.json),r(e.json),e.json.origins)for(var t in e.json.origins)n(e.json.origins[t]),i(e.json.origins[t]),r(e.json.origins[t]);return!0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.buildDate="20200709",t.commitHash="b1935fbcb8db599690a19d373645c8e761819998"}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(122),i=r(123),o=r(296);t.ShimAbortSignal=n.default.AbortSignal,i.default("abort-signal")||(n.default.AbortSignal=t.ShimAbortSignal=function(){function e(){this._aborted=!1,this.listeners={}}return Object.defineProperty(e.prototype,"aborted",{get:function(){return this._aborted},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.removeEventListener=function(e,t){if(e in this.listeners){var r=o.findIndex(this.listeners[e],(function(e){return e===t}));r>=0&&this.listeners[e].splice(r,1)}},e.prototype.dispatchEvent=function(e){var t=this,r=e.type;return"abort"===r&&(this._aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),r in this.listeners&&(this.listeners[r].forEach((function(r){setTimeout((function(){return r.call(t,e)}),0)})),!e.preventDefault)},e}()),t.ShimAbortController=n.default.AbortController,i.default("abort-controller")||(n.default.AbortController=t.ShimAbortController=function(){function e(){this.signal=new t.ShimAbortSignal}return e.prototype.abort=function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?(e=document.createEvent("Event")).initEvent("abort",!1,!1):e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)},e}()),t.default=t.ShimAbortController},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164),r(118),r(156),r(230),r(1093),r(475),r(1420)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=i.getLogger("esri.core.accessorSupport.Properties");function u(e,t){return!!t.metadatas[e]||(r("esri-debug-messages")&&c.warn("cannot access unknown property '"+e+"' on instance of "+t.host.declaredClass+"."),!1)}function p(e,t,n,i){return!e.nonNullable||null!=n||(0!==i.host.__accessor__.lifecycle&&r("esri-debug-messages")&&c.warn("cannot set non-nullable property '"+t+"' to null on "+i.host.declaredClass+"."),!1)}var d=function(){function e(e){this.host=e,this._origin=6,this.cursors=null,this.ctorArgs=null,this.destroyed=!1,this.dirties={},this.lifecycle=0,this.overridden=null,this.store=new l.Store;var t=this.host.constructor.__accessorMetadata__;this.metadatas=t.properties,this.autoDestroy=t.autoDestroy}return e.prototype.initialize=function(){this.lifecycle=1,a.instanceCreated(this.host,this.metadatas)},e.prototype.constructed=function(){this.lifecycle=2},e.prototype.destroy=function(){this.destroyed=!0;var e,t=this.cursors;if(t)for(var r=0,n=Object.getOwnPropertyNames(t);r<n.length;r++){var i=t[o=n[r]];if(i){for(;i.length>0;)i.pop().propertyDestroyed(this,o);t[o]=null}}if(this.autoDestroy)for(var o in this.metadatas){var a=this.internalGet(o);a&&(e=a)&&"function"==typeof e.destroy&&(a.destroy(),this.metadatas[o].nonNullable||this.internalSet(o,null))}},Object.defineProperty(e.prototype,"initialized",{get:function(){return 0!==this.lifecycle},enumerable:!0,configurable:!0}),e.prototype.clearOverride=function(e){this.isOverridden(e)&&(this.overridden[e]=!1,this.propertyInvalidated(e))},e.prototype.get=function(e){u(e,this);var t=this.metadatas[e],r=t.get;if(this.store.has(e)&&(!r||!this.dirties[e]))return this.store.get(e);if(r){var n=r.call(this.host);return this.store.set(e,n,1),this.propertyCommitted(e),n}return t.value},e.prototype.getterStatic=function(e,t){return this.store.has(e)?this.store.get(e):t.value},e.prototype.getterComputed=function(e,t){if(this.store.has(e)&&!this.dirties[e])return this.store.get(e);var r=t.get.call(this.host);return this.store.set(e,r,1),this.propertyCommitted(e),r},e.prototype.originOf=function(e){var t=this.store.originOf(e);if(void 0===t){var r=this.metadatas[e];if(r&&r.hasOwnProperty("value"))return"defaults"}return s.idToName(t)},e.prototype.has=function(e){return!!this.metadatas[e]&&this.store.has(e)},e.prototype.internalGet=function(e){if(u(e,this)){var t=this.store;return t.has(e)?t.get(e):this.metadatas[e].value}},e.prototype.internalSet=function(e,t){return this.setAtOrigin(e,t,this.initialized?this._origin:0)},e.prototype.setAtOrigin=function(e,t,r){if(u(e,this)){var i=this.store.get(e);(!n.equals(t,i)||r!==this.store.originOf(e)||!this.store.has(e,r)||this.isOverridden(e))&&(this.propertyInvalidated(e),this.store.set(e,t,r),this.propertyCommitted(e))}},e.prototype.isOverridden=function(e){return null!=this.overridden&&!0===this.overridden[e]},e.prototype.keys=function(){return Object.keys(this.metadatas)},e.prototype.override=function(e,t){if(u(e,this)){this.overridden||(this.overridden={});var r=this.metadatas[e];if(p(r,e,t,this)){var n=r.cast;if(n){var i=this.cast(n,t),o=i.valid,a=i.value;if(h.release(i),!o)return;t=a}this.overridden[e]=!0,this.internalSet(e,t)}}},e.prototype.set=function(e,t){if(u(e,this)){var r=this.metadatas[e];if(p(r,e,t,this)){var n=r.set,i=r.cast;if(i){var o=this.cast(i,t),a=o.valid,s=o.value;if(h.release(o),!a)return;t=s}n?n.call(this.host,t):this.internalSet(e,t)}}},e.prototype.setDefaultOrigin=function(e){this._origin=s.nameToId(e)},e.prototype.getDefaultOrigin=function(){return s.idToName(this._origin)},e.prototype.propertyInvalidated=function(e){var t=this.dirties;this.isOverridden(e)||(t[e]=!0);var r=this.cursors&&this.cursors[e];if(r)for(var n=0,i=r;n<i.length;n++)i[n].propertyInvalidated(this,e)},e.prototype.propertyCommitted=function(e){var t=this.cursors&&this.cursors[e];if(this.dirties[e]=!1,t)for(var r=0,n=t;r<n.length;r++)n[r].propertyCommitted(this,e)},e.prototype.addCursor=function(e,t){this.cursors||(this.cursors={});var r=this.cursors[e];r||(this.cursors[e]=r=[]),r.push(t)},e.prototype.removeCursor=function(e,t){var r=this.cursors[e];this.cursors[e]&&(r.splice(r.indexOf(t),1),0===r.length&&(this.cursors[e]=null))},e.prototype.cast=function(e,t){var r=h.acquire();return r.valid=!0,r.value=t,e&&(r.value=e.call(this.host,t,r)),r},e}(),h=new o(function(){function e(){this.value=null,this.valid=!0}return e.prototype.acquire=function(){this.valid=!0},e.prototype.release=function(){this.value=null},e}());t.default=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(118)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._values=new Map}return e.prototype.clone=function(t){var r=new e;return this._values.forEach((function(e,i){t&&t.has(i)||r.set(i,n.clone(e))})),r},e.prototype.get=function(e){return this._values.get(e)},e.prototype.originOf=function(){return 6},e.prototype.keys=function(){return r.keysOfMap(this._values)},e.prototype.set=function(e,t){this._values.set(e,t)},e.prototype.delete=function(e){this._values.delete(e)},e.prototype.has=function(e){return this._values.has(e)},e.prototype.forEach=function(e){this._values.forEach(e)},e}();t.Store=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.interceptor=null}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){var n;return function(e){function t(e,t,r,n){for(var i=t,o=t,a=r>>>1,s=e[i-1];o<=a;){(o=i<<1)<r&&n(e[o-1],e[o])<0&&++o;var l=e[o-1];if(n(l,s)<=0)break;e[i-1]=l,i=o}e[i-1]=s}function n(e,t){return e<t?-1:e>t?1:0}e.sort=function(e,r,i,o){void 0===r&&(r=0),void 0===i&&(i=e.length),void 0===o&&(o=n);for(var a=i>>>1;a>r;a--)t(e,a,i,o);var s=r+1;for(a=i-1;a>r;a--){var l=e[r];e[r]=e[a],e[a]=l,t(e,s,a,o)}},e.iterableSort=function(e,i,o,a){var s,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:void 0===i&&(i=0),void 0===o&&(o=e.length),void 0===a&&(a=n),l=o>>>1,r.label=1;case 1:return l>i?(t(e,l,o,a),[4]):[3,4];case 2:r.sent(),r.label=3;case 3:return l--,[3,1];case 4:s=i+1,l=o-1,r.label=5;case 5:return l>i?(c=e[i],e[i]=e[l],e[l]=c,t(e,s,l,a),[4]):[3,8];case 6:r.sent(),r.label=7;case 7:return l--,[3,5];case 8:return[2]}}))}}(n||(n={})),n}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(576)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="http://www.w3.org/2000/svg",i=[];t.extend=function(e,t){var r={};return Object.keys(e).forEach((function(t){r[t]=e[t]})),t&&Object.keys(t).forEach((function(e){r[e]=t[e]})),r};var o,a=function(e,t){return e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties)},s=function(e){if("string"!=typeof e)throw new Error("Style values must be strings")},l=function(e,t,r){if(""!==t.vnodeSelector)for(var n=r;n<e.length;n++)if(a(e[n],t))return n;return-1},c=function(e,t,r,n){var i=e[t];if(""!==i.vnodeSelector){var o=i.properties;if(!(o?void 0===o.key?o.bind:o.key:void 0))for(var s=0;s<e.length;s++)if(s!==t){var l=e[s];if(a(l,i))throw new Error(r.vnodeSelector+" had a "+i.vnodeSelector+" child "+("added"===n?n:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.")}}},u=function(e){if(e.properties){var t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},p=[],d=!1,h=function(e){(e.children||[]).forEach(h),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},f=function(){d=!1,p.forEach(h),p.length=0},v=function(e){p.push(e),d||(d=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(f,{timeout:16}):setTimeout(f,16))},m=function(e){var t=e.domNode;if(e.properties){var r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,(function(){t.parentNode&&(t.parentNode.removeChild(t),v(e))}),e.properties)}t.parentNode&&(t.parentNode.removeChild(t),v(e))};t.initPropertiesAndChildren=function(e,i,o){!function(e,r,n){if(r)for(var i=0,o=r;i<o.length;i++){var a=o[i];t.createDom(a,e,void 0,n)}}(e,i.children,o),i.text&&(e.textContent=i.text),function(e,t,i){if(t)for(var o=i.eventHandlerInterceptor,a=Object.keys(t),l=a.length,c=function(l){var c,u=a[l],p=t[u];if("className"===u)throw new Error('Property "className" is not supported, use "class".');if("class"===u)y(e,p,!0);else if("classes"===u)for(var d=Object.keys(p),h=d.length,f=0;f<h;f++){var v=d[f];p[v]&&e.classList.add(v)}else if("styles"===u){var m=Object.keys(p),g=m.length;for(f=0;f<g;f++){var _=m[f],b=p[_];b&&(s(b),i.styleApplyer(e,_,b))}}else if("key"!==u&&null!=p){var x=typeof p;"function"===x?0===u.lastIndexOf("on",0)&&(o&&(p=o(u,p,e,t)),"oninput"===u&&(c=p,p=function(e){c.apply(this,[e]),e.target["oninput-value"]=e.target.value}),e[u]=p):i.namespace===n?"href"===u?e.setAttributeNS("http://www.w3.org/1999/xlink",u,p):e.setAttribute(u,p):"string"===x&&"value"!==u?"innerHTML"===u?e[u]=r.renderingSanitizer.sanitize(p):e.setAttribute(u,p):e[u]=p}},u=0;u<l;u++)c(u)}(e,i.properties,o),i.properties&&i.properties.afterCreate&&i.properties.afterCreate.apply(i.properties.bind||i.properties,[e,o,i.vnodeSelector,i.properties,i.children])},t.createDom=function(e,r,i,o){var a,s=0,l=e.vnodeSelector,c=r.ownerDocument;if(""===l)a=e.domNode=c.createTextNode(e.text),void 0!==i?r.insertBefore(a,i):r.appendChild(a);else{for(var u=0;u<=l.length;++u){var p=l.charAt(u);if(u===l.length||"."===p||"#"===p){var d=l.charAt(s-1),h=l.slice(s,u);"."===d?a.classList.add(h):"#"===d?a.id=h:("svg"===h&&(o=t.extend(o,{namespace:n})),void 0!==o.namespace?a=e.domNode=c.createElementNS(o.namespace,h):(a=e.domNode=e.domNode||c.createElement(h),"input"===h&&e.properties&&void 0!==e.properties.type&&a.setAttribute("type",e.properties.type)),void 0!==i?r.insertBefore(a,i):a.parentNode!==r&&r.appendChild(a)),s=u+1}}t.initPropertiesAndChildren(a,e,o)}};var y=function(e,t,r){t&&t.split(" ").forEach((function(t){t&&e.classList.toggle(t,r)}))};o=function(e,p,d){var h=e.domNode,f=!1;if(e===p)return!1;var v=!1;if(""===p.vnodeSelector){if(p.text!==e.text){var g=h.ownerDocument.createTextNode(p.text);return h.parentNode.replaceChild(g,h),p.domNode=g,!0}p.domNode=h}else 0===p.vnodeSelector.lastIndexOf("svg",0)&&(d=t.extend(d,{namespace:n})),e.text!==p.text&&(v=!0,void 0===p.text?h.removeChild(h.firstChild):h.textContent=p.text),p.domNode=h,v=function(e,r,n,s,p){if(n===s)return!1;s=s||i;for(var d,h=(n=n||i).length,f=s.length,v=0,y=0,g=!1;y<f;){var _=v<h?n[v]:void 0,b=s[y];if(void 0!==_&&a(_,b))g=o(_,b,p)||g,v++;else{var x=l(n,b,v+1);if(x>=0){for(d=v;d<x;d++)m(n[d]),c(n,d,e,"removed");g=o(n[x],b,p)||g,v=x+1}else t.createDom(b,r,v<h?n[v].domNode:void 0,p),u(b),c(s,y,e,"added")}y++}if(h>v)for(d=v;d<h;d++)m(n[d]),c(n,d,e,"removed");return g}(p,h,e.children,p.children,d)||v,v=function(e,t,i,o){if(i){for(var a=!1,l=Object.keys(i),c=l.length,u=0;u<c;u++){var p=l[u],d=i[p],h=t[p];if("class"===p)h!==d&&(y(e,h,!1),y(e,d,!0));else if("classes"===p)for(var f=e.classList,v=Object.keys(d),m=v.length,g=0;g<m;g++){var _=v[g],b=!!d[_];b!==!!h[_]&&(a=!0,b?f.add(_):f.remove(_))}else if("styles"===p){var x=Object.keys(d),w=x.length;for(g=0;g<w;g++){var S=x[g],P=d[S];P!==h[S]&&(a=!0,P?(s(P),o.styleApplyer(e,S,P)):o.styleApplyer(e,S,""))}}else if(d||"string"!=typeof h||(d=""),"value"===p){var T=e[p];T!==d&&(e["oninput-value"]?T===e["oninput-value"]:d!==h)&&(e[p]=d,e["oninput-value"]=void 0),d!==h&&(a=!0)}else if(d!==h){var O=typeof d;"function"===O&&o.eventHandlerInterceptor||(o.namespace===n?"href"===p?e.setAttributeNS("http://www.w3.org/1999/xlink",p,d):e.setAttribute(p,d):"string"===O?"innerHTML"===p?e[p]=r.renderingSanitizer.sanitize(d):"role"===p&&""===d?e.removeAttribute(p):e.setAttribute(p,d):e[p]!==d&&(e[p]=d),a=!0)}}return a}}(h,e.properties,p.properties,d)||v,p.properties&&p.properties.afterUpdate&&p.properties.afterUpdate.apply(p.properties.bind||p.properties,[h,d,p.vnodeSelector,p.properties,p.children]);return v&&p.properties&&p.properties.updateAnimation&&p.properties.updateAnimation(h,p.properties,e.properties),f},t.createProjection=function(e,t){return{getLastRender:function(){return e},update:function(r){if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");var n=e;e=r,o(n,r,t)},domNode:e.domNode}}}.apply(null,n))||(e.exports=i)},function(e,t,r){
/*!
 * @esri/arcgis-html-sanitizer - v2.2.0 - Tue Feb 04 2020 10:47:20 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2020 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 *
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */
e.exports=function(){"use strict";var e,t,r=Function.prototype,n=Object.prototype,i=r.toString,o=n.hasOwnProperty,a=i.call(Object),s=n.toString,l=(e=Object.getPrototypeOf,t=Object,function(r){return e(t(r))}),c=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=s.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=l(e);if(null===t)return!0;var r=o.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==a};function u(e,t){return e(t={exports:{}},t.exports),t.exports}var p=/javascript\s*\:/gim,d={whiteList:{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},getDefaultWhiteList:function(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}},onAttr:function(e,t,r){},onIgnoreAttr:function(e,t,r){},safeAttrValue:function(e,t){return p.test(t)?"":t}},h=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")};function f(e){return null==e}function v(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).whiteList=e.whiteList||d.whiteList,e.onAttr=e.onAttr||d.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||d.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||d.safeAttrValue,this.options=e}v.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,n=t.onAttr,i=t.onIgnoreAttr,o=t.safeAttrValue;return function(e,t){";"!==(e=function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}(e))[e.length-1]&&(e+=";");var r=e.length,n=!1,i=0,o=0,a="";function s(){if(!n){var r=h(e.slice(i,o)),s=r.indexOf(":");if(-1!==s){var l=h(r.slice(0,s)),c=h(r.slice(s+1));if(l){var u=t(i,a.length,l,c,r);u&&(a+=u+"; ")}}}i=o+1}for(;o<r;o++){var l=e[o];if("/"===l&&"*"===e[o+1]){var c=e.indexOf("*/",o+2);if(-1===c)break;i=(o=c+1)+1,n=!1}else"("===l?n=!0:")"===l?n=!1:";"===l?n||s():"\n"===l&&s()}return h(a)}(e,(function(e,t,a,s,l){var c=r[a],u=!1;if(!0===c?u=c:"function"==typeof c?u=c(s):c instanceof RegExp&&(u=c.test(s)),!0!==u&&(u=!1),s=o(a,s)){var p,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?f(p=n(a,s,d))?a+":"+s:p:f(p=i(a,s,d))?void 0:p}}))};var m=v,y=u((function(e,t){for(var r in(t=e.exports=function(e,t){return new m(t).process(e)}).FilterCSS=m,d)t[r]=d[r]})),g=(y.FilterCSS,function(e,t){var r,n;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}),_=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},b=function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},x=y.FilterCSS,w=y.getDefaultWhiteList,S=new x;function P(e){return e.replace(T,"&lt;").replace(O,"&gt;")}var T=/</g,O=/>/g,C=/"/g,M=/&quot;/g,A=/&#([a-zA-Z0-9]*);?/gim,E=/&colon;?/gim,I=/&newline;?/gim,R=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,D=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,L=/u\s*r\s*l\s*\(.*/gi;function j(e){return e.replace(C,"&quot;")}function V(e){return e.replace(M,'"')}function F(e){return e.replace(A,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function N(e){return e.replace(E,":").replace(I," ")}function k(e){for(var t="",r=0,n=e.length;r<n;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return _(t)}function z(e){return k(e=N(e=F(e=V(e))))}function U(e){return P(e=j(e))}var B=/<!--[\s\S]*?-->/g,G={whiteList:{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]},getDefaultWhiteList:function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}},onTag:function(e,t,r){},onIgnoreTag:function(e,t,r){},onTagAttr:function(e,t,r){},onIgnoreTagAttr:function(e,t,r){},safeAttrValue:function(e,t,r,n){if(r=z(r),"href"===t||"src"===t){if("#"===(r=_(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(R.lastIndex=0,R.test(r))return""}else if("style"===t){if(D.lastIndex=0,D.test(r))return"";if(L.lastIndex=0,L.test(r)&&(R.lastIndex=0,R.test(r)))return"";!1!==n&&(r=(n=n||S).process(r))}return U(r)},escapeHtml:P,escapeQuote:j,unescapeQuote:V,escapeHtmlEntities:F,escapeDangerHtml5Entities:N,clearNonPrintableCharacter:k,friendlyAttrValue:z,escapeAttrValue:U,onIgnoreTagStripAll:function(){return""},StripTagBody:function(e,t){"function"!=typeof t&&(t=function(){});var r=!Array.isArray(e),n=[],i=!1;return{onIgnoreTag:function(o,a,s){if(function(t){return!!r||-1!==g(e,t)}(o)){if(s.isClosing){var l="[/removed]",c=s.position+l.length;return n.push([!1!==i?i:s.position,c]),i=!1,l}return i||(i=s.position),"[removed]"}return t(o,a,s)},remove:function(e){var t="",r=0;return function(e,t,r){var n,i;if(Array.prototype.forEach)return e.forEach(t,r);for(n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)}(n,(function(n){t+=e.slice(r,n[0]),r=n[1]})),t+=e.slice(r)}}},stripCommentTag:function(e){return e.replace(B,"")},stripBlankChar:function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)}))).join("")},cssFilter:S,getDefaultCSSWhiteList:w};function H(e){var t=b(e);if(-1===t)var r=e.slice(1,-1);else r=e.slice(1,t+1);return"/"===(r=_(r).toLowerCase()).slice(0,1)&&(r=r.slice(1)),"/"===r.slice(-1)&&(r=r.slice(0,-1)),r}function q(e){return"</"===e.slice(0,2)}var W=/[^a-zA-Z0-9_:\.\-]/gim;function J(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}}function Z(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}}function X(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}var Y={parseTag:function(e,t,r){var n="",i=0,o=!1,a=!1,s=0,l=e.length,c="",u="";for(s=0;s<l;s++){var p=e.charAt(s);if(!1===o){if("<"===p){o=s;continue}}else if(!1===a){if("<"===p){n+=r(e.slice(i,s)),o=s,i=s;continue}if(">"===p){n+=r(e.slice(i,o)),c=H(u=e.slice(o,s+1)),n+=t(o,n.length,c,u,q(u)),i=s+1,o=!1;continue}if(('"'===p||"'"===p)&&"="===e.charAt(s-1)){a=p;continue}}else if(p===a){a=!1;continue}}return i<e.length&&(n+=r(e.substr(i))),n},parseAttr:function(e,t){var r=0,n=[],i=!1,o=e.length;function a(e,r){if(!((e=(e=_(e)).replace(W,"").toLowerCase()).length<1)){var i=t(e,r||"");i&&n.push(i)}}for(var s=0;s<o;s++){var l,c=e.charAt(s);if(!1!==i||"="!==c)if(!1===i||s!==r||'"'!==c&&"'"!==c||"="!==e.charAt(s-1)){if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===i){if(-1===(l=J(e,s))){a(_(e.slice(r,s))),i=!1,r=s+1;continue}s=l-1;continue}if(-1===(l=Z(e,s-1))){a(i,X(_(e.slice(r,s)))),i=!1,r=s+1;continue}}}else{if(-1===(l=e.indexOf(c,s+1)))break;a(i,_(e.slice(r+1,l))),i=!1,r=(s=l)+1}else i=e.slice(r,s),r=s+1}return r<e.length&&(!1===i?a(e.slice(r)):a(i,X(_(e.slice(r))))),_(n.join(" "))}},Q=y.FilterCSS,K=Y.parseTag,$=Y.parseAttr;function ee(e){return null==e}function te(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=G.onIgnoreTagStripAll),e.whiteList=e.whiteList||G.whiteList,e.onTag=e.onTag||G.onTag,e.onTagAttr=e.onTagAttr||G.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||G.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||G.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||G.safeAttrValue,e.escapeHtml=e.escapeHtml||G.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new Q(e.css))}te.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,n=t.onTag,i=t.onIgnoreTag,o=t.onTagAttr,a=t.onIgnoreTagAttr,s=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=G.stripBlankChar(e)),t.allowCommentTag||(e=G.stripCommentTag(e));var u=!1;t.stripIgnoreTagBody&&(u=G.StripTagBody(t.stripIgnoreTagBody,i),i=u.onIgnoreTag);var p=K(e,(function(e,t,u,p,d){var h,f={sourcePosition:e,position:t,isClosing:d,isWhite:r.hasOwnProperty(u)};if(!ee(h=n(u,p,f)))return h;if(f.isWhite){if(f.isClosing)return"</"+u+">";var v=function(e){var t=b(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=_(e.slice(t+1,-1)))[e.length-1];return r&&(e=_(e.slice(0,-1))),{html:e,closing:r}}(p),m=r[u],y=$(v.html,(function(e,t){var r,n=-1!==g(m,e);return ee(r=o(u,e,t,n))?n?(t=s(u,e,t,c))?e+'="'+t+'"':e:ee(r=a(u,e,t,n))?void 0:r:r}));return p="<"+u,y&&(p+=" "+y),v.closing&&(p+=" /"),p+">"}return ee(h=i(u,p,f))?l(p):h}),l);return u&&(p=u.remove(p)),p};var re=te,ne=u((function(e,t){function r(e,t){return new re(t).process(e)}for(var n in(t=e.exports=r).filterXSS=r,t.FilterXSS=re,G)t[n]=G[n];for(var n in Y)t[n]=Y[n];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}));return ne.filterXSS,ne.FilterXSS,function(){function e(e,t){var r,n=this;this.arcgisWhiteList={a:["href","target","style"],img:["src","width","height","border","alt","style"],video:["autoplay","controls","height","loop","muted","poster","preload","width"],audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:["width","height","cellpadding","cellspacing","border","style"],div:["style","align"],font:["size","color","style"],tr:["height","valign","align","style"],td:["height","width","valign","align","colspan","rowspan","nowrap","style"],th:["height","width","valign","align","colspan","rowspan","nowrap","style"],p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,r,i){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?n.sanitizeUrl(r):ne.safeAttrValue(e,t,r,i)}},e&&!t?r=e:e&&t?(r=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach((function(t){"whiteList"===t?r.whiteList=n._extendObjectOfArrays([n.arcgisWhiteList,e.whiteList||{}]):r[t]=e[t]}))):(r=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=r,this._xssFilter=new ne.FilterXSS(r)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e){var t=this._trim(e.substring(0,e.indexOf(":")));return"/"===e||"#"===e||"#"===e[0]||this.allowedProtocols.indexOf(t.toLowerCase())>-1?ne.escapeAttrValue(e):""},e.prototype.validate=function(e,t){void 0===t&&(t={});var r=this.sanitize(e,t);return{isValid:e===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(r){Array.isArray(e[r])&&Array.isArray(t[r])?t[r]=t[r].concat(e[r]):t[r]=e[r]}))})),t},e.prototype._iterateOverObject=function(e,t){var r=this;void 0===t&&(t={});try{var n=!1,i=void 0;if(Array.isArray(e))i=e.reduce((function(e,i){var o=r.validate(i,t);return o.isValid?e.concat([i]):(n=!0,e.concat([o.sanitized]))}),[]);else{if(!c(e)){if(t.allowUndefined&&void 0===e)return;return null}i=Object.keys(e).reduce((function(i,o){var a=e[o],s=r.validate(a,t);return s.isValid?i[o]=a:(n=!0,i[o]=s.sanitized),i}),{})}return n?i:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}()}()},function(e,t,r){!function(e){"use strict";var t,r,n=function(e){t||function(e){if("WebkitTransition"in e.style)t="webkitTransitionEnd",r="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");t="transitionend",r="animationend"}}(e)};e.createEnterCssTransition=function(e,i){return void 0===i&&(i=e+"-active"),function(o){n(o);var a=!1,s=function(n){a||(a=!0,o.removeEventListener(t,s),o.removeEventListener(r,s),o.classList.remove(e),o.classList.remove(i))};o.classList.add(e),o.addEventListener(t,s),o.addEventListener(r,s),requestAnimationFrame((function(){o.classList.add(i)}))}},e.createExitCssTransition=function(e,i){return void 0===i&&(i=e+"-active"),function(o,a){n(o);var s=!1,l=function(e){s||(s=!0,o.removeEventListener(t,l),o.removeEventListener(r,l),a())};o.classList.add(e),o.addEventListener(t,l),o.addEventListener(r,l),requestAnimationFrame((function(){o.classList.add(i)}))}},Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){for(var i=0,o=t.length;i<o;i++){var a=t[i];Array.isArray(a)?r(e,a,n):null!=a&&!1!==a&&("string"==typeof a&&(a={vnodeSelector:"",properties:void 0,children:void 0,text:a.toString(),domNode:null}),n.push(a))}};t.h=function(e,t,n){if(Array.isArray(t))n=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||n&&("string"==typeof n||n.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");var i,o;return n&&1===n.length&&"string"==typeof n[0]?i=n[0]:n&&(r(e,n,o=[]),0===o.length&&(o=void 0)),{vnodeSelector:e,properties:t,children:o,text:""===i?void 0:i,domNode:null}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1101)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(e,t){for(var r=[];e!==t;)r.push(e),e=e.parentNode;return r};n=Array.prototype.find?function(e,t){return e.find(t)}:function(e,t){return e.filter(t)[0]};var o=function(e,t){var r=e;return t.forEach((function(e){r=r&&r.children?n(r.children,(function(t){return t.domNode===e})):void 0})),r};t.createProjector=function(e){var t,n,a=r.applyDefaultProjectionOptions(e),s=a.performanceLogger,l=!0,c=!1,u=[],p=[],d=function(e,r,n){var l;a.eventHandlerInterceptor=function(e,t,r){var n=function(n){r("domEvent",n);var a=t(),s=i(n.currentTarget,a.domNode);s.reverse();var l,c=o(a.getLastRender(),s);return e.scheduleRender(),c&&(l=c.properties["on"+n.type].apply(c.properties.bind||this,arguments)),r("domEventProcessed",n),l};return function(){return n}}(t,(function(){return l}),s),l=e(r,n(),a),u.push(l),p.push(n)},h=function(){if(n=void 0,l){l=!1,s("renderStart",void 0);for(var e=0;e<u.length;e++){var t=p[e]();s("rendered",void 0),u[e].update(t),s("patched",void 0)}s("renderDone",void 0),l=!0}};return t={renderNow:h,scheduleRender:function(){n||c||(n=requestAnimationFrame(h))},stop:function(){n&&(cancelAnimationFrame(n),n=void 0),c=!0},resume:function(){c=!1,l=!0,t.scheduleRender()},append:function(e,t){d(r.dom.append,e,t)},insertBefore:function(e,t){d(r.dom.insertBefore,e,t)},merge:function(e,t){d(r.dom.merge,e,t)},replace:function(e,t){d(r.dom.replace,e,t)},detach:function(e){for(var t=0;t<p.length;t++)if(p[t]===e)return p.splice(t,1),u.splice(t,1)[0];throw new Error("renderFunction was not found")}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createCache=function(){var e,t;return{invalidate:function(){t=void 0,e=void 0},result:function(r,n){if(e)for(var i=0;i<r.length;i++)e[i]!==r[i]&&(t=void 0);return t||(t=n(),e=r),t}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMapping=function(e,t,r){var n=[],i=[];return{results:i,map:function(o){for(var a=o.map(e),s=i.slice(),l=0,c=0;c<o.length;c++){var u=o[c],p=a[c];if(p===n[l])i[c]=s[l],r(u,s[l],c),l++;else{for(var d=!1,h=1;h<n.length+1;h++){var f=(l+h)%n.length;if(n[f]===p){i[c]=s[f],r(o[c],s[f],c),l=f+1,d=!0;break}}d||(i[c]=t(u,c))}}i.length=o.length,n=a}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1433),r(1434),r(1435),r(1436)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t),r.__exportStar(i,t),r.__exportStar(o,t),r.__exportStar(a,t)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){function n(e){var t=e.type;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}Object.defineProperty(t,"__esModule",{value:!0}),t.accessibleHandler=function(){return function(e,t){if(!e[t])throw new TypeError("Cannot auto bind undefined function '"+t+"'");return{value:(i=e[t],function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];n(e)?"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.click()):i.call.apply(i,r.__spreadArrays([this,e],t))})};var i}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.messageBundle=function(e){return function(t,r){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1102)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.renderable=function(e){var t="string"==typeof e?r.splitProps(e):e;return function(e,n){e.hasOwnProperty("_renderableProps")||(e._renderableProps=e._renderableProps?e._renderableProps.slice():[]);var i=e._renderableProps;t?i.push.apply(i,r.normalizePropNames(t,n)):i.push(n)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1102)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vmEvent=function(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,i=Array.isArray(e)?e:r.splitProps(e);n.push.apply(n,i)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1438)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.tsx=r.jsx}.apply(null,n))||(e.exports=i)},function(e,t,r){!function(e){"use strict";var t=function(e,r){for(var n=0,i=e.length;n<i;n++){var o=e[n];Array.isArray(o)?t(o,r):null!=o&&!1!==o&&(o.hasOwnProperty("vnodeSelector")||(o={vnodeSelector:"",properties:void 0,children:void 0,text:o.toString(),domNode:null}),r.push(o))}},r=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(1===n.length&&"string"==typeof n[0])return{vnodeSelector:e,properties:r||void 0,children:void 0,text:n[0],domNode:null};var o=[];return t(n,o),{vnodeSelector:e,properties:r||void 0,children:o,text:void 0,domNode:null}};e.enableGlobalJsx=function(){window.jsx=r},e.jsx=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._node=e}return e.prototype.add=function(e){var t=this._node;t.className.baseVal=(t.className.baseVal+" "+e).trim()},e.prototype.contains=function(e){return this._node.className.baseVal.split(" ").indexOf(e)>-1},e.prototype.remove=function(e){for(var t=this._node,r="",n=0,i=t.className.baseVal.split(" ");n<i.length;n++){var o=i[n];o!==e&&(r+=o+" ")}t.className.baseVal=r.trim()},e.prototype.toggle=function(e,t){var r,n=this.contains(e);return(r=n?!0!==t&&"remove":!1!==t&&"add")&&this[r](e),void 0!==t?t:!n},e}();t.DOMTokenListSubset=r,"classList"in SVGElement.prototype||Object.defineProperty(SVGElement.prototype,"classList",{get:function(){return new r(this)}})}.apply(null,n))||(e.exports=i)},,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(1103),r(762)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.codedValues=null,r.type="coded-value",r}var a;return r.__extends(t,e),a=t,t.prototype.getName=function(e){var t=null;if(this.codedValues){var r=String(e);this.codedValues.some((function(e){return String(e.code)===r&&(t=e.name),!!t}))}return t},t.prototype.clone=function(){return new a({codedValues:n.clone(this.codedValues),name:this.name})},r.__decorate([i.property({type:[o.default],json:{write:!0}})],t.prototype,"codedValues",void 0),r.__decorate([i.enumeration({codedValue:"coded-value"})],t.prototype,"type",void 0),a=r.__decorate([i.subclass("esri.layers.support.CodedValueDomain")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(762)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="inherited",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i},r.__decorate([n.enumeration({inherited:"inherited"})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.layers.support.InheritedDomain")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(762)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxValue=null,r.minValue=null,r.type="range",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({maxValue:this.maxValue,minValue:this.minValue,name:this.name})},r.__decorate([n.property({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{enabled:!1,overridePolicy:function(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer:function(e,t,r){t[r]=[this.minValue||0,e]}}}})],t.prototype,"maxValue",void 0),r.__decorate([n.property({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,r){t[r]=[e,this.maxValue||0]}}}})],t.prototype,"minValue",void 0),r.__decorate([n.enumeration({range:"range"})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.layers.support.RangeDomain")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.offsetPoint=function(e,t,r,n){return e.x=e.x+t,e.y=e.y+r,null!=n&&null!=e.z&&(e.z=e.z+n),e},t.offsetCoordsX=function(e,t){return e[0]+=t,e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.formats={"short-date":"(datePattern: 'M/d/y', selector: 'date')","short-date-short-time":"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')","short-date-short-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')","short-date-long-time":"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')","short-date-long-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')","short-date-le":"(datePattern: 'd/M/y', selector: 'date')","short-date-le-short-time":"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')","short-date-le-short-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')","short-date-le-long-time":"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')","short-date-le-long-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')","long-month-day-year":"(datePattern: 'MMMM d, y', selector: 'date')","long-month-day-year-short-time":"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')","long-month-day-year-short-time-24":"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')","long-month-day-year-long-time":"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')","long-month-day-year-long-time-24":"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')","day-short-month-year":"(datePattern: 'd MMM y', selector: 'date')","day-short-month-year-short-time":"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')","day-short-month-year-short-time-24":"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')","day-short-month-year-long-time":"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')","day-short-month-year-long-time-24":"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')","long-date":"(datePattern: 'EEEE, MMMM d, y', selector: 'date')","long-date-short-time":"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')","long-date-short-time-24":"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')","long-date-long-time":"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')","long-date-long-time-24":"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')","long-month-year":"(datePattern: 'MMMM y', selector: 'date')","short-month-year":"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},t.dictionary=r.strict()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),t.toJSON=t.dictionary.toJSON.bind(t.dictionary),t.fromJSON=t.dictionary.fromJSON.bind(t.dictionary),t.getFormat=function(e){return t.formats[e]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.linkURL=null,r.sourceURL=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({linkURL:this.linkURL,sourceURL:this.sourceURL})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"linkURL",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"sourceURL",void 0),n=r.__decorate([i.subclass("esri.popup.content.support.ImageMediaInfoValue")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.returnTopmostRaster=null,r.showNoDataRecords=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})},r.__decorate([i.property({type:Boolean,json:{write:!0}})],t.prototype,"returnTopmostRaster",void 0),r.__decorate([i.property({type:Boolean,json:{write:!0}})],t.prototype,"showNoDataRecords",void 0),n=r.__decorate([i.subclass("esri.popup.LayerOptions")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(1113)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.showRelatedRecords=null,r.orderByFields=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?i.clone(this.orderByFields):null})},r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"showRelatedRecords",void 0),r.__decorate([o.property({type:[a],json:{write:!0}})],t.prototype,"orderByFields",void 0),n=r.__decorate([o.subclass("esri.popup.RelatedRecordsInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(163),r(1114),r(871),r(774),r(625)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.C_DEG_TO_RAD=Math.PI/180;var c=n.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),u=function(){function e(e){this._t=e}return e.createIdentity=function(){return new e([1,0,0,0,1,0])},e.prototype.clone=function(){return new e(this._t.slice())},e.prototype.transform=function(e){var t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]},e.createScale=function(t,r){return new e([t,0,0,0,r,0])},e.prototype.scale=function(e,t){var r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this},e.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])},e.createTranslate=function(t,r){return new e([0,0,t,0,0,r])},e.prototype.translate=function(e,t){var r=this._t;return r[2]+=e,r[5]+=t,this},e.createRotate=function(t){var r=Math.cos(t),n=Math.sin(t);return new e([r,-n,0,n,r,0])},e.prototype.rotate=function(t){return this.multiply(e.createRotate(t))},e.prototype.multiply=function(e){var t=this._t,r=e._t,n=t[0]*r[0]+t[3]*r[1],i=t[1]*r[0]+t[4]*r[1],o=t[2]*r[0]+t[5]*r[1]+r[2],a=t[0]*r[3]+t[3]*r[4],s=t[1]*r[3]+t[4]*r[4],l=t[2]*r[3]+t[5]*r[4]+r[5];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,this},e}();t.Transformation=u;var p=function(){function e(e){this._transfos=[],this._sizeTransfos=[],this._transfos.push(e||u.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}return e.prototype.transformPt=function(e){return this._transfos[this._transfos.length-1].transform(e)},e.prototype.transformSize=function(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]},e.prototype.back=function(){return this._transfos[this._transfos.length-1]},e.prototype.push=function(e,t){var r=t?e.scaleRatio():1;e.multiply(this.back()),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)},e.prototype.pop=function(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)},e.prototype.drawSymbol=function(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t)}},e.prototype.drawMultiLayerSymbol=function(e,t){if(e){var r=e.symbolLayers;if(r){var n=e.effects;if(n){var i=this.executeEffects(n,t);if(i)for(var o=i.next();o;)this.drawSymbolLayers(r,o),o=i.next()}else this.drawSymbolLayers(r,t)}}},e.prototype.executeEffects=function(e,t){for(var r=new o.SimpleGeometryCursor(t),n=0,i=e;n<i.length;n++){var s=i[n],l=a.getEffectOperator(s);l&&(r=l.execute(r,s,1))}return r},e.prototype.drawSymbolLayers=function(e,t){for(var r=e.length;r--;){var n=e[r];if(n&&!1!==n.enable){var i=n.effects;if(i){var o=this.executeEffects(i,t);if(o)for(var a=o.next();a;)this.drawSymbolLayer(n,a),a=o.next()}else this.drawSymbolLayer(n,t)}}},e.prototype.drawSymbolLayer=function(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}},e.prototype.drawMarkerLayer=function(e,t){var r=e.markerPlacement;if(r){var n=a.getPlacementOperator(r);if(n){var i=n.execute(t,r,1);if(i)for(var o=i.next();o;)this.drawMarker(e,o),o=i.next()}}else{var l=new s.Placement;l.tx=t.x,l.ty=t.y,this.drawMarker(e,l)}},e.prototype.drawMarker=function(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}},e.prototype.drawPictureMarker=function(e,t){},e.prototype.drawVectorMarker=function(e,r){if(e){var n=e.markerGraphics;if(n){var i=e.size,o=e.frame,a=o?o.ymax-o.ymin:0,s=i&&a?i/a:1,l=u.createIdentity();o&&l.translate(.5*-(o.xmax+o.xmin),.5*-(o.ymax+o.ymin));var p=e.anchorPoint;if(p){var d=p.x,h=p.y;"Absolute"!==e.anchorPointUnits&&o&&(d*=o.xmax-o.xmin,h*=o.ymax-o.ymin),l.translate(-d,-h)}1!==s&&l.scale(s,s),e.rotation&&l.rotate(e.rotation*t.C_DEG_TO_RAD),l.translate(e.offsetX||0,e.offsetY||0),l.translate(r.tx,r.ty),this.push(l,e.scaleSymbolsProportionally);for(var f=0,v=n;f<v.length;f++){var m=v[f];m&&m.symbol&&m.geometry||c.error("Invalid marker graphic",m),this.drawSymbol(m.symbol,m.geometry)}this.pop()}}},e}();t.CIMSymbolDrawHelper=p;var d=function(e){function t(){var t=e.call(this)||this;return t.reset(),t}return r.__extends(t,e),t.prototype.reset=function(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0},t.prototype.envelope=function(){return new l.default(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)},t.prototype._merge=function(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)},t.prototype.drawSolidFill=function(e){if(e&&e.rings)for(var t=0,r=e.rings;t<r.length;t++){var n=r[t],i=n?n.length:0;if(i>2){this._merge(this.transformPt(n[0]),0);for(var o=1;o<i;++o)this._merge(this.transformPt(n[o]),0)}}},t.prototype.drawSolidStroke=function(e,t,r){var n,o=.5*this.transformSize(r);if(n=i.isPolygon(e)?e.rings:e.paths)for(var a=0,s=n;a<s.length;a++){var l=s[a],c=l?l.length:0;if(c>1){this._merge(this.transformPt(l[0]),o);for(var u=1;u<c;++u)this._merge(this.transformPt(l[u]),o)}}},t}(p);t.EnvDrawHelper=d;var h=function(e){function t(t,r){var n=e.call(this,r)||this;return n._ctx=t,n}return r.__extends(t,e),t.prototype.drawSolidFill=function(e,t){if(e&&e.rings){var r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",r.beginPath();for(var n=0,i=e.rings;n<i.length;n++){var o=i[n],a=o?o.length:0;if(a>2){var s=this.transformPt(o[0]);r.moveTo(s[0],s[1]);for(var l=1;l<a;++l)s=this.transformPt(o[l]),r.lineTo(s[0],s[1]);r.closePath()}}r.fill("evenodd")}},t.prototype.drawSolidStroke=function(e,t,r,n,o,a){if(t&&0!==r){var s=this._ctx;s.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",s.lineWidth=this.transformSize(r)+.5,this._setCapStyle(n),this._setJoinStyle(o),s.miterLimit=a,s.beginPath();var l,c=!1;i.isPolygon(e)?(l=e.rings,c=!0):l=e.paths;for(var u=0,p=l;u<p.length;u++){var d=p[u],h=d?d.length:0;if(h>1){var f=this.transformPt(d[0]);s.moveTo(f[0],f[1]);for(var v=1;v<h;++v)f=this.transformPt(d[v]),s.lineTo(f[0],f[1]);c&&s.closePath()}}s.stroke()}},t.prototype._setCapStyle=function(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}},t.prototype._setJoinStyle=function(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}},t}(p);t.CanvasDrawHelper=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(163),r(338)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.EffectAddControlPoints=o;var a=function(){function e(e,t,r){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(n.isPolygon(e)){this._isClosed=!0;var t=r.clone(e);return this._processMultipath(t.rings),t}if(n.isPolyline(e)){this._isClosed=!1;var i=r.clone(e);return this._processMultipath(i.paths),i}if(n.isExtent(e)){if(this._maxCosAngle)return e;this._isClosed=!0;var o=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(o),{rings:[o]}}e=this._inputGeometries.next()}return null},e.prototype._processMultipath=function(e){if(e)for(var t=0,r=e;t<r.length;t++){var n=r[t];this._processPath(n)}},e.prototype._processPath=function(e){if(e){var t=e.length,r=e[0],n=void 0,o=void 0,a=void 0,s=void 0,l=void 0,c=void 0;this._isClosed&&++t;for(var u=1;u<t;++u){var p,d=(p=this._isClosed&&u===t-1?e[0]:e[u])[0]-r[0],h=p[1]-r[1],f=Math.sqrt(d*d+h*h);u>1&&f>0&&a>0&&(n*d+o*h)/f/a<=this._maxCosAngle&&i.setId(r,1),1===u&&(s=d,l=h,c=f),f>0&&(r=p,n=d,o=h,a=f)}this._isClosed&&a>0&&c>0&&(n*s+o*l)/c/a<=this._maxCosAngle&&i.setId(e[0],1)}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=1.7320508075688772,a=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new s(e,t,r)},e.instance=null,e}();t.EffectArrow=a;var s=function(e){function t(t,r,n){var o=e.call(this,t,!1,!0)||this;return o._curveHelper=new i.CurveHelper,o._width=(void 0!==r.width?r.width:5)*n,o._arrowType=r.geometricEffectArrowType,o._offsetFlattenError=i.PIXEL_TOLERANCE*n,o}return r.__extends(t,e),t.prototype.processPath=function(e){switch(this._arrowType){case"OpenEnded":default:return this._constructSimpleArrow(e,!0);case"Block":return this._constructSimpleArrow(e,!1);case"Crossed":return this._constructCrossedArrow(e)}},t.prototype._constructSimpleArrow=function(e,t){var r=this._curveHelper.calculatePathLength(e),n=this._width;r<2*n&&(n=r/2);var o=this._curveHelper.getSubCurve(e,0,r-n);if(!o)return null;var a=n/2;if(this._curveHelper.isEmpty(o,!1))return null;var s=this._constructOffset(o,-a);if(!s)return null;var l=this._constructOffset(o,a);if(!l)return null;var c=this._constructArrowBasePoint(s,-a);if(!c)return null;var u=this._constructArrowBasePoint(l,a);if(!u)return null;var p=e[e.length-1];t||(this._makeControlPoint(l,!0),this._makeControlPoint(s,!0));var d=new i.PathHelper;return d.addPath(l,!0),d.lineTo(u),this._makeControlPoint(d.path()),d.lineTo(p),this._makeControlPoint(d.path()),d.lineTo(c),this._makeControlPoint(d.path()),d.addPath(s,!1),t?{paths:[d.path()]}:(d.close(),{rings:[d.path()]})},t.prototype._constructCrossedArrow=function(e){var t=this._curveHelper.calculatePathLength(e),r=this._width;t<r*(1+o+1)&&(r=t/(1+o+1));var n=this._curveHelper.getSubCurve(e,0,t-r*(1+o));if(!n)return null;var a=r/2;if(this._curveHelper.isEmpty(n,!1))return null;var s=this._constructOffset(n,a);if(!s)return null;var l=this._constructOffset(n,-a);if(!l)return null;var c=this._curveHelper.getSubCurve(e,0,t-r);if(!c)return null;if(this._curveHelper.isEmpty(c,!1))return null;var u=this._constructOffset(c,a);if(!u)return null;var p=this._constructOffset(c,-a);if(!p)return null;var d=u[u.length-1],h=this._constructArrowBasePoint(u,a);if(!h)return null;var f=p[p.length-1],v=this._constructArrowBasePoint(p,-a);if(!v)return null;var m=e[e.length-1];this._makeControlPoint(s,!1),this._makeControlPoint(l,!1);var y=new i.PathHelper;return y.addPath(s,!0),this._makeControlPoint(y.path()),y.lineTo(f),y.lineTo(v),this._makeControlPoint(y.path()),y.lineTo(m),this._makeControlPoint(y.path()),y.lineTo(h),this._makeControlPoint(y.path()),y.lineTo(d),this._makeControlPoint(y.path()),y.addPath(l,!1),{paths:[y.path()]}},t.prototype._constructOffset=function(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)},t.prototype._constructArrowBasePoint=function(e,t){if(!e||e.length<2)return null;var r=e[e.length-2],n=e[e.length-1],i=[n[0]-r[0],n[1]-r[1]];return this._curveHelper.normalize(i),[n[0]+i[1]*t,n[1]-i[0]*t]},t.prototype._makeControlPoint=function(e,t){void 0===t&&(t=!1),t?n.setId(e[0],1):n.setId(e[e.length-1],1)},t}(n.PathGeometryCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163),r(367)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new o(e,t,r)},e.instance=null,e}();t.EffectBuffer=i;var o=function(){function e(e,t,r){this._inputGeometries=e,this._curveHelper=new n.CurveHelper,this._size=(void 0!==t.size?t.size:1)*r,this._offsetFlattenError=n.PIXEL_TOLERANCE*r}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(r.isExtent(e))if(this._size>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(a=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError))return{rings:[a]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if(r.isPolygon(e)){if(0===this._size)return e;for(var n=[],i=0,o=e.rings;i<o.length;i++){var a;t=o[i],(a=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError))&&n.push(a)}if(n.length)return{rings:n}}if(r.isPolyline(e)&&this._size>0){n=[];for(var s=0,l=e.paths;s<l.length;s++){var c=l[s];if(c&&c.length>1){var u=this._curveHelper.offset(c,this._size,"Rounded",4,this._offsetFlattenError),p=this._curveHelper.offset(c,-this._size,"Rounded",4,this._offsetFlattenError);if(u&&p){for(var d=p.length-1;d>=0;d--)u.push(p[d]);u.push([u[0][0],u[0][1]]),n.push(u)}}}if(n.length)return{rings:n}}r.isPoint(e)&&this._size,e=this._inputGeometries.next()}return null},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.EffectCut=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!0,!0)||this;return o._curveHelper=new i.CurveHelper,o._beginCut=(void 0!==r.beginCut?r.beginCut:1)*n,o._endCut=(void 0!==r.endCut?r.endCut:1)*n,o._middleCut=(void 0!==r.middleCut?r.middleCut:0)*n,o._invert=void 0!==r.invert&&r.invert,o._beginCut<0&&(o._beginCut=0),o._endCut<0&&(o._endCut=0),o._middleCut<0&&(o._middleCut=0),o}return r.__extends(t,e),t.prototype.processPath=function(e){var t=this._beginCut,r=this._endCut,n=this._middleCut,i=this._curveHelper.calculatePathLength(e),o=[];if(this._invert)0===t&&0===r&&0===n||(t+r+n>=i?o.push(e):((a=this._curveHelper.getSubCurve(e,0,t))&&o.push(a),(a=this._curveHelper.getSubCurve(e,.5*(i-n),.5*(i+n)))&&o.push(a),(a=this._curveHelper.getSubCurve(e,i-r,r))&&o.push(a)));else if(0===t&&0===r&&0===n)o.push(e);else if(t+r+n>=i);else if(0===n)(a=this._curveHelper.getSubCurve(e,t,i-r))&&o.push(a);else{var a;(a=this._curveHelper.getSubCurve(e,t,.5*(i-n)))&&o.push(a),(a=this._curveHelper.getSubCurve(e,.5*(i+n),i-r))&&o.push(a)}return 0===o.length?null:{paths:o}},t}(n.PathGeometryCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367),r(775)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new s(e,t,r)},e.instance=null,e}();t.EffectDashes=a;var s=function(e){function t(t,r,n){var i=e.call(this,t,!0,!0)||this;return i._walker=new o.GeometryWalker,i._walker.updateTolerance(n),i._endings=r.lineDashEnding,i._customDashPos=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,i._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*n:0,i._pattern=new o.DashPattern,i._pattern.init(r.dashTemplate,!0),i._pattern.scale(n),i}return r.__extends(t,e),t.prototype.processPath=function(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){var t=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(t=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var r=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||r<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}var n;if(this.iteratePath)n=this._pattern.nextValue();else{var o=void 0;switch(this._endings){case"HalfPattern":default:o=.5*this._pattern.firstValue();break;case"HalfGap":o=.5*-this._pattern.lastValue();break;case"FullGap":o=-this._pattern.lastValue();break;case"FullPattern":o=0;break;case"NoConstraint":case"Custom":o=-this._customDashPos}var a=o/this._pattern.length();o=(a-=Math.floor(a))*this._pattern.length(),this._pattern.reset(),n=this._pattern.nextValue();for(var s=!1;o>=n;)o-=n,n=this._pattern.nextValue(),s=!s;n-=o,s?(this._walker.nextPosition(n),n=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(n),n=this._pattern.nextValue(),this._walker.nextPosition(n),n=this._pattern.nextValue())}var l=this._walker.nextCurve(n);return l?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),i.PathHelper.mergePath(l,this._firstCurve),this._firstCurve=null)):(n=this._pattern.nextValue(),!this._walker.nextPosition(n)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(l=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,l=this._firstCurve,this._firstCurve=null),{paths:[l]}},t}(n.PathGeometryCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163),r(367)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new o(e,t,r)},e.instance=null,e}();t.EffectDonut=i;var o=function(){function e(e,t,r){switch(this._inputGeometries=e,this._curveHelper=new n.CurveHelper,this._width=(void 0!==t.width?t.width:2)*r,t.method){case"Mitered":default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square"}this._option=t.option,this._offsetFlattenError=n.PIXEL_TOLERANCE*r,this._option}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(r.isExtent(e)&&this._width>0)return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?e:((n=[]).push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),n.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:n});if(r.isPolygon(e)&&this._width>0){for(var t=[],n=[],i=0,o=e.rings;i<o.length;i++){var a=o[i],s=this._curveHelper.calculatePathLength(a);s>0&&t.push(a);var l=this._curveHelper.offset(a,this._width,this._method,4,this._offsetFlattenError);l&&(s<0&&l.reverse(),n.push(l)),s<0&&t.push(a)}if(n.length)return{rings:n}}e=this._inputGeometries.next()}return null},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.EffectJog=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!1,!0)||this;return o._curveHelper=new i.CurveHelper,o._length=(void 0!==r.length?r.length:20)*n,o._angle=void 0!==r.angle?r.angle:225,o._position=void 0!==r.position?r.position:50,o._length<0&&(o._length=-o._length),o._position<20&&(o._position=20),o._position>80&&(o._position=80),o._mirror=!1,o}return r.__extends(t,e),t.prototype.processPath=function(e){if(this._curveHelper.isEmpty(e,!1))return null;var t=e[0],r=e[e.length-1],n=[r[0]-t[0],r[1]-t[1]];this._curveHelper.normalize(n);var i=[t[0]+(r[0]-t[0])*this._position/100,t[1]+(r[1]-t[1])*this._position/100],o=Math.cos((90-this._angle)/180*Math.PI),a=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(a=-a),this._mirror=!this._mirror,{paths:[[t,[i[0]-this._length/2*o,i[1]-this._length/2*a],[i[0]+this._length/2*o,i[1]+this._length/2*a],r]]}},t}(n.PathGeometryCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(163)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new o(e,t,r)},e.instance=null,e}();t.EffectMove=i;var o=function(){function e(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?-t.offsetY*r:0}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(n.isExtent(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if(n.isPolygon(e)){var t=r.clone(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if(n.isPolyline(e)){var i=r.clone(e);return this._moveMultipath(i.paths,this._offsetX,this._offsetY),i}if(n.isMultipoint(e)){var o=r.clone(e);return this._movePath(o.points,this._offsetX,this._offsetY),o}if(n.isPoint(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null},e.prototype._moveMultipath=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];this._movePath(o,t,r)}},e.prototype._movePath=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];o[0]+=t,o[1]+=r}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163),r(367)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new o(e,t,r)},e.instance=null,e}();t.EffectOffset=i;var o=function(){function e(e,t,r){this._inputGeometries=e,this._curveHelper=new n.CurveHelper,this._offset=(void 0!==t.offset?t.offset:1)*r,this._method=t.method,this._option=t.option,this._offsetFlattenError=n.PIXEL_TOLERANCE*r,this._option}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(0===this._offset)return e;if(r.isExtent(e)){if("Rounded"===this._method&&this._offset>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return(a=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError))?{rings:[a]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if(r.isPolygon(e)){for(var n=[],i=0,o=e.rings;i<o.length;i++){var a;t=o[i],(a=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError))&&n.push(a)}if(n.length)return{rings:n}}if(r.isPolyline(e)){for(var s=[],l=0,c=e.paths;l<c.length;l++){var u=c[l],p=this._curveHelper.offset(u,this._offset,this._method,4,this._offsetFlattenError);p&&s.push(p)}if(s.length)return{paths:s}}e=this._inputGeometries.next()}return null},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(163),r(338)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.EffectReverse=o;var a=function(){function e(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if(n.isPolyline(e)){var t=r.clone(e);return i.reverseMultipath(t.paths),t}e=this._inputGeometries.next()}return null},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(173),r(353),r(163)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new s(e,t,r)},e.instance=null,e}();t.EffectRotate=a;var s=function(){function e(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?-t.angle*Math.PI/180:0}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(0===this._rotateAngle)return e;var t=n.create();i.getBoundsXY(t,e);var a=(t[2]+t[0])/2,s=(t[3]+t[1])/2;if(o.isExtent(e)){var l={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(l.rings,a,s),l}if(o.isPolygon(e))return l=r.clone(e),this._rotateMultipath(l.rings,a,s),l;if(o.isPolyline(e)){var c=r.clone(e);return this._rotateMultipath(c.paths,a,s),c}if(o.isMultipoint(e)){var u=r.clone(e);return this._rotatePath(u.points,a,s),u}if(o.isPoint(e))return e;e=this._inputGeometries.next()}return null},e.prototype._rotateMultipath=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];this._rotatePath(o,t,r)}},e.prototype._rotatePath=function(e,t,r){if(e)for(var n=Math.cos(this._rotateAngle),i=Math.sin(this._rotateAngle),o=0,a=e;o<a.length;o++){var s=a[o],l=s[0]-t,c=s[1]-r;s[0]=t+l*n-c*i,s[1]=r+l*i+c*n}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(118),r(173),r(353),r(163)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new s(e,t,r)},e.instance=null,e}();t.EffectScale=a;var s=function(){function e(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(1===this._xFactor&&1===this._yFactor)return e;var t=n.create();i.getBoundsXY(t,e);var a=(t[2]+t[0])/2,s=(t[3]+t[1])/2;if(o.isExtent(e)){var l={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(l.rings,a,s),l}if(o.isPolygon(e))return l=r.clone(e),this._scaleMultipath(l.rings,a,s),l;if(o.isPolyline(e)){var c=r.clone(e);return this._scaleMultipath(c.paths,a,s),c}if(o.isMultipoint(e)){var u=r.clone(e);return this._scalePath(u.points,a,s),u}if(o.isPoint(e))return e;e=this._inputGeometries.next()}return null},e.prototype._scaleMultipath=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];this._scalePath(o,t,r)}},e.prototype._scalePath=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n],a=(o[0]-t)*this._xFactor,s=(o[1]-r)*this._yFactor;o[0]=t+a,o[1]=r+s}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(163),r(367),r(775)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.EffectWave=o;var a=function(){function e(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new i.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new i.GeometryWalker,this._walker.updateTolerance(r)}return e.prototype.next=function(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period)return e;if(r.isPolyline(e)){var t=this._processGeom(e.paths);if(t.length)return{paths:t}}if(r.isPolygon(e)){var n=this._processGeom(e.rings);if(n.length)return{rings:n}}e=this._inputGeometries.next()}return null},e.prototype._processGeom=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];if(this._walker.init(i,this._pattern))switch(this._style){case"Sinus":default:t.push(this._constructCurve(i,!1));break;case"Square":t.push(this._constructSquare(i));break;case"Triangle":t.push(this._constructTriangle(i));break;case"Random":t.push(this._constructCurve(i,!0))}else t.push(i)}return t},e.prototype._constructCurve=function(e,t){var r=new n.PathHelper,i=this._walker.calculatePathLength(e),o=Math.round(i/this._period);0===o&&(o=1);var a=16*o+1,s=i/o,l=this._period/16,c=1/a,u=2*Math.PI*i/s,p=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),f=.75-Math.random()/2,v=.75-Math.random()/2,m={};this._walker.curPointAndAngle(m),r.startPath(m.pt);for(var y=0;;){if(!this._walker.nextPointAndAngle(l,m)){r.lineTo(e[e.length-1]);break}var g=y;y+=c;var _=void 0;if(t){var b=this._height/2*(1+.3*Math.sin(f*u*g+p));_=b*Math.sin(u*g+d),_+=b*Math.sin(v*u*g+h),_/=2}else _=.5*this._height*Math.sin(.5*u*g);r.lineTo([m.pt[0]-_*m.sa,m.pt[1]+_*m.ca])}return r.path()},e.prototype._constructSquare=function(e){var t=new n.PathHelper,r=this._walker.calculatePathLength(e),i=Math.round(r/this._period);0===i&&(i=1);for(var o=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var s={};this._walker.curPointAndAngle(s);var l={};if(this._walker.nextPointAndAngle(this._period,l)){var c={};this._walker.nextPointAndAngle(this._period,c)&&(o?(t.startPath(s.pt),o=!1):t.lineTo(s.pt),t.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),t.lineTo([l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca]),t.lineTo([l.pt[0]+this._height/2*l.sa,l.pt[1]-this._height/2*l.ca]),t.lineTo([c.pt[0]+this._height/2*c.sa,c.pt[1]-this._height/2*c.ca]),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()},e.prototype._constructTriangle=function(e){var t=new n.PathHelper,r=this._walker.calculatePathLength(e),i=Math.round(r/this._period);0===i&&(i=1);for(var o=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var s={};this._walker.curPointAndAngle(s);var l={};if(this._walker.nextPointAndAngle(this._period/2,l)){var c={};this._walker.nextPointAndAngle(this._period,c)&&(this._walker.nextPosition(this._period/2)&&(o?(t.startPath(s.pt),o=!1):t.lineTo(s.pt),t.lineTo([l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca]),t.lineTo([c.pt[0]+this._height/2*c.sa,c.pt[1]-this._height/2*c.ca])),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(1465),r(775)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new s(e,t,r)},e.instance=null,e}();t.PlacementAlongLineSameSize=a;var s=function(e){function t(t,r,n){var i=e.call(this,t,!0,!0)||this;return i._grometryWalker=new o.GeometryWalker,i._grometryWalker.updateTolerance(n),i._angleToLine=void 0===r.angleToLine||r.angleToLine,i._offset=void 0!==r.offset?r.offset*n:0,i._originalEndings=r.endings,i._offsetAtEnd=void 0!==r.customEndingOffset?r.customEndingOffset*n:0,i._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,i._pattern=new o.DashPattern,i._pattern.init(r.placementTemplate,!1),i._pattern.scale(n),i._endings=i._originalEndings,i}return r.__extends(t,e),t.prototype.processPath=function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===i.PlacementEndings.WithFullGap&&this.isClosed?this._endings=i.PlacementEndings.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;var r=!0,n=void 0;switch(this._endings){case i.PlacementEndings.NoConstraint:n=-this._position,n=this._adjustPosition(n),r=!1;break;case i.PlacementEndings.WithHalfGap:default:n=-this._pattern.lastValue()/2;break;case i.PlacementEndings.WithFullGap:n=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case i.PlacementEndings.WithMarkers:n=0;break;case i.PlacementEndings.Custom:n=-this._position,n=this._adjustPosition(n),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._grometryWalker.init(e,this._pattern,r))return null;this._pattern.reset();for(var o=0;n>o;)n-=o,o=this._pattern.nextValue();t=o-=n,this.iteratePath=!0}var a={};return this._grometryWalker.nextPointAndAngle(t,a)?this._endings===i.PlacementEndings.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===i.PlacementEndings.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(a.pt[0]+this._offset*a.sa,a.pt[1]-this._offset*a.ca),this._angleToLine&&this.internalPlacement.setRotateCS(a.ca,a.sa),this.internalPlacement):(this.iteratePath=!1,null)},t.prototype._adjustPosition=function(e){var t=e/this._pattern.length();return(t-=Math.floor(t))*this._pattern.length()},t}(n.PathTransformationCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(t.PlacementEndings||(t.PlacementEndings={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.PlacementAtExtremities=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!1,!0)||this;return o._curveHelper=new i.CurveHelper,o._angleToLine=void 0===r.angleToLine||r.angleToLine,o._offset=void 0!==r.offset?r.offset*n:0,o._type=r.extremityPlacement,o._position=void 0!==r.offsetAlongLine?r.offsetAlongLine*n:0,o._beginProcessed=!1,o}return r.__extends(t,e),t.prototype.processPath=function(e){var t;switch(this._type){case"Both":default:this._beginProcessed?(n.reversePath(e),t=this._atExtremities(e,this._position),n.reversePath(e),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position);break;case"JustEnd":n.reversePath(e),t=this._atExtremities(e,this._position),n.reversePath(e);break;case"None":}return t},t.prototype._atExtremities=function(e,t){for(var r,i=e.length,o=0,a=e[0],s=1;s<i;++s){r=a,a=e[s];var l=this._curveHelper.calculateLength(r,a);if(o+l>t){var c=(t-o)/l,u=this._curveHelper.getAngleCS(r,a,c),p=u[0],d=u[1],h=n.getCoord2D(r,a,c);return this.internalPlacement.setTranslate(h[0]-this._offset*d,h[1]+this._offset*p),this._angleToLine&&this.internalPlacement.setRotateCS(-p,-d),this.internalPlacement}o+=l}return null},t}(n.PathTransformationCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(775)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.PlacementAtRatioPositions=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!0,!0)||this;return o._walker=new i.GeometryWalker,o._walker.updateTolerance(n),o._angleToLine=void 0===r.angleToLine||r.angleToLine,o._offset=void 0!==r.offset?r.offset*n:0,o._beginGap=void 0!==r.beginPosition?r.beginPosition*n:0,o._endGap=void 0!==r.endPosition?r.endPosition*n:0,o._flipFirst=void 0===r.flipFirst||r.flipFirst,o._pattern=new i.DashPattern,o._pattern.init(r.positionArray,!1,!1),o._subPathLen=0,o._posCount=o._pattern.size(),o._isFirst=!0,o._prevPos=0,o}return r.__extends(t,e),t.prototype.processPath=function(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)n=this._pattern.nextValue()*this._subPathLen,t=(r=this._beginGap+n)-this._prevPos,this._prevPos=r;else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();var r,n=this._pattern.nextValue()*this._subPathLen;t=(r=this._beginGap+n)-this._prevPos,this._prevPos=r,this.iteratePath=!0}var i={};if(!this._walker.nextPointAndAngle(t,i,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]+this._offset*i.sa,i.pt[1]-this._offset*i.ca);var o,a,s=this._isFirst&&this._flipFirst;return this._angleToLine?(o=i.ca,a=i.sa):(o=1,a=0),s&&(o=-o,a=-a),this.internalPlacement.setRotateCS(o,a),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement},t}(n.PathTransformationCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.PlacementOnLine=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!0,!0)||this;return o._curveHelper=new i.CurveHelper,o._angleToLine=void 0===r.angleToLine||r.angleToLine,o._offset=void 0!==r.offset?r.offset*n:0,o._relativeTo=r.relativeTo,o._position=void 0!==r.startPointOffset?r.startPointOffset*n:0,o._epsilon=.001*n,o}return r.__extends(t,e),t.prototype.processPath=function(e){var t=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){var r=this._curSegment;this._curSegment++;var i=e[r-1],o=e[r],a=this._curveHelper.calculateLength(i,o);if(!(a<this._epsilon)){var s=.5+this._position/a,l=this._curveHelper.getAngleCS(i,o,s),c=l[0],u=l[1],p=n.getCoord2D(i,o,s);return this.internalPlacement.setTranslate(p[0]-this._offset*u,p[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(c,u),this.internalPlacement}}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&n.reversePath(e);var d=this.onLine(e,t);return"LineEnd"===this._relativeTo&&n.reversePath(e),d},t.prototype.onLine=function(e,t){var r,i=!1;switch(this._relativeTo){case"LineMiddle":default:r=this._curveHelper.calculatePathLength(e)/2+t;break;case"LineBeginning":r=t;break;case"LineEnd":r=t,i=!0}for(var o,a=e.length,s=0,l=e[0],c=1;c<a;++c){o=l,l=e[c];var u=this._curveHelper.calculateLength(o,l);if(s+u>r){var p=(r-s)/u,d=this._curveHelper.getAngleCS(o,l,p),h=d[0],f=d[1],v=n.getCoord2D(o,l,p);return this.internalPlacement.setTranslate(v[0]-this._offset*f,v[1]+this._offset*h),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-h,-f):this.internalPlacement.setRotateCS(h,f)),this.internalPlacement}s+=u}return null},t}(n.PathTransformationCursor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(338),r(367)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.PlacementOnVertices=o;var a=function(e){function t(t,r,n){var o=e.call(this,t,!0,!0)||this;return o._curveHelper=new i.CurveHelper,o._angleToLine=void 0===r.angleToLine||r.angleToLine,o._offset=void 0!==r.offset?r.offset*n:0,o._endPoints=void 0===r.placeOnEndPoints||r.placeOnEndPoints,o._controlPoints=void 0===r.placeOnControlPoints||r.placeOnControlPoints,o._regularVertices=void 0===r.placeOnRegularVertices||r.placeOnRegularVertices,o._tags=[],o._tagIterator=0,o}return r.__extends(t,e),t.prototype.processPath=function(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;var t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);var r=t[0],n=t[1];if(0!==this._offset){var i=Math.cos(t[2]),o=Math.sin(t[2]);r-=this._offset*o,n+=this._offset*i}return this.internalPlacement.setTranslate(r,n),this._tagIterator++,this.internalPlacement},t.prototype._preparePath=function(e){this._tags.length=0,this._tagIterator=0;for(var t,r,i=n.isClosedPath(e),o=e.length-1,a=0,l=0,c=0,u=0,p=0;a<o;){t=e[++a-1],r=e[a];var d=n.getId(t),h=n.getId(r);(this._angleToLine||0!==this._offset)&&(u=this._curveHelper.getAngle(t,r,0)),1===a?i?(l=u,c=d):this._endPoints&&this._tags.push([t[0],t[1],u]):1===d?this._controlPoints&&this._tags.push([t[0],t[1],s(p,u)]):this._regularVertices&&this._tags.push([t[0],t[1],s(p,u)]),(this._angleToLine||0!==this._offset)&&(p=this._curveHelper.getAngle(t,r,1)),a===o&&(i?1===h||1===c?this._controlPoints&&this._tags.push([r[0],r[1],s(p,l)]):this._regularVertices&&this._tags.push([r[0],r[1],s(p,l)]):this._endPoints&&this._tags.push([r[0],r[1],p]))}this._tagIterator=0},t}(n.PathTransformationCursor);function s(e,t){for(var r=Math.PI;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(173),r(353),r(774)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.local=function(){return null===e.instance&&(e.instance=new e),e.instance},e.prototype.execute=function(e,t,r){return new a(e,t,r)},e.instance=null,e}();t.PlacementPolygonCenter=o;var a=function(){function e(e,t,r){this._geometry=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=t.method,this._clipping=t.clipAtBoundary,this._internalPlacement=new i.Placement,this._clipping}return e.prototype.next=function(){var e=this._geometry;return this._geometry=null,e&&void 0!==e.rings?this._polygonCenter(e):null},e.prototype._polygonCenter=function(e){var t=!1;switch(this._method){case"OnPolygon":default:case"CenterOfMass":case"BoundingBoxCenter":var i=r.create();n.getBoundsXY(i,e),this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2-this._offsetY),t=!0}return t?this._internalPlacement:null},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(874)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="sketch",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i(this.cloneProperties())},r.__decorate([n.property({type:["sketch"]})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.symbols.edges.SketchEdges3D")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(874)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="solid",r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i(this.cloneProperties())},r.__decorate([n.property({type:["solid"]})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.symbols.support.SolidEdges3D")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(151),r(428)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="simple-line",r.width=.75,r}return r.__extends(t,e),t.prototype.hash=function(){return this.type+"."+this.width},r.__decorate([i.enumeration({esriSLS:"simple-line"})],t.prototype,"type",void 0),r.__decorate([i.property({type:Number,cast:n.toPt,json:{write:!0}})],t.prototype,"width",void 0),r.__decorate([i.subclass("esri.symbols.LineSymbol")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(151)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.placement="begin-end",r.type="line-marker",r.style="arrow",r}var i;return r.__extends(t,e),i=t,t.prototype.writeType=function(e,t,r,n){"web-map"===(null==n?void 0:n.origin)||(t[r]=e)},t.prototype.writeStyle=function(e,t,r,n){"web-map"===(null==n?void 0:n.origin)?t[r]="arrow":t[r]=e},Object.defineProperty(t.prototype,"color",{set:function(e){this._set("color",e)},enumerable:!0,configurable:!0}),t.prototype.readColor=function(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e},t.prototype.writeColor=function(e,t,r,n){"web-map"===(null==n?void 0:n.origin)||(t[r]=e)},t.prototype.clone=function(){return new i({color:o.clone(this.color),placement:this.placement,style:this.style})},t.prototype.hash=function(){var e;return this.placement+"."+(null===(e=this.color)||void 0===e?void 0:e.hash())+"."+this.style},r.__decorate([a.property({type:["begin","end","begin-end"],json:{default:"begin-end",write:!0}})],t.prototype,"placement",void 0),r.__decorate([a.property({type:String,readOnly:!0})],t.prototype,"type",void 0),r.__decorate([a.writer("type")],t.prototype,"writeType",null),r.__decorate([a.property({type:["arrow","circle","square","diamond","cross","x"]})],t.prototype,"style",void 0),r.__decorate([a.writer("style")],t.prototype,"writeStyle",null),r.__decorate([a.property({type:n,value:null,json:{write:{allowNull:!0}}})],t.prototype,"color",null),r.__decorate([a.reader("color")],t.prototype,"readColor",null),r.__decorate([a.writer("color")],t.prototype,"writeColor",null),i=r.__decorate([a.subclass("esri.symbols.LineSymbolMarker")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(151),r(482)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({color:n.isSome(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode})},r.__decorate([i.enumeration({multiply:"multiply",replace:"replace",tint:"tint"})],t.prototype,"colorMixMode",void 0),o=r.__decorate([i.subclass("esri.symbols.support.Symbol3DFillMaterial")],t)}(o.default);t.Symbol3DFillMaterial=a,t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.x=0,t.y=0,t.z=0,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({x:this.x,y:this.y,z:this.z})},r.__decorate([i.property({type:Number})],t.prototype,"x",void 0),r.__decorate([i.property({type:Number})],t.prototype,"y",void 0),r.__decorate([i.property({type:Number})],t.prototype,"z",void 0),n=r.__decorate([i.subclass("esri.symbols.support.Symbol3DAnchorPosition3D")],t)}(n);t.Symbol3DAnchorPosition3D=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(151),r(386)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=new n([0,0,0,1]),t.size=0,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({color:o.clone(this.color),size:this.size})},r.__decorate([a.property(s.colorAndTransparencyProperty)],t.prototype,"color",void 0),r.__decorate([a.property(s.screenSizeProperty)],t.prototype,"size",void 0),i=r.__decorate([a.subclass("esri.symbols.support.Symbol3DHalo")],t)}(i.JSONSupport);t.Symbol3DHalo=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(151),r(1479)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;return r.field="",r.normalizationField="",r.label="",r.classBreakInfos=[],r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:i.clone(this.classBreakInfos)})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"normalizationField",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([o.property({type:[a.default],json:{write:!0}})],t.prototype,"classBreakInfos",void 0),n=r.__decorate([o.subclass("esri.renderers.support.AuthoringInfoFieldInfo")],t)}(n.JSONSupport);t.AuthoringInfoFieldInfo=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,t)||this;return r.minValue=0,r.maxValue=0,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({minValue:this.minValue,maxValue:this.maxValue})},r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"minValue",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maxValue",void 0),n=r.__decorate([i.subclass("esri.renderer.support.AuthoringInfoClassBreakInfo")],t)}(n.JSONSupport);t.AuthoringInfoClassBreakInfo=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(179),r(776)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.label=null,r.opacity=null,r.value=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readOpacity=function(e,t){return a.transparencyToOpacity(t.transparency)},t.prototype.writeOpacity=function(e,t,r){t[r]=a.opacityToTransparency(e)},t.prototype.clone=function(){return new n({label:this.label,opacity:this.opacity,value:this.value})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([i.property({type:Number,json:{type:o.Integer,write:{target:"transparency"}}})],t.prototype,"opacity",void 0),r.__decorate([i.reader("opacity",["transparency"])],t.prototype,"readOpacity",null),r.__decorate([i.writer("opacity")],t.prototype,"writeOpacity",null),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"value",void 0),n=r.__decorate([i.subclass("esri.renderers.visualVariables.support.OpacityStop")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(166),r(156),r(264),r(151),r(889),r(1132),r(1133),r(433)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=o.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),h={color:l,size:p,opacity:c,rotation:u},f=new i.default({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),v=/^\[([^\]]+)\]$/i;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.colorVariables=null,t.opacityVariables=null,t.rotationVariables=null,t.sizeVariables=null,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"visualVariables",{set:function(e){if(this._resetVariables(),(e=e&&e.filter((function(e){return!!e})))&&e.length){for(var t=0,r=e;t<r.length;t++)switch((i=r[t]).type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some((function(e){return!!e.target}))&&e.sort((function(e,t){return e.target===t.target?0:e.target?1:-1}));for(var n=0;n<e.length;n++){var i;(i=e[n]).index=n}this._set("visualVariables",e)}else this._set("visualVariables",e)},enumerable:!0,configurable:!0}),t.prototype.readVariables=function(e,t,r){var n=t.rotationExpression,i=t.rotationType,o=n&&n.match(v),s=o&&o[1];if(s&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:i,field:s})),e)return e.map((function(e){var t=f.read(e.type),n=h[t];n||(d.warn("Unknown variable type: "+t),r&&r.messages&&r.messages.push(new a("visual-variable:unsupported","visualVariable of type '"+t+"' is not supported",{definition:e,context:r})));var i=new n;return i.read(e,r),i}))},t.prototype.writeVariables=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n].toJSON(t);o&&r.push(o)}return r},t.prototype._resetVariables=function(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]},r.__decorate([s.property()],t.prototype,"visualVariables",null),r.__decorate([s.subclass("esri.renderers.visualVariables.VisualVariableFactory")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(155),r(151),r(354)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.description=null,r.label=null,r.minValue=null,r.maxValue=0,r.symbol=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})},t.prototype.getMeshHash=function(){var e=JSON.stringify(this.symbol);return this.minValue+"."+this.maxValue+"."+e},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([o.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],t.prototype,"minValue",void 0),r.__decorate([o.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],t.prototype,"maxValue",void 0),r.__decorate([o.property({types:n.symbolTypesRenderer,json:{origins:{"web-scene":{types:n.symbolTypesRenderer3D,read:a.read,write:a.writeTarget}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),i=r.__decorate([o.subclass("esri.renderers.support.ClassBreakInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(156),r(151),r(179)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=o.getLogger("esri.renderers.support.AttributeColorInfo");return function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.field=null,r.label=null,r.valueExpression=null,r.valueExpressionTitle=null,r}var i;return r.__extends(t,e),i=t,t.prototype.castField=function(e){return null==e?e:"function"==typeof e?(l.error(".field: field must be a string value"),null):s.ensureString(e)},t.prototype.getAttributeHash=function(){return this.field+"-"+this.valueExpression},t.prototype.clone=function(){return new i({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})},r.__decorate([a.property({type:n,json:{type:[Number],write:!0}})],t.prototype,"color",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),r.__decorate([a.cast("field")],t.prototype,"castField",null),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),i=r.__decorate([a.subclass("esri.renderers.support.AttributeColorInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unit=null,t}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({unit:this.unit})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"unit",void 0),n=r.__decorate([i.subclass("esri.renderers.support.DotDensityLegendOptions")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(239),r(155),r(151),r(354)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.description=null,r.label=null,r.symbol=null,r.value=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})},t.prototype.getMeshHash=function(){var e=JSON.stringify(this.symbol&&this.symbol.toJSON());return this.value+"."+e},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([o.property({types:n.symbolTypesRenderer,json:{origins:{"web-scene":{types:n.symbolTypesRenderer3D,read:a.read,write:a.writeTarget}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"value",void 0),i=r.__decorate([o.subclass("esri.renderers.support.UniqueValueInfo")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){function n(e,t){return!!r("enable-feature:"+e+"/"+t)}Object.defineProperty(t,"__esModule",{value:!0}),t.hasEnableFeature=n,t.enableWebStyleForceWOSR=function(){return n("jschmid","force-wosr")}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(118)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._propertyOriginMap=new Map,this._originStores=new Array(7),this._values=new Map}return e.prototype.clone=function(t){var r=new e,i=this._originStores[0];i&&i.forEach((function(e,t){r.set(t,n.clone(e),0)}));for(var o=function(e){var i=a._originStores[e];i&&i.forEach((function(i,o){t&&t.has(o)||r.set(o,n.clone(i),e)}))},a=this,s=2;s<7;s++)o(s);return r},e.prototype.get=function(e,t){var r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0},e.prototype.keys=function(e){var t=null==e?this._values:this._originStores[e];return t?r.keysOfMap(t):[]},e.prototype.set=function(e,t,r){void 0===r&&(r=6);var n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){var i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),i!==t}return!1},e.prototype.delete=function(e,t){void 0===t&&(t=6);var r=this._originStores[t];if(r){var n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(var i=t-1;i>=0;i--){var o=this._originStores[i];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,i);break}}}return n}},e.prototype.has=function(e,t){var r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)},e.prototype.revert=function(e,t){for(;t>0&&!this.has(e,t);)--t;var r=this._originStores[t],n=r&&r.get(e),i=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,t),i!==n},e.prototype.originOf=function(e){return this._propertyOriginMap.get(e)||0},e.prototype.forEach=function(e){this._values.forEach(e)},e}();t.default=i}.apply(null,n))||(e.exports=i)},,,,,,,,,,,,,,,,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(164),r(156),r(153),r(1504),r(893),r(1507),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=l,t.RemoteClient=c;var p=o("esri-workers-debug")?1:o("host-browser")?navigator.hardwareConcurrency-1:0;p||(p=o("safari")&&o("mac")||o("trident")?7:2);var d=0,h=[],f=a.getLogger("esri.core.workers");function v(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,(r=new l).open(e,t)];case 1:return n.sent(),[2,r]}}))}))}t.initialize=function(e){if(void 0===e&&(e={}),e.maxNumWorkers&&e.maxNumWorkers>0){var t=Math.min(e.maxNumWorkers,p);if(y)return void(t!==p&&f.warn("Web workers already initialized, can't set requested number of workers"));p=t}g()},t.openWithPorts=function(e,t){return v(e,{client:t})},t.open=function(e,t){return void 0===t&&(t={}),n.__awaiter(this,void 0,void 0,(function(){var a,l,u,f;return n.__generator(this,(function(m){switch(m.label){case 0:if("string"!=typeof e)throw new i("workers:undefined-module","modulePath is missing");return a=t.strategy||"distributed",o("host-webworker")&&!o("esri-workers")&&(a="local"),"local"!==a?[3,4]:[4,c.loadWorker(e)];case 1:return(l=m.sent())?[3,3]:[4,new Promise((function(t,n){r.e(28).then(function(){var n=[r(1333)(e)];t.apply(null,n)}.bind(this)).catch(n.bind(this))}))];case 2:l=m.sent(),m.label=3;case 3:return s.throwIfAborted(t.signal),u=t.client||l,[2,v([c.connect(l)],n.__assign(n.__assign({},t),{client:u}))];case 4:return[4,g()];case 5:return m.sent(),s.throwIfAborted(t.signal),"dedicated"!==a?[3,7]:(f=d++,d%=p,[4,h[f].open(e,t)]);case 6:return[2,v([m.sent()],t)];case 7:return[2,v(h.map((function(r){return r.open(e,t)})),t)]}}))}))},t.terminate=function(){y&&(m.abort(),y=null);for(var e=0;e<h.length;e++)h[e]&&h[e].terminate();h.length=0};var m,y=null;function g(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,r;return n.__generator(this,(function(n){if(y)return[2,y];for(m=s.createAbortController(),e=[],t=function(t){var r=u.create(t).then((function(e){return h[t]=e,e}));e.push(r)},r=0;r<p;r++)t(r);return[2,y=s.all(e)]}))}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(759),r(156),r(153),r(893)],void 0===(i=function(e,t,r,n,i,o){var a=n.getLogger("esri.core.workers.Connection");return function(){function e(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}return Object.defineProperty(e.prototype,"closed",{get:function(){return!this._clients||!this._clients.length},enumerable:!0,configurable:!0}),e.prototype.open=function(e,t){var r=this;return i.create((function(n,a){var s=!0,l=function(e){i.throwIfAborted(t.signal),s&&(s=!1,e())};r._clients.length=e.length,r._clientPromises.length=e.length;for(var c=function(s){var c=e[s];if(i.isThenable(c))return r._clientPromises[s]=c.then((function(e){return r._clients[s]=new o(e,t),l(n),r._clients[s]}),(function(){return l(a),null})),"continue";r._clients[s]=new o(c,t),r._clientPromises[s]=i.resolve(r._clients[s]),l(n)},u=0;u<e.length;++u)c(u)}))},e.prototype.broadcast=function(e,t,r){for(var n=new Array(this._clientPromises.length),i=0;i<this._clientPromises.length;++i){var o=this._clientPromises[i];n[i]=o.then((function(n){return n.invoke(e,t,r)}))}return n},e.prototype.close=function(){for(var e=0,t=this._clientPromises;e<t.length;e++)t[e].then((function(e){return e.close()}));this._clients.length=0,this._clientPromises.length=0},e.prototype.getAvailableClient=function(){for(var e,t=0;t<this._clients.length;++t){var r=this._clients[t];if(r){if(!r.isBusy())return i.resolve(r)}else(e=e||[]).push(this._clientPromises[t])}return e?i.first(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,i.resolve(this._clients[this._clientIdx]))},e.prototype.invoke=function(e,t,r){var n=null;return Array.isArray(r)?(a.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r,this.closed?i.reject(new Error("Connection closed")):this.getAvailableClient().then((function(r){return r.invoke(e,t,n)}))},e.prototype.on=function(e,t){var n=this;return i.all(this._clientPromises).then((function(){return r.handlesGroup(n._clients.map((function(r){return r.on(e,t)})))}))},e.prototype.openPorts=function(){var e=this;return i.create((function(t){for(var r=new Array(e._clientPromises.length),n=r.length,i=function(i){e._clientPromises[i].then((function(e){r[i]=e.openPort(),0==--n&&t(r)}))},o=0;o<e._clientPromises.length;++o)i(o)}))},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(161)],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.registry={geometryEngineWorker:function(){return new Promise((function(e,t){Promise.all([r.e(12),r.e(121)]).then(function(){var t=[r(2057)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},CSVSourceWorker:function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(10),r.e(74)]).then(function(){var t=[r(2058)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},EdgeProcessingWorker:function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1295)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},ElevationSamplerWorker:function(){return new Promise((function(e,t){r.e(120).then(function(){var t=[r(2060)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},GeoJSONSourceWorker:function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(10),r.e(75)]).then(function(){var t=[r(2061)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},LercWorker:function(){return new Promise((function(e,t){r.e(135).then(function(){var t=[r(2062)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},MemorySourceWorker:function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(10),r.e(81)]).then(function(){var t=[r(2063)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},PBFDecoderWorker:function(){return new Promise((function(e,t){r.e(92).then(function(){var t=[r(2064)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},Pipeline:function(){return new Promise((function(e,t){r.e(91).then(function(){var t=[r(2065)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},PointCloudWorker:function(){return new Promise((function(e,t){Promise.all([r.e(19),r.e(191)]).then(function(){var t=[r(2068)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},RasterWorker:function(){return new Promise((function(e,t){Promise.all([r.e(14),r.e(124)]).then(function(){var t=[r(2069)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},SceneLayerWorker:function(){return new Promise((function(e,t){r.e(137).then(function(){var t=[r(2070)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},WorkerTileHandler:function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(50)]).then(function(){var t=[r(2072)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCHEDULER_LOG_SLOW_TASKS=!1,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),r.__decorate([i.subclass("esri.views.support.DebugFlags")],t)}(n))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(336),r(154),r(156),r(153),r(785),r(1508)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=o.getLogger("esri.core.workers"),u=s.MessageType.ABORT,p=s.MessageType.INVOKE,d=s.MessageType.OPEN,h=s.MessageType.OPENED,f=s.MessageType.RESPONSE;return function(){function e(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(function(e){e.preventDefault(),c.error(e)}))}return e.create=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,l.createWorker()];case 1:return[2,new e(r.sent(),t)]}}))}))},e.prototype.terminate=function(){this.worker.terminate()},e.prototype.open=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o=this;return r.__generator(this,(function(r){return n=t.signal,i=s.newJobId(),[2,a.create((function(t,r){var s={resolve:t,reject:r};a.onAbortOrThrow(n,(function(){o._outJobs.delete(i),o._post({type:u,jobId:i})})),o._outJobs.set(i,s),o._post({type:d,jobId:i,modulePath:e})}))]}))}))},e.prototype._onMessage=function(e){var t=s.receiveMessage(e);if(t)switch(t.type){case h:this._onOpenedMessage(t);break;case f:this._onResponseMessage(t);break;case u:this._onAbortMessage(t);break;case p:this._onInvokeMessage(t)}},e.prototype._onAbortMessage=function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);n&&(n.controller&&n.controller.abort(),t.delete(r))},e.prototype._onInvokeMessage=function(e){var t,r=this,i=e.methodName,o=e.jobId,l=e.data,c=e.abortable?a.createAbortController():null,u=this._inJobs,p=n.workerMessages[i];try{if("function"!=typeof p)throw new TypeError(i+" is not a function");t=p.call(null,l,{signal:c?c.signal:null})}catch(e){return void this._post({type:f,jobId:o,error:s.toInvokeError(e)})}a.isPromiseLike(t)?(u.set(o,{controller:c,promise:t}),t.then((function(e){u.has(o)&&(u.delete(o),r._post({type:f,jobId:o},e))}),(function(e){u.has(o)&&(u.delete(o),e||(e={message:"Error encountered at method"+i}),a.isAbortError(e)||r._post({type:f,jobId:o,error:s.toInvokeError(e||{message:"Error encountered at method "+i})}))}))):this._post({type:f,jobId:o},t)},e.prototype._onOpenedMessage=function(e){var t=e.jobId,r=e.data,n=this._outJobs.get(t);n&&(this._outJobs.delete(t),n.resolve(r))},e.prototype._onResponseMessage=function(e){var t=e.jobId,r=e.error,n=e.data,o=this._outJobs.get(t);o&&(this._outJobs.delete(t),r?o.reject(i.fromJSON(JSON.parse(r))):o.resolve(n))},e.prototype._post=function(e,t,r){return s.postMessage(this.worker,e,t,r)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(258),r(164),r(156),r(153),r(1509),r(785),r(1510)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=a.getLogger("esri.core.workers");o.add("esri-workers-arraybuffer-transfer",!o("safari")||o("safari")>=12);var d,h=c.MessageType.CONFIGURED,f=c.MessageType.CONFIGURE,v=c.MessageType.HANDSHAKE;try{d=URL.createObjectURL(new Blob(['var globalId=0,outgoing=new Map,configured=!1,HANDSHAKE=0,CONFIGURE=1,CONFIGURED=2,OPEN=3,OPENED=4,RESPONSE=5,INVOKE=6,ABORT=7;function createAbortError(){var error=new Error("Aborted");return error.name="AbortError",error}function receiveMessage(event){return event&&event.data?"string"==typeof event.data?JSON.parse(event.data):event.data:null}function invokeStaticMessage(methodName,data,options){var signal=options&&options.signal,jobId=globalId++;return new Promise((function(resolve,reject){if(signal){if(signal.aborted)return reject(createAbortError());signal.addEventListener("abort",(function(){outgoing.get(jobId)&&(outgoing.delete(jobId),self.postMessage({type:ABORT,jobId:jobId}),reject(createAbortError()))}))}outgoing.set(jobId,{resolve:resolve,reject:reject}),self.postMessage({type:INVOKE,jobId:jobId,methodName:methodName,abortable:null!=signal,data:data})}))}function messageHandler(event){var message=receiveMessage(event);if(message){var jobId=message.jobId;switch(message.type){case CONFIGURE:var configuration=message.configure;if(configured)return;configured=!0,self.dojoConfig=configuration.loaderConfig,self.importScripts(configuration.loaderUrl),"function"==typeof require.config&&require.config(configuration.loaderConfig),self.esriConfig=configuration.esriConfig,self.postMessage({type:CONFIGURED});break;case OPEN:var modulePath=message.modulePath;require(["esri/core/workers/RemoteClient"],(function(RemoteClient){RemoteClient.loadWorker(modulePath).then((function(Module){return Module||new Promise((function(resolve){require([modulePath],resolve)}))})).then((function(Module){var port=RemoteClient.connect(Module);self.postMessage({type:OPENED,jobId:jobId,data:port},[port])}))}));break;case RESPONSE:if(outgoing.has(jobId)){var deferred=outgoing.get(jobId);outgoing.delete(jobId),message.error?deferred.reject(JSON.parse(message.error)):deferred.resolve(message.data)}}}}self.addEventListener("message",messageHandler),self.postMessage({type:HANDSHAKE});'],{type:"text/javascript"}))}catch(e){}var m="Failed to create Worker. Fallback to execute module in main thread";function y(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,s.create((function(t){function a(u){var p=c.receiveMessage(u);if(p)switch(p.type){case v:!function(e){var t,a=n.workers.loaderUrl||l.DEFAULT_LOADER_URL;if(null!=n.default){var s=r.__assign({},n);delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(n));t.locale=i.getLocale(),t.has={"csp-restrictions":o("csp-restrictions"),"esri-2d-debug":o("esri-2d-debug"),"esri-atomics":o("esri-atomics"),"esri-secure-context":o("esri-secure-context"),"esri-shared-array-buffer":o("esri-shared-array-buffer"),"esri-webgl-max-texture-size":o("esri-webgl-max-texture-size"),"esri-webgl-texture-float":o("esri-webgl-texture-float"),"esri-workers-arraybuffer-transfer":o("esri-workers-arraybuffer-transfer"),"host-webworker":1};var c=n.workers.loaderConfig,u=l.default({baseUrl:c.baseUrl,locale:i.getLocale(),has:r.__assign({"csp-restrictions":o("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1},c.has),map:r.__assign({},c.map),paths:r.__assign({},c.paths),packages:c.packages||[]});e.postMessage({type:f,configure:{esriConfig:t,loaderUrl:a,loaderConfig:u}})}(e);break;case h:e.removeEventListener("message",a),e.removeEventListener("error",s),t(e)}}function s(t){t.preventDefault(),e.removeEventListener("message",a),e.removeEventListener("error",s),p.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new u).addEventListener("message",a),e.addEventListener("error",s)}e.addEventListener("message",a),e.addEventListener("error",s)}))]}))}))}t.createWorker=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){if(!o("esri-workers"))return[2,y(new u)];if(d)try{e=new Worker(d)}catch(t){p.warn(m,event),e=new u}else p.warn(m,event),e=new u;return[2,y(e)]}))}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(164),r(172)],void 0===(i=function(e,t,r,n,i){function o(t){return i.removeQueryParameters(e.toUrl(t))}Object.defineProperty(t,"__esModule",{value:!0});var a,s=n("esri-built")?"dojo/dojo-lite.js":"dojo/dojo.js";t.DEFAULT_LOADER_URL=i.makeAbsolute(o(s)),t.DEFAULT_CONFIG={baseUrl:(a=o("dojo/x.js"),i.makeAbsolute(a.slice(0,a.length-5))),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}},t.default=function(e){var n={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:r.__assign({},e.has),map:r.__assign({},e.map),packages:e.packages&&e.packages.concat()||[],paths:r.__assign({},e.paths)};e.hasOwnProperty("async")||(n.async=!0),e.hasOwnProperty("isDebug")||(n.isDebug=!1),e.baseUrl||(n.baseUrl=t.DEFAULT_CONFIG.baseUrl),t.DEFAULT_CONFIG.packages.forEach((function(e){!function(e,t){for(var n=0,a=e;n<a.length;n++)if(a[n].name===t.name)return;var s=r.__assign({},t),l=o(s.name+"/x.js"),c=l.slice(0,l.length-5);s.location=i.makeAbsolute(c),e.push(s)}(n.packages,e)}));for(var a=n.map=n.map||{},s=0,l=Object.keys(t.DEFAULT_CONFIG.map);s<l.length;s++){var c=l[s];a[c]||(a[c]=t.DEFAULT_CONFIG.map[c])}return n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(121),r(893),r(785),r(161)],void 0===(i=function(e,t,n,i,o,a){var s=function(){var e=this,t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((function(r){e[r]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t[r].apply(t,e)}}))},l=i.MutationObserver||i.WebKitMutationObserver,c=function(){var e;if(i.process&&i.process.nextTick)e=function(e){i.process.nextTick(e)};else if(i.Promise)e=function(e){i.Promise.resolve().then(e)};else if(l){var t=[],r=document.createElement("div");new l((function(){for(;t.length>0;)t.shift()()})).observe(r,{attributes:!0}),e=function(e){t.push(e),r.setAttribute("queueStatus","1")}}return e}(),u=function(){var e=i.MessageEvent;try{new e("message",{data:null})}catch(e){return function(e,t){void 0===t&&(t={});var r=t.data,n=t.bubbles,i=void 0!==n&&n,o=t.cancelable,a=void 0!==o&&o,s=document.createEvent("Event");return s.initEvent(e,i,a),s.data=r,s}}return function(t,r){return new e(t,r)}}();return function(){function e(){this._dispatcher=new s,this._isInitialized=!1,this._workerPostMessage({type:a.MessageType.HANDSHAKE})}return e.prototype.terminate=function(){},Object.defineProperty(e.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)},enumerable:!0,configurable:!0}),e.prototype.postMessage=function(e){var t=this;c((function(){t._workerMessageHandler(u("message",{data:e}))}))},e.prototype.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},e.prototype.addEventListener=function(e,t,r){this._dispatcher.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t,r){this._dispatcher.removeEventListener(e,t,r)},e.prototype._workerPostMessage=function(e){var t=this;c((function(){t.dispatchEvent(u("message",{data:e}))}))},e.prototype._workerMessageHandler=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,i,s,l,c;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(t=a.receiveMessage(e)))return[2];switch(t.type){case a.MessageType.CONFIGURE:return[3,1];case a.MessageType.OPEN:return[3,2]}return[3,6];case 1:return this._isInitialized||this._workerPostMessage({type:a.MessageType.CONFIGURED}),[3,6];case 2:return i=t.modulePath,s=t.jobId,[4,o.loadWorker(i)];case 3:return(l=n.sent())?[3,5]:[4,new Promise((function(e,t){r.e(28).then(function(){var t=[r(1333)(i)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 4:l=n.sent(),n.label=5;case 5:return c=o.connect(l),this._workerPostMessage({type:a.MessageType.OPENED,jobId:s,data:c}),[3,6];case 6:return[2]}}))}))},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.supportedTypes={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,VectorTileLayer:!0,WMS:!0,KML:!0,RasterDataLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,ArcGISFeatureLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0,CSV:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,VectorTileLayer:!0,WFS:!0,SubtypeGroupLayer:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"portal-item/operational-layers":{ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(191)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r.__extends(t,e),n=t,t.prototype.collectRequiredFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,o.collectArcadeFieldNames(e,t,this.expression)]}))}))},t.prototype.clone=function(){return new n({expression:this.expression,title:this.title})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),n=r.__decorate([i.subclass("esri.layers.support.FeatureExpressionInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(899)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var n;return r.__extends(t,e),n=t,t.prototype.readExpression=function(e,t){return t.value?o.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=o.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new n({value:this.value,expression:this.expression})},r.__decorate([i.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),r.__decorate([i.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),r.__decorate([i.reader("expression",["expression","value"])],t.prototype,"readExpression",null),r.__decorate([i.writer("expression")],t.prototype,"writeExpression",null),n=r.__decorate([i.subclass("esri.layers.support.LabelExpressionInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},,function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(180),r(154),r(118)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),n=r%8,i=r>>3,o=this._tileAvailabilityBitSet;return i<0||i>o.length?"unknown":o[i]&1<<n?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,r=this.location.height,n=!0,i=!0,o=Math.ceil(t*r/8),a=new Uint8Array(o),s=0,l=0;l<e.length;l++){var c=l%8;e[l]?(i=!1,a[s]|=1<<c):n=!1,7===c&&++s}i?this._allAvailability="unavailable":n?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)},e.fromDefinition=function(t,a){var s=t.service.request||n,c=t.row,u=t.col,p=t.width,d=t.height,h={query:{f:"json"}};return a=a?r.__assign(r.__assign({},h),a):h,s(l(t),a).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:c,left:u,width:p,height:d},valid:!0,data:i.constant(p*d,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==c||t.location.left!==u||t.location.width!==p||t.location.height!==d))throw new o("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:c,left:u,width:p,height:d}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);var r=new e;return r.location=Object.freeze(a.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new o("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function l(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var r=e.service.tileServers;t=(r&&r.length?r[e.row%r.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var n=e.service.query;return n&&(t=t+"?"+n),t}t.Tilemap=s,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=l,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){"use strict";
/** @license React v16.13.1
 * react-dom-server.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(109),i=r(2);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a="function"==typeof Symbol&&Symbol.for,s=a?Symbol.for("react.portal"):60106,l=a?Symbol.for("react.fragment"):60107,c=a?Symbol.for("react.strict_mode"):60108,u=a?Symbol.for("react.profiler"):60114,p=a?Symbol.for("react.provider"):60109,d=a?Symbol.for("react.context"):60110,h=a?Symbol.for("react.concurrent_mode"):60111,f=a?Symbol.for("react.forward_ref"):60112,v=a?Symbol.for("react.suspense"):60113,m=a?Symbol.for("react.suspense_list"):60120,y=a?Symbol.for("react.memo"):60115,g=a?Symbol.for("react.lazy"):60116,_=a?Symbol.for("react.block"):60121,b=a?Symbol.for("react.fundamental"):60117,x=a?Symbol.for("react.scope"):60119;function w(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case l:return"Fragment";case s:return"Portal";case u:return"Profiler";case c:return"StrictMode";case v:return"Suspense";case m:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case d:return"Context.Consumer";case p:return"Context.Provider";case f:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case y:return w(e.type);case _:return w(e.render);case g:if(e=1===e._status?e._result:null)return w(e)}return null}var S=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;S.hasOwnProperty("ReactCurrentDispatcher")||(S.ReactCurrentDispatcher={current:null}),S.hasOwnProperty("ReactCurrentBatchConfig")||(S.ReactCurrentBatchConfig={suspense:null});var P={};function T(e,t){for(var r=0|e._threadCount;r<=t;r++)e[r]=e._currentValue2,e._threadCount=r+1}for(var O=new Uint16Array(16),C=0;15>C;C++)O[C]=C+1;O[15]=0;var M=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A=Object.prototype.hasOwnProperty,E={},I={};function R(e){return!!A.call(I,e)||!A.call(E,e)&&(M.test(e)?I[e]=!0:(E[e]=!0,!1))}function D(e,t,r,n,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o}var L={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){L[e]=new D(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];L[t]=new D(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){L[e]=new D(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){L[e]=new D(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){L[e]=new D(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){L[e]=new D(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){L[e]=new D(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){L[e]=new D(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){L[e]=new D(e,5,!1,e.toLowerCase(),null,!1)}));var j=/[\-:]([a-z])/g;function V(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(j,V);L[t]=new D(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(j,V);L[t]=new D(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(j,V);L[t]=new D(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){L[e]=new D(e,1,!1,e.toLowerCase(),null,!1)})),L.xlinkHref=new D("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){L[e]=new D(e,1,!1,e.toLowerCase(),null,!0)}));var F=/["'&<>]/;function N(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=F.exec(e);if(t){var r,n="",i=0;for(r=t.index;r<e.length;r++){switch(e.charCodeAt(r)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}i!==r&&(n+=e.substring(i,r)),i=r+1,n+=t}e=i!==r?n+e.substring(i,r):n}return e}function k(e,t){var r,n=L.hasOwnProperty(e)?L[e]:null;return(r="style"!==e)&&(r=null!==n?0===n.type:2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])),r||function(e,t,r,n){if(null==t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(e,t,n,!1)?"":null!==n?(e=n.attributeName,3===(r=n.type)||4===r&&!0===t?e+'=""':(n.sanitizeURL&&(t=""+t),e+'="'+N(t)+'"')):R(e)?e+'="'+N(t)+'"':""}var z="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},U=null,B=null,G=null,H=!1,q=!1,W=null,J=0;function Z(){if(null===U)throw Error(o(321));return U}function X(){if(0<J)throw Error(o(312));return{memoizedState:null,queue:null,next:null}}function Y(){return null===G?null===B?(H=!1,B=G=X()):(H=!0,G=B):null===G.next?(H=!1,G=G.next=X()):(H=!0,G=G.next),G}function Q(e,t,r,n){for(;q;)q=!1,J+=1,G=null,r=e(t,n);return B=U=null,J=0,G=W=null,r}function K(e,t){return"function"==typeof t?t(e):t}function $(e,t,r){if(U=Z(),G=Y(),H){var n=G.queue;if(t=n.dispatch,null!==W&&void 0!==(r=W.get(n))){W.delete(n),n=G.memoizedState;do{n=e(n,r.action),r=r.next}while(null!==r);return G.memoizedState=n,[n,t]}return[G.memoizedState,t]}return e=e===K?"function"==typeof t?t():t:void 0!==r?r(t):t,G.memoizedState=e,e=(e=G.queue={last:null,dispatch:null}).dispatch=ee.bind(null,U,e),[G.memoizedState,e]}function ee(e,t,r){if(!(25>J))throw Error(o(301));if(e===U)if(q=!0,e={action:r,next:null},null===W&&(W=new Map),void 0===(r=W.get(t)))W.set(t,e);else{for(t=r;null!==t.next;)t=t.next;t.next=e}}function te(){}var re=0,ne={readContext:function(e){var t=re;return T(e,t),e[t]},useContext:function(e){Z();var t=re;return T(e,t),e[t]},useMemo:function(e,t){if(U=Z(),t=void 0===t?null:t,null!==(G=Y())){var r=G.memoizedState;if(null!==r&&null!==t){e:{var n=r[1];if(null===n)n=!1;else{for(var i=0;i<n.length&&i<t.length;i++)if(!z(t[i],n[i])){n=!1;break e}n=!0}}if(n)return r[0]}}return e=e(),G.memoizedState=[e,t],e},useReducer:$,useRef:function(e){U=Z();var t=(G=Y()).memoizedState;return null===t?(e={current:e},G.memoizedState=e):t},useState:function(e){return $(K,e)},useLayoutEffect:function(){},useCallback:function(e){return e},useImperativeHandle:te,useEffect:te,useDebugValue:te,useResponder:function(e,t){return{props:t,responder:e}},useDeferredValue:function(e){return Z(),e},useTransition:function(){return Z(),[function(e){e()},!1]}},ie="http://www.w3.org/1999/xhtml";function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}var ae={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},se=n({menuitem:!0},ae),le={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ce=["Webkit","ms","Moz","O"];Object.keys(le).forEach((function(e){ce.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),le[t]=le[e]}))}));var ue=/([A-Z])/g,pe=/^ms-/,de=i.Children.toArray,he=S.ReactCurrentDispatcher,fe={listing:!0,pre:!0,textarea:!0},ve=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,me={},ye={};var ge=Object.prototype.hasOwnProperty,_e={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null,suppressHydrationWarning:null};function be(e,t){if(void 0===e)throw Error(o(152,w(t)||"Component"))}function xe(e,t,r){function a(i,a){var s=a.prototype&&a.prototype.isReactComponent,l=function(e,t,r,n){if(n&&("object"==typeof(n=e.contextType)&&null!==n))return T(n,r),n[r];if(e=e.contextTypes){for(var i in r={},e)r[i]=t[i];t=r}else t=P;return t}(a,t,r,s),c=[],u=!1,p={isMounted:function(){return!1},enqueueForceUpdate:function(){if(null===c)return null},enqueueReplaceState:function(e,t){u=!0,c=[t]},enqueueSetState:function(e,t){if(null===c)return null;c.push(t)}};if(s){if(s=new a(i.props,l,p),"function"==typeof a.getDerivedStateFromProps){var d=a.getDerivedStateFromProps.call(null,i.props,s.state);null!=d&&(s.state=n({},s.state,d))}}else if(U={},s=a(i.props,l,p),null==(s=Q(a,i.props,s,l))||null==s.render)return void be(e=s,a);if(s.props=i.props,s.context=l,s.updater=p,void 0===(p=s.state)&&(s.state=p=null),"function"==typeof s.UNSAFE_componentWillMount||"function"==typeof s.componentWillMount)if("function"==typeof s.componentWillMount&&"function"!=typeof a.getDerivedStateFromProps&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&"function"!=typeof a.getDerivedStateFromProps&&s.UNSAFE_componentWillMount(),c.length){p=c;var h=u;if(c=null,u=!1,h&&1===p.length)s.state=p[0];else{d=h?p[0]:s.state;var f=!0;for(h=h?1:0;h<p.length;h++){var v=p[h];null!=(v="function"==typeof v?v.call(s,d,i.props,l):v)&&(f?(f=!1,d=n({},d,v)):n(d,v))}s.state=d}}else c=null;if(be(e=s.render(),a),"function"==typeof s.getChildContext&&"object"==typeof(i=a.childContextTypes)){var m=s.getChildContext();for(var y in m)if(!(y in i))throw Error(o(108,w(a)||"Unknown",y))}m&&(t=n({},t,m))}for(;i.isValidElement(e);){var s=e,l=s.type;if("function"!=typeof l)break;a(s,l)}return{child:e,context:t}}var we=function(){function e(e,t){i.isValidElement(e)?e.type!==l?e=[e]:(e=e.props.children,e=i.isValidElement(e)?[e]:de(e)):e=de(e),e={type:null,domNamespace:ie,children:e,childIndex:0,context:P,footer:""};var r=O[0];if(0===r){var n=O,a=2*(r=n.length);if(!(65536>=a))throw Error(o(304));var s=new Uint16Array(a);for(s.set(n),(O=s)[0]=r+1,n=r;n<a-1;n++)O[n]=n+1;O[a-1]=0}else O[0]=O[r];this.threadID=r,this.stack=[e],this.exhausted=!1,this.currentSelectValue=null,this.previousWasTextNode=!1,this.makeStaticMarkup=t,this.suspenseDepth=0,this.contextIndex=-1,this.contextStack=[],this.contextValueStack=[]}var t=e.prototype;return t.destroy=function(){if(!this.exhausted){this.exhausted=!0,this.clearProviders();var e=this.threadID;O[e]=O[0],O[0]=e}},t.pushProvider=function(e){var t=++this.contextIndex,r=e.type._context,n=this.threadID;T(r,n);var i=r[n];this.contextStack[t]=r,this.contextValueStack[t]=i,r[n]=e.props.value},t.popProvider=function(){var e=this.contextIndex,t=this.contextStack[e],r=this.contextValueStack[e];this.contextStack[e]=null,this.contextValueStack[e]=null,this.contextIndex--,t[this.threadID]=r},t.clearProviders=function(){for(var e=this.contextIndex;0<=e;e--)this.contextStack[e][this.threadID]=this.contextValueStack[e]},t.read=function(e){if(this.exhausted)return null;var t=re;re=this.threadID;var r=he.current;he.current=ne;try{for(var n=[""],i=!1;n[0].length<e;){if(0===this.stack.length){this.exhausted=!0;var a=this.threadID;O[a]=O[0],O[0]=a;break}var s=this.stack[this.stack.length-1];if(i||s.childIndex>=s.children.length){var l=s.footer;if(""!==l&&(this.previousWasTextNode=!1),this.stack.pop(),"select"===s.type)this.currentSelectValue=null;else if(null!=s.type&&null!=s.type.type&&s.type.type.$$typeof===p)this.popProvider(s.type);else if(s.type===v){this.suspenseDepth--;var c=n.pop();if(i){i=!1;var u=s.fallbackFrame;if(!u)throw Error(o(303));this.stack.push(u),n[this.suspenseDepth]+="\x3c!--$!--\x3e";continue}n[this.suspenseDepth]+=c}n[this.suspenseDepth]+=l}else{var d=s.children[s.childIndex++],h="";try{h+=this.render(d,s.context,s.domNamespace)}catch(e){if(null!=e&&"function"==typeof e.then)throw Error(o(294));throw e}n.length<=this.suspenseDepth&&n.push(""),n[this.suspenseDepth]+=h}}return n[0]}finally{he.current=r,re=t}},t.render=function(e,t,r){if("string"==typeof e||"number"==typeof e)return""===(r=""+e)?"":this.makeStaticMarkup?N(r):this.previousWasTextNode?"\x3c!-- --\x3e"+N(r):(this.previousWasTextNode=!0,N(r));if(e=(t=xe(e,t,this.threadID)).child,t=t.context,null===e||!1===e)return"";if(!i.isValidElement(e)){if(null!=e&&null!=e.$$typeof){if((r=e.$$typeof)===s)throw Error(o(257));throw Error(o(258,r.toString()))}return e=de(e),this.stack.push({type:null,domNamespace:r,children:e,childIndex:0,context:t,footer:""}),""}var a=e.type;if("string"==typeof a)return this.renderDOM(e,t,r);switch(a){case c:case h:case u:case m:case l:return e=de(e.props.children),this.stack.push({type:null,domNamespace:r,children:e,childIndex:0,context:t,footer:""}),"";case v:throw Error(o(294))}if("object"==typeof a&&null!==a)switch(a.$$typeof){case f:U={};var _=a.render(e.props,e.ref);return _=Q(a.render,e.props,_,e.ref),_=de(_),this.stack.push({type:null,domNamespace:r,children:_,childIndex:0,context:t,footer:""}),"";case y:return e=[i.createElement(a.type,n({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:r,children:e,childIndex:0,context:t,footer:""}),"";case p:return r={type:e,domNamespace:r,children:a=de(e.props.children),childIndex:0,context:t,footer:""},this.pushProvider(e),this.stack.push(r),"";case d:a=e.type,_=e.props;var w=this.threadID;return T(a,w),a=de(_.children(a[w])),this.stack.push({type:e,domNamespace:r,children:a,childIndex:0,context:t,footer:""}),"";case b:throw Error(o(338));case g:switch(function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(a=e.type),a._status){case 1:return e=[i.createElement(a._result,n({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:r,children:e,childIndex:0,context:t,footer:""}),"";case 2:throw a._result;default:throw Error(o(295))}case x:throw Error(o(343))}throw Error(o(130,null==a?a:typeof a,""))},t.renderDOM=function(e,t,r){var a=e.type.toLowerCase();if(r===ie&&oe(a),!me.hasOwnProperty(a)){if(!ve.test(a))throw Error(o(65,a));me[a]=!0}var s=e.props;if("input"===a)s=n({type:void 0},s,{defaultChecked:void 0,defaultValue:void 0,value:null!=s.value?s.value:s.defaultValue,checked:null!=s.checked?s.checked:s.defaultChecked});else if("textarea"===a){var l=s.value;if(null==l){l=s.defaultValue;var c=s.children;if(null!=c){if(null!=l)throw Error(o(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(o(93));c=c[0]}l=""+c}null==l&&(l="")}s=n({},s,{value:void 0,children:""+l})}else if("select"===a)this.currentSelectValue=null!=s.value?s.value:s.defaultValue,s=n({},s,{value:void 0});else if("option"===a){c=this.currentSelectValue;var u=function(e){if(null==e)return e;var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(s.children);if(null!=c){var p=null!=s.value?s.value+"":u;if(l=!1,Array.isArray(c)){for(var d=0;d<c.length;d++)if(""+c[d]===p){l=!0;break}}else l=""+c===p;s=n({selected:void 0,children:void 0},s,{selected:l,children:u})}}if(l=s){if(se[a]&&(null!=l.children||null!=l.dangerouslySetInnerHTML))throw Error(o(137,a,""));if(null!=l.dangerouslySetInnerHTML){if(null!=l.children)throw Error(o(60));if("object"!=typeof l.dangerouslySetInnerHTML||!("__html"in l.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=l.style&&"object"!=typeof l.style)throw Error(o(62,""))}for(b in l=s,c=this.makeStaticMarkup,u=1===this.stack.length,p="<"+e.type,l)if(ge.call(l,b)){var h=l[b];if(null!=h){if("style"===b){d=void 0;var f="",v="";for(d in h)if(h.hasOwnProperty(d)){var m=0===d.indexOf("--"),y=h[d];if(null!=y){if(m)var g=d;else if(g=d,ye.hasOwnProperty(g))g=ye[g];else{var _=g.replace(ue,"-$1").toLowerCase().replace(pe,"-ms-");g=ye[g]=_}f+=v+g+":",v=d,f+=m=null==y||"boolean"==typeof y||""===y?"":m||"number"!=typeof y||0===y||le.hasOwnProperty(v)&&le[v]?(""+y).trim():y+"px",v=";"}}h=f||null}d=null;e:if(m=a,y=l,-1===m.indexOf("-"))m="string"==typeof y.is;else switch(m){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":m=!1;break e;default:m=!0}m?_e.hasOwnProperty(b)||(d=R(d=b)&&null!=h?d+'="'+N(h)+'"':""):d=k(b,h),d&&(p+=" "+d)}}c||u&&(p+=' data-reactroot=""');var b=p;l="",ae.hasOwnProperty(a)?b+="/>":(b+=">",l="</"+e.type+">");e:{if(null!=(c=s.dangerouslySetInnerHTML)){if(null!=c.__html){c=c.__html;break e}}else if("string"==typeof(c=s.children)||"number"==typeof c){c=N(c);break e}c=null}return null!=c?(s=[],fe.hasOwnProperty(a)&&"\n"===c.charAt(0)&&(b+="\n"),b+=c):s=de(s.children),e=e.type,r=null==r||"http://www.w3.org/1999/xhtml"===r?oe(e):"http://www.w3.org/2000/svg"===r&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":r,this.stack.push({domNamespace:r,type:a,children:s,childIndex:0,context:t,footer:l}),this.previousWasTextNode=!1,b},e}(),Se={renderToString:function(e){e=new we(e,!1);try{return e.read(1/0)}finally{e.destroy()}},renderToStaticMarkup:function(e){e=new we(e,!0);try{return e.read(1/0)}finally{e.destroy()}},renderToNodeStream:function(){throw Error(o(207))},renderToStaticNodeStream:function(){throw Error(o(208))},version:"16.13.1"};e.exports=Se.default||Se},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,t)||this;return r.type="none",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({type:this.type})},r.__decorate([i.enumeration({none:"none",stayAbove:"stay-above"})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.ground.NavigationConstraint")],t)}(n.JSONSupport);t.NavigationConstraint=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(907),r(156),r(179)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=n.getLogger("esri.support.groundUtils");t.groundElevationLayers={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}},t.ensureType=function(e){var n;if("string"==typeof e)if(e in t.groundElevationLayers){var a=t.groundElevationLayers[e];n=new r({resourceInfo:{data:{layers:[a]}}})}else o.warn("Unable to find ground definition for: "+e+'. Try "world-elevation"');else n=i.default(r,e);return n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(151),r(621),r(388)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.items=new i,t._watchUpdatingTracking=new s.WatchUpdatingTracking,t._callbacks=new Map,t._projector=a.createProjector(),t._hiddenProjector=a.createProjector(),t}return r.__extends(t,e),Object.defineProperty(t.prototype,"needsRender",{get:function(){return this.items.length>0},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this,t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(function(t){t.added.map((function(t){var r=function(){return t.render()};e._callbacks.set(t,r),e._projector.append(e.surface,r)})),t.removed.map((function(t){var r=e._projector.detach(e._callbacks.get(t));e.surface.removeChild(r.domNode),e._callbacks.delete(t)}))}))},t.prototype.addItem=function(e){this.items.add(e)},t.prototype.removeItem=function(e){this.items.remove(e)},t.prototype.destroy=function(){this.items.removeAll(),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()},t.prototype.render=function(){this._projector.renderNow()},t.prototype.computeBoundingRect=function(e){var t=this._hiddenSurface,r=this._hiddenProjector,n=null,i=function(){return n=e.render()};r.append(t,i),r.renderNow();var o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){var a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(i);t.firstChild;)t.removeChild(t.firstChild);return o},t.prototype.overlaps=function(e,t){var r=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)},Object.defineProperty(t.prototype,"hasVisibleItems",{get:function(){return this.items.some((function(e){return e.visible}))},enumerable:!0,configurable:!0}),t.prototype.renderCanvas=function(e){if(this.items.some((function(e){return e.visible}))){var t=e.getContext("2d");t.save(),t.font="10px "+getComputedStyle(this.surface).fontFamily,this.items.forEach((function(e){t.save(),e.renderCanvas(t),t.restore()})),t.restore()}},r.__decorate([o.property({readOnly:!0})],t.prototype,"surface",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"items",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["items.length"]})],t.prototype,"needsRender",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"_watchUpdatingTracking",void 0),r.__decorate([o.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],t.prototype,"updating",void 0),r.__decorate([o.subclass("esri.views.overlay.ViewOverlay")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(258),r(169),r(335),r(270),r(167),r(156),r(516),r(157),r(151),r(1522),r(188),r(910),r(1524),r(183),r(576),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){var _="esri-icon-left-triangle-arrow",b="esri-icon-right-triangle-arrow",x="esri-icon-loading-indicator",w="esri-rotating",S="esri-popup--shadow",P="esri-popup__button",T="esri-popup__icon",O={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function C(e,t){return void 0===t?"esri-popup__"+e:"esri-popup__"+e+"-"+t}var M=c.getLogger("esri.widgets.Popup"),A={closeButton:!0,featureNavigation:!0};return function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._blurContainer=!1,i._containerNode=null,i._mainContainerNode=null,i._featureMenuNode=null,i._actionsMenuNode=null,i._focusContainer=!1,i._focusDockButton=!1,i._focusFeatureMenuButton=!1,i._focusActionsMenuButton=!1,i._focusFirstFeature=!1,i._focusFirstAction=!1,i._handles=new l,i._pointerOffsetInPx=16,i._spinner=null,i._displaySpinnerThrottled=u.throttle((function(){return i._displaySpinner()}),0),i.actions=null,i.alignment="auto",i.autoCloseEnabled=null,i.autoOpenEnabled=null,i.defaultPopupTemplateEnabled=null,i.content=null,i.collapsed=!1,i.collapseEnabled=!0,i.dockEnabled=!1,i.featureCount=null,i.featureMenuOpen=!1,i.features=null,i.goToOverride=null,i.highlightEnabled=null,i.location=null,i.featureWidgets=[],i.label=void 0,i.maxInlineActions=3,i.messages=null,i.messagesCommon=null,i.promises=null,i.selectedFeature=null,i.selectedFeatureIndex=null,i.selectedFeatureWidget=null,i.spinnerEnabled=!0,i.title=null,i.updateLocationEnabled=null,i.view=null,i.viewModel=new m,i.visible=null,i.visibleElements=n.__assign({},A),i._addSelectedFeatureIndexHandle(),i.own([p.watch(i,"viewModel.screenLocation",(function(){return i._positionContainer()})),p.watch(i,["viewModel.visible","dockEnabled"],(function(){return i._toggleScreenLocationEnabled()})),p.watch(i,"viewModel.screenLocation",(function(e,t){!!e!=!!t&&i.reposition()})),p.watch(i,"viewModel.features",(function(){return i._updateFeatureWidgets()})),p.watch(i,["viewModel.view.padding","viewModel.view.size","viewModel.visible","viewModel.waitingForResult","viewModel.location","alignment"],(function(){return i.reposition()})),p.watch(i,"spinnerEnabled",(function(e){return i._spinnerEnabledChange(e)})),p.watch(i,"viewModel.view.size",(function(e,t){return i._updateDockEnabledForViewSize(e,t)})),p.watch(i,"viewModel.view",(function(e,t){return i._viewChange(e,t)})),p.watch(i,"viewModel.view.ready",(function(e,t){return i._viewReadyChange(e,t)})),p.watch(i,["viewModel.waitingForResult","viewModel.location"],(function(){i._hideSpinner(),i._displaySpinnerThrottled()})),p.watch(i,["featureWidgets","viewModel.selectedFeatureIndex"],(function(){return i._updateFeatureWidget()})),p.watch(i,"selectedFeatureWidget.viewModel.title",(function(e){return i._setTitleFromFeatureWidget(e)})),p.watch(i,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(function(){return i._setContentFromFeatureWidget()})),p.whenFalse(i,"collapsed",(function(){var e,t;"xsmall"===(null===(t=null===(e=i.viewModel)||void 0===e?void 0:e.view)||void 0===t?void 0:t.widthBreakpoint)&&i.visible&&i.collapseEnabled&&i.viewModel.centerAtLocation()})),p.on(i,"viewModel.allActions","change",(function(){return i._watchActions()})),p.init(i,"viewModel.allActions",(function(){return i._watchActions()}))]),i}return n.__extends(t,e),t.prototype.destroy=function(){this._destroyFeatureWidgets(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"actionsMenuId",{get:function(){return this.id+"-actions-menu"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionsMenuButtonId",{get:function(){return this.id+"-actions-menu-button"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureMenuId",{get:function(){return this.id+"-feature-menu"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleId",{get:function(){return this.id+"-popup-title"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentId",{get:function(){return this.id+"-popup-content"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasContent",{get:function(){var e,t,r,n,i;return!!(this.selectedFeatureWidget?(null===(t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.waitingForContent)||(null===(n=null===(r=this.selectedFeatureWidget)||void 0===r?void 0:r.viewModel)||void 0===n?void 0:n.content):null===(i=this.viewModel)||void 0===i?void 0:i.content)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureNavigationVisible",{get:function(){return this.visible&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collapsible",{get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureMenuVisible",{get:function(){return this.featureNavigationVisible&&this.featureMenuOpen&&this.visible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentCollapsed",{get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dividedActions",{get:function(){return this._divideActions()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionsMenuOpen",{get:function(){return!!this.viewModel.visible&&this._get("actionsMenuOpen")},set:function(e){this._set("actionsMenuOpen",!!e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||O},set:function(e){var t=n.__assign({},O),r=this.get("viewModel.view.breakpoints"),i={};r&&(i.width=r.xsmall,i.height=r.xsmall);var o=n.__assign(n.__assign({},t),e),a=n.__assign(n.__assign({},t.breakpoint),i),s=o.breakpoint;!0===s?o.breakpoint=a:"object"==typeof s&&(o.breakpoint=n.__assign(n.__assign({},a),s)),this._set("dockOptions",o),this._setCurrentDockPosition(),this.reposition()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureNavigationEnabled",{set:function(e){a.deprecatedProperty(M,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements=n.__assign(n.__assign({},this.visibleElements),{featureNavigation:e})},enumerable:!0,configurable:!0}),t.prototype.castVisibleElements=function(e){return n.__assign(n.__assign({},A),e)},t.prototype.blur=function(){this.visible||M.warn("Popup cannot be blurred while visible is false"),this._blurContainer=!0,this.scheduleRender()},t.prototype.clear=function(){this.viewModel.clear()},t.prototype.close=function(){this.visible=!1},t.prototype.fetchFeatures=function(e,t){return this.viewModel.fetchFeatures(e,t)},t.prototype.focus=function(){this.visible||M.warn("Popup cannot be focused while visible is false"),this._focusContainer=!0,this.scheduleRender()},t.prototype.next=function(){return this.viewModel.next()},t.prototype.open=function(e){var t,r;this._handles.remove("selected-index");var n=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:n};"xsmall"===(null===(r=null===(t=this.viewModel)||void 0===t?void 0:t.view)||void 0===r?void 0:r.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()},t.prototype.previous=function(){return this.viewModel.previous()},t.prototype.reposition=function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()},t.prototype.triggerAction=function(e){this.viewModel.triggerAction(e)},t.prototype.render=function(){var e,t,r,n,i,o=this,a=o.actionsMenuOpen,s=o.dockEnabled,l=o.visible,c=o.featureMenuVisible,u=o.dividedActions,p=o.currentAlignment,d=o.currentDockPosition,h=u.menuActions,f=l&&h.length>1&&a,v=l&&s,m=l&&!s,g=null===(r=null===(t=this.selectedFeature)||void 0===t?void 0:t.layer)||void 0===r?void 0:r.title,_=null===(i=null===(n=this.selectedFeature)||void 0===n?void 0:n.layer)||void 0===i?void 0:i.id,b=((e={})["esri-popup--aligned-top-center"]="top-center"===p,e["esri-popup--aligned-bottom-center"]="bottom-center"===p,e["esri-popup--aligned-top-left"]="top-left"===p,e["esri-popup--aligned-bottom-left"]="bottom-left"===p,e["esri-popup--aligned-top-right"]="top-right"===p,e["esri-popup--aligned-bottom-right"]="bottom-right"===p,e["esri-popup--is-docked"]=v,e[S]=m,e["esri-popup--is-docked-top-left"]="top-left"===d,e["esri-popup--is-docked-top-center"]="top-center"===d,e["esri-popup--is-docked-top-right"]="top-right"===d,e["esri-popup--is-docked-bottom-left"]="bottom-left"===d,e["esri-popup--is-docked-bottom-center"]="bottom-center"===d,e["esri-popup--is-docked-bottom-right"]="bottom-right"===d,e["esri-popup--feature-menu-open"]=c,e["esri-popup--actions-menu-open"]=f,e);return y.tsx("div",{class:this.classes("esri-popup",b),role:"presentation","data-layer-title":g,"data-layer-id":_,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},l?[this.renderMainContainer(),this.renderPointer()]:null)},t.prototype.renderLoadingContainer=function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?y.tsx("div",{key:C("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},y.tsx("span",{"aria-hidden":"true",class:this.classes(T,x,w)})):null},t.prototype.renderPreviousIcon=function(){var e,t=g.isRTL(),r=((e={})[b]=t,e["esri-popup__pagination-previous-icon--rtl"]=t,e[_]=!t,e["esri-popup__pagination-previous-icon"]=!t,e);return y.tsx("span",{"aria-hidden":"true",class:this.classes(T,r)})},t.prototype.renderPreviousButton=function(){var e=this.messages;return y.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(P,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())},t.prototype.renderNextIcon=function(){var e,t=g.isRTL(),r=((e={})[_]=t,e["esri-popup__pagination-next-icon--rtl"]=t,e[b]=!t,e["esri-popup__pagination-next-icon"]=!t,e);return y.tsx("span",{"aria-hidden":"true",class:this.classes(T,r)})},t.prototype.renderNextButton=function(){var e=this.messages;return y.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(P,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())},t.prototype.renderFeatureMenuButton=function(){var e=this.featureMenuOpen,t=this.featureMenuId,r=this.messagesCommon,n=this.viewModel,i=n.featureCount,o=n.selectedFeatureIndex;return y.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(P,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e,"aria-label":r.menu,title:r.menu},this._getPageText(i,o))},t.prototype.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderLoadingContainer()||this.renderFeatureMenuButton(),this.renderNextButton()]:null},t.prototype.renderDockIcon=function(){var e,t=this.dockEnabled,r=this._wouldDockTo(),n=((e={})["esri-icon-minimize"]=t,e["esri-popup__icon--dock-icon"]=!t,e["esri-icon-dock-right"]=!t&&("top-right"===r||"bottom-right"===r),e["esri-icon-dock-left"]=!t&&("top-left"===r||"bottom-left"===r),e["esri-icon-maximize"]=!t&&"top-center"===r,e["esri-icon-dock-bottom"]=!t&&"bottom-center"===r,e);return y.tsx("span",{"aria-hidden":"true",class:this.classes(n,T)})},t.prototype.renderDockButton=function(){var e,t,r,n=this.dockEnabled,i=this.messages,o=null===(t=null===(e=this.viewModel)||void 0===e?void 0:e.view)||void 0===t?void 0:t.widthBreakpoint,a=n?i.undock:i.dock;return"xsmall"!==o&&(null===(r=this.dockOptions)||void 0===r?void 0:r.buttonEnabled)?y.tsx("div",{role:"button","aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(P,"esri-popup__button--dock")},this.renderDockIcon()):null},t.prototype.renderTitle=function(){var e,t=this.viewModel.title,r=this.titleId,n=this.collapsible,i=this.contentCollapsed,o=this.messagesCommon,a=n?i?o.expand:o.collapse:"",s=((e={})["esri-popup__header-container--button"]=n,e);return t?y.tsx("div",{class:this.classes("esri-popup__header-container",s),key:t,enterAnimation:this._createFeatureUpdatedAnimation(),id:r,role:n?"button":"heading","aria-label":a,title:a,tabIndex:n?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},y.tsx("h2",{class:"esri-popup__header-title",innerHTML:t})):null},t.prototype.renderCloseIcon=function(){return y.tsx("span",{"aria-hidden":"true",class:this.classes(T,"esri-icon-close")})},t.prototype.renderCloseButton=function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?y.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:P,"aria-label":t.close,title:t.close},this.renderCloseIcon()):null},t.prototype.renderHeader=function(){return y.tsx("header",{class:"esri-popup__header"},this.renderTitle(),y.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))},t.prototype.renderContentContainer=function(){var e=this.contentId,t=this.hasContent,r=this.contentCollapsed,n=this.viewModel.content;return t&&!r?y.tsx("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null},t.prototype.renderActionsMenuButton=function(){var e=this,t=e.actionsMenuId,r=e.actionsMenuButtonId,n=e.actionsMenuOpen,i=e.dividedActions,o=e.messagesCommon,a=n?o.close:o.open;return i.menuActions.length?y.tsx("div",{key:C("actions-menu-button"),class:this.classes(P,"esri-popup__actions-menu-button"),role:"button",id:r,"aria-haspopup":"true","aria-controls":n?t:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":a,title:a},y.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null},t.prototype.renderMenuActions=function(){var e=this,t=this.actionsMenuId,r=this.actionsMenuButtonId,n=this.actionsMenuOpen,i=this.dividedActions,o=i.menuActions,a=i.inlineActions;return o.length&&n?y.tsx("ul",{id:t,role:"menu","aria-labelledby":r,key:C("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},o.toArray().map((function(t,r){return e.renderAction({action:t,index:r+a.length,type:"menu-item"})}))):null},t.prototype.renderInlineActions=function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t,r){return e.renderAction({action:t,index:r,type:"inline"})}))},t.prototype.renderInlineActionsContainer=function(){var e=this.dividedActions,t=e.inlineActions,r=e.menuActions,n=!!t.length,i=!!r.length;return n||i?y.tsx("div",{key:"inline-actions-container","data-inline-actions":n.toString(),"data-menu-actions":i.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null},t.prototype.renderNavigation=function(){return this.featureNavigationVisible?y.tsx("section",{key:C("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null},t.prototype.renderFooter=function(){var e,t=this.featureNavigationVisible,r=this.dividedActions,n=r.inlineActions,i=r.menuActions,o=!!n.length,a=!!i.length,s=((e={})["esri-popup__footer--has-pagination"]=t,e["esri-popup__footer--has-actions"]=o,e["esri-popup__footer--has-actions-menu"]=a,e);return t||o?y.tsx("div",{key:C("feature-buttons"),class:this.classes("esri-popup__footer",s)},this.renderInlineActionsContainer(),this.renderNavigation()):null},t.prototype.renderFeatureMenuContainer=function(){var e=this.featureWidgets,t=this.messages,r=this.viewModel.selectedFeatureIndex,n=i.substitute(t.selectedFeatures,{total:e.length});return y.tsx("section",{key:C("menu"),class:"esri-popup__feature-menu"},y.tsx("h2",{class:"esri-popup__feature-menu-header"},n),y.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu(e,r)))},t.prototype.renderPointer=function(){return this.dockEnabled?null:y.tsx("div",{key:C("pointer"),class:"esri-popup__pointer",role:"presentation"},y.tsx("div",{class:this.classes("esri-popup__pointer-direction",S)}))},t.prototype.renderMainContainer=function(){var e,t=this,r=t.dockEnabled,n=t.currentAlignment,i=t.currentDockPosition,o=t.titleId,a=t.contentId,s=t.collapsible,l=t.hasContent,c=t.contentCollapsed,u=this.viewModel.title,p="bottom-left"===n||"bottom-center"===n||"bottom-right"===n||"top-left"===i||"top-center"===i||"top-right"===i,d="top-left"===n||"top-center"===n||"top-right"===n||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,h=this.renderFeatureMenuContainer(),f=this.renderFooter(),v=((e={})[S]=r,e["esri-popup--is-collapsible"]=s,e["esri-popup--is-collapsed"]=c,e);return y.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",v),tabIndex:-1,role:"dialog","aria-labelledby":u?o:"","aria-describedby":l&&!c?a:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?f:null,p?h:null,this.renderHeader(),this.renderContentContainer(),d?f:null,d?h:null)},t.prototype.renderContent=function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?y.tsx("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null},t.prototype.renderActionText=function(e){return y.tsx("span",{key:"text",class:"esri-popup__action-text"},e)},t.prototype.renderActionIcon=function(e){var t,r=this._getActionClass(e),n=this._getActionImage(e),i=((t={})[x]=e.active,t[w]=e.active,t[T]=!!r,t["esri-popup__action-image"]=!e.active&&!!n,t);return r&&(i[r]=!e.active),y.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(T,i),styles:this._getIconStyles(n)})},t.prototype.renderAction=function(e){var t,r=e.action,n=e.index,i=e.type,o=this._getActionTitle(r),a=((t={})["esri-popup__action"]="toggle"!==r.type,t["esri-popup__action-toggle"]="toggle"===r.type,t["esri-popup__action-toggle--on"]="toggle"===r.type&&r.value,t["esri-popup__button--disabled"]=r.disabled,t),s=[this.renderActionIcon(r),this.renderActionText(o)],l="menu-item"===i?y.tsx("li",{key:r,role:"menuitem",tabIndex:0,title:o,"aria-label":o,class:this.classes(P,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":n,onclick:this._triggerAction,onkeydown:this._triggerAction},s):y.tsx("div",{key:r,role:"button",tabIndex:0,title:o,"aria-label":o,class:this.classes(P,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":n,onclick:this._triggerAction,onkeydown:this._triggerAction},s);return r.visible?l:null},t.prototype.renderFeatureMenuItem=function(e,t,r){var n,i=this.messages,o=this.messagesCommon,a=t===r,s=((n={})["esri-popup__feature-menu-item--selected"]=a,n),l=a?y.tsx("span",{key:C("feature-menu-selected-feature-"+r),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,c=y.tsx("span",{innerHTML:e.title||o.untitled});return y.tsx("li",{role:"menuitem",tabIndex:-1,key:C("feature-menu-feature-"+r),class:this.classes(s,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},y.tsx("span",{class:"esri-popup__feature-menu-title"},c,l))},t.prototype.renderFeatureMenu=function(e,t){var r=this,n=this.featureMenuId;return e.length>1?y.tsx("ol",{class:"esri-popup__feature-menu-list",id:n,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},e.map((function(e,n){return r.renderFeatureMenuItem(e,n,t)}))):null},t.prototype._getActionTitle=function(e){var t=this.messages,r=this.selectedFeature,n=this.messagesCommon,o=e.id,a=null==r?void 0:r.attributes,s="zoom-to-feature"===o?i.substitute(e.title,{messages:t}):"remove-selected-feature"===o?i.substitute(e.title,{messages:n}):e.title;return s&&a?i.substitute(s,a):s},t.prototype._getActionClass=function(e){var t=this.selectedFeature,r=null==t?void 0:t.attributes,n=e.className,o=e.image||n?n:"esri-icon-default-action";return o&&r?i.substitute(o,r):o},t.prototype._getActionImage=function(e){var t=this.selectedFeature,r=null==t?void 0:t.attributes,n=e.image;return n&&r?i.substitute(n,r):n},t.prototype._createFeatureUpdatedAnimation=function(){return g.cssTransition("enter","esri-popup--feature-updated")},t.prototype._getInlineActionCount=function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var r=Math.round(e);return Math.max(t?r-1:r,0)},t.prototype._watchActions=function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions"),this._handles.remove("actions"),t&&t.forEach((function(t){e._handles.add(p.watch(t,["active","className","disabled","id","title","image","visible"],(function(){return e.scheduleRender()})),"actions")}))},t.prototype._divideActions=function(){var e=this.viewModel.allActions,t=this._getInlineActionCount(),r=null===t,n=0===t;return{inlineActions:r?e.slice(0):n?new o:e.slice(0,t),menuActions:r?new o:n?e.slice(0):e.slice(t)}},t.prototype._featureMenuOpenChanged=function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0},t.prototype._actionsMenuOpenChanged=function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0},t.prototype._setTitleFromFeatureWidget=function(e){this.selectedFeatureWidget&&(this.viewModel.title=e||"")},t.prototype._setContentFromFeatureWidget=function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)},t.prototype._handleFeatureMenuKeyup=function(e){"Escape"===s.eventKey(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())},t.prototype._handleActionMenuKeyup=function(e){"Escape"===s.eventKey(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())},t.prototype._handleFeatureMenuItemKeyup=function(e){var t=s.eventKey(e),r=this._featureMenuNode,n=e.currentTarget["data-feature-index"];if(r){var i=r.querySelectorAll("li"),o=i.length;if("ArrowUp"===t)return e.stopPropagation(),void i[(n-1+o)%o].focus();if("ArrowDown"===t)return e.stopPropagation(),void i[(n+1+o)%o].focus();if("Home"===t)return e.stopPropagation(),void i[0].focus();if("End"===t)return e.stopPropagation(),void i[i.length-1].focus()}},t.prototype._handleActionMenuItemKeyup=function(e){var t=s.eventKey(e),r=this._actionsMenuNode,n=e.currentTarget["data-action-index"];if(r){var i=r.querySelectorAll("li"),o=i.length;if("ArrowUp"===t)return e.stopPropagation(),void i[(n-1+o)%o].focus();if("ArrowDown"===t)return e.stopPropagation(),void i[(n+1+o)%o].focus();if("Home"===t)return e.stopPropagation(),void i[0].focus();if("End"===t)return e.stopPropagation(),void i[i.length-1].focus()}},t.prototype._handleMainKeyup=function(e){var t=s.eventKey(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())},t.prototype._spinnerEnabledChange=function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}},t.prototype._hideSpinner=function(){var e=this._spinner;e&&(e.location=null,e.hide())},t.prototype._displaySpinner=function(){var e=this._spinner;if(e){var t=this.viewModel,r=t.location;t.waitingForResult?e.show({location:r}):e.hide()}},t.prototype._getIconStyles=function(e){return{"background-image":e?"url("+e+")":""}},t.prototype._addSelectedFeatureIndexHandle=function(){var e=this,t=p.watch(this,"viewModel.selectedFeatureIndex",(function(t,r){return e._selectedFeatureIndexUpdated(t,r)}));this._handles.add(t,"selected-index")},t.prototype._selectedFeatureIndexUpdated=function(e,t){this.featureCount&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)},t.prototype._updateFeatureWidget=function(){var e=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;this._set("selectedFeatureWidget",e)},t.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureWidgets",[])},t.prototype._updateFeatureWidgets=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,a,s,l=this;return n.__generator(this,(function(c){switch(c.label){case 0:return t=(e=this).features,i=e.featureWidgets,t&&t.length?[4,new Promise((function(e,t){Promise.all([r.e(9),r.e(52),r.e(128)]).then(function(){var t=[r(996)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:(this._destroyFeatureWidgets(),[2]);case 1:return o=c.sent(),a=i.slice(0),s=[],t.forEach((function(e,t){if(e){var r=null;if(a.some((function(t,n){return t&&t.graphic===e&&(r=t,a.splice(n,1)),!!r})),r)s[t]=r;else{var i=new o({defaultPopupTemplateEnabled:l.defaultPopupTemplateEnabled,graphic:e,spatialReference:l.get("view.spatialReference"),map:l.get("view.map")});i.visibleElements=n.__assign(n.__assign({},i.visibleElements),{title:!1}),s[t]=i}}})),a.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureWidgets",s),[2]}}))}))},t.prototype._isScreenLocationWithinView=function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height},t.prototype._isOutsideView=function(e){var t=e.popupHeight,r=e.popupWidth,n=e.screenLocation,i=e.side,o=e.view;if(isNaN(r)||isNaN(t)||!o||!n)return!1;var a=o.padding;return"right"===i&&n.x+r/2>o.width-a.right||"left"===i&&n.x-r/2<a.left||"top"===i&&n.y-t<a.top||"bottom"===i&&n.y+t>o.height-a.bottom},t.prototype._determineCurrentAlignment=function(){var e=this._pointerOffsetInPx,t=this._containerNode,r=this._mainContainerNode,n=this.viewModel,i=n.screenLocation,o=n.view;if(!i||!o||!t)return"top-center";if(!this._isScreenLocationWithinView(i,o))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var s=r?window.getComputedStyle(r,null):null,l=s?a(s.getPropertyValue("max-height")):0,c=s?a(s.getPropertyValue("height")):0,u=t.getBoundingClientRect(),p=u.height,d=u.width+e,h=Math.max(p,l,c)+e,f=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:i,side:"right",view:o}),v=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:i,side:"left",view:o}),m=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:i,side:"top",view:o}),y=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:i,side:"bottom",view:o});return v?m?"bottom-right":"top-right":f?m?"bottom-left":"top-left":m?y?"top-center":"bottom-center":"top-center"},t.prototype._getCurrentAlignment=function(){var e=this.alignment,t=this.dockEnabled,r=this.visible;return t||!r?null:"auto"===e?this._determineCurrentAlignment():"function"==typeof e?e.call(this):e},t.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())},t.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())},t.prototype._getDockPosition=function(){var e=this.get("dockOptions.position");return"auto"===e?this._determineCurrentDockPosition():"function"==typeof e?e.call(this):e},t.prototype._getCurrentDockPosition=function(){return this.dockEnabled&&this.visible?this._getDockPosition():null},t.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()},t.prototype._determineCurrentDockPosition=function(){var e=this.get("viewModel.view"),t=g.isRTL()?"top-left":"top-right";if(!e)return t;var r=e.padding||{left:0,right:0,top:0,bottom:0},n=e.width-r.left-r.right,i=e.get("breakpoints");return i&&n<=i.xsmall?"bottom-center":t},t.prototype._positionContainer=function(e){if(void 0===e&&(e=this._containerNode),e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,r=e.getBoundingClientRect().width,n=this._calculatePositionStyle(t,r);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}},t.prototype._calculateFullWidth=function(e){var t=this.currentAlignment,r=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+r:e},t.prototype._calculateAlignmentPosition=function(e,t,r,n){var i=this.currentAlignment,o=this._pointerOffsetInPx,a=n/2,s=r.height-t,l=r.width-e,c=this.view.padding;return"bottom-center"===i?{top:t+o-c.top,left:e-a-c.left}:"top-left"===i?{bottom:s+o-c.bottom,right:l+o-c.right}:"bottom-left"===i?{top:t+o-c.top,right:l+o-c.right}:"top-right"===i?{bottom:s+o-c.bottom,left:e+o-c.left}:"bottom-right"===i?{top:t+o-c.top,left:e+o-c.left}:"top-center"===i?{bottom:s+o-c.bottom,left:e-a-c.left}:void 0},t.prototype._calculatePositionStyle=function(e,t){var r=this.dockEnabled,n=this.view;if(n){if(r)return{left:"",top:"",right:"",bottom:""};if(e&&t){var i=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,n,i);if(o)return{top:void 0!==o.top?o.top+"px":"auto",left:void 0!==o.left?o.left+"px":"auto",bottom:void 0!==o.bottom?o.bottom+"px":"auto",right:void 0!==o.right?o.right+"px":"auto"}}}},t.prototype._viewChange=function(e,t){e&&t&&(this.close(),this.clear())},t.prototype._viewReadyChange=function(e,t){if(e){var r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())},t.prototype._wireUpView=function(e){this._destroySpinner(),e&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))},t.prototype._dockingThresholdCrossed=function(e,t,r){var n=e[0],i=e[1],o=t[0],a=t[1],s=r.width,l=r.height;return n<=s&&o>s||n>s&&o<=s||i<=l&&a>l||i>l&&a<=l},t.prototype._updateDockEnabledForViewSize=function(e,t){if(e&&t){var r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=r.left+r.right,i=r.top+r.bottom,o=[],a=[];o[0]=e[0]-n,o[1]=e[1]-i,a[0]=t[0]-n,a[1]=t[1]-i;var s=this.dockOptions,l=s.breakpoint;this._dockingThresholdCrossed(o,a,l)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}},t.prototype._focusDockButtonNode=function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())},t.prototype._mainContainerNodeUpdated=function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0},t.prototype._featureMenuNodeUpdated=function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}},t.prototype._actionsMenuNodeUpdated=function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}},t.prototype._focusFeatureMenuButtonNode=function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())},t.prototype._focusActionsMenuButtonNode=function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())},t.prototype._featureMenuViewportNodeUpdated=function(e){e&&(e.scrollTop=0)},t.prototype._toggleScreenLocationEnabled=function(){var e=this.dockEnabled,t=this.visible,r=this.viewModel;if(r){var n=t&&!e;r.screenLocationEnabled=n}},t.prototype._shouldDockAtCurrentViewSize=function(e){var t=e.breakpoint,r=this.get("viewModel.view.ui"),n=r.width,i=r.height;if(isNaN(n)||isNaN(i))return!1;var o=t.hasOwnProperty("width")&&n<=t.width,a=t.hasOwnProperty("height")&&i<=t.height;return o||a},t.prototype._setDockEnabledForViewSize=function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))},t.prototype._getPageText=function(e,t){return this.featureNavigationVisible?i.substitute(this.messages.pageText,{index:t+1,total:e}):null},t.prototype._destroySpinner=function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)},t.prototype._createSpinner=function(e){e&&(this._spinner=new h({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))},t.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed},t.prototype._close=function(){this.close(),this.view&&this.view.focus()},t.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()},t.prototype._toggleFeatureMenu=function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e},t.prototype._toggleActionsMenu=function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e},t.prototype._triggerAction=function(e){var t=e.currentTarget["data-action-index"],r=this.viewModel.allActions.getItemAt(t);r&&"toggle"===r.type&&(r.value=!r.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)},t.prototype._selectFeature=function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()},t.prototype._next=function(){this.next()},t.prototype._previous=function(){this.previous()},n.__decorate([d.property({readOnly:!0,dependsOn:["id"]}),y.renderable()],t.prototype,"actionsMenuId",null),n.__decorate([d.property({readOnly:!0,dependsOn:["id"]}),y.renderable()],t.prototype,"actionsMenuButtonId",null),n.__decorate([d.property({readOnly:!0,dependsOn:["id"]}),y.renderable()],t.prototype,"featureMenuId",null),n.__decorate([d.property({readOnly:!0,dependsOn:["id"]}),y.renderable()],t.prototype,"titleId",null),n.__decorate([d.property({readOnly:!0,dependsOn:["id"]}),y.renderable()],t.prototype,"contentId",null),n.__decorate([d.property({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),y.renderable()],t.prototype,"hasContent",null),n.__decorate([d.property({readOnly:!0,dependsOn:["visible","viewModel.featureCount","visibleElements.featureNavigation"]}),y.renderable()],t.prototype,"featureNavigationVisible",null),n.__decorate([d.property({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),y.renderable()],t.prototype,"collapsible",null),n.__decorate([d.property({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen","visible"]}),y.renderable()],t.prototype,"featureMenuVisible",null),n.__decorate([d.property({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),y.renderable()],t.prototype,"contentCollapsed",null),n.__decorate([d.property({readOnly:!0,dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),y.renderable()],t.prototype,"dividedActions",null),n.__decorate([d.aliasOf("viewModel.actions"),y.renderable()],t.prototype,"actions",void 0),n.__decorate([d.property({dependsOn:["viewModel.visible"]}),y.renderable()],t.prototype,"actionsMenuOpen",null),n.__decorate([d.property()],t.prototype,"alignment",void 0),n.__decorate([d.aliasOf("viewModel.autoCloseEnabled")],t.prototype,"autoCloseEnabled",void 0),n.__decorate([d.aliasOf("viewModel.autoOpenEnabled")],t.prototype,"autoOpenEnabled",void 0),n.__decorate([d.aliasOf("viewModel.defaultPopupTemplateEnabled")],t.prototype,"defaultPopupTemplateEnabled",void 0),n.__decorate([d.aliasOf("viewModel.content"),y.renderable()],t.prototype,"content",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"collapsed",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"collapseEnabled",void 0),n.__decorate([d.property({readOnly:!0,dependsOn:["dockEnabled","alignment","visible"]}),y.renderable()],t.prototype,"currentAlignment",null),n.__decorate([d.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","visible"]}),y.renderable()],t.prototype,"currentDockPosition",null),n.__decorate([d.property(),y.renderable()],t.prototype,"dockOptions",null),n.__decorate([d.property(),y.renderable()],t.prototype,"dockEnabled",void 0),n.__decorate([d.aliasOf("viewModel.featureCount"),y.renderable()],t.prototype,"featureCount",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"featureMenuOpen",void 0),n.__decorate([d.aliasOf("viewModel.features"),y.renderable()],t.prototype,"features",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"featureNavigationEnabled",null),n.__decorate([d.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0),n.__decorate([d.aliasOf("viewModel.highlightEnabled")],t.prototype,"highlightEnabled",void 0),n.__decorate([d.aliasOf("viewModel.location"),y.renderable()],t.prototype,"location",void 0),n.__decorate([d.property({readOnly:!0}),y.renderable()],t.prototype,"featureWidgets",void 0),n.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"maxInlineActions",void 0),n.__decorate([d.property(),y.renderable(),y.messageBundle("esri/widgets/Popup/t9n/Popup")],t.prototype,"messages",void 0),n.__decorate([d.property(),y.renderable(),y.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0),n.__decorate([d.aliasOf("viewModel.promises")],t.prototype,"promises",void 0),n.__decorate([d.aliasOf("viewModel.selectedFeature"),y.renderable()],t.prototype,"selectedFeature",void 0),n.__decorate([d.aliasOf("viewModel.selectedFeatureIndex"),y.renderable()],t.prototype,"selectedFeatureIndex",void 0),n.__decorate([d.property({readOnly:!0}),y.renderable()],t.prototype,"selectedFeatureWidget",void 0),n.__decorate([d.property()],t.prototype,"spinnerEnabled",void 0),n.__decorate([d.aliasOf("viewModel.title"),y.renderable()],t.prototype,"title",void 0),n.__decorate([d.aliasOf("viewModel.updateLocationEnabled")],t.prototype,"updateLocationEnabled",void 0),n.__decorate([d.aliasOf("viewModel.view")],t.prototype,"view",void 0),n.__decorate([d.property({type:m}),y.renderable(["viewModel.view.widthBreakpoint","viewModel.allActions","viewModel.screenLocation","viewModel.screenLocationEnabled","viewModel.state","viewModel.pendingPromisesCount","viewModel.promiseCount","viewModel.waitingForResult"]),y.vmEvent(["triggerAction","trigger-action"])],t.prototype,"viewModel",void 0),n.__decorate([d.aliasOf("viewModel.visible"),y.renderable()],t.prototype,"visible",void 0),n.__decorate([d.property(),y.renderable()],t.prototype,"visibleElements",void 0),n.__decorate([d.cast("visibleElements")],t.prototype,"castVisibleElements",null),n.__decorate([y.accessibleHandler()],t.prototype,"_toggleCollapsed",null),n.__decorate([y.accessibleHandler()],t.prototype,"_close",null),n.__decorate([y.accessibleHandler()],t.prototype,"_toggleDockEnabled",null),n.__decorate([y.accessibleHandler()],t.prototype,"_toggleFeatureMenu",null),n.__decorate([y.accessibleHandler()],t.prototype,"_toggleActionsMenu",null),n.__decorate([y.accessibleHandler()],t.prototype,"_triggerAction",null),n.__decorate([y.accessibleHandler()],t.prototype,"_selectFeature",null),n.__decorate([y.accessibleHandler()],t.prototype,"_next",null),n.__decorate([y.accessibleHandler()],t.prototype,"_previous",null),n.__decorate([d.subclass("esri.widgets.Popup")],t)}(v.FeatureContentMixin(f))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(157),r(151),r(188),r(1523),r(183)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._animationDelay=500,n._animationPromise=null,n.location=null,n.view=null,n.viewModel=new s,n.visible=!1,n}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own([i.watch(this,"visible",(function(t){return e._visibleChange(t)}))])},t.prototype.destroy=function(){this._animationPromise=null},t.prototype.show=function(e){var t=this,r=e.location,n=e.promise;r&&(this.viewModel.location=r),this.visible=!0,n&&n.catch((function(){})).then((function(){return t.hide()}))},t.prototype.hide=function(){this.visible=!1},t.prototype.render=function(){var e,t=this.visible,r=!!this.viewModel.screenLocation,n=!t&&r,i=((e={})["esri-spinner--start"]=t&&r,e["esri-spinner--finish"]=n,e),o=this._getPositionStyles();return l.tsx("div",{class:this.classes("esri-spinner",i),styles:o})},t.prototype._visibleChange=function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var r=n.after(this._animationDelay);this._animationPromise=r,r.catch((function(){})).then((function(){t._animationPromise===r&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}},t.prototype._getPositionStyles=function(){var e=this.viewModel,t=e.screenLocation,r=e.view;if(!r||!t)return{};var n=r.padding;return{left:t.x-n.left+"px",top:t.y-n.top+"px"}},r.__decorate([o.aliasOf("viewModel.location")],t.prototype,"location",void 0),r.__decorate([o.aliasOf("viewModel.view")],t.prototype,"view",void 0),r.__decorate([o.property({type:s}),l.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],t.prototype,"viewModel",void 0),r.__decorate([o.aliasOf("viewModel.visible")],t.prototype,"visible",void 0),r.__decorate([o.subclass("esri.widgets.Spinner")],t)}(a)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(1144)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.visible=!1,r}return r.__extends(t,e),r.__decorate([n.property()],t.prototype,"visible",void 0),r.__decorate([n.subclass("esri.widgets.CompassViewModel")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(169),r(154),r(167),r(156),r(152),r(153),r(157),r(151),r(197),r(208),r(337),r(480),r(520),r(637),r(529),r(1527),r(1144),r(791)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){var w=i.ofType({key:"type",defaultKeyValue:"button",base:f,typeMap:{button:v,toggle:m}}),S=s.getLogger("esri.widgets.Popup.PopupViewModel");return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new a,r._pendingPromises=new Set,r._zoomToLocation=null,r._fetchFeaturesController=null,r.actions=new w([_.zoomToFeature.clone()]),r.defaultPopupTemplateEnabled=!1,r.autoCloseEnabled=!1,r.autoOpenEnabled=!0,r.content=null,r.highlightEnabled=!0,r.title=null,r.updateLocationEnabled=!1,r.view=null,r.visible=!1,r.zoomFactor=4,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([u.init(this,["autoOpenEnabled","view"],this._autoOpenEnabledChange),this.on("view-change",this._autoClose),u.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),u.watch(this,"view.animation.state",(function(t){e._zoomToLocation||(_.zoomToFeature.disabled="waiting-for-target"===t)})),u.watch(this,"location",(function(t){var r=e,n=r.selectedFeature;r.updateLocationEnabled&&t&&(!n||n.geometry)&&e.centerAtLocation()})),u.watch(this,"selectedFeature",(function(t){if(t){var r=e,n=r.location,i=r.updateLocationEnabled,o=r.view;!i&&n||!t.geometry?i&&!t.geometry&&e.centerAtLocation().then((function(){e.location=o.center.clone()})):e.location=l.unwrap(e._getPointFromGeometry(t.geometry))}})),this.on("trigger-action",(function(t){return _.triggerAction({event:t,view:e.view})}))])},t.prototype.destroy=function(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null},Object.defineProperty(t.prototype,"allActions",{get:function(){var e=this._get("allActions")||new w;e.removeAll();var t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),r=t&&t.actions,n=t&&t.overwriteActions?r:r?r.concat(this.actions):this.actions;return n&&n.filter(Boolean).forEach((function(t){return e.add(t)})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._get("features")||[]},set:function(e){var t=e||[];this._set("features",t);var r=this.pendingPromisesCount,n=this.promiseCount,i=this.selectedFeatureIndex,o=n&&t.length;o&&r&&-1===i?this.selectedFeatureIndex=0:o&&-1!==i||(this.selectedFeatureIndex=t.length?0:-1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this._get("location")||null},set:function(e){var t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=d.geographicToWebMercator(e)),this._set("location",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"waitingForResult",{get:function(){return(!!this._fetchFeaturesController||this.pendingPromisesCount>0)&&0===this.featureCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(e){var t=this;if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e),e.then((function(r){t._pendingPromises.has(e)&&t._updateFeatures(r),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))})),this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedFeature",{get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedFeatureIndex",{get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),t.prototype.centerAtLocation=function(){var e=this.view,t=this._getSelectedTarget();if(!t){var r=new o("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return S.error(r),c.reject(r)}return this.callGoTo({target:{target:t,scale:e.scale}})},t.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})},t.prototype.fetchFeatures=function(e,t){var r=this.view;if(!r||!e){var n=new o("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return S.error(n),c.reject(n)}return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})},t.prototype.open=function(e){var t=this,n=r.__assign({updateLocationEnabled:!1,promises:[],fetchFeatures:!1,visible:!1},e),i=n.fetchFeatures;delete n.fetchFeatures;var o=i?this._fetchFeaturesWithController(this._getScreenPoint(n.location||this.location)).then((function(e){var n=e.clientOnlyGraphics,i=e.promisesPerLayerView,o=c.resolve(n),a=i.map((function(e){return e.promise}));t.promises=r.__spreadArrays([o],a)})):c.resolve();this.set(n),o.then((function(){t._setVisibleWhenContentExists()})).catch((function(){}))},t.prototype.triggerAction=function(e){var t=this.allActions.getItemAt(e);t&&this.emit("trigger-action",{action:t})},t.prototype.next=function(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this},t.prototype.previous=function(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this},t.prototype.zoomToLocation=function(){var e=this,t=this.location,r=this.selectedFeature,n=this.view,i=this.zoomFactor,a=this._getSelectedTarget();if(!a){var s=new o("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:a,view:n});return S.error(s),c.reject(s)}var l=n.scale/i,u=this.get("selectedFeature.geometry")||t,p=u&&"point"===u.type&&this._isZoomScreenSize(r);_.zoomToFeature.active=!0,_.zoomToFeature.disabled=!0;var d=this.callGoTo({target:{target:a,scale:p?l:void 0}}).catch((function(){_.zoomToFeature.active=!1,_.zoomToFeature.disabled=!1,e._zoomToLocation=null})).then((function(){p&&(e.location=u)}));return this._zoomToLocation=d,d},t.prototype._getScreenPoint=function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null},t.prototype._getSelectedTarget=function(){var e=this.selectedFeature,t=this.location,r=this.view;return r?"3d"===r.type?e||t:this.get("selectedFeature.geometry")||t:null},t.prototype._autoOpenEnabledChange=function(){var e=this,t=this._handles,r=this.autoOpenEnabled;if(t.remove("auto-fetch-features"),r&&this.view){var n=this.view.on("click",(function(t){"mouse"===t.pointerType&&0!==t.button||e._fetchFeaturesAndOpen(t)}),y.ViewEventPriorities.WIDGET);t.add(n,"auto-fetch-features")}},t.prototype._cancelFetchingFeatures=function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")},t.prototype._fetchFeaturesWithController=function(e,t){var r=this;this._cancelFetchingFeatures();var n=c.createAbortController(),i=n.signal;this._fetchFeaturesController=n,this.notifyChange("waitingForResult");var o=this.fetchFeatures(e,{signal:i,event:t});return o.catch().then((function(){r._fetchFeaturesController=null,r.notifyChange("waitingForResult")})),o},t.prototype._fetchFeaturesAndOpen=function(e){var t=e.screenPoint,n=e.mapPoint,i=this.view;this._fetchFeaturesWithController(t,e).then((function(e){var t=e.clientOnlyGraphics,o=e.promisesPerLayerView,a=e.location,s=c.resolve(t),l=r.__spreadArrays([s],o.map((function(e){return e.promise})));return i.popup.open({location:a||n,promises:l}),e}))},t.prototype._updatePendingPromises=function(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))},t.prototype._setVisibleWhenContentExists=function(){var e=this,t=this._handles,r=this.promiseCount;if(t.remove("pendingVisible"),r){var n=u.init(this,"pendingPromisesCount",(function(r){e.featureCount&&(e.set("visible",!0),t.remove("pendingVisible")),r||t.remove("pendingVisible")}));t.add(n,"pendingVisible")}else this.set("visible",!0)},t.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)},t.prototype._isZoomScreenSize=function(e){var t=this.view;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;var r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){var n=!1;return r.whenGraphicBounds(e,{useViewElevation:!0}).then((function(e){n=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((function(){var t=new o("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});S.error(t)})),n}return!0},t.prototype._getPointFromGeometry=function(e){return l.isNone(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null},t.prototype._getLayerView=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.when()];case 1:return r.sent(),[2,e.whenLayerView(t)]}}))}))},t.prototype._highlightFeature=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i,o,a,s,l,c,u,p,d,f;return r.__generator(this,(function(r){switch(r.label){case 0:return e="highlight",this._handles.remove(e),n=(t=this).selectedFeature,i=t.highlightEnabled,o=t.view,a=t.visible,n&&o&&i&&a&&(s=n.layer)&&s instanceof h?(l=this._getLayerView(o,s),this._highlightPromise=l,[4,l]):[2];case 1:return(c=r.sent())&&g.highlightsSupported(c)&&this._highlightPromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible?(u="objectIdField"in s&&s.objectIdField,p=n.attributes,d=p&&u&&p[u],f=c.highlight(d||n),this._handles.add(f,e),[2]):[2]}}))}))},t.prototype._updateFeatures=function(e){var t=this.features;if(e&&e.length)if(t.length){var r=e.filter((function(e){return-1===t.indexOf(e)}));this.features=t.concat(r)}else this.features=e},r.__decorate([p.property({type:w})],t.prototype,"actions",void 0),r.__decorate([p.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],t.prototype,"allActions",null),r.__decorate([p.property({type:Boolean})],t.prototype,"defaultPopupTemplateEnabled",void 0),r.__decorate([p.property()],t.prototype,"autoCloseEnabled",void 0),r.__decorate([p.property()],t.prototype,"autoOpenEnabled",void 0),r.__decorate([p.property()],t.prototype,"content",void 0),r.__decorate([p.property({readOnly:!0,dependsOn:["features"]})],t.prototype,"featureCount",null),r.__decorate([p.property()],t.prototype,"features",null),r.__decorate([p.property()],t.prototype,"highlightEnabled",void 0),r.__decorate([p.property({type:n.Point})],t.prototype,"location",null),r.__decorate([p.property({readOnly:!0,dependsOn:["promises"]})],t.prototype,"pendingPromisesCount",null),r.__decorate([p.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],t.prototype,"waitingForResult",null),r.__decorate([p.property({readOnly:!0,dependsOn:["promises"]})],t.prototype,"promiseCount",null),r.__decorate([p.property()],t.prototype,"promises",null),r.__decorate([p.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],t.prototype,"selectedFeature",null),r.__decorate([p.property({value:-1})],t.prototype,"selectedFeatureIndex",null),r.__decorate([p.property({readOnly:!0,dependsOn:["view.ready"]})],t.prototype,"state",null),r.__decorate([p.property()],t.prototype,"title",void 0),r.__decorate([p.property()],t.prototype,"updateLocationEnabled",void 0),r.__decorate([p.property()],t.prototype,"view",void 0),r.__decorate([p.property()],t.prototype,"visible",void 0),r.__decorate([p.property()],t.prototype,"zoomFactor",void 0),r.__decorate([p.property()],t.prototype,"centerAtLocation",null),r.__decorate([p.property()],t.prototype,"zoomToLocation",null),r.__decorate([p.subclass("esri.widgets.Popup.PopupViewModel")],t)}(x.GoToMixin(b))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var r=e.call(this,!0)||this;return r._onChange=t,r._value="mouse",r.registerIncoming("pointer-down",(function(e){var t="touch"===e.data.native.pointerType;r._setValue(t?"touch":"mouse")})),r._moveHandler=r.registerIncoming("pointer-move",(function(e){var t="touch"===e.data.native.pointerType;r._setValue(t?"touch":"mouse")})),r._moveHandler.pause(),r}return r.__extends(t,e),t.prototype._setValue=function(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))},t}(n.InputHandler);t.LatestPointerType=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=[]),this.eventType=e,this.keyModifiers=t}return e.prototype.matches=function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;for(var t=e.modifiers,r=0,n=this.keyModifiers;r<n.length;r++){var i=n[r];if(!t.has(i))return!1}return!0},e}();t.EventMatch=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(153),r(480)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});t.zoomToFeature=new i({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),t.removeSelectedFeature=new i({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),t.all=[t.zoomToFeature,t.removeSelectedFeature],t.triggerAction=function(e){var i=e.event,o=e.view,a=i.action,s=o&&o.popup;if(!a)return n.reject(new r("trigger-action:missing-arguments","Event has no action"));if(!s)return n.reject(new r("trigger-action:missing-arguments","view.popup is missing"));var l=a.disabled,c=a.id;if(!c)return n.reject(new r("trigger-action:invalid-action","action.id is missing"));if(l)return n.reject(new r("trigger-action:invalid-action","Action is disabled"));if(c===t.zoomToFeature.id)return s.viewModel.zoomToLocation();if(c===t.removeSelectedFeature.id){s.close();var u=s.selectedFeature;if(!u)return n.reject(new r("trigger-action:"+t.removeSelectedFeature.id,"selectedFeature is required",{selectedFeature:u}));var p=u.sourceLayer;return p?p.remove(u):o.graphics.remove(u),n.resolve()}return n.resolve()}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.factor=1.5,r.offsetX=0,r.offsetY=0,r.position=null,r.visible=!1,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r.__decorate([i.property({type:Number})],t.prototype,"factor",void 0),r.__decorate([i.property({type:Number})],t.prototype,"offsetX",void 0),r.__decorate([i.property({type:Number})],t.prototype,"offsetY",void 0),r.__decorate([i.property()],t.prototype,"position",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["factor","offsetX","offsetY","position","visible"]})],t.prototype,"version",null),r.__decorate([i.property({type:Boolean})],t.prototype,"visible",void 0),r.__decorate([i.subclass("esri.views.Magnifier")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(369),r(154),r(156),r(153),r(171),r(157),r(151),r(197),r(237),r(1147),r(490),r(530),r(1540),r(1545),r(1546),r(1547),r(1550),r(585),r(440),r(1152)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S){var P=a.getLogger("esri.views.MapView");return function(e){function t(t){var r=e.call(this,t)||this;r._stationaryTimer=null,r.frameTask=new y.default(r),r.featuresTilingScheme=null,r.fullOpacity=1,r.graphicsView=null,r.initialExtent=null,r.labelManager=null,r.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},r.resizeAlign="center",r.timeline=new S.Timeline,r.type="2d",r.constraints=new _,r.padding={top:0,right:0,bottom:0,left:0};var n=r.handles,i=function(){return r.notifyChange("updating")};return n.add([r.watch("viewpoint",(function(){r._lastStationaryEventTimestamp=performance.now(),r._flipStationary(160)}),!0),r.on("resize",(function(e){return r._resizeHandler(e)})),r.watch("animationManager.animation",(function(e){r.animation=e})),r.allLayerViews.on("change",(function(){i(),n.remove("map-view-base-layerViewsUpdating"),n.add(r.allLayerViews.map((function(e){return e.watch("updating",i)})),"map-view-base-layerViewsUpdating")}))],"map-view-base"),r}return r.__extends(t,e),t.prototype.destroy=function(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)},Object.defineProperty(t.prototype,"animation",{set:function(e){var t=this,r=this._get("animation");if(e!==r)if(r&&r.stop(),e&&!e.isFulfilled()){this._set("animation",e),this.frameTask.animationInProgress=!0;var n=function(){e===t._get("animation")&&(t._set("animation",null),t.frameTask.requestFrame()),t.frameTask.animationInProgress=!1};e.when(n,n)}else this._set("animation",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){if(!this.ready)return this._get("center");var e=this.state.paddedViewState,t=e.center,r=e.spatialReference;return new n.Point({x:t[0],y:t[1],spatialReference:r})},set:function(e){if(null!=e)if(this._normalizeInput(e)){if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");var t=this.viewpoint;w.centerAt(t,t,e),this.viewpoint=t}else P.error("#center","incompatible spatialReference "+JSON.stringify(e.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"constraints",{set:function(e){var t=this,r=this._get("constraints");r&&(this.handles.remove("map-view-base-constraints"),r.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(e.on("update",(function(){t.ready&&t.state&&(t.state.viewpoint=e.fit(t.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")},set:function(e){if(null!=e){var t=this._normalizeInput(e);if(t)if(t.width&&t.height){if(!this.ready)return this._set("extent",t),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");var r=this.viewpoint;w.setExtent(r,r,t,this.size,{constraints:this.constraints}),this.viewpoint=r}else P.error("#extent","invalid extent size");else P.error("#center","incompatible spatialReference "+JSON.stringify(e.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialExtentRequired",{get:function(){var e=this,t=e.extent,r=e.center,n=e.scale,i=e.viewpoint,o=e.zoom;return!(this.get("map.initialViewProperties.viewpoint")||t||r&&(0!==n||-1!==o)||i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this.state?this.state.resolution:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.ready?this.state.rotation:this._get("rotation")},set:function(e){if(!isNaN(e))if(this.ready){var t=this.viewpoint;w.rotateTo(t,t,e),this.viewpoint=t}else this._set("rotation",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.ready?this.state.scale:this._get("scale")},set:function(e){if(e&&!isNaN(e)){if(!this.ready){this._set("scale",e),this._set("zoom",-1);var t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}var r=this.viewpoint;w.scaleTo(r,r,e),this.viewpoint=r}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stationary",{get:function(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((function(e){return!(e.destroyed||"layerViews"in e||!0!==e.updating)})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewpoint",{get:function(){if(!this.ready)return this._get("viewpoint");var e=this.state.paddedViewState;return e&&e.viewpoint.clone()},set:function(e){if(null!=e){var t=this._normalizeInput(e);if(t){if(!this.ready)return this._set("viewpoint",t),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");var r=new i({targetGeometry:new n.Point,scale:0,rotation:0});w.copy(r,t),this.constraints.constrain(r,this.state.paddedViewState.viewpoint),this.state.viewpoint=r,this.frameTask.requestFrame(),this._set("viewpoint",r)}else!e.scale||isNaN(e.scale)?P.error("#viewpoint","invalid scale value of "+e.scale):e.targetGeometry?P.error("#viewpoint","incompatible spatialReference "+JSON.stringify(e.targetGeometry.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference)):P.error("#viewpoint","geometry not defined")}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(e){if(null!=e){if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",e),this._set("scale",0);var t=this._get("extent");t&&(this._set("extent",null),this._set("center",t.center))}if(this.constraints.effectiveLODs){var r=this.viewpoint;w.scaleTo(r,r,this.constraints.zoomToScale(e)),this.viewpoint=r,this._set("zoom",this.constraints.scaleToZoom(this.scale))}}},enumerable:!0,configurable:!0}),t.prototype.goTo=function(e,t){var n=this;if(e)return c.whenTrueOnce(this,"ready",t&&t.signal).then((function(){n.animation&&(n.animation=null);var i=r.__assign({animate:!0},t),o=w.createAsync(e,n);return n._gotoTask={},i.animate?n._gotoAnimated(o,i):n._gotoImmediate(o,i)}));P.error("#goTo()","target cannot be null or undefined")},t.prototype.hitTest=function(e){return s.reject("Should be implemented by subclasses")},t.prototype.popupHitTest=function(e){var t=this;return this.hitTest(e).then((function(n){return r.__assign(r.__assign({},n),{mapPoint:t.toMap(e)})}))},t.prototype.toMap=function(e){if(!this.ready)return null;var t=this.state.toMap([0,0],[e.x,e.y]),r=t[0],i=t[1],o=this.spatialReference;return new n.Point({x:r,y:i,spatialReference:o})},t.prototype.isTileInfoRequired=function(){return!0},t.prototype.toScreen=function(e){if(!this.ready)return null;var t=this._normalizeInput(e),r=[t.x,t.y],n=this.state.toScreen(r,r),i=n[0],o=n[1];return l.createScreenPoint(i,o)},t.prototype.pixelSizeAt=function(){return this.ready?this.state.resolution:(P.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)},t.prototype.requestUpdate=function(){this.ready&&this.frameTask.requestUpdate()},t.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null},t.prototype.isSpatialReferenceSupported=function(e,t){return!(!t&&!this._get("ready"))||null!==this._getDefaultViewpoint()},t.prototype.importLayerView=function(e){return g.layerView2DImporter.importLayerView(e)},t.prototype.hasLayerViewModule=function(e){return g.layerView2DImporter.hasLayerViewModule(e)},t.prototype._createOrReplaceAnimation=function(e){return this.animation&&!this.animation.done||(this.animation=new v),this.animation.update(e),this.animation},t.prototype._cancellableGoTo=function(e,t,r){var n=this,i=function(){return e===n._gotoTask},o=r.then((function(){i()&&(n.animation=null)})).catch((function(e){throw i()&&(n.animation=null,t.done||(t.stop(),n.frameTask.animationInProgress=!1)),e})),a=s.create((function(e){return e(o)}));return t.when().catch((function(){i()&&a.cancel&&a.cancel()})),a},t.prototype._gotoImmediate=function(e,t){var r=this,n=this._gotoTask,i=this._createOrReplaceAnimation(e),a=e.then((function(e){if(s.throwIfAborted(t),n!==r._gotoTask)throw new o("view:goto-interrupted","Goto was interrupted");r.viewpoint=i.target=e,i.finish()}));return this._cancellableGoTo(n,i,a)},t.prototype._gotoAnimated=function(e,t){var r=this,n=this._gotoTask,i=this._createOrReplaceAnimation(e),a=e.then((function(e){if(n!==r._gotoTask)throw new o("view:goto-interrupted","Goto was interrupted");return i.update(e),r.animationManager.animate(i,r.viewpoint,t),i.when().then((function(){}),(function(){}))}));return this._cancellableGoTo(n,i,a)},t.prototype._resizeHandler=function(e){var t=this.state;if(t){var r=this.state.paddedViewState.viewpoint,n=this.state.paddedViewState.size.concat();t.size=[e.width,e.height],w.resize(r,r,n,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints.constrain(r,null),this.state.viewpoint=r}},t.prototype._startup=function(){var e=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(e),this._set("animationManager",new m.default({view:this})),this._set("state",new b({padding:this._get("padding"),size:this.size,viewpoint:e})),this._set("featuresTilingScheme",new x.TileInfoView(d.create({spatialReference:this.spatialReference,size:512}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()},t.prototype._teardown=function(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);var e=this.state.paddedViewState,t=e.center,r=t[0],i=t[1],o=e.spatialReference,a=e.rotation,s=e.scale,l=new n.Point({x:r,y:i,spatialReference:o});this._set("viewpoint",null),this._set("extent",null),this._set("center",l),this._set("zoom",-1),this._set("rotation",a),this._set("scale",s),this._set("spatialReference",o),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null},t.prototype._flipStationary=function(e){var t=this;return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((function(){t._stationaryTimer=null;var e=performance.now()-t._lastStationaryEventTimestamp;e<160&&(t._stationaryTimer=t._flipStationary(e))}),e)),this._stationaryTimer},t.prototype._normalizeInput=function(e,t){void 0===t&&(t=this.spatialReference);var r=e&&e.targetGeometry||e;return t?r?t.equals(r.spatialReference)?e:p.canProject(r,t)?function(e){return e&&"esri.Viewpoint"===e.declaredClass}(e)?(e.targetGeometry=p.project(r,t),e):p.project(r,t):null:null:e},t.prototype._getDefaultViewpoint=function(){var e=this.constraints,t={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};e.effectiveLODs?-1!==t.zoom&&(t.scale=e.zoomToScale(t.zoom)):t.zoom=-1;var r=null,n=null,o=0,a=t.viewpoint&&t.viewpoint.rotation,s=t.viewpoint&&t.viewpoint.targetGeometry;s&&("extent"===s.type?r=s:"point"===s.type&&(n=s,o=t.viewpoint.scale));var l=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),c=this._normalizeInput(this.initialExtent),u=t.extent||r||l||c,p=t.center||n||u&&u.center,d=this.get("map.initialViewProperties.viewpoint.scale"),h=t.scale||o||d||u&&w.extentToScale(u,this.size),f=this.get("map.initialViewProperties.viewpoint.rotation"),v=t.rotation||a||f||0;return p&&h?new i({targetGeometry:p,scale:h,rotation:v}):null},r.__decorate([u.property()],t.prototype,"_stationaryTimer",void 0),r.__decorate([u.property()],t.prototype,"animation",null),r.__decorate([u.property({readOnly:!0})],t.prototype,"animationManager",void 0),r.__decorate([u.property({value:null,type:n.Point,dependsOn:["state.id","ready"]})],t.prototype,"center",null),r.__decorate([u.property({type:_})],t.prototype,"constraints",null),r.__decorate([u.property({value:null,type:n.Extent,dependsOn:["state.id","ready"]})],t.prototype,"extent",null),r.__decorate([u.property({readOnly:!0})],t.prototype,"featuresTilingScheme",void 0),r.__decorate([u.property()],t.prototype,"fullOpacity",void 0),r.__decorate([u.property()],t.prototype,"graphicsView",void 0),r.__decorate([u.property({type:n.Extent})],t.prototype,"initialExtent",void 0),r.__decorate([u.property({dependsOn:["map.initialViewProperties?.viewpoint"]})],t.prototype,"initialExtentRequired",null),r.__decorate([u.property()],t.prototype,"labelManager",void 0),r.__decorate([u.property({value:{top:0,right:0,bottom:0,left:0},cast:function(e){return r.__assign({top:0,right:0,bottom:0,left:0},e)}})],t.prototype,"padding",null),r.__decorate([u.property({type:Object})],t.prototype,"renderingOptions",void 0),r.__decorate([u.property()],t.prototype,"resizeAlign",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["state.id"]})],t.prototype,"resolution",null),r.__decorate([u.property({value:0,type:Number,dependsOn:["state.id","ready"]})],t.prototype,"rotation",null),r.__decorate([u.property({value:0,type:Number,dependsOn:["state.id","ready"]})],t.prototype,"scale",null),r.__decorate([u.property({type:n.SpatialReference,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],t.prototype,"spatialReference",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"state",void 0),r.__decorate([u.property({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],t.prototype,"stationary",null),r.__decorate([u.property({type:S.Timeline,readOnly:!0})],t.prototype,"timeline",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],t.prototype,"updating",null),r.__decorate([u.property({value:null,type:i,dependsOn:["state.id","ready"]})],t.prototype,"viewpoint",null),r.__decorate([u.property({value:-1,dependsOn:["state.id"]})],t.prototype,"zoom",null),r.__decorate([u.subclass("esri.views.MapViewBase")],t)}(h.PopupView(f))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(157),r(151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.baseLayerViews=new i,r.referenceLayerViews=new i,r._loadingHandle=o.init(r,"view.map.basemap",(function(e){e&&e.load().catch((function(){}))})),r}return r.__extends(t,e),t.prototype.destroy=function(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)},enumerable:!0,configurable:!0}),r.__decorate([a.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"baseLayerViews",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"referenceLayerViews",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["view.suspended"]})],t.prototype,"suspended",null),r.__decorate([a.property({type:Boolean,readOnly:!0,dependsOn:["view.suspended","view.map.basemap.loaded"]})],t.prototype,"updating",null),r.__decorate([a.subclass("esri.views.BasemapView")],t)}(n);t.BasemapView=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(236),r(156),r(153),r(231),r(157),r(151),r(388)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=o.getLogger("esri.views.LayerViewManager"),d=new Map;d.set("view.map.basemap.baseLayers","view.basemapView.baseLayerViews"),d.set("view.map.ground.layers","view.groundView.layerViews"),d.set("view.map.layers","view.layerViews"),d.set("view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews");var h=function(){function e(e,t,r){var i=this;this.layer=e,this.view=t,this.layerViewImporter=r,this._controller=a.createAbortController(),this._deferred=a.createDeferred(),this._started=!1,this.done=!1,a.onAbort(this._controller.signal,(function(){var t=new n("cancelled:layerview-create","layerview creation cancelled",{layer:e});i._deferred.reject(t)}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._controller.abort();var e=this.layerView;if(e){var t=this.layer,r=this.view;e.destroy(),t.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,e.layer=null,e.parent=null,e.view=null}},e.prototype.start=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,s,l,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(this._started)return[2];this._started=!0,t=(e=this)._controller.signal,i=e.layer,o=e.view,this._map=o.map,r.label=1;case 1:return r.trys.push([1,10,,11]),[4,i.load({signal:t})];case 2:return r.sent(),"prefetchResources"in i?[4,i.prefetchResources({signal:t})]:[3,4];case 3:r.sent(),r.label=4;case 4:return s=void 0,i.createLayerView?[4,i.createLayerView(o,{signal:t})]:[3,6];case 5:return s=r.sent(),[3,8];case 6:if(!this.layerViewImporter.hasLayerViewModule(i))throw new n("layer:view-not-supported","No layerview implementation was found");return[4,this.layerViewImporter.importLayerView(i)];case 7:l=r.sent(),a.throwIfAborted(t),s="default"in l?new l.default({layer:i,view:o}):new l({layer:i,view:o}),r.label=8;case 8:return a.throwIfAborted(t),[4,s.when()];case 9:return r.sent(),!(c=this._map&&this._map.allLayers.includes(i))||t.aborted?(s.destroy(),s.layer=s.parent=s.view=null,this.done=!0,c?[2]:[2,this._deferred.reject(new n("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}))]):(this.layerView=s,i.emit("layerview-create",{view:o,layerView:s}),o.emit("layerview-create",{layer:i,layerView:s}),this.done=!0,this._deferred.resolve(s),[3,11]);case 10:return u=r.sent(),i.emit("layerview-create-error",{view:o,error:u}),o.emit("layerview-create-error",{layer:i,error:u}),this.done=!0,this._deferred.reject(new n("layerview:create-error","layerview creation failed",{layer:i,error:u})),[3,11];case 11:return[2]}}))}))},e}(),f=function(e){function t(t){var r=e.call(this,t)||this;return r._layerLayerViewInfoMap=new Map,r._watchUpdatingTracking=new u.WatchUpdatingTracking,r.view=null,r._preloadLayerViewModules=function(){var e=r.view,t=r.get("view.map.allLayers");e&&t&&t.forEach((function(e){r.layerViewImporter.hasLayerViewModule(e)&&r.layerViewImporter.importLayerView(e)}))},r._reschedule=function(){r.handles.remove("reschedule"),r.handles.add(s.schedule(r._doWork),"reschedule"),r.notifyChange("updating")},r._doWork=function(){var e=r.get("view.map");if(r._map!==e&&(r.clear(),r._map=e),r.handles.has("reschedule")){r.handles.remove("reschedule"),r.handles.remove("collection-change");var t=e&&e.allLayers;if(t){t.forEach(r._createLayerView,r),r._refreshCollections();var n=[];r._layerLayerViewInfoMap.forEach((function(e,r){t.includes(r)||n.push(e)}));for(var i=0,o=n;i<o.length;i++){var a=o[i];r._layerLayerViewInfoMap.delete(a.layer),a.destroy()}r.handles.add(r._watchUpdatingTracking.addOnCollectionChange(t,r._reschedule),"collection-change"),r.notifyChange("updating")}}},r.handles.add([l.on(r,"view.map.allLayers","change",r._preloadLayerViewModules,r._preloadLayerViewModules),r.watch(["view.map.basemap","view.map.ground","view.map.layers","view.ready"],r._reschedule,!0)]),r}return r.__extends(t,e),t.prototype.initialize=function(){this._preloadLayerViewModules()},t.prototype.destroy=function(){this.clear(),this._watchUpdatingTracking.destroy(),this.view=null,this._map=null},Object.defineProperty(t.prototype,"updating",{get:function(){if(this.handles.has("reschedule")||this._watchUpdatingTracking.updating)return!0;var e=!0;return this._layerLayerViewInfoMap.forEach((function(t){return e=e&&t.done})),!e},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.destroyed||(this._layerLayerViewInfoMap.forEach((function(e){return e.destroy()})),this._layerLayerViewInfoMap.clear(),this._refreshCollections())},t.prototype.whenLayerView=function(e){return this._reschedule(),this._doWork(),this._layerLayerViewInfoMap.has(e)?this._layerLayerViewInfoMap.get(e).promise:a.reject(new n("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e}))},t.prototype._refreshCollections=function(){var e=this;d.forEach((function(t,r){e._populateLayerViewsOwners(e.get(r),e.get(t),e.view)}))},t.prototype._populateLayerViewsOwners=function(e,t,r){var n=this;if(e&&t){var i=0;e.forEach((function(e){var o=n._layerLayerViewInfoMap.get(e);if(o&&o.layerView){var a=o.layerView;a.layer=e,a.parent=r,t.getItemAt(i)!==a&&t.splice(i,0,a),e.layers&&n._populateLayerViewsOwners(e.layers,a.layerViews,a),i+=1}})),i<t.length&&t.splice(i,t.length)}else t&&t.removeAll()},t.prototype._createLayerView=function(e){var t=this;if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),void this.notifyChange("updating");e.load().catch((function(){})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);var r=new h(e,this.view,this.layerViewImporter);r.promise.then((function(){t._refreshCollections(),t.notifyChange("updating")}),(function(r){r&&(a.isAbortError(r)||"cancelled:layerview-create"===r.name)||p.error("Failed to create view for layer '"+e.title+", id:"+e.id+"' of type '"+e.type+"'.",{error:r}),t._refreshCollections(),t.notifyChange("updating")})),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating")},r.__decorate([c.property({readOnly:!0})],t.prototype,"_watchUpdatingTracking",void 0),r.__decorate([c.property()],t.prototype,"layerViewImporter",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["_watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([c.property()],t.prototype,"view",void 0),r.__decorate([c.subclass("esri.views.LayerViewManager")],t)}(i.HandleOwner);t.default=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(151),r(285)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new i,t._currentTick=0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([this.view.allLayerViews.on("after-changes",(function(){e.notifyChange("tickInterval"),e._handles.remove("layerViewsUpdating"),e._handles.add(e._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(function(){return e._restartTicking()})),this.watch("view.ready",(function(){return e._restartTicking()}))]),this._restartTicking()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)},Object.defineProperty(t.prototype,"tickInterval",{get:function(){var e=this.view.allLayerViews.filter((function(e){return a.isRefreshableLayerView(e)}));return this._getCommonInterval(e)},enumerable:!0,configurable:!0}),t.prototype._restartTicking=function(){var e=this;this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((function(){var t=Date.now();e._currentTick+=e.tickInterval,e.view.allLayerViews.forEach((function(r){if(a.isRefreshableLayerView(r)){var n=Math.round(6e4*r.refreshInterval),i=e._currentTick%n==0,o=t-r.refreshTimestamp<6e3;n&&i&&!o&&r.refresh(t)}}))}),this.tickInterval))},t.prototype._getLayerViewHandles=function(){var e=this,t=[],r=function(){return e.notifyChange("tickInterval")};return this.view.allLayerViews.forEach((function(e){a.isRefreshableLayerView(e)&&e.layer&&t.push(e.watch("refreshInterval",r),e.layer.on("refresh",(function(){e.refresh(Date.now())})))})),t},t.prototype._getCommonInterval=function(e){var t=function(e,r){return isNaN(e)||isNaN(r)?0:r<=0?e:t(r,e%r)};return e.toArray().reduce((function(e,r){return t(Math.round(6e4*r.refreshInterval),e)}),0)},r.__decorate([o.property()],t.prototype,"view",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"tickInterval",null),r.__decorate([o.subclass("esri.views.RefreshManager")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(167),r(156),r(152),r(153),r(157),r(151),r(637),r(1149),r(1150),r(1534)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){var v=a.getLogger("esri.views.ToolViewManager");return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new o,r._creatingTool=null,r._manipulatorState=new f.default,r.tools=h.newToolCollection(),r.cursor=null,r._forEachTool=function(e){if(!s.isSome(r._creatingTool)||!e(r._creatingTool))for(var t=0,n=r.tools.items;t<n.length;t++)if(e(n[t]))return},r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([this.view.on(d.eventTypes,(function(t){e._handleInputEvent(t)}),p.ViewEventPriorities.TOOL),this.tools.on("before-add",(function(t){var r=t.item;null==r||e.tools.includes(r)?t.preventDefault():null==r.created||r.created||(v.error("tools","Tool can not be added to view before it has been created"),t.preventDefault())})),this.tools.on("before-remove",(function(t){var r=t.item;e._manipulatorState.clearPointers(r,e._forEachTool)})),this.tools.on("change",(function(){e._refreshToolWatchers()}))])},t.prototype.destroy=function(){this._forEachTool((function(e){return e.destroy()})),this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"activeTool",{set:function(e){var t=this;!s.isSome(e)||this.view.ready?(h.swap(this,e,(function(r){t._set("activeTool",r),t._removeIncompleteTools(e),t._forEachTool((function(e){var r=s.isNone(t.activeTool)||e===t.activeTool;e.setEditableFlag&&e.setEditableFlag(1,r);var n=h.areToolManipulatorsEditable(e);!s.isNone(t.activeTool)&&n||t._manipulatorState.clearPointers(e,t._forEachTool,!n)})),t._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):v.error("#activeTool=","cannot set active tool while view is not ready")},enumerable:!0,configurable:!0}),t.prototype.createTool=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var o,a,u,p,d=this;return r.__generator(this,(function(f){switch(f.label){case 0:return[4,this.view.whenReady()];case 1:if(f.sent(),o="Tool creation was interrupted by another tool being created",l.isAborted(i))throw l.createAbortError(o);return a=h.evaluateToolConstructorArguments(t),u=new e(r.__assign(r.__assign({},a),{view:this.view})),p=l.onAbort(i,(function(){return d.activeTool=null})),this._rejectCreatingTool(o),this._creatingTool=u,u.attach(),this._refreshToolWatchers(),h.setActive(u,!0),[4,u.when()];case 2:return f.sent(),s.isSome(p)&&p.remove(),this._creatingTool=null,this.tools.add(u),u instanceof n&&null!=u.completed&&c.whenOnce(u,"completed").then((function(){h.setActive(u,!1)})),[2,u]}}))}))},t.prototype.attach=function(){var e=this;this._forEachTool((function(e){return e.attach()})),"3d"===this.view.type?this._handles.add([this.view.state.watch("camera",(function(){e.forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(function(t){e.forEachManipulator((function(e){null!=e.onElevationChange&&e.onElevationChange(t)}))}))],"manipulators"):this._handles.add(this.view.watch("extent",(function(){e.forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})))},t.prototype.detach=function(){this.activeTool=null,this._forEachTool((function(e){e.detach(),e.destroy()})),this.tools.removeAll(),this._handles.remove("manipulators")},t.prototype.forEachManipulator=function(e){this._forEachTool((function(t){t.manipulators&&t.manipulators.forEach((function(r){var n=r.manipulator;return e(n,t)}))}))},t.prototype._handleInputEvent=function(e){var t=this,n=!1,i=r.__assign(r.__assign({},e),{stopPropagation:function(){n=!0,e.stopPropagation()}});s.isSome(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((function(e){!n&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)})),!n&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:function(e){t.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!n&&s.isSome(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()},t.prototype._refreshToolWatchers=function(){var e=this;this._handles.remove("tools"),this._forEachTool((function(t){if(t instanceof n){var r=c.watch(t,["cursor","visible","editable"],(function(){h.areToolManipulatorsEditable(t)||e._manipulatorState.clearPointers(t,e._forEachTool),e._updateCursor()}));e._handles.add(r,"tools")}t.manipulators&&e._handles.add(t.manipulators.on("change",(function(r){r.removed.forEach((function(r){var n=r.id;e._manipulatorState.clearPointers(t,e._forEachTool,!0,n)})),e._manipulatorState.updateHoveredStateFromKnownPointers(e._forEachTool),e._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()},t.prototype._updateCursor=function(){var e=null;this._forEachTool((function(t){return null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0)})),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)},t.prototype._rejectCreatingTool=function(e){var t=this._creatingTool;s.isNone(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(l.createAbortError(e)),t.destroy(),this._creatingTool=null,this._refreshToolWatchers())},t.prototype._removeIncompleteTools=function(e){var t=this;this.tools.filter((function(t){return(s.isNone(e)||t!==e)&&null!=t.completed&&!t.completed})).forEach((function(e){t.tools.remove(e)}))},r.__decorate([u.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r.__decorate([u.property({value:null})],t.prototype,"activeTool",null),r.__decorate([u.property({readOnly:!0,type:i})],t.prototype,"tools",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"cursor",void 0),r.__decorate([u.subclass("esri.views.ToolViewManager")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(210),r(168),r(152),r(171),r(1150)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}return Object.defineProperty(e.prototype,"cursor",{get:function(){return this._cursor},enumerable:!0,configurable:!0}),e.prototype.handleInputEvent=function(e,t){var r=function(){return e.stopPropagation()};switch(e.type){case"pointer-move":l(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":if(!c(e)||u(e))break;var a=o.createScreenPointFromEvent(e),s=this._intersect(a,e.pointerType,t.forEachTool);if(i.isNone(s))break;var d=this._findManipulatorByKey(s,t.forEachTool);i.isSome(d)&&d.interactive&&d.grabbable&&!d.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:s,start:a}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(s.tool)),d.grabbing=!0,d.events.emit("grab-changed",{action:"start",screenPoint:a}),r());break;case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":if(!c(e))break;var h=this._grabbedManipulators.get(e.pointerId),f=this._draggedManipulators.get(e.pointerId),v=i.applySome(h||f,(function(e){return e.key})),m=this._findManipulatorByKey(v,t.forEachTool);if(i.isNone(m))break;(a=o.createScreenPointFromEvent(e)).x=n.clamp(a.x,0,t.view.width),a.y=n.clamp(a.y,0,t.view.height);var y=i.unwrap(h||f).start,g={action:e.action,start:y,screenPoint:a};switch(e.action){case"start":case"update":"update"!==g.action&&1!==this._grabbedManipulators.size||(m.dragging=!0,f||(g.action="start"),m.events.emit("drag",g),this._draggedManipulators.set(e.pointerId,{key:i.unwrap(v),start:y}));break;case"end":m.dragging=!1,f&&m.events.emit("drag",g),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}r();break;case"immediate-click":a=o.createScreenPointFromEvent(e),s=this._intersect(a,e.pointerType,t.forEachTool);var _=this._findToolAndManipulatorByKey(s,t.forEachTool,p);if(u(e)||t.forEachTool((function(e){if((!_||p.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){var t=!1;e.manipulators.forEach((function(e){var r=e.manipulator;r.selected&&(r.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),!_)break;d=p.manipulator;var b=p.tool;if(!d.interactive)break;d.selectable&&!b.selectionManagementDisabled&&(d.selected=!d.selected,b.manipulatorSelectionChanged&&b.manipulatorSelectionChanged());var x=e.native.shiftKey;d.events.emit("immediate-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:x,stopPropagation:r});break;case"click":if(a=o.createScreenPointFromEvent(e),s=this._intersect(a,e.pointerType,t.forEachTool),d=this._findManipulatorByKey(s,t.forEachTool),i.isNone(d)||!d.interactive)break;x=e.native.shiftKey,d.events.emit(e.type,{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:x}),r();break;case"double-click":if(a=o.createScreenPointFromEvent(e),s=this._intersect(a,e.pointerType,t.forEachTool),d=this._findManipulatorByKey(s,t.forEachTool),i.isNone(d)||!d.interactive)break;x=e.native.shiftKey,d.events.emit("double-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:x,stopPropagation:r});break;case"immediate-double-click":if(a=o.createScreenPointFromEvent(e),s=this._intersect(a,e.pointerType,t.forEachTool),d=this._findManipulatorByKey(s,t.forEachTool),i.isNone(d)||!d.interactive)break;x=e.native.shiftKey,d.events.emit("immediate-double-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:x,stopPropagation:r})}this._updateCursor(t.forEachTool)},e.prototype._handlePointerEnd=function(e,t){var r=i.applySome(this._grabbedManipulators.get(e.pointerId),(function(e){return e.key})),n=this._findManipulatorByKey(r,t.forEachTool);if(i.isSome(n)&&!n.dragging){var a=i.isSome(t.creatingTool)&&t.creatingTool===i.unwrap(r).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||a||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:o.createScreenPointFromEvent(e)})),this._grabbedManipulators.delete(e.pointerId)}},e.prototype._cursorFromMap=function(e,t){var n=this,o=null;return r.someMap(e,(function(e){var r=e.key,a=n._findManipulatorByKey(r,t);return!!(i.isSome(a)&&a.interactive&&"cursor"in a&&a.cursor)&&(o=a.cursor,!0)})),o},e.prototype._updateCursor=function(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null},e.prototype.clearPointers=function(e,t,r,n){var o=this;void 0===r&&(r=!0);var a=function(t){return t.tool===e&&(i.isNone(n)||t.manipulatorId===n)};this._grabbedManipulators.forEach((function(e,r){var n=e.key;if(a(n)){o._grabbedManipulators.delete(r);var s=o._findManipulatorByKey(n,t);i.isSome(s)&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((function(e,r){var n=e.key;if(a(n)){o._draggedManipulators.delete(r);var s=o._findManipulatorByKey(n,t);i.isSome(s)&&(s.dragging=!1,s.events.emit("drag",{action:"cancel",screenPoint:null,start:null}))}})),r&&this._hoveredManipulators.forEach((function(e,r){var n=e.key;if(a(n)){o._hoveredManipulators.delete(r);var s=o._findManipulatorByKey(n,t);i.isSome(s)&&(s.hovering=!1)}})),this._updateCursor(t)},e.prototype._intersect=function(e,t,r){var n=null;return r((function(r){if(null==r.manipulators||!a.areToolManipulatorsEditable(r))return!1;var o=r.manipulators.intersect(e,t);return!i.isNone(o)&&(n={manipulatorId:o,tool:r},!0)})),n},e.prototype.updateHoveredStateFromKnownPointers=function(e){var t=this;this._pointerLocations.forEach((function(r,n){t._updateHoveredStateForPointerAtScreenPosition(o.createScreenPoint(r.x,r.y),n,r.pointerType,e)}))},e.prototype.handleHoverEvent=function(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!l(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(o.createScreenPointFromEvent(e),e.pointerId,e.pointerType,t)},e.prototype._updateHoveredStateForPointerAtScreenPosition=function(e,t,r,n){var o=this._intersect(e,r,n),a=this._findManipulatorByKey(o,n),s=i.applySome(this._hoveredManipulators.get(t),(function(e){return e.key})),l=this._findManipulatorByKey(s,n);i.isSome(a)&&!a.interactive&&(a=null),l!==a&&(i.isSome(l)&&(l.hovering=!1),i.isSome(a)?(a.hovering=!0,this._hoveredManipulators.set(t,{key:i.unwrap(o)})):this._hoveredManipulators.delete(t),this._updateCursor(n))},e.prototype._findManipulatorByKey=function(e,t){return this._findToolAndManipulatorByKey(e,t,p)?p.manipulator:null},e.prototype._findToolAndManipulatorByKey=function(e,t,r){return i.isNone(e)?null:(r.tool=null,r.manipulator=null,t((function(t){if(t!==e.tool||null==t.manipulators||!a.areToolManipulatorsEditable(t))return!1;var n=t.manipulators.findById(e.manipulatorId);return!!i.isSome(n)&&(r.manipulator=n,r.tool=t,!0)})),null!=r.manipulator)},e}();function l(e){return"mouse"===e}function c(e){return"mouse"!==e.pointerType||0===e.button}function u(e){return!!e.native.shiftKey}t.default=s;var p={manipulator:null,tool:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(1536)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gamepad=new o,t}return r.__extends(t,e),r.__decorate([i.property({readOnly:!0})],t.prototype,"gamepad",void 0),r.__decorate([i.subclass("esri.views.input.Input")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(151),r(911)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.devices=new i,n.enabledFocusMode="document",n}return r.__extends(t,e),r.__decorate([o.property({type:i.ofType(a),readOnly:!0})],t.prototype,"devices",void 0),r.__decorate([o.property({type:["document","view","none"]})],t.prototype,"enabledFocusMode",void 0),r.__decorate([o.subclass("esri.views.input.gamepad.GamepadSettings")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(1538)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.browserTouchPanEnabled=!0,r.gamepad=new o,r.momentumEnabled=!0,r.mouseWheelZoomEnabled=!0,r}return r.__extends(t,e),r.__decorate([i.property({type:Boolean})],t.prototype,"browserTouchPanEnabled",void 0),r.__decorate([i.property({type:o,nonNullable:!0})],t.prototype,"gamepad",void 0),r.__decorate([i.property({type:Boolean})],t.prototype,"momentumEnabled",void 0),r.__decorate([i.property({type:Boolean})],t.prototype,"mouseWheelZoomEnabled",void 0),r.__decorate([i.subclass("esri.views.navigation.Navigation")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(911)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.enabled=!0,r.device=null,r.mode="pan",r.tiltDirection="forward-down",r.velocityFactor=1,r}return r.__extends(t,e),r.__decorate([i.property({type:Boolean,nonNullable:!0})],t.prototype,"enabled",void 0),r.__decorate([i.property({type:o})],t.prototype,"device",void 0),r.__decorate([i.property({type:["pan","zoom"],nonNullable:!0})],t.prototype,"mode",void 0),r.__decorate([i.property({type:["forward-down","forward-up"],nonNullable:!0})],t.prototype,"tiltDirection",void 0),r.__decorate([i.property({type:Number,nonNullable:!0})],t.prototype,"velocityFactor",void 0),r.__decorate([i.subclass("esri.views.navigation.gamepad.GamepadSettings")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(180),r(167),r(156),r(153),r(157),r(151),r(1151),r(197),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d){var h=s.getLogger("esri.views.support.DefaultsFromMap");function f(e){return e?JSON.stringify(e.toJSON()):"undefined"}function v(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new a,t._waitTask=null,t._extentProjectController=null,t._spatialReferenceCandidates=null,t._extentCandidates=null,t.logDebugInformation=!1,t.isSpatialReferenceDone=!1,t.isTileInfoDone=!1,t.isHeightModelInfoSearching=!1,t.spatialReference=null,t.extent=null,t.heightModelInfo=null,t.vcsWkid=null,t.latestVcsWkid=null,t.mapCollectionPaths=i.DefaultMapCollectionPaths.slice(),t.tileInfo=null,t}var i;return n.__extends(t,e),i=t,t.prototype.initialize=function(){var e=this;this.watch("mapCollectionPaths",(function(){e._running&&(e.reset(),e.start())}))},t.prototype.destroy=function(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()},Object.defineProperty(t.prototype,"_running",{get:function(){return!!(this._handles&&this._handles.size>0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null},t.prototype.start=function(){var e=this;this._handles.removeAll();for(var t=this._updateLayerChange.bind(this),r=0,n=this.mapCollectionPaths;r<n.length;r++){var i=n[r];this._handles.add(c.on(this.view,"map."+i,"change",t,t,t,!0))}this._handles.add(c.when(this,"isSpatialReferenceDone",(function(){return e._updateTileInfo()}),!0))},t.prototype._ownerNameFromCollectionName=function(e){var t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)},t.prototype._ensureLoadedOwnersFromCollectionName=function(e){for(var t,r=this._ownerNameFromCollectionName(e).split("."),n=0;n<r.length&&(t=this.get(r.slice(0,n+1).join(".")));n++)if(t.load&&!t.isFulfilled())return{collectionName:e,owner:null,loading:t.load().catch((function(){}))};return{collectionName:e,owner:t}},t.prototype._cancelLoading=function(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)},t.prototype._updateWhen=function(e){var t=this,r=!0,n=!1,i=e.catch((function(){})).then((function(){r?n=!0:i===t._waitTask&&t._update()}));return r=!1,n||(this._waitTask=i),n},t.prototype._updateLayerChange=function(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()},t.prototype._update=function(){var e=this;if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");var t=this._processMapCollections((function(t){return e._processSpatialReferenceSource(t)}));if(this._debugLog("Search ended with status '"+v(t)+"'"),0!==t){var r=null,n=this._spatialReferenceCandidates;if(!n||n.length<1?(r=this.defaultSpatialReference,this._debugLog("No spatial reference found, locking to default ("+f(r)+")")):(this.defaultSpatialReference&&n.length>1&&o.findIndex(n,(function(t){return t.equals(e.defaultSpatialReference)}))>-1&&(n=[this.defaultSpatialReference]),r=n[0],this._debugLog("Locking to "+f(r))),this._set("spatialReference",r),r)if(this.extent)this._set("isSpatialReferenceDone",!0);else{var i=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((function(t){return e._findExtent(t,r)})),this.logDebugInformation=i,this._projectExtentCandidate().catch().then((function(){return e._set("isSpatialReferenceDone",!0)}))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");var a=this._processMapCollections((function(t){return e._processHeightModelInfoSource(t)}),(function(e){return p.mayHaveHeightModelInfo(e)}));this._debugLog("Search ended with status "+v(a)),this._set("isHeightModelInfoSearching",0===a)}this._updateTileInfo()}},t.prototype._processMapCollections=function(e,t){var r=this;this._preloadMapCollections(t);var n=2;return this._forAllMapCollectionSources((function(e){if(2!==n)return!1;var t=e.collectionName;return r._debugLog("Processing collection "+t+"..."),!(e.loading&&!r._updateWhen(e.loading)&&(r._debugLog("Collection "+e.collectionName+" owner is loading -> wait"),n=0,1))}),(function(i){return!(2!==n||(null==t||t(i)?!i.load||i.isFulfilled()||r._updateWhen(i.load())?(!i.load||i.isResolved())&&e(i)&&(n=1,1):(r._debugLog("Source "+i.id+" is loading -> wait"),n=0,1):(r._debugLog("Source "+i.id+" is skipped due to predicate"),1)))})),n},t.prototype._preloadMapCollections=function(e){var t=this,r=10,n=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((function(){return!0}),(function(i){return!(0===r||null!=e&&!e(i)||(i.load&&!i.isFulfilled()&&(t.logDebugInformation=n,t._debugLog("Pre-loading source "+i.id),t.logDebugInformation=!1,i.load().catch((function(){})),r--),0))})),this.logDebugInformation=n},t.prototype._forAllMapCollectionSources=function(e,t){for(var r=0,n=this.mapCollectionPaths;r<n.length;r++){var i="map."+n[r],o=this._ensureLoadedOwnersFromCollectionName(i);if(!1!==e(o)){var a=o.owner;if(!a||a.isRejected&&a.isRejected())this._debugLog("Collection "+i+" owner is invalid or rejected -> skip");else{var s=this.view.get(i);s?this._forEachSource(s,t):this._debugLog("Collection "+i+" does not exist -> skip")}}}},t.prototype._forEachSource=function(e,t){for(var r=0,n=e.items;r<n.length;r++){var i=n[r];!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}},t.prototype._processSpatialReferenceSource=function(e){var t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=o.intersect(t,this._spatialReferenceCandidates,(function(e,t){return e.equals(t)}))).length>0?this._spatialReferenceCandidates=t:this._debugLog("Layer "+e.id+" is ignored because its supported spatial\n          references are not compatible with the previous candidates"):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)},t.prototype._findExtent=function(e,t){var r="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),n=o.find(r,(function(e){return e.spatialReference.equals(t)}));if(n)return this._set("extent",n),!0;if(this._getSupportedSpatialReferences(e).length>0){var i=r.map((function(t){return{extent:t,layer:e}})),a=this._extentCandidates||[];this._extentCandidates=a.concat(i)}return!1},t.prototype._projectExtentCandidate=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,a,s;return n.__generator(this,(function(n){switch(n.label){case 0:return this._extentCandidates&&this._extentCandidates.length?(e=this.spatialReference,(t=o.find(this._extentCandidates,(function(t){return d.canProject(t.extent.spatialReference,e)})))?(this._set("extent",d.project(t.extent,e)),[3,7]):[3,1]):[2];case 1:return i=this._extentCandidates[0],this._extentProjectController=l.createAbortController(),[4,new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(359)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 2:a=n.sent(),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,a.projectGeometry(i.extent,e,i.layer.portalItem,this._extentProjectController.signal)];case 4:return s=n.sent(),this._set("extent",s),[3,6];case 5:return n.sent(),[3,6];case 6:this._extentProjectController=null,n.label=7;case 7:return[2]}}))}))},t.prototype._getSupportedSpatialReferences=function(e){var t=this,r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===r.length)return this._debugLog("Layer "+e.id+" is ignored because it does not have any spatial references"),[];var n=r.filter((function(r){return t.view.isSpatialReferenceSupported(r,e,(function(e){return t._debugLog(e)}))}));return 0===n.length?this._debugLog("Layer "+e.id+" has spatial references but none of them are supported (or layer doesn't require locking)"):this._debugLog("Layer "+e.id+" has spatial references. Resulting candidate set: "+n.map(f).join(", ")),n},t.prototype._processHeightModelInfoSource=function(e){var t=p.deriveHeightModelInfoFromLayer(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)},t.prototype._updateTileInfo=function(){if(null==this.tileInfo)if(this.view.isTileInfoRequired()){if(this.isSpatialReferenceDone){var e=this.get("view.map");if(e){var t=e.basemap,r=e.get("layers.0"),n=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");var i=t&&t.get("baseLayers.0");if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");n="tileInfo"in i&&i.tileInfo}else{if(!r||"failed"===r.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!r.loaded)return this._updateWhen(r.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in r&&r.tileInfo}}else if(r&&"failed"!==r.loadStatus){if(!r.loaded)return this._updateWhen(r.load()),void this._debugLog("updateTileInfo: first operational layer still loading");n="tileInfo"in r&&r.tileInfo}n&&!n.spatialReference.equals(this.spatialReference)&&(n=null),this._debugLog("updateTileInfo: setting "+n),this._set("tileInfo",n),this._set("isTileInfoDone",!0)}else this._debugLog("updateTileInfo: no map")}}else this._set("isTileInfoDone",!0)},t.prototype._debugLog=function(e){this.logDebugInformation&&h.info(e)},t.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],n.__decorate([u.property()],t.prototype,"logDebugInformation",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"isSpatialReferenceDone",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"isTileInfoDone",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"isHeightModelInfoSearching",void 0),n.__decorate([u.property({constructOnly:!0})],t.prototype,"view",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"spatialReference",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"extent",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"heightModelInfo",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"vcsWkid",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"latestVcsWkid",void 0),n.__decorate([u.property()],t.prototype,"mapCollectionPaths",void 0),n.__decorate([u.property()],t.prototype,"defaultSpatialReference",void 0),n.__decorate([u.property({readOnly:!0})],t.prototype,"tileInfo",void 0),i=n.__decorate([u.subclass("esri.views.support.DefaultsFromMap")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(369),r(158),r(231),r(151),r(530),r(1541),r(440)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(e,t,r,n){var i=e.targetGeometry,o=t.targetGeometry;n?"string"==typeof n&&(n=c.parse(n)||c.easingFunctions.ease):n=c.easingFunctions.ease,this.easing=n,this.duration=r,this.sCenterX=i.x,this.sCenterY=i.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=t.scale,this.tRotation=t.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}return e.prototype.applyRatio=function(e,t){var r,n,i,o,a=this.easing(t);t>=1?(r=this.tCenterX,n=this.tCenterY,i=this.tRotation,o=this.tScale):(r=this.sCenterX+a*this.dCenterX,n=this.sCenterY+a*this.dCenterY,i=this.sRotation+a*this.dRotation,o=this.sScale+a*this.dScale),e.targetGeometry.x=r,e.targetGeometry.y=n,e.scale=o,e.rotation=i},e}(),d=function(e){function t(t){var r=e.call(this,t)||this;return r.duration=200,r.transition=null,r.easing=c.easingFunctions.ease,r.view=null,r.viewpoint=null,r.viewpoint=new i({targetGeometry:new n.Point,scale:0,rotation:0}),r._updateTask=a.addFrameTask({postRender:r._postRender.bind(r)}),r._updateTask.pause(),r}return r.__extends(t,e),t.prototype.destroy=function(){this._updateTask.remove(),this._updateTask=null},t.prototype.animate=function(e,t,r){var n=this;this.stop();var i=this.viewpoint;u.copy(i,t),this.transition=new p(this.viewpoint,e.target,r&&r.duration||this.duration,r&&r.easing||this.easing);var o=function(){n.animation===e&&n._updateTask&&("finished"===e.state&&(n.transition.applyRatio(n.viewpoint,1),n.view.state&&(n.view.state.viewpoint=n.viewpoint.clone())),n.animation=null,n.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e},t.prototype.animateContinous=function(e,t){var r=this;this.stop(),this.updateFunction=t,this.viewpoint=e;var n=new l({target:e.clone()}),i=function(){r.animation===n&&r._updateTask&&(r.animation=null,r.updateFunction=null)};return n.when(i,i),this._startTime=performance.now(),this._updateTask.resume(),this.animation=n,n},t.prototype.stop=function(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)},t.prototype._postRender=function(e){var t=this.animation;if(t&&t.state!==l.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{var r=(performance.now()-this._startTime)/this.transition.duration,n=r>=1;this.transition.applyRatio(this.viewpoint,r),n&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()},r.__decorate([s.property()],t.prototype,"animation",void 0),r.__decorate([s.property()],t.prototype,"duration",void 0),r.__decorate([s.property()],t.prototype,"transition",void 0),r.__decorate([s.property()],t.prototype,"easing",void 0),r.__decorate([s.property()],t.prototype,"view",void 0),r.__decorate([s.property()],t.prototype,"viewpoint",void 0),r.__decorate([s.subclass("esri.views.2d.AnimationManager")],t)}(o);t.default=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n){var i=3*e,o=3*(r-e)-i,a=1-i-o,s=3*t,l=3*(n-t)-s,c=1-s-l;function u(e){return((a*e+o)*e+i)*e}return function(e,t){return void 0===t&&(t=1e-6),function(e){return((c*e+l)*e+s)*e}(function(e,t){var r,n,s,l,c,p,d;for(s=e,p=0;p<8;p++){if(l=u(s)-e,Math.abs(l)<t)return s;if(c=(3*a*(d=s)+2*o)*d+i,Math.abs(c)<1e-6)break;s-=l/c}if((s=e)<(r=0))return r;if(s>(n=1))return n;for(;r<n;){if(l=u(s),Math.abs(l-e)<t)return s;e>l?r=s:n=s,s=.5*(n-r)+r}return s}(e,t))}}Object.defineProperty(t,"__esModule",{value:!0}),t.unitBezier=r;var n=/^cubic-bezier\((.*)\)/;t.easingFunctions={},t.parse=function(e){var i=t.easingFunctions[e]||null;if(!i){var o=n.exec(e);if(o){var a=o[1].split(",").map((function(e){return parseFloat(e.trim())}));4!==a.length||a.some((function(e){return isNaN(e)}))||(i=r.apply(r,a))}}return i},t.easingFunctions.ease=r(.25,.1,.25,1),t.easingFunctions.linear=r(0,0,1,1),t.easingFunctions.easeIn=t.easingFunctions["ease-in"]=r(.42,0,1,1),t.easingFunctions.easeOut=t.easingFunctions["ease-out"]=r(0,0,.58,1),t.easingFunctions.easeInOut=t.easingFunctions["ease-in-out"]=r(.42,0,.58,1)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,1,0,0]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},t.fromValues=function(e,t,r,n,i,o){return[e,t,r,n,i,o]},t.createView=function(e,t){return new Float64Array(e,t,6)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function i(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function a(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function s(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function l(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function c(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=n,t.multiply=i,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},t.distance=a,t.squaredDistance=s,t.length=l,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},t.lerp=function(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e},t.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},t.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},t.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},t.rotate=function(e,t,r,n){var i=t[0]-r[0],o=t[1]-r[1],a=Math.sin(n),s=Math.cos(n);return e[0]=i*s-o*a+r[0],e[1]=i*a+o*s+r[1],e},t.angle=function(e,t){var r=e[0],n=e[1],i=t[0],o=t[1],a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var l=(r*i+n*o)*a*s;return l>1?0:l<-1?Math.PI:Math.acos(l)},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var n=e[0],i=e[1],o=t[0],a=t[1];return Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))},t.len=l,t.sub=n,t.mul=i,t.div=o,t.dist=a,t.sqrDist=s,t.sqrLen=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return[e,t]}function n(){return r(1,1)}function i(){return r(1,0)}function o(){return r(0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0]},t.clone=function(e){return[e[0],e[1]]},t.fromValues=r,t.fromArray=function(e){for(var t=[0,0],r=Math.min(2,e.length),n=0;n<r;++n)t[n]=e[n];return t},t.createView=function(e,t){return new Float64Array(e,t,2)},t.zeros=function(){return[0,0]},t.ones=n,t.unitX=i,t.unitY=o,t.ZEROS=[0,0],t.ONES=n(),t.UNIT_X=i(),t.UNIT_Y=o()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(231)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.view=e,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=function(){t._updateParameters.state=t.view.state,t._updateParameters.stationary=t.view.stationary,t._updateParameters.pixelRatio=window.devicePixelRatio,t._updateParameters.renderingOptions=t.view.renderingOptions},this.update=function(){if(t._updateRequested=!1,t.updateEnabled){var e=t.view,n=e.basemapView,i=e.graphicsView,o=e.labelManager,a=e.layerViews,s=e.state.id;n.baseLayerViews.forEach(t._updateLayerView,t),a.forEach(t._updateLayerView,t),n.referenceLayerViews.forEach(t._updateLayerView,t),r.isSome(o)&&(o.lastUpdateId!==s&&(o.viewChange(),o.lastUpdateId=s),o.updateRequested&&o.processUpdate(t._updateParameters)),r.isSome(i)&&(i.lastUpdateId!==s&&(i.viewChange(),i.lastUpdateId=s),i.updateRequested&&i.processUpdate(t._updateParameters)),t.animationInProgress||t._updateRequested||t._frameTaskHandle.pause()}}}return e.prototype.destroy=function(){this.stop()},e.prototype.start=function(){var e=this;this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(function(t){e.stationary=t,e.requestFrame()})),this._frameTaskHandle=n.addFrameTask(this)},e.prototype.stop=function(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)},e.prototype.requestUpdate=function(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())},e.prototype.requestFrame=function(){this._frameTaskHandle&&this._frameTaskHandle.resume()},e.prototype._updateLayerView=function(e){var t=this.view.state,r=e.lastUpdateId;null!=r&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),r!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)},e}();t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(152),r(161)],void 0===(i=function(e,t,n,i){function o(){return Promise.all([new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(204)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){Promise.all([r.e(2),r.e(3)]).then(function(){var t=[r(186)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))])}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(71)]).then(function(){var t=[r(2095)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},s=function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(16)]).then(function(){var t=[r(1345)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},l={"base-dynamic":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(88)]).then(function(){var t=[r(2100)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"base-tile":a,"bing-maps":a,csv:s,"geo-rss":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(94)]).then(function(){var t=[r(2101)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},feature:s,geojson:s,graphics:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(101)]).then(function(){var t=[r(2102)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},group:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(87)]).then(function(){var t=[r(2103)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},imagery:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(73)]).then(function(){var t=[r(2105)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"imagery-tile":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(20),r.e(84)]).then(function(){var t=[r(2106)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},kml:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(82)]).then(function(){var t=[r(2107)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"map-image":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(57)]).then(function(){var t=[r(2108)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"map-notes":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(102)]).then(function(){var t=[r(2109)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"ogc-feature":s,"open-street-map":a,route:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(11),r.e(103)]).then(function(){var t=[r(2110)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},stream:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(16),r.e(189)]).then(function(){var t=[r(2111)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},tile:a,"vector-tile":function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(54)]).then(function(){var t=[r(2112)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"web-tile":a,wms:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(65)]).then(function(){var t=[r(2116)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},wmts:function(){return o().then((function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(98)]).then(function(){var t=[r(2117)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))}))},"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,scene:null,unknown:null,unsupported:null};t.layerView2DImporter={hasLayerViewModule:function(e){return i.isSome(l[e.type])},importLayerView:function(e){var t=l[e.type];if(!i.isSome(t))throw function(e){var t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new n(r+":view-not-supported",t+" is not supported in 2D")}(e);return t(e)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(151),r(486),r(1548),r(1549)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lods=null,t.minScale=0,t.maxScale=0,t.minZoom=-1,t.maxZoom=-1,t.rotationEnabled=!0,t.snapToZoom=!0,t}return r.__extends(t,e),t.prototype.initialize=function(){this.watch("_zoom, _rotation",this.emit.bind(this,"update"),!0)},t.prototype.destroy=function(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)},Object.defineProperty(t.prototype,"_rotation",{get:function(){return new a({rotationEnabled:this.rotationEnabled})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_defaultLODs",{get:function(){var e=this.get("view.defaultsFromMap.tileInfo"),t=this.get("view.spatialReference");return e&&t&&e.spatialReference.equals(t)?e.lods:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_zoom",{get:function(){return new s({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})},enumerable:!0,configurable:!0}),t.prototype.canZoomInTo=function(e){var t=this.effectiveMaxScale;return 0===t||e>=t},t.prototype.canZoomOutTo=function(e){var t=this.effectiveMinScale;return 0===t||e<=t},t.prototype.constrain=function(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),e},t.prototype.fit=function(e){return this._zoom.fit(e)},t.prototype.zoomToScale=function(e){return this._zoom.zoomToScale(e)},t.prototype.scaleToZoom=function(e){return this._zoom.scaleToZoom(e)},t.prototype.snapScale=function(e){return this._zoom.snapToClosestScale(e)},t.prototype.snapToNextScale=function(e){return this._zoom.snapToNextScale(e)},t.prototype.snapToPreviousScale=function(e){return this._zoom.snapToPreviousScale(e)},r.__decorate([i.property({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],t.prototype,"effectiveLODs",void 0),r.__decorate([i.property({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],t.prototype,"effectiveMinScale",void 0),r.__decorate([i.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],t.prototype,"effectiveMaxScale",void 0),r.__decorate([i.property({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],t.prototype,"effectiveMinZoom",void 0),r.__decorate([i.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],t.prototype,"effectiveMaxZoom",void 0),r.__decorate([i.property({type:[o]})],t.prototype,"lods",void 0),r.__decorate([i.property()],t.prototype,"minScale",void 0),r.__decorate([i.property()],t.prototype,"maxScale",void 0),r.__decorate([i.property()],t.prototype,"minZoom",void 0),r.__decorate([i.property()],t.prototype,"maxZoom",void 0),r.__decorate([i.property()],t.prototype,"rotationEnabled",void 0),r.__decorate([i.property()],t.prototype,"snapToZoom",void 0),r.__decorate([i.property()],t.prototype,"view",void 0),r.__decorate([i.property({type:a,dependsOn:["rotationEnabled"]})],t.prototype,"_rotation",null),r.__decorate([i.property({dependsOn:["view.spatialReference","view.defaultsFromMap.tileInfo"]})],t.prototype,"_defaultLODs",null),r.__decorate([i.property({readOnly:!0,type:s,dependsOn:["lods","minZoom","maxZoom","minScale","maxScale","snapToZoom","_defaultLODs"]})],t.prototype,"_zoom",null),r.__decorate([i.subclass("esri.views.2d.MapViewConstraints")],t)}(n.EventedAccessor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.enabled=!0,t.rotationEnabled=!0,t}var n;return r.__extends(t,e),n=t,t.prototype.constrain=function(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e},t.prototype.clone=function(){return new n({enabled:this.enabled,rotationEnabled:this.rotationEnabled})},r.__decorate([i.property()],t.prototype,"enabled",void 0),r.__decorate([i.property()],t.prototype,"rotationEnabled",void 0),n=r.__decorate([i.subclass("esri.views.2d.constraints.RotationConstraint")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(486)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r._lodByScale={},r._scales=[],r.effectiveLODs=null,r.effectiveMinZoom=-1,r.effectiveMaxZoom=-1,r.effectiveMinScale=0,r.effectiveMaxScale=0,r.lods=null,r.minZoom=-1,r.maxZoom=-1,r.minScale=0,r.maxScale=0,r.snapToZoom=!0,r}var n;return r.__extends(t,e),n=t,t.prototype.initialize=function(){var e,t,r,n=this,i=this,o=i.lods,a=i.minScale,s=i.maxScale,l=i.minZoom,c=i.maxZoom,u=-1,p=-1,d=!1,h=!1;if(0!==a&&0!==s&&a<s&&(a=(e=[s,a])[0],s=e[1]),!o||!o.length)return this._set("effectiveMinScale",a),void this._set("effectiveMaxScale",s);(o=o.map((function(e){return e.clone()}))).sort((function(e,t){return t.scale-e.scale})),o.forEach((function(e,t){return e.level=t}));for(var f=0,v=o;f<v.length;f++){var m=v[f];!d&&a>0&&a>=m.scale&&(u=m.level,d=!0),!h&&s>0&&s>=m.scale&&(p=r?r.level:-1,h=!0),r=m}-1===l&&(l=0===a?0:u),-1===c&&(c=0===s?o.length-1:p),l=Math.max(l,0),l=Math.min(l,o.length-1),c=Math.max(c,0),l>(c=Math.min(c,o.length-1))&&(l=(t=[c,l])[0],c=t[1]),a=o[l].scale,s=o[c].scale,o.splice(0,l),o.splice(c-l+1,o.length),o.forEach((function(e,t){n._lodByScale[e.scale]=e,n._scales[t]=e.scale})),this._set("effectiveLODs",o),this._set("effectiveMinZoom",l),this._set("effectiveMaxZoom",c),this._set("effectiveMinScale",a),this._set("effectiveMaxScale",s)},t.prototype.constrain=function(e,t){if(t&&e.scale===t.scale)return e;var r=this.effectiveMinScale,n=this.effectiveMaxScale,i=e.targetGeometry,o=t&&t.targetGeometry,a=0!==n&&e.scale<n,s=0!==r&&e.scale>r;if(a||s){var l=s?r:n;if(o){var c=(l-t.scale)/(e.scale-t.scale);i.x=o.x+(i.x-o.x)*c,i.y=o.y+(i.y-o.y)*c}e.scale=l}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e},t.prototype.fit=function(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);var t=this.scaleToZoom(e.scale),r=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(r>.99?Math.round(t):Math.floor(t)),e},t.prototype.zoomToScale=function(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);var t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var r=Math.round(e-.5),n=Math.round(e);return t[n]+(n-e)*(t[r]-t[n])},t.prototype.scaleToZoom=function(e){if(!this.effectiveLODs)return-1;var t,r,n=this._scales;if(e>=n[0])return this.effectiveMinZoom;if(e<=n[n.length-1])return this.effectiveMaxZoom;for(var i=0;i<n.length-1;i++){if(t=n[i],(r=n[i+1])===e)return i+this.effectiveMinZoom+1;if(t>e&&r<e)return i+this.effectiveMinZoom+1-(e-r)/(t-r)}},t.prototype.snapToClosestScale=function(e){if(!this.effectiveLODs)return e;var t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))},t.prototype.snapToNextScale=function(e,t){if(void 0===t&&(t=.5),!this.effectiveLODs)return e*t;var r=Math.round(this.scaleToZoom(e));return this.zoomToScale(r+1)},t.prototype.snapToPreviousScale=function(e,t){if(void 0===t&&(t=2),!this.effectiveLODs)return e*t;var r=Math.round(this.scaleToZoom(e));return this.zoomToScale(r-1)},t.prototype.clone=function(){return new n({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})},t.prototype._getClosestScale=function(e){return this._lodByScale[e]||(e=this._scales.reduce((function(t,r){return Math.abs(r-e)<=Math.abs(t-e)?r:t}),this._scales[0])),this._lodByScale[e].scale},r.__decorate([i.property({readOnly:!0})],t.prototype,"effectiveLODs",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"effectiveMinZoom",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"effectiveMaxZoom",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"effectiveMinScale",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"effectiveMaxScale",void 0),r.__decorate([i.property({type:[o]})],t.prototype,"lods",void 0),r.__decorate([i.property()],t.prototype,"minZoom",void 0),r.__decorate([i.property()],t.prototype,"maxZoom",void 0),r.__decorate([i.property()],t.prototype,"minScale",void 0),r.__decorate([i.property()],t.prototype,"maxScale",void 0),r.__decorate([i.property()],t.prototype,"snapToZoom",void 0),n=r.__decorate([i.subclass("esri.views.2d.constraints.ZoomConstraint")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(205),r(216),r(440),r(914)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.left=0,t.top=0,t.right=0,t.bottom=0,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"left",void 0),r.__decorate([i.property()],t.prototype,"top",void 0),r.__decorate([i.property()],t.prototype,"right",void 0),r.__decorate([i.property()],t.prototype,"bottom",void 0),r.__decorate([i.subclass("esri.views.2d.PaddedViewState.Padding")],t)}(n);return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i=e.apply(this,t)||this;return i.paddedViewState=new l,i._updateContent=(n=a.vec2f64.create(),function(){var e=i._get("size"),t=i._get("padding");if(e&&t){var r=i.paddedViewState;o.vec2.set(n,t.left+t.right,t.top+t.bottom),o.vec2.subtract(n,e,n),o.vec2.copy(r.size,n);var a=r.viewpoint;a&&(i.viewpoint=a)}}),i.watch(["size","padding"],i._updateContent,!0),i.padding=new c,i.size=[0,0],i}return r.__extends(t,e),Object.defineProperty(t.prototype,"padding",{set:function(e){this._set("padding",e||new c)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewpoint",{set:function(e){if(e){var t=e.clone();this.paddedViewState.viewpoint=e,s.addPadding(t,e,this._get("size"),this._get("padding"));var r=this._viewpoint2D,n=t.targetGeometry;r.center[0]=n.x,r.center[1]=n.y,r.rotation=t.rotation,r.scale=t.scale,r.spatialReference=n.spatialReference,this._update()}},enumerable:!0,configurable:!0}),r.__decorate([i.property()],t.prototype,"paddedViewState",void 0),r.__decorate([i.property({type:c})],t.prototype,"padding",null),r.__decorate([i.property()],t.prototype,"viewpoint",null),r.__decorate([i.subclass("esri.views.2d.PaddedViewState")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n){var i=t[n],o=t[n+1];e[n]=r[0]*i+r[2]*o+r[4],e[n+1]=r[1]*i+r[3]*o+r[5]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){var e=new Float32Array(6);return e[0]=1,e[3]=1,e},t.clone=function(e){var t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.fromValues=function(e,t,r,n,i,o){var a=new Float32Array(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a[4]=i,a[5]=o,a},t.createView=function(e,t){return new Float32Array(e,t,6)},t.transform=r,t.transformMany=function(e,t,n,i,o,a){void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=2);for(var s=o||t.length/a,l=i;l<s;l++)r(e,t,n,l*a)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){function n(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],p=t[8],d=r[0],h=r[1],f=r[2],v=r[3],m=r[4],y=r[5],g=r[6],_=r[7],b=r[8];return e[0]=d*n+h*a+f*c,e[1]=d*i+h*s+f*u,e[2]=d*o+h*l+f*p,e[3]=v*n+m*a+y*c,e[4]=v*i+m*s+y*u,e[5]=v*o+m*l+y*p,e[6]=g*n+_*a+b*c,e[7]=g*i+_*s+b*u,e[8]=g*o+_*l+b*p,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.set=function(e,t,r,n,i,o,a,s,l,c){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],p=u*a-s*c,d=-u*o+s*l,h=c*o-a*l,f=r*p+n*d+i*h;return f?(f=1/f,e[0]=p*f,e[1]=(-u*n+i*c)*f,e[2]=(s*n-i*a)*f,e[3]=d*f,e[4]=(u*r-i*l)*f,e[5]=(-s*r+i*o)*f,e[6]=h*f,e[7]=(-c*r+n*l)*f,e[8]=(a*r-n*o)*f,e):null},t.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=i*c-n*u,e[2]=n*s-i*a,e[3]=s*l-o*u,e[4]=r*u-i*l,e[5]=i*o-r*s,e[6]=o*c-a*l,e[7]=n*l-r*c,e[8]=r*a-n*o,e},t.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*(c*o-a*l)+r*(-c*i+a*s)+n*(l*i-o*s)},t.multiply=n,t.translate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],p=t[8],d=r[0],h=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=d*n+h*a+c,e[7]=d*i+h*s+u,e[8]=d*o+h*l+p,e},t.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],p=t[8],d=Math.sin(r),h=Math.cos(r);return e[0]=h*n+d*a,e[1]=h*i+d*s,e[2]=h*o+d*l,e[3]=h*a-d*n,e[4]=h*s-d*i,e[5]=h*l-d*o,e[6]=c,e[7]=u,e[8]=p,e},t.scale=function(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=o*t[6],e[7]=o*t[7],e[8]=o*t[8],e},t.scaleByVec2=function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,u=n*a,p=n*s,d=i*a,h=i*s,f=i*l,v=o*a,m=o*s,y=o*l;return e[0]=1-p-f,e[3]=u-y,e[6]=d+m,e[1]=u+y,e[4]=1-c-f,e[7]=h-v,e[2]=d-m,e[5]=h+v,e[8]=1-c-p,e},t.normalFromMat4Legacy=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10],p=u*a-s*c,d=-u*o+s*l,h=c*o-a*l,f=r*p+n*d+i*h;if(!f)return null;var v=1/f;return e[0]=p*v,e[1]=(-u*n+i*c)*v,e[2]=(s*n-i*a)*v,e[3]=d*v,e[4]=(u*r-i*l)*v,e[5]=(-s*r+i*o)*v,e[6]=h*v,e[7]=(-c*r+n*l)*v,e[8]=(a*r-n*o)*v,e},t.normalFromMat4=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],h=t[11],f=t[12],v=t[13],m=t[14],y=t[15],g=r*s-n*a,_=r*l-i*a,b=r*c-o*a,x=n*l-i*s,w=n*c-o*s,S=i*c-o*l,P=u*v-p*f,T=u*m-d*f,O=u*y-h*f,C=p*m-d*v,M=p*y-h*v,A=d*y-h*m,E=g*A-_*M+b*C+x*O-w*T+S*P;return E?(E=1/E,e[0]=(s*A-l*M+c*C)*E,e[1]=(l*O-a*A-c*T)*E,e[2]=(a*M-s*O+c*P)*E,e[3]=(i*M-n*A-o*C)*E,e[4]=(r*A-i*O+o*T)*E,e[5]=(n*O-r*M-o*P)*E,e[6]=(v*S-m*w+y*x)*E,e[7]=(m*b-f*S-y*_)*E,e[8]=(f*w-v*b+y*g)*E,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],p=e[8],d=t[0],h=t[1],f=t[2],v=t[3],m=t[4],y=t[5],g=t[6],_=t[7],b=t[8];return Math.abs(n-d)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-h)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-v)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-y)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-g)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-_)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(p-b)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(b))},t.mul=n,t.sub=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e},t.clone=function(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.fromValues=function(e,t,r,n,i,o,a,s,l){var c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=n,c[4]=i,c[5]=o,c[6]=a,c[7]=s,c[8]=l,c},t.createView=function(e,t){return new Float32Array(e,t,9)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(){return new Float32Array(2)}function n(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}function i(){return r()}function o(){return n(1,1)}function a(){return n(1,0)}function s(){return n(0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.clone=function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=n,t.createView=function(e,t){return new Float32Array(e,t,2)},t.zeros=i,t.ones=o,t.unitX=a,t.unitY=s,t.ZEROS=i(),t.ONES=o(),t.UNIT_X=a(),t.UNIT_Y=s()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e instanceof Float32Array&&e.length>=2}function n(e){return Array.isArray(e)&&e.length>=2}Object.defineProperty(t,"__esModule",{value:!0}),t.isVec2f32=r,t.isVec2f64=n,t.isVec2=function(e){return r(e)||n(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(178),r(286)],void 0===(i=function(e,t,r,n){function i(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}var a=new n("0/0/0/0");return function(){function e(e,t,r,n,i,o,a,s,l,c,u,p){this.level=e,this.resolution=t,this.scale=r,this.origin=n,this.first=i,this.last=o,this.size=a,this.norm=s,this.worldStart=l,this.worldEnd=c,this.worldSize=u,this.wrap=p}return e.create=function(t,n,a){var s,l,c,u,p=r.getInfo(t.spatialReference),d=i(t.origin.x,t.origin.y),h=i(t.size[0]*n.resolution,t.size[1]*n.resolution),f=i(-1/0,-1/0),v=i(1/0,1/0),m=i(1/0,1/0);return a&&(o(f,Math.max(0,Math.floor((a.xmin-d[0])/h[0])),Math.max(0,Math.floor((d[1]-a.ymax)/h[1]))),o(v,Math.max(0,Math.floor((a.xmax-d[0])/h[0])),Math.max(0,Math.floor((d[1]-a.ymin)/h[1]))),o(m,v[0]-f[0]+1,v[1]-f[1]+1)),t.isWrappable?(s=i(Math.ceil(Math.round(2*p.origin[1]/n.resolution)/t.size[0]),m[1]),l=i(Math.floor((p.origin[0]-d[0])/h[0]),f[1]),c=i(s[0]+l[0]-1,v[1]),u=!0):(l=f,c=v,s=m,u=!1),new e(n.level,n.resolution,n.scale,d,f,v,m,h,l,c,s,u)},e.prototype.normalizeCol=function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t},e.prototype.denormalizeCol=function(e,t){return this.wrap?this.worldSize[0]*t+e:e},e.prototype.getWorldForColumn=function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0},e.prototype.getFirstColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]},e.prototype.getLastColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1},e.prototype.getColumnForX=function(e){return(e-this.origin[0])/this.norm[0]},e.prototype.getXForColumn=function(e){return this.origin[0]+e*this.norm[0]},e.prototype.getRowForY=function(e){return(this.origin[1]-e)/this.norm[1]},e.prototype.getYForRow=function(e){return this.origin[1]-e*this.norm[1]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),a.set(t);var n=r?a.col:this.denormalizeCol(a.col,a.world),i=a.row;return function(e,t,r,n,i){e[0]=t,e[1]=r,e[2]=n,e[3]=i}(e,this.getXForColumn(n),this.getYForRow(i+1),this.getXForColumn(n+1),this.getYForRow(i)),e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),a.set(t);var n=r?a.col:this.denormalizeCol(a.col,a.world);return Array.isArray(e)?o(e,this.getXForColumn(n),this.getYForRow(a.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(a.row)),e},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(153),r(1559),r(231)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t){this.item=e,this.controller=t,this.promise=null},s=function(){function e(e){var t=this;this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new i.default(e.peeker),this.process=e.process;var n=e.scheduler;e.task&&r.isSome(n)&&(this._task=n.registerTask(e.task,(function(e){return t.update(e)}),(function(){return t.needsUpdate()})))}return e.prototype.destroy=function(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)},Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){var t=this._controllers.get(e);t&&t.abort()},e.prototype.clear=function(){this._queue.clear();var e=[];this._controllers.forEach((function(t){return e.push(t)})),this._controllers.clear(),e.forEach((function(e){return e.abort()})),this._processingItems.clear(),this._cancelNext()},e.prototype.get=function(e){var t=this._deferreds.get(e);return t?t.promise:void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._deferreds.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t,r=this,i=this.get(e);if(i)return i;var o=n.createAbortController(),a=function(){s.remove(),r._deferreds.delete(e),r._controllers.delete(e),r._queue.remove(e),r._processingItems.delete(e),r._scheduleNext()},s=n.onAbortOrThrow(o.signal,(function(){var i=r._processingItems.get(e);i&&i.controller.abort(),a(),t.reject(n.createAbortError())}));return t=n.createDeferred(),this._deferreds.set(e,t),this._controllers.set(e,o),t.promise.then(a,a),this._queue.push(e),this._scheduleNext(),t.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach((function(t){return e.push(t)})),this._processingItems.clear();for(var t=0,r=e;t<r.length;t++){var n=r[t];this._queue.push(n.item),n.controller.abort()}this._scheduleNext()},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype.needsUpdate=function(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency},e.prototype.update=function(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()},e.prototype._scheduleNext=function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=o.schedule((function(){e._schedule=null,e._next()})))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)},e.prototype._processResult=function(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))},e.prototype._processError=function(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))},e.prototype._canProcessFulfillment=function(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e},e.prototype._process=function(e){var t=this;if(!r.isNone(e)){var i,o,s=n.createAbortController(),l=new a(e,s);this._processingItems.set(e,l);try{i=this.process(e,s.signal)}catch(e){this._processError(l,e)}(o=i)&&"function"==typeof o.then?(l.promise=i,i.then((function(e){return t._processResult(l,e)}),(function(e){return t._processError(l,e)}))):this._processResult(l,i)}},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)}}},enumerable:!0,configurable:!0}),e}();t.QueueProcessor=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(198)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e=function(e){return r.firstOfSet(e)}),this._peeker=e,this._items=new Set}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.peek=function(){if(0!==this._items.size)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._items.add(e)},e.prototype.contains=function(e){return this._items.has(e)},e.prototype.pop=function(){if(0!==this.length){var e=this.peek();return this._items.delete(e),e}},e.prototype.remove=function(e){this._items.delete(e)},e}();t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(205)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this.maxSize=e,this.tileInfoView=t,this.removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}return e.prototype.has=function(e){return this._tilePerId.has(e)},e.prototype.get=function(e){return this._tilePerId.get(e)},e.prototype.pop=function(e){var t=this._tilePerId.get(e);if(!t)return null;var r=t.key.level,n=this._tileKeysPerLevel[r];i(this._tilePerId,e);for(var o=0;o<n.length;o++)if(n[o].id===e){n.splice(o,1);break}return t.visible=!0,t},e.prototype.add=function(e){e.visible=!1;var t=e.key,r=t.id;if(!this._tilePerId.has(r)){this._tilePerId.set(r,e);var n=t.level;this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(t)}},e.prototype.prune=function(e,t,r){var n=this._tilePerId.size;if(!(n<=this.maxSize)){for(var i=this._tileKeysPerLevel.length-1;n>this.maxSize&&i>=0;)i!==e&&(n=this._pruneAroundCenterTile(n,t,r,i)),i--;n>this.maxSize&&(n=this._pruneAroundCenterTile(n,t,r,e))}},e.prototype._pruneAroundCenterTile=function(e,t,n,i){var o=this._tileKeysPerLevel[i];if(!o||0===o.length)return e;var a=this.tileInfoView.tileInfo,s=a.size,l=a.origin,c=n*s[0],u=n*s[1],p=[0,0],d=[0,0];for(o.sort((function(e,n){return p[0]=l.x+c*(e.col+.5),p[1]=l.y-u*(e.row+.5),d[0]=l.x+c*(n.col+.5),d[1]=l.y-u*(n.row+.5),r.vec2.squaredDistance(p,t)-r.vec2.squaredDistance(d,t)}));o.length>0;){var h=o.pop();if(this._removeTile(h.id),--e===this.maxSize)break}return e},e.prototype._removeTile=function(e){var t=this._tilePerId.get(e);this.removedFunc&&this.removedFunc(t),i(this._tilePerId,e)},e}();function i(e,t){e.delete(t)}t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(1562),r(1563),r(1564),r(1565),r(1566),r(1567),r(1568),r(1569),r(1570),r(1571),r(1154),r(637),r(1155),r(1574),r(1156),r(1157),r(1158),r(793)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){var T={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},O={zoomIn:["=","+"],zoomOut:["-","_"]},C={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new i,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([o.whenNot(this.view,"ready",(function(){return e._disconnect()})),o.when(this.view,"ready",(function(){return e._connect()}))])},t.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()},t.prototype._disconnect=function(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)},t.prototype._connect=function(){var e=this,t=this.view.surface,r=new y.BrowserEventSource(t,this.view.input),n=[new w.ImmediateDoubleClick,new S.PointerClickHoldAndDrag,new P.SingleAndDoubleClick,new x.Drag(this.view.navigation),new b.DoubleTapDrag],i=new g.InputManager({eventSource:r,recognizers:n});i.installHandlers("prevent-context-menu",[new _.PreventContextMenu],g.ViewEventPriorities.INTERNAL),i.installHandlers("navigation",[new m.PinchRotateAndZoom(this.view),new p.GamepadNavigation(this.view),new v.MouseWheelZoom(this.view),new s.DoubleClickZoom(this.view),new s.DoubleClickZoom(this.view,["Ctrl"]),new c.DragPan(this.view,"primary"),new d.KeyPan(this.view,T),new f.KeyZoom(this.view,O),new h.KeyRotate(this.view,C),new u.DragRotate(this.view,"secondary"),new l.DoubleTapDragZoom(this.view,"touch")],g.ViewEventPriorities.INTERNAL),this.view.viewEvents.connect(i),this._source=r,this._inputManager=i,o.init(this.view.navigation,"browserTouchPanEnabled",(function(t){e._source.browserTouchPanningEnabled=!t}))},Object.defineProperty(t.prototype,"test",{get:function(){return{inputManager:this._inputManager}},enumerable:!0,configurable:!0}),r.__decorate([a.property()],t.prototype,"view",void 0),r.__decorate([a.subclass("esri.views.2d.input.MapViewInputManager")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241),r(531)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.view=t,n.registerIncoming("double-click",r,(function(e){return n._handleDoubleClick(e,r)})),n}return r.__extends(t,e),t.prototype._handleDoubleClick=function(e,t){i.eventMatchesPointerAction(e.data,"primary")&&(e.stopPropagation(),t?this.view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this.view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))},t}(n.InputHandler);t.DoubleClickZoom=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(241)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,!0)||this;return i.view=t,i.pointerType=r,i.registerIncoming("double-tap-drag",n,(function(e){return i._handleDoubleTapDrag(e)})),i}return r.__extends(t,e),t.prototype._handleDoubleTapDrag=function(e){var t=e.data;if(t.pointerType===this.pointerType){e.stopPropagation();var r=t.action,i=t.delta,o=this.view,a=o.mapViewNavigation;switch(r){case"begin":var s=o.scale;this._startScale=s,this._currentScale=s,this._previousDelta=i,a.begin();break;case"update":if(this._previousDelta.y===i.y)return;this._previousDelta=i;var l=Math.pow(1.015,i.y),c=this._startScale*l,u=c/this._currentScale;a.setViewpointImmediate(u),this._currentScale=c;break;case"end":var p=o.constraints,d=p.effectiveLODs;if(!p.snapToZoom||!d)return void a.end();var h=p.snapScale(this._currentScale),f=(i.y>0?Math.max(h,p.snapToPreviousScale(this._startScale)):Math.min(h,p.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f);break;default:n.neverReached(r)}}},t}(i.InputHandler);t.DoubleTapDragZoom=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(641),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,i){var a=e.call(this,!0)||this;a.view=t,a.pointerAction=r,a.registerIncoming("drag",i,(function(e){return a._handleDrag(e)})),a.registerIncoming("pointer-down",(function(){return a.stopMomentumNavigation()}));var s=a.view.mapViewNavigation;return a.dragEventSeparator=new n.DragEventSeparator({start:function(e,t){s.pan.begin(a.view,t.data),t.stopPropagation()},update:function(e,t){s.pan.update(a.view,t.data),t.stopPropagation()},end:function(e,t){s.pan.end(a.view,t.data),t.stopPropagation()},condition:function(e,t){return 1===e&&o.eventMatchesPointerAction(t.data,a.pointerAction)}}),a}return r.__extends(t,e),t.prototype._handleDrag=function(e){var t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(e)},t.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()},t}(i.InputHandler);t.DragPan=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(641),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,i){var a=e.call(this,!0)||this;a.view=t,a.pointerAction=r;var s=a.view.mapViewNavigation;return a.dragEventSeparator=new n.DragEventSeparator({start:function(e,t){s.rotate.begin(a.view,t.data),t.stopPropagation()},update:function(e,t){s.rotate.update(a.view,t.data),t.stopPropagation()},end:function(e,t){s.rotate.end(),t.stopPropagation()},condition:function(e,t){return 1===e&&o.eventMatchesPointerAction(t.data,a.pointerAction)}}),a.registerIncoming("drag",i,(function(e){return a.dragEventSeparator.handle(e)})),a}return r.__extends(t,e),t}(i.InputHandler);t.DragRotate=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(167),r(231),r(157),r(440),r(241),r(1153)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t){var r=e.call(this,!0)||this;return r.view=t,r.frameTask=null,r.watchHandles=new n,r.currentDevice=null,r.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},r.handle=r.registerIncoming("gamepad",(function(e){return r.handleEvent(e)})),r.handle.pause(),r}return r.__extends(t,e),t.prototype.onInstall=function(t){var r=this;e.prototype.onInstall.call(this,t),this.watchHandles.add([o.init(this.view.navigation.gamepad,"enabled",(function(e){e?(r.handle.resume(),r.frameTask||(r.frameTask=i.addFrameTask({update:function(e){return r.frameUpdate(e.deltaTime)}}))):(r.handle.pause(),r.frameTask&&(r.frameTask.remove(),r.frameTask=null))}))])},t.prototype.onUninstall=function(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),e.prototype.onUninstall.call(this)},t.prototype.handleEvent=function(e){var t=this.view.navigation.gamepad.device;t&&e.data.device!==t||this.currentDevice&&this.currentDevice!==e.data.device||("end"===e.data.action?(this.currentDevice=null,l.resetTransformation(this.transformation)):(this.currentDevice=e.data.device,l.extractTransformation(e.data,this.view.navigation.gamepad,this.transformation)))},t.prototype.frameUpdate=function(e){var t=this.transformation;if(!l.isZeroTransformation(t)){var r=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,i=p*n*e;a.translateBy(r,r,[t.translation[0]*i,-t.translation[1]*i]);var o=1+t.translation[2]*d*e,s=this.view.constraints.rotationEnabled?-t.heading*u*e:0,c=this.view.size,h=[c[0]/2,c[1]];a.scaleAndRotateBy(r,r,o,s,h,c);var f=this.view.constraints.constrain(r,this.view.viewpoint);this.view.viewpoint=f}},t}(s.InputHandler);t.GamepadNavigation=c;var u=.06,p=.7,d=6e-4}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var i,o=e.call(this,!0)||this;return o.view=t,o.keys=r,o._pressed=!1,o._keyMap=((i={})[r.left]="left",i[r.right]="right",i[r.up]="up",i[r.down]="down",i),o.registerIncoming("key-down",n,(function(e){return o._handleKeyDown(e)})),o.registerIncoming("key-up",n,(function(e){return o._handleKeyUp(e)})),o.registerIncoming("blur",n,(function(){return o._handleBlur()})),o}return r.__extends(t,e),t.prototype._handleKeyDown=function(e){e.data.repeat||this._handleKey(e,!0)},t.prototype._handleKeyUp=function(e){this._handleKey(e,!1)},t.prototype._handleBlur=function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())},t.prototype._handleKey=function(e,t){var r=this._keyMap[e.data.key];if(this._pressed=null!=r,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),r){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}},t}(n.InputHandler);t.KeyPan=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var i,o=e.call(this,!0)||this;return o.view=t,o.keys=r,o._pressed=!1,o._keyToDirection=((i={})[r.clockwiseOption1]="clockwise",i[r.clockwiseOption2]="clockwise",i[r.counterClockwiseOption1]="counterClockwise",i[r.counterClockwiseOption2]="counterClockwise",i[r.resetOption1]="reset",i[r.resetOption2]="reset",i),o.registerIncoming("key-down",n,(function(e){return o._handleKeyDown(e)})),o.registerIncoming("key-up",n,(function(e){return o._handleKeyUp(e)})),o.registerIncoming("blur",n,(function(){return o._handleBlur()})),o}return r.__extends(t,e),t.prototype._handleKeyDown=function(e){e.data.repeat||this._handleKey(e,!0)},t.prototype._handleKeyUp=function(e){this._handleKey(e,!1)},t.prototype._handleBlur=function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())},t.prototype._handleKey=function(e,t){var r=e.modifiers;if(!(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)){var n=this._keyToDirection[e.data.key];if(this._pressed=null!=n,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},t}(n.InputHandler);t.KeyRotate=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(241)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n){var i=e.call(this,!0)||this;return i.view=t,i.keys=r,i._keysToZoomAction={},i.registerIncoming("key-down",n,(function(e){return i._handleKeyDown(e)})),r.zoomIn.forEach((function(e){return i._keysToZoomAction[e]=0})),r.zoomOut.forEach((function(e){return i._keysToZoomAction[e]=1})),i}return r.__extends(t,e),t.prototype._handleKeyDown=function(e){this._handleKey(e)},t.prototype._handleKey=function(e){var t=e.modifiers;if(!(t.size>0)||t.has("Shift")){var r=e.data.key;if(r in this._keysToZoomAction){var i=this._keysToZoomAction[r],o=this.view.mapViewNavigation,a=null;switch(i){case 0:a=o.zoomIn();break;case 1:a=o.zoomOut();break;default:return void n.neverReached(i)}o.begin(),a.then((function(){return o.end()})),e.stopPropagation()}}},t}(i.InputHandler);t.KeyZoom=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.view=t,n._canZoom=!0,n.registerIncoming("mouse-wheel",r,(function(e){return n._handleMouseWheel(e)})),n}return r.__extends(t,e),t.prototype._handleMouseWheel=function(e){var t=this;if(this.view.navigation.mouseWheelZoomEnabled&&(e.preventDefault(),e.stopPropagation(),this._canZoom)){var r=this.view.mapViewNavigation,n=e.data,i=n.x,o=n.y,a=n.deltaY,s=1/Math.pow(.6,1/60*a),l=r.zoom(s,[i,o]);l&&(this._canZoom=!1,l.catch((function(){})).then((function(){t._canZoom=!0,r.end()})))}},t}(n.InputHandler);t.MouseWheelZoom=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(641),r(241)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,!0)||this;r.view=t,r.registerIncoming("drag",(function(e){return r._handleDrag(e)})),r.registerIncoming("pointer-down",(function(){return r.stopMomentumNavigation()}));var i=r.view.mapViewNavigation;return r.dragEventSeparator=new n.DragEventSeparator({start:function(e,t){i.pinch.begin(r.view,t.data),t.stopPropagation()},update:function(e,t){i.pinch.update(r.view,t.data),t.stopPropagation()},end:function(e,t){i.pinch.end(r.view),t.stopPropagation()},condition:function(e){return e>=2}}),r}return r.__extends(t,e),t.prototype._handleDrag=function(e){this.dragEventSeparator.handle(e)},t.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()},t}(i.InputHandler);t.PinchRotateAndZoom=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(231),r(911),r(1573)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var r=this;this.element=e,this.input=t,this._hasEventListeners=!1,this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null,this.supported="getGamepads"in window.navigator,this.supported&&(this.forEachGamepad((function(e){return r.connectGamepad(e)})),window.addEventListener("gamepadconnected",(function(e){return r.connectGamepad(e.gamepad)})),window.addEventListener("gamepaddisconnected",(function(e){return r.disconnectGamepad(e.gamepad)})),this.ensurePollingState())}return e.prototype.destroy=function(){var e=this;this.ensurePollingState(),this.supported&&(window.removeEventListener("gamepadconnected",(function(t){return e.connectGamepad(t.gamepad)})),window.removeEventListener("gamepaddisconnected",(function(t){return e.disconnectGamepad(t.gamepad)})))},Object.defineProperty(e.prototype,"hasEventListeners",{set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventsEnabled",{get:function(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onEvent",{set:function(e){this.callback=e},enumerable:!0,configurable:!0}),e.prototype.connectGamepad=function(e){var t=new n(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()},e.prototype.disconnectGamepad=function(e){var t=e.index,r=this.inputDevices[t];r&&(this.emitGamepadEvent(e,i.extractState(r),!1),this.inputDevices.splice(t,1),this.latestUpdate.splice(t,1),this.input.gamepad.devices.remove(r),this.ensurePollingState())},e.prototype.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()},e.prototype.startPolling=function(){var e=this;null==this.frameTask&&(this.frameTask=r.addFrameTask({update:function(){return e.readGamepadState()}}))},e.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)},e.prototype.readGamepadState=function(){var e=this,t=document.hasFocus(),r=this.element.contains(document.activeElement),n="document"===this.input.gamepad.enabledFocusMode&&!t||"view"===this.input.gamepad.enabledFocusMode&&!r;this.forEachGamepad((function(t){var r=e.inputDevices[t.index];if(r){var o=e.latestUpdate[t.index],a=i.extractState(r),s=n||i.stateIdle(a);if(o){if(o.timestamp===t.timestamp)return;if(!o.active&&s)return;if(i.stateEqual(o.state,a))return}e.emitGamepadEvent(t,a,!s)}}))},e.prototype.forEachGamepad=function(e){for(var t=window.navigator.getGamepads(),r=0;r<t.length;r++){var n=t[r];this.validate(n)&&e(n)}},e.prototype.emitGamepadEvent=function(e,t,r){var n=this.latestUpdate[e.index],i=n&&n.active;if(i||r){var o=!i&&r?"start":i&&r?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:r},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:o})}},e.prototype.validate=function(e){if(!e)return!1;if(!e.connected)return!1;for(var t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0},e}();t.GamepadSource=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.extractState=function(e){var t=e.native;return t?{buttons:t.buttons.map((function(e){return e.pressed?e.value?e.value:1:0})),axes:t.axes.map((function(t){return function(e,t){var n=Math.abs(e);return n<t?0:r.sign(e)*(n-t)/(1-t)}(t,e.axisThreshold)}))}:{buttons:[],axes:[]}},t.stateEqual=function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(var r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0},t.stateIdle=function(e){for(var t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(618),r(210),r(171),r(641),r(241),r(793),r(642)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r,i,s,c){void 0===t&&(t=l.DefaultParameters.maximumDoubleClickDelay),void 0===r&&(r=l.DefaultParameters.maximumDoubleClickDistance),void 0===i&&(i=l.DefaultParameters.maximumDoubleTouchDelay),void 0===s&&(s=l.DefaultParameters.maximumDoubleTouchDistance),void 0===c&&(c=n.default);var u=e.call(this,!1)||this;return u.maximumDoubleClickDelay=t,u.maximumDoubleClickDistance=r,u.maximumDoubleTouchDelay=i,u.maximumDoubleTouchDistance=s,u._clock=c,u._doubleTapDragReady=!1,u._doubleTapDragActive=!1,u._dragStartCenter=o.createScreenPoint(0,0),u._pointerState=new Map,u._doubleTapDrag=u.registerOutgoing("double-tap-drag"),u._dragEventSeparator=new a.DragEventSeparator({start:function(e,t){return u._dragStart(e,t)},update:function(e,t){return u._dragUpdate(t)},end:function(e,t){return u._dragEnd(t)}}),u.registerIncoming("drag",(function(e){return u._dragEventSeparator.handle(e)})),u.registerIncoming("pointer-down",(function(e){return u._handlePointerDown(e)})),u.registerIncoming("pointer-up",(function(){return u._handlePointerUp()})),u}return r.__extends(t,e),t.prototype.onUninstall=function(){this._pointerState.forEach((function(e){null!=e.doubleTapTimeout&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null)}))},Object.defineProperty(t.prototype,"hasPendingInputs",{get:function(){return i.someMap(this._pointerState,(function(e){return null!=e.doubleTapTimeout}))},enumerable:!0,configurable:!0}),t.prototype._clearPointerDown=function(e){var t=this._pointerState.get(e);t&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs())},t.prototype._createDoubleTapDragData=function(e,t,r){return{action:e,delta:t,button:r.button,buttons:r.buttons,pointer:r.pointer,pointers:r.pointers,pointerType:r.pointerType,timestamp:r.timestamp}},t.prototype._dragStart=function(e,t){if(this._doubleTapDragReady&&1===e){this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;var r=t.data,n=t.modifiers,i=r.center;this._dragStartCenter=i;var a=this._createDoubleTapDragData("begin",o.createScreenPoint(0,0),r);this._doubleTapDrag.emit(a,void 0,n),t.stopPropagation()}},t.prototype._dragUpdate=function(e){if(this._doubleTapDragActive){var t=e.data,r=e.modifiers,n=t.center,i=o.createScreenPoint(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("update",i,t);this._doubleTapDrag.emit(a,void 0,r),e.stopPropagation()}},t.prototype._dragEnd=function(e){if(this._doubleTapDragActive){var t=e.data,r=e.modifiers,n=t.center,i=o.createScreenPoint(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("end",i,t);this._doubleTapDrag.emit(a,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}},t.prototype._handlePointerDown=function(e){var t=e.data,r=this._pointerId(t),n=this._pointerState.get(r),i=t.native.pointerType;if(n){var o="touch"===i?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(r),c.manhattanDistance(n.event.data,t)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)},t.prototype._handlePointerUp=function(){this._doubleTapDragReady=!1},t.prototype._pointerId=function(e){var t=e.native,r=t.pointerId,n=t.button,i=t.pointerType;return"mouse"===i?r+":"+n:""+i},t.prototype._storePointerDown=function(e){var t=this,r=e.data,n=r.native.pointerType,i=this._pointerId(r),o="touch"===n?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,a=this._clock.setTimeout((function(){return t._clearPointerDown(i)}),o);this._pointerState.set(i,{event:e,doubleTapTimeout:a}),this.refreshHasPendingInputs()},t}(s.InputHandler);t.DoubleTapDrag=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(158),r(151)],void 0===(i=function(e,t,r,n,i,o){var a=0;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=new n([0,255,255]),t.haloOpacity=1,t.fillOpacity=.25,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return a++},enumerable:!0,configurable:!0}),r.__decorate([o.property({readOnly:!0,dependsOn:["color","haloColor","haloOpacity","fillOpacity"]})],t.prototype,"version",null),r.__decorate([o.property({type:n})],t.prototype,"color",void 0),r.__decorate([o.property({type:n})],t.prototype,"haloColor",void 0),r.__decorate([o.property()],t.prototype,"haloOpacity",void 0),r.__decorate([o.property()],t.prototype,"fillOpacity",void 0),r.__decorate([o.subclass("esri.views.2d.support.HighlightOptions")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(1160)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.components=["attribution","zoom"],r}return r.__extends(t,e),r.__decorate([n.property()],t.prototype,"components",void 0),r.__decorate([n.subclass("esri.views.ui.2d.DefaultUI2D")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(620),r(190),r(167),r(157),r(151),r(1161),r(576)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u={left:0,top:0,bottom:0,right:0},p={bottom:30,top:15,right:15,left:15},d="esri-ui",h="esri-ui-corner",f="esri-ui-inner-container";function v(e){return"object"!=typeof e||e instanceof l||"declaredClass"in e||!("component"in e||"index"in e||"position"in e)?null:e}function m(e,t){var r=t.top,n=t.bottom,i=t.left,o=t.right;e.style.top=r,e.style.bottom=n,e.style.left=i,e.style.right=o}return function(e){function t(t){var r=e.call(this,t)||this;return r._cornerNameToContainerLookup={},r._positionNameToContainerLookup={},r._components=new Array,r._componentToKey=new Map,r._handles=new o,r.view=null,r._initContainers(),r}return r.__extends(t,e),t.prototype.initialize=function(){this._handles.add([a.init(this,"view.padding, container",this._applyViewPadding.bind(this)),a.init(this,"padding",this._applyUIPadding.bind(this))])},t.prototype.destroy=function(){this.container=null;for(var e=0,t=this._components;e<t.length;e++)t[e].destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()},Object.defineProperty(t.prototype,"container",{set:function(e){var t=this._get("container");e!==t&&(e&&(e.classList.add(d),this._attachContainers(e)),t&&(t.classList.remove(d),m(t,{top:"",bottom:"",left:"",right:""}),n.empty(t)),this._set("container",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var e=this.get("view.height")||0;if(0===e)return e;var t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._get("padding")},set:function(e){e?this._override("padding",e):this._clearOverride("padding")},enumerable:!0,configurable:!0}),t.prototype.castPadding=function(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:r.__assign(r.__assign({},p),e)},Object.defineProperty(t.prototype,"width",{get:function(){var e=this.get("view.width")||0;if(0===e)return e;var t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t){var r,n,i=this;if(Array.isArray(e))e.forEach((function(e){return i.add(e,t)}));else{var o=v(e);o&&(r=o.index,t=o.position,e=o.component,n=o.key),t&&"object"==typeof t&&(r=t.index,n=t.key,t=t.position),!e||t&&!this._isValidPosition(t)||(e instanceof l||(e=new l({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),n&&this._componentToKey.set(e,n))}},t.prototype.remove=function(e,t){var r=this;if(e){if(Array.isArray(e))return e.map((function(e){return r.remove(e,t)}));var n=this._find(e);if(n){var i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;var o=this._components.indexOf(n);return n.node.parentNode&&n.node.parentNode.removeChild(n.node),this._componentToKey.delete(e),this._components.splice(o,1)[0]}}},t.prototype.empty=function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.empty(e)})).reduce((function(e,t){return e.concat(t)})):"manual"===(e=e||"manual")?Array.prototype.slice.call(this._manualContainer.children).filter((function(e){return!e.classList.contains(h)})).map((function(e){return t.remove(e)})):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null},t.prototype.move=function(e,t){var r=this;if(Array.isArray(e)&&e.forEach((function(e){return r.move(e,t)})),e){var n,i=v(e)||v(t);if(i&&(n=i.index,t=i.position,e=i.component||e),!t||this._isValidPosition(t)){var o=this.remove(e);o&&this.add(o,{position:t,index:n})}}},t.prototype.find=function(e){if(!e)return null;var t=this._findById(e);return t&&(t.widget||t.node)},t.prototype._find=function(e){return e?e instanceof l?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null},t.prototype._getViewPadding=function(){return this.get("view.padding")||u},t.prototype._attachContainers=function(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)},t.prototype._initContainers=function(){var e=document.createElement("div");e.classList.add(f),e.classList.add("esri-ui-corner-container");var t=document.createElement("div");t.classList.add(f),t.classList.add("esri-ui-manual-container");var n=document.createElement("div");n.classList.add("esri-ui-top-left"),n.classList.add(h),e.appendChild(n);var i=document.createElement("div");i.classList.add("esri-ui-top-right"),i.classList.add(h),e.appendChild(i);var o=document.createElement("div");o.classList.add("esri-ui-bottom-left"),o.classList.add(h),e.appendChild(o);var a=document.createElement("div");a.classList.add("esri-ui-bottom-right"),a.classList.add(h),e.appendChild(a),this._innerContainer=e,this._manualContainer=t;var s=c.isRTL();this._cornerNameToContainerLookup={"top-left":n,"top-right":i,"bottom-left":o,"bottom-right":a,"top-leading":s?i:n,"top-trailing":s?n:i,"bottom-leading":s?a:o,"bottom-trailing":s?o:a},this._positionNameToContainerLookup=r.__assign({manual:t},this._cornerNameToContainerLookup)},t.prototype._isValidPosition=function(e){return!!this._positionNameToContainerLookup[e]},t.prototype._place=function(e){var t,r,i=e.component,o=e.position||"manual",a=e.index,s=this._positionNameToContainerLookup[o],l=a>-1;(r=i.widget)&&!r._started&&"function"==typeof r.postMixInProperties&&"function"==typeof r.buildRendering&&"function"==typeof r.postCreate&&"function"==typeof r.startup&&i.widget.startup(),l?(t=Array.prototype.slice.call(s.children),0===a?s.firstChild?n.insertBefore(i.node,s.firstChild):s.appendChild(i.node):a>=t.length?s.appendChild(i.node):n.insertBefore(i.node,t[a])):s.appendChild(i.node)},t.prototype._applyViewPadding=function(){var e=this.container;e&&m(e,this._toPxPosition(this._getViewPadding()))},t.prototype._applyUIPadding=function(){var e=this._innerContainer;e&&m(e,this._toPxPosition(this.padding))},t.prototype._toPxPosition=function(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}},t.prototype._toPxUnit=function(e){return 0===e?"0":e+"px"},t.prototype._findByComponent=function(e){var t,r=null;return this._components.some((function(n){return(t=n===e)&&(r=n),t})),r},t.prototype._findById=function(e){var t,r=null;return this._components.some((function(n){return(t=n.id===e)&&(r=n),t})),r},t.prototype._findByNode=function(e){var t,r=null;return this._components.some((function(n){return(t=n.node===e)&&(r=n),t})),r},r.__decorate([s.property()],t.prototype,"container",null),r.__decorate([s.property({dependsOn:["view.height"]})],t.prototype,"height",null),r.__decorate([s.property({value:p})],t.prototype,"padding",null),r.__decorate([s.cast("padding")],t.prototype,"castPadding",null),r.__decorate([s.property()],t.prototype,"view",void 0),r.__decorate([s.property({dependsOn:["view.width"]})],t.prototype,"width",null),r.__decorate([s.subclass("esri.views.ui.UI")],t)}(i.EventedAccessor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(157),r(151),r(188),r(1579),r(183)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._isOpen=!1,n._attributionTextOverflowed=!1,n._prevSourceNodeHeight=0,n.iconClass="esri-icon-description",n.itemDelimiter=" | ",n.label=void 0,n.messages=null,n.view=null,n.viewModel=new a,n}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own(n.on(this,"viewModel.items","change",(function(){return e.scheduleRender()})))},Object.defineProperty(t.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce((function(e,t){return-1===e.indexOf(t.text)&&e.push(t.text),e}),[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=((e={})["esri-attribution--open"]=this._isOpen,e);return s.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",t),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())},t.prototype.renderPoweredBy=function(){return s.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",s.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))},t.prototype.renderSourcesNode=function(){var e,t=this._isOpen,r=this._isInteractive(),n=r?0:-1,i=this.attributionText,o=r?"button":void 0,a=((e={})["esri-attribution__sources--open"]=t,e["esri-interactive"]=r,e);return s.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",a),innerHTML:i,role:o,tabIndex:n})},t.prototype._afterSourcesNodeCreate=function(e){this._prevSourceNodeHeight=e.clientWidth},t.prototype._afterSourcesNodeUpdate=function(e){var t=!1,r=e.clientHeight,n=e.clientWidth,i=e.scrollWidth>=n,o=this._attributionTextOverflowed!==i;if(this._attributionTextOverflowed=i,o&&(t=!0),this._isOpen){var a=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()},t.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)},t.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed},r.__decorate([i.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),s.renderable()],t.prototype,"attributionText",null),r.__decorate([i.property()],t.prototype,"iconClass",void 0),r.__decorate([i.property(),s.renderable()],t.prototype,"itemDelimiter",void 0),r.__decorate([i.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([i.property(),s.renderable(),s.messageBundle("esri/widgets/Attribution/t9n/Attribution")],t.prototype,"messages",void 0),r.__decorate([i.aliasOf("viewModel.view")],t.prototype,"view",void 0),r.__decorate([i.property({type:a}),s.renderable(["state","view.size"])],t.prototype,"viewModel",void 0),r.__decorate([s.accessibleHandler()],t.prototype,"_toggleState",null),r.__decorate([i.subclass("esri.widgets.Attribution")],t)}(o)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(180),r(226),r(169),r(236),r(157),r(151),r(407),r(197)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){function d(e,t,r){r&&t&&(i.find(e,(function(e){return e.layerView===t&&e.text===r}))||e.push({text:r,layerView:t}))}var h=[];return function(e){function t(t){var r=e.call(this,t)||this;return r.clear=function(){r._fetchedAttributionData.clear(),r._pendingAttributions.clear(),r.handles.remove("suspension"),r.notifyChange("state")},r._pendingAttributions=new Set,r._fetchedAttributionData=new Map,r.items=new a,r.view=null,r._allLayerViewsChange=function(e){r.handles.remove("suspension");var t=r.get("view.allLayerViews");t&&r.handles.add(t.map((function(e){return e.watch(["suspended","attributionVisible"],r._updateAttributionItems)})),"suspension"),e&&e.removed&&e.removed.forEach((function(e){r._pendingAttributions.delete(e),r._fetchedAttributionData.delete(e)})),r._updateAttributionItems()},r._updateAttributionItems=function(){var e,t,n=r.get("view.allLayerViews");h.length=0,n?(n.forEach((function(e){if(!e.suspended&&e.get("layer.attributionVisible")){var t=e.layer;if(function(e){return e&&"copyright"in e&&"function"==typeof e.originOf&&"user"===e.originOf("copyright")}(t))d(h,e,t.copyright);else if(t.hasAttributionData){if(r._fetchedAttributionData.has(e)){var n=r._fetchedAttributionData.get(e);return void(n&&d(h,e,r._getDynamicAttribution(n,r.view,t)))}r._fetchAttributionData(e)}else{var i=t.get("portalItem.accessInformation");d(h,e,i||t.copyright)}}})),e=r.items,t=h,(e.length!==t.length||e.some((function(e,r){return e.text!==t[r].text})))&&(r.items.removeAll(),r.items.addMany(h)),r.notifyChange("state")):r.clear()},r.handles.add([l.on(r,"view.allLayerViews","change",r._allLayerViewsChange,r._allLayerViewsChange,r.clear),l.whenTrue(r,"view.stationary",(function(){return r._updateAttributionItems()}))]),r}return r.__extends(t,e),t.prototype.destroy=function(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear()},Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"},enumerable:!0,configurable:!0}),t.prototype._fetchAttributionData=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return this._pendingAttributions.has(e)?[2]:(this._pendingAttributions.add(e),[4,o.result(e.layer.fetchAttributionData())]);case 1:return t=r.sent(),this._pendingAttributions.has(e)&&(n=t.ok?this._createContributionIndex(t.value,"bing-maps"===e.layer.type):null,this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,n)),this._updateAttributionItems(),[2]}}))}))},t.prototype._createContributionIndex=function(e,t){var r=e.contributors,i={};if(!r)return i;for(var o=0;o<r.length;o++){var a=r[o],s=a.coverageAreas;if(!s)return;for(var l=0,c=s;l<c.length;l++)for(var u=c[l],d=u.bbox,h=u.zoomMin-(t&&u.zoomMin?1:0),f=u.zoomMax-(t&&u.zoomMax?1:0),v={xmin:d[1],ymin:d[0],xmax:d[3],ymax:d[2],spatialReference:n.SpatialReference.WGS84},m={extent:p.geographicToWebMercator(v),attribution:a.attribution||"",score:null!=u.score?u.score:100,id:o},y=h;y<=f;y++)i[y]=i[y]||[],i[y].push(m)}return i.maxKey=Math.max.apply(null,Object.keys(i)),i},t.prototype._getDynamicAttribution=function(e,t,r){var n=t.extent,i=t.scale,o=r.tileInfo.scaleToZoom(i);if(o=Math.min(e.maxKey,Math.round(o)),!n||null==o||o<=-1)return"";var a=e[o],s=p.project(n.center.clone().normalize(),t.spatialReference),l={};return a?a.filter((function(e){var t=!l[e.id]&&s&&u.extentContainsPoint(e.extent,s);return t&&(l[e.id]=!0),t})).sort((function(e,t){return t.score-e.score||e.objectId-t.objectId})).map((function(e){return e.attribution})).join(", "):""},r.__decorate([c.property({readOnly:!0,type:a})],t.prototype,"items",void 0),r.__decorate([c.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null),r.__decorate([c.property()],t.prototype,"view",void 0),r.__decorate([c.subclass("esri.widgets.Attribution.AttributionViewModel")],t)}(s.HandleOwner)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(188),r(1581),r(183)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.goToOverride=null,n.iconClass="esri-icon-locate-circled",n.label=void 0,n.messages=null,n.view=null,n.viewModel=new o,n}return r.__extends(t,e),t.prototype.reset=function(){},t.prototype.render=function(){var e,t,r=this.viewModel,n=r.orientation,i=r.state,o="disabled"===i,s="compass"==("rotation"===i?"rotation":"compass"),l=o?-1:0,c=((e={})["esri-disabled"]=o,e["esri-interactive"]=!o,e),u=((t={})["esri-icon-compass"]=s,t["esri-icon-dial"]=!s,t),p=this.messages;return a.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",c),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:l,"aria-label":p.reset,title:p.reset},a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",u),styles:this._toRotationTransform(n)}),a.tsx("span",{class:"esri-icon-font-fallback-text"},p.reset))},t.prototype._reset=function(){this.viewModel.reset()},t.prototype._toRotationTransform=function(e){return{transform:"rotateZ("+e.z+"deg)"}},r.__decorate([n.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0),r.__decorate([n.property()],t.prototype,"iconClass",void 0),r.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([n.property(),a.renderable(),a.messageBundle("esri/widgets/Compass/t9n/Compass")],t.prototype,"messages",void 0),r.__decorate([n.aliasOf("viewModel.view")],t.prototype,"view",void 0),r.__decorate([n.property({type:o}),a.renderable(["viewModel.orientation","viewModel.state"])],t.prototype,"viewModel",void 0),r.__decorate([n.aliasOf("viewModel.reset")],t.prototype,"reset",null),r.__decorate([a.accessibleHandler()],t.prototype,"_reset",null),r.__decorate([n.subclass("esri.widgets.Compass")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(791)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new i,r.orientation={x:0,y:0,z:0},r.view=null,r._updateForCamera=r._updateForCamera.bind(r),r._updateForRotation=r._updateForRotation.bind(r),r._updateRotationWatcher=r._updateRotationWatcher.bind(r),r.view,r}return r.__extends(t,e),t.prototype.initialize=function(){this._handles.add(o.init(this,"view",this._updateRotationWatcher))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.view=null},Object.defineProperty(t.prototype,"canShowNorth",{get:function(){var e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0}),t.prototype.reset=function(){if(this.get("view.ready")){var e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}},t.prototype._updateForRotation=function(e){null!=e&&(this.orientation={z:e})},t.prototype._updateForCamera=function(e){if(e){var t=-e.heading;this.orientation={x:0,y:0,z:t}}},t.prototype._updateRotationWatcher=function(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add(o.init(this,"view.rotation",this._updateForRotation)):this._handles.add(o.init(this,"view.camera",this._updateForCamera)))},r.__decorate([a.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],t.prototype,"canShowNorth",null),r.__decorate([a.property()],t.prototype,"orientation",void 0),r.__decorate([a.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],t.prototype,"state",null),r.__decorate([a.property()],t.prototype,"view",void 0),r.__decorate([a.property()],t.prototype,"reset",null),r.__decorate([a.subclass("esri.widgets.CompassViewModel")],t)}(s.GoToMixin(n))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(188),r(1583),r(183)],void 0===(i=function(e,t,r,n,i,o,a){var s="esri-navigation-toggle__button esri-widget--button",l="esri-navigation-toggle__button--active";return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.iconClass="esri-icon-pan2",n.label=void 0,n.messages=null,n.view=null,n.viewModel=new o,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"layout",{set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)},enumerable:!0,configurable:!0}),t.prototype.toggle=function(){},t.prototype.render=function(){var e,t,r,n="disabled"===this.get("viewModel.state"),i="pan"===this.get("viewModel.navigationMode"),o=((e={})["esri-disabled"]=n,e["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,e),c=((t={})[l]=i,t),u=((r={})[l]=!i,r),p=n?-1:0,d=this.messages.toggle;return a.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",o),onclick:this._toggle,onkeydown:this._toggle,tabIndex:p,"aria-label":d,title:d},a.tsx("div",{class:this.classes(s,"esri-navigation-toggle__button--pan",c)},a.tsx("span",{class:"esri-icon-pan"})),a.tsx("div",{class:this.classes(s,"esri-navigation-toggle__button--rotate",u)},a.tsx("span",{class:"esri-icon-rotate"})))},t.prototype._toggle=function(){this.toggle()},r.__decorate([n.property()],t.prototype,"iconClass",void 0),r.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([n.property({value:"vertical"}),a.renderable()],t.prototype,"layout",null),r.__decorate([n.property(),a.renderable(),a.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],t.prototype,"messages",void 0),r.__decorate([n.aliasOf("viewModel.view"),a.renderable()],t.prototype,"view",void 0),r.__decorate([n.property({type:o}),a.renderable(["viewModel.state","viewModel.navigationMode"])],t.prototype,"viewModel",void 0),r.__decorate([n.aliasOf("viewModel.toggle")],t.prototype,"toggle",null),r.__decorate([a.accessibleHandler()],t.prototype,"_toggle",null),r.__decorate([n.subclass("esri.widgets.NavigationToggle")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new i,r.navigationMode="pan",r.view=null,r.toggle=r.toggle.bind(r),r}return r.__extends(t,e),t.prototype.initialize=function(){this._handles.add(o.when(this,"view.inputManager",this._setNavigationMode.bind(this)))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.view=null},Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0}),t.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())},t.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"},r.__decorate([a.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null),r.__decorate([a.property()],t.prototype,"navigationMode",void 0),r.__decorate([a.property()],t.prototype,"view",void 0),r.__decorate([a.property()],t.prototype,"toggle",null),r.__decorate([a.subclass("esri.widgets.NavigationToggleViewModel")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(188),r(183),r(1585),r(1586)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.iconClass="esri-icon-zoom-in-magnifying-glass",n.label=void 0,n.messages=null,n.view=null,n.viewModel=new s,n}return r.__extends(t,e),t.prototype.initialize=function(){this._zoomInButton=new a({action:this.zoomIn,iconClass:"esri-icon-plus"}),this._zoomOutButton=new a({action:this.zoomOut,iconClass:"esri-icon-minus"})},t.prototype.destroy=function(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null},Object.defineProperty(t.prototype,"layout",{set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=this.viewModel,r=((e={})["esri-zoom--horizontal"]="horizontal"===this.layout,e);return this._zoomInButton.enabled="ready"===t.state&&t.canZoomIn,this._zoomOutButton.enabled="ready"===t.state&&t.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,o.tsx("div",{class:this.classes("esri-zoom esri-widget",r)},this._zoomInButton.render(),this._zoomOutButton.render())},t.prototype.zoomIn=function(){},t.prototype.zoomOut=function(){},r.__decorate([n.property()],t.prototype,"iconClass",void 0),r.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([n.property({value:"vertical"}),o.renderable()],t.prototype,"layout",null),r.__decorate([n.property(),o.renderable(),o.messageBundle("esri/widgets/Zoom/t9n/Zoom")],t.prototype,"messages",void 0),r.__decorate([n.aliasOf("viewModel.view"),o.renderable()],t.prototype,"view",void 0),r.__decorate([n.property({type:s}),o.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],t.prototype,"viewModel",void 0),r.__decorate([n.aliasOf("viewModel.zoomIn")],t.prototype,"zoomIn",null),r.__decorate([n.aliasOf("viewModel.zoomOut")],t.prototype,"zoomOut",null),r.__decorate([n.subclass("esri.widgets.Zoom")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(188),r(183)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.enabled=!0,t.iconClass="",t.title="",t}return r.__extends(t,e),t.prototype.render=function(){var e,t,r=this.enabled?0:-1,n=((e={})["esri-disabled"]=!this.enabled,e["esri-interactive"]=this.enabled,e),i=((t={})[this.iconClass]=!!this.iconClass,t);return o.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",n),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:r,title:this.title},o.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",i)}),o.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))},t.prototype._triggerAction=function(){this.action.call(this)},r.__decorate([n.property()],t.prototype,"action",void 0),r.__decorate([n.property(),o.renderable()],t.prototype,"enabled",void 0),r.__decorate([n.property(),o.renderable()],t.prototype,"iconClass",void 0),r.__decorate([n.property(),o.renderable()],t.prototype,"title",void 0),r.__decorate([o.accessibleHandler()],t.prototype,"_triggerAction",null),r.__decorate([n.subclass("esri.widgets.IconButton")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(153),r(151),r(1587),r(1588)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.canZoomIn=!1,r.canZoomOut=!1,r.zoomIn=r.zoomIn.bind(r),r.zoomOut=r.zoomOut.bind(r),r}return r.__extends(t,e),t.prototype.destroy=function(){this.view=null},Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{set:function(e){e?"2d"===e.type?this._zoomConditions=new a({view:e}):"3d"===e.type&&(this._zoomConditions=new s({view:e})):this._zoomConditions=null,this._set("view",e)},enumerable:!0,configurable:!0}),t.prototype.zoomIn=function(){if(this.canZoomIn){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():i.ignoreAbortErrors(e.goTo({zoomFactor:2}))}},t.prototype.zoomOut=function(){if(this.canZoomOut){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():i.ignoreAbortErrors(e.goTo({zoomFactor:.5}))}},r.__decorate([o.property()],t.prototype,"_zoomConditions",void 0),r.__decorate([o.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],t.prototype,"canZoomIn",void 0),r.__decorate([o.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],t.prototype,"canZoomOut",void 0),r.__decorate([o.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null),r.__decorate([o.property()],t.prototype,"view",null),r.__decorate([o.property()],t.prototype,"zoomIn",null),r.__decorate([o.property()],t.prototype,"zoomOut",null),r.__decorate([o.subclass("esri.widgets.Zoom.ZoomViewModel")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t},enumerable:!0,configurable:!0}),r.__decorate([i.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],t.prototype,"canZoomIn",null),r.__decorate([i.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],t.prototype,"canZoomOut",null),r.__decorate([i.property()],t.prototype,"view",void 0),r.__decorate([i.subclass("esri.widgets.Zoom.ZoomConditions2D")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canZoomOut",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0}),r.__decorate([i.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"canZoomIn",null),r.__decorate([i.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"canZoomOut",null),r.__decorate([i.property()],t.prototype,"view",void 0),r.__decorate([i.subclass("esri.widgets.Zoom.ZoomConditions3D")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(155),r(118),r(151)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.color=new n([0,0,0,1]),r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i(o.clone({color:this.color}))},r.__decorate([a.property({type:n,json:{write:!0}})],t.prototype,"color",void 0),i=r.__decorate([a.subclass("esri.webmap.background.ColorBackground")],t)}(i.JSONSupport)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(167),r(157),r(151),r(1591)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new o,r.view=null,r.layerViews=new i,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(a.when(this,"view.map.ground",(function(e){return e.load()}))),this.handles.add(this.layerViews.on("after-changes",(function(){return e.layerViewsAfterChangesHandler()})))},t.prototype.destroy=function(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)},Object.defineProperty(t.prototype,"elevationSampler",{get:function(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new l({view:this.view}):null:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.layerViews.some((function(e){return e.updating}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0}),t.prototype.layerViewsAfterChangesHandler=function(){var e=this;this.handles.remove("updating"),this.handles.add(this.layerViews.map((function(t){return t.watch("updating",(function(){return e.updateUpdating()}),!0)})).toArray(),"updating"),this.updateUpdating()},t.prototype.updateUpdating=function(){this.notifyChange("updating")},r.__decorate([s.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],t.prototype,"elevationSampler",null),r.__decorate([s.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),r.__decorate([s.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([s.property({type:i,readOnly:!0})],t.prototype,"layerViews",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["view.suspended"]})],t.prototype,"suspended",null),r.__decorate([s.subclass("esri.views.GroundView")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(156),r(151),r(173),r(407),r(197),r(1162),r(644),r(415)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=i.getLogger("esri.views.support.GroundViewElevationSampler");return function(e){function t(t){var r=e.call(this,t)||this;return r.demResolution={min:-1,max:-1},r.noDataValue=p.ELEVATION_NODATA_VALUE,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.view.basemapTerrain.on("elevation-change",(function(){return e.emit("changed",{})}))},Object.defineProperty(t.prototype,"extent",{get:function(){var e=this.view.basemapTerrain;return e.extent&&e.spatialReference?a.toExtent(e.extent,e.spatialReference):null},enumerable:!0,configurable:!0}),t.prototype.elevationAt=function(e){var t=e.spatialReference,r=this.spatialReference;if(!l.canProject(t,r)){var n=t?t.wkid:"unknown";return d.error("Cannot sample elevation at a location with spatial reference ("+n+") different from the view ("+r.wkid+")"),null}if(!s.extentContainsPoint(this.extent,e)){var i=this.extent,o=i.xmin+", "+i.ymin+", "+i.xmax+", "+i.ymax;d.warn("#elevationAt()","Point used to sample elevation ("+e.x+", "+e.y+") is outside of the sampler extent ("+o+")")}return u.getElevationAtPoint(this.view.elevationProvider,e)},t.prototype.queryElevation=function(e){return c.updateGeometryElevation(e.clone(),this)},r.__decorate([o.property({readOnly:!0})],t.prototype,"demResolution",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],t.prototype,"extent",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"noDataValue",void 0),r.__decorate([o.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],t.prototype,"spatialReference",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.views.support.GroundViewElevationSampler")],t)}(n.EventedAccessor)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(639),r(412)],void 0===(i=function(e,t,r,n){function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],p=t[8],d=t[9],h=t[10],f=t[11],v=t[12],m=t[13],y=t[14],g=t[15],_=r[0],b=r[1],x=r[2],w=r[3];return e[0]=_*n+b*s+x*p+w*v,e[1]=_*i+b*l+x*d+w*m,e[2]=_*o+b*c+x*h+w*y,e[3]=_*a+b*u+x*f+w*g,_=r[4],b=r[5],x=r[6],w=r[7],e[4]=_*n+b*s+x*p+w*v,e[5]=_*i+b*l+x*d+w*m,e[6]=_*o+b*c+x*h+w*y,e[7]=_*a+b*u+x*f+w*g,_=r[8],b=r[9],x=r[10],w=r[11],e[8]=_*n+b*s+x*p+w*v,e[9]=_*i+b*l+x*d+w*m,e[10]=_*o+b*c+x*h+w*y,e[11]=_*a+b*u+x*f+w*g,_=r[12],b=r[13],x=r[14],w=r[15],e[12]=_*n+b*s+x*p+w*v,e[13]=_*i+b*l+x*d+w*m,e[14]=_*o+b*c+x*h+w*y,e[15]=_*a+b*u+x*f+w*g,e}function a(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=n+n,l=i+i,c=o+o,u=n*s,p=n*l,d=n*c,h=i*l,f=i*c,v=o*c,m=a*s,y=a*l,g=a*c;return e[0]=1-(h+v),e[1]=p+g,e[2]=d-y,e[3]=0,e[4]=p-g,e[5]=1-(u+v),e[6]=f+m,e[7]=0,e[8]=d+y,e[9]=f-m,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.set=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=p,e[11]=d,e[12]=h,e[13]=f,e[14]=v,e[15]=m,e},t.identity=i,t.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],h=t[11],f=t[12],v=t[13],m=t[14],y=t[15],g=r*s-n*a,_=r*l-i*a,b=r*c-o*a,x=n*l-i*s,w=n*c-o*s,S=i*c-o*l,P=u*v-p*f,T=u*m-d*f,O=u*y-h*f,C=p*m-d*v,M=p*y-h*v,A=d*y-h*m,E=g*A-_*M+b*C+x*O-w*T+S*P;return E?(E=1/E,e[0]=(s*A-l*M+c*C)*E,e[1]=(i*M-n*A-o*C)*E,e[2]=(v*S-m*w+y*x)*E,e[3]=(d*w-p*S-h*x)*E,e[4]=(l*O-a*A-c*T)*E,e[5]=(r*A-i*O+o*T)*E,e[6]=(m*b-f*S-y*_)*E,e[7]=(u*S-d*b+h*_)*E,e[8]=(a*M-s*O+c*P)*E,e[9]=(n*O-r*M-o*P)*E,e[10]=(f*w-v*b+y*g)*E,e[11]=(p*b-u*w-h*g)*E,e[12]=(s*T-a*C-l*P)*E,e[13]=(r*C-n*T+i*P)*E,e[14]=(v*_-f*x-m*g)*E,e[15]=(u*x-p*_+d*g)*E,e):null},t.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],h=t[11],f=t[12],v=t[13],m=t[14],y=t[15];return e[0]=s*(d*y-h*m)-p*(l*y-c*m)+v*(l*h-c*d),e[1]=-(n*(d*y-h*m)-p*(i*y-o*m)+v*(i*h-o*d)),e[2]=n*(l*y-c*m)-s*(i*y-o*m)+v*(i*c-o*l),e[3]=-(n*(l*h-c*d)-s*(i*h-o*d)+p*(i*c-o*l)),e[4]=-(a*(d*y-h*m)-u*(l*y-c*m)+f*(l*h-c*d)),e[5]=r*(d*y-h*m)-u*(i*y-o*m)+f*(i*h-o*d),e[6]=-(r*(l*y-c*m)-a*(i*y-o*m)+f*(i*c-o*l)),e[7]=r*(l*h-c*d)-a*(i*h-o*d)+u*(i*c-o*l),e[8]=a*(p*y-h*v)-u*(s*y-c*v)+f*(s*h-c*p),e[9]=-(r*(p*y-h*v)-u*(n*y-o*v)+f*(n*h-o*p)),e[10]=r*(s*y-c*v)-a*(n*y-o*v)+f*(n*c-o*s),e[11]=-(r*(s*h-c*p)-a*(n*h-o*p)+u*(n*c-o*s)),e[12]=-(a*(p*m-d*v)-u*(s*m-l*v)+f*(s*d-l*p)),e[13]=r*(p*m-d*v)-u*(n*m-i*v)+f*(n*d-i*p),e[14]=-(r*(s*m-l*v)-a*(n*m-i*v)+f*(n*l-i*s)),e[15]=r*(s*d-l*p)-a*(n*d-i*p)+u*(n*l-i*s),e},t.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],p=e[10],d=e[11],h=e[12],f=e[13],v=e[14],m=e[15];return(t*a-r*o)*(p*m-d*v)-(t*s-n*o)*(u*m-d*f)+(t*l-i*o)*(u*v-p*f)+(r*s-n*a)*(c*m-d*h)-(r*l-i*a)*(c*v-p*h)+(n*l-i*s)*(c*f-u*h)},t.multiply=o,t.translate=function(e,t,r){var n=r[0],i=r[1],o=r[2],a=void 0,s=void 0,l=void 0,c=void 0,u=void 0,p=void 0,d=void 0,h=void 0,f=void 0,v=void 0,m=void 0,y=void 0;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],l=t[2],c=t[3],u=t[4],p=t[5],d=t[6],h=t[7],f=t[8],v=t[9],m=t[10],y=t[11],e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=u,e[5]=p,e[6]=d,e[7]=h,e[8]=f,e[9]=v,e[10]=m,e[11]=y,e[12]=a*n+u*i+f*o+t[12],e[13]=s*n+p*i+v*o+t[13],e[14]=l*n+d*i+m*o+t[14],e[15]=c*n+h*i+y*o+t[15]),e},t.scale=function(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,i){var o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A=i[0],E=i[1],I=i[2],R=Math.sqrt(A*A+E*E+I*I);return R<n.EPSILON?null:(A*=R=1/R,E*=R,I*=R,o=Math.sin(r),s=1-(a=Math.cos(r)),l=t[0],c=t[1],u=t[2],p=t[3],d=t[4],h=t[5],f=t[6],v=t[7],m=t[8],y=t[9],g=t[10],_=t[11],b=A*A*s+a,x=E*A*s+I*o,w=I*A*s-E*o,S=A*E*s-I*o,P=E*E*s+a,T=I*E*s+A*o,O=A*I*s+E*o,C=E*I*s-A*o,M=I*I*s+a,e[0]=l*b+d*x+m*w,e[1]=c*b+h*x+y*w,e[2]=u*b+f*x+g*w,e[3]=p*b+v*x+_*w,e[4]=l*S+d*P+m*T,e[5]=c*S+h*P+y*T,e[6]=u*S+f*P+g*T,e[7]=p*S+v*P+_*T,e[8]=l*O+d*C+m*M,e[9]=c*O+h*C+y*M,e[10]=u*O+f*C+g*M,e[11]=p*O+v*C+_*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],p=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=a*i+u*n,e[6]=s*i+p*n,e[7]=l*i+d*n,e[8]=c*i-o*n,e[9]=u*i-a*n,e[10]=p*i-s*n,e[11]=d*i-l*n,e},t.rotateY=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],p=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=a*i-u*n,e[2]=s*i-p*n,e[3]=l*i-d*n,e[8]=o*n+c*i,e[9]=a*n+u*i,e[10]=s*n+p*i,e[11]=l*n+d*i,e},t.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],p=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=a*i+u*n,e[2]=s*i+p*n,e[3]=l*i+d*n,e[4]=c*i-o*n,e[5]=u*i-a*n,e[6]=p*i-s*n,e[7]=d*i-l*n,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var i,o,a,s=r[0],l=r[1],c=r[2],u=Math.sqrt(s*s+l*l+c*c);return u<n.EPSILON?null:(s*=u=1/u,l*=u,c*=u,i=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=s*s*a+o,e[1]=l*s*a+c*i,e[2]=c*s*a-l*i,e[3]=0,e[4]=s*l*a-c*i,e[5]=l*l*a+o,e[6]=c*l*a+s*i,e[7]=0,e[8]=s*c*a+l*i,e[9]=l*c*a-s*i,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=a,t.fromQuat2=function(e,t){var r=s,n=-t[0],i=-t[1],o=-t[2],l=t[3],c=t[4],u=t[5],p=t[6],d=t[7],h=n*n+i*i+o*o+l*l;return h>0?(r[0]=2*(c*l+d*n+u*o-p*i)/h,r[1]=2*(u*l+d*i+p*n-c*o)/h,r[2]=2*(p*l+d*o+c*i-u*n)/h):(r[0]=2*(c*l+d*n+u*o-p*i),r[1]=2*(u*l+d*i+p*n-c*o),r[2]=2*(p*l+d*o+c*i-u*n)),a(e,t,r),e};var s=r.create();function l(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e},t.fromRotationTranslationScale=function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3],l=i+i,c=o+o,u=a+a,p=i*l,d=i*c,h=i*u,f=o*c,v=o*u,m=a*u,y=s*l,g=s*c,_=s*u,b=n[0],x=n[1],w=n[2];return e[0]=(1-(f+m))*b,e[1]=(d+_)*b,e[2]=(h-g)*b,e[3]=0,e[4]=(d-_)*x,e[5]=(1-(p+m))*x,e[6]=(v+y)*x,e[7]=0,e[8]=(h+g)*w,e[9]=(v-y)*w,e[10]=(1-(p+f))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){var o=t[0],a=t[1],s=t[2],l=t[3],c=o+o,u=a+a,p=s+s,d=o*c,h=o*u,f=o*p,v=a*u,m=a*p,y=s*p,g=l*c,_=l*u,b=l*p,x=n[0],w=n[1],S=n[2],P=i[0],T=i[1],O=i[2],C=(1-(v+y))*x,M=(h+b)*x,A=(f-_)*x,E=(h-b)*w,I=(1-(d+y))*w,R=(m+g)*w,D=(f+_)*S,L=(m-g)*S,j=(1-(d+v))*S;return e[0]=C,e[1]=M,e[2]=A,e[3]=0,e[4]=E,e[5]=I,e[6]=R,e[7]=0,e[8]=D,e[9]=L,e[10]=j,e[11]=0,e[12]=r[0]+P-(C*P+E*T+D*O),e[13]=r[1]+T-(M*P+I*T+L*O),e[14]=r[2]+O-(A*P+R*T+j*O),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,u=n*a,p=n*s,d=i*a,h=i*s,f=i*l,v=o*a,m=o*s,y=o*l;return e[0]=1-p-f,e[1]=u+y,e[2]=d-m,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=h+v,e[7]=0,e[8]=d+m,e[9]=h-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,n,i,o,a){var s=1/(r-t),l=1/(i-n),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},t.perspective=function(e,t,r,n,i){var o=1/Math.tan(t/2),a=void 0;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e},t.perspectiveFromFieldOfView=function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},t.ortho=function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*c,e[15]=1,e},t.lookAt=function(e,t,r,o){var a=void 0,s=void 0,l=void 0,c=void 0,u=void 0,p=void 0,d=void 0,h=void 0,f=void 0,v=void 0,m=t[0],y=t[1],g=t[2],_=o[0],b=o[1],x=o[2],w=r[0],S=r[1],P=r[2];return Math.abs(m-w)<n.EPSILON&&Math.abs(y-S)<n.EPSILON&&Math.abs(g-P)<n.EPSILON?i(e):(d=m-w,h=y-S,f=g-P,a=b*(f*=v=1/Math.sqrt(d*d+h*h+f*f))-x*(h*=v),s=x*(d*=v)-_*f,l=_*h-b*d,(v=Math.sqrt(a*a+s*s+l*l))?(a*=v=1/v,s*=v,l*=v):(a=0,s=0,l=0),c=h*l-f*s,u=f*a-d*l,p=d*s-h*a,(v=Math.sqrt(c*c+u*u+p*p))?(c*=v=1/v,u*=v,p*=v):(c=0,u=0,p=0),e[0]=a,e[1]=c,e[2]=d,e[3]=0,e[4]=s,e[5]=u,e[6]=h,e[7]=0,e[8]=l,e[9]=p,e[10]=f,e[11]=0,e[12]=-(a*m+s*y+l*g),e[13]=-(c*m+u*y+p*g),e[14]=-(d*m+h*y+f*g),e[15]=1,e)},t.targetTo=function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=n[0],l=n[1],c=n[2],u=i-r[0],p=o-r[1],d=a-r[2],h=u*u+p*p+d*d;h>0&&(u*=h=1/Math.sqrt(h),p*=h,d*=h);var f=l*d-c*p,v=c*u-s*d,m=s*p-l*u;return(h=f*f+v*v+m*m)>0&&(f*=h=1/Math.sqrt(h),v*=h,m*=h),e[0]=f,e[1]=v,e[2]=m,e[3]=0,e[4]=p*m-d*v,e[5]=d*f-u*m,e[6]=u*v-p*f,e[7]=0,e[8]=u,e[9]=p,e[10]=d,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=l,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],p=e[8],d=e[9],h=e[10],f=e[11],v=e[12],m=e[13],y=e[14],g=e[15],_=t[0],b=t[1],x=t[2],w=t[3],S=t[4],P=t[5],T=t[6],O=t[7],C=t[8],M=t[9],A=t[10],E=t[11],I=t[12],R=t[13],D=t[14],L=t[15];return Math.abs(r-_)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-S)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(l-P)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-T)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-O)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(p-C)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(d-M)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(h-A)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-E)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(v-I)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(m-R)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-D)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(g-L)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))},t.mul=o,t.sub=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(152)],void 0===(i=function(e,t,r,n){function i(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],i=t[r];if(n.length!==i.length)return!1;for(var o=0;o<n.length;o++)if(n[o]!==i[o])return!1}return!0}function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}function a(e,t){return e===t||e&&t&&e.equals(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!function(e,t){if(e===t)return!0;if(n.isNone(e)||n.isNone(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!a(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&o(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&o(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&i(e.points,t.points)}(e,t);case"mesh":return!1;default:return void r.neverReached(e)}}(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=0,o=r;i<o.length;i++){var a=o[i];if(e[a]!==t[a])return!1}return!0}(e.attributes,t.attributes)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(152),r(161)],void 0===(i=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return new Promise((function(e,t){r.e(114).then(function(){var t=[r(2129)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},a=function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(8),r.e(10),r.e(38)]).then(function(){var t=[r(2130)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},s=function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1277)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},l={"base-dynamic":function(){return new Promise((function(e,t){r.e(99).then(function(){var t=[r(2134)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"base-elevation":s,"base-tile":o,"bing-maps":o,"building-scene":function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(8),r.e(18),r.e(68)]).then(function(){var t=[r(2135)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},csv:a,elevation:s,feature:a,geojson:a,graphics:function(){return new Promise((function(e,t){Promise.all([r.e(8),r.e(69)]).then(function(){var t=[r(2138)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},group:function(){return new Promise((function(e,t){r.e(196).then(function(){var t=[r(1045)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},imagery:function(){return new Promise((function(e,t){r.e(79).then(function(){var t=[r(2139)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"integrated-mesh":function(){return new Promise((function(e,t){Promise.all([r.e(8),r.e(18),r.e(113)]).then(function(){var t=[r(2140)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"map-image":function(){return new Promise((function(e,t){r.e(60).then(function(){var t=[r(2141)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"ogc-feature":a,"open-street-map":o,"point-cloud":function(){return new Promise((function(e,t){Promise.all([r.e(19),r.e(53)]).then(function(){var t=[r(2142)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},scene:function(e){return null==e.profile||"mesh-pyramids"===e.profile?new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(8),r.e(10),r.e(39)]).then(function(){var t=[r(2151)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})):new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(8),r.e(10),r.e(41)]).then(function(){var t=[r(2155)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},stream:function(){return new Promise((function(e,t){Promise.all([r.e(5),r.e(7),r.e(8),r.e(10),r.e(49)]).then(function(){var t=[r(2156)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},tile:o,"imagery-tile":function(){return new Promise((function(e,t){Promise.all([r.e(20),r.e(190)]).then(function(){var t=[r(2158)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"vector-tile":function(){return new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(86)]).then(function(){var t=[r(2159)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"web-tile":o,wms:function(){return new Promise((function(e,t){r.e(70).then(function(){var t=[r(2161)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},wmts:function(){return new Promise((function(e,t){r.e(192).then(function(){var t=[r(2162)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))},"geo-rss":null,kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};t.layerView3DImporter={hasLayerViewModule:function(e){return i.isSome(l[e.type])},importLayerView:function(e){var t=l[e.type];if(!i.isSome(t))throw function(e){var t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new n(r+":view-not-supported",t+" is not supported in 3D")}(e);return t(e)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151),r(1596),r(1597),r(1598),r(1599)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilt=new l.default,t.altitude=new o.default,t.clipDistance=new a.default,t.collision=new s.default,t}return r.__extends(t,e),r.__decorate([i.property({type:l.default})],t.prototype,"tilt",void 0),r.__decorate([i.property({type:o.default})],t.prototype,"altitude",void 0),r.__decorate([i.property({type:a.default})],t.prototype,"clipDistance",void 0),r.__decorate([i.property({type:s.default})],t.prototype,"collision",void 0),r.__decorate([i.subclass("esri.views.3d.constraints.Constraints")],t)}(n);t.Constraints=c,t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(335),r(156),r(151),r(645)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.min=s.AltitudeDefault.min,t.max=s.AltitudeDefault.max,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return i.deprecated(o.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"}),"manual"},set:function(e){i.deprecated(o.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})},enumerable:!0,configurable:!0}),r.__decorate([a.property({type:Number})],t.prototype,"min",void 0),r.__decorate([a.property({type:Number})],t.prototype,"max",void 0),r.__decorate([a.subclass("esri.views.3d.constraints.AltitudeConstraint")],t)}(n);t.AltitudeConstraint=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mode="auto",t}return r.__extends(t,e),Object.defineProperty(t.prototype,"near",{get:function(){return this._get("near")},set:function(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"},enumerable:!0,configurable:!0}),t.prototype.castNear=function(e){return Math.max(1e-8,e)},Object.defineProperty(t.prototype,"far",{get:function(){return this._get("far")},set:function(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"},enumerable:!0,configurable:!0}),t.prototype.castFar=function(e){return Math.max(1e-8,e)},t.prototype.autoUpdate=function(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))},r.__decorate([i.property({type:Number,value:1e-8})],t.prototype,"near",null),r.__decorate([i.cast("near")],t.prototype,"castNear",null),r.__decorate([i.property({type:Number,value:1e-8})],t.prototype,"far",null),r.__decorate([i.cast("far")],t.prototype,"castFar",null),r.__decorate([i.property({type:["auto","manual"]})],t.prototype,"mode",void 0),r.__decorate([i.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],t)}(n);t.ClipDistanceConstraint=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(335),r(156),r(151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"enabled",{set:function(e){i.deprecated(o.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"}),this._set("enabled",e)},enumerable:!0,configurable:!0}),r.__decorate([a.property({value:!0})],t.prototype,"enabled",null),r.__decorate([a.subclass("esri.views.3d.constraints.CollisionConstraint")],t)}(n);t.CollisionConstraint=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(168),r(151),r(645)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s={min:i.rad2deg(a.TiltDefault.min),max:i.rad2deg(a.TiltDefault.max)},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mode="auto",t}return r.__extends(t,e),Object.defineProperty(t.prototype,"max",{get:function(){return this._get("max")},set:function(e){this._set("max",e),this.mode="manual"},enumerable:!0,configurable:!0}),t.prototype.castMax=function(e){return i.clamp(e,s.min,s.max)},t.prototype.autoUpdate=function(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)},r.__decorate([o.property({type:["auto","manual"]})],t.prototype,"mode",void 0),r.__decorate([o.property({type:Number,value:s.max})],t.prototype,"max",null),r.__decorate([o.cast("max")],t.prototype,"castMax",null),r.__decorate([o.subclass("esri.views.3d.constraints.TiltConstraint")],t)}(n);t.TiltConstraint=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(151),r(179),r(1601),r(1602),r(1164),r(915)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.atmosphere=new a.default,r}var l;return r.__extends(t,e),l=t,t.fromWebsceneEnvironment=function(e){var t=e.cloneConstructProperties();return new l(r.__assign(r.__assign({},t),{lighting:s.SceneViewLighting.fromWebsceneLighting(t.lighting)}))},t.prototype.castLighting=function(e){return this.convertLighting(e)},t.prototype.updateLighting=function(e){this.lighting=this.convertLighting(e)},t.prototype.convertLighting=function(e){return e?e instanceof s.SceneViewLighting?e:e instanceof c?this.lighting?this.lighting.cloneWithWebsceneLighting(e):s.SceneViewLighting.fromWebsceneLighting(e):o.ensureType(s.SceneViewLighting,e):new s.SceneViewLighting},t.prototype.clone=function(){return new l({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:n.clone(this.background)})},r.__decorate([i.property({type:a.default,json:{read:!1}})],t.prototype,"atmosphere",void 0),r.__decorate([i.property()],t.prototype,"lighting",void 0),r.__decorate([i.cast("lighting")],t.prototype,"castLighting",null),l=r.__decorate([i.subclass("esri.views.3d.environment.SceneViewEnvironment")],t)}(l)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r.__extends(t,e),n=t,Object.defineProperty(t.prototype,"quality",{set:function(e){-1!==["low","high"].indexOf(e)&&this._set("quality",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({quality:this.quality})},r.__decorate([i.property({type:["low","high"],value:"low"})],t.prototype,"quality",null),n=r.__decorate([i.subclass("esri.views.3d.environment.SceneViewAtmosphere")],t)}(n);t.SceneViewAtmosphere=o,t.default=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(151),r(915)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var r=e.call(this,t)||this;r.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0},r.cameraTrackingEnabled=!0,r.ambientOcclusionEnabled=!1,r.waterReflectionEnabled=!1;var n=(new Date).getFullYear(),i=new Date("March 15, "+n+" 12:00:00 UTC");return r._set("defaultDate",i),r._set("date",i),r}var n;return r.__extends(t,e),n=t,t.fromWebsceneLighting=function(e){return new n(r.__assign({},e.cloneConstructProperties()))},Object.defineProperty(t.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(e){var t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"date",{set:function(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))},enumerable:!0,configurable:!0}),t.prototype.autoUpdate=function(e,t){var r=s(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;var n=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,n=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));var i=s(this.positionTimezoneInfo);if(r!==i&&(l.target=this,l.timezoneOffset=i,this.emit("timezone-will-change",l)),null!=e)return n!==e.getTime()},t.prototype.clone=function(){var e=this._get("date")===this._get("defaultDate"),t=new n(r.__assign(r.__assign({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t},t.prototype.cloneWithWebsceneLighting=function(e){var t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t},r.__decorate([i.property({type:Boolean})],t.prototype,"cameraTrackingEnabled",void 0),r.__decorate([i.property({type:Boolean})],t.prototype,"ambientOcclusionEnabled",void 0),r.__decorate([i.property({type:Boolean})],t.prototype,"waterReflectionEnabled",void 0),r.__decorate([i.property({type:Date})],t.prototype,"defaultDate",null),r.__decorate([i.property({type:Date})],t.prototype,"date",null),n=r.__decorate([i.subclass("esri.views.3d.environment.SceneViewLighting")],t)}(n.EventedMixin(o));function s(e){var t=e.hours,r=e.minutes,n=e.seconds;return Math.round(t+r/60+n/3600)}t.SceneViewLighting=a,t.calculateTimezoneOffset=s;var l={target:null,timezoneOffset:0};t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1165),r(1166)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i,o={base:r,key:"type",typeMap:{color:n}};t.backgroundProperty={types:o,json:{read:(i=o,function(e,t,r){if(!e)return e;for(var n in i.typeMap)if(e.type===n){var o=new i.typeMap[n];return o.read(e,r),o}}),write:{overridePolicy:function(e,t,r){return{enabled:!r||!r.isPresentation}}}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(190),r(167),r(152),r(153),r(157),r(151),r(162),r(160),r(201),r(1605),r(238),r(192),r(1629),r(797),r(1166)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){Object.defineProperty(t,"__esModule",{value:!0});var _=p.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),b=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._referencePointUpdateDelay=200,n._referencePointUpdateInterval=3e3,n._referencePointUpdateDistThreshold=1e6,n._referencePosUpdateQuery=null,n._referencePosMapCoordsRequested=null,n._viewHandles=new o,n._preserveAbsoluteDateTime=!1,n._trackingEnabled=!1,n._referencePosResetPreserveAbsoluteTime=!1,n.referencePosUpdateTimer=null,n._referencePosWGS84Comparable=null,n._referencePosMapCoords=null,n._mainLight=new y.MainLight,n._ambientLight=new y.AmbientLight,n._moonLight=new y.FillLight,n._renderer=null,n._resetReferencePosition(),n}return r.__extends(t,e),t.prototype.destroy=function(){this.disconnectView(),this._viewHandles.destroy()},Object.defineProperty(t.prototype,"updating",{get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)},enumerable:!0,configurable:!0}),t.prototype.connectView=function(e){var t=this;this._renderer||(this._view=e,this._renderer=new h({view:e}),this._viewHandles.add([e.watch("environment.lighting.date",(function(e){return t._lightingDateHandler(e)}),!0),e.watch("stationary",(function(){return t._interactingStationaryHandler()})),e.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],(function(){return t._updateRenderParamsHandler()}),!0),e.watch("spatialReference",(function(){return t._resetReferencePosition()}),!0),l.init(e,"viewingMode",(function(){return t._resetReferencePosition()}),!0),l.init(e,"environment.lighting.cameraTrackingEnabled",(function(e){return t._updateCameraTracking(e)}),!0),l.init(e,"state.camera",(function(){return t._cameraHandler(null)}),!0),this.watch("disableQueries",(function(){return t._cameraHandler(null)}))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))},t.prototype.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._renderer=null,this._view=null)},t.prototype._updateCameraTracking=function(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{var t=this._view.environment.lighting;t&&(t.positionTimezoneInfo.autoUpdated=!1)}},t.prototype._lightingDateHandler=function(e){if(e){var t=this._view.environment.lighting;if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var r=this._view.spatialReference;if(!v.canProjectToWGS84ComparableLonLat(r)){var n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable){var i=f.positionToTimezone(this._referencePosWGS84Comparable,w);a.isSome(i)&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLightParams(e)}},t.prototype._preupdateTracking=function(e){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)},t.prototype._cameraHandler=function(e){if(void 0===e&&(e=null),this._view.ready){var t=this._view.camera;t&&(this._cameraHandlerClientSide(t,e)||this._cameraHandlerServerSide(t))}},t.prototype._cameraHandlerClientSide=function(e,t){if(!v.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;var r=e.position;return this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=p.vec3f64.create()),v.pointToWGS84ComparableLonLat(r,this._referencePosWGS84Comparable),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLightParams(t),!0},t.prototype._cameraHandlerServerSide=function(e){var t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())},t.prototype._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()},t.prototype._updateLightParams=function(e){var t=this._view.environment.lighting;e=e||t.date;var r,n=this._view._stage;this._referencePosWGS84Comparable?(r=m.computeColorAndIntensity(e,this._referencePosWGS84Comparable),m.computeDirection(e,this._referencePosWGS84Comparable,this._view.viewingMode,r.diffuse.direction)):r={diffuse:{color:[1,1,1],intensity:.55,direction:_},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0},u.vec3.scale(this._mainLight.intensity,r.diffuse.color,r.diffuse.intensity*Math.PI),u.vec3.negate(this._mainLight.direction,r.diffuse.direction),u.vec3.scale(this._ambientLight.intensity,r.ambient.color,r.ambient.intensity),u.vec3.lerp(this._moonLight.intensity,S,P,r.globalFactor);var i=(1-.5*r.globalFactor)*(1-.4*r.noonFactor*(1-r.globalFactor));u.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,i),u.vec3.copy(this._moonLight.direction,r.diffuse.direction),n.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:r.globalFactor,groundLightingFactor:1-r.noonFactor}),this._updateRenderParamsHandler()},t.prototype._autoUpdateTimezone=function(e,t){if(void 0===t&&(t=null),!this._view.environment.lighting.cameraTrackingEnabled)return!1;var r=x;r.setTime((t||this._view.environment.lighting.date).getTime());var n=f.positionToTimezone(e,w);if(a.isNone(n))return!1;var i=this._view.environment.lighting.positionTimezoneInfo;if(i.autoUpdated){if(i.hours===n.hours&&i.minutes===n.minutes&&i.seconds===n.seconds)return!1}else i=n;var o=r.getUTCHours()-(n.hours-i.hours),s=r.getUTCMinutes()-(n.minutes-i.minutes),l=r.getUTCSeconds()-(n.seconds-i.seconds);return r.setUTCHours(o),r.setUTCMinutes(s),r.setUTCSeconds(l),!t&&this._view.environment.lighting.autoUpdate(r,n)},t.prototype._updateRenderParamsHandler=function(){var e=this._view._stage;if(e){var t=!this._referencePosWGS84Comparable||m.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode),r=this._view.environment.background,i=r instanceof g?{type:"color",color:d.vec4f64.fromArray(n.toUnitRGBA(r.color))}:{type:"color",color:d.vec4f64.fromValues(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:i})}},t.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating")},t.prototype._requestReferencePositionUpdate=function(e,t){var r=this;if(void 0===t&&(t=!1),!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){var n=this._referencePosUpdateQuery=s.after(this._referencePointUpdateDelay).then((function(){if(r._referencePosUpdateQuery===n)return r._doReferencePositionUpdateQuery((function(){return r._referencePosUpdateQuery!==n}))})).catch((function(e){"mapcoordshelper:missing-geometry-service"===e.name&&(r.disableQueries=!0)})).then((function(){r._referencePosUpdateQuery===n&&(r._referencePosUpdateQuery=null,r.referencePosUpdateTimer||r._executePendingReferencePositionUpdate(),r.notifyChange("updating"))})),i=this.referencePosUpdateTimer=s.after(this._referencePointUpdateInterval).then((function(){r.referencePosUpdateTimer===i&&(r.referencePosUpdateTimer=null,r._referencePosUpdateQuery||r._executePendingReferencePositionUpdate())}));this.notifyChange("updating")}},t.prototype._doReferencePositionUpdateQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null,[4,this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return t=r.sent(),e()||isNaN(t[0])||isNaN(t[1])||(n=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=n):this._referencePosWGS84Comparable=[t[0],t[1],n],this._referencePosChanged()),[2]}}))}))},t.prototype._executePendingReferencePositionUpdate=function(){var e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)},t.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()},t.prototype._exceedsReferencePosDistThreshold=function(e){if(this._referencePosMapCoords){var t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0},t.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateQuery=null,this.referencePosUpdateTimer=null},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{renderer:this._renderer,set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e.referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t}}},enumerable:!0,configurable:!0}),t.FIXED_LIGHT_DIRECTION=_,r.__decorate([c.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],t.prototype,"updating",null),r.__decorate([c.property()],t.prototype,"disableQueries",void 0),r.__decorate([c.property()],t.prototype,"_renderer",void 0),r.__decorate([c.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],t)}(i.EventedAccessor);t.SceneViewEnvironmentManager=b;var x=new Date,w={hours:0,minutes:0,seconds:0},S=p.vec3f64.fromValues(.22,.22,.33),P=p.vec3f64.fromValues(.22,.22,.22);t.default=b}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(177),r(167),r(157),r(151),r(1606),r(1624),r(1626),r(1627)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=[14,15];return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new o,t._initContext=null,t._pendingAtmosphere=null,t._atmosphere=null,t._stars=null,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return null!=this._pendingAtmosphere},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.view._stage.addRenderPlugin(d,this)},t.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null),this._stars&&(this._stars.destroy(),this._stars=null),this._handles&&this._handles.removeAll(),this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))},t.prototype.initializeRenderContext=function(e){this._initContext=e,this._techniqueRepository=this._initContext.shaderTechniqueRep,this.setup()},t.prototype.setup=function(){var e=this;this._handles.add(a.when(this.view,"basemapTerrain",(function(){return e._updateBasemapTerrain()}),!0)),this._handles.add([a.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],(function(){return e._updateAtmosphere()}),!0),a.init(this.view,"environment.starsEnabled",(function(){return e._updateStars()}),!0)])},t.prototype.uninitializeRenderContext=function(){this._stars&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null),this._atmosphere&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)},t.prototype.render=function(e){var t=!0;return this._stars&&this._stars.canRender&&(t=this._stars.render(e)&&t),this._atmosphere&&this._atmosphere.canRender&&(t=this._atmosphere.render(e)&&t),t},t.prototype._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()},t.prototype._updateStars=function(){var e=this.view.get("environment.starsEnabled")||!1;e&&!this._stars?(this._stars=new p(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!e&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())},t.prototype._updateAtmosphere=function(){var e=this,t=this._getAtmosphereType();if(this.atmosphereType!==t){this.atmosphereType=t,this._pendingAtmosphere&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);var r=this._getAtmosphereClass();if(!r)return this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();var n=new r(this.view,this._techniqueRepository);n.initializeRenderContext(this._initContext),null==this._atmosphere&&(this._atmosphere=n,this._setNeedsRender()),this._pendingAtmosphere=n,n.when().then((function(){e._pendingAtmosphere!==e._atmosphere&&(e._atmosphere.destroy(),e._atmosphere=e._pendingAtmosphere),e._pendingAtmosphere=null,e._setNeedsRender(),e._updateBasemapTerrain()})).catch((function(){e._pendingAtmosphere===n&&(e._pendingAtmosphere=null)}))}},t.prototype._getAtmosphereClass=function(){var e=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(e);switch(e){case"none":return null;case"realistic":return c.RealisticAtmosphere;case"panoramic":return l;case"simple":return u;default:return void i.neverReached(e)}},t.prototype._getAtmosphereType=function(){var e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),r=this.view.viewingMode;return e&&null!=t?"local"===r?"panoramic":"high"===t&&c.RealisticAtmosphere.isSupported(this._initContext)?"realistic":"simple":"none"},t.prototype._updateBasemapTerrain=function(){var e=this.view.basemapTerrain;e&&(e.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)},Object.defineProperty(t.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},enumerable:!0,configurable:!0}),r.__decorate([s.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([s.property({constructOnly:!0})],t.prototype,"atmosphereClassFromType",void 0),r.__decorate([s.property({dependsOn:["_pendingAtmosphere"]})],t.prototype,"updating",null),r.__decorate([s.property()],t.prototype,"_pendingAtmosphere",void 0),r.__decorate([s.subclass("esri.views.3d.environment.EnvironmentRenderer")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(153),r(189),r(185),r(1169),r(1171),r(493),r(371),r(317),r(228),r(442),r(195),r(307),r(299),r(341),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){var g=r.getLogger("esri.views.3d.environment.PanoramicAtmosphere"),_=function(){function e(e,t){this.slot=14,this._readyResolver=n.createResolver(),this._readyController=n.createAbortController(),this.view=e,this._techniqueRepository=t,this._atmosphereTechniqueConfig=new a.SimpleAtmosphereTechniqueConfiguration}return Object.defineProperty(e.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._readyResolver.reject(),this._texture&&(this._texture.dispose(),this._texture=null),this._readyController&&(this._readyController.abort(),this._readyController=null)},e.prototype.when=function(){return this._readyResolver.promise},e.prototype.initializeRenderContext=function(e){var t=this,r=e.rctx;this._atmosphereTechniqueConfig.geometry=1,this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(a.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique),this._vao=this._createVertexArrayObject(r),this._vaoCount=m.vertexCount(this._vao,"geometry"),l.requestImage(s,{signal:this._readyController.signal}).then((function(r){t._texture=new v(e.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},r),e.requestRender(),t._readyController=null,t._readyResolver.resolve()})).catch((function(e){n.isAbortError(e)||g.error("Unable to initialize atmosphere: image request failed",e),t._readyResolver.reject()}))},e.prototype.uninitializeRenderContext=function(){this.destroy()},e.prototype.render=function(e){if(e.slot!==this.slot||0!==e.pass)return!1;var t,r,n=e.rctx,o=this._atmosphereTechnique.program;return n.bindProgram(o),this._atmosphereTechnique.bindPipelineState(n),n.bindTexture(this._texture),o.setUniform1i("tex",0),o.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t=b,r=e.camera.viewMatrix,i.mat4.copy(t,r),t[12]=0,t[13]=0,t[14]=0,t[15]=1,o.setUniformMatrix4fv("view",b),o.setUniform4f("color",1,1,1,1),e.scenelightingData.setLightDirectionUniform(o),n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(4,0,this._vaoCount),!0},e.prototype._createVertexArrayObject=function(e){for(var t=d.createPolySphereGeometry(1,2,!1),r=t.indices[h.VertexAttrConstants.POSITION],n=0;n<r.length;n+=3){var i=r[n];r[n]=r[n+2],r[n+2]=i}var o=t.vertexAttributes[h.VertexAttrConstants.POSITION].data,a=x.createBuffer(r.length),s=a.position;for(n=0;n<r.length;++n){var l=3*r[n];s.set(n,0,o[l]),s.set(n,1,o[l+1]),s.set(n,2,o[l+2])}return new y(e,p.Default3D,{geometry:c.glLayout(x)},{geometry:f.createVertex(e,35044,a.buffer)})},e}(),b=o.mat4f64.create(),x=u.newLayout().vec3f("position");return _}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(){var e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.clone=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.fromValues=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){var m=new Float32Array(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=l,m[9]=c,m[10]=u,m[11]=p,m[12]=d,m[13]=h,m[14]=f,m[15]=v,m},t.createView=function(e,t){return new Float32Array(e,t,16)},t.IDENTITY=r()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1609),r(1610)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function o(e,t){for(var r=t-1;r>=0;r--){var n=e[r];if("whitespace"!==n.type&&"block-comment"!==n.type){if("keyword"!==n.type)break;if("attribute"===n.data||"in"===n.data)return!0}}return!1}function a(e,t,r,n){n=n||r;for(var i=0,o=e;i<o.length;i++){var s=o[i];if("ident"===s.type&&s.data===r)return n in t?t[n]++:t[n]=0,a(e,t,n+"_"+t[n],n)}return r}function s(e,t,r,n){void 0===n&&(n="lowp"),function(e,t,r){function n(e,t){for(var r=t;r<e.length;r++){var n=e[r];if("operator"===n.type&&";"===n.data)return r}return null}void 0===r&&(r="afterVersion");var i={data:"\n",type:"whitespace"},o=function(t){return t<e.length&&/[^\r\n]$/.test(e[t].data)},a=function(e){for(var t=-1,i=0,o=-1,a=0;a<e.length;a++){var s=e[a];if("preprocessor"===s.type&&(s.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++i:s.data.match(/\#endif\s*.*/)&&--i),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===s.type&&/^#version/.test(s.data)&&(o=Math.max(o,a)),"afterPrecision"===r&&"keyword"===s.type&&"precision"===s.data){var l=n(e,a);if(null===l)throw new Error("precision statement not followed by any semicolons!");o=Math.max(o,l)}t<o&&0===i&&(t=a)}return t+1}(e);o(a-1)&&e.splice(a++,0,i);for(var s=0,l=t;s<l.length;s++){var c=l[s];e.splice(a++,0,c)}o(a-1)&&o(a)&&e.splice(a,0,i)}(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}t.transpileShader=function(e,t){var l=function(e){return n(e)}(e);if("300 es"===function(e,t,r){void 0===t&&(t="100"),void 0===r&&(r="300 es");for(var n=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,i=0,o=e;i<o.length;i++){var a=o[i];if("preprocessor"===a.type){var s=n.exec(a.data);if(s){var l=s[1].replace(/\s\s+/g," ");if(l===r)return l;if(l===t)return a.data="#version "+r,t;throw new Error("unknown glsl version: "+l)}}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(l,"100","300 es"))throw new Error("shader is already glsl 300 es");for(var c=null,u=null,p={},d={},h=0;h<l.length;++h)switch((f=l[h]).type){case"keyword":"vertex"===t&&"attribute"===f.data?f.data="in":"varying"===f.data&&(f.data="vertex"===t?"out":"in");break;case"builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(f.data.trim())&&(f.data=f.data.replace(/(2D|Cube|EXT)/g,"")),"fragment"===t&&"gl_FragColor"===f.data?(c||s(l,c=a(l,p,"fragColor"),"vec4"),f.data=c):"fragment"===t&&"gl_FragDepthEXT"===f.data&&(u||(u=a(l,p,"gl_FragDepth")),f.data=u);break;case"ident":if(r.indexOf(f.data)>=0){if("vertex"===t&&o(l,h))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");f.data in d||(d[f.data]=a(l,p,f.data)),f.data=d[f.data]}}for(h=l.length-1;h>=0;--h){var f;if("preprocessor"===(f=l[h]).type){var v=f.data.match(/\#extension\s+(.*)\:/);if(v&&v[1]&&i.indexOf(v[1].trim())>=0){var m=l[h+1];l.splice(h,m&&"whitespace"===m.type?2:1)}var y=f.data.match(/\#ifdef\s+(.*)/);y&&y[1]&&i.indexOf(y[1].trim())>=0&&(f.data="#if 1");var g=f.data.match(/\#ifndef\s+(.*)/);g&&g[1]&&i.indexOf(g[1].trim())>=0&&(f.data="#if 0")}}return function(e){return e.map((function(e){return"eof"!==e.type?e.data:""})).join("")}(l)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(1611)],void 0===(i=function(e){return function(t){var r=e(),n=[];return(n=n.concat(r(t))).concat(r(null))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(1612),r(1613),r(1614)],void 0===(i=function(e,t,r){var n=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];return function(){var i,o,a,s=0,l=0,c=999,u=[],p=[],d=1,h=0,f=0,v=!1,m=!1,y="";return function(e){return p=[],null!==e?function(e){var t;for(s=0,a=(y+=e).length;i=y[s],s<a;){switch(t=s,c){case 0:s="/"===i&&"*"===o?(u.push(i),g(u.join("")),c=999,s+1):(u.push(i),o=i,s+1);break;case 1:case 2:s="\r"!==i&&"\n"!==i||"\\"===o?(u.push(i),o=i,s+1):(g(u.join("")),c=999,s);break;case 3:s=_();break;case 4:s="."===i||/[eE]/.test(i)?(u.push(i),c=5,o=i,s+1):"x"===i&&1===u.length&&"0"===u[0]?(c=11,u.push(i),o=i,s+1):/[^\d]/.test(i)?(g(u.join("")),c=999,s):(u.push(i),o=i,s+1);break;case 11:s=/[^a-fA-F0-9]/.test(i)?(g(u.join("")),c=999,s):(u.push(i),o=i,s+1);break;case 5:"f"===i&&(u.push(i),o=i,s+=1),s=/[eE]/.test(i)||"-"===i&&/[eE]/.test(o)?(u.push(i),o=i,s+1):/[^\d]/.test(i)?(g(u.join("")),c=999,s):(u.push(i),o=i,s+1);break;case 9999:s=x();break;case 9:s=/[^\s]/g.test(i)?(g(u.join("")),c=999,s):(u.push(i),o=i,s+1);break;case 999:u=u.length?[]:u,s="/"===o&&"*"===i?(f=l+s-1,c=0,o=i,s+1):"/"===o&&"/"===i?(f=l+s-1,c=1,o=i,s+1):"#"===i?(c=2,f=l+s,s):/\s/.test(i)?(c=9,f=l+s,s):(v=/\d/.test(i),m=/[^\w_]/.test(i),f=l+s,c=v?4:m?3:9999,s)}if(t!==s)switch(y[t]){case"\n":h=0,++d;break;default:++h}}return l+=s,y=y.slice(s),p}(e.replace?e.replace(/\r\n/g,"\n"):e):(u.length&&g(u.join("")),c=10,g("(eof)"),p)};function g(e){e.length&&p.push({type:n[c],data:e,position:f,line:d,column:h})}function _(){if("."===o&&/\d/.test(i))return c=5,s;if("/"===o&&"*"===i)return c=0,s;if("/"===o&&"/"===i)return c=1,s;if("."===i&&u.length){for(;b(u););return c=5,s}if(";"===i||")"===i||"("===i){if(u.length)for(;b(u););return g(i),c=999,s+1}var e=2===u.length&&"="!==i;if(/[\w_\d\s]/.test(i)||e){for(;b(u););return c=999,s}return u.push(i),o=i,s+1}function b(e){for(var r,n,i=0;;){if(r=t.indexOf(e.slice(0,e.length+i).join("")),n=t[r],-1===r){if(i--+e.length>0)continue;n=e.slice(0,1).join("")}return g(n),f+=n.length,(u=u.slice(n.length)).length}}function x(){if(/[^\d\w_]/.test(i)){var t=u.join("");return c=e.indexOf(t)>-1?8:r.indexOf(t)>-1?7:6,g(u.join("")),c=999,s}return u.push(i),o=i,s+1}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(){"use strict";return["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]}.apply(null,[]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(){return["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]}.apply(null,[]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(){"use strict";return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}.apply(null,[]))||(e.exports=n)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=9;var o=this.TypedArrayConstructor;void 0===n&&(n=9*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<9;n++)t[n]=this.typedBuffer[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<9;n++)this.typedBuffer[r+n]=t[n]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){for(var n=this.typedBuffer,i=t.typedBuffer,o=e*this.typedBufferStride,a=r*t.typedBufferStride,s=0;s<9;++s)n[o+s]=i[a+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=9,e}();t.BufferViewMat3Impl=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=16;var o=this.TypedArrayConstructor;void 0===n&&(n=16*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<16;n++)t[n]=this.typedBuffer[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<16;n++)this.typedBuffer[r+n]=t[n]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){for(var n=this.typedBuffer,i=t.typedBuffer,o=e*this.typedBufferStride,a=r*t.typedBufferStride,s=0;s<16;++s)n[o+s]=i[a+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=16,e}();t.BufferViewMat4Impl=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=1;var o=this.TypedArrayConstructor;void 0===n&&(n=o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.get=function(e){return this.typedBuffer[e*this.typedBufferStride]},e.prototype.set=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=1,e}();t.BufferViewScalarImpl=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(205)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=2;var o=this.TypedArrayConstructor;void 0===n&&(n=2*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec2.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.setValues=function(e,t,r){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,o=e*this.typedBufferStride,a=r*t.typedBufferStride;n[o]=i[a],n[o+1]=i[a+1]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=2,e}();t.BufferViewVec2Impl=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=3;var o=this.TypedArrayConstructor;void 0===n&&(n=3*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec3.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.setValues=function(e,t,r,n){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r,this.typedBuffer[e*this.typedBufferStride+2]=n},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,o=e*this.typedBufferStride,a=r*t.typedBufferStride;n[o]=i[a],n[o+1]=i[a+1],n[o+2]=i[a+2]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=3,e}();t.BufferViewVec3Impl=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(245)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=4;var o=this.TypedArrayConstructor;void 0===n&&(n=4*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.typedBuffer=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec4.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2],this.typedBuffer[e*this.typedBufferStride+3])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2],this.typedBuffer[e*this.typedBufferStride+3]=t[3]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.setValues=function(e,t,r,n,i){this.typedBuffer[e*this.typedBufferStride]=t,this.typedBuffer[e*this.typedBufferStride+1]=r,this.typedBuffer[e*this.typedBufferStride+2]=n,this.typedBuffer[e*this.typedBufferStride+3]=i},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,o=e*this.typedBufferStride,a=r*t.typedBufferStride;n[o]=i[a],n[o+1]=i[a+1],n[o+2]=i[a+2],n[o+3]=i[a+3]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=4,e}();t.BufferViewVec4Impl=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(){return new Float32Array(3)}function n(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}function i(){return r()}function o(){return n(1,1,1)}function a(){return n(1,0,0)}function s(){return n(0,1,0)}function l(){return n(0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.clone=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.fromValues=n,t.createView=function(e,t){return new Float32Array(e,t,3)},t.zeros=i,t.ones=o,t.unitX=a,t.unitY=s,t.unitZ=l,t.ZEROS=i(),t.ONES=o(),t.UNIT_X=a(),t.UNIT_Y=s(),t.UNIT_Z=l()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(355),r(794)],void 0===(i=function(e,t,r,n,i){function o(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function a(e,t,r,n,i){return void 0===i&&(i=o()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.wrap=function(e,t,r,i){return a(e,t,r,i,n.sv4d.get())},t.wrapAxisAngle=function(e,t){return a(e[0],e[1],e[2],t,n.sv4d.get())},t.copy=function(e,t){return void 0===t&&(t=o()),a(e[0],e[1],e[2],e[3],t)},t.fromValues=a,t.fromAxisAndAngle=function(e,t,n){return void 0===n&&(n=o()),r.vec3.copy(n,e),n[3]=t,n},t.fromPoints=function(e,t,n){return void 0===n&&(n=o()),r.vec3.cross(n,e,t),r.vec3.normalize(n,n),n[3]=i.angle(e,t),n},t.UP=[0,0,1,0]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(856),r(276),r(185),r(647),r(216),r(160),r(201)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t,n){var i=this;this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(n/this.itemByteSize),this.tickHandle=r.before((function(){return i.reset()}))}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.itemsPtr=0,this.items=null,this.buffers=null},e.prototype.get=function(){0===this.itemsPtr&&r((function(){}));for(var e=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=e;){for(var t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),n=0;n<this.itemsPerBuffer;++n)this.items.push(this.itemCreate(t,n*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]},e.prototype.reset=function(){for(var e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0},e.createVec2f64=function(t){return void 0===t&&(t=u),new e(16,a.vec2f64.createView,t)},e.createVec3f64=function(t){return void 0===t&&(t=u),new e(24,s.vec3f64.createView,t)},e.createVec4f64=function(t){return void 0===t&&(t=u),new e(32,l.vec4f64.createView,t)},e.createMat3f64=function(t){return void 0===t&&(t=u),new e(72,n.mat3f64.createView,t)},e.createMat4f64=function(t){return void 0===t&&(t=u),new e(128,i.mat4f64.createView,t)},e.createQuatf64=function(t){return void 0===t&&(t=u),new e(32,o.quatf64.createView,t)},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0}),e}();t.VectorStack=c;var u=4096}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(167),r(153),r(157),r(189),r(185),r(205),r(216),r(162),r(160),r(245),r(201),r(1178),r(1625),r(238),r(371),r(317),r(228),r(307),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(){function e(e,t){this._view=e,this.canRender=!0,this._skyslot=14,this._hazeSlot=15,this._renderData={texDepth:l.vec2f64.create(),cameraPosition:u.vec3f64.create(),projectionInverse:a.mat4f64.create(),viewInverse:a.mat4f64.create(),heightParameters:d.vec4f64.create(),atmosphereParameters1:d.vec4f64.create(),atmosphereParameters2:d.vec4f64.create(),atmosphereParameters3:u.vec3f64.create(),invWavelength:P,invWavelengthScaled:T,radii:l.vec2f64.create(),scale:0,scaleDepth:O,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:C,oneOverScaleDepthBlue:A,scaleOverScaleDepthBlue:0,g:E,g2:E*E,miePhaseCoefficients:I,nearFar:l.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0},this._lowerElevationBoundRadius=0,this._earthRadius=v.earthRadius,this._updateRadius(v.earthRadius),this._techniqueRepository=t,this._atmosphereTechniqueConfig=new f.RealisticAtmosphereTechniqueConfiguration}return e.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null),this._vao&&(this._vao.dispose(),this._vao=null)},e.prototype.when=function(){return n.resolve()},e.prototype.initializeRenderContext=function(e){var t=this,n=e.rctx;this._handles=new r,this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"}),this._handles.add(i.on(this._view,"basemapTerrain","elevation-change",(function(e){return t._updateElevation(e)}),(function(){return t._updateElevation()}))),this._handles.add(i.on(this._view,"basemapTerrain","elevation-bounds-change",(function(){return t._updateVisibleElevationBounds()}),(function(){return t._updateVisibleElevationBounds()}))),this._atmosphereTechniqueConfig.haze=!1,this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique),this._atmosphereTechniqueConfig.haze=!0,this._atmosphereHazeTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique),this._vao=this._createVertexArrayObject(n)},e.prototype.uninitializeRenderContext=function(){this.destroy()},e.prototype.render=function(e){return(e.slot===this._hazeSlot||e.slot===this._skyslot)&&0===e.pass&&(this._update(e.camera),e.slot===this._skyslot&&this._renderSky(e),e.slot===this._hazeSlot&&this._renderHaze(e),!0)},e.prototype._renderSky=function(e){var t=e.rctx,r=this._atmosphereTechnique.program;t.bindProgram(r),this._atmosphereTechnique.bindPipelineState(t),r.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3),this._renderCommon(r,e)},e.prototype._renderHaze=function(e){var t=this,r=e.rctx,n=e.offscreenRenderingHelper,i=this._atmosphereHazeTechnique.program;r.bindProgram(i),this._atmosphereHazeTechnique.bindPipelineState(r),n.renderDepthDetached((function(){var o=n.depthTexture;r.bindTexture(o,0),i.setUniform1i("depthTex",0),t._renderCommon(i,e)}))},e.prototype._renderCommon=function(e,t){var r=t.rctx;e.setUniform3fv("invWavelength",this._renderData.invWavelength),e.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled),t.scenelightingData.setLightDirectionUniform(e),e.setUniform4fv("heightParameters",this._renderData.heightParameters),e.setUniform3fv("cameraPosition",this._renderData.cameraPosition),e.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse),e.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse),e.setUniform2fv("nearFar",this._renderData.nearFar),e.setUniform2fv("radii",this._renderData.radii),e.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1),e.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2),e.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance),e.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(5,0,4)},e.prototype._createVertexArrayObject=function(e){var t=R.createBuffer(4);return t.position.setVec(0,[-1,-1]),t.position.setVec(1,[1,-1]),t.position.setVec(2,[-1,1]),t.position.setVec(3,[1,1]),t.uv0.setVec(0,[0,0]),t.uv0.setVec(1,[1,0]),t.uv0.setVec(2,[0,1]),t.uv0.setVec(3,[1,1]),new b(e,g.Default3D,{geometry:m.glLayout(R)},{geometry:_.createVertex(e,35044,t.buffer)})},e.prototype._adjustRadiusForTesselation=function(e){var t=Math.PI/Math.pow(2,4)/16;return e*Math.cos(t)},e.prototype._updateElevation=function(e){var t=e?e.tile:this._view.basemapTerrain.rootTiles[0];if(0===t.lij[0]){var r=this._adjustRadiusForTesselation(v.earthRadius+t.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._earthRadius=-1,this._updateVisibleElevationBounds())}},e.prototype._updateVisibleElevationBounds=function(){var e=this._adjustRadiusForTesselation(v.earthRadius+this._view.basemapTerrain.elevationBounds.min);(this._earthRadius<0||e<this._earthRadius)&&this._updateRadius(e)},e.prototype._updateRadius=function(e){this._earthRadius=e;var t=e,r=t/10*10.25,n=1/(r-t),i=n/O,o=n/C,a=.3*(r-t)+t,l=this._renderData;p.vec4.set(l.atmosphereParameters1,n,O,i,M),p.vec4.set(l.atmosphereParameters2,E,C,o,A),c.vec3.set(l.atmosphereParameters3,E*E,I,a),s.vec2.set(l.radii,t,r),l.scale=n,l.lowerAlphaBlendBound=a,l.scaleOverScaleDepth=i,l.scaleOverScaleDepthBlue=o;var u=h.INNER_ATMOSPHERE_DEPTH;l.innerFadeDistance=2*Math.sqrt((2*e-u)*u)},e.prototype._update=function(e){e&&(this._renderData.cameraHeight=c.vec3.length(e.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=d.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),c.vec3.copy(this._renderData.cameraPosition,e.eye),o.mat4.invert(this._renderData.projectionInverse,e.projectionMatrix),o.mat4.invert(this._renderData.viewInverse,e.viewMatrix),s.vec2.set(this._renderData.nearFar,e.near,e.far),this._renderData.altitudeFade=h.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))},e.isSupported=function(e){return e.rctx.capabilities.depthTexture},e}();t.RealisticAtmosphere=x;var w=.02*Math.PI,S=.004*Math.PI,P=u.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),T=u.vec3f64.clone(P);c.vec3.scale(T,T,w),c.vec3.add(T,T,u.vec3f64.fromValues(S,S,S));var O=.25,C=.05,M=1/O,A=1/C,E=-.99999,I=(1-E*E)/(2+E*E)*1.5,R=y.newLayout().vec2f("position").vec2f("uv0")}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1179),r(253),r(257),r(260),r(228),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({haze:n.haze});return new c(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){return this.configuration.haze?u.makePipelineState({blending:u.separateBlendingParams(1,0,769,1),colorWrite:u.defaultColorWriteParams}):u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:u.defaultColorWriteParams})},t.shader=new o.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1179)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(a.ShaderTechnique);t.RealisticAtmosphereTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.haze=!1,t}return n.__extends(t,e),n.__decorate([s.parameter()],t.prototype,"haze",void 0),t}(s.ShaderTechniqueConfiguration);t.RealisticAtmosphereTechniqueConfiguration=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(168),r(168),r(153),r(157),r(189),r(185),r(205),r(216),r(162),r(160),r(1178),r(1169),r(1171),r(238),r(493),r(251),r(371),r(317),r(228),r(416),r(195),r(307),r(299),r(341),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C){var M=r.getLogger("esri.views.3d.environment.SimpleAtmosphere"),A=-h.INNER_ATMOSPHERE_DEPTH,E=(m.earthRadius+A)/m.earthRadius,I=(m.earthRadius+0)/m.earthRadius,R=(m.earthRadius+3e5)/m.earthRadius,D=g.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5e3,.51171875],[5e4,.4140625]]),L=function(){function e(e,t){this.slot=14,this._renderData={texV:u.vec2f64.create(),silCircleCenter:d.vec3f64.create(),silCircleV1:d.vec3f64.create(),silCircleV2:d.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._fadeVaoCount=0,this._readyResolver=o.createResolver(),this._readyController=o.createAbortController(),this._techniqueRepository=t,this._atmosphereTechniqueConfig=new f.SimpleAtmosphereTechniqueConfiguration,this.view=e}return Object.defineProperty(e.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0}),e.prototype.when=function(){return this._readyResolver.promise},e.prototype.initializeRenderContext=function(e){var t=this,r=e.rctx;this._cameraChangeHandle=a.init(this.view,"state.camera",(function(){return e.requestRender()}),!0),this._atmosphereTechniqueConfig.geometry=0,this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique),this._atmosphereTechniqueConfig.geometry=2,this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique),this._vao=this._createRibbon(r),this._vaoCount=O.vertexCount(this._vao,"geometry"),this._fadeVao=w.createQuadVAO(r),this._fadeVaoCount=O.vertexCount(this._fadeVao,"geometry"),y.requestImage(v,{signal:this._readyController.signal}).then((function(n){t._texture=new T(r,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},n),e.requestRender(),t._readyController=null,t._readyResolver.resolve()})).catch((function(e){o.isAbortError(e)||M.error("Unable to initialize simple atmosphere: image request failed",e),t._readyResolver.reject()}))},e.prototype.uninitializeRenderContext=function(){this.destroy()},e.prototype.destroy=function(){this._readyResolver.reject(),this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null),this._texture&&(this._texture.dispose(),this._texture=null),this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null),this._vao&&(this._vao.dispose(),this._vao=null),this._readyController&&(this._readyController.abort(),this._readyController=null)},e.prototype.render=function(e){if(e.slot!==this.slot||0!==e.pass)return!1;this._update(e.camera);var t=e.rctx;if(this._atmosphereConeTechnique.bindPipelineState(t),this._renderData.undergroundFadeAlpha<1){var r=this._atmosphereConeTechnique.program;t.bindProgram(r),r.setUniformMatrix4fv("proj",e.camera.projectionMatrix),r.setUniformMatrix4fv("view",e.camera.viewMatrix),r.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),r.setUniform3fv("silCircleV1",this._renderData.silCircleV1),r.setUniform3fv("silCircleV2",this._renderData.silCircleV2),r.setUniform2fv("texV",this._renderData.texV),t.bindTexture(this._texture,0),r.setUniform1i("tex",0),e.scenelightingData.setLightDirectionUniform(r),r.setUniform1f("altitudeFade",this._renderData.altitudeFade),r.setUniform1f("innerScale",this._renderData.innerScale),t.bindVAO(this._vao),t.drawArrays(4,0,this._vaoCount)}return this._renderData.undergroundFadeAlpha>0&&(r=this._atmosphereUndergroundTechnique.program,t.bindProgram(r),r.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),e.scenelightingData.setLightDirectionUniform(r),r.setUniform3fv("cameraPosition",e.camera.eye),t.bindVAO(this._fadeVao),t.drawArrays(5,0,this._fadeVaoCount)),!0},e.prototype._update=function(e){var t=d.vec3f64.create(),r=m.earthRadius,o=p.vec3.length(e.eye),a=o-r;if(a<0){var s=Math.min(-a/5e3,1);this._renderData.undergroundFadeAlpha=s}else this._renderData.undergroundFadeAlpha=0;var l,u,f,v=Math.max(50,a),y=r+A;this._renderData.innerScale=(u=r,f=y,(l=r+v)*l/(Math.sqrt(l*l-u*u)*Math.sqrt(l*l-f*f)+u*f)-1),this._renderData.altitudeFade=h.computeInnerAltitudeFade(a),p.vec3.scale(t,e.eye,(r+50)/o),j(t,e.center,e.up,r,this._renderData);var g=k(e,t,e.up,this._renderData),_=D(a),b=.001953125,x=0+g*_*1;if(a>50){j(e.eye,e.center,e.up,r,this._renderData);var w=k(e,e.eye,e.up,this._renderData),S=n.clamp((w-1.5)/(g-1.5),0,1);b=0+S*(1-511/512)*1,x=0+1*i.lerp(1,g*_,S)}c.vec2.set(this._renderData.texV,b,x)},e.prototype._createRibbon=function(e){var t=new Float32Array(1155),r=new Uint32Array(1920);t[0]=0,t[1]=0,t[2]=-1;for(var n=0;n<128;n++){var i=9*n+3;t[i+0]=n,t[i+1]=E,t[i+2]=-1,t[i+3]=n,t[i+4]=I,t[i+5]=0,t[i+6]=n,t[i+7]=R,t[i+8]=1;var o=3*n+1,a=127===n?1:o+3,s=15*n;r[s+0]=o,r[s+1]=o+1,r[s+2]=a+1,r[s+3]=a+1,r[s+4]=a,r[s+5]=o,r[s+6]=o+1,r[s+7]=o+2,r[s+8]=a+2,r[s+9]=a+2,r[s+10]=a+1,r[s+11]=o+1,r[s+12]=o,r[s+13]=a,r[s+14]=0}var l=z.createBuffer(r.length),c=l.position;for(n=0;n<r.length;++n){var u=3*r[n];c.set(n,0,t[u]),c.set(n,1,t[u+1]),c.set(n,2,t[u+2])}return new C(e,x.Default3D,{geometry:_.glLayout(z)},{geometry:P.createVertex(e,35044,l.buffer)})},e}();function j(e,t,r,n,i){var o=p.vec3.length(e),a=n*Math.sqrt(o*o-n*n)/o,s=Math.sqrt(n*n-a*a),l=i.silCircleV1,c=i.silCircleV2;return p.vec3.scale(i.silCircleCenter,e,s/o),p.vec3.cross(l,e,t),p.vec3.squaredLength(l)<1&&p.vec3.cross(l,e,r),p.vec3.scale(l,l,a/p.vec3.length(l)),p.vec3.cross(c,l,e),p.vec3.scale(c,c,a/p.vec3.length(c)),a}var V=l.mat4f64.create(),F=d.vec3f64.create(),N=d.vec3f64.create();function k(e,t,r,n){return p.vec3.add(F,n.silCircleCenter,n.silCircleV2),p.vec3.scale(N,F,R),s.mat4.lookAt(V,t,F,r),S.project(F,V,e.projectionMatrix,e.viewport),S.project(N,V,e.projectionMatrix,e.viewport),p.vec3.distance(F,N)/e.height}var z=b.newLayout().vec3f("position");return L}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(226),r(154),r(156),r(153),r(157),r(189),r(185),r(1628),r(371),r(317),r(228),r(307),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){var y=a.getLogger("esri.views.3d.environment.Stars"),g=function(){function e(e){this.slot=14,this.numBinaryFloats=2,this.numBinaryUInt8=1,this.bytesPerStar=9,this._loadDataController=s.createAbortController(),this._numStars=0,this._modelMatrix=u.mat4f64.create(),this._destroyed=!1,this.view=e,this._loadDataPromise=this._loadBrightStarCatalogue()}return Object.defineProperty(e.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._destroyed=!0,this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null),this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null),this._vao&&(this._vao.dispose(),this._vao=null),this._starsTechnique&&(this._starsTechnique.dispose(),this._starsTechnique=null)},e.prototype.initializeRenderContext=function(e){var t=this;this._initContext=e;var r=e.rctx;this._starsTechnique=new p.StarsTechnique({rctx:r,viewingMode:"local"===this.view.viewingMode?1:0},null),this._dateHandle=l.init(this.view,"environment.lighting.date",(function(e){return t._update(e)})),this._loadDataPromise.then((function(){if(!t._destroyed){t._numStars=t._starData.byteLength/t.bytesPerStar;var n=new Float32Array(t._starData,0,t._numStars*t.numBinaryFloats),i=new Uint8Array(t._starData,t._numStars*t.numBinaryFloats*4,t._numStars*t.numBinaryUInt8);t._vao=t._createVertexArrayObject(r,n,i),e.requestRender()}}))},e.prototype.uninitializeRenderContext=function(){this.destroy()},e.prototype.render=function(e){if(e.slot!==this.slot||0!==e.pass)return!1;var t=e.rctx,r=this._starsTechnique.program;return t.bindProgram(r),this._starsTechnique.bindPass(t,{camera:e.camera,modelMatrix:this._modelMatrix}),this._starsTechnique.bindPipelineState(t),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(0,0,this._numStars),!0},e.prototype._computeDayDuration=function(e){var t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)},e.prototype._update=function(e){if(e){var t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=this._modelMatrix;c.mat4.copy(n,x),c.mat4.rotateZ(n,n,-r*Math.PI),c.mat4.multiply(n,b,n),c.mat4.rotateZ(n,n,-t*Math.PI),this._initContext.requestRender()}},e.prototype._hexToRGB=function(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]},e.prototype._unpackUint8Attributes=function(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]},e.prototype._createVertexArrayObject=function(e,t,r){for(var n=w.createBuffer(this._numStars),i=n.position,o=n.color,a=n.size,s=0;s<this._numStars;s++){var l=t[2*s+0],c=t[2*s+1];i.set(s,0,-Math.cos(l)*Math.sin(c)),i.set(s,1,-Math.sin(l)*Math.sin(c)),i.set(s,2,-Math.cos(c));var u=this._unpackUint8Attributes(r[s]),p=this._hexToRGB(_[u[1]]);o.set(s,0,255*p[0]),o.set(s,1,255*p[1]),o.set(s,2,255*p[2]),o.set(s,3,255),a.set(s,u[0])}return new m(e,f.Default3D,{geometry:d.glLayout(w)},{geometry:v.createVertex(e,35044,n.buffer)})},e.prototype._verifyStartData=function(e){if(!e)throw new o("stars:no-data-received","Failed to create stars because star catalogue is missing");var t=e.byteLength/this.bytesPerStar;if(t%1!=0||t>5e4||t<5e3)throw new o("stars:invalid-data","Failed to create stars because star catalogue data is invalid")},e.prototype._loadBrightStarCatalogue=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o;return r.__generator(this,(function(r){switch(r.label){case 0:return S?(this._starData=S,[2]):[4,i.result(n.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:if(e=r.sent(),this._loadDataController=null,!1===e.ok){if(s.isAbortError(e.error))throw e.error;return y.error("loadBrightStarCatalogue",e.error.message),[2]}t=e.value,o=t.data;try{this._verifyStartData(o)}catch(e){throw y.error("loadBrightStarCatalogue",e),e}return S=o,this._starData=o,[2]}}))}))},e}(),_=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],b=u.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),x=u.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),w=h.newLayout().vec3f("position").vec4u8("color").f32("size"),S=null;return g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(189),r(185),r(1180),r(253),r(257),r(228),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build();return new u(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),c.Default3D)},t.prototype.initializePipeline=function(){return p.makePipelineState({blending:p.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:p.defaultColorWriteParams})},t.prototype.bindPass=function(e,t){var r=t.camera,n=t.modelMatrix,o=this.makeInfiniteProjectionMatrix(r.projectionMatrix,r.near,h);i.mat4.multiply(o,o,r.viewMatrix),i.mat4.multiply(o,o,n),this.program.setUniformMatrix4fv("transform",o),this.program.setUniform4fv("viewport",r.fullViewport),this.program.setUniform1f("pixelRatio",r.pixelRatio)},t.prototype.makeInfiniteProjectionMatrix=function(e,t,r){return i.mat4.copy(r,e),r[10]=24e-8-1,r[11]=-1,r[14]=(24e-8-2)*t,r},t.shader=new s.ReloadableShaderModule(a,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1180)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(l.ShaderTechnique);t.StarsTechnique=d;var h=o.mat4f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(189),r(185),r(162),r(160),r(1630)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},t.computeColorAndIntensity=function(e,n){var i=n[2],l=u;o.vec3.set(l.ambient.color,1,1,1),l.ambient.intensity=t.settings.global.ambient,o.vec3.set(l.diffuse.color,1,1,1),l.diffuse.intensity=t.settings.global.diffuse;var c=(Math.abs(i)-t.settings.local.altitude)/(t.settings.global.altitude-t.settings.local.altitude);c=r.clamp(c,0,1),l.globalFactor=c;var d=s.getTimes(e,n[1],n[0]);if(c<1){var h=function(e,r){var n,i,o=e.valueOf();r.polarException===s.POLAR_EXCEPTION.MIDNIGHT_SUN?i=(n=o-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3)+432e6:r.polarException===s.POLAR_EXCEPTION.POLAR_NIGHT?(n=o-2,i=o-1):(n=r.sunrise.valueOf(),i=r.sunset.valueOf());var l,c,u=i-n,d=n+u/2,h=u/4,f=d-h,v=d+h,m=.06*u,y=n-m/2,g=n+m/2,_=i-m/2,b=i+m/2,x=t.settings.local,w=[.01,x.ambientAtNight],S=[.8,.8,1],P=[.01,.01,.01],T=[x.diffuseAtTwilight,x.ambientAtTwilight],O=[1,.75,.75],C=[.8,.8,1],M=[.9*x.diffuseAtNoon,x.ambientAtNoon],A=[1,.98,.98],E=[.98,.98,1],I=[x.diffuseAtNoon,x.ambientAtNoon],R=[1,1,1],D=[1,1,1],L=M,j=A,V=E,F=T,N=O,k=C,z=[0,0],U=[0,0,0],B=[0,0,0];return o<y||o>b?(z=w,U=P,B=S,c="night"):o<g?(z=p(o-y,l=g-y,w,T),U=p(o-y,l,P,O),B=p(o-y,l,S,C),c="sun rising"):o<f?(z=p(o-g,l=f-g,T,M),U=p(o-g,l,O,A),B=p(o-g,l,C,E),c="early morning"):o<d?(z=p(o-f,l=d-f,M,I),U=p(o-f,l,A,R),B=p(o-f,l,E,D),c="late morning"):o<v?(z=p(o-d,l=v-d,I,L),U=p(o-d,l,R,j),B=p(o-d,l,D,V),c="early afternoon"):o<_?(z=p(o-v,l=_-v,L,F),U=p(o-v,l,j,N),B=p(o-v,l,V,k),c="late afternoon"):o<b&&(z=p(o-_,l=b-_,F,w),U=p(o-_,l,N,P),B=p(o-_,l,k,S),c="sun setting"),{diffuse:{intensity:z[0],color:a.vec3f64.fromValues(U[0],U[1],U[2])},ambient:{intensity:z[1],color:a.vec3f64.fromValues(B[0],B[1],B[2])},timeOfDay:c}}(e,d);o.vec3.lerp(l.ambient.color,h.ambient.color,l.ambient.color,c),l.ambient.intensity=r.lerp(h.ambient.intensity,l.ambient.intensity,c),o.vec3.lerp(l.diffuse.color,h.diffuse.color,l.diffuse.color,c),l.diffuse.intensity=r.lerp(h.diffuse.intensity,l.diffuse.intensity,c)}return l.noonFactor=function(e,t){var n,i,o=e.valueOf();t.polarException===s.POLAR_EXCEPTION.MIDNIGHT_SUN?i=(n=o-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3)+432e6:t.polarException===s.POLAR_EXCEPTION.POLAR_NIGHT?(n=o-2,i=o-1):(n=t.sunrise.valueOf(),i=t.sunset.valueOf());var a=n+(i-n)/2;return 1-r.clamp(Math.abs(o-a)/432e5,0,1)}(e,d),l},t.computeDirection=function(e,i,u,p){p||(p=a.vec3f64.create());var d=c,h=n.mat4.identity(l);if("global"===u)s.getPosition(e,0,0,d),o.vec3.set(p,0,0,-1),n.mat4.rotateX(h,h,-d.azimuth),n.mat4.rotateY(h,h,-d.altitude),o.vec3.transformMat4(p,p,h);else{var f=t.settings.planarDirection,v=f.globalAngles,m=i[2],y=(Math.abs(m)-f.localAltitude)/(f.globalAltitude-f.localAltitude);(y=r.clamp(y,0,1))<1?(s.getPosition(e,i[1],i[0],d),d.azimuth=(1-y)*d.azimuth+y*v.azimuth,d.altitude=(1-y)*d.altitude+y*v.altitude):(d.azimuth=v.azimuth,d.altitude=v.altitude),o.vec3.set(p,0,-1,0),n.mat4.rotateZ(h,h,-d.azimuth),n.mat4.rotateX(h,h,-d.altitude),o.vec3.transformMat4(p,p,h)}return p},t.computeShadowsEnabled=function(e,r){if("global"===r)return!0;var n=t.settings.planarDirection,i=e[2];return Math.abs(i)<n.localAltitude};var l=i.mat4f64.create(),c={azimuth:0,altitude:0},u={ambient:{color:a.vec3f64.create(),intensity:0},diffuse:{color:a.vec3f64.create(),intensity:0,direction:a.vec3f64.create()},globalFactor:0,noonFactor:0};function p(e,t,r,n){for(var i=[],o=0;o<r.length;o++)i[o]=(n[o]-r[o])*e/t+r[o];return i}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(){"use strict";var e=Math.PI,t=Math.sin,r=Math.cos,n=Math.tan,i=Math.asin,o=Math.atan2,a=Math.acos,s=e/180,l={dec:0,ra:0};function c(e){return new Date(864e5*(e+.5-2440588))}function u(e){return function(e){return e.valueOf()/864e5-.5+2440588}(e)-2451545}var p=23.4397*s;function d(e,i){return o(t(e)*r(p)-n(i)*t(p),r(e))}function h(e,n){return i(t(n)*r(p)+r(n)*t(p)*t(e))}function f(e,i,a){return o(t(e),r(e)*t(i)-n(a)*r(i))}function v(e,n,o){return i(t(n)*t(o)+r(n)*r(o)*r(e))}function m(e,t){return s*(280.16+360.9856235*e)-t}function y(e){return s*(357.5291+.98560028*e)}function g(e){return s*(1.9148*t(e)+.02*t(2*e)+3e-4*t(3*e))}function _(t,r){return t+r+102.9372*s+e}function b(e,t){var r=y(e),n=_(r,g(r));return t||(t={dec:0,ra:0}),t.dec=h(n,0),t.ra=d(n,0),t}var x={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,r,n){var i=s*-r,o=s*t,a=u(e),c=b(a,l),p=m(a,i)-c.ra;return n||(n={azimuth:0,altitude:0}),n.azimuth=f(p,o,c.dec),n.altitude=v(p,o,c.dec),n}},w=[[-.83,"sunrise","sunset"]];function S(t,r,n){return 9e-4+(t+r)/(2*e)+n}function P(e,r,n){return 2451545+e+.0053*t(r)-.0069*t(2*n)}function T(e){var n=s*(134.963+13.064993*e),i=s*(93.272+13.22935*e),o=s*(218.316+13.176396*e)+6.289*s*t(n),a=5.128*s*t(i),l=385001-20905*r(n);return{ra:d(o,a),dec:h(o,a),dist:l}}return x.addTime=function(e,t,r){w.push([e,t,r])},x.getTimes=function(n,i,o){var l=s*-o,p=s*i,d=function(t,r){return Math.round(t-9e-4-r/(2*e))}(u(n),l),f=S(0,l,d),v=y(f),m=g(v),b=_(v,m),T=h(b,0),O=P(f,v,b);function C(e){return P(S(function(e,n,i){return a((t(e)-t(n)*t(i))/(r(n)*r(i)))}(e,p,T),l,d),v,b)}var M,A,E,I,R,D,L,j={solarNoon:c(O),nadir:c(O-.5),polarException:x.POLAR_EXCEPTION.NORMAL};for(M=0,A=w.length;M<A;M+=1)R=O-((I=C((E=w[M])[0]*s))-O),j[E[1]]=c(R),j[E[2]]=c(I);return j.polarException=(D=w[0][0]*s,(L=(t(D)-t(p)*t(T))/(r(p)*r(T)))<-1?x.POLAR_EXCEPTION.MIDNIGHT_SUN:L>1?x.POLAR_EXCEPTION.POLAR_NIGHT:x.POLAR_EXCEPTION.NORMAL),j},x.getMoonPosition=function(e,t,r){var i=s*-r,o=s*t,a=u(e),l=T(a),c=m(a,i)-l.ra,p=v(c,o,l.dec);return p+=.017*s/n(p+10.26*s/(p+5.1*s)),{azimuth:f(c,o,l.dec),altitude:p,distance:l.dist}},x.getMoonFraction=function(e){var n=u(e),i=b(n),s=T(n),l=a(t(i.dec)*t(s.dec)+r(i.dec)*r(s.dec)*r(i.ra-s.ra)),c=o(149598e3*t(l),s.dist-149598e3*r(l));return(1+r(c))/2},x}.apply(null,[]))||(e.exports=n)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(1632),r(1643),r(1644),r(1647),r(1650),r(1651),r(1652),r(1659),r(1660),r(1661),r(1662),r(1154),r(637),r(1155),r(1156),r(1157),r(1158),r(793),r(1663)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T){var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new i,t}return r.__extends(t,e),t.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()},Object.defineProperty(t.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._get("mode")},set:function(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode())},enumerable:!0,configurable:!0}),t.prototype.disconnect=function(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)},t.prototype.connect=function(){var e=this,t=this.view;this._source=new g.BrowserEventSource(this.view.surface,t.input);var r=[new w.ImmediateDoubleClick,new S.PointerClickHoldAndDrag,new P.SingleAndDoubleClick,new x.Drag(this.view.navigation),new T.VerticalTwoFingerDrag],n=new _.InputManager({eventSource:this._source,recognizers:r});this._inputManager=n,n.installHandlers("prevent-context-menu",[new b.PreventContextMenu],_.ViewEventPriorities.INTERNAL),this._modeDragPan=new h.PinchAndPanNavigation(t,"primary"),this._modeDragRotate=new l.DragRotate(t,"secondary","center"),this._modeDragZoom=new c.DragZoom(t,"tertiary");n.installHandlers("navigation",[new f.PointerDownCancelAnimation(t),new s.DoubleClickZoom(t),new u.GamepadNavigation(t),new p.KeyboardNavigation(t,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new d.MouseWheelZoom(t),new m.SingleKeyResetTilt(t,"p"),new v.SingleKeyResetHeading(t,"n"),new l.DragRotate(t,"primary","eye",["b"]),new l.DragRotate(t,"secondary","center",["b"]),new h.PinchAndPanNavigation(t,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new y.TwoFingerTilt(t)],_.ViewEventPriorities.INTERNAL),this.view.viewEvents.connect(n),this._updateMode(),o.init(this.view.navigation,"browserTouchPanEnabled",(function(t){e._source.browserTouchPanningEnabled=!t}))},t.prototype._updateMode=function(){var e=this.mode,t=this.primaryDragAction,r=C.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom)},Object.defineProperty(t.prototype,"test",{get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}},enumerable:!0,configurable:!0}),r.__decorate([a.property()],t.prototype,"view",void 0),r.__decorate([a.property({value:"pan"})],t.prototype,"primaryDragAction",null),r.__decorate([a.property({value:"default"})],t.prototype,"mode",null),r.__decorate([a.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],t.prototype,"hasPendingInputs",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],t.prototype,"latestPointerType",void 0),r.__decorate([a.property()],t.prototype,"_inputManager",void 0),r.__decorate([a.subclass("esri.views.3d.input.SceneInputManager")],t)}(n),C=new Map,M=new Map,A=new Map;return M.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),M.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),A.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),A.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),C.set("default",M),C.set("pro",A),O}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(1181),r(1190),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.view=t,n.registerIncoming("double-click",r,(function(e){return n.handleDoubleClick(e)})),n}return r.__extends(t,e),t.prototype.handleDoubleClick=function(e){var t=e.data;if(s.eventMatchesPointerAction(t,"primary")){var r=this.view.state.isGlobal?new i.ZoomStepController({view:this.view,mode:"animation"}):new o.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),n.createScreenPointArray(t.x,t.y)),e.stopPropagation()}},t}(a.InputHandler);t.DoubleClickZoom=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1173),r(1174),r(639),r(412),r(1146),r(1172)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function c(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*u+a*s+i*c-o*l,e[1]=i*u+a*l+o*s-n*c,e[2]=o*u+a*c+n*l-i*s,e[3]=a*u-n*s-i*l-o*c,e}function u(e,t,r,n){var i,a,s,l,c,u=t[0],p=t[1],d=t[2],h=t[3],f=r[0],v=r[1],m=r[2],y=r[3];return(a=u*f+p*v+d*m+h*y)<0&&(a=-a,f=-f,v=-v,m=-m,y=-y),1-a>o.EPSILON?(i=Math.acos(a),s=Math.sin(i),l=Math.sin((1-n)*i)/s,c=Math.sin(n*i)/s):(l=1-n,c=n),e[0]=l*u+c*f,e[1]=l*p+c*v,e[2]=l*d+c*m,e[3]=l*h+c*y,e}function p(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*o+a]-t[3*a+o])*r,e[o]=(t[3*o+i]+t[3*i+o])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=l,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>o.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=c,t.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-n*s,e},t.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-o*s,e[1]=i*l+a*s,e[2]=o*l+n*s,e[3]=a*l-i*s,e},t.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},t.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},t.slerp=u,t.random=function(e){var t=o.RANDOM(),r=o.RANDOM(),n=o.RANDOM(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=o*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=p,t.fromEuler=function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(n),u=Math.cos(n);return e[0]=o*l*u-a*s*c,e[1]=a*s*u+o*l*c,e[2]=a*l*c-o*s*u,e[3]=a*l*u+o*s*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.copy=s.copy,t.set=s.set,t.add=s.add,t.mul=c,t.scale=s.scale,t.dot=s.dot,t.lerp=s.lerp,t.length=s.length,t.len=t.length,t.squaredLength=s.squaredLength,t.sqrLen=t.squaredLength,t.normalize=s.normalize,t.exactEquals=s.exactEquals,t.equals=s.equals,t.rotationTo=function(e,r,n){var i=a.dot(r,n);return i<-.999999?(a.cross(d,h,r),a.len(d)<1e-6&&a.cross(d,f,r),a.normalize(d,d),l(e,d,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(a.cross(d,r,n),e[0]=d[0],e[1]=d[1],e[2]=d[2],e[3]=1+i,t.normalize(e,e))};var d=i.create(),h=i.fromValues(1,0,0),f=i.fromValues(0,1,0);t.sqlerp=function(e,t,r,n,i,o){return u(v,t,i,o),u(m,r,n,o),u(e,v,m,2*o*(1-o)),e};var v=n.create(),m=n.create();t.setAxes=function(e,r,n,i){var o=y;return o[0]=n[0],o[3]=n[1],o[6]=n[2],o[1]=i[0],o[4]=i[1],o[7]=i[2],o[2]=-r[0],o[5]=-r[1],o[8]=-r[2],t.normalize(e,p(e,o))};var y=r.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(162),r(160),r(1635),r(288),r(1636)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n.vec3f64.create(),l=function(){function e(e){this.currentTime=0,this.animation=new a.Animation((function(){return new i.default(e)})),this._current=new i.default(e)}return Object.defineProperty(e.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t,n){var i=this.animation.definition.source,o=this.animation.definition.target,a=r.vec3.subtract(s,t.center,e.center),l=r.vec3.length(a);l>=1e-5?(a[0]/=l,a[1]/=l,a[2]/=l):(a[0]=0,a[1]=1,a[0]=0),r.vec3.copy(i.lookAtDirection,a),r.vec3.copy(o.lookAtDirection,a),i.copyFromRenderCamera(e),o.copyFromRenderCamera(t),this._current.copyFrom(i),this.animation.update(i,o,n),this.currentTime=0,e.almostEquals(t)&&(this.currentTime=this.animation.time)},e.prototype.cameraAt=function(e,t){return this.animation.cameraAt(e,this._current),t=t||new o.default,this._current.copyToRenderCamera(t),t},e.prototype.step=function(e,t){return this.finished||(this.currentTime+=e,this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)},e}();t.Animation=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(272),r(276),r(162),r(160),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=a.vec3f64.create(),c=a.vec3f64.create(),u=a.vec3f64.create(),p=a.vec3f64.create(),d=a.vec3f64.create(),h=a.vec3f64.create(),f={upward:a.vec3f64.fromValues(0,0,1),forward:a.vec3f64.fromValues(0,1,0),sideway:a.vec3f64.fromValues(1,0,0)},v=i.mat3f64.create(),m=function(){function e(e){void 0===e&&(e="global"),this.viewingMode=e,this.center=a.vec3f64.create(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=a.vec3f64.clone(f.forward)}return e.prototype.pixelsPerPanAtZoom=function(e){return this.size/2/(this._zoomToPanScale*e)},e.prototype.zoomAtPixelsPerPan=function(e){return this.size/2/(this._zoomToPanScale*e)},e.prototype.pixelsPerRotateAtZoom=function(){var e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e},e.prototype.compareTo=function(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),"global"===this.viewingMode){var r=(o.vec3.length(this.center)+o.vec3.length(e.center))/2;t.pan=s.angle(this.center,e.center)*r}else t.pan=o.vec3.distance(this.center,e.center);var n=Math.abs(e.yaw-this.yaw);n>=Math.PI&&(n=2*Math.PI-n);var i=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(n,i),t.sourceZoom=this.distance,t.targetZoom=e.distance,t},e.prototype.interpolate=function(e,t,n){"global"===this.viewingMode?s.slerp(e.center,t.center,n.pan,this.center):o.vec3.lerp(this.center,e.center,t.center,n.pan),this.distance=r.lerp(e.distance,t.distance,n.zoom),this.pitch=r.lerp(e.pitch,t.pitch,n.rotate);var i=e.yaw,a=t.yaw;Math.abs(a-i)>=Math.PI&&(i+=2*(i<a?1:-1)*Math.PI),this.yaw=r.lerp(i,a,n.rotate)},e.prototype.copyFrom=function(e){o.vec3.copy(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,o.vec3.copy(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode},e.prototype.copyFromRenderCamera=function(e){var t=this._lookAtOrientation(e.center,v);o.vec3.copy(this.center,e.center),o.vec3.subtract(p,e.center,e.eye),o.vec3.transformMat3(p,p,t),o.vec3.transformMat3(d,e.up,t),this.distance=o.vec3.length(p),p[0]/=this.distance,p[1]/=this.distance,p[2]/=this.distance,this.pitch=this._eyeUpToPitch(p),this.yaw=this._eyeUpToYaw(p,d),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)},e.prototype.copyFromCommon=function(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)},e.prototype.copyToRenderCamera=function(e){var t=this._lookAtOrientation(this.center,v);n.mat3.transpose(t,t),this._axisAngleVec3(f.sideway,this.pitch-Math.PI/2,f.forward,p),this._axisAngleVec3(f.upward,this.yaw,p),this._axisAngleVec3(f.sideway,this.pitch-Math.PI/2,f.upward,d),this._axisAngleVec3(f.upward,this.yaw,d),o.vec3.scale(p,p,this.distance),o.vec3.transformMat3(p,p,t),o.vec3.transformMat3(d,d,t),e.center=this.center,e.eye=o.vec3.subtract(p,this.center,p),e.up=d},e.prototype._axisAngleVec3=function(e,t,r,n){void 0===n&&(n=r);var i=Math.cos(t),a=Math.sin(t);return o.vec3.scale(l,r,i),o.vec3.cross(c,e,r),o.vec3.scale(c,c,a),o.vec3.scale(u,e,(1-i)*o.vec3.dot(e,r)),o.vec3.add(n,o.vec3.add(n,l,c),u)},e.prototype._lookAtOrientation=function(e,t){return this._upAtLookAt(e,u),o.vec3.cross(l,this.lookAtDirection,u),o.vec3.normalize(l,l),0===l[0]&&0===l[1]&&0===l[2]&&o.vec3.copy(l,f.sideway),o.vec3.cross(c,u,l),o.vec3.normalize(c,c),t||(t=i.mat3f64.create()),t[0]=l[0],t[1]=c[0],t[2]=u[0],t[3]=l[1],t[4]=c[1],t[5]=u[1],t[6]=l[2],t[7]=c[2],t[8]=u[2],t},e.prototype._upAtLookAt=function(e,t){return"local"===this.viewingMode?o.vec3.copy(t,f.upward):o.vec3.normalize(t,e)},e.prototype._eyeUpToPitch=function(e){return Math.PI-s.angle(f.upward,e)},e.prototype._eyeUpToYaw=function(e,t){var r=h;return Math.abs(t[2])<.5?(o.vec3.copy(r,t),e[2]>0&&o.vec3.scale(r,r,-1)):o.vec3.copy(r,e),o.vec3.cross(c,r,f.upward),o.vec3.normalize(c,c),s.angle(f.sideway,c,f.upward)},e}();t.default=m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(589),r(1637),r(1188),r(1638)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a={zoom:0,pan:0,rotate:0},s=function(){function e(e){this.createCamera=e,this.time=0,this.definition=new n.Definition(e),this.path=new o.Path}return e.prototype.update=function(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this.time=this._applyTimeSettings(this.path.time,r),this.settings=r},e.prototype.cameraAt=function(e,t){t=t||this.createCamera(),e=Math.min(Math.max(0,e),1),e=this.settings.easing?this.normalizedEasing(this.settings.easing,e):this.time>=1?this.normalizedEasing(r.inOutCoastQuad,e):this.normalizedEasing(r.outExpo,e);var n=this.path.interpolateComponentsAt(e,a);return t.interpolate(this.definition.source,this.definition.target,n),t},e.prototype.normalizedEasing=function(e,t){var r=e(0),n=e(1);return(e(t)-r)/(n-r)},e.prototype._applyTimeSettings=function(e,t){var r=null!=t.speedFactor?t.speedFactor:1;null!=t.duration?e=t.duration:null!=t.speedFactor&&(e/=r);var n=null!=t.minDuration?t.minDuration:i.defaultSettings.minDuration/r,o=null!=t.maxDuration?t.maxDuration:i.defaultSettings.maxDuration/r;return Math.min(Math.max(n,e),o)},e}();t.Animation=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1188)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:r.defaultSettings.desiredScreenFlow},this.source=e(),this.target=e()}return e.prototype.clone=function(){var t=new e(this.createCamera);return t.copyFrom(this),t},e.prototype.copyFrom=function(e){this.update(e.source,e.target,e.settings)},e.prototype.update=function(e,t,n){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=n.desiredScreenFlow?n.desiredScreenFlow:r.defaultSettings.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2},e.prototype.halfWindowPanAtZoom=function(e){var t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t},Object.defineProperty(e.prototype,"hasZoom",{get:function(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPan",{get:function(){return this.compared.pan>1e-9},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRotate",{get:function(){return this.compared.rotate>1e-9},enumerable:!0,configurable:!0}),e}();t.Definition=n,t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(589),r(1639),r(1640),r(1641)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r){var n=e.call(this)||this;return n._preallocSegments=[new o.default,new o.default,new o.default],n.update(t,r),n}return r.__extends(t,e),t.prototype.update=function(e,t){if(e){this.definition?this.definition.copyFrom(e):this.definition=e.clone();var r=null;t&&t.apex&&(r=a.optimalDistance(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==r?this._updateWithoutApex():this._updateWithApex(r,t.apex)}},t.prototype.segmentInterpolateComponentsAt=function(e,t,r){return r=e.interpolateComponentsAt(t,r),e===this._ascensionSegment?r.zoom=n.outQuad(r.zoom):e===this._descensionSegment&&(r.zoom=n.inQuad(r.zoom)),r},t.prototype._updateWithApex=function(e,t){var r=this._preallocSegments,n=r[0],i=r[1],o=r[2],a=null!=t.ascensionFactor?t.ascensionFactor:.5,s=Math.min(1-a,null!=t.ascensionFactor?t.descensionFactor:.5),l=1-a-s;n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._ascensionSegment=n,this.segments.push(n),l>0&&(i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.copyFrom(this.definition),i.definition.compared.sourceZoom=e,i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*l,i.definition.compared.rotate=this.definition.compared.rotate*l,i.update(),this.segments.push(i)),o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.compared.sourceZoom=e,o.definition.compared.pan=this.definition.compared.pan*s,o.definition.compared.rotate=this.definition.compared.rotate*s,o.update(),this._descensionSegment=o,this.segments.push(o)},t.prototype._updateWithoutApex=function(){var e=this._preallocSegments[0];e.update(this.definition),this.segments.push(e)},t}(i.default);t.Path=s,t.default=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.segments=[]}return Object.defineProperty(e.prototype,"time",{get:function(){return this.segments.reduce((function(e,t){return e+t.time}),0)},enumerable:!0,configurable:!0}),e.prototype.interpolateComponentsAt=function(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;for(var r=0,n=0,i=this.definition,o=0;o<this.segments.length;o++){var a=this.segments[o],s=a.definition;if(e<=a.time||o===this.segments.length-1){t=this.segmentInterpolateComponentsAt(a,e/a.time,t),i.hasPan?t.pan=(r+s.compared.pan*t.pan)/i.compared.pan:t.pan=1,i.hasRotate?t.rotate=(n+s.compared.rotate*t.rotate)/i.compared.rotate:t.rotate=1;var l=t.zoom*(s.compared.targetZoom-s.compared.sourceZoom)+s.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,u=this.segments[this.segments.length-1].definition.compared.targetZoom;return i.hasZoom?t.zoom=(l-c)/(u-c):t.zoom=1,t}e-=a.time,r+=s.compared.pan,n+=s.compared.rotate}},e.prototype.segmentInterpolateComponentsAt=function(e,t,r){return e.interpolateComponentsAt(t,r)},e}();t.Path=r,t.default=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){e&&this.update(e)}return e.prototype.update=function(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()},e.prototype._updatePrecomputedVariables=function(){var e=this.definition,t=e.compared,r=t.sourceZoom,n=t.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(r);var i=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=t.rotate*i},e.prototype._updatePixelFlow=function(){var e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,r=this.definition,n=r.hasZoom,i=r.hasPan,o=r.hasRotate,a=0,s=0;n&&(i&&(a=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),o&&(s=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;var l=this.definition.desiredPixelFlow;if(n&&i&&o){var c=a+s+a*s;this._zoomPixelFlow=a*s/c*l,this._panPixelFlow=s/c*l,this._rotatePixelFlow=a/c*l}else if(n&&i)c=1+a,this._zoomPixelFlow=a/c*l,this._panPixelFlow=1/c*l;else if(n&&o)c=1+s,this._zoomPixelFlow=s/c*l,this._rotatePixelFlow=1/c*l;else if(i&&o){var u=this._panPixelsAtSource/this._rotatePixels;c=1+u,this._panPixelFlow=u/c*l,this._rotatePixelFlow=1/c*l}else i?this._panPixelFlow=l:n?this._zoomPixelFlow=l:o&&(this._rotatePixelFlow=l);this.time=o?this.rotateTime:n?this.zoomTime:i?this.panTime:0},Object.defineProperty(e.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0}),e.prototype._interpolateComponentsZoom=function(e){if(0===e||1===e)return e;if(this.definition.hasZoom){var t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(t*Math.pow(t/r,-e)-t)/(r-t)}return e},e.prototype._interpolateComponentsPan=function(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){var t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(Math.pow(2,t*e*this.time)-1))/(t*Math.LN2)}return e},e.prototype._interpolateComponentsRotate=function(e){return e},e.prototype.interpolateComponentsAt=function(e,t){e=Math.min(Math.max(e,0),1);var r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),i=this._interpolateComponentsRotate(e);return t?(t.zoom=r,t.pan=n,t.rotate=i):t={zoom:r,pan:n,rotate:i},t},e}();t.Segment=r,t.default=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1642)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.optimalDistance=function(e,t){var n,i=function(e,t){var r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),n=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return n<r?null!=t.maximumDistance?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,n):n}(e,t),o={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},a=0===o.ascensionFactor,s=0===o.descensionFactor,l=a?r.tAscensionZoomOnly:r.tAscensionZoomPan,c=a?r.dtAscensionZoomOnly:r.dtAscensionZoomPan,u=a?r.ddtAscensionZoomOnly:r.ddtAscensionZoomPan,p=s?r.tDescensionZoomOnly:r.tDescensionZoomPan,d=s?r.dtDescensionZoomOnly:r.dtDescensionZoomPan,h=s?r.ddtDescensionZoomOnly:r.ddtDescensionZoomPan,f=function(t){return l(e,t,o)+r.tPanion(e,t,o)+p(e,t,o)},v=function(t){return c(e,t,o)+r.dtPanion(e,t,o)+d(e,t,o)},m=function(t){return u(e,t,o)+r.ddtPanion(e,t,o)+h(e,t,o)},y=f(i),g=r.tBaseLine(e),_=t.maximumIterations||20,b=null!=t.maximumDistance?t.maximumDistance:1/0;for(n=0;n<_;n++){var x=(v(i)+1e-6)/m(i);if(isNaN(x)||i>=b&&x<0){if(!isFinite(b))return null;y=f(i=b);break}if((i-=x)<e.compared.sourceZoom||i<e.compared.targetZoom)return null;var w=f(i);if(Math.abs(w-y)/y<=.005)break;y=w}return y>.7*g||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tAscensionZoomPan=function(e,t,r){var n=t-e.compared.sourceZoom,i=e.halfWindowPanAtZoom(n);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+i)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*i)},t.dtAscensionZoomPan=function(e,t,r){var n=1/t,i=Math.log(e.compared.sourceZoom*n),o=1/e.desiredPixelFlow,a=1/Math.LN2,s=t-e.compared.sourceZoom,l=1/s,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(s))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*o*a*l*c-e.halfWindowSize*i*o*a*l+e.halfWindowSize*i*o*a*c/(s*s)},t.ddtAscensionZoomPan=function(e,t,r){var n=t-e.compared.sourceZoom,i=1/n,o=1/t,a=Math.log(e.compared.sourceZoom*o),s=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(n))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*(-2*i*o*s+2*i*a+2*o-2*a*s/(n*n)-s/(t*t))/(e.desiredPixelFlow*Math.LN2)},t.tAscensionZoomOnly=function(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)},t.dtAscensionZoomOnly=function(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)},t.ddtAscensionZoomOnly=function(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)},t.tPanion=function(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))},t.dtPanion=function(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))},t.ddtPanion=function(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))},t.tDescensionZoomPan=function(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))},t.dtDescensionZoomPan=function(e,t,r){var n=Math.log(t/e.compared.targetZoom),i=1/e.desiredPixelFlow,o=1/Math.LN2,a=-t+e.compared.targetZoom,s=1/a,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*n*i*o*s+e.halfWindowSize*n*i*o*l/(a*a)+e.halfWindowSize*i*o*s*l/t},t.ddtDescensionZoomPan=function(e,t,r){var n=t-e.compared.targetZoom,i=1/n,o=1/t,a=Math.log(t/e.compared.targetZoom),s=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*(-2*i*o*s-2*i*a+2*o+2*a*s/(n*n)-s/(t*t))/(e.desiredPixelFlow*Math.LN2)},t.tDescensionZoomOnly=function(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)},t.dtDescensionZoomOnly=function(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)},t.ddtDescensionZoomOnly=function(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)},t.tBaseLine=function(e){var t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,n=e.halfWindowPanAtZoom(r),i=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*n);return e.compared.sourceZoom<=e.compared.targetZoom?i*(t-n):i*(t+n)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(1191),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,n,i){var o=e.call(this,!0)||this;return o.view=t,o.pointerAction=r,o.pivotPoint=n,o.registerIncoming("drag",i,(function(e){return o.handleDrag(e)})),o}return r.__extends(t,e),t.prototype.handleDrag=function(e){var t=e.data;if(!(t.pointers.size>1)&&a.eventMatchesMousePointerAction(e.data,this.pointerAction)){var r=n.createScreenPointArray(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new i.RotateController({view:this.view,pivot:this.pivotPoint}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}},t}(o.InputHandler);t.DragRotate=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(1645),r(1646),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,r,n){var i=e.call(this,!0)||this;return i.view=t,i.pointerAction=r,i.registerIncoming("drag",n,(function(e){return i.handleDrag(e)})),i}return r.__extends(t,e),t.prototype.handleDrag=function(e){var t=e.data;if(!(t.pointers.size>1)&&s.eventMatchesMousePointerAction(e.data,this.pointerAction)){var r=n.createScreenPointArray(t.center.x,t.center.y);switch(t.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new i.ZoomController({view:this.view}):this.cameraController=new o.ZoomController({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}},t}(a.InputHandler);t.DragZoom=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(151),r(205),r(216),r(162),r(160),r(342),r(590),r(343),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.pickPoint=l.vec3f64.create(),r.tmpP0=a.vec2f64.create(),r.panAxisAngle=d.axisAngle.create(),r.tmpRayDir=l.vec3f64.create(),r.targetOnSphere=l.vec3f64.create(),r.dragBeginPoint=n.createScreenPointArray(),r.normalizedAnchorPoint=a.vec2f64.create(),r.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},r.sphere=d.sphere.create(),r.hasPickPoint=!1,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.begin=function(e){if(this.active){o.vec2.copy(this.dragBeginPoint,e),p.normalizeCoordinate(this.beginCamera,e,this.normalizedAnchorPoint);var t=p.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,e,!1);this.hasPickPoint=!!t.scenePickPoint,this.pickPoint=t.scenePickPoint,this.sphere=t.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera}},t.prototype.update=function(e){if(this.active){this.currentCamera.eye=this.beginCamera.eye,this.currentCamera.center=this.beginCamera.center,this.currentCamera.up=this.beginCamera.up,s.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var t=s.vec3.length(this.tmpRayDir);p.normalizeCoordinate(this.currentCamera,e,this.tmpP0);var r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),n=t*Math.pow(2,r),i=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<i&&(n=i),!(Math.abs(t-n)<1e-6)){if(this.hasPickPoint&&n<t){var o=1-(1-n/t)*(1-this.sphere.radius/s.vec3.length(this.currentCamera.center));s.vec3.scale(this.currentCamera.center,this.currentCamera.center,o)}s.vec3.scale(this.tmpRayDir,this.tmpRayDir,-n/t),s.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.dragBeginPoint,e),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(p.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),d.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),p.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),c.applySurfaceCollisionConstraint(this.view,this.currentCamera)}}},t.prototype.end=function(){this.active&&this.finishController()},r.__decorate([i.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([i.subclass("esri.views.3d.state.controllers.global.ZoomController")],t)}(u.InteractiveController);t.ZoomController=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(171),r(151),r(205),r(216),r(162),r(160),r(342),r(590),r(343),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.tmpP=c.vec3f64.create(),r.tmpN=c.vec3f64.create(),r.tmpP0=s.vec2f64.create(),r.tmpPoi=c.vec3f64.create(),r.tmpRayDir=c.vec3f64.create(),r.dragBeginPoint=i.createScreenPointArray(),r.normalizedAnchorPoint=s.vec2f64.create(),r.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:c.vec3f64.create(),tiltMode:0},r.plane=h.plane.create(),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.begin=function(e){this.active&&(a.vec2.copy(this.dragBeginPoint,e),d.normalizeCoordinate(this.beginCamera,e,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP),l.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),l.vec3.normalize(this.tmpN,this.tmpN),this.tmpN[1]<0&&l.vec3.negate(this.tmpN,this.tmpN),h.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.beginCamera)},t.prototype.update=function(e){if(this.active){d.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l.vec3.copy(this.tmpPoi,this.currentCamera.center),d.normalizeCoordinate(this.currentCamera,e,this.tmpP0);var t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a.vec2.copy(this.normalizedAnchorPoint,this.tmpP0),l.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var r=l.vec3.length(this.tmpRayDir),i=r*(1-t);l.vec3.copy(this.constraintOptions.interactionDirection,this.tmpRayDir),l.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,n.sign(t)/r);var o=this.view.state.constraints.minimumPoiDistance;t>=0&&i<o&&(t=-((i=o)-r)/r),Math.abs(r-i)<1e-6||(l.vec3.scale(this.tmpRayDir,this.tmpRayDir,t),l.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),l.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.beginCamera.center[2]?this.currentCamera.center[2]=Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):this.currentCamera.center[2]=Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(this.dragBeginPoint,e),u.applyAll(this.view,this.currentCamera,this.constraintOptions))}},t.prototype.end=function(){this.active&&this.finishController()},r.__decorate([o.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.views.3d.state.controllers.local.ZoomController")],t)}(p.InteractiveController);t.ZoomController=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(167),r(157),r(1192),r(241)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this,!0)||this;return r.view=t,r.watchHandles=new n,r.handle=r.registerIncoming("gamepad",(function(e){return r.handleEventGamepad(e)})),r.handle.pause(),r}return r.__extends(t,e),t.prototype.onInstall=function(t){var r=this;e.prototype.onInstall.call(this,t),this.watchHandles.add([i.init(this.view.navigation.gamepad,"enabled",(function(e){e?r.handle.resume():(r.handle.pause(),r.cameraControllerGamepad&&(r.cameraControllerGamepad.finishController(),r.cameraControllerGamepad=null))})),this.view.navigation.gamepad.watch("device",(function(e){r.cameraControllerGamepad&&e&&r.cameraControllerGamepad.gamepadDevice!==e&&(r.cameraControllerGamepad.finishController(),r.cameraControllerGamepad=null)}))])},t.prototype.onUninstall=function(){this.watchHandles.removeAll(),e.prototype.onUninstall.call(this)},t.prototype.handleEventGamepad=function(e){var t=this.view.navigation.gamepad.device;if(!t||e.data.device===t){var r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||o.GamepadKeyboardController.activatesFor(this.view,e.data)){if(!r){var n=new o.GamepadKeyboardController({view:this.view,gamepadDevice:e.data.device});this.view.state.switchCameraController(n)&&(this.cameraControllerGamepad=n)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===e.data.device&&this.cameraControllerGamepad.handleEventGamepad(e.data)}}},t}(a.InputHandler);t.GamepadNavigation=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(189),r(185),r(162),r(160),r(184),r(926),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=a.vec3f64.fromValues(0,1,0),p=a.vec3f64.fromValues(0,0,1),d=i.mat4f64.create(),h=a.vec3f64.create(),f=a.vec3f64.create();function v(e,t,i,a){void 0===a&&(a=l.createDirectionUp()),n.mat4.identity(d);var s=a.direction,c=a.up;return n.mat4.rotateZ(d,d,-r.deg2rad(t)),n.mat4.rotateX(d,d,r.deg2rad(i)),o.vec3.transformMat4(s,p,d),o.vec3.scale(s,s,-1),o.vec3.transformMat4(c,u,d),a}t.headingTiltToDirectionUp=v,t.directionToHeadingTilt=function(e,t,r,n){return l.directionToHeadingTilt(t,r,n,p,u)},t.eyeForCenterWithHeadingTilt=function(e,t,r,n){var i=v(0,r,n),s=a.vec3f64.create();return o.vec3.scale(s,i.direction,-t),o.vec3.add(s,s,e),{up:i.up,eye:s,heading:r,tilt:n}},t.lookAtTiltToEyeTilt=function(e){return r.rad2deg(e)},t.eyeTiltToLookAtTilt=function(e){return r.deg2rad(e)},t.toExtent=function(e,t,r,n,i){var o=e.renderSpatialReference,a=e.map&&e.spatialReference||t.spatialReference;return c.pointToVector(t,h,o),c.pointToVector(t,f,o),h[0]-=r/2,f[0]+=r/2,h[1]-=n/2,f[1]+=n/2,c.vectorToVector(h,o,h,a),c.vectorToVector(f,o,f,a),i?(i.xmin=h[0],i.ymin=h[1],i.xmax=f[0],i.ymax=f[1],i.spatialReference=a):i=new s(h[0],h[1],f[0],f[1],a),i}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(189),r(185),r(162),r(160),r(184),r(170),r(197),r(926),r(238),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=a.vec3f64.fromValues(0,0,1),f=o.vec3.normalize(a.vec3f64.create(),a.vec3f64.fromValues(1,1,1)),v=new d.Cyclical(-180,180),m=i.mat4f64.create(),y=a.vec3f64.create(),g=a.vec3f64.create();function _(e,t,i,a){void 0===a&&(a=u.createDirectionUp()),o.vec3.cross(y,e,h),0===o.vec3.dot(y,y)&&o.vec3.cross(y,e,f),n.mat4.identity(m),n.mat4.rotate(m,m,-r.deg2rad(t),e),n.mat4.rotate(m,m,-r.deg2rad(i),y);var s=a.up,l=a.direction;return o.vec3.cross(s,y,e),o.vec3.normalize(s,s),o.vec3.transformMat4(s,s,m),o.vec3.normalize(l,e),o.vec3.negate(l,l),o.vec3.transformMat4(l,l,m),a}function b(e){var t=e[1];e[1]=-e[2],e[2]=t}function x(e,t){var r=_(t,e.heading,e.tilt);return e.up=r.up,e}t.headingTiltToDirectionUp=_,t.directionToHeadingTilt=function(e,t,r,n){var i=y,a=g;return o.vec3.normalize(i,e),o.vec3.cross(g,i,h),0===o.vec3.dot(g,g)&&o.vec3.cross(g,i,f),o.vec3.cross(a,g,i),u.directionToHeadingTilt(t,r,n,i,a)},t.eyeForCenterWithHeadingTilt=function(e,t,n,i){var s={eye:a.vec3f64.create(),up:null,tilt:i,heading:n},l=y;l[0]=e[0],l[1]=e[2],l[2]=-e[1];var c,u=t,p=r.deg2rad(n),d=r.deg2rad(i),h=Math.sin(p),f=Math.cos(p),v=Math.sin(d),m=Math.cos(d),g=o.vec3.length(l);if(Math.abs(d)<1e-8)c=u+g;else{var _=g/v,w=r.asinClamped(u/_),S=Math.PI-d-w;c=_*Math.sin(S)}var P=m*u,T=u*u*(v*v),O=f*f*T,C=c-P,M=C*C,A=O*(O+M-l[1]*l[1]);if(A<0)return o.vec3.scale(s.eye,l,c/g),s.tilt=0,s;var E,I=Math.sqrt(A),R=l[1]*C,D=O+M;if(E=f>0?-I+R:I+R,Math.abs(D)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=u):o.vec3.scale(s.eye,l,c/g),s.tilt=0,b(s.eye),x(s,e);s.eye[1]=E/D;var L=h*h*T,j=v*u,V=f*j*s.eye[1],F=s.eye[1]*s.eye[1],N=1-F,k=Math.sqrt(N),z=O*F+L-2*V*k*C+N*M;return Math.abs(z)<1e-8?(o.vec3.scale(s.eye,l,c/g),s.tilt=0,b(s.eye),x(s,e)):(s.eye[0]=(N*(c*l[0]-P*l[0])-j*k*(l[0]*s.eye[1]*f+l[2]*h))/z,s.eye[2]=(N*(c*l[2]-P*l[2])-j*k*(l[2]*s.eye[1]*f-l[0]*h))/z,o.vec3.scale(s.eye,s.eye,c),b(s.eye),x(s,e))},t.lookAtTiltToEyeTilt=function(e,t,n){var i=o.vec3.length(t),a=Math.sqrt(n*n+i*i-2*n*i*Math.cos(Math.PI-e)),s=r.asinClamped(n/(a/Math.sin(e)));return r.rad2deg(e-s)},t.eyeTiltToLookAtTilt=function(e,t,n){var i=r.deg2rad(e),a=o.vec3.length(t);return r.asinClamped(n/(a/Math.sin(i)))+i},t.toExtent=function(e,t,n,i,o){var a,u,h,f,m=t.latitude,y=t.longitude,g=p.getLonDeltaForDistance(m,n)/2;a=y-g,u=y+g;var _=r.deg2rad(m),b=p.earthRadius,x=(1+Math.sin(_))/(1-Math.sin(_)),w=(x+1)*Math.tan(i/b/2),S=w*w;function P(e){var t=Math.PI/2;return(e=d.cyclical2PI.normalize(e,-t))>t&&(e=Math.PI-e),e}if(f=(h=1.5*Math.PI-2*Math.atan(.5*(w+Math.sqrt(4*x+S))))+i/b,h=P(h),(f=P(f))<h){var T=f;f=h,h=T}if(h=Math.max(r.rad2deg(h),-90),f=Math.min(r.rad2deg(f),90),(u=v.monotonic(a,u))-a>180){var O=(u-a-180)/2;a+=O,u-=O}var C=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:l.WGS84;return o?(o.xmin=a,o.ymin=h,o.xmax=u,o.ymax=f,o.spatialReference=C):o=new s(a,h,u,f,C),e.spatialReference&&e.spatialReference.isWebMercator&&c.geographicToWebMercator(o,!1,o),o}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1192),r(241)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n,i=e.call(this,!0)||this;return i.view=t,i.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:"local"},i.keyToNumber=((n={})[r.left]=0,n[r.right]=1,n[r.forward]=2,n[r.backward]=3,n[r.up]=4,n[r.down]=5,n[r.headingLeft]=6,n[r.headingRight]=7,n[r.tiltUp]=8,n[r.tiltDown]=9,n[r.zoomIn]=10,n[r.zoomOut]=11,n),i.registerIncoming("key-down",null,(function(e){return i.handleKeyDown(e)})),i.registerIncoming("key-up",null,(function(e){return i.handleKeyUp(e)})),i.registerIncoming("blur",null,(function(){return i.handleBlur()})),i}return r.__extends(t,e),t.prototype.handleKeyDown=function(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var t=this.keyToNumber[e.data.key];null!=t&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new n.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}},t.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)},t.prototype.handleKeyUp=function(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var t=this.keyToNumber[e.data.key];null!=t&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}},t}(i.InputHandler);t.KeyboardNavigation=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(1181),r(1190),r(241)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.view=t,n.registerIncoming("mouse-wheel",r,(function(e){return n.handleMouseWheel(e)})),n}return r.__extends(t,e),t.prototype.handleMouseWheel=function(e){if(this.view.navigation.mouseWheelZoomEnabled){var t=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new i.ZoomStepController({view:this.view,mode:"interaction"}):new o.ZoomStepController({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*t.deltaY,n.createScreenPointArray(t.x,t.y)),e.preventDefault(),e.stopPropagation()}},t}(a.InputHandler);t.MouseWheelZoom=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1653),r(1658),r(241),r(531)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,n){var i=e.call(this,!0)||this;return i.view=t,i.pointerAction=r,i.lastEndTimestamp=0,i.lastTimestamp=0,i.registerIncoming("drag",n,(function(e){return i.handleDrag(e)})),i}return r.__extends(t,e),t.prototype.handleDrag=function(e){if("mouse"!==e.data.pointerType||a.eventMatchesMousePointerAction(e.data,this.pointerAction)){var t=e.timestamp-this.lastEndTimestamp,r=this.momentum&&this.momentum.active&&t<40;switch(e.data.action){case"start":case"update":if(r)break;this.controller&&this.controller.active?e.data.timestamp-this.lastTimestamp>2&&(this.controller.update(e.data),this.lastTimestamp=e.timestamp):this.startController(e);break;case"end":case"removed":this.endController(e,!0);break;case"added":this.endController(e,!1),this.startController(e)}e.stopPropagation()}},t.prototype.endController=function(e,t){if(this.controller&&this.controller.active){this.lastEndTimestamp=e.timestamp;var r=this.controller.end(e.data);t&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null},t.prototype.startController=function(e){this.controller=this.createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(e.data),this.lastTimestamp=e.timestamp},t.prototype.createController=function(){return this.view.state.isGlobal?new n.PinchAndPanController({view:this.view}):new i.PinchAndPanController({view:this.view})},t}(o.InputHandler);t.PinchAndPanNavigation=s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(171),r(151),r(189),r(185),r(205),r(162),r(160),r(342),r(1194),r(590),r(1195),r(1654),r(1196),r(1197),r(1655),r(343),r(343),r(203),r(251),r(288),r(927),r(1656),r(929),r(930)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.smoothRotation=new d.ExponentialFalloff(.05),r.rotationAxis=u.vec3f64.create(),r.panningPlane=x.plane.create(),r.smoothScaling=new d.ExponentialFalloff(.05),r.zoomCenterScreen=i.createScreenPointArray(),r.zoomMomentumEstimator=new C.ZoomMomentumEstimator,r.rotationMomentumEstimator=new O.RotationMomentumEstimator,r.panSphericalMomentumEstimator=new T.PanSphericalMomentumEstimator,r.panPlanarMomentumEstimator=new P.PanPlanarMomentumEstimator,r.adjustedSphere=x.sphere.create(),r.tmp3d=u.vec3f64.create(),r.tmpMat=s.mat4f64.create(),r.tmpAxisAngle=x.axisAngle.create(),r.tmpScreenPointArray=i.createScreenPointArray(),r.beginScreenPoint=i.createScreenPointArray(),r.beginScenePoint=u.vec3f64.create(),r.screenPickPoint=i.createScreenPointArray(),r.panMode=b.PanMode.Horizontal,r.tmpInteractionDirection=u.vec3f64.create(),r.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new S.default,interactionDirection:null,tiltMode:0},r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.begin=function(e){if(this.active){var t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-w.cyclicalPI.normalize(n.deg2rad(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),i.screenPointObjectToArray(e.center,this.screenPickPoint),l.vec2.copy(this.beginScreenPoint,this.screenPickPoint);var r=_.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,c.vec3.copy(this.beginScenePoint,this.scenePickPoint),this.panMode=_.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint),this.panMode===b.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(e):this.preparePlanarPanMode(e)),this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}},t.prototype.preparePlanarPanModeOverground=function(e){var t=c.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,t,this.panningPlane);var r=i.createScreenPointArray(this.screenPickPoint[0],0),n=u.vec3f64.create(),o=c.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=o<this.sphere.radius?o-100:this.sphere.radius,_.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,r,n);var a=i.createRenderScreenPointArray3();this.beginCamera.projectPoint(n,a);var s=.9*a[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],s),this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&x.plane.fromPositionAndNormal(this.scenePickPoint,x.plane.normal(this.panningPlane),this.panningPlane);var l=i.screenPointObjectToArray(e.center,this.tmpScreenPointArray);_.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,l,this.beginScenePoint)},t.prototype.preparePlanarPanMode=function(e){var t=c.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,t,this.panningPlane);var r=x.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),n=x.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),o=this.currentCamera.aboveGround?.25:.025,s=-n[3]-o*r;if(s>0){var l=a.mat4.identity(this.tmpMat);a.mat4.rotate(l,l,-s,n),c.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center),c.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,l),c.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center),x.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);var u=i.screenPointObjectToArray(e.center,this.tmpScreenPointArray);_.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,u,this.beginScenePoint)}},t.prototype.update=function(e){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var t=e.pointers.size>1;this.panMode===b.PanMode.Horizontal?(t&&this.zoomSpherical(e),this.panningSpherical(e),t&&this.rotateSpherical(e)):(t&&this.zoomPlanar(e),this.panningPlanar(e),t&&this.rotatePlanar(e)),this.currentCamera.markViewDirty()}},t.prototype.end=function(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();var t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.panMode===b.PanMode.Horizontal?new g.ZoomSphericalMomentumController({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere.radius}):new y.ZoomPlanarMomentumController({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});var r,n=this.rotationMomentumEstimator.evaluateMomentum();if(n)return new m.RotationMomentumController({view:this.view,momentum:n,center:this.sphere.center,axis:this.rotationAxis});if(this.panMode===b.PanMode.Horizontal){if(r=this.panSphericalMomentumEstimator.evaluateMomentum())return new v.PanSphericalMomentumController({view:this.view,momentum:r})}else if(r=this.panPlanarMomentumEstimator.evaluateMomentum())return new f.PanPlanarMomentumController({view:this.view,momentum:r});return null},t.prototype.zoomSpherical=function(e){var t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),_.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value),i.screenPointObjectToArray(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(e.radius-this.beginRadius),p.applyAll(this.view,this.currentCamera,this.constraintOptions)},t.prototype.panningSpherical=function(e){var t=i.screenPointObjectToArray(e.center,this.tmpScreenPointArray);_.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,t,this.tmp3d),_.preserveHeadingThreshold(this.beginScenePoint,c.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(_.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(_.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt)),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(this.screenPickPoint,t),p.applyAll(this.view,this.currentCamera,this.constraintOptions)},t.prototype.rotateSpherical=function(e){c.vec3.normalize(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||c.vec3.negate(this.rotationAxis,this.rotationAxis);var t=this.smoothRotation.value,r=t+_.normalizeRotationDelta(e.angle-t),n=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(r);var i=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(i,.001*e.timestamp),_.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,i)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(e.radius*r),p.applyAll(this.view,this.currentCamera,this.constraintOptions)},t.prototype.panningPlanar=function(e){var t=i.screenPointObjectToArray(e.center,this.tmpScreenPointArray);_.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(_.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),p.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)},t.prototype.zoomPlanar=function(e){var t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),_.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(e.radius-this.beginRadius),p.applyAll(this.view,this.currentCamera,this.constraintOptions)},t.prototype.rotatePlanar=function(e){c.vec3.copy(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||c.vec3.negate(this.rotationAxis,this.rotationAxis);var t=this.smoothRotation.value,r=e.angle-t,n=t+(r=_.normalizeRotationDelta(r)),i=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=i,this.smoothRotation.update(n);var o=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(o,.001*e.timestamp),_.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,o)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(e.radius*o),p.applyAll(this.view,this.currentCamera,this.constraintOptions)},r.__decorate([o.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],t)}(h.InteractiveController);t.PinchAndPanController=M}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(162),r(160),r(650),r(343)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=o.vec3f64.create(),c=o.vec3f64.create(),u=function(e){function t(t){var r=e.call(this,t)||this;return r.interactionType=4,r}return r.__extends(t,e),t.prototype.momentumStep=function(e,t){var r=this.momentum.value1(e),n=this.momentum.value2(e);i.vec3.copy(c,t.eye),i.vec3.normalize(c,c),i.vec3.cross(this.momentum.axis2,c,this.momentum.axis1),s.applyRotationWithTwoAxes(t,l,this.momentum.axis1,r,this.momentum.axis2,n)},r.__decorate([n.property({constructOnly:!0})],t.prototype,"momentum",void 0),r.__decorate([n.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],t)}(a.MomentumController);t.PanSphericalMomentumController=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(151),r(160),r(342),r(650),r(343),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var r=e.call(this,t)||this;return r.interactionType=1,r.radius=0,r.tmpSceneCenter=o.vec3f64.create(),r.tmpZoomAxisAngle=c.axisAngle.create(),r.sphere=c.sphere.create(),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"screenCenter",{set:function(e){this._set("screenCenter",n.createScreenPointArray(e[0],e[1]))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sceneCenter",{set:function(e){this._set("sceneCenter",o.vec3f64.clone(e))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.sphere.radius=this.radius},t.prototype.momentumStep=function(e,t){var r=this.momentum.valueDelta(0,e);l.applyZoomOnSphere(this.sphere,t,r),this.constraintOptions.interactionType=1,a.applyAll(this.view,t,this.constraintOptions),l.sphereOrPlanePointFromScreenPoint(this.sphere,t,this.screenCenter,this.tmpSceneCenter),c.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),l.applyRotation(t,this.sphere.center,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=4},r.__decorate([i.property({constructOnly:!0})],t.prototype,"momentum",void 0),r.__decorate([i.property({constructOnly:!0})],t.prototype,"screenCenter",null),r.__decorate([i.property({constructOnly:!0})],t.prototype,"sceneCenter",null),r.__decorate([i.property({constructOnly:!0})],t.prototype,"radius",void 0),r.__decorate([i.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],t)}(s.MomentumController);t.ZoomSphericalMomentumController=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(216),r(162),r(160),r(343),r(928),r(1657),r(800)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r,n,i,o,a,s){void 0===a&&(a=0);var l=e.call(this,t,r,n)||this;return l.angularVelocity1=i,l.axis1=o,l.angularVelocity2=a,l.axis2=s,l}return r.__extends(t,e),t.prototype.value1=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,t)},t.prototype.value2=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,t)},t}(c.Momentum);t.PanSphericalMomentum=u;var p=function(){function e(e,t,r){void 0===e&&(e=300),void 0===t&&(t=12),void 0===r&&(r=.84),this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=r,this.enabled=!0,this.tmpAxis1=o.vec3f64.create(),this.tmpAxis2=o.vec3f64.create(),this.tmpAngles=n.vec2f64.create(),this.time=new s.FilteredFiniteDifference(.3),this.screen=[new s.FilteredFiniteDifference(.4),new s.FilteredFiniteDifference(.4)],this.angle1=new l.FilteredValue(.6),this.angle2=new l.FilteredValue(.6),this.axis1=o.vec3f64.create(),this.axis2=o.vec3f64.create(),this.lastScene=o.vec3f64.create()}return e.prototype.addMomentumDirectRotation=function(e,t,r,n,o,s){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;var l=a.rotationAngleAndAxisDirectRotation(this.lastScene,t,this.tmpAxis2,n,o,s);this.angle2.update(0),i.vec3.squaredLength(this.tmpAxis2)<1e-5?l=0:i.vec3.normalize(this.axis1,this.tmpAxis2),this.angle1.update(l),i.vec3.copy(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(r)}},e.prototype.addMomentumPreserveHeading=function(e,t,r,n,o,s,l){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;a.rotationAnglesAndAxesHeadingPreserving(this.lastScene,t,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,n,o,s,l,!1),i.vec3.squaredLength(this.tmpAxis2)<1e-5?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),i.vec3.normalize(this.axis1,this.tmpAxis1),i.vec3.normalize(this.axis2,this.tmpAxis2)),i.vec3.copy(this.lastScene,t)}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.time.update(r)}},e.prototype.reset=function(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()},e.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,r=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)},e.prototype.createMomentum=function(e,t,r){var n=this.angle1.filteredValue/this.time.filteredDelta,i=this.angle2.filteredValue/this.time.filteredDelta;return new u(e,t,r,n,this.axis1,i,this.axis2)},e}();t.PanSphericalMomentumEstimator=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.gain=e}return e.prototype.update=function(e){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*e:this.filteredValue=e},e.prototype.reset=function(){this.filteredValue=void 0},Object.defineProperty(e.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0}),e}();t.FilteredValue=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(171),r(151),r(162),r(160),r(342),r(1194),r(590),r(1195),r(1196),r(1197),r(343),r(203),r(288),r(927),r(929),r(930)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){var b;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(b=t.PanMode||(t.PanMode={}));var x=s.vec3f64.fromValues(0,0,1),w=16/180*Math.PI,S=function(e){function t(t){var r=e.call(this,t)||this;return r.view=null,r.rotationValueSmooth=new c.ExponentialFalloff(.05),r.scalingValueSmooth=new c.ExponentialFalloff(.05),r.planeHorizontal=v.plane.create(),r.planeVertical=v.plane.create(),r.rotationMomentumEstimator=new g.RotationMomentumEstimator,r.panMomentumEstimator=new y.PanPlanarMomentumEstimator(300,12,.9),r.zoomMomentumEstimator=new _.ZoomMomentumEstimator,r.beginCenter=s.vec3f64.create(),r.tmpPoints=[],r.beginCenterScreen=i.createScreenPointArray(),r.tmpCentroid3d=s.vec3f64.create(),r.tmpCentroid2d=i.createScreenPointArray(),r.tmp2d=i.createScreenPointArray(),r.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new m.default,interactionDirection:null,tiltMode:0},r}return r.__extends(t,e),Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0}),t.prototype.begin=function(e){if(this.active){var t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),i.screenPointObjectToArray(e.center,this.beginCenterScreen),v.plane.fromNormalAndOffset(x,0,this.planeHorizontal);var r=s.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,r);var o=s.vec3f64.create();a.vec3.negate(o,this.beginCamera.viewForward);var l=s.vec3f64.create();a.vec3.copy(l,x);var c=a.vec3.dot(o,l),u=c<0,p=n.asinClamped(u?-c:c);this.panMode=p>=w?b.Horizontal:b.Vertical,v.plane.setOffsetFromPoint(this.planeHorizontal,r,this.planeHorizontal),this.beginCamera.aboveGround||v.plane.negate(this.planeHorizontal,this.planeHorizontal),this.panMode===b.Vertical?(a.vec3.scale(l,l,c),a.vec3.subtract(this.planeVertical,o,l),a.vec3.normalize(this.planeVertical,this.planeVertical),v.plane.setOffsetFromPoint(this.planeVertical,r,this.planeVertical),this.computePlanePoints(e.pointers,this.planeVertical,this.beginCamera,this.tmpPoints),f.centroid(this.tmpPoints,this.beginCenter)):(this.computePlanePoints(e.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints),f.centroid(this.tmpPoints,this.beginCenter)),this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}},t.prototype.update=function(e){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var t=e.pointers.size>1,r=this.panMode===b.Horizontal?this.planeHorizontal:this.planeVertical,n=this.beginCenter;if(t){var o=this.beginRadius/e.radius,a=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=a,this.scalingValueSmooth.update(o),f.applyZoomToPoint(this.currentCamera,n,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=1,this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(e.radius-this.beginRadius)),l.applyAll(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,r,this.currentCamera,this.tmpPoints),f.centroid(this.tmpPoints,this.tmpCentroid3d),i.screenPointObjectToArray(e.center,this.tmpCentroid2d),f.applyPanPlanar(this.currentCamera,n,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d),l.applyAll(this.view,this.currentCamera,this.constraintOptions),t){var s=this.planeHorizontal,c=n,u=this.rotationValueSmooth.value,p=u+f.normalizeRotationDelta(e.angle-u);a=.00125*Math.min(Math.max(e.radius,40),120),this.rotationValueSmooth.gain=a,this.rotationValueSmooth.update(p);var d=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*e.timestamp),f.applyRotation(this.currentCamera,c,v.axisAngle.wrapAxisAngle(s,d)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(e.radius*d)),l.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.currentCamera.markViewDirty()}},t.prototype.end=function(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();var t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new h.ZoomPlanarMomentumController({view:this.view,momentum:t,zoomCenter:this.beginCenter});var r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new d.RotationMomentumController({view:this.view,momentum:r,center:this.beginCenter,axis:v.plane.normal(this.planeHorizontal)});var n=this.panMomentumEstimator.evaluateMomentum();return n?new p.PanPlanarMomentumController({view:this.view,momentum:n}):null},t.prototype.computePlanePoints=function(e,t,r,n){n.length=e.size;var i=this.tmp2d,o=0;return e.forEach((function(e){i[0]=e.x,i[1]=e.y,void 0===n[o]&&(n[o]=s.vec3f64.create()),f.intersectPlaneFromScreenPoint(t,r,i,n[o]),o+=1})),n},r.__decorate([o.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],t)}(u.InteractiveController);t.PinchAndPanController=S}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(241)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,!0)||this;return n.view=t,n.registerIncoming("pointer-down",r,(function(){return n.view.state.stopActiveCameraController()})),n}return r.__extends(t,e),t}(n.InputHandler);t.PointerDownCancelAnimation=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1199)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.view=t,i.key=r,i}return r.__extends(t,e),t.prototype.activate=function(){this.view.goTo({heading:0}).catch((function(){}))},t}(n.SingleKey);t.SingleKeyResetHeading=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1199)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.view=t,i.key=r,i}return r.__extends(t,e),t.prototype.activate=function(){this.view.goTo({tilt:0}).catch((function(){}))},t}(n.SingleKey);t.SingleKeyResetTilt=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(171),r(1191),r(241)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this,!0)||this;return n.view=t,n.invert=r,n.registerIncoming("vertical-two-finger-drag",(function(e){return n.handleTwoFinger(e)})),n}return r.__extends(t,e),t.prototype.handleTwoFinger=function(e){var t=this.invert?-1:1,r=n.createScreenPointArray(0,e.data.delta*t);switch(e.data.action){case"begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new i.RotateController({view:this.view,pivot:"center"}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}},t}(o.InputHandler);t.TwoFingerTilt=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(641),r(241)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){void 0===t&&(t=20),void 0===r&&(r=40);var i=e.call(this,!1)||this;return i._threshold=t,i._maxDelta=r,i.state="ready",i.emittedArtificalEnd2=!1,i._vertical=i.registerOutgoing("vertical-two-finger-drag"),i._artificalDrag=i.registerOutgoing("drag"),i.dragEventSeparator=new n.DragEventSeparator({start:function(e,t){return i.observeStart(e,t)},update:function(e,t,r){return i.observeUpdate(e,t,r)},end:function(e,t){return i.observeEnd(t)}}),i.registerIncoming("drag",(function(e){return i.dragEventSeparator.handle(e)})),i}return r.__extends(t,e),Object.defineProperty(t.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0}),t.prototype.observeStart=function(e,t){1===e&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center,artifical:!0}),t.stopPropagation()),this.state=2===e?"ready":"failed"},t.prototype.observeUpdate=function(e,t,r){if("failed"!==this.state&&2===e)return"active"===this.state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this.checkMovementWithinLimits(t.data,r.data)?this.checkVerticalThresholdReached(t.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center,artifical:!0}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this.state="failed")},t.prototype.observeEnd=function(e){"active"===this.state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",e.stopPropagation())},t.prototype.checkMovementWithinLimits=function(e,t){var r=-1/0,n=1/0,i=-1/0,o=1/0;t.pointers.forEach((function(e){r=Math.max(r,e.x),n=Math.min(n,e.x),i=Math.max(i,e.y),o=Math.min(o,e.y)}));var a=-1/0,s=1/0,l=-1/0,c=1/0;e.pointers.forEach((function(e){a=Math.max(a,e.x),s=Math.min(s,e.x),l=Math.max(l,e.y),c=Math.min(c,e.y)}));var u=r-n,p=i-o,d=a-s,h=l-c;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(d-u)<=this._maxDelta&&Math.abs(h-p)<=this._maxDelta},t.prototype.checkVerticalThresholdReached=function(e,t){var r=Math.abs(e.center.y-t.center.y);return e.pointers.forEach((function(e,n){var i=t.pointers.get(n);r=Math.min(r,Math.abs(e.y-i.y))})),r>=this._threshold},t}(i.InputHandler);t.VerticalTwoFingerDrag=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(167),r(210),r(152),r(157),r(151),r(1200),r(1673),r(203),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new n,t._contexts=new Map,t._viewState=new l.DeconflictorViewState,t.visibilityGroup=0,t._iconMarginFactor=-.1,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"labels",{get:function(){return this._labels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewState",{get:function(){return this._viewState},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._handles.add([this.view.watch("state.camera",(function(){e.updateViewState(),e.setDirty()})),this.view.watch("map.ground.opacity",(function(t,r){1!==t&&1!==r||e.setDirty()})),a.init(this.view,"slicePlane",(function(){e.updateSlicePlane(),e.slicePlaneChanged()}))]),this._frameTask=this.view.resourceController.scheduler.registerTask(p.Task.GRAPHICS_DECONFLICTOR,(function(t){return e.update(t)}),(function(){return e.needsUpdate()})),this._labels=new c.LabelDeconflictor({view:this.view,parent:this})},t.prototype.destroy=function(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)},Object.defineProperty(t.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(e){this._iconMarginFactor=e,this.setDirty()},enumerable:!0,configurable:!0}),t.prototype.setDirty=function(){this._contexts.size>0&&(e.prototype.setDirty.call(this),this._labels.setDirty())},t.prototype.update=function(t){e.prototype.update.call(this,t),this.needsUpdate()||this._labels.setDirty()},t.prototype.setInitialIconVisibilityFlag=function(e,t){var r=!(this._graphicSupportsDeconfliction(t)&&h(e));t.setVisibilityFlag(3,r,0)},t.prototype.updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())},t.prototype.updateSlicePlane=function(){var e=this.view?this.view.slicePlane:null;o.isSome(e)&&u.boundedPlane.transform(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=o.isSome(e)},t.prototype.slicePlaneChanged=function(){i.someMap(this._contexts,(function(e,t){return t.symbolCreationContext.slicePlaneEnabled}))&&this.setDirty()},t.prototype.addGraphicsOwner=function(e){var t=this,r=this._contexts.get(e);return null==r&&(r=new Map,this._contexts.set(e,r),this.setDirty()),{addGraphic:function(n){return t.addGraphic(e,r,n)},removeGraphic:function(e){return t.removeGraphic(r,e)},labelingInfoChange:function(){return t._labels.enabledChanged(e,r)},featureReductionChange:function(){return t.enabledChanged(e,r)},slicePlaneEnabledChange:function(){return t._slicePlaneEnabledChanged(e,r)},clear:function(){return r.forEach((function(e){return t.removeGraphic(r,e.graphics3DGraphic)}))}}},t.prototype.removeGraphicsOwner=function(e){var t=this,r=this._contexts.get(e);r&&(r.forEach((function(e){return t.removeGraphic(r,e.graphics3DGraphic)})),this._contexts.delete(e),this.setDirty())},t.prototype.addGraphic=function(e,t,r){var n=r.graphic.uid,i=new l.DeconflictorGraphic(r,e.symbolCreationContext.slicePlaneEnabled);t.set(n,i),h(e)&&this.addToActiveGraphics(i),e.labelsEnabled&&this._labels.addToActiveGraphics(i)},t.prototype.removeGraphic=function(e,t){var r=t.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())},t.prototype.enabledChanged=function(e,t){var r=h(e);r||function(e){var t=e.graphics3DGraphics;t&&t.forEach((function(e){return e.clearVisibilityFlag(3)}))}(e),this.modifyGraphics(t,r)},t.prototype._slicePlaneEnabledChanged=function(e,t){var r=e.symbolCreationContext.slicePlaneEnabled;t.forEach((function(e){return e.slicePlaneEnabled=r})),this.setDirty()},t.prototype.getGraphicsLayers=function(e){return e._graphics},t.prototype._graphicSupportsDeconfliction=function(e){if(e.isDraped)return!1;var t=e._graphics;if(!t||!t.length)return!1;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(this.layerSupportsDeconfliction(i))return!0}return!1},r.__decorate([s.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],t)}(l.Deconflictor);function h(e){var t=e.layer;return!(!t||!t.featureReduction||"selection"!==t.featureReduction.type)}t.GraphicsDeconflictor=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(261)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i,o=!1,a=!1,s=!1,l=!1,c=null;function u(){c&&(c(),c=null)}function p(e,t,r,o,a){u();var s=n.height,l=i;l.beginPath(),l.lineWidth=1,l.strokeStyle=a,l.moveTo(e,s-r),l.lineTo(t,s-r),l.stroke(),l.lineTo(t,s-o),l.stroke(),l.lineTo(t,s-r),l.stroke(),l.lineTo(e,s-r),l.stroke(),l.lineTo(e,s-r),l.stroke(),l.closePath()}t.drawAccelerationStruct=function(e,t){if(a&&i){u();for(var r=i,n=0,o=0;o<e.accBinsNumX;o++)for(var s=0;s<e.accBinsNumY;s++){var l=e.accBins[o][e.accBinsNumY-1-s];n+=l.length;var c=o*e.accBinsSizeX,d=(o+1)*e.accBinsSizeX,h=s*e.accBinsSizeY,f=(s+1)*e.accBinsSizeY;r.fillText(l.length.toFixed(),c+5,h+15),p(c,d,h,f,"blue")}r.fillText("total totalShownLabels: "+n,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}},t.prepare=function(e){s=r.DECONFLICTOR_SHOW_VISIBLE,l=r.DECONFLICTOR_SHOW_INVISIBLE,o=s||l,a=r.DECONFLICTOR_SHOW_GRID,c=null,o||a?c=function(){return function(e){null==n&&((n=document.createElement("canvas")).setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(n));var t=e.width*e.pixelRatio,r=e.height*e.pixelRatio;n.setAttribute("width",t+"px"),n.setAttribute("height",r+"px"),n.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+e.width+"px;height:"+e.height+"px"),(i=n.getContext("2d")).clearRect(0,0,e.width,e.height),i.font="12px Arial"}(e)}:n&&(n.parentElement.removeChild(n),n=null)},t.drawPoly=function(e,t){o&&(t&&s||!t&&l)&&p(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e instanceof Float32Array&&e.length>=16}function n(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=r,t.isMat4f64=n,t.isMat4=function(e){return r(e)||n(e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this._array=new Float32Array(e),this._size=0}return e.prototype.resize=function(e,t){if(this._size=e,this._size>this._array.length){for(var r=this._array.length||1;r<this._size;)r*=2;var n=new Float32Array(r);return t&&n.set(this._array),this._array=n,!0}var i=2*this._size;if(i<=this._array.length){for(r=this._array.length;r>=i;)r=Math.floor(r/2);return n=new Float32Array(r),t&&n.set(this._array.subarray(0,r)),this._array=n,!0}return!1},e.prototype.append=function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this._array[r]=0},Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}();t.ResizableFloat32Array=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){function i(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Reprojection=i,function(e){e.bindUniforms=function(e,t,r){e.setUniform1i("lastFrameColorMap",r.lastFrameColorTextureID),t.bindTexture(r.lastFrameColorTexture,r.lastFrameColorTextureID),e.setUniformMatrix4fv("reprojectionMat",r.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",r.rpProjectionMat)}}(i=t.Reprojection||(t.Reprojection={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Gamma=function(e){e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticalSkyModel=function(e){var t=e.fragment.code;t.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(189),r(185)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});t.Instance=function(e,t,i,o,a,s){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=o,this.hasOccludees=a,this.transformation=s,null!=s&&(this.transformationNormal=n.mat4f64.clone(s),r.mat4.invert(this.transformationNormal,this.transformationNormal),r.mat4.transpose(this.transformationNormal,this.transformationNormal))},t.sortInstancesAccordingToRange=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))},t.addOrMerge=function(e,t){var r=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var n,i,o=e[e.length-1];if(i=t,(n=o).first+n.count>=i.from){var a=t.from-o.first+t.to-t.from;o.count=a}else e.push(r(t))}else e.push(r(t))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(655),r(805),r(1207),r(345),r(537),r(653),r(806),r(253),r(257),r(260),r(228),r(804),r(804),r(242),r(217),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,occlusionTestEnabled:n.occlusionTestEnabled,signedDistanceFieldEnabled:n.sdf,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:n.debugDrawBorder,binaryHighlightOcclusionEnabled:n.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!1});return new _(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),m.Default3D)},t.prototype.bindPass=function(e,t,r){this.program.setUniform1f("cameraGroundRelative",r.cameraAboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(r.fovY/2)/(r.viewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",r.viewInvTransp),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),a.VerticalOffset.bindUniforms(this.program,t,r),d.ScreenSizePerspective.bindUniforms(this.program,t),p.Viewport.bindUniforms(this.program,r),6===this.configuration.output?l.HUDOcclusion.bindUniforms(this.program):(s.HUD.bindUniforms(this.program,r),g.HUDMaterial.bindUniforms(this.program,t,r),u.VisualVariables.bindUniforms(this.program,t),this.configuration.occlusionTestEnabled&&s.HUD.bindVisibilityTexture(e,this.program,r)),4===this.configuration.output&&c.OutputHighlight.bindOutputHighlight(e,this.program,r)},t.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),p.Camera.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){return 4===this.configuration.output?x.makePipelineState({blending:b.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:x.defaultColorWriteParams}):6===this.configuration.output?x.makePipelineState({depthTest:{func:515},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams}):x.makePipelineState({blending:b.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?x.defaultDepthWriteParams:void 0,colorWrite:x.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0}),t.shader=new h.ReloadableShaderModule(y,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(804)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(f.ShaderTechnique);t.HUDMaterialTechnique=w;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.occlusionTestEnabled=!0,t.sdf=!1,t.vvSize=!1,t.vvColor=!1,t.verticalOffset=!1,t.screenSizePerspective=!1,t.screenCenterOffsetUnitsEnabled=0,t.debugDrawBorder=!0,t.binaryHighlightOcclusion=!0,t.slicePlaneEnabled=!1,t.polygonOffsetEnabled=!1,t.depthEnabled=!0,t}return n.__extends(t,e),n.__decorate([v.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([v.parameter()],t.prototype,"occlusionTestEnabled",void 0),n.__decorate([v.parameter()],t.prototype,"sdf",void 0),n.__decorate([v.parameter()],t.prototype,"vvSize",void 0),n.__decorate([v.parameter()],t.prototype,"vvColor",void 0),n.__decorate([v.parameter()],t.prototype,"verticalOffset",void 0),n.__decorate([v.parameter()],t.prototype,"screenSizePerspective",void 0),n.__decorate([v.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),n.__decorate([v.parameter()],t.prototype,"debugDrawBorder",void 0),n.__decorate([v.parameter()],t.prototype,"binaryHighlightOcclusion",void 0),n.__decorate([v.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([v.parameter()],t.prototype,"polygonOffsetEnabled",void 0),n.__decorate([v.parameter()],t.prototype,"depthEnabled",void 0),t}(v.ShaderTechniqueConfiguration);t.HUDMaterialTechniqueConfiguration=S}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(1200)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visibilityGroup=1,t.iconMarginFactor=0,t._lastDeconfliction=0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"viewState",{get:function(){return this.parent.viewState},enumerable:!0,configurable:!0}),t.prototype.update=function(t){if(!this.parent.needsUpdate()){var r=performance.now();(2===t.state||r-this._lastDeconfliction>2e3)&&(e.prototype.update.call(this,t),0===this.state&&(this._lastDeconfliction=r))}},t.prototype.enabledChanged=function(e,t){this.modifyGraphics(t,e.labelsEnabled)},t.prototype.getGraphicsLayers=function(e){return e.labelGraphics},r.__decorate([n.property({constructOnly:!0})],t.prototype,"parent",void 0),r.__decorate([n.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],t)}(i.Deconflictor);t.LabelDeconflictor=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(226),r(167),r(156),r(210),r(152),r(153),r(151),r(207),r(1208),r(492),r(628),r(1209),r(1211),r(1744),r(261),r(942),r(1745),r(1262),r(953),r(1746),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){Object.defineProperty(t,"__esModule",{value:!0});var T=a.getLogger("esri.views.3d.layers.graphics.Labeler"),O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.idHint="__labeler",t._dirty=!1,t.labels=new Map,t.labelsToAdd=new Map,t.labelsToRemove=new Map,t.labelingContexts=[],t}return r.__extends(t,e),t.prototype.setup=function(){var e=this;this.handles||(this.handles=new o,this.handles.add([this.view.watch("state.camera",(function(){return e.setDirty()})),this.view.watch("pixelRatio",(function(){return e.resetAllLabels()}))])),this.textTextureAtlas||(this.textTextureAtlas=new S.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new b(this.view._stage),this.calloutMaterialCollection=new b(this.view._stage));var t=this.view.resourceController.scheduler;this.handles.add(t.registerTask(P.Task.LABELER,(function(t){return e.update(t)}),(function(){return e.needsUpdate()})))},t.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null),this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null),this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null),this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null),this.labelingContexts=[],this.labels.clear(),this.labelsToAdd.clear(),this.labelsToRemove.clear()},t.prototype.isActiveLabelingContext=function(e){return e.active&&h.areLabelsVisible(e.layer)},t.prototype.activateLabelingContext=function(e){var t=this;e.labels.forEach((function(e,r){t.labels.set(r,e),e.graphics3DGraphic.setVisibilityFlag(0,!0,1)})),e.active=!0},t.prototype.deactivateLabelingContext=function(e){var t=this;e.labels.forEach((function(e,r){e.graphics3DGraphic.setVisibilityFlag(0,!1,1),t.setLabelGraphicVisibility(e.graphics3DGraphic,!1),t.labels.delete(r)})),e.active=!1},t.prototype.addLabelTextureToAtlas=function(e){for(var t=0,r=e.graphics3DGraphic.labelGraphics;t<r.length;t++){var n=r[t];if(n._labelClass){var i=e.textRenderers[n._labelIndex];i&&this.textTextureAtlas.addTextTexture(i,n.stageObject)}}e.rendered=!0},t.prototype.removeLabelTextureFromAtlas=function(e){for(var t=0,r=e.graphics3DGraphic.labelGraphics;t<r.length;t++){var n=r[t];if(n._labelClass){var i=e.textRenderers[n._labelIndex];i&&this.textTextureAtlas.removeTextTexture(i,n.stageObject)}}e.rendered=!1},t.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty},t.prototype.update=function(e){this._updateLabels(e),!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(e)},t.prototype._updateLabels=function(e){var t=this;if(this._dirty){this._dirty=!1;for(var r=function(r){if(!n.isActiveLabelingContext(r))return"continue";if(!n.hasValidLabelClassContext(r)){if(n.hasInvalidLabelClassContext(r))return n.deactivateLabelingContext(r),"continue";if(n.createLabelClassContext(r),n.hasPendingLabelClassContext(r))return n._dirty=!0,"continue";if(!n.hasValidLabelClassContext(r))return"continue"}s.someMap(r.labelsToInitialize,(function(n,i){return t.ensureGraphics3DResources(n)&&(t.labels.set(i,n),t.deconflictor.setDirty(),e.madeProgress()),(n.visible&&n.hasTextTextureResources||!n.visible&&n.hasGraphics3DResources)&&(r.labelsToInitialize.delete(i),e.madeProgress()),e.done}))&&(n._dirty=!0)},n=this,i=0,o=this.labelingContexts;i<o.length;i++)r(o[i]);this.labelsToRemove.forEach((function(e){return t.removeLabelTextureFromAtlas(e)})),this.labelsToRemove.clear(),this.labelsToAdd.forEach((function(e){return t.addLabelTextureToAtlas(e)})),this.labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}},t.prototype.hasPendingLabelClassContext=function(e){return e.labelClassPromise&&!!e.labelClassAbortController},t.prototype.hasValidLabelClassContext=function(e){return e.labelClassContexts&&e.labelClassContexts.length},t.prototype.hasInvalidLabelClassContext=function(e){return null===e.labelClassContexts},t.prototype.createLabelClassContextAsync=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,a,s,u,p=this;return r.__generator(this,(function(h){switch(h.label){case 0:return t=e.labelClassAbortController.signal,[4,e.layer.when()];case 1:return h.sent(),c.throwIfAborted(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive(),n=e.graphics3DCore,o=n.layer,(a=o.labelingInfo&&o.labelingInfo.filter((function(e){return!!e.symbol})))&&0!==a.length?(s=new Array(a.length),u=!1,[4,i.forEach(a,(function(o,a){return r.__awaiter(p,void 0,void 0,(function(){var p,h,y,g;return r.__generator(this,(function(r){switch(r.label){case 0:return p=o.symbol,h=m.getGraphics3DSymbol(n.getOrCreateGraphics3DSymbol(p)),l.isNone(h)?(T.error("Failed to create Graphics3DSymbol for label"),[2]):[4,h.load()];case 1:return r.sent(),c.throwIfAborted(t),y=null,f.isCalloutSupport(p)&&p.hasVisibleCallout()?[4,(y=v.make(p,n.symbolCreationContext)).load()]:[3,3];case 2:r.sent(),c.throwIfAborted(t),r.label=3;case 3:return[4,i.result(d.createLabelFunction(o,e.layer.fields.map((function(e){return e.toJSON()})),this.view.spatialReference))];case 4:return g=r.sent(),c.throwIfAborted(t),!0===g.ok?s[a]={labelClass:o,labelFunction:g.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:y,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(h.symbol)}:(T.error("Label expression failed to evaluate: "+g.error),u=!0),[2]}}))}))}))]):[2];case 2:return h.sent(),c.throwIfAborted(t),u||(e.labelClassContexts=s),[2]}}))}))},t.prototype.createLabelClassContext=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t=this;return r.__generator(this,(function(r){return e.labelClassPromise||(e.labelClassPromise=this.createLabelClassContextAsync(e).catch((function(t){if(c.isAbortError(t))throw t;e.labelClassContexts=null})).then((function(){e.labelClassAbortController=null,t.notifyChange("updating")})).catch((function(){})),this.notifyChange("updating")),[2,e.labelClassPromise]}))}))},t.prototype.createTextRenderParameters=function(e){var t=e.symbolLayers.getItemAt(0);return t&&"text"===t.type?w.default.fromSymbol(t,this.view.pixelRatio):null},t.prototype.destroyLabelClassContext=function(e){for(var t=0,r=e.labelClassContexts;t<r.length;t++){var n=r[t];--n.graphics3DSymbol.referenced,n.graphics3DSymbol=null}var i=e.labelClassAbortController;e.labelClassAbortController=c.createAbortController(),i&&i.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")},t.prototype.createTextSymbolGraphic=function(e,t,r,n,i){var o={text:e.text,centerOffset:r.centerOffset,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,anchor:r.anchor,centerOffsetUnits:r.centerOffsetUnits,verticalOffset:r.verticalOffset,debugDrawBorder:g.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return C.graphic=t,C.renderingInfo=null,C.layer=n,i.createLabel(C,o,this.hudMaterialCollection,this.textTextureAtlas)},t.prototype.createLineCalloutGraphic=function(e,t,r,n,i){var o={symbol:t,translation:n.translation,elevationOffset:n.elevationOffset,screenOffset:n.screenOffset,centerOffset:n.centerOffset,centerOffsetUnits:n.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};return C.graphic=e,C.renderingInfo=o,C.layer=i,r.createGraphics3DGraphic(C)},t.prototype.ensureGraphics3DResources=function(e){if(e.hasGraphics3DResources)return!1;var t=e.graphics3DGraphic;if(t.destroyed)return!1;this.ensureTextTextureResources(e);var r=e.labelingContext,n=r.labelClassContexts;if(!n||0===n.length||!r.emptySymbolLabelSupported&&0===t._graphics.length)return!1;for(var i=!1,o=t.graphic,a=r.layer,s=h.areLabelsVisible(r.layer),c=this.view._stage,u=0;u<n.length;u++){var p=e.textRenderers[u];if(p){var d=n[u],f=d.graphics3DSymbol,v=null;f.symbol&&"label-3d"===f.symbol.type&&(v=f.symbol);var m=f.symbolLayers[0];if(m){var g=d.labelClass,_=r.disablePlacement,b=y.get({graphics3DGraphic:t,labelSymbol:v,labelClass:g,disablePlacement:_});if(!l.isNone(b)){m.setElevationInfoOverride(r.elevationInfoOverride);var x=this.createTextSymbolGraphic(p,o,b,a,m);if(!x)return!1;x._labelClass=g,x._labelIndex=u,t.addLabelGraphic(x,c,r.stageLayer),t.setVisibilityFlag(0,s,1),t.clearVisibilityFlag(1,1),t.setVisibilityFlag(3,!1,1),i=!0;var w=d.graphics3DCalloutSymbolLayer;if(w&&b.hasLabelVerticalOffset){w.setElevationInfoOverride(r.elevationInfoOverride);var S=this.createLineCalloutGraphic(o,v,w,b,a);S&&(d.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(S,c,r.stageLayer))}break}}}}return r.scaleVisibility&&i&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0},t.prototype.destroyGraphics3DResources=function(e){for(var t=e.labelingContext.labelClassContexts,r=0,n=e.graphics3DGraphic.labelGraphics;r<n.length;r++){var i=n[r];if(null!=i._labelClass){var o=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];null!=o&&o.onRemoveGraphic(i)}}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1},t.prototype.ensureTextTextureResources=function(e){if(!e.hasTextTextureResources){var t=e.labelingContext,r=t.labelClassContexts;if(r&&0!==r.length){for(var n=e.graphics3DGraphic.graphic,i=0;i<r.length;i++){var o=r[i];if(e.textRenderers[i]=null,o.textRenderParameters){var a=o.labelFunction,s=void 0;if("arcade"===a.type)try{var c=a.needsHydrationToEvaluate()?p.hydrateGraphic(n,t.layer):n;s=a.evaluate(c)}catch(e){s=null}else s=a.evaluate(n);l.isNone(s)||""===s||/^\s+$/.test(s)||(e.textRenderers[i]=new x.default(s,o.textRenderParameters))}}e.hasTextTextureResources=!0}}},t.prototype.destroyTextTextureResources=function(e){e.textRenderers=[],e.hasTextTextureResources=!1},t.prototype.addGraphic=function(e,t){var r={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textRenderers:[]},n=t.graphic.uid;e.labels.set(n,r),e.labelsToInitialize.set(n,r),this.setDirty(),this.deconflictor.setDirty()},t.prototype.removeGraphic=function(e,t){var r=t.graphic.uid,n=e.labels.get(r);n&&(this.destroyGraphic(n,r),e.labels.delete(r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())},t.prototype.destroyGraphic=function(e,t){this.labels.has(t)&&(this.labels.delete(t),this.labelsToAdd.delete(t),this.labelsToRemove.delete(t)),e.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(e),this.destroyTextTextureResources(e)),e.hasGraphics3DResources&&this.destroyGraphics3DResources(e)},t.prototype.labelingInfoChange=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(r){if(t){for(n=0,i=t;n<i.length;n++)o=i[n],(a=e.labels.get(o))&&(this.removeGraphic(e,a.graphics3DGraphic),this.addGraphic(e,a.graphics3DGraphic));return[2]}return this.visibilityInfoChange(e),this.resetLabels(e),[2,this.createLabelClassContext(e)]}))}))},t.prototype.globalPropertyChanged=function(e,t){for(var r=function(r){var n=new Map;t.labels.forEach((function(e){var t=e.graphics3DGraphic;n.set(t.graphic.uid,t)})),l.unwrap(r.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,n,(function(e){return e.labelGraphics[0]})),r.graphics3DCalloutSymbolLayer&&r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,(function(e){return e.labelGraphics[r.calloutSymbolLayerIndex]}))},n=0,i=t.labelClassContexts;n<i.length;n++)r(i[n])},t.prototype.visibilityInfoChange=function(e){var t=e.layer.labelsVisible;t&&!e.active&&this.activateLabelingContext(e),!t&&e.active&&this.deactivateLabelingContext(e),this.setDirty()},t.prototype.resetAllLabels=function(){for(var e=0,t=this.labelingContexts;e<t.length;e++){var r=t[e];this.resetLabels(r)}},t.prototype.resetLabels=function(e){var t=this;e.labels.forEach((function(r,n){t.destroyGraphic(r,n),r.visible=!1,r.rendered=!1,e.labelsToInitialize.set(n,r)})),this.destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()},t.prototype.findLabelingContext=function(e){for(var t=0,r=this.labelingContexts;t<r.length;t++){var n=r[t];if(n.graphics3DCore===e)return n}return null},t.prototype.addGraphicsOwner=function(e,t,r){var n=this,i=r&&r.emptySymbolLabelSupported||!1,o=r&&r.elevationInfoOverride||null,a=r&&r.disablePlacement||null;if(!this.findLabelingContext(e)){var s=e.layer,l={graphics3DCore:e,layer:s,scaleVisibility:t,emptySymbolLabelSupported:i,elevationInfoOverride:o,disablePlacement:a,active:s.labelsVisible,labelClassPromise:null,labelClassAbortController:c.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new _(this.idHint+"_"+s.uid,{isPickable:!0},s.uid)};return this.view._stage.add(0,l.stageLayer),this.view._stage.addToViewContent([l.stageLayer.id]),this.labelingContexts.push(l),this.setDirty(),{addGraphic:function(e){return n.addGraphic(l,e)},removeGraphic:function(e){return n.removeGraphic(l,e)},featureReductionChange:function(){},layerLabelsEnabled:function(){return h.areLabelsVisible(l.layer)},labelingInfoChange:function(e){return n.labelingInfoChange(l,e)},elevationInfoChange:function(){return n.globalPropertyChanged("elevationInfo",l)},slicePlaneEnabledChange:function(){return n.globalPropertyChanged("slicePlaneEnabled",l)},visibilityInfoChange:function(){return n.visibilityInfoChange(l)},reset:function(){return n.resetLabels(l)},clear:function(){},processStageDirty:function(){return n.view._stage.processDirtyLayer(l.stageLayer.id)}}}},t.prototype.removeGraphicsOwner=function(e){var t=this,r=this.findLabelingContext(e);if(r){var n=this.labelingContexts.indexOf(r);this.labelingContexts.splice(n,1),r.labels.forEach((function(e){return t.removeGraphic(r,e.graphics3DGraphic)}));var i=r.stageLayer.id;this.view._stage.removeFromViewContent([i]),this.view._stage.remove(0,i),r.stageLayer=null,this.setDirty()}},t.prototype.setLabelGraphicVisibility=function(e,t){var r=e.graphic.uid,n=this.labels.get(r);n&&n.visible!==t&&(t&&!n.rendered?(this.labelsToAdd.set(r,n),this.labelsToRemove.delete(r),n.hasTextTextureResources||n.labelingContext.labelsToInitialize.set(r,n)):!t&&n.rendered&&(this.labelsToRemove.set(r,n),this.labelsToAdd.delete(r)),n.visible=t,this.setDirty())},Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty||this.deconflictor.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))},Object.defineProperty(t.prototype,"updating",{get:function(){var e=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some((function(t){return e.hasPendingLabelClassContext(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingProgress",{get:function(){var e=this;if(!this.updating||!this.textTextureAtlas)return 1;var t=this.labelingContexts.length>0?this.labelingContexts.reduce((function(t,r){return t+(e.hasPendingLabelClassContext(r)?0:1)}),0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?0:.1)+.1*t+.5*this.deconflictor.updatingProgress},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{textTextureAtlas:this.textTextureAtlas,resetAllLabels:function(){return e.resetAllLabels()}}},enumerable:!0,configurable:!0}),r.__decorate([u.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([u.property({constructOnly:!0})],t.prototype,"deconflictor",void 0),r.__decorate([u.property()],t.prototype,"textTextureAtlas",void 0),r.__decorate([u.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating","deconflictor.updating"]})],t.prototype,"updating",null),r.__decorate([u.subclass("esri.views.3d.layers.graphics.Labeler")],t)}(n);t.Labeler=O;var C={graphic:null,renderingInfo:null,layer:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(152),r(171),r(495),r(277),r(346),r(418),r(419),r(262),r(807),r(593),r(356),r(326),r(195),r(1676)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){var g,_;Object.defineProperty(t,"__esModule",{value:!0});var b=m.VertexAttrConstants,x=function(e){function t(t,r){var n=e.call(this,t,null,r,O)||this;return n._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},n.ensureDrapedStatus(!1),n}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return this._material=new y(this.materialParameters,this._getIdHint("_lineCallout_common")),this._context.stage.add(3,this._material),[2]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)},t.prototype.perInstanceMaterialParameters=function(e){var t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t},Object.defineProperty(t.prototype,"materialParameters",{get:function(){var e=this.symbol,t=e.callout,r=i.isSome(t.color)?n.toUnitRGBA(t.color):[0,0,0,0];r[3]*=this._getLayerOpacity();var a=o.pt2px(t.size||0),s=null;if(e.verticalOffset){var l=e.verticalOffset,c=l.screenLength,u=l.minWorldLength,p=l.maxWorldLength;s={screenLength:o.pt2px(c),minWorldLength:u||0,maxWorldLength:null!=p?p:1/0}}var d=i.isSome(t.border)&&i.isSome(t.border.color)?n.toUnitRGBA(t.border.color):null,h="object"===e.symbolLayers.getItemAt(0).type,f=!h,v=h?0:void 0,m="label-3d"===e.type;return{color:r,size:a,verticalOffset:s,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:d,occlusionTest:f,shaderPolygonOffset:v,depthHUDAlignStart:m,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0}),t.prototype._defaultElevationInfoNoZ=function(){return T},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new l.ElevationContext,t.elevationOffset||0),o=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===o.type||!o.symbolLayers.some((function(e){return"object"===e.type||"text"===e.type})));if("label-3d"!==o.type&&a)return null;var s=p.computeCentroid(r.geometry);if(i.isNone(s))return null;var c="graphic"+r.uid;return this._createAs3DShape(s,n,t,c,r.uid)},t.prototype.layerOpacityChanged=function(){return this._material.setParameterValues(this.materialParameters),!0},t.prototype.layerElevationInfoChanged=function(e,r,n){var o=this,a=this._elevationContext.mode,l=s.elevationModeChangeUpdateType(t.elevationModeChangeTypes,n,a);return l!==s.SymbolUpdateType.UPDATE||e.forEach((function(e){var t=r(e);i.isSome(t)&&o.updateGraphicElevationContext(e.graphic,t)})),l},t.prototype.slicePlaneEnabledChanged=function(){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype.setGraphicElevationContext=function(t,r,n){void 0===n&&(n=0);var i=e.prototype.setGraphicElevationContext.call(this,t,r);return i.addOffsetRenderUnits(n),i},t.prototype.updateGraphicElevationContext=function(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=s.needsElevationUpdates2D(t.elevationContext.mode)},t.prototype.updateGeometry=function(e,t){return!1},t.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:h.emptySymbolComplexity.memory}},t.prototype.createVertexData=function(e){var t,r=e.translation,n=e.centerOffset;if(!r&&!n)return w;var i=r?{size:3,data:[r[0],r[1],r[2]]}:w[b.POSITION],o=n?{size:4,data:[n[0],n[1],n[2],n[3]]}:w[b.AUXPOS1];return(t={})[b.POSITION]=i,t[b.NORMAL]=w[b.NORMAL],t[b.AUXPOS1]=o,t},t.prototype.getOrCreateMaterial=function(e,t){var r,n=this.perInstanceMaterialParameters(e),i=y.uniqueMaterialIdentifier(n);return i===this._material.uniqueMaterialIdentifier?{material:this._material,isUnique:!1}:e.materialCollection?((r=e.materialCollection.getMaterial(i))||(r=new y(n,t+"_lineCallout_shared"),e.materialCollection.addMaterial(i,r)),{material:r,isUnique:!1}):{material:r=new y(n,t+"_lineCallout_unique"),isUnique:!0}},t.prototype._createAs3DShape=function(e,t,r,n,i){var o=new v.GeometryData(this.createVertexData(r),P,"point"),l=[new f(o,n)],u=this.getOrCreateMaterial(r,n),p=d.createStageObjectForHUD(this._context,e,l,[u.material],null,null,t,n,this._context.layer.uid,i);if(null===p)return null;var h=a.perObjectElevationAligner,m=new c(this,p.object,l,u.isUnique?[u.material]:null,null,h,t);return m.metadata={elevationOffset:r.elevationOffset||0},m.alignedSampledElevation=p.sampledElevation,m.needsElevationUpdates=s.needsElevationUpdates2D(t.mode),d.extendPointGraphicElevationContext(m,e,this._context.elevationProvider),m},t.elevationModeChangeTypes={definedChanged:s.SymbolUpdateType.UPDATE,staysOnTheGround:s.SymbolUpdateType.UPDATE,onTheGroundChanged:s.SymbolUpdateType.RECREATE},t}(u.Graphics3DSymbolLayer);t.Graphics3DLineCalloutSymbolLayer=x;var w=((g={})[b.POSITION]={size:3,data:[0,0,0]},g[b.NORMAL]={size:3,data:[0,0,1]},g[b.AUXPOS1]={size:4,data:[0,0,0,1]},g),S=new Uint32Array([0]),P=((_={})[b.POSITION]=S,_[b.NORMAL]=S,_[b.AUXPOS1]=S,_),T={mode:"relative-to-ground",offset:0},O={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};t.default=x}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(306),r(317),r(535),r(344),r(195),r(592),r(249),r(372),r(1677)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){var d=function(e){function t(r,n){var i=e.call(this,n)||this;return i.techniqueConfig=new p.LineCalloutTechniqueConfiguration,i.params=c.copyParameters(r,f),i._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(i.params),i}return r.__extends(t,e),Object.defineProperty(t.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getGLMaterial=function(e){return 0===e.output?new h(e):void 0},t.prototype.getPassParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.depthHudEnabled=e,this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig},t.prototype.intersect=function(){},t.prototype.createBufferWriter=function(){return new y},t.prototype.createRenderer=function(e,t){return new u(e,t,this)},t.prototype.setParameterValues=function(e){c.updateParameters(this.params,e)&&(this._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(this.params),this.parametersChanged())},t.prototype.getParameters=function(){return this.params},t.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t}(a.Material),h=function(e){function t(t){var r=e.call(this,t)||this;return r.isRenderSlot=!0,r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(p.LineCalloutTechnique,this.material.getTechniqueConfig(!1),this.technique),this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(p.LineCalloutTechnique,this.material.getTechniqueConfig(!0),this.depthTechnique)},t.prototype.beginSlot=function(e){switch(e){case 20:return this.isRenderSlot=!0,!0;case 21:return this.isRenderSlot=!1,!0}return!1},t.prototype.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique},t.prototype.bind=function(e,t){var r=this.getTechnique();e.bindProgram(r.program),r.bindPass(e,this.material.getPassParameters(),t)},t}(o.GLMaterial),f={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},v=i.newLayout().vec3f(s.VertexAttrConstants.POSITION).vec3f(s.VertexAttrConstants.NORMAL).vec2f(s.VertexAttrConstants.UV0).vec4f(s.VertexAttrConstants.AUXPOS1),m=[n.vec2f32.fromValues(0,0),n.vec2f32.fromValues(1,0),n.vec2f32.fromValues(0,1),n.vec2f32.fromValues(1,0),n.vec2f32.fromValues(1,1),n.vec2f32.fromValues(0,1)],y=function(){function e(){this.vertexBufferLayout=v}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[s.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){l.writePosition(t.indices[s.VertexAttrConstants.POSITION],t.vertexAttr[s.VertexAttrConstants.POSITION].data,e.transformation,r.position,n,6),l.writeNormal(t.indices[s.VertexAttrConstants.NORMAL],t.vertexAttr[s.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,r.normal,n,6),l.writeBufferVec4(t.indices[s.VertexAttrConstants.AUXPOS1],t.vertexAttr[s.VertexAttrConstants.AUXPOS1].data,r.auxpos1,n,6);for(var i=0;i<m.length;++i)r.uv0.setVec(n+i,m[i])},e}();return d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(655),r(653),r(253),r(257),r(260),r(228),r(249),r(938),r(938),r(242),r(217),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({occlusionTestEnabled:n.occlusionTestEnabled,verticalOffsetEnabled:n.verticalOffset,screenSizePerspectiveEnabled:n.screenSizePerspective,depthHudEnabled:n.depthHudEnabled,depthHudAlignStartEnabled:n.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:e.viewingMode});return new v(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),p.Default3D)},t.prototype.bindPass=function(e,t,r){f.LineCallout.bindUniforms(this.program,t,r),a.VerticalOffset.bindUniforms(this.program,t,r);var n=r.cameraAboveGround?1:-1;this.program.setUniform1i("hudVisibilityTexture",0),e.bindTexture(r.hudVisibilityTexture,0),this.program.setUniform1f("cameraGroundRelative",n),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),this.program.setUniform4fv("viewport",r.viewport),this.program.setUniform1f("perDistancePixelRatio",Math.tan(r.fovY/2)/(r.viewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",r.viewInvTransp),this.program.setUniform2f("pixelToNDC",2/r.viewport[2],2/r.viewport[3]);var i=r.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(t.size)*i),d.bindScreenSizePerspective(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")},t.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),s.Camera.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){return this.configuration.depthHudEnabled?y.makePipelineState({depthTest:{func:513},depthWrite:m.defaultDepthWriteParams}):y.makePipelineState({blending:y.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:y.defaultColorWriteParams})},t.shader=new l.ReloadableShaderModule(h,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(938)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(c.ShaderTechnique);t.LineCalloutTechnique=g;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.occlusionTestEnabled=!0,t.verticalOffset=!1,t.screenSizePerspective=!1,t.depthHudEnabled=!1,t.depthHudAlignStartEnabled=!1,t.screenCenterOffsetUnitsEnabled=0,t.slicePlaneEnabled=!1,t}return n.__extends(t,e),n.__decorate([u.parameter()],t.prototype,"occlusionTestEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"verticalOffset",void 0),n.__decorate([u.parameter()],t.prototype,"screenSizePerspective",void 0),n.__decorate([u.parameter()],t.prototype,"depthHudEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"depthHudAlignStartEnabled",void 0),n.__decorate([u.parameter({count:2})],t.prototype,"screenCenterOffsetUnitsEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"slicePlaneEnabled",void 0),t}(u.ShaderTechniqueConfiguration);t.LineCalloutTechniqueConfiguration=_}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(1679),r(1244),r(1700),r(1701),r(1706),r(1730),r(1736),r(1739),r(1741)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=r.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");t.make=function(e,t,r,n){var i=f[e.type]&&f[e.type][t.type]||h[t.type];return i?new i(e,t,r,n):(d.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)};var h={icon:i.default,object:s.default,line:o.default,path:l.default,fill:c.default,extrude:n.default,text:u.default,water:p.default};t.setSymbolClass=function(e,t){h[e]=t};var f={"mesh-3d":{fill:a.default}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(152),r(538),r(272),r(276),r(189),r(185),r(162),r(160),r(193),r(207),r(656),r(277),r(277),r(346),r(418),r(419),r(262),r(940),r(539),r(192),r(340),r(1229),r(356),r(326),r(417),r(195),r(540)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E){Object.defineProperty(t,"__esModule",{value:!0});var I=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o.ensureDrapedStatus(!1),o}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o,a,s,l;return r.__generator(this,(function(r){if(!this._drivenProperties.size&&(e=b.validateSymbolLayerSize(this._getSymbolSize())))throw new n("graphics3dextrudesymbollayer:invalid-size",e);return t=i.get(this.symbolLayer,"material","color"),o=this._getCombinedOpacityAndColor(t),a=p.vec3f64.fromArray(o),s=o[3],l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:a,ambient:a,opacity:s,transparent:s<1||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0},this._material=new E(l,this._getIdHint("_3dlinemat")),this._context.stage.add(3,this._material),[2]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._material&&this._context.stage.remove(3,this._material.id)},t.prototype.createGraphics3DGraphic=function(e){var r=e.graphic;if(!this._validateGeometryType(r.geometry,t.validGeometryTypes,this.symbolLayer.type))return null;if(!this._validateGeometry(r.geometry))return null;var n="graphic"+r.uid,i=this._getVertexOpacityAndColor(e.renderingInfo,Float32Array,255),o=this.setGraphicElevationContext(r,new y.ElevationContext);return this._createAs3DShape(r,e.renderingInfo,i,o,n,r.uid)},t.prototype.layerOpacityChanged=function(e,t){var r=this,n=i.get(this.symbolLayer,"material","color"),o=this._getCombinedOpacity(n),a=o<1||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:o,transparent:a});var s=this._getLayerOpacity();return e.forEach((function(e){var n=t(e);i.isSome(n)&&n.layerOpacityChanged(s,r._context.isAsync)})),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,m.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),e.forEach((function(e){var n=t(e);i.isSome(n)&&n.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0},t.prototype.physicalBasedRenderingChanged=function(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype._getExtrusionSize=function(e){var t;return(e.size&&this._drivenProperties.size?null!==(t=f.getDriverAxisSizeValue(e.size,2))&&void 0!==t?t:0:this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){var e;return null!==(e=this.symbolLayer.size)&&void 0!==e?e:1},t.prototype._createAs3DShape=function(e,t,r,n,u,h){var f=x.geometryAsPolygon(e.geometry);if(i.isNone(f))return null;var v=new Array,y=new Array,_=new Array,w=d.create(),C="global"===this._context.renderCoordsHelper.type,A=this._getExtrusionSize(t),E=p.vec3f64.create();C||this._context.renderCoordsHelper.worldUpAtPosition(null,E);var I=x.geometryToRenderInfo(f,this._context.elevationProvider,this._context.renderCoordsHelper,n);if(this._logGeometryCreationWarnings(I,f.rings,"rings","ExtrudeSymbol3DLayer"),0===f.rings.length||!f.rings.some((function(e){return e.length>0})))return null;var D=b.computeCentroid(f);if(i.isNone(D))return null;var L=c.mat4f64.create();S.computeLinearTransformation(f.spatialReference,[D.x,D.y,0],L,this._context.renderCoordsHelper.spatialReference);var j=c.mat4f64.create();l.mat4.invert(j,L);var V=s.mat3f64.create();a.mat3.normalFromMat4(V,j);for(var F=I.polygons,N=I.mapPosition,k=I.position,z=k.length/3,U=new Float64Array(3*z*6),B=new Float64Array(3*z*6),H=new Float64Array(3*z*6),q=new Float64Array(1*z*6),W=0,J=0;J<F.length;++J){var Z=F[J],X=Z.count;if(!this._context.clippingExtent||(d.empty(w),d.expandWithBuffer(w,Z.mapPosition),d.intersectsClippingArea(w,this._context.clippingExtent))){var Y=o.earcut(Z.mapPosition,Z.holeIndices,3);if(0!==Y.length){var Q=3*X*2+2*Y.length,K=new Uint32Array(Q),$=6*X,ee=3*U.BYTES_PER_ELEMENT,te=new P.BufferViewVec3f64(U.buffer,W*ee,ee,(W+$)*ee),re=3*B.BYTES_PER_ELEMENT,ne=new P.BufferViewVec3f64(B.buffer,W*re,re,(W+$)*re),ie=new Float64Array(H.buffer,3*W*H.BYTES_PER_ELEMENT,3*$),oe=new Float64Array(q.buffer,1*W*q.BYTES_PER_ELEMENT,1*$);R(k,N,Y,Z,te.typedBuffer,ie,ne.typedBuffer,oe,0,K,0,A,E,C),T.transformMat4(te,te,j),T.transformMat3(ne,ne,V),W+=6*X;var ae=this._createExtrudeGeometry(K,{positions:te.typedBuffer,elevation:ie,normals:ne.typedBuffer,heights:oe},r),se=new O(ae,u+"path"+J);v.push(se),y.push(this._material),_.push(c.mat4f64.IDENTITY)}}}if(0===v.length)return null;var le=new M({geometries:v,materials:y,transformations:_,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:h,isElevationSource:!0},idHint:u});le.objectTransformation=L;var ce=G,ue=this._createEdgeMaterial(),pe=i.isSome(ue)?{baseMaterial:this._material,edgeMaterials:[ue],slicePlaneEnabled:this._context.slicePlaneEnabled}:null,de=new g(this,le,v,null,null,ce,n,pe);return de.alignedSampledElevation=I.sampledElevation,de.needsElevationUpdates=m.needsElevationUpdates3D(n.mode),de},t.prototype._createExtrudeGeometry=function(e,t,r){for(var n=e.length,i=e,o=new Uint32Array(n),a=0;a<n;a++)o[a]=0;var s={},l={};return s[A.VertexAttrConstants.POSITION]=i,s[A.VertexAttrConstants.NORMAL]=i,s[A.VertexAttrConstants.COLOR]=o,l[A.VertexAttrConstants.POSITION]={size:3,data:t.positions},l[A.VertexAttrConstants.NORMAL]={size:3,data:t.normals},l[A.VertexAttrConstants.COLOR]={size:4,data:r},l[A.VertexAttrConstants.SIZE]={size:1,data:t.heights},t.elevation&&(l.mapPos={size:3,data:t.elevation},s.mapPos=i),new C.GeometryData(l,s)},t.prototype._createEdgeMaterial=function(){var e={opacity:this._getLayerOpacity()};return w.createMaterial(this.symbolLayer,e)},t.validGeometryTypes=["polygon","extent"],t}(_.default);function R(e,t,r,n,i,o,a,s,l,c,p,d,h,f){var v=r.length/3,m=0;p+=2*n.count,function(e,t,r,n,i,o,a,s,l,c,p,d,h,f,v,m,y){u.vec3.copy(q,m);for(var g=v>0?1:-1,_=3*r,b=d,x=3*b,w=d+n,S=3*w,P=0;P<n;++P)y&&(q[0]=e[_+0],q[1]=e[_+1],q[2]=e[_+2],u.vec3.normalize(q,q)),s[x+0]=e[_+0],s[x+1]=e[_+1],s[x+2]=e[_+2],l[x+0]=t[_+0],l[x+1]=t[_+1],l[x+2]=t[_+2],c[x+0]=-g*q[0],c[x+1]=-g*q[1],c[x+2]=-g*q[2],p[b]=0,s[S+0]=e[_+0]+v*q[0],s[S+1]=e[_+1]+v*q[1],s[S+2]=e[_+2]+v*q[2],l[S+0]=t[_+0],l[S+1]=t[_+1],l[S+2]=t[_+2],c[S+0]=g*q[0],c[S+1]=g*q[1],c[S+2]=g*q[2],p[w]=v,x+=3,S+=3,_+=3,b+=1,w+=1;_=0,x=3*f,S=3*(f+a),x=3*(f+a),S=3*f;var T=W,O=J;for(v<0&&(T=J,O=W),P=0;P<a;++P)h[x+0]=i[_+T[0]],h[x+1]=i[_+T[1]],h[x+2]=i[_+T[2]],h[S+0]=i[_+O[0]]+n,h[S+1]=i[_+O[1]]+n,h[S+2]=i[_+O[2]]+n,x+=3,S+=3,_+=3}(e,t,n.index,n.count,r,0,v,i,o,a,s,l,c,p,d,h,f),l+=2*n.count,p+=2*v,p-=2*n.count+2*v,j(i,o,s,a,m,n.pathLengths[0],n.count,l,c,p,d),l+=4*n.pathLengths[0],p+=2*n.pathLengths[0],m+=n.pathLengths[0];for(var y=1;y<n.pathLengths.length;++y)j(i,o,s,a,m,n.pathLengths[y],n.count,l,c,p,d),l+=4*n.pathLengths[y],p+=2*n.pathLengths[y],m+=n.pathLengths[y]}function D(e,t,r,n,i,o,a){n[o]=n[a],a*=3,e[0+(o*=3)]=e[a+0],e[o+1]=e[a+1],e[o+2]=e[a+2],t[o+0]=t[a+0],t[o+1]=t[a+1],t[o+2]=t[a+2],r[o+0]=i[0],r[o+1]=i[1],r[o+2]=i[2]}t.Graphics3DExtrudeSymbolLayer=I;var L=p.vec3f64.create();function j(e,t,r,n,i,o,a,s,l,c,u){var p=i,d=i+1,h=i+a,f=i+a+1,v=s,m=s+1,y=s+2*o,g=s+2*o+1;u<0&&(p=i+a+1,f=i),c*=3;for(var _=0;_<o;++_)_===o-1&&(u>0?(d=i,f=i+a):(d=i,p=i+a)),U(e,p,d,h,L),D(e,t,n,r,L,v,p),D(e,t,n,r,L,m,d),D(e,t,n,r,L,y,h),D(e,t,n,r,L,g,f),l[c++]=v,l[c++]=y,l[c++]=g,l[c++]=v,l[c++]=g,l[c++]=m,p++,d++,h++,f++,v+=2,m+=2,y+=2,g+=2}var V=p.vec3f64.create(),F=p.vec3f64.create(),N=p.vec3f64.create(),k=p.vec3f64.create(),z=p.vec3f64.create();function U(e,t,r,n,i){t*=3,r*=3,n*=3,u.vec3.set(V,e[t++],e[t++],e[t++]),u.vec3.set(F,e[r++],e[r++],e[r++]),u.vec3.set(N,e[n++],e[n++],e[n++]),u.vec3.subtract(k,F,V),u.vec3.subtract(z,N,V),u.vec3.cross(i,z,k),u.vec3.normalize(i,i)}var B=p.vec3f64.create();function G(e,t,r,n){var i=e.stageObject;Z.spatialReference=r.spatialReference;for(var o=i.geometryRecords,a=o.length,s="absolute-height"!==t.mode,p=0,d=i.objectTransformation,h=l.mat4.invert(c.mat4f64.create(),d),f=0;f<a;f++){var m=o[f].geometry;m.invalidateBoundingInfo();for(var y=m.data.getVertexAttr(),g=y[A.VertexAttrConstants.POSITION].data,_=y[A.VertexAttrConstants.SIZE].data,b=y.mapPos.data,x=g.length/3,w=0,S=0,P=!1,T=0,O=0;O<x;O++){Z.x=b[S],Z.y=b[S+1],Z.z=b[S+2],B[0]=g[w],B[1]=g[w+1],B[2]=g[w+2];var C=v.evaluateElevationAlignmentAtPoint(Z,r,t,n,s?X:null);s&&(T+=X.sampledElevation),u.vec3.set(H,g[w+0],g[w+1],g[w+2]),u.vec3.transformMat4(H,H,d),n.setAltitude(C+_[w/3],H),u.vec3.transformMat4(H,H,h),g[w]=H[0],g[w+1]=H[1],g[w+2]=H[2];var M=.01/n.unitInMeters;(Math.abs(B[0]-g[w])>M||Math.abs(B[1]-g[w+1])>M||Math.abs(B[2]-g[w+2])>M)&&(P=!0),S+=3,w+=3}P&&i.geometryVertexAttrsUpdated(f),p+=T/x}return p/a}var H=p.vec3f64.create(),q=p.vec3f64.create(),W=[0,2,1],J=[0,1,2],Z=h.makeDehydratedPoint(0,0,0,null),X={verticalDistanceToGround:0,sampledElevation:0};t.default=I}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}],t.getShaderOutputID=function(e,n){return e+"_"+r.find(t.ShaderOutputTypes,(function(e){return e.output===n})).name}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonVertexPosition=function(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(e.attributes.add("size","float"),e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.defines.addInt("VV_OPACITY_N",8),e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value <= vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i = 1; i < VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):e.vertex.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.defines.addInt("VV_COLOR_N",8),e.vertex.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value <= vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i = 1; i < VV_COLOR_N; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):(e.attributes.add("color","vec4"),e.vertex.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(210),r(152),r(214),r(151),r(344),r(1223)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pendingAddsRemoves=new Map,t._adds=new a,t._removes=new a,t._updates=new a({allocator:function(e){return e||new u},deallocator:function(e){return e.renderGeometry=null,e}}),t._materialRenderers=new Map,t._sortedMaterialRenderers=new a,t._hasHighlights=!1,t._hasWater=!1,t}return r.__extends(t,e),t.prototype.dispose=function(){this._adds.prune(),this._removes.prune(),this._updates.prune(),this._materialRenderers&&(this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())},Object.defineProperty(t.prototype,"updating",{get:function(){return this._pendingAddsRemoves.size>0||this._updates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendersOccluded",{get:function(){return i.someMap(this._materialRenderers,(function(e){return e.rendersOccluded}))},enumerable:!0,configurable:!0}),t.prototype.stopAnimationsAtTime=function(e){this._sortedMaterialRenderers.forEach((function(t){return o.applySome(t.material.animation,(function(t){return t.stopAtTime(e)}))}))},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0}),t.prototype.commitChanges=function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var r={numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data},n=c.splitRenderGeometryChangeSetByMaterial(r),o=!1,a=!1;return n.forEach((function(r,n){var i=e._materialRenderers.get(n);if(!i&&r.toAdd.length>0&&(i=n.createRenderer(e.rctx,e.materialRepository),e._materialRenderers.set(n,i),t=!0,o=!0,a=!0),i){var s=o||i.hasHighlights,l=a||i.hasWater;i.modify(r),o=o||s!==i.hasHighlights,a=a||l!==i.hasWater,i.isEmpty&&(e._materialRenderers.delete(n),i.dispose(),t=!0)}})),this._adds.clear(),this._removes.clear(),this._updates.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),o&&(this._hasHighlights=i.someMap(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=i.someMap(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0},t.prototype.add=function(e){for(var t=0===this._pendingAddsRemoves.size,r=0,n=e;r<n.length;r++){var i=n[r];this._pendingAddsRemoves.set(i,0)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.remove=function(e){for(var t=0===this._pendingAddsRemoves.size,r=0,n=e;r<n.length;r++){var i=n[r],o=this._pendingAddsRemoves.get(i);0===o?this._pendingAddsRemoves.set(i,2):2!==o&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")},t.prototype.modify=function(e,t){for(var r=0===this._updates.length,n=0,i=e;n<i.length;n++){var o=i[n],a=this._updates.pushNew();a.renderGeometry=o,a.updateType=t}r&&this._updates.length>0&&this.notifyChange("updating")},t.prototype.updateLogic=function(e){for(var t=!1,r=0;r<this._sortedMaterialRenderers.length;r++){var n=this._sortedMaterialRenderers.data[r].materialRenderer;n.updateLogic&&n.updateLogic(e)&&(t=!0)}return t},t.prototype.draw=function(e,t,r){for(var n=0;n<this._sortedMaterialRenderers.length;n++){var i=this._sortedMaterialRenderers.data[n];if(l.materialPredicate(i.material,e)){var o=r.getMaterialRenderStatsObject(i.materialRenderer.type);i.materialRenderer.render(null,e,t,o)}}},t.prototype.updateSortedMaterialRenderers=function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(r,n){n.insertOrder=t++,e._sortedMaterialRenderers.push({material:n,materialRenderer:r})})),this._sortedMaterialRenderers.sort((function(e,t){var r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))},t.prototype.updateAddsRemoves=function(){var e=this;this._adds.clear(),this._removes.clear(),this._pendingAddsRemoves.forEach((function(t,r){switch(t){case 0:e._adds.push(r);break;case 1:e._removes.push(r)}}));for(var t=0;t<this._updates.length;){var r=this._updates.data[t].renderGeometry;this._pendingAddsRemoves.has(r)?this._updates.removeUnorderedIndex(t):t++}},Object.defineProperty(t.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0}),r.__decorate([s.property()],t.prototype,"rctx",void 0),r.__decorate([s.property()],t.prototype,"materialRepository",void 0),r.__decorate([s.property()],t.prototype,"updating",null),r.__decorate([s.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],t)}(n);t.SortedRenderGeometryRenderer=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(162),r(160),r(1684),r(797)],void 0===(i=function(e,t,r,n,i,o,a){function s(e){return(e+1)*(e+1)}function l(e){return r.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,r){var n=e[0],i=e[1],o=e[2],a=r||[];return a.length=s(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*n,a[2]=.4886025119*o,a[3]=.4886025119*i),t>=2&&(a[4]=1.09254843059*n*i,a[5]=1.09254843059*i*o,a[6]=.31539156525*(3*o*o-1),a[7]=1.09254843059*n*o,a[8]=.54627421529*(n*n-i*i)),a}function u(e,t){var r=s(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0;return n}function p(e,t){for(var r=l(t.r.length),i=0,a=e;i<a.length;i++){var s=a[i];n.vec3.negate(g,s.direction),c(g,r,m),o.elementwiseProduct(m,_),o.scalarProduct(m,s.intensity[0],y),o.add(t.r,y),o.scalarProduct(m,s.intensity[1],y),o.add(t.g,y),o.scalarProduct(m,s.intensity[2],y),o.add(t.b,y)}return t}function d(e,t){c(g,0,m);for(var r=0,n=e;r<n.length;r++){var i=n[r];t.r[0]+=m[0]*_[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*_[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*_[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=p,t.projectAmbientLights=d,t.combineLights=function(e,t,r){u(t,r.sphericalHarmonics.sh),n.vec3.set(r.main.intensity,0,0,0);var i=!1,s=h,l=f,c=v;s.length=0,l.length=0,c.length=0;for(var m=0,y=e;m<y.length;m++)(b=y[m])instanceof a.MainLight&&!i?(n.vec3.copy(r.main.direction,b.direction),r.main.intensity[0]=b.intensity[0],r.main.intensity[1]=b.intensity[1],r.main.intensity[2]=b.intensity[2],r.main.castShadows=b.castShadows,i=!0):b instanceof a.MainLight||b instanceof a.FillLight?s.push(b):b instanceof a.AmbientLight?l.push(b):b instanceof a.SphericalHarmonicsLight&&c.push(b);p(s,r.sphericalHarmonics.sh),d(l,r.sphericalHarmonics.sh);for(var g=0,_=c;g<_.length;g++){var b=_[g];o.add(r.sphericalHarmonics.sh.r,b.sh.r),o.add(r.sphericalHarmonics.sh.g,b.sh.g),o.add(r.sphericalHarmonics.sh.b,b.sh.b)}};var h=[],f=[],v=[],m=[0],y=[0],g=i.vec3f64.create(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){for(this._current=new Array,this._max=new Array,this._allocations=new Map;this._current.length<6;)this._current.push(0),this._max.push(0)}return e.prototype.increment=function(e,t){var r=++this._current[e];this._max[e]=Math.max(r,this._max[e])},e.prototype.decrement=function(e,t){--this._current[e]},Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.printResourceCount=function(){console.log("Live objects:"),console.log("Textures: "+this._current[0]),console.log("Buffers: "+this._current[1]),console.log("VAOs: "+this._current[2]),console.log("Programs: "+this._current[3]),console.log("Framebuffers: "+this._current[4]),console.log("Renderbuffers: "+this._current[5]),this._allocations.size>0&&(console.log(this._allocations.size+" live object allocations:"),this._allocations.forEach((function(e){return console.log(e)})))},e}();t.InstanceCounter=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1228),r(1688),r(496),r(1689),r(1690)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t,r,n,o){if(n&&i.default(e))return!0;if(t[r])return!1;for(var a=0,s=o;a<s.length;a++){var l=s[a];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var l,c,u,p,d,h,f,v,m,y=t&&t.disabledExtensions||{},g=t&&t.debugWebGLExtensions||{},_=null,b=null,x=null,w=null;return{get instancing(){return l||(l=n.load(e)),l},get vao(){return c||(c=a.load(e,y)),c},get compressedTextureS3TC(){return u||(u=function(e,t){if(t.compressedTextureS3TC)return null;var r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,y)),u},get textureFilterAnisotropic(){return p||(p=function(e,t){if(t.textureFilterAnisotropic)return null;var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,y)),p},get disjointTimerQuery(){return d||(d=r.load(e,y)),d},get textureFloat(){return h||(h=function(e,t){if(i.default(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){var r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}(e,y)),h},get colorBufferFloat(){return f||(f=function(e,t){if(i.default(e)){var r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");return r||n?{textureFloat:!!n,textureHalfFloat:!!r,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}return e instanceof WebGLRenderingContext?(r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),n=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),r||n?{textureFloat:!!n,textureHalfFloat:!!r,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:n?n.RGBA32F_EXT:void 0}:null):null}(e,y)),f},get blendMinMax(){return v||(v=function(e,t){if(i.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}(e,y)),v},get depthTexture(){return null===_&&(_=s(e,y,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),_},get standardDerivatives(){return null===b&&(b=s(e,y,"standardDerivatives",!0,["OES_standard_derivatives"])),b},get shaderTextureLOD(){return null===x&&(x=s(e,y,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),x},get fragDepth(){return null===w&&(w=s(e,y,"fragDepth",!0,["EXT_frag_depth"])),w},get loseContext(){return m||(m=o.load(e,g)),m}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(496)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(r.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){var r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:function(){return r.loseContext()}}:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(496)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(r.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var n=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return n?{createVertexArray:n.createVertexArrayOES.bind(n),deleteVertexArray:n.deleteVertexArrayOES.bind(n),bindVertexArray:n.bindVertexArrayOES.bind(n)}:null}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this.readFile=e}return e.prototype.resolveIncludes=function(e){return this.resolve(e)},e.prototype.resolve=function(e,t){var r=this;if(void 0===t&&(t=new Map),t.has(e))return t.get(e);var n=this.read(e);if(!n)throw new Error("cannot find shader file "+e);for(var i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,o=i.exec(n),a=[];null!=o;)a.push({path:o[1],start:o.index,length:o[0].length}),o=i.exec(n);var s=0,l="";return a.forEach((function(e){l+=n.slice(s,e.start),l+=t.has(e.path)?"":r.resolve(e.path,t),s=e.start+e.length})),l+=n.slice(s),t.set(e,l),l},e.prototype.read=function(e){return this.readFile(e)},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(948)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._programCacheByTemplate=new Map,this._rctx=e}return e.prototype.dispose=function(){this._programCacheByTemplate.forEach((function(e){e.programs.forEach((function(e){e.dispose()}))})),this._programCacheByTemplate=null},e.prototype.getProgram=function(e,t){var n=this;return this._programCacheByTemplate.has(e)||this.addProgramTemplate(e,(function(t){return r.createProgram(n._rctx,e,t)})),this.getProgramTemplateInstance(e,t)},e.prototype.addProgramTemplate=function(e,t){this._programCacheByTemplate.set(e,{constructor:t,programs:new Map})},e.prototype.getProgramTemplateInstance=function(e,t){var r=this._programCacheByTemplate.get(e);if(r){var n=t?JSON.stringify(t):"default";if(!r.programs.has(n)){var i=r.constructor(t);r.programs.set(n,i)}return r.programs.get(n)}return null},e}();t.ProgramCache=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeNormal=function(e){var t=n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 decodeNormal(vec2 f) {\n      float z = 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "],["\n    vec3 decodeNormal(vec2 f) {\n      float z = 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluateAmbientLighting=function(e,t){var l=e.fragment,c=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===c?(l.uniforms.add("lightingAmbientSH0","vec3"),l.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===c?(l.uniforms.add("lightingAmbientSH_R","vec4"),l.uniforms.add("lightingAmbientSH_G","vec4"),l.uniforms.add("lightingAmbientSH_B","vec4"),l.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 = vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight = vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 = vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight = vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===c&&(l.uniforms.add("lightingAmbientSH0","vec3"),l.uniforms.add("lightingAmbientSH_R1","vec4"),l.uniforms.add("lightingAmbientSH_G1","vec4"),l.uniforms.add("lightingAmbientSH_B1","vec4"),l.uniforms.add("lightingAmbientSH_R2","vec4"),l.uniforms.add("lightingAmbientSH_G2","vec4"),l.uniforms.add("lightingAmbientSH_B2","vec4"),l.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 = vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 = vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 = vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 = vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),1!==t.pbrMode&&2!==t.pbrMode||l.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "],["\n        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1243),r(541),r(253),r(228),r(1231),r(242),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:n.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:n.hasColorTexture,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:n.hasColorTexture?1:0,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:o.doublePrecisionRequiresObfuscation(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1});return new c(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),s.Default3D)},t.shader=new a.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1243)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(l.DefaultMaterialTechnique);t.RealisticTreeTechnique=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(171)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.rasterizeText=function(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var r=this._textRasterizationCanvas,n=r.getContext("2d");this.setFontProperties(n,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight();var i,o=this.computeTextWidth(n,t),a=this.lineHeight*this.textLines.length;r.width=o,r.height=a,this.renderedLineHeight=Math.round(this.lineHeight*t.pixelRatio),this.renderedHaloSize=t.halo.size*t.pixelRatio,this.renderedWidth=o*t.pixelRatio,this.renderedHeight=a*t.pixelRatio,this.fillStyle="rgba("+(i=t.color).slice(0,3).toString()+","+i[3]+")",this.haloStyle=function(e){return"rgb("+e.slice(0,3).toString()+")"}(t.halo.color);var s=this.renderedLineHeight,l=this.renderedHaloSize;this.setFontProperties(n,t);var c=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(n.textAlign,this.renderedWidth)+l,u=l,p=0,d=0;l>0&&this.renderHalo(n,c,u,p,d,t),d+=u,p+=c;for(var h=0,f=this.textLines;h<f.length;h++){var v=f[h];n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(v,p,d),n.globalCompositeOperation="source-over",n.fillStyle=this.fillStyle,n.fillText(v,p,d),d+=s}var m=n.getImageData(0,0,this.renderedWidth,this.renderedHeight),y=new Uint8Array(m.data);if(t.premultiplyColors)for(var g=void 0,_=0;_<y.length;_+=4)g=y[_+3]/255,y[_]=y[_]*g,y[_+1]=y[_+1]*g,y[_+2]=y[_+2]*g;return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(y.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}},e.prototype.renderHalo=function(e,t,r,n,i,o){var a=this.renderedWidth,s=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=s;var l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,a,s),this.setFontProperties(c,o),c.fillStyle=this.haloStyle,c.strokeStyle=this.haloStyle;var u=this.renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this.renderHaloEmulated(c,t,r):this.renderHaloNative(c,t,r),e.globalAlpha=this.parameters.halo.color[3],e.drawImage(l,0,0,a,s,n,i,a,s),e.globalAlpha=1},e.prototype.renderHaloEmulated=function(e,t,r){for(var n=this.renderedLineHeight,o=this.renderedHaloSize,a=0,s=this.textLines;a<s.length;a++){for(var l=s[a],c=0,u=i;c<u.length;c++){var p=u[c],d=p[0],h=p[1];e.fillText(l,t+o*d,r+o*h)}r+=n}},e.prototype.renderHaloNative=function(e,t,r){for(var n=this.renderedLineHeight,i=this.renderedHaloSize,o=0,a=this.textLines;o<a.length;o++){for(var s=a[o],l=2*i,c=0;c<5;c++){var u=.6+.1*c;e.lineWidth=u*l,e.strokeText(s,t,r)}r+=n}},e.prototype.setFontProperties=function(e,t){var n=t.font,i=n.style+" "+n.weight+" "+r.pt2px(t.size*t.pixelRatio)+"px "+n.family+", sans-serif";e.font=i,e.textAlign="left",e.textBaseline="top"},e.prototype.computeTextWidth=function(e,t){for(var r=0,n=0,i=this.textLines;n<i.length;n++){var o=i[n];r=Math.max(r,e.measureText(o).width)}var a=t.font;return("italic"===a.style||"oblique"===a.style||"string"==typeof a.weight&&("bold"===a.weight||"bolder"===a.weight)||"number"==typeof a.weight&&a.weight>600)&&(r+=.3*e.measureText("A").width),r+=2*this.parameters.halo.size,Math.round(r)},e.prototype.computeLineHeight=function(){var e=1.275*this.parameters.size;return Math.round(e+2*this.parameters.halo.size)},e}();t.TextRasterizer=n;for(var i=[],o=0;o<360;o+=22.5)i.push([Math.cos(Math.PI*o/180),Math.sin(Math.PI*o/180)]);t.default=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182),r(626)],void 0===(i=function(e,t,r,n){function i(e){var t=n.toCIMSymbolJSON(e);if("CIMTextSymbol"===t.type)return t.height;var r=0;if(t.symbolLayers)for(var i=0,o=t.symbolLayers;i<o.length;i++){var a=o[i];n.isCIMMarker(a)&&a.size>r?r=a.size:n.isCIMStroke(a)&&a.width>r?r=a.width:n.isCIMFill(a)}return r}function o(e,t){switch(n.isCIMMarkerStrokePlacement(e)&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.placementTemplate&&e.placementTemplate.length){var r=e.placementTemplate.map((function(e){return e*t}));e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset*=t,e.placementTemplate&&e.placementTemplate.length&&(r=e.placementTemplate.map((function(e){return e*t})),e.placementTemplate=r);break;case"CIMMarkerPlacementOnLine":e.startPointOffset*=t;break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine*=t;break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition*=t,e.endPosition*=t;break;case"CIMMarkerPlacementPolygonCenter":e.offsetX*=t,e.offsetY*=t;break;case"CIMMarkerPlacementInsidePolygon":e.offsetX*=t,e.offsetY*=t,e.stepX*=t,e.stepY*=t}}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width*=t;break;case"CIMGeometricEffectBuffer":e.size*=t;break;case"CIMGeometricEffectCut":e.beginCut*=t,e.endCut*=t,e.middleCut*=t;break;case"CIMGeometricEffectDashes":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.dashTemplate&&e.dashTemplate.length){var r=e.dashTemplate.map((function(e){return e*t}));e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length*=t;break;case"CIMGeometricEffectMove":e.offsetX*=t,e.offsetY*=t;break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset*=t;break;case"CIMGeometricEffectRegularPolygon":e.radius*=t;break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth*=t,e.length*=t,e.toWidth*=t;break;case"CIMGeometricEffectWave":e.amplitude*=t,e.period*=t}}function s(e,t){for(var r=0,n=e;r<n.length;r++)if(n[r].join(".")===t.join("."))return;e.push(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getCIMSymbolSize=i,t.scaleCIMSymbolTo=function(e,t){var r=n.toCIMSymbolJSON(e),s=i(e);0!==s?function e(t,r,n){if("CIMTextSymbol"!==t.type){if(n&&t.effects)for(var i=0,s=t.effects;i<s.length;i++)a(s[i],r);if(t.symbolLayers)for(var l=0,c=t.symbolLayers;l<c.length;l++){var u=c[l];switch(u.type){case"CIMPictureMarker":case"CIMVectorMarker":if(u.markerPlacement&&o(u.markerPlacement,r),u.offsetX*=r,u.offsetY*=r,u.anchorPoint&&"Absolute"===u.anchorPointUnits&&(u.anchorPoint={x:u.anchorPoint.x*r,y:u.anchorPoint.y*r}),u.size*=r,"CIMVectorMarker"===u.type&&u.markerGraphics)for(var p=0,d=u.markerGraphics;p<d.length;p++){var h=d[p];u.scaleSymbolsProportionally||e(h.symbol,r,!0)}break;case"CIMPictureStroke":case"CIMSolidStroke":u.width*=r;break;case"CIMPictureFill":u.height*=r,u.offsetX*=r,u.offsetY*=r;break;case"CIMHatchFill":e(u.lineSymbol,r,!0),u.offsetX*=r,u.offsetY*=r,u.separation*=r}}}else t.height*=r}(r,t/s,!1):function(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(var r=0,n=e.symbolLayers;r<n.length;r++){var i=n[r];switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}}else e.height=t}(r,t)},t.getCIMSymbolColor=function(e){var t=[];return function e(t,r){var i;i="CIMTextSymbol"===t.type?t.symbol:t;var o="CIMPolygonSymbol"===t.type;if(i.symbolLayers)for(var a=0,l=i.symbolLayers;a<l.length;a++){var c=l[a];if(!(c.colorLocked||o&&(n.isCIMStroke(c)||n.isCIMMarker(c)&&c.markerPlacement&&n.isCIMMarkerStrokePlacement(c.markerPlacement))))switch(c.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":c.markerGraphics.forEach((function(t){e(t.symbol,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":s(r,c.color);break;case"CIMHatchFill":e(c.lineSymbol,r)}}}(n.toCIMSymbolJSON(e),t),t.length?new r(n.fromCIMColor(t[0])):null},t.applyCIMSymbolColor=function(e,t){t instanceof r||(t=new r(t)),function e(t,r){var i;i="CIMTextSymbol"===t.type?t.symbol:t;var o="CIMPolygonSymbol"===t.type;if(i.symbolLayers)for(var a=0,s=i.symbolLayers;a<s.length;a++){var l=s[a];if(!(l.colorLocked||o&&(n.isCIMStroke(l)||n.isCIMMarker(l)&&l.markerPlacement&&n.isCIMMarkerStrokePlacement(l.markerPlacement)))){var c=r.toArray(0);switch(l.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":l.markerGraphics.forEach((function(t){e(t.symbol,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":l.color=c;break;case"CIMHatchFill":e(l.lineSymbol,r)}}}}(n.toCIMSymbolJSON(e),t)},t.getCIMSymbolRotation=function(e){var t=n.toCIMSymbolJSON(e);return("CIMTextSymbol"===t.type||"CIMPointSymbol"===t.type)&&t.angle||0},t.applyCIMSymbolRotation=function(e,t){var r=n.toCIMSymbolJSON(e);if("CIMTextSymbol"!==r.type){if("CIMPointSymbol"===r.type&&r.symbolLayers)for(var i=t-(r.angle||0),o=0,a=r.symbolLayers;o<a.length;o++){var s=a[o];if(n.isCIMMarker(s)){var l=s.rotation||0;s.rotateClockwise?l-=i:l+=i,s.rotation=l}r.angle=t}}else r.angle=t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(195)],void 0===(i=function(e,t,r,n){function i(e,t){for(var r=e,i=new Uint8Array(4*r*r),o=r/2-.5,a=t/2,s=0;s<r;s++)for(var l=0;l<r;l++){var c=l+r*s,u=l-o,p=s-o,d=Math.sqrt(u*u+p*p)-a;d=d/e+.5,n.packFloatRGBA(d,i,4*c)}return i}function o(e,t){return u(e,t,!1)}function a(e,t){return u(e,t,!0)}function s(e,t){return p(e,t,!1)}function l(e,t){return p(e,t,!0)}function c(e,t){for(var r=new Uint8Array(4*e*e),i=Math.sqrt(1.25),o=(e-t)/2,a=0;a<e;a++)for(var s=0;s<e;s++){var l=a*e+s,c=(s-o)/t,u=(a-o+.75)/t,p=-(1*c+-.5*u)/i,d=(1*(c-1)+-.5*-u)/i,h=-u,f=Math.max(p,d,h)*t/e+.5;n.packFloatRGBA(f,r,4*l)}return r}function u(e,t,r){r&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),o=0;o<e;o++)for(var a=0;a<e;a++){var s=a-.5*e+.25,l=.5*e-o-.75,c=o*e+a;if(r){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var p=Math.max(Math.abs(s),Math.abs(l))-.5*t;p=p/e+.5,n.packFloatRGBA(p,i,4*c)}return i}function p(e,t,r){r&&(t*=Math.SQRT2);for(var i=.5*t,o=new Uint8Array(4*e*e),a=0;a<e;a++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-a-1,u=a*e+s;if(r){var p=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=p}var d=void 0;d=(d=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,n.packFloatRGBA(d,o,4*u)}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.createType=function(e,t,n){switch(e){case"circle":return i(t,n);case"square":return o(t,n);case"cross":return s(t,n);case"x":return l(t,n);case"kite":return a(t,n);case"triangle":return c(t,n);default:return r.neverReached(e),i(t,n)}},t.createCircle=i,t.createSquare=o,t.createKite=a,t.createCross=s,t.createX=l,t.createTriangle=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(168),r(299)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=r.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function a(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var s=a("DXT1"),l=a("DXT3"),c=a("DXT5");function u(e,t){var r=new Int32Array(e,0,31);if(542327876!==r[0])return o.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return o.error("Unsupported format, must contain a FourCC code"),null;var i,a,u,p=r[21];switch(p){case s:i=8,a=33776;break;case l:i=16,a=33778;break;case c:i=16,a=33779;break;default:return o.error("Unsupported FourCC code:",(u=p,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),null}var d=1,h=r[4],f=r[3];0==(3&h)&&0==(3&f)||(o.warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,f=f+3&-4);var v,m,y=h,g=f;131072&r[2]&&!1!==t&&(d=Math.max(1,r[7])),1===d||n.isPowerOfTwo(h)&&n.isPowerOfTwo(f)||(o.warn("Ignoring mipmaps of non power of two sized compressed texture."),d=1);for(var _=r[1]+4,b=[],x=0;x<d;++x)m=(h+3>>2)*(f+3>>2)*i,v=new Uint8Array(e,_,m),b.push(v),_+=m,h=Math.max(1,h>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:b},internalFormat:a,width:y,height:g}}t.createDDSTexture=function(e,t,r,n){var o=u(r,n),a=o.textureData,s=o.internalFormat,l=o.width,c=o.height;t.samplingMode=a.levels.length>1?9987:9729,t.hasMipmap=a.levels.length>1,t.internalFormat=s,t.width=l,t.height=c;var p=new i(e,t,a);return e.bindTexture(p),p},t.createDDSTextureData=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(159),r(154),r(152),r(171),r(185),r(201),r(193),r(656),r(495),r(277),r(346),r(814),r(418),r(419),r(1246),r(450),r(356),r(417),r(451),r(808),r(944)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P){Object.defineProperty(t,"__esModule",{value:!0});var T=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._uniformSize=1,o}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=_.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){if((e=null!=this.symbolLayer.size?this.symbolLayer.size:s.px2pt(1))<0)throw new o("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}return[2]}))}))},t.prototype.getMaterialParameters=function(e){var t=a.get(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),o=i[3],l={width:1,color:i,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:o<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:this.symbolLayer.stipplePattern?S.createStipplePattern(this.symbolLayer.stipplePattern.map(s.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?n.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(l.width=s.pt2px(1));else{var c=null!=this.symbolLayer.size?this.symbolLayer.size:s.px2pt(1);l.width=s.pt2px(c)}return this._fastUpdates&&this._fastUpdates.visualVariables?r.__assign(r.__assign({},l),this._fastUpdates.materialParameters):l},Object.defineProperty(t.prototype,"lineMaterial",{get:function(){return a.isNone(this._lineMaterial)&&(this._lineMaterial=new P(this.getMaterialParameters(!1),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._lineMaterial)),this._lineMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ringMaterial",{get:function(){return a.isNone(this._ringMaterial)&&(this._ringMaterial=new P(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial)),this._ringMaterial},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){e.prototype.destroy.call(this),a.isSome(this._lineMaterial)&&(this._context.stage.remove(3,this._lineMaterial.id),this._lineMaterial=null),a.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)},t.prototype.getDrivenSize=function(e){return this._drivenProperties.size&&e.size?s.pt2px(p.getDriverAxisSizeValueAny(e.size)):1},t.prototype.getSizeFeatureAttributeData=function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?y.getAttributeValue(this._fastUpdates.visualVariables.size.field,e):null},t.prototype.getDrivenColor=function(e){var t=c.vec4f64.fromValues(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t},t.prototype.getColorFeatureAttributeData=function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?y.getAttributeValue(this._fastUpdates.visualVariables.color.field,e):null},t.prototype.getOpacityFeatureAttributeData=function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?y.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,e):null},t.prototype.createGraphics3DGraphic=function(e){var r=e.graphic,n=r.geometry;if(!this._validateGeometryType(r.geometry,t.validGeometryTypes,this.symbolLayer.type))return null;if(!this._validateGeometry(n))return null;var i="graphic"+r.uid,o=this.setGraphicElevationContext(r,new f.ElevationContext);return this.ensureDrapedStatus("on-the-ground"===o.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,o,i,r.uid)},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!_.updateFastSymbolUpdatesState(this._fastUpdates,t,this._vvConvertOptions))return!1;a.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),a.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype.layerOpacityChanged=function(){return a.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),a.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0},t.prototype.updateMaterialLayerOpacity=function(e){var t=e.getParameters().color,r=a.get(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(r),i=n<1||this.needsDrivenTransparentPass,o=[t[0],t[1],t[2],n];e.setParameterValues({color:o,transparent:i})},t.prototype.layerElevationInfoChanged=function(e,r,n){var i=this._elevationContext.mode,o=h.elevationModeChangeUpdateType(t.elevationModeChangeTypes,n,i);if(o!==h.SymbolUpdateType.UPDATE)return o;var a=h.needsElevationUpdates2D(i);return this.updateGraphics3DGraphicElevationInfo(e,r,(function(){return a}))},t.prototype.slicePlaneEnabledChanged=function(){return a.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),a.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype._getGeometryAsPolygonOrPolyline=function(e){switch(e.type){case"extent":if(e instanceof i.Extent)return i.Polygon.fromExtent(e);break;case"polygon":case"polyline":return e}return null},t.prototype._createAs3DShape=function(e,t,r,n){var i=e.graphic,o=this._getGeometryAsPolygonOrPolyline(i.geometry),s="polygon"===o.type?o.rings:o.paths,c=[],p=[],f=[],v=u.create(),y=g.geometryToRenderInfo(o,this._context.elevationProvider,this._context.renderCoordsHelper,t),_="polygon"===o.type?"rings":"paths";this._logGeometryCreationWarnings(y,s,_,"LineSymbol3DLayer");for(var w=0;w<y.lines.length;w++){var S=y.lines[w],P=S.position,T=S.mapPosition;if(!a.isSome(this._context.clippingExtent)||(u.empty(v),u.expandWithBuffer(v,T),u.intersectsClippingArea(v,this._context.clippingExtent))){var O=this._createGeometryData(e,P,T,o.type),C=new b(O,r+"path"+w);c.push(C),p.push("polygon"===o.type?this.ringMaterial:this.lineMaterial),f.push(l.mat4f64.IDENTITY)}}if(0===c.length)return null;var M=new x({geometries:c,materials:p,transformations:f,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:n},idHint:r}),A=d.perVertexElevationAligner,E=new m(this,M,c,null,null,A,t);return E.alignedSampledElevation=y.sampledElevation,E.needsElevationUpdates=h.needsElevationUpdates2D(t.mode),E},t.prototype._createGeometryData=function(e,t,r,n){var i="polygon"===n?1:0,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return g.createGeometryData({removeDuplicateStartEnd:i,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:r,size:a?null:this.getDrivenSize(e.renderingInfo),color:o?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})},t.prototype._createAsOverlay=function(e,t){var r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),i="polygon"===n.type?n.rings:n.paths,o="polygon"===n.type?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;var a=[],s=u.create(),l=u.empty(),c=g.geometryToRenderInfoDraped(n,this._context.overlaySR),p="polygon"===n.type?"rings":"paths";if(this._logGeometryCreationWarnings(c,i,p,"LineSymbol3DLayer"),i.length>0){for(var d=c.lines,h=0;h<d.length;++h){var f=d[h];if(u.empty(s),u.expandWithBuffer(s,f.position),u.intersectsClippingArea(s,this._context.clippingExtent)){u.expand(l,s);var m=this._createGeometryData(e,f.position,null,n.type),y=new w(m);y.data.layerUid=t,y.data.graphicUid=r.uid,y.material=o,y.center=[.5*(s[0]+s[3]),.5*(s[1]+s[4]),0],y.bsRadius=.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1])),a.push(y)}}return new v(this,a,l)}return null},t.validGeometryTypes=["polyline","polygon","extent"],t.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.RECREATE,staysOnTheGround:h.SymbolUpdateType.NONE,onTheGroundChanged:h.SymbolUpdateType.RECREATE},t}(y.Graphics3DSymbolLayer);t.Graphics3DLineSymbolLayer=T,t.default=T}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(177),r(152),r(272),r(276),r(189),r(185),r(162),r(160),r(201),r(193),r(1702),r(1249),r(197),r(1704),r(495),r(277),r(346),r(418),r(419),r(539),r(596),r(261),r(192),r(356),r(326),r(417),r(358),r(195),r(540),r(1250)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D){Object.defineProperty(t,"__esModule",{value:!0});var L=I.VertexAttrConstants,j=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._materials=new Map,o._textures=new Map,o.ensureDrapedStatus(!1),o}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return T.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new D({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new D({color:[0,1,1,1]},"debugFAceNormal")),[2]}))}))},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._materials.forEach((function(e){t._context.stage.remove(3,e.material.id)})),this._textures.forEach((function(e){t._context.stage.remove(4,e.id)})),this._materials.clear(),this._textures.clear()},t.prototype.createGraphics3DGraphic=function(e){var r=e.graphic;if(!this._validateGeometryType(r.geometry,t.validGeometryTypes,"fill on mesh-3d"))return null;if(!this._validateGeometry(r.geometry))return null;var n="graphic"+r.uid,i=this.setGraphicElevationContext(r,new b.ElevationContext),o=e.renderingInfo;return this._createAs3DShape(r,o,i,n,r.uid)},t.prototype.layerOpacityChanged=function(e,t){var r=this,n=this._getLayerOpacity();return this._materials.forEach((function(e){e.material.setParameterValues({layerOpacity:n});var t=e.material.getParameters();r._setMaterialTransparentParameter(t,e),e.material.setParameterValues({transparent:t.transparent})})),e.forEach((function(e){var i=t(e);o.isSome(i)&&i.layerOpacityChanged(n,r._context.isAsync)})),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,_.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return this._materials.forEach((function(e){e.material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})})),e.forEach((function(e){var n=t(e);o.isSome(n)&&n.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0},t.prototype.physicalBasedRenderingChanged=function(){var e=this;return this._materials.forEach((function(t){var r=t.material.getParameters().isSchematic;t.material.setParameterValues({usePBR:e._usePBR(r)})})),!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity},t.prototype._colorOrTextureUid=function(e){return e?e instanceof n?e.toHex():e.contentHash:"-"},t.prototype._materialPropertiesDefault=function(e,t){var r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,i=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:i,uid:"vc:"+n+",vt:"+i+",vct"+t+",svc:"+r}},t.prototype._materialProperties=function(e,t,r){var n=this._materialPropertiesDefault(e,r);if(!t.material)return n;var i=t.material,o=i.color,a=i.colorTexture,s=i.normalTexture,l=i.doubleSided,c=i.alphaCutoff,u=i.alphaMode,p=this._colorOrTextureUid(o),d=this._colorOrTextureUid(a),h=this._colorOrTextureUid(s);if(n.color=o,n.colorTexture=a,n.normalTexture=s,n.uid=n.uid+",cmuid:"+p+",ctmuid:"+d+",ntmuid:"+h+",ds:"+l+",ac:"+c+",am:"+u,t.material instanceof v){var f=t.material,m=f.metallic,y=f.roughness,g=f.metallicRoughnessTexture,_=f.emissiveColor,b=f.emissiveTexture,x=f.occlusionTexture,w=this._colorOrTextureUid(g),S=this._colorOrTextureUid(_),P=this._colorOrTextureUid(b),T=this._colorOrTextureUid(x);n.metallic=m,n.roughness=y,n.metallicRoughnessTexture=g,n.emissiveColor=_,n.emissiveTexture=b,n.occlusionTexture=x,n.uid=n.uid+",mrm:"+m+",mrr:"+y+",mrt:"+w+",emuid:"+S+",etmuid:"+P+",otmuid:"+T}return n},t.prototype._setInternalColorValueParameters=function(e,t){t.diffuse=n.toUnitRGB(e),t.opacity=e.a},t.prototype._getLoadableTextureResource=function(e){return e.data?e.data:e.url},t.prototype._getInternalTextureId=function(e,t){var r=this._getLoadableTextureResource(e);if(r){var n=e.contentHash,i=this._textures.get(n);return i||(i=new E(r,t+"_"+n+"_tex",{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(n,i),this._context.stage.add(4,i)),i.id}},t.prototype._castTextureWrap=function(e){if(void 0===e&&(e="repeat"),"string"==typeof e){var t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}},t.prototype._castTextureWrapIndividual=function(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;case"repeat":default:return 10497}},t.prototype._setInternalMaterialParameters=function(e,t,r){e.color&&this._setInternalColorValueParameters(e.color,r),e.colorTexture&&(r.textureId=this._getInternalTextureId(e.colorTexture,t)),e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture,t)),e.emissiveColor&&(r.emissiveFactor=n.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture,t)),e.occlusionTexture&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture,t)),e.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture,t))},t.prototype._setExternalMaterialParameters=function(e){var t=this._drivenProperties.color,r=o.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=d.vec4f64.ONES;else{var i=o.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null;o.isSome(i)?e.externalColor=n.toUnitRGBA(i):(r=null,e.externalColor=d.vec4f64.ONES)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows},t.prototype._hasTransparentVertexColors=function(e){var t=e.vertexAttributes.color;if(!t)return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1},t.prototype._getOrCreateMaterial=function(e,t){var r=t.material&&t.material.color,n=t.material&&t.material.colorTexture,i=t.material&&"blend"===t.material.alphaMode,o=!(t.material&&"opaque"===t.material.alphaMode)&&(this._hasTransparentVertexColors(e)||r&&r.a<1||n&&n.transparent||i),a=this._materialProperties(e,t,o),s=this._materials.get(a.uid);if(s)return s.material;var l={material:null,isComponentTransparent:o,alphaMode:t.material?t.material.alphaMode:"opaque"},c=this._getIdHint(),u=null==a.metallicRoughnessTexture&&null==a.metallic&&null==a.roughness,d={usePBR:this._usePBR(u),isSchematic:u,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:p.vec3f64.ZEROS,diffuse:p.vec3f64.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};u||(d.mrrFactors=[null!=a.metallic?a.metallic:1,null!=a.roughness?a.roughness:1,.5]),t.material&&(d.doubleSided=t.material.doubleSided,d.cullFace=t.material.doubleSided?0:2,d.textureAlphaCutoff=t.material.alphaCutoff),this._setInternalMaterialParameters(a,c,d),this._setExternalMaterialParameters(d),this._setMaterialTransparentParameter(d,l);var h=new R(d,c+"_"+a.uid+"_mat");return l.material=h,this._materials.set(a.uid,l),this._context.stage.add(3,h),h},t.prototype._usePBR=function(e){return!e||this._context.physicalBasedRenderingEnabled},t.prototype._setMaterialTransparentParameter=function(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode="opaque"===t.alphaMode?1:"mask"===t.alphaMode?2:0},t.prototype._addDebugNormals=function(e,t,r,n){for(var i,o,a,s,l=t.length,p=e.spatialReference.isGeographic?20015077/180:1,d=.1*Math.max(e.extent.width*p,e.extent.height*p,e.extent.zmax-e.extent.zmin),h=[],f=[],v=[],m=[],y=0;y<l;y++)for(var g=t[y],_=g.data.getAttribute(L.POSITION),b=g.data.getAttribute(L.NORMAL),x=g.data.getIndices(L.POSITION),w=g.data.getIndices(L.NORMAL),S=_.data,P=b.data,T=0;T<x.length;T++){for(var O=3*x[T],A=3*w[T],E=0;E<3;E++)h.push(S[O+E]);for(E=0;E<3;E++)h.push(S[O+E]+P[A+E]*d);if(f.push(f.length),f.push(f.length),T%3==0){for(this._calculateFaceNormal(S,x,T,z),this._getFaceVertices(S,x,T,F,N,k),u.vec3.add(F,F,N),u.vec3.add(F,F,k),u.vec3.scale(F,F,1/3),E=0;E<3;E++)v.push(F[E]);for(E=0;E<3;E++)v.push(F[E]+z[E]*d);m.push(m.length),m.push(m.length)}}var I=((i={})[L.POSITION]={data:new Float64Array(h),size:3},i),R=((o={})[L.POSITION]=new Uint32Array(f),o),D=new M.GeometryData(I,R,"line"),j=new C(D,"debugVertexNormal");t.push(j),r.push(this._debugVertexNormalMaterial),n.push(c.mat4f64.clone(n[0])),(a={})[L.POSITION]={data:new Float64Array(v),size:3},I=a,(s={})[L.POSITION]=new Uint32Array(m),R=s,D=new M.GeometryData(I,R,"line"),j=new C(D,"debugFaceNormal"),t.push(j),r.push(this._debugFaceNormalMaterial),n.push(c.mat4f64.clone(n[0]))},t.prototype._createAs3DShape=function(e,t,r,n,i){var a=e.geometry;if("mesh"!==a.type)return null;var s=this._createGeometryInfo(a,t,n);if(!s)return null;var l=s.geometries,c=s.materials,u=s.transformations,p=s.objectTransformation;T.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,l,c,u);var d=new A({geometries:l,materials:c,transformations:u,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:i},idHint:n});d.objectTransformation=p;var h=g.perObjectElevationAligner,f=this._createEdgeMaterial(),v=o.isSome(f)?{baseMaterial:c[0],edgeMaterials:[f],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null,m=new x(this,d,l,null,null,h,r,v);m.needsElevationUpdates=_.needsElevationUpdates3D(r.mode);var y=a.extent.center.clone();return y.z=0,m.elevationContext.centerPointInElevationSR=y,m.alignedSampledElevation=h(m,m.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),m},t.prototype._createComponentNormals=function(e,t,r,n){var o=r.shading||"flat";switch(o){case"source":return this._createComponentNormalsSource(e,t,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n);default:return void i.neverReached(o)}},t.prototype._createComponentNormalsSource=function(e,t,r,n){if(!t)return this._createComponentNormalsFlat(e,n);var i=!1;if(!r.trustSourceNormals)for(var o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,z);for(var a=0;a<3;a++){var s=3*n[o+a];F[0]=t[s+0],F[1]=t[s+1],F[2]=t[s+2],u.vec3.dot(z,F)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],i=!0)}}return{normals:t,indices:n,didFlipNormals:i}},t.prototype._createComponentNormalsFlat=function(e,t){for(var r=new Float32Array(t.length),n=new Uint32Array(3*t.length),i=0;i<t.length;i+=3)for(var o=this._calculateFaceNormal(e,t,i,z),a=0;a<3;a++)r[i+a]=o[a],n[i+a]=i/3;return{normals:r,indices:n,didFlipNormals:!1}},t.prototype._createComponentNormalsSmooth=function(e,t){for(var r={},n=0;n<t.length;n+=3)for(var i=this._calculateFaceNormal(e,t,n,z),o=0;o<3;o++)(c=r[l=t[n+o]])||(c={normal:p.vec3f64.create(),count:0},r[l]=c),u.vec3.add(c.normal,c.normal,i),c.count++;var a=new Float32Array(3*t.length),s=new Uint32Array(3*t.length);for(n=0;n<t.length;n++){var l,c;for(1!==(c=r[l=t[n]]).count&&(u.vec3.normalize(c.normal,c.normal),c.count=1),o=0;o<3;o++)a[3*n+o]=c.normal[o];s[n]=n}return{normals:a,indices:s,didFlipNormals:!1}},t.prototype._getFaceVertices=function(e,t,r,n,i,o){var a=3*t[r+0],s=3*t[r+1],l=3*t[r+2];n[0]=e[a+0],n[1]=e[a+1],n[2]=e[a+2],i[0]=e[s+0],i[1]=e[s+1],i[2]=e[s+2],o[0]=e[l+0],o[1]=e[l+1],o[2]=e[l+2]},t.prototype._calculateFaceNormal=function(e,t,r,n){return this._getFaceVertices(e,t,r,F,N,k),u.vec3.subtract(N,N,F),u.vec3.subtract(k,k,F),u.vec3.cross(F,N,k),u.vec3.normalize(n,F),n},t.prototype._getOrCreateComponents=function(e){return e.components?e.components:H},t.prototype._createPositionBuffer=function(e){var t=e.vertexAttributes.position,r=new Float64Array(t.length),n=this._context.renderCoordsHelper.spatialReference;return O.bufferToBuffer(e.vertexAttributes.position,e.spatialReference,0,r,n,0,t.length/3),r},t.prototype._createNormalBuffer=function(e,t){var r=e.vertexAttributes.normal;if(!r)return null;if("local"===this._context.layerView.view.viewingMode)return r;var n=e.vertexAttributes.position,i=new Float32Array(r.length);return y.projectNormalToECEF(r,n,t,e.spatialReference,i)},t.prototype._createTangentBuffer=function(e,t){var r=e.vertexAttributes.tangent;if(!r)return null;if("local"===this._context.layerView.view.viewingMode)return r;var n=e.vertexAttributes.position,i=new Float32Array(r.length);return y.projectTangentToECEF(r,n,t,e.spatialReference,i)},t.prototype._createColorBuffer=function(e){return e.vertexAttributes.color},t.prototype._createSymbolColorBuffer=function(e){if(this._requiresSymbolVertexColors()){var t=this._getVertexOpacityAndColor(e),r=P.parseColorMixMode(o.get(this.symbolLayer,"material","colorMixMode")),n=new Uint8Array(4);return P.encodeSymbolColor(t,r,n),n}return null},t.prototype._createColorIndices=function(e){for(var t=new Uint32Array(e.length),r=0;r<t.length;r++)t[r]=0;return t},t.prototype._createBuffers=function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var n=e.vertexAttributes.normal,i=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(i&&i.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var a=this._createPositionBuffer(e),s=this._createColorBuffer(e),l=this._createSymbolColorBuffer(t),c=this._createNormalBuffer(e,a);return{positionBuffer:a,normalBuffer:c,tangentBuffer:this._createTangentBuffer(e,a),uvBuffer:i,colorBuffer:s,symbolColorBuffer:l,objectTransformation:this._transformCenterLocal(e,a,c)}},t.prototype._transformCenterLocal=function(e,t,r){var n=e.extent.center,i=this._context.renderCoordsHelper.spatialReference;V[0]=n.x,V[1]=n.y,V[2]=0;var o=c.mat4f64.create();O.computeLinearTransformation(e.spatialReference,V,o,i),l.mat4.invert(U,o);for(var s=0;s<t.length;s+=3)F[0]=t[s+0],F[1]=t[s+1],F[2]=t[s+2],u.vec3.transformMat4(F,F,U),t[s+0]=F[0],t[s+1]=F[1],t[s+2]=F[2];if(r)for(a.mat3.fromMat4(B,o),a.mat3.transpose(B,B),s=0;s<r.length;s+=3)F[0]=r[s+0],F[1]=r[s+1],F[2]=r[s+2],u.vec3.transformMat3(F,F,B),r[s+0]=F[0],r[s+1]=F[1],r[s+2]=F[2];return o},t.prototype._validateFaces=function(e,t){var r=e.vertexAttributes.position.length/3,n=t.faces;if(n){for(var i=-1,o=0;o<n.length;o++){var a=n[o];a>i&&(i=a)}if(r<=i)return this.logger.warn("Vertex index "+i+" is out of bounds of the mesh position buffer"),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0},t.prototype._getOrCreateFaces=function(e,t){if(t.faces)return t.faces;for(var r=new Uint32Array(e.vertexAttributes.position.length/3),n=0;n<r.length;n++)r[n]=n;return r},t.prototype._isOutsideClippingArea=function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var r,n=this._context.elevationProvider.spatialReference,i=t.length/3;return e.spatialReference.equals(n)?r=t:(r=new Float64Array(t.length),O.bufferToBuffer(e.vertexAttributes.position,e.spatialReference,0,r,n,0,i)),h.empty(G),h.expandWithBuffer(G,r,0,i),!h.intersectsClippingArea(G,this._context.clippingExtent)},t.prototype._createGeometryInfo=function(e,t,r){var n,i;if(!m.canProject(e,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var o=this._createBuffers(e,t);if(!o)return null;for(var a=o.positionBuffer,s=o.uvBuffer,l=o.colorBuffer,u=o.symbolColorBuffer,p=o.normalBuffer,d=o.tangentBuffer,h=o.objectTransformation,f=[],v=[],y=[],g=!1,_=0,b=this._getOrCreateComponents(e);_<b.length;_++){var x=b[_];if(!this._validateFaces(e,x))return null;var w=this._getOrCreateFaces(e,x);if(0!==w.length){var S=this._createComponentNormals(a,p,x,w);S.didFlipNormals&&(g=!0);var P=((n={})[L.POSITION]={size:3,data:a},n[L.NORMAL]={size:3,data:S.normals},n),T=((i={})[L.POSITION]=w,i[L.NORMAL]=S.indices,i);l&&(P[L.COLOR]={size:4,data:l},T[L.COLOR]=w),u&&(P[L.SYMBOLCOLOR]={size:4,data:u},T[L.SYMBOLCOLOR]=this._createColorIndices(w)),e.vertexAttributes.uv&&(P[L.UV0]={size:2,data:s},T[L.UV0]=w),e.vertexAttributes.tangent&&(P[L.TANGENT]={size:4,data:d},T[L.TANGENT]=w);var O=new M.GeometryData(P,T),A=new C(O,r+"_mesh");f.push(A),v.push(c.mat4f64.create()),y.push(this._getOrCreateMaterial(e,x))}}return g&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:v,materials:y,objectTransformation:h}},t.prototype._createEdgeMaterial=function(){var e={opacity:this._getLayerOpacity()};return S.createMaterial(this.symbolLayer,e)},t.validGeometryTypes=["mesh"],t}(w.default);t.Graphics3DMeshFillSymbolLayer=j;var V=p.vec3f64.create(),F=p.vec3f64.create(),N=p.vec3f64.create(),k=p.vec3f64.create(),z=p.vec3f64.create(),U=c.mat4f64.create(),B=s.mat3f64.create(),G=h.create(),H=[new f];t.default=j}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(118),r(156),r(151),r(179),r(1247),r(1249),r(1703)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){var p=o.getLogger("esri.geometry.support.MeshComponent");return function(e){function t(t){var r=e.call(this,t)||this;return r.faces=null,r.material=null,r.shading="source",r.trustSourceNormals=!1,r}var n;return r.__extends(t,e),n=t,t.from=function(e){return s.ensureClass(n,e)},t.prototype.castFaces=function(e){return u.castArray(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},p)},t.prototype.castMaterial=function(e){return e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?s.ensureClass(c,e):s.ensureClass(l,e)},t.prototype.clone=function(){return new n({faces:i.clone(this.faces),shading:this.shading,material:i.clone(this.material),trustSourceNormals:this.trustSourceNormals})},t.prototype.cloneWithDeduplication=function(e,t){return new n({faces:i.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals})},r.__decorate([a.property({json:{write:!0}})],t.prototype,"faces",void 0),r.__decorate([a.cast("faces")],t.prototype,"castFaces",null),r.__decorate([a.property({type:l,json:{write:!0}})],t.prototype,"material",void 0),r.__decorate([a.cast("material")],t.prototype,"castMaterial",null),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"shading",void 0),r.__decorate([a.property({type:Boolean})],t.prototype,"trustSourceNormals",void 0),n=r.__decorate([a.subclass("esri.geometry.support.MeshComponent")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(118),r(156),r(151)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=o.getLogger("esri.geometry.support.MeshVertexAttributes"),l=function(e){function t(t){var r=e.call(this,t)||this;return r.color=null,r.position=new Float64Array(0),r.uv=null,r.normal=null,r.tangent=null,r}var n;return r.__extends(t,e),n=t,t.prototype.castColor=function(e){return u(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},s)},t.prototype.castPosition=function(e){return e&&e instanceof Float32Array&&s.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),u(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},s)},t.prototype.castUv=function(e){return u(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},s)},t.prototype.castNormal=function(e){return u(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},s)},t.prototype.castTangent=function(e){return u(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},s)},t.prototype.clone=function(){var e={position:i.clone(this.position),uv:i.clone(this.uv),normal:i.clone(this.normal),tangent:i.clone(this.tangent),color:i.clone(this.color)};return new n(e)},r.__decorate([a.property({json:{write:p}})],t.prototype,"color",void 0),r.__decorate([a.cast("color")],t.prototype,"castColor",null),r.__decorate([a.property({nonNullable:!0,json:{write:p}})],t.prototype,"position",void 0),r.__decorate([a.cast("position")],t.prototype,"castPosition",null),r.__decorate([a.property({json:{write:p}})],t.prototype,"uv",void 0),r.__decorate([a.cast("uv")],t.prototype,"castUv",null),r.__decorate([a.property({json:{write:p}})],t.prototype,"normal",void 0),r.__decorate([a.cast("normal")],t.prototype,"castNormal",null),r.__decorate([a.property({json:{write:p}})],t.prototype,"tangent",void 0),r.__decorate([a.cast("tangent")],t.prototype,"castTangent",null),n=r.__decorate([a.subclass("esri.geometry.support.MeshVertexAttributes")],t)}(n.JSONSupport);function c(e,t,r,n){var i=t.loggerTag,o=t.stride;return e.length%o!=0?(n.error(i,"Invalid array length, expected a multiple of "+o),new r([])):e}function u(e,t,r,n,i){if(!e)return e;if(e instanceof t)return c(e,n,t,i);for(var o=0,a=r;o<a.length;o++)if(e instanceof a[o])return c(new t(e),n,t,i);if(Array.isArray(e))return c(new t(e),n,t,i);var s=r.map((function(e){return"'"+e.name+"'"}));return i.error("Failed to set property, expected one of "+s+", but got "+e.constructor.name),new t([])}function p(e,t,r){t[r]=function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}(e)}t.MeshVertexAttributes=l,t.castArray=u,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(272),r(276),r(185),r(162),r(160),r(192),r(340)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function p(e,t,r,i,o,s){if(t){var c=o.isWGS84,u=r.count;if(c)for(var p=0;p<u;p++)i.getVec(p,d),t.getVec(p,h),l.computeLinearTransformation(l.SphericalECEFSpatialReference,d,f,l.SphericalECEFSpatialReference),n.mat3.fromMat4(v,f),1===e&&n.mat3.transpose(v,v),a.vec3.transformMat3(h,h,v),s.setVec(p,h);else for(p=0;p<u;p++){i.getVec(p,d),t.getVec(p,h),l.computeLinearTransformation(l.SphericalECEFSpatialReference,d,f,l.SphericalECEFSpatialReference),n.mat3.fromMat4(v,f);var m=l.webMercator.y2lat(r.get(p,1)),y=Math.cos(m);0===e&&(y=1/y),v[0]*=y,v[1]*=y,v[2]*=y,v[3]*=y,v[4]*=y,v[5]*=y,1===e&&n.mat3.transpose(v,v),a.vec3.transformMat3(h,h,v),a.vec3.normalize(h,h),s.setVec(p,h)}return s}}t.projectNormalToECEF=function(e,t,r,n,i){return n.isWebMercator||n.isWGS84?(p(0,c.BufferViewVec3f.fromTypedArray(e),c.BufferViewVec3f64.fromTypedArray(t),c.BufferViewVec3f64.fromTypedArray(r),n,c.BufferViewVec3f.fromTypedArray(i)),i):(u.error("Cannot convert PCS spatial reference buffer to ECEF"),i)},t.projectNormalFromECEF=function(e,t,r,n,i){return n.isWebMercator||n.isWGS84?(p(1,c.BufferViewVec3f.fromTypedArray(e),c.BufferViewVec3f64.fromTypedArray(t),c.BufferViewVec3f64.fromTypedArray(r),n,c.BufferViewVec3f.fromTypedArray(i)),i):(u.error("Cannot convert to PCS spatial reference buffer from ECEF"),i)},t.projectToECEF=function(e,t,r){return l.bufferToBuffer(e,t,0,r,l.SphericalECEFSpatialReference,0,e.length/3),r},t.projectFromECEF=function(e,t,r){return l.bufferToBuffer(e,l.SphericalECEFSpatialReference,0,t,r,0,e.length/3),t},t.transformBufferInPlace=function(e,t,r){if(void 0===r&&(r=!1),e)for(var n=0;n<e.length;n+=3){for(var i=0;i<3;i++)d[i]=e[n+i];for(a.vec3.transformMat4(d,d,t),r&&a.vec3.normalize(d,d),i=0;i<3;i++)e[n+i]=d[i]}},t.projectTangentToECEF=function(e,t,r,n,i){if(!n.isWebMercator&&!n.isWGS84)return u.error("Cannot convert PCS spatial reference buffer to ECEF"),i;p(0,c.BufferViewVec3f.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),c.BufferViewVec3f64.fromTypedArray(t),c.BufferViewVec3f64.fromTypedArray(r),n,c.BufferViewVec3f.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT));for(var o=3;o<e.length;o+=4)i[o]=e[o];return i},t.projectTangentFromECEF=function(e,t,r,n,i){if(!n.isWebMercator&&!n.isWGS84)return u.error("Cannot convert to PCS spatial reference buffer from ECEF"),i;p(1,c.BufferViewVec3f.fromTypedArray(e,16),c.BufferViewVec3f64.fromTypedArray(t),c.BufferViewVec3f64.fromTypedArray(r),n,c.BufferViewVec3f.fromTypedArray(i,16));for(var o=3;o<e.length;o+=4)i[o]=e[o];return i};var d=s.vec3f64.create(),h=s.vec3f64.create(),f=o.mat4f64.create(),v=i.mat3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(223),r(256),r(345),r(253),r(257),r(260),r(228),r(373),r(1251),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v){Object.defineProperty(t,"__esModule",{value:!0});var m=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.stipplePattern=null,n.stippleTextureBind=null,n.stippleTextureRepository=t.stippleTextureRepository,n}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:n.stippleEnabled,stippleOffColorEnabled:n.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:n.stippleIntegerRepeatsEnabled});return new f(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),p.Default3D)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},t.prototype.bindPass=function(e,t,r){if(this.stipplePattern!==t.stipplePattern){var n=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.configuration.stippleEnabled){var o=i.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*r.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/o),this.program.setUniform2f("ndcToPixel",r.viewport[2]/2,r.viewport[3]/2)}if(0===this.configuration.output){if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*r.pixelRatio)),this.configuration.stippleOffColorEnabled){var a=i.unwrap(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],a.length>3?a[3]:1)}}else s.OutputHighlight.bindOutputHighlight(e,this.program,r)},t.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),o.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=v.separateBlendingParams(770,1,771,771),r=function(t,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),v.makePipelineState({blending:r,depthTest:d.depthCompareLess,depthWrite:n,colorWrite:v.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?d.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null})};return 0===e.output?(this._occludeeState=r(!0,e.transparent||e.stippleEnabled?t:null,v.defaultDepthWriteParams),r(!1,e.transparent||e.stippleEnabled?t:null,v.defaultDepthWriteParams)):r(!1)},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),t.shader=new l.ReloadableShaderModule(h,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1251)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(c.ShaderTechnique);t.NativeLineTechnique=m;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.sceneHasOcludees=!1,t}return n.__extends(t,e),n.__decorate([u.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([u.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"sliceHighlightDisabled",void 0),n.__decorate([u.parameter()],t.prototype,"vertexColors",void 0),n.__decorate([u.parameter()],t.prototype,"transparent",void 0),n.__decorate([u.parameter()],t.prototype,"stippleEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"stippleOffColorEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"stippleIntegerRepeatsEnabled",void 0),n.__decorate([u.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(u.ShaderTechniqueConfiguration);t.NativeLineTechniqueConfiguration=y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(118),r(152),r(171),r(189),r(185),r(162),r(160),r(201),r(193),r(577),r(495),r(277),r(346),r(1707),r(419),r(262),r(1708),r(1252),r(807),r(936),r(593),r(450),r(192),r(195),r(1724),r(937),r(540)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E){Object.defineProperty(t,"__esModule",{value:!0});var I=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._removeResource=null,o._optionalFields=[],o._instanceIndexToGraphicUid=new Map,o.ensureDrapedStatus(!1),o}return r.__extends(t,e),t.prototype.getCachedSize=function(){var e=this._symbolSize;return{width:e[0],depth:e[1],height:e[2]}},t.prototype.doLoad=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:if(t=this._getIdHint("_objectmat"),!this._drivenProperties.size&&_.validateSymbolLayerSize(this.symbolLayer))throw new Error;return n=this.symbolLayer,this.isByResource?[4,this._prepareModelResources(n.resource.href,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:i=n.resource?n.resource.primitive:h.defaultPrimitive,this._preparePrimitiveResources(i,t),r.label=3;case 3:return[2]}}))}))},Object.defineProperty(t.prototype,"isByResource",{get:function(){return!(!this.symbolLayer.resource||!this.symbolLayer.resource.href)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0}),t.prototype.setMaterialTransparencyParams=function(e,t){void 0===t&&(t=o.get(this.symbolLayer,"material","color"));var r=this._getCombinedOpacity(t),n=r<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=r,e},t.prototype._preparePrimitiveResources=function(e,t){if(!S.isValidPrimitive(e))throw new Error("Unknown object symbol primitive: "+e);var r=this.symbolLayer;this._resourceBoundingBox=d.create(S.primitiveBoundingBox(e)),this._resourceSize=u.vec3f64.fromArray(d.size(this._resourceBoundingBox)),this._symbolSize=u.vec3f64.fromArray(_.computeSizeWithResourceSize(this._resourceSize,r)),this._isEsriSymbolResource=!1,this._isWosr=!1;var s={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:u.vec3f64.ONES,diffuse:u.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:this.symbolLayer.isPrimitive};this._physicalBasedRenderingEnabled=s.usePBR,this.setMaterialTransparencyParams(s);var l=this.symbol;if("point-3d"===l.type&&l.verticalOffset){var c=l.verticalOffset,h=c.screenLength,f=c.minWorldLength,v=c.maxWorldLength;s.verticalOffset={screenLength:a.pt2px(h),minWorldLength:f||0,maxWorldLength:null!=v?v:1/0},s.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(s.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)s.externalColor=p.vec4f64.ONES;else{var m=o.isSome(r.material)&&r.material.color,y=o.isSome(m)?n.toUnitRGBA(m):p.vec4f64.ONES;s.externalColor=y}this._fastUpdates=T.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(i.mixin(s,this._fastUpdates.materialParameters),s.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(s.instanced.push("color"),this._optionalFields.push("color"));var g=new E(s,t);if(this._lodResources=S.primitiveLodResources(e,g,t),this._originalMaterialParameters=A.materialsFromLodResources(this._lodResources).map((function(e){return{opacity:1,transparent:e.getParameters().transparent}})),!this._lodResources)throw new Error("Unknown object symbol primitive: "+e);this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity()},t.prototype._prepareModelResources=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,s,l,c,p,h,f,v,m,y,g,w,S,P,O,C,M,E=this;return r.__generator(this,(function(r){switch(r.label){case 0:return s={instanced:n=["transformation"],slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},l={materialParamsMixin:s,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=T.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(i.mixin(l.materialParamsMixin,this._fastUpdates.materialParameters),n.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(n.push("color"),this._optionalFields.push("color")),"point-3d"===(c=this.symbol).type&&c.verticalOffset&&(p=c.verticalOffset,h=p.screenLength,f=p.minWorldLength,v=p.maxWorldLength,l.materialParamsMixin.verticalOffset={screenLength:a.pt2px(h),minWorldLength:f||0,maxWorldLength:null!=v?v:1/0},l.materialParamsMixin.castShadows=!1),l.signal=t,l.usePBR=this._context.physicalBasedRenderingEnabled,this._physicalBasedRenderingEnabled=l.usePBR,[4,x.fetch(e,l)];case 1:return m=r.sent(),this._isEsriSymbolResource=m.isEsriSymbolResource,this._isWosr=m.isWosr,this._removeResource=m.remove,y=b.makeLodResources(m.lods),b.fillEstimatedMinScreenSpaceRadius(y),y.levels.sort((function(e,t){return e.minScreenSpaceRadius-t.minScreenSpaceRadius})),y.levels[0].minScreenSpaceRadius=Math.min(2,y.levels[0].minScreenSpaceRadius),this._lodResources=y,g=this._context,w=this.symbolLayer.material,S=this._getExternalColorParameters(w),P=o.get(this.symbolLayer,"material","color"),O=this._getCombinedOpacity(P,{hasIntrinsicColor:!0}),C=this.needsDrivenTransparentPass,M=A.materialsFromLodResources(this._lodResources),this._originalMaterialParameters=A.materialsFromLodResources(this._lodResources).map((function(e){var t=e.getParameters();return{opacity:t.opacity||1,transparent:t.transparent}})),M.forEach((function(e){var t=e.getParameters();e.setParameterValues(S);var r=t.opacity*O,n=r<1||C||t.transparent;e.setParameterValues({opacity:r,transparent:n}),g.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:g.sharedResources.screenSizePerspectiveSettings})})),this._resourceBoundingBox=m.referenceBoundingBox,this._resourceSize=u.vec3f64.fromArray(d.size(this._resourceBoundingBox)),this._pivotOffset=u.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),this._symbolSize=u.vec3f64.fromArray(_.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),T.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&M.forEach((function(e){return e.setParameterValues(E._fastUpdates.materialParameters)})),this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity(),[2]}}))}))},t.prototype._finalizeSymbolResources=function(){var e=this._context.stage;this._materials=A.materialsFromLodResources(this._lodResources),this._physicalBasedRenderingEnabled!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),this._materials.forEach((function(t){e.add(3,t)})),this._textures=A.texturesFromLodResources(this._lodResources),this._textures.forEach((function(t){e.add(4,t)})),this._geometries=A.geometriesFromLodResources(this._lodResources),this._geometries.forEach((function(t){e.add(2,t)}))},t.prototype._initializeLodRenderer=function(){var e=this,t=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:function(t){return e._instanceIndexToGraphicUid.get(t)},notifyGraphicUpdate:function(t,r){return e._context.notifyGraphicUpdate(e._instanceIndexToGraphicUid.get(t),r)}},n=this._fastUpdates.enabled?{applyTransform:function(t,r,n){t.getFeatureAttribute(r,j),s.mat4.copy(n,T.evaluateModelTransform(e._fastUpdates.materialParameters,j,n))},scaleFactor:function(t,r,n){return r.getFeatureAttribute(n,j),T.evaluateModelTransformScale(t,e._fastUpdates.materialParameters,j)}}:null;this._lodRenderer=new M.LodRenderer(this._lodResources,this._optionalFields,r,n),this._lodRenderer.slicePlane=this._context.slicePlaneEnabled,t.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)},t.prototype._getExternalColorParameters=function(e){var t={};return this._drivenProperties.color?t.externalColor=p.vec4f64.ONES:o.isSome(e)&&o.isSome(e.color)?t.externalColor=n.toUnitRGBA(e.color):(t.externalColor=p.vec4f64.ONES,t.colorMixMode="ignore"),t},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this._context.stage;o.isSome(this._lodRenderer)&&(t.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy()),o.isSome(this._materials)&&this._materials.forEach((function(e){return t.remove(3,e.id)})),o.isSome(this._textures)&&this._textures.forEach((function(e){return t.remove(4,e.id)})),o.isSome(this._geometries)&&this._geometries.forEach((function(e){return t.remove(2,e.id)})),o.isSome(this._removeResource)&&this._removeResource()},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=w.placePointOnGeometry(t.geometry);if(o.isNone(r))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;var n=this.setGraphicElevationContext(t,new m.ElevationContext),i=e.renderingInfo;return this._createAs3DShape(t,r,i,n,t.uid)},t.prototype.notifyDestroyGraphicLayer=function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)},t.prototype.graphicLayerToGraphicId=function(){return 0},t.prototype.layerOpacityChanged=function(){var e=this;if(o.isNone(this._materials))return!0;var t=this._drivenProperties.opacity,r=this.isByResource;return this._materials.forEach((function(n,i){var a=o.get(e.symbolLayer,"material","color"),s=e._originalMaterialParameters[i],l=e._getCombinedOpacity(a,{hasIntrinsicColor:r})*s.opacity;n.setParameterValues({opacity:l,transparent:l<1||t||s.transparent})})),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,v.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(){var e=this;return!(!o.isNone(this._lodRenderer)&&!o.isNone(this._materials)&&(this._lodRenderer.slicePlane=this._context.slicePlaneEnabled,this._materials.forEach((function(t){t.setParameterValues({slicePlaneEnabled:e._context.slicePlaneEnabled})})),0))},t.prototype.physicalBasedRenderingChanged=function(){var e=this;return!!o.isNone(this._materials)||(this._materials.forEach((function(t){e.isByResource?e._isEsriSymbolResource&&!e._isWosr&&t.setParameterValues({usePBR:e._context.physicalBasedRenderingEnabled,isSchematic:!1}):t.setParameterValues({usePBR:e._context.physicalBasedRenderingEnabled,isSchematic:!0})})),!0)},t.prototype.pixelRatioChanged=function(){return!0},t.prototype.applyRendererDiff=function(e,t){var r=this;if(o.isNone(this._materials)||o.isNone(this._lodRenderer))return!0;for(var n in e.diff)switch(n){case"visualVariables":if(!T.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._materials.forEach((function(e){return e.setParameterValues(r._fastUpdates.materialParameters)})),this._lodRenderer.notifyShaderTransformationChanged();break;default:return!1}return!0},t.prototype.computeComplexity=function(){return this._lodResources?{primitivesPerFeature:A.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce((function(e,t){return e+t.data.getIndices(C.VertexAttrConstants.POSITION).length}),0)/3,primitivesPerCoordinate:0,estimated:!1,memory:P.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer)}:e.prototype.computeComplexity.call(this)},t.prototype._createAs3DShape=function(e,t,r,n,i){if(o.isNone(this._lodRenderer))return null;var a=this.getFastUpdateAttrValues(e),s=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?_.mixinColorAndOpacity(r.color,r.opacity):null,l=this._context.clippingExtent;if(O.pointToVector(t,R,this._context.elevationProvider.spatialReference),o.isSome(l)&&!d.containsPoint(l,R))return null;var c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(t,n,L,c?V:null),p=this._computeLocalTransform(this.symbolLayer,r,D),h=this._lodRenderer.instanceData,m=h.addInstance();this._instanceIndexToGraphicUid.set(m,i),h.setLocalTransform(m,p,!1),h.setGlobalTransform(m,u),a&&h.setFeatureAttribute(m,a),s&&h.setColor(m,s);var g=f.perLodInstanceElevationAligner,b=new y(this,m,g,n);return c&&(b.alignedSampledElevation=V.sampledElevation),b.needsElevationUpdates=v.needsElevationUpdates3D(n.mode),w.extendPointGraphicElevationContext(b,t,this._context.elevationProvider),b},t.prototype._computeGlobalTransform=function(e,t,r,n){var i=v.evaluateElevationAlignmentAtPoint(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,n);return R[0]=e.x,R[1]=e.y,R[2]=i,O.computeLinearTransformation(e.spatialReference,R,r,this._context.renderCoordsHelper.spatialReference),r},t.prototype._computeLocalTransform=function(e,t,r){return s.mat4.identity(r),this._applyObjectRotation(t,!1,r),this._applyObjectRotation(e,!0,r),this._applyObjectScale(t,r),this._applyAnchor(e,r),r},t.prototype._applyObjectScale=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var r=this._drivenProperties.size&&e.size?e.size:this._symbolSize,n=_.computeObjectScale(r,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||s.mat4.scale(t,t,n)}},t.prototype.prepareSymbolLayerPatch=function(e){if("partial"===e.diff.type){var t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}},t.prototype.updateGeometry=function(e,t){if(o.isNone(this._lodRenderer))return!0;var r=t&&w.placePointOnGeometry(t);if(o.isNone(r))return!1;var n=this.getGeometryElevationMode(t);if(e.elevationContext.mode!==n)return!1;var i=this._requiresTerrainElevation(e.elevationContext);return this._computeGlobalTransform(r,e.elevationContext,L,i?V:null),i&&(e.alignedSampledElevation=V.sampledElevation),this._lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,L,!0),w.extendPointGraphicElevationContext(e,r,this._context.elevationProvider),!0},t.prototype._preparePatchTransform=function(e,t){var r=this;if(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition){var n=this._lodRenderer;if(!o.isNone(n)){var i=function(e,t,r){return o.unwrapOr(null!=e&&"complete"===e.type?e.newValue:t,r)},a=i(t.heading,this.symbolLayer.heading,0),s=i(t.tilt,this.symbolLayer.tilt,0),l=i(t.roll,this.symbolLayer.roll,0),c=i(t.width,this.symbolLayer.width,void 0),p=i(t.height,this.symbolLayer.height,void 0),d=i(t.depth,this.symbolLayer.depth,void 0),h=i(t.anchor,this.symbolLayer.anchor,void 0),f=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;var v={heading:a,tilt:s,roll:l,anchor:h,anchorPosition:f};1===this.loadStatus&&e.symbolLayerStatePatches.push((function(){r._symbolSize=u.vec3f64.fromArray(_.computeSizeWithResourceSize(r._resourceSize,{width:c,height:p,depth:d,isPrimitive:r.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((function(e,t){var i=r._computeLocalTransform(v,t,D),o=e.instanceIndex;n.instanceData.setLocalTransform(o,i,!0)}))}}},t.prototype._preparePatchColor=function(e,t){var r=this;if(t.material&&"partial"===t.material.type){var i=t.material.diff;if(i.color&&"complete"===i.color.type&&null!=i.color.newValue&&null!=i.color.oldValue){var a=i.color.newValue,s=o.isSome(a)?n.toUnitRGBA(a):p.vec4f64.ONES;delete i.color;var l=this._materials,c=this._lodRenderer;o.isNone(l)||o.isNone(c)||e.graphics3DGraphicPatches.push((function(e){var t;r._hasPerInstanceColor()?(c.instanceData.setColor(e.instanceIndex,s),t=r.setMaterialTransparencyParams({},a)):t=r.setMaterialTransparencyParams({externalColor:s},a);for(var n=0,i=l;n<i.length;n++)i[n].setParameterValues(t)}))}}},t.prototype._requiresTerrainElevation=function(e){return"absolute-height"!==e.mode},t.prototype._applyObjectRotation=function(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return _.computeObjectRotation(e.heading,e.tilt,e.roll,r)},t.prototype._computeAnchor=function(e){var t=u.vec3f64.create();switch(e.anchor){case"center":c.vec3.copy(t,d.center(this._resourceBoundingBox)),c.vec3.negate(t,t);break;case"top":var r=d.center(this._resourceBoundingBox);c.vec3.set(t,-r[0],-r[1],-this._resourceBoundingBox[5]);break;case"bottom":r=d.center(this._resourceBoundingBox),c.vec3.set(t,-r[0],-r[1],-this._resourceBoundingBox[2]);break;case"relative":r=d.center(this._resourceBoundingBox);var n=d.size(this._resourceBoundingBox),i=e.anchorPosition,o=i?u.vec3f64.fromValues(i.x,i.y,i.z):u.vec3f64.ZEROS;c.vec3.multiply(t,n,o),c.vec3.add(t,t,r),c.vec3.negate(t,t);break;case"origin":default:this._pivotOffset?c.vec3.negate(t,this._pivotOffset):c.vec3.copy(t,u.vec3f64.ZEROS)}return t},t.prototype._applyAnchor=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var r=this._computeAnchor(e);r&&s.mat4.translate(t,t,r)}},t.prototype._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._resourceBoundingBox?u.vec3f64.fromArray(d.size(this._resourceBoundingBox)):u.vec3f64.ONES,t=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):u.vec3f64.ZEROS,r=this._context.renderCoordsHelper.unitInMeters,n=_.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,r),i=u.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:e,symbolSize:this._symbolSize||u.vec3f64.ONES,unitInMeters:r,transformation:{anchor:t,scale:n,rotation:i}}},t}(g.default);t.Graphics3DObjectSymbolLayer=I;var R=u.vec3f64.create(),D=l.mat4f64.create(),L=l.mat4f64.create(),j=p.vec4f64.create(),V={verticalDistanceToGround:0,sampledElevation:0};t.default=I}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(185),r(162),r(160),r(193),r(448),r(262),r(445)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=function(){function e(e,t,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}return e.prototype.initialize=function(){},e.prototype.setVisibility=function(e){var t=this.lodRenderer.instanceData;return e!==t.getVisible(this.instanceIndex)&&(t.setVisible(this.instanceIndex,e),!0)},e.prototype.destroy=function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))},e.prototype.alignWithElevation=function(e,t,r){if(this.elevationAligner){s.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var n=this.elevationAligner(this,this.elevationContext,e,t);null!=n&&(this.alignedSampledElevation=n)}},e.prototype.getBSRadius=function(){var e=this.lodRenderer;return e.baseBoundingSphere.radius*e.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v),i.vec3.transformMat4(e,this.lodRenderer.baseBoundingSphere.center,v)},e.prototype.getBoundingBoxObjectSpace=function(e){void 0===e&&(e=a.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v);var t=this.lodRenderer.baseBoundingBox;a.empty(e);for(var r=0;r<8;++r)i.vec3.set(d,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),i.vec3.transformMat4(d,d,v),a.expandPointInPlace(e,d);return e},e.prototype.computeAttachmentOrigin=function(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,v),e.render.origin[0]+=v[12],e.render.origin[1]+=v[13],e.render.origin[2]+=v[14],e.render.num++},e.prototype.getProjectedBoundingBox=function(e,t,n,o,s){return r.__awaiter(this,void 0,void 0,(function(){var c,u,m,y,g,_,b,x,w;return r.__generator(this,(function(r){switch(r.label){case 0:for(c=this.getBoundingBoxObjectSpace(s),u=f,m=a.isPoint(c)?1:u.length,this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,v),_=0;_<m;_++)y=u[_],d[0]=c[y[0]],d[1]=c[y[1]],d[2]=c[y[2]],i.vec3.transformMat4(d,d,v),p[3*_+0]=d[0],p[3*_+1]=d[1],p[3*_+2]=d[2];if(!e(p,0,m))return[2,null];for(a.empty(c),g=null,this.calculateRelativeScreenBounds&&(g=this.calculateRelativeScreenBounds()),_=0;_<3*m;_+=3){for(b=0;b<3;b++)c[b]=Math.min(c[b],p[_+b]),c[b+3]=Math.max(c[b+3],p[_+b]);g&&n.push({location:p.slice(_,_+3),screenSpaceBoundingRect:g})}if(!t)return[3,5];if(a.center(c,h),"absolute-height"===this.elevationContext.mode)return[3,5];x=void 0,w=l.demResolutionForBoundingBox(c,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.service.queryElevation(h[0],h[1],o,w)];case 2:return x=r.sent(),[3,4];case 3:return r.sent(),x=null,[3,4];case 4:null!=x&&a.offset(c,0,0,-this.alignedSampledElevation+x),r.label=5;case 5:return[2,c]}}))}))},e.prototype.addObjectState=function(e,t){var r=this;if(0===e){var n=c.generateObject3DStateId(e);this.addHighlightId(n),t.addExternal((function(e){r.removeHighlightId(e)}),n)}},e.prototype.removeObjectState=function(e){this.highlights&&this.highlights.forEach((function(t){return e.remove(t)}))},e.prototype.addHighlightId=function(e){this.highlights=this.highlights||new Set,this.highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)},e.prototype.removeHighlightId=function(e){this.highlights&&(this.highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this.highlights.size>0),0===this.highlights.size&&(this.highlights=null))},Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0}),e}(),p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=o.vec3f64.create(),h=o.vec3f64.create(),f=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=n.mat4f64.create();return u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(937)],void 0===(i=function(e,t,r){function n(e){var t=[];return e.stageResources.geometries.forEach((function(r,n){var i=e.stageResources.materials[n],o=e.stageResources.textures;t.push({material:i,geometry:r,textures:o})})),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function i(e,t){void 0===t&&(t=o);var n=r.computeFaceCount(e);return Math.sqrt(n/(t*Math.PI))}Object.defineProperty(t,"__esModule",{value:!0}),t.makeLodLevelResources=n,t.makeLodResources=function(e){return{levels:e.map((function(e){return n(e)}))}},t.estimateMinScreenSpaceRadius=i,t.fillEstimatedMinScreenSpaceRadius=function(e){e.levels.forEach((function(e){e.minScreenSpaceRadius||(e.minScreenSpaceRadius=i(e))}))};var o=.05}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(156)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n.getLogger("esri.views.3d.glTF"),o=function(){function e(){}return e.prototype.error=function(e){throw new r("gltf-loader-error",e)},e.prototype.errorUnsupported=function(e){throw new r("gltf-loader-unsupported-feature",e)},e.prototype.errorUnsupportedIf=function(e,t){e&&this.errorUnsupported(t)},e.prototype.assert=function(e,t){e||this.error(t)},e.prototype.warn=function(e){i.warn(e)},e.prototype.warnUnsupported=function(e){this.warn("[Unsupported Feature] "+e)},e.prototype.warnUnsupportedIf=function(e,t){e&&this.warnUnsupported(t)},e}();t.DefaultErrorContext=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.makeMaterialParameters=function(e){return void 0===e&&(e={}),r.__assign({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)},t.makeTextureSource=function(e,t){return void 0===t&&(t={}),{data:e,parameters:r.__assign({wrap:r.__assign({s:10497,t:10497},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177),r(153),r(229),r(172),r(172),r(1255),r(189),r(185),r(444),r(647),r(1712),r(1713),r(1714),r(340),r(952)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){var g;Object.defineProperty(t,"__esModule",{value:!0});var _=1179937895,b=function(){function e(e,t,r,n,i){this.context=e,this.errorContext=t,this.uri=r,this.json=n,this.glbBuffer=i,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=v.splitURI(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==n.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==n.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==n.nodes,"Nodes must be defined."),this.computeNodeParents()}return e.load=function(t,n,i,a){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,p,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:if(s.isDataProtocol(i)){if("model/gltf-binary"!==(l=s.dataComponents(i)).mediaType)try{return c=JSON.parse(l.isBase64?atob(l.data):l.data),[2,new e(t,n,i,c)]}catch(e){}if(u=s.dataToArrayBuffer(i),e.isGLBData(u))return[2,this.fromGLBData(t,n,i,u)]}return o.endsWith(i,".gltf")?[4,t.loadJSON(i,a)]:[3,2];case 1:return p=r.sent(),[2,new e(t,n,i,p)];case 2:return[4,t.loadBinary(i,a)];case 3:return d=r.sent(),e.isGLBData(d)?[2,this.fromGLBData(t,n,i,d)]:[4,t.loadJSON(i,a)];case 4:return h=r.sent(),[2,new e(t,n,i,h)]}}))}))},e.isGLBData=function(e){var t=new h.BinaryStreamReader(e);return t.remainingBytes()>=4&&t.readUint32()===_},e.fromGLBData=function(t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,e.parseGLBData(n,o)];case 1:return a=r.sent(),[2,new e(t,n,i,a.json,a.binaryData)]}}))}))},e.parseGLBData=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,c,u,p;return r.__generator(this,(function(r){switch(r.label){case 0:n=new h.BinaryStreamReader(t),e.assert(n.remainingBytes()>=12,"GLB binary data is insufficiently large."),i=n.readUint32(),o=n.readUint32(),a=n.readUint32(),e.assert(i===_,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=a,"GLB binary data is smaller than header specifies."),e.errorUnsupportedIf(2!==o,"An unsupported GLB container version was detected. Only version 2 is supported."),s=0,r.label=1;case 1:return n.remainingBytes()>=8?(u=n.readUint32(),p=n.readUint32(),0!==s?[3,3]:(e.assert(1313821514===p,"First GLB chunk must be JSON."),e.assert(u>=0,"No JSON data found."),[4,C(n.readUint8Array(u))])):[3,5];case 2:return l=r.sent(),[3,4];case 3:1===s?(e.errorUnsupportedIf(5130562!==p,"Second GLB chunk expected to be BIN."),c=n.readUint8Array(u)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),r.label=4;case 4:return s+=1,[3,1];case 5:return l||e.error("No GLB JSON chunk detected."),[2,{json:l,binaryData:c}]}}))}))},e.prototype.getBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.json.buffers[e],i=this.errorContext,null==n.uri?(i.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(o=this.bufferCache.get(e))?[3,2]:[4,this.context.loadBinary(this.resolveUri(n.uri),t)];case 1:a=r.sent(),o=new Uint8Array(a),this.bufferCache.set(e,o),i.assert(o.byteLength===n.byteLength,"Buffer byte lengths should match."),r.label=2;case 2:return[2,o]}}))}))},e.prototype.getAccessor=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.json.accessors[e],(i=this.errorContext).errorUnsupportedIf(null==n.bufferView,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(n.type in["MAT2","MAT3","MAT4"],"AttributeType "+n.type+" is not supported"),o=this.json.bufferViews[n.bufferView],[4,this.getBuffer(o.buffer,t)];case 1:return a=r.sent(),s=P[n.type],l=T[n.componentType],c=s*l,u=o.byteStride||c,[2,{raw:a.buffer,byteStride:u,byteOffset:a.byteOffset+(o.byteOffset||0)+(n.byteOffset||0),entryCount:n.count,isDenselyPacked:u===c,componentCount:s,componentByteSize:l,componentType:n.componentType,min:n.min,max:n.max,normalized:!!n.normalized}]}}))}))},e.prototype.getIndexData=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return null==e.indices?[2,null]:[4,this.getAccessor(e.indices,t)];case 1:if((n=r.sent()).isDenselyPacked)switch(n.componentType){case 5121:return[2,new Uint8Array(n.raw,n.byteOffset,n.entryCount)];case 5123:return[2,new Uint16Array(n.raw,n.byteOffset,n.entryCount)];case 5125:return[2,new Uint32Array(n.raw,n.byteOffset,n.entryCount)]}else switch(n.componentType){case 5121:return[2,y.scalar.makeDense(this.wrapAccessor(m.BufferViewUint8,n))];case 5123:return[2,y.scalar.makeDense(this.wrapAccessor(m.BufferViewUint16,n))];case 5125:return[2,y.scalar.makeDense(this.wrapAccessor(m.BufferViewUint32,n))]}return[2,void 0]}}))}))},e.prototype.getPositionData=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=this.errorContext).errorUnsupportedIf(null==e.attributes.POSITION,"No POSITION vertex data found."),[4,this.getAccessor(e.attributes.POSITION,t)];case 1:return i=r.sent(),n.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+A[i.componentType]),n.errorUnsupportedIf(3!==i.componentCount,"POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),[2,this.wrapAccessor(m.BufferViewVec3f,i)]}}))}))},e.prototype.getNormalData=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=this.errorContext).assert(null!=e.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(e.attributes.NORMAL,t)];case 1:return i=r.sent(),n.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+A[i.componentType]),n.errorUnsupportedIf(3!==i.componentCount,"NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),[2,this.wrapAccessor(m.BufferViewVec3f,i)]}}))}))},e.prototype.getTangentData=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=this.errorContext).assert(null!=e.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(e.attributes.TANGENT,t)];case 1:return i=r.sent(),n.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+A[i.componentType]),n.errorUnsupportedIf(4!==i.componentCount,"TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed()),[2,new m.BufferViewVec4f(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)]}}))}))},e.prototype.getTextureCoordinates=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=this.errorContext).assert(null!=e.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),[4,this.getAccessor(e.attributes.TEXCOORD_0,t)];case 1:return i=r.sent(),n.errorUnsupportedIf(2!==i.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed()),5126===i.componentType?[2,this.wrapAccessor(m.BufferViewVec2f,i)]:(n.errorUnsupportedIf(!i.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),[2,O(i)])}}))}))},e.prototype.getVertexColors=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=this.errorContext).assert(null!=e.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(e.attributes.COLOR_0,t)];case 1:if(i=r.sent(),n.errorUnsupportedIf(4!==i.componentCount&&3!==i.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed()),4===i.componentCount){if(5126===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec4f,i)];if(5121===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec4u8,i)];if(5123===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec4u16,i)]}else if(3===i.componentCount){if(5126===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec3f,i)];if(5121===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec3u8,i)];if(5123===i.componentType)return[2,this.wrapAccessor(m.BufferViewVec3u16,i)]}return n.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+A[i.componentType]),[2,void 0]}}))}))},e.prototype.hasPositions=function(e){return void 0!==e.attributes.POSITION},e.prototype.hasNormals=function(e){return void 0!==e.attributes.NORMAL},e.prototype.hasVertexColors=function(e){return void 0!==e.attributes.COLOR_0},e.prototype.hasTextureCoordinates=function(e){return void 0!==e.attributes.TEXCOORD_0},e.prototype.hasTangents=function(e){return void 0!==e.attributes.TANGENT},e.prototype.getMaterial=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,c,u,p,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.errorContext,(i=this.materialCache.get(e.material))?[3,15]:(o=null!=e.material?f.material(this.json.materials[e.material]):f.material(),a=o.pbrMetallicRoughness,s=this.hasVertexColors(e),l=void 0,a.baseColorTexture?(n.errorUnsupportedIf(0!==(a.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),[4,this.getTexture(a.baseColorTexture.index,t)]):[3,2]);case 1:l=r.sent(),r.label=2;case 2:return c=void 0,o.normalTexture?0===(o.normalTexture.texCoord||0)?[3,3]:(n.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."),[3,5]):[3,5];case 3:return[4,this.getTexture(o.normalTexture.index,t)];case 4:c=r.sent(),r.label=5;case 5:return u=void 0,o.occlusionTexture?0===(o.occlusionTexture.texCoord||0)?[3,6]:(n.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."),[3,8]):[3,8];case 6:return[4,this.getTexture(o.occlusionTexture.index,t)];case 7:u=r.sent(),r.label=8;case 8:return p=void 0,o.emissiveTexture?0===(o.emissiveTexture.texCoord||0)?[3,9]:(n.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."),[3,11]):[3,11];case 9:return[4,this.getTexture(o.emissiveTexture.index,t)];case 10:p=r.sent(),r.label=11;case 11:return d=void 0,a.metallicRoughnessTexture?0===(a.metallicRoughnessTexture.texCoord||0)?[3,12]:(n.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."),[3,14]):[3,14];case 12:return[4,this.getTexture(a.metallicRoughnessTexture.index,t)];case 13:d=r.sent(),r.label=14;case 14:h=null!=e.material?e.material:-1,i={alphaMode:o.alphaMode,alphaCutoff:o.alphaCutoff,color:a.baseColorFactor,doubleSided:!!o.doubleSided,colorTexture:l,normalTexture:c,name:o.name,id:h,occlusionTexture:u,emissiveTexture:p,emissiveFactor:o.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:d,vertexColors:s,ESRI_externalColorMixMode:o.extras.ESRI_externalColorMixMode},r.label=15;case 15:return[2,i]}}))}))},e.prototype.getTexture=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,l,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.errorContext,i=this.json.textures[e],o=f.textureSampler(null!=i.sampler?this.json.samplers[i.sampler]:{}),n.errorUnsupportedIf(null==i.source,"Source is expected to be defined for a texture."),a=this.json.images[i.source],(s=this.textureCache.get(e))?[3,6]:(l=void 0,a.uri?[4,this.context.loadImage(this.resolveUri(a.uri),t)]:[3,2]);case 1:return l=r.sent(),[3,5];case 2:return n.errorUnsupportedIf(null==a.bufferView,"Image bufferView must be defined."),n.errorUnsupportedIf(null==a.mimeType,"Image mimeType must be defined."),c=this.json.bufferViews[a.bufferView],[4,this.getBuffer(c.buffer,t)];case 3:return u=r.sent(),n.errorUnsupportedIf(null!=c.byteStride,"byteStride not supported for image buffer"),[4,M(new Uint8Array(u.buffer,u.byteOffset+(c.byteOffset||0),c.byteLength),a.mimeType)];case 4:l=r.sent(),r.label=5;case 5:s={data:l,wrapS:o.wrapS,wrapT:o.wrapT,minFilter:o.minFilter,name:a.name,id:e},this.textureCache.set(e,s),r.label=6;case 6:return[2,s]}}))}))},e.prototype.getNodeTransform=function(e){if(void 0===e)return w;var t=this.nodeTransformCache.get(e);if(!t){var r=this.getNodeTransform(this.getNodeParent(e)),n=this.json.nodes[e];n.matrix?t=c.mat4.multiply(u.mat4f64.create(),r,n.matrix):n.translation||n.rotation||n.scale?(t=u.mat4f64.clone(r),n.translation&&c.mat4.translate(t,t,n.translation),n.rotation&&(S[3]=p.quat.getAxisAngle(S,n.rotation),c.mat4.rotate(t,t,S[3],S)),n.scale&&c.mat4.scale(t,t,n.scale)):t=r,this.nodeTransformCache.set(e,t)}return t},e.prototype.wrapAccessor=function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)},e.prototype.resolveUri=function(e){return a.makeAbsolute(e,this.baseUri)},e.prototype.getNodeParent=function(e){return this.nodeParentMap.get(e)},e.prototype.checkVersionSupported=function(){var e=l.Version.parse(this.json.asset.version,"glTF");x.validate(e)},e.prototype.checkRequiredExtensionsSupported=function(){var e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))},e.prototype.computeNodeParents=function(){var e=this;this.json.nodes.forEach((function(t,r){t.children&&t.children.forEach((function(t){e.nodeParentMap.set(t,r)}))}))},e}();t.Resource=b;var x=new l.Version(2,0,"glTF"),w=c.mat4.fromXRotation(u.mat4f64.create(),Math.PI/2),S=d.quatf64.create(),P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},T=((g={})[5120]=1,g[5121]=1,g[5122]=2,g[5123]=2,g[5126]=4,g[5125]=4,g);function O(e){switch(e.componentType){case 5120:return new m.BufferViewVec2i8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new m.BufferViewVec2u8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new m.BufferViewVec2i16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new m.BufferViewVec2u16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new m.BufferViewVec2u32(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new m.BufferViewVec2f(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void n.neverReached(e.componentType)}}function C(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,i.create((function(t,r){var n=new Blob([e]),i=new FileReader;i.onload=function(){var e=i.result;t(JSON.parse(e))},i.onerror=function(e){r(e)},i.readAsText(n)}))]}))}))}function M(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,i.create((function(r,n){var i=new Blob([e],{type:t}),o=URL.createObjectURL(i),a=new Image;a.addEventListener("load",(function(){URL.revokeObjectURL(o),"decode"in a?a.decode().then((function(){return r(a)}),(function(){return r(a)})):r(a)})),a.addEventListener("error",(function(e){URL.revokeObjectURL(o),n(e)})),a.src=o}))]}))}))}var A={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}return e.prototype.readUint32=function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]},e.prototype.readUint8Array=function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)},e.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4},e}();t.BinaryStreamReader=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(177)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},o={pbrMetallicRoughness:i,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},a={ESRI_externalColorMixMode:"tint"};t.material=function(e){void 0===e&&(e={});var t=r.__assign(r.__assign({},i),e.pbrMetallicRoughness),s=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:n.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}(r.__assign(r.__assign({},a),e.extras));return r.__assign(r.__assign(r.__assign({},o),e),{pbrMetallicRoughness:t,extras:s})};var s={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};t.textureSampler=function(e){return r.__assign(r.__assign({},s),e)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.splitURI=function(e){var t,r;return e.replace(/^(.*\/)?([^/]*)$/,(function(e,n,i){return t=n||"",r=i||"",""})),{dirPart:t,filePart:r}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u){for(var p=0;p<9;++p)n[l+p]=o[c+p];l+=i,c+=a}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u){for(var p=0;p<16;++p)n[l+p]=o[c+p];l+=i,c+=a}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u)n[l]=o[c],l+=i,c+=a},t.makeDense=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var n=0;n<r;n++)t[n]=e.get(n);return t}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(916)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u)n[l]=o[c],n[l+1]=o[c+1],l+=i,c+=a}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=n,t.normalizeIntegerBuffer=function(e,t,i){var o=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,l=t.typedBufferStride,c=i?i.count:t.count,u=(i&&i.dstIndex?i.dstIndex:0)*a,p=(i&&i.srcIndex?i.srcIndex:0)*l;if(r.isInteger(t.elementType)){var d=r.maximumValue(t.elementType);if(r.isSigned(t.elementType))for(var h=0;h<c;++h)o[u]=Math.max(s[p]/d,-1),o[u+1]=Math.max(s[p+1]/d,-1),u+=a,p+=l;else for(h=0;h<c;++h)o[u]=s[p]/d,o[u+1]=s[p+1]/d,u+=a,p+=l}else n(e,t,i);return e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u)n[l]=o[c],n[l+1]=o[c+1],n[l+2]=o[c+2],l+=i,c+=a}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*a,u=0;u<s;++u)n[l]=o[c],n[l+1]=o[c+1],n[l+2]=o[c+2],n[l+3]=o[c+3],l+=i,c+=a},t.fill=function(e,t,r,n,i,o){for(var a=e.typedBuffer,s=e.typedBufferStride,l=o?o.count:e.count,c=(o&&o.dstIndex?o.dstIndex:0)*s,u=0;u<l;++u)a[c]=t,a[c+1]=r,a[c+2]=n,a[c+3]=i,c+=s}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(120),r(443)],void 0===(i=function(e,t,r,n){function i(e){return n.generateDefaultIndexArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.linearIndexArray=i,t.trianglesToTriangles=function(e){return"number"==typeof e?i(e):r.isUint16Array(e)||r.isUint8Array(e)?new Uint32Array(e):e},t.triangleStripToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,n=new Uint32Array(3*r);if("number"==typeof e)for(var i=0,o=0;o<r;o+=1)o%2==0?(n[i++]=o,n[i++]=o+1,n[i++]=o+2):(n[i++]=o+1,n[i++]=o,n[i++]=o+2);else for(i=0,o=0;o<r;o+=1)if(o%2==0){var a=e[o],s=e[o+1],l=e[o+2];n[i++]=a,n[i++]=s,n[i++]=l}else a=e[o+1],s=e[o],l=e[o+2],n[i++]=a,n[i++]=s,n[i++]=l;return n},t.triangleFanToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,n=new Uint32Array(3*r);if("number"==typeof e){for(var i=0,o=0;o<r;++o)n[i++]=0,n[i++]=o+1,n[i++]=o+2;return n}var a=e[0],s=e[1];for(i=0,o=0;o<r;++o){var l=e[o+2];n[i++]=a,n[i++]=s,n[i++]=l,s=l}return n}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1229),r(1723)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=r,t.vec4=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1230)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformMat4=function(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[3],c=n[4],u=n[5],p=n[6],d=n[7],h=n[8],f=n[9],v=n[10],m=n[11],y=n[12],g=n[13],_=n[14],b=n[15],x=e.typedBuffer,w=e.typedBufferStride,S=t.typedBuffer,P=t.typedBufferStride,T=0;T<i;T++){var O=T*w,C=T*P,M=S[C],A=S[C+1],E=S[C+2],I=S[C+3];x[O]=o*M+c*A+h*E+y*I,x[O+1]=a*M+u*A+f*E+g*I,x[O+2]=s*M+p*A+v*E+_*I,x[O+3]=l*M+d*A+m*E+b*I}else r.logger.error("source and destination buffers need to have the same number of elements")},t.transformMat3=function(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[3],c=n[4],u=n[5],p=n[6],d=n[7],h=n[8],f=e.typedBuffer,v=e.typedBufferStride,m=t.typedBuffer,y=t.typedBufferStride,g=0;g<i;g++){var _=g*v,b=g*y,x=m[b],w=m[b+1],S=m[b+2],P=m[b+3];f[_]=o*x+l*w+p*S,f[_+1]=a*x+c*w+d*S,f[_+2]=s*x+u*w+h*S,f[_+3]=P}else r.logger.error("source and destination buffers need to have the same number of elements")},t.scale=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*o,u=l*s;i[c]=r*a[u],i[c+1]=r*a[u+1],i[c+2]=r*a[u+2],i[c+3]=r*a[u+3]}},t.shiftRight=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*o,u=l*s;i[c]=a[u]>>r,i[c+1]=a[u+1]>>r,i[c+2]=a[u+2]>>r,i[c+3]=a[u+3]>>r}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(185),r(162),r(160),r(201),r(193),r(261),r(371),r(345),r(288),r(228),r(391),r(195),r(1725),r(1726),r(1727),r(1728),r(540),r(249),r(446),r(307),r(341),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S){Object.defineProperty(t,"__esModule",{value:!0});var P=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map((function(e){return e.minScreenSpaceRadius}));return new m.LevelSelector(t,r)};t.setLevelSelectorFactory=function(e){P=e};var T=function(){function e(e,t){var r=e.rctx,n=t.geometry,i=t.material,o=n.data.toRenderData();this.materialRep=e.materialRep,i.setParameterValues({instancedDoublePrecision:!0});var a=i.createBufferWriter(),s=a.vertexBufferLayout,c=a.elementCount(o),u=a.allocate(c);a.write({},o,u,0),this.geometry=n,this.material=i,this.glMaterials=b.acquireMaterials(i,this.materialRep),this.vertexBufferLayout=s,this.vbo=x.createVertex(r,35044,u.buffer),this.vao=new S(r,p.Default3D,{geometry:l.glLayout(s)},{geometry:this.vbo}),this.vertexCount=c}return e.prototype.destroy=function(){b.releaseMaterials(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()},Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0}),e.prototype.intersect=function(e,t,r,n,i,o){var a=this.geometry.id,s=i.toString();this.material.intersect(this.geometry,null,e.transform.transform,e,r,n,(function(r,n,l,c){if(r>=0){if(null!=t&&!t(e.rayBeginPoint,e.rayEndPoint,r))return;var u={type:"external",metadata:{layerUid:o.layerUid,graphicUid:o.graphicUid(i)}};if((null==e.results.min.drapedLayerOrder||c>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&(e.results.min.set(u,s,r,n,e.transform.transform,c,null,a,l),e.results.min.intersector="LodRenderer"),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||c>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&(e.results.max.set(u,s,r,n,e.transform.transform,c,null,a,l),e.results.min.intersector="LodRenderer"),2===e.options.store){var p=new d.IntersectorResult(e.results.min.ray);p.set(u,s,r,n,e.transform.transform,c,null,a,l),p.intersector="LodRenderer",e.results.all.push(p)}}}))},e}();t.LodComponentData=T;var O=function(){function e(e,t){var r=this;this.components=[],this.minScreenSpaceRadius=t.minScreenSpaceRadius,t.components.forEach((function(t){r.components.push(new T(e,t))}))}return e.prototype.destroy=function(){this.components.forEach((function(e){e.destroy()}))},e.prototype.intersect=function(e,t,r,n,i,o){this.components.forEach((function(a){a.intersect(e,t,r,n,i,o)}))},Object.defineProperty(e.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var e=a.empty();this.components.forEach((function(t){a.expand(e,t.boundingInfo.bbMin),a.expand(e,t.boundingInfo.bbMax)})),this._boundingBox=e}return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var e=this.boundingBox,t=i.vec3f64.create();a.center(e,t),this._boundingSphere={center:t,radius:.5*a.diameter(e)}}return this._boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.components.reduce((function(e,t){return e+t.triangleCount}),0)},enumerable:!0,configurable:!0}),e}();t.LodLevelData=O;var C=function(){function e(e,r,n,i){var o=this;this.type="Lod",this.isGround=!1,this._levels=[],this._renderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new u.default,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.canRender=!0,this._symbol=e,this._optionalFields=r,this._metadata=n,this._instanceBufferLayout=g.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=l.glLayout(this._instanceBufferLayout,{divisor:1}),this._instanceData=new f.InstanceData(this._optionalFields,i),this._instanceData.on("instance-added",(function(){o.requestUpdateCycle()})),this._instanceData.on("instance-removed",(function(){o.requestUpdateCycle()})),this._instanceData.on("instance-transform-changed",(function(e){o.requestUpdateCycle(),o._metadata.notifyGraphicUpdate(e.index,2)})),this._instanceData.on("instance-visibility-changed",(function(e){o.requestUpdateCycle(!0),o._metadata.notifyGraphicUpdate(e.index,1)})),this._instanceData.on("instance-highlight-changed",(function(){o.requestUpdateCycle(!0)})),this._enableLevelSelection=this._symbol.levels.length>1,t.lodRenderers.push(this)}return e.prototype.destroy=function(){t.lodRenderers.splice(t.lodRenderers.indexOf(this),1)},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlane",{get:function(){return this._slicePlane},set:function(e){this._slicePlane=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var e={cpu:0,gpu:0};return this._renderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),this._highlightRenderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderStats",{get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach((function(t,n){var i=e._renderInstanceData[n],o=e._highlightRenderInstanceData[n],a=i.size+o.size,s=t.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*s,trianglesPerInstance:s})})),{totalInstances:t,renderedInstances:r.reduce((function(e,t){return e+t.renderedInstances}),0),renderedTriangles:r.reduce((function(e,t){return e+t.renderedTriangles}),0),levels:r}},enumerable:!0,configurable:!0}),e.prototype.initializeRenderContext=function(e){var t=this;this._initContext=e;var r=e.rctx;this._symbol.levels.forEach((function(n){t._levels.push(new O(e,n)),t._renderInstanceData.push(new y.RenderInstanceData(r,t._instanceBufferLayout)),t._highlightRenderInstanceData.push(new y.RenderInstanceData(r,t._instanceBufferLayout))})),this._levelSelector=P(this)},e.prototype.uninitializeRenderContext=function(){this.invalidateOctree(),this._levels.forEach((function(e){e.destroy()})),this._renderInstanceData.forEach((function(e){e.destroy()})),this._highlightRenderInstanceData.forEach((function(e){e.destroy()}))},Object.defineProperty(e.prototype,"slots",{get:function(){return[4,6]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this._highlightRenderInstanceData.reduce((function(e,t){return e+t.size}),0)>0},enumerable:!0,configurable:!0}),e.prototype.prepareRender=function(e){this.runUpdates(e)},e.prototype.render=function(e){var t=this,r=e.rctx,n=4===e.slot?3:6===e.slot?5:null;if(n){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;var i=e.camera,o={slot:n,view:i.viewMatrix,proj:i.projectionMatrix,origin:[0,0,0],viewInvTransp:i.viewInverseTransposeMatrix,viewport:i.fullViewport,fovY:i.fovY,nearFar:[i.near,i.far],shadowMap:e.shadowMap,shadowMappingEnabled:!!e.shadowMap&&e.shadowMap.enabled,ssaoEnabled:!!e.ssaoHelper&&e.ssaoHelper.enabled,pixelRatio:i.pixelRatio,slicePlane:e.sliceHelper&&e.sliceHelper.plane,cameraAboveGround:i.aboveGround,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1};r.bindVAO();for(var a=function(r){var i=e.isHighlightPass?s._highlightRenderInstanceData[r]:s._renderInstanceData[r];s._levels[r].components.forEach((function(a){t.renderComponent(e,n,o,i,a,r)}))},s=this,l=0;l<this._levels.length;++l)a(l);return!0}},e.prototype.intersect=function(e,t,r,o){var a=this;if(this.baseMaterial.isVisible()){var s=i.vec3f64.create();n.vec3.subtract(s,o,r);var l=function(i){a._instanceData.getCombinedModelTransform(i,I),e.transform.set(I),n.vec3.transformMat4(R,r,e.transform.inverse),n.vec3.transformMat4(D,o,e.transform.inverse);var s=a._instanceData.getState(i),l=a._instanceData.getLodLevel(i);h.assert(s&f.StateFlags.ACTIVE,"invalid instance state"),h.assert(l>=0&&l<a._levels.length,"invaid lod level"),a._levels[l].intersect(e,t,R,D,i,a._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(r,s,l)}},e.prototype.queryDepthRange=function(e){return this.queryDepthRangeOctree(e)},e.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()},e.prototype.requestUpdateCycle=function(e){void 0===e&&(e=!1),this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._initContext.requestRender()},Object.defineProperty(e.prototype,"needsUpdates",{get:function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1},enumerable:!0,configurable:!0}),e.prototype.runUpdates=function(e){if(!s.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var t=e.equals(this._lastCamera);this._lastCamera.copyFrom(e),t||this.requestUpdateCycle()}var r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(e,r),this.needsUpdates&&this._initContext.requestRender()}},Object.defineProperty(e.prototype,"octree",{get:function(){return this._octree||(this._octree=this.buildOctree()),this._octree},enumerable:!0,configurable:!0}),e.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)},e.prototype.buildOctree=function(){for(var e=new v.InstanceOctree(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null,n=0;n<this._instanceData.capacity;++n)r.get(n)&f.StateFlags.ACTIVE&&e.addInstance(n);return e},e.prototype.queryDepthRangeOctree=function(e){var t=e.eye,r=e.viewForward,i=this.octree.findClosest(r,"front-to-back",e.frustum),o=this.octree.findClosest(r,"back-to-front",e.frustum);if(null!=i&&null!=o){this._instanceData.view.boundingSphere.getVec(i,E),n.vec3.subtract(E,E,t);var a=n.vec3.dot(E,r)-E[3];this._instanceData.view.boundingSphere.getVec(o,E),n.vec3.subtract(E,E,t);var s=n.vec3.dot(E,r)+E[3];return{near:Math.max(e.near,a),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}},e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++,this._renderInstanceData.forEach((function(e){e.startUpdateCylce()})),this._highlightRenderInstanceData.forEach((function(e){e.startUpdateCylce()})),this.needsUpdates&&this._initContext.requestRender()},e.prototype.updateInstances=function(e,t){var r=this._enableLevelSelection,n=this._levelSelector;n.updateCamera(e),this._renderInstanceData.forEach((function(e){e.beginUpdate()})),this._highlightRenderInstanceData.forEach((function(e){e.beginUpdate()}));var i=this._instanceData,o=this._instanceData.view,a=i.size,s=i.capacity,l=this._instanceIndex;t=Math.min(a,t);for(var c=0;c<t;++c){0===l&&this.startUpdateCycle();var u=o.state.get(l),p=0;if(u&f.StateFlags.ALLOCATED){var d=o.lodLevel.get(l);if(u&f.StateFlags.ACTIVE&&this._renderInstanceData[d].freeTail(),u&f.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[d].freeTail(),u&f.StateFlags.REMOVE)i.freeInstance(l);else if(u&f.StateFlags.VISIBLE){var h=0;if(r&&(o.modelOrigin.getVec(l,A),h=n.selectLevel(A,i.getCombinedMedianScaleFactor(l))),p=u&~(f.StateFlags.ACTIVE|f.StateFlags.HIGHLIGHT_ACTIVE|f.StateFlags.TRANSFORM_CHANGED),h>=0){var v=this._renderInstanceData[h],m=v.allocateHead();if(M(o,l,v.view,m),p|=f.StateFlags.ACTIVE,u&f.StateFlags.HIGHLIGHT){var y=this._highlightRenderInstanceData[h],g=y.allocateHead();M(o,l,y.view,g),p|=f.StateFlags.HIGHLIGHT_ACTIVE}}o.state.set(l,p),o.lodLevel.set(l,h)}else p=u&~(f.StateFlags.ACTIVE|f.StateFlags.HIGHLIGHT_ACTIVE|f.StateFlags.TRANSFORM_CHANGED),o.state.set(l,p);if(this._octree){var _=!!(u&f.StateFlags.ACTIVE),b=!!(p&f.StateFlags.ACTIVE);!_&&b?this._octree.addInstance(l):_&&!b?this._octree.removeInstance(l):_&&b&&u&f.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l))}l=(l+1)%s}else l=(l+1)%s,t++}this._instanceIndex=l,this._renderInstanceData.forEach((function(e){e.endUpdate()})),this._highlightRenderInstanceData.forEach((function(e){e.endUpdate()}))},e.prototype.renderComponent=function(e,t,r,n,i,o){var a=i.glMaterials.get(e.pass);if(a&&a.beginSlot(t)&&0!==n.size){var l=e.rctx,u=l.capabilities.instancing;a.ensureParameters(r);var d=a.getTechnique(),f=a.getPipelineState(t);l.setPipelineState(f),a.bind(l,r),l.bindVAO(i.vao),d.ensureAttributeLocations(i.vao);var v=d.program;e.isHighlightPass&&c.OutputHighlight.bindOutputHighlight(l,v,r),d.bindDraw(r),s.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(v.setUniform4fv("externalColor",L[Math.min(o,L.length-1)]),v.setUniform1i("colorMixMode",_.colorMixModes.replace));var m=n.capacity,y=n.headIndex,g=n.tailIndex,b=n.firstIndex,x=this._glInstanceBufferLayout,S=function(e,t){w.bindVertexBufferLayout(l,p.Default3D,n.buffer,x,e),u.drawArraysInstanced(d.primitiveType,0,i.vertexCount,t-e),w.unbindVertexBufferLayout(l,p.Default3D,n.buffer,x)};i.material.getParameters().transparent&&null!=b?y>g?(h.assert(b>=g&&b<=y,"invalid firstIndex"),S(b,y),S(g,b)):y<g&&(b<=y?(h.assert(b>=0&&b<=y,"invalid firstIndex"),S(b,y),S(g,m),S(0,b)):(h.assert(b>=g&&b<=m,"invalid firstIndex"),S(b,m),S(0,y),S(g,b))):y>g?S(g,y):y<g&&(S(0,y),S(g,m)),l.bindVAO(null)}},e}();function M(e,t,r,n){b.encodeDoubleVec3(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,n),r.model.copyFrom(n,e.model,t),r.modelNormal.copyFrom(n,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(n,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(n,e.featureAttribute,t)}t.LodRenderer=C,t.lodRenderers=[];var A=i.vec3f64.create(),E=o.vec4f64.create(),I=r.mat4f64.create(),R=i.vec3f64.create(),D=i.vec3f64.create(),L=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(190),r(272),r(276),r(189),r(185),r(162),r(160),r(251),r(340),r(317),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h){var f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.ACTIVE=2]="ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"}(f=t.StateFlags||(t.StateFlags={}));var v=function(e){this.localTransform=e.getField("localTransform",p.BufferViewMat4f64),this.globalTransform=e.getField("globalTransform",p.BufferViewMat4f64),this.modelOrigin=e.getField("modelOrigin",p.BufferViewVec3f64),this.model=e.getField("model",p.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",p.BufferViewMat3f),this.modelScaleFactors=e.getField("modelScaleFactors",p.BufferViewVec2f),this.boundingSphere=e.getField("boundingSphere",p.BufferViewVec4f64),this.color=e.getField("color",p.BufferViewVec4f),this.featureAttribute=e.getField("featureAttribute",p.BufferViewVec4f),this.state=e.getField("state",p.BufferViewUint8),this.lodLevel=e.getField("lodLevel",p.BufferViewUint8)};t.View=v;var m=function(e){function t(t,r){var n=e.call(this)||this;return n._capacity=0,n._size=0,n._next=0,n._layout=function(e){var t=d.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t.u8("state").u8("lodLevel").alignTo(8)}(t),n._shaderTransformation=r,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),t.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var e=this.findSlot();return this._view.state.set(e,f.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e},t.prototype.removeInstance=function(e){var t=this._view.state;h.assert(e>=0&&e<this._capacity&&t.get(e)&f.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,f.ACTIVE)?this.setStateFlags(e,f.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})},t.prototype.freeInstance=function(e){var t=this._view.state;h.assert(e>=0&&e<this._capacity&&t.get(e)&f.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--},t.prototype.setLocalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getLocalTransform=function(e,t){this._view.localTransform.getMat(e,t)},t.prototype.setGlobalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getGlobalTransform=function(e,t){this._view.globalTransform.getMat(e,t)},t.prototype.updateModelTransform=function(e){var t=this._view,r=_,n=b;t.localTransform.getMat(e,x),t.globalTransform.getMat(e,w);var o=a.mat4.multiply(w,w,x);l.vec3.set(r,o[12],o[13],o[14]),t.modelOrigin.setVec(e,r),i.mat3.fromMat4(n,o),t.model.setMat(e,n);var s=u.scaleFromMatrix(_,o);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),i.mat3.invert(n,n),i.mat3.transpose(n,n),t.modelNormal.setMat(e,n),this.setStateFlags(e,f.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})},t.prototype.getModelTransform=function(e,t){var r=this._view;r.model.getMat(e,b),r.modelOrigin.getVec(e,_),t[0]=b[0],t[1]=b[1],t[2]=b[2],t[3]=0,t[4]=b[3],t[5]=b[4],t[6]=b[5],t[7]=0,t[8]=b[6],t[9]=b[7],t[10]=b[8],t[11]=0,t[12]=_[0],t[13]=_[1],t[14]=_[2],t[15]=1},t.prototype.applyShaderTransformation=function(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)},t.prototype.getCombinedModelTransform=function(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedLocalTransform=function(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedMaxScaleFactor=function(e){var t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(_,this,e);t*=Math.max(r[0],r[1],r[2])}return t},t.prototype.getCombinedMedianScaleFactor=function(e){var t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(_,this,e);r.sort(),t*=r[1]}return t},t.prototype.getModel=function(e,t){this._view.model.getMat(e,t)},t.prototype.setFeatureAttribute=function(e,t){this._view.featureAttribute.setVec(e,t)},t.prototype.getFeatureAttribute=function(e,t){this._view.featureAttribute.getVec(e,t)},t.prototype.setColor=function(e,t){this._view.color.setVec(e,t)},t.prototype.getColor=function(e,t){this._view.color.getVec(e,t)},t.prototype.setVisible=function(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,f.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))},t.prototype.getVisible=function(e){return this.getStateFlag(e,f.VISIBLE)},t.prototype.setHighlight=function(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,f.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))},t.prototype.getHighlight=function(e){return this.getStateFlag(e,f.HIGHLIGHT)},t.prototype.getState=function(e){return this._view.state.get(e)},t.prototype.getLodLevel=function(e){return this._view.lodLevel.get(e)},t.prototype.countFlags=function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t},t.prototype.setStateFlags=function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)},t.prototype.clearStateFlags=function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)},t.prototype.setStateFlag=function(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)},t.prototype.getStateFlag=function(e,t){return!!(this._view.state.get(e)&t)},t.prototype.grow=function(){var e=Math.max(y,Math.floor(this._capacity*g)),t=this._layout.createBuffer(e);if(this._buffer){var r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new v(this._buffer)},t.prototype.findSlot=function(){for(var e=this._view.state,t=this._next;e.get(t)&f.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t},t}(n);t.InstanceData=m;var y=1024,g=2,_=c.vec3f64.create(),b=o.mat3f64.create(),x=s.mat4f64.create(),w=s.mat4f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(185),r(162),r(160),r(251),r(1218)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,r){var i=e.call(this,{getCenter:function(e){var t=i._instanceData.view.boundingSphere,r=i._tmpCenter;return r[0]=t.get(e,0),r[1]=t.get(e,1),r[2]=t.get(e,2),r},getRadius:function(e){return i._instanceData.view.boundingSphere.get(e,3)}},{maximumDepth:25})||this;return i._tmpCenter=o.vec3f64.create(),i._tmpMat4=n.mat4f64.create(),i._instanceData=t,i._boundingSphere=r,i}return r.__extends(t,e),t.prototype.addInstance=function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4),n=i.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,r),o=this._boundingSphere.radius*a.maxScale(r);t.set(e,0,n[0]),t.set(e,1,n[1]),t.set(e,2,n[2]),t.set(e,3,o),this.add(e)},t.prototype.removeInstance=function(e){this.remove(e)},t}(s);t.InstanceOctree=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(288)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.thresholdScale=1,this._camera=new r.default,this._worldSpaceRadius=e,this._thresholds=t.map((function(e){return e}))}return e.prototype.updateCamera=function(e){this._camera.copyFrom(e)},e.prototype.selectLevel=function(e,t){for(var r=this._camera.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/r,i=this._thresholds,o=-1,a=0;a<i.length;++a)n>=i[a]*this.thresholdScale&&(o=a);return o},e}();t.LevelSelector=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(195),r(1729)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){this.modelOriginHi=e.getField("modelOriginHi",r.BufferViewVec3f),this.modelOriginLo=e.getField("modelOriginLo",r.BufferViewVec3f),this.model=e.getField("model",r.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",r.BufferViewMat3f),this.color=e.getField("instanceColor",r.BufferViewVec4f),this.featureAttribute=e.getField("instanceFeatureAttribute",r.BufferViewVec4f)};t.View=o;var a=function(){function e(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}return e.prototype.destroy=function(){this._buffer&&this._buffer.destroy()},Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null},e.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0},e.prototype.beginUpdate=function(){n.assert(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex},e.prototype.endUpdate=function(){n.assert(this._updating,"not updating"),this.size<c*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1},e.prototype.allocateHead=function(){n.assert(this._updating,"not updating"),this.isFull&&this.grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),n.assert(this._headIndex!==this._tailIndex,"invalid pointers"),e},e.prototype.freeTail=function(){n.assert(this._updating,"not updating"),n.assert(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)},e.prototype.grow=function(){var e=Math.max(s,Math.floor(this._capacity*l));this.resize(e)},e.prototype.shrink=function(){if(p){var e=Math.max(s,Math.floor(this._capacity*u));this.resize(e)}},e.prototype.resize=function(e){if(n.assert(this._updating,"not updating"),e!==this._capacity){var t=new i(this._rctx,34962,35044,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,a=this.compactInstances(t);n.assert(a===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=a,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new o(this._instanceBufferLayout.createView(this._buffer.array))}},e.prototype.compactInstances=function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0},e.prototype.incrementHead=function(e){void 0===e&&(e=1),this._headIndex=(this._headIndex+e)%this._capacity},e.prototype.incrementTail=function(e){void 0===e&&(e=1),this._tailIndex=(this._tailIndex+e)%this._capacity},e.prototype.transferRange=function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))},e}();t.RenderInstanceData=a;var s=1024,l=2,c=.3,u=.5,p=!0}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(307)],void 0===(i=function(e,t,r){return function(){function e(e,t,n,i,o){this._elementSize=i,this._buffer=new r(e,t,n),this.resize(o)}return e.prototype.destroy=function(){this._buffer.dispose()},Object.defineProperty(e.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0}),e.prototype.copyRange=function(e,t,r,n){void 0===n&&(n=0);var i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(i)},e.prototype.transferAll=function(){this._buffer.setData(this._array)},e.prototype.transferRange=function(e,t){var r=e*this._elementSize,n=t*this._elementSize;this._buffer.setSubData(this._array,r,r,n)},e.prototype.resize=function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(118),r(168),r(152),r(1257),r(205),r(216),r(162),r(389),r(160),r(193),r(207),r(277),r(277),r(346),r(418),r(419),r(262),r(450),r(192),r(356),r(417),r(1732),r(540),r(1735)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function o(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._intrinsicSize=c.vec2f64.fromValues(1,1),o.upVectorAlignment="path",o.stencilWidth=.1,o.ensureDrapedStatus(!1),o}return r.__extends(o,e),o.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,o,s,c,u,p,h,f,v,m,y,g,_;return r.__generator(this,(function(r){switch(e=a.isSome(this.symbolLayer.width)?this.symbolLayer.width:a.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size,o=a.isSome(this.symbolLayer.height)?this.symbolLayer.height:e,this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,o],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},s=this.symbolLayer.anchor||"center",this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world"),c=this.symbolLayer.profile||"circle"){case"circle":default:this._profile=T.Profile.circle(t.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case"quad":this._profile=T.Profile.rect()}switch(u=[0,0],"center"!==s&&(u={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[s],this._profile.translate(u[0],u[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new T.MiterExtruder(0,t.NUM_ROUND_JOIN_SUBDIVISIONS);break;case"bevel":this._extruder=new T.MiterExtruder(0,1);break;case"miter":this._extruder=new T.MiterExtruder(.8*Math.PI,1);break;case"simple":default:this._extruder=new T.SimpleExtruder}switch(p=this.symbolLayer.cap||"butt"){case"none":this._startCap=new T.NoCapBuilder,this._endCap=new T.NoCapBuilder;break;case"butt":default:this._startCap=new T.TriangulationCapBuilder(this._profile,0),this._endCap=new T.TriangulationCapBuilder(this._profile,0,!0);break;case"square":this._startCap=new T.TriangulationCapBuilder(this._profile,-.5),this._endCap=new T.TriangulationCapBuilder(this._profile,.5,!0);break;case"round":h="quad"===c,this._startCap=new T.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:h,subdivisions:t.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new T.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:h,subdivisions:t.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}if(f=this._getIdHint(),v=a.get(this.symbolLayer,"material","color"),m=this._getCombinedOpacityAndColor(v),y=d.vec3f64.fromArray(m),g=m[3],_={diffuse:y,ambient:y,opacity:g,transparent:g<1||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===p?0:void 0,offsetTransparentBackfaces:!0},!this._drivenProperties.size&&(l.vec2.set(this._intrinsicSize,e,o),!b.isValidSize(this._intrinsicSize[0])||!b.isValidSize(this._intrinsicSize[1])))throw new n("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||l.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(i.mixin(_,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new C(_,f+"_pathmat")):(_.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new O(_,f+"_pathmat")),this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(3,this._material),[2]}))}))},o.prototype.destroy=function(){e.prototype.destroy.call(this),this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)},o.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometryType(t.geometry,o.validGeometryTypes,this.symbolLayer.type))return null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,n=this.setGraphicElevationContext(t,new y.ElevationContext),i=e.renderingInfo;return this._createAs3DShape(t,i,n,r,t.uid)},o.prototype.layerOpacityChanged=function(){var e=a.get(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({opacity:t,transparent:r}),!0},o.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,m.needsElevationUpdates3D)},o.prototype.slicePlaneEnabledChanged=function(){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},o.prototype.physicalBasedRenderingChanged=function(){return this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0},o.prototype.pixelRatioChanged=function(){return!0},o.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!x.updateFastSymbolUpdatesState(this._fastUpdates,t,this._vvConvertOptions))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},o.prototype.getVertexData=function(e){for(var t=0,r=e.paths,n=[],i=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference,s=0,l=r;s<l.length;s++)t+=(v=l[s]).length;for(var c=new Float64Array(3*t),u=new Float64Array(3*t),p=new Float64Array(3*t),d=0,h=0,f=r;h<f.length;h++){var v=f[h];n.push({index:d,numVertices:v.length});for(var m=0,y=v;m<y.length;m++){var g=y[m];c[d++]=g[0],c[d++]=g[1],c[d++]=e.hasZ?g[2]:0}}var _=!0;return i.equals(o)?this._copyVertices(c,0,u,0,t):_=w.bufferToBuffer(c,i,0,u,o,0,t),o.equals(a)?this._copyVertices(u,0,p,0,t):w.bufferToBuffer(u,o,0,p,a,0,t),{pathVertexDataInfos:n,vertexDataGS:c,vertexDataES:u,vertexDataRS:p,projectionSuccess:_,terrainElevation:0}},o.prototype._copyVertices=function(e,t,r,n,i){t*=3,n*=3;for(var o=0;o<i;++o)r[n++]=e[t++],r[n++]=e[t++],r[n++]=e[t++]},o.prototype._createAs3DShape=function(e,t,r,n,i){var o=e.geometry,s=[],l=[],c=[],p=o.spatialReference,d=this._context.elevationProvider.spatialReference,f=h.create(),y=this._context.renderCoordsHelper;j.spatialReference=p,L.spatialReference=d;var b=this.getVertexData(o);if(!b.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(b.pathVertexDataInfos.length>0){for(var x=0;x<b.pathVertexDataInfos.length;++x){var w=b.pathVertexDataInfos[x],O=w.index,C=w.numVertices;if(C<2)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else if(!a.isSome(this._context.clippingExtent)||(h.empty(f),h.expandWithBuffer(f,b.vertexDataES,3*O,C),h.intersectsClippingArea(f,this._context.clippingExtent))){for(var M=[],I=O;I<O+3*C;){var D=I++,F=I++,N=I++,k=new T.PathVertex;u.vec3.set(k.posGS,b.vertexDataGS[D],b.vertexDataGS[F],b.vertexDataGS[N]),u.vec3.set(k.posES,b.vertexDataES[D],b.vertexDataES[F],b.vertexDataES[N]),L.x=k.posES[0],L.y=k.posES[1],L.z=k.posES[2];var z=v.evaluateElevationAlignmentAtPoint(L,this._context.elevationProvider,r,y,null);u.vec3.set(V,b.vertexDataRS[D],b.vertexDataRS[F],b.vertexDataRS[N]),y.setAltitude(z,V),u.vec3.set(k.pos,V[0],V[1],V[2]),M.push(k)}var U=new T.Path(M);A(U,this.upVectorAlignment,this._context.renderCoordsHelper);var B=new T.Builder(U,this._profile,this._extruder,this._startCap,this._endCap),G=null;if(this._fastUpdates.enabled){var H=this._fastUpdates.visualVariables,q=H.size?_.getAttributeValue(H.size.field,e):0,W=H.color?_.getAttributeValue(H.color.field,e):0,J=H.opacity?_.getAttributeValue(H.opacity.field,e):0;G=new T.FastUpdatePathGeometry(B,q,W,J)}else{var Z=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(Z[0]*=E(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),Z[1]*=E(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));var X=null;this._drivenProperties.color&&(X=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(X=X?[X[0],X[1],X[2],t.opacity]:[1,1,1,t.opacity]);var Y=new T.StaticPathGeometry(B);Y.bake(Z),X&&Y.bakeVertexColors(X),G=Y}var Q=G.createGeometryData(),K=new S(Q,n+"path"+x),$={pathGeometry:G,geometrySR:p,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};K.metadata=$,s.push(K),l.push(this._material),c.push(G.xform)}}var ee={layerUid:this._context.layer.uid,graphicUid:i};if(s.length>0){var te=new P({geometries:s,materials:l,transformations:c,castShadow:!0,metadata:ee,idHint:n}),re=new g(this,te,s,null,null,R,r);return re.alignedSampledElevation=b.terrainElevation,re.needsElevationUpdates=m.needsElevationUpdates3D(r.mode),re}}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null},o.validGeometryTypes=["polyline"],o}(_.Graphics3DSymbolLayer);function A(e,t,r){switch(t){case"world":for(var n=0,i=e.vertices;n<i.length;n++){var a=i[n];u.vec3.add(F,a.pos,e.offset),r.worldUpAtPosition(F,V),a.setFrameFromUpVector(V),a.computeRotationAxisAndAngleFromUpVector()}break;case"path":u.vec3.add(F,e.vertices[0].pos,e.offset),r.worldUpAtPosition(F,V),T.computeMinimumRotationTangentFrame(e,V);for(var l=0,c=e.vertices;l<c.length;l++){a=c[l];var p=o.sign(u.vec3.dot(a.frame.right,a.vRight));u.vec3.cross(a.rotationFrame.up,a.vRight,a.vLeft),u.vec3.scale(a.rotationFrame.up,a.rotationFrame.up,p),u.vec3.normalize(a.rotationFrame.up,a.rotationFrame.up);var d=u.vec3.dot(a.rotationFrame.up,a.frame.up),h=u.vec3.dot(a.rotationFrame.up,a.frame.right);if(u.vec3.scale(F,a.frame.up,-h),u.vec3.scale(N,a.frame.right,d),u.vec3.add(F,F,N),u.vec3.normalize(a.rotationFrame.right,F),T.vertexSpaceToProfileSpace(a.rotationRight,a.frame,a.rotationFrame.right),u.vec3.negate(F,a.vLeft),a.rotationAngle=-p*(Math.PI-o.acosClamped(u.vec3.dot(F,a.vRight))),Math.abs(a.rotationAngle)>0){var f=o.reciprocalClamped(Math.cos(.5*a.rotationAngle));s.mat2.set(a.miterStretch,1+(f-1)*a.rotationRight[0]*a.rotationRight[0],(f-1)*a.rotationRight[0]*a.rotationRight[1],(f-1)*a.rotationRight[0]*a.rotationRight[1],1+(f-1)*a.rotationRight[1]*a.rotationRight[1])}var v=Math.PI-a.rotationAngle;a.maxStretchDistance=Math.abs(Math.min(a.vLeftLength,a.vRightLength)*o.reciprocalClamped(Math.cos(.5*v)))}}}function E(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function I(e,t,r,n){for(var i=0,o=0,a=e.vertices;o<a.length;o++){var s=a[o];L.x=s.posES[0],L.y=s.posES[1],L.z=s.posES[2];var l=v.evaluateElevationAlignmentAtPoint(L,r,t,n,k);i+=k.sampledElevation,u.vec3.add(V,s.pos,e.offset),n.setAltitude(l,V),u.vec3.subtract(s.pos,V,e.offset)}return e.updatePathVertexInformation(),i/e.vertices.length}function R(e,t,r,n){var i=e.stageObject,o=i.geometryRecords,a=o.length,s=0;L.spatialReference=r.spatialReference,D.spatialReference=n.spatialReference;for(var l=0;l<a;l++){var c=o[l].geometry,u=c.metadata,p=u.pathGeometry,d=p.builder.path,h=u.geometrySR;j.spatialReference=h,s+=I(d,t,r,n),"world"!==d.upVector&&A(d,u.upVectorAlignment,n),p.onPathChanged(),c.invalidateBoundingInfo(),i.geometryVertexAttrsUpdated(l)}return s/a}t.Graphics3DPathSymbolLayer=M;var D=f.makeDehydratedPoint(0,0,0,null),L=f.makeDehydratedPoint(0,0,0,null),j=f.makeDehydratedPoint(0,0,0,null),V=d.vec3f64.create(),F=p.vec3f32.create(),N=p.vec3f32.create();t.NUM_ROUND_JOIN_SUBDIVISIONS=3,t.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3,t.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var k={verticalDistanceToGround:0,sampledElevation:0};t.default=M}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(412)],void 0===(i=function(e,t,r){function n(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*s+o*l,e[1]=i*s+a*l,e[2]=n*c+o*u,e[3]=i*c+a*u,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*o-i*n;return a?(a=1/a,e[0]=o*a,e[1]=-n*a,e[2]=-i*a,e[3]=r*a,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=n,t.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=n*-s+o*l,e[3]=i*-s+a*l,e},t.scale=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1];return e[0]=n*s,e[1]=i*s,e[2]=o*l,e[3]=a*l,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.mul=n,t.sub=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(1257),r(1733),r(189),r(185),r(205),r(216),r(162),r(160),r(203),r(326),r(442),r(195),r(1258),r(249)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y){var g;!function(e){function t(){return{up:p.vec3f64.create(),right:p.vec3f64.create()}}e.makeFrame=t,e.profileSpaceToVertexSpace=function(e,t,r){e[0]=r[0]*t.right[0]+r[1]*t.up[0],e[1]=r[0]*t.right[1]+r[1]*t.up[1],e[2]=r[0]*t.right[2]+r[1]*t.up[2]},e.vertexSpaceToProfileSpace=function(e,t,r){l.vec2.set(e,u.vec3.dot(r,t.right),u.vec3.dot(r,t.up))};var g=function(){function e(){this.pos=p.vec3f64.create(),this.posES=p.vec3f64.create(),this.posGS=p.vec3f64.create(),this.vRight=p.vec3f64.create(),this.vLeft=p.vec3f64.create(),this.frame=t(),this.rotationFrame=t(),this.rotationRight=c.vec2f64.create(),this.rotationAngle=0,this.miterStretch=o.mat2f64.create()}return e.prototype.setFrameFromUpVector=function(e){u.vec3.copy(this.frame.up,e),u.vec3.add(P,this.vLeft,this.vRight),u.vec3.normalize(P,P),u.vec3.scale(S,this.frame.up,u.vec3.dot(P,this.frame.up)),u.vec3.subtract(C,P,S),u.vec3.normalize(C,C),u.vec3.cross(this.frame.right,C,this.frame.up)},e.prototype.computeRotationAxisAndAngleFromUpVector=function(){u.vec3.copy(this.rotationFrame.up,this.frame.up),u.vec3.copy(this.rotationFrame.right,this.frame.right),l.vec2.set(this.rotationRight,1,0),u.vec3.scale(S,this.frame.up,u.vec3.dot(this.frame.up,this.vLeft)),u.vec3.subtract(S,this.vLeft,S),u.vec3.negate(S,S),u.vec3.normalize(S,S),u.vec3.scale(P,this.frame.up,u.vec3.dot(this.frame.up,this.vRight)),u.vec3.subtract(P,this.vRight,P),u.vec3.normalize(P,P),u.vec3.cross(T,this.rotationFrame.up,this.vLeft);var e=n.sign(u.vec3.dot(T,this.vRight));if(this.rotationAngle=e*(Math.PI-n.acosClamped(u.vec3.dot(S,P))),Math.abs(this.rotationAngle)>0){var t=n.reciprocalClamped(Math.cos(.5*this.rotationAngle));i.mat2.set(this.miterStretch,t-1+1,0,0,1)}var r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r))},e}();e.PathVertex=g;var E=function(){function e(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}return e.prototype.addVertex=function(e,t){return this.vertices.push(c.vec2f64.clone(e)),this.vertexNormals.push(c.vec2f64.clone(t)),this.vertices.length-1},e.prototype.addUV=function(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1},e.prototype.addPole=function(e,t){return void 0===t&&(t=null),this.poles.push({position:c.vec2f64.clone(e),normal:t?c.vec2f64.clone(t):null}),this.poles.length-1},e.prototype.addSegment=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))},Object.defineProperty(e.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0}),e.prototype.hasUV=function(){return null!=this.uvs},e.prototype.translate=function(e,t){for(var r=0,n=this.vertices;r<n.length;r++){var i=n[r];i[0]+=e,i[1]+=t}for(var o=0,a=this.poles;o<a.length;o++){var s=a[o];s.position[0]+=e,s.position[1]+=t}},e.circle=function(t){void 0===t&&(t=20);var r=new e,n={v0:0,v1:0};r.addPole(c.vec2f64.fromValues(0,0));for(var i=0;i<t;++i){var o=2*i*Math.PI/t,a=Math.cos(o),s=Math.sin(o),l=c.vec2f64.fromValues(.5*a,.5*s),u=c.vec2f64.fromValues(a,s);r.addVertex(l,u),r.addUV(i/t)}for(r.addUV(1),i=0;i<t-1;++i){var p={v0:i,v1:i+1},d=p;r.addSegment(p,d,n)}var h={v0:t-1,v1:0},f={v0:t-1,v1:t};return r.addSegment(h,f,n),r},e.rect=function(){var t=new e,r=c.vec2f64.fromValues(-.5,-.5),n=c.vec2f64.fromValues(.5,-.5),i=c.vec2f64.fromValues(.5,.5),o=c.vec2f64.fromValues(-.5,.5),a=c.vec2f64.fromValues(0,-1),s=c.vec2f64.fromValues(1,0),l=c.vec2f64.fromValues(0,1),u=c.vec2f64.fromValues(-1,0);t.addUV(0),t.addUV(1),t.addPole(c.vec2f64.fromValues(0,.5),l),t.addPole(c.vec2f64.fromValues(0,.5)),t.addPole(c.vec2f64.fromValues(0,-.5)),t.addPole(c.vec2f64.fromValues(0,-.5),a);var p={v0:0,v1:1};return t.addVertex(r,a),t.addVertex(n,a),t.addSegment({v0:0,v1:1},p,{v0:3,v1:3}),t.addVertex(n,s),t.addVertex(i,s),t.addSegment({v0:2,v1:3},p,{v0:2,v1:1}),t.addVertex(i,l),t.addVertex(o,l),t.addSegment({v0:4,v1:5},p,{v0:0,v1:0}),t.addVertex(o,u),t.addVertex(r,u),t.addSegment({v0:6,v1:7},p,{v0:1,v1:2}),t},e}();e.Profile=E;var I=function(){function e(e){this.vertices=[],this.offset=p.vec3f64.create(),this.xform=s.mat4f64.create(),this.vertices=e;var t=Math.floor((e.length-1)/2);u.vec3.copy(this.offset,this.vertices[t].pos);for(var r=0,n=this.vertices;r<n.length;r++){var i=n[r];u.vec3.subtract(i.pos,i.pos,this.offset)}a.mat4.translate(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}return e.prototype.updatePathVertexInformation=function(){var e=this.vertices.length,t=this.vertices[0];t.index=0,u.vec3.set(t.vLeft,0,0,0),t.vLeftLength=0,u.vec3.subtract(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=u.vec3.length(t.vRight),u.vec3.normalize(t.vRight,t.vRight);for(var r=t,n=1;n<e;++n)(t=this.vertices[n]).index=n,u.vec3.copy(t.vLeft,r.vRight),t.vLeftLength=r.vRightLength,n<e-1?(u.vec3.subtract(t.vRight,this.vertices[n+1].pos,t.pos),t.vRightLength=u.vec3.length(t.vRight),u.vec3.normalize(t.vRight,t.vRight)):(u.vec3.copy(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),r=t},e}();e.Path=I,e.computeMinimumRotationTangentFrame=function(e,t){var r=null,n=e.vertices.length,i=p.vec3f64.create(),o=p.vec3f64.create(),a=p.vec3f64.create(),s=p.vec3f64.create(),l=p.vec3f64.create(),c=p.vec3f64.create(),h=d.plane.create(),v=e.vertices[0];u.vec3.copy(o,t),u.vec3.set(i,0,1,0),f.makeOrthoBasisDirUpFallback(v.vRight,o,i,i,a,o,.99619469809),u.vec3.copy(v.frame.up,o),u.vec3.copy(v.frame.right,a),r=v;for(var m=1;m<n;++m){v=e.vertices[m],u.vec3.add(l,v.vLeft,v.vRight);var y=u.vec3.length(l);y>0?(y=1/Math.sqrt(y),l[0]=l[0]*y,l[1]=l[1]*y,l[2]=l[2]*y):(l[0]=v.vRight[0],l[1]=v.vRight[1],l[2]=v.vRight[2]),u.vec3.add(c,r.pos,r.frame.up),d.plane.fromPositionAndNormal(v.pos,l,h),d.plane.intersectRay(h,d.ray.wrap(c,v.vLeft),s)?(u.vec3.subtract(s,s,v.pos),u.vec3.normalize(o,s),u.vec3.cross(a,l,o),u.vec3.normalize(a,a)):f.makeOrthoBasisDirUpFallback(l,r.frame.up,r.frame.right,i,a,o,.99619469809),u.vec3.copy(v.frame.up,o),u.vec3.copy(v.frame.right,a),r=v}};e.Extruder=function(){};var R=function(){function e(){}return e.prototype.numProfilesPerJoin=function(){return 1},e.prototype.extrude=function(e,t,r){for(var n=0;n<t.vertices.length;++n)r(e.index,e.frame,t.vertices[n],t.vertexNormals[n],!1)},e}();e.SimpleExtruder=R;var D=function(){function e(e,t){void 0===e&&(e=.8*Math.PI),void 0===t&&(t=1),this.cutoffAngle=e,this.numBendSubdivisions=t}return e.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1},e.prototype.extrude=function(e,t,r){var n,i,o,s=M;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(var c=0;c<this.numBendSubdivisions+1;++c){a.mat4.identity(A),a.mat4.rotate(A,A,.5*-e.rotationAngle+c*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),n=s,i=e.frame,o=A,u.vec3.transformMat4(n.up,i.up,o),u.vec3.transformMat4(n.right,i.right,o);for(var p=0;p<t.vertices.length;++p)(d=l.vec2.dot(t.vertices[p],e.rotationRight)*e.rotationAngle>=0)?r(e.index,s,t.vertices[p],t.vertexNormals[p],!1):(l.vec2.transformMat2(b,t.vertices[p],e.miterStretch),r(e.index,e.frame,b,t.vertexNormals[p],!0))}else for(c=0;c<this.numBendSubdivisions+1;++c)for(p=0;p<t.vertices.length;++p){var d=l.vec2.dot(t.vertices[p],e.rotationRight)*e.rotationAngle>=0;l.vec2.transformMat2(b,t.vertices[p],e.miterStretch),r(e.index,e.frame,b,t.vertexNormals[p],!d)}},e}();e.MiterExtruder=D;var L={generateUV:!1},j=function(){function e(){}return e.prototype.rebuildConnectingProfileGeometry=function(e,t,r){for(var n=0;n<t.vertices.length;++n)r(e.index,e.frame,t.vertices[n],t.vertexNormals[n],0,0)},e}();e.CapBuilder=j;var V=function(e){function t(){return e.call(this)||this}return r.__extends(t,e),t.prototype.getNumVertices=function(){return 0},t.prototype.getNumIndices=function(){return 0},t.prototype.rebuildCapGeometry=function(){},t.prototype.buildTopology=function(){},t}(j);e.NoCapBuilder=V;var F=function(e){function t(t,r,n){void 0===r&&(r=0),void 0===n&&(n=!1);var i=e.call(this)||this;return i.profile=t,i.profilePlaneOffset=r,i.flip=n,i}return r.__extends(t,e),t.prototype.getNumVertices=function(){return this.profile.vertices.length},t.prototype.getNumIndices=function(){return 3*this.profile.numSegments},t.prototype.rebuildConnectingProfileGeometry=function(e,t,r){for(var n=0;n<t.vertices.length;++n)r(e.index,e.frame,t.vertices[n],t.vertexNormals[n],this.profilePlaneOffset,0)},t.prototype.rebuildCapGeometry=function(e,t){var r=x;l.vec2.set(r,0,0);for(var n=this.flip?1:-1,i=0;i<this.profile.vertices.length;++i)t(e.index,e.frame,this.profile.vertices[i],r,this.profilePlaneOffset,n)},t.prototype.buildTopology=function(e,t){for(var r=this.vertexBufferStart+this.profile.vertexIndices[0],n=1;n<this.profile.numSegments;++n){var i=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],a=this.vertexBufferStart+i,s=this.vertexBufferStart+o;this.flip?t(s,a,r):t(r,a,s)}},t}(j);e.TriangulationCapBuilder=F;var N=function(e){function t(t){var r=e.call(this)||this;return r.flip=!1,r.sign=0,r.breakNormals=!1,r.numSegments=3,r.profile=t.profile,r.flip=t.flip,r.sign=r.flip?1:-1,r.breakNormals=t.breakNormals,r.numSegments=t.subdivisions,r}return r.__extends(t,e),t.prototype.getNumVertices=function(){var e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+this.profile.poles.length},t.prototype.getNumIndices=function(){var e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(var t=0;t<this.profile.numSegments;++t){var r=this.profile.vertexIndices[2*t+0],n=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[n]?e+=1:e+=2}return 3*e},t.prototype.rebuildCapGeometry=function(e,t){var r=e.frame,n=.5*this.sign,i=b,o=x;l.vec2.set(o,0,0);for(var a=0;a<this.profile.poles.length;++a)(d=this.profile.poles[a]).normal?t(e.index,r,d.position,d.normal,n,0):t(e.index,r,d.position,o,n,this.sign);if(this.breakNormals)for(a=0;a<this.profile.vertices.length;++a)t(e.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(a=0;a<this.numSegments-1;++a)for(var s=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(s),u=Math.cos(s),p=0;p<this.profile.vertices.length;++p){var d=this.profile.poles[this.profile.poleIndices[p]];l.vec2.subtract(i,this.profile.vertices[p],d.position),l.vec2.scale(i,i,c),d.normal?(l.vec2.add(i,i,d.position),t(e.index,r,i,d.normal,n*u,0)):(l.vec2.normalize(o,i),l.vec2.scale(o,o,c),l.vec2.add(i,i,d.position),t(e.index,r,i,o,n*u,this.sign*u))}},t.prototype.buildTopology=function(e,t){for(var r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,i=0;i<this.profile.numSegments;++i){for(var o=this.profile.vertexIndices[2*i+0],a=this.profile.vertexIndices[2*i+1],s=this.vertexBufferStart+this.profile.poleIndices[o],l=this.vertexBufferStart+this.profile.poleIndices[a],c=r+o,u=r+a,p=0;p<this.numSegments-1;++p){var d=n+p*this.profile.vertices.length+o,h=n+p*this.profile.vertices.length+a;this.flip?(t(d,u,c),t(u,d,h)):(t(c,u,d),t(h,d,u)),c=d,u=h}this.flip?(t(s,u,c),s!==l&&t(s,l,u)):(t(c,u,s),s!==l&&t(u,l,s))}},t}(j);e.RoundCapBuilder=N;var k=function(){function e(e,t,r,n,i,o){void 0===o&&(o=L),this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=r,this.startCap=n,this.endCap=i;var a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;var s=this.startCap.getNumVertices();this.numVerticesTotal+=s,this.numNormalsTotal+=s,this.endCap.vertexBufferStart=this.numVerticesTotal;var l=this.endCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this.rebuildGeometry(),this.buildTopology()}return e.prototype.emitVertex=function(e,t,r,n,i){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,i){var o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount},e.prototype.emitCapVertex=function(e,t,r,n,i,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=i,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount},e.prototype.emitTriangle=function(e,t,r){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount},e.prototype.rebuildGeometry=function(){var e=this,t=function(t,r,n,i,o){return e.emitVertex(t,r,n,i,o)},r=function(t,r,n,i,o,a){return e.emitCapVertex(t,r,n,i,o,a)};this._extrusionVertexCount=0;for(var n=0,i=this.path.vertices;n<i.length;n++){var o=i[n];this.originData[3*o.index+0]=o.pos[0],this.originData[3*o.index+1]=o.pos[1],this.originData[3*o.index+2]=o.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(var a=1;a<this.path.vertices.length-1;++a)this.extruder.extrude(this.path.vertices[a],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r),this.profile.hasUV()&&this.options.generateUV)for(a=0;a<this.profile.uvs.length;++a)this.uvData[2*a+0]=this.profile.uvs[a],this.uvData[2*a+1]=0},e.prototype.buildTopology=function(){var e=this,t=function(t,r,n){return e.emitTriangle(t,r,n)};this._triangleCount=0;var r=this.profile.vertices.length,n=this.profile.numSegments,i=this.numExtrusionProfiles-1,o=n*i*2*3;this.startCap.indexBufferStart=o,this.startCap.firstProfileVertexIndex=0,o+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=o,this.endCap.firstProfileVertexIndex=r*(this.numExtrusionProfiles-1),o+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(o),this.normalIndices=new Uint32Array(o),this.pathVertexIndices=new Uint32Array(o),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(o));for(var a=0;a<n;++a)for(var s=this.profile.vertexIndices[2*a],l=this.profile.vertexIndices[2*a+1],c=0;c<i;++c){var u=c*r+s,p=(c+1)*r+l,d=c*r+l;t(u,(c+1)*r+s,p),t(u,p,d)}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)},e.prototype.onPathChanged=function(){this.rebuildGeometry()},e}();e.Builder=k;var z=function(){function e(e){this.builder=e}return Object.defineProperty(e.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0}),e.prototype.onPathChanged=function(){this.builder.onPathChanged()},e}();e.PathGeometry=z;var U=function(e){function t(t){var r=e.call(this,t)||this;return r.vertexAttributePosition=null,r.vertexAttributeNormal=null,r.vertexAttributeColor=null,r.vertexAttributePosition=new Float32Array(3*r.builder.numVerticesTotal),r.vertexAttributeNormal=new Float32Array(3*r.builder.numNormalsTotal),r.vertexAttributeColor=new Uint8Array(4),r.vertexAttributeColor[0]=255,r.vertexAttributeColor[1]=255,r.vertexAttributeColor[2]=255,r.vertexAttributeColor[3]=255,r}return r.__extends(t,e),t.prototype.bakeVertexColors=function(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)},t.prototype.bake=function(e){this.size=e;for(var t=0;t<this.builder.numVerticesTotal;++t){var r=this.builder.pathVertexData[t],i=0===r||r===this.builder.path.vertices.length-1,o=_;u.vec3.set(o,this.builder.originData[3*r+0],this.builder.originData[3*r+1],this.builder.originData[3*r+2]);var a=S,s=b,c=P,p=T,d=O,h=0,f=0;if(u.vec3.set(p,this.builder.profileRightAxisData[4*t+0],this.builder.profileRightAxisData[4*t+1],this.builder.profileRightAxisData[4*t+2]),u.vec3.set(d,this.builder.profileUpAxisData[4*t+0],this.builder.profileUpAxisData[4*t+1],this.builder.profileUpAxisData[4*t+2]),l.vec2.set(s,this.builder.profileVertexAndNormalData[4*t+0]*e[0],this.builder.profileVertexAndNormalData[4*t+1]*e[1]),i)u.vec3.cross(c,d,p),h=this.builder.profileRightAxisData[4*t+3]*e[0],f=this.builder.profileUpAxisData[4*t+3];else{var v=x,m=w;l.vec2.set(v,this.builder.profileRightAxisData[4*t+3],this.builder.profileUpAxisData[4*t+3]);var y=l.vec2.length(v);l.vec2.normalize(v,v);var g=l.vec2.dot(s,v);if(Math.abs(g)>y){l.vec2.set(m,-v[1],v[0]);var C=l.vec2.dot(s,m);l.vec2.scale(v,v,y*n.sign(g)),l.vec2.scale(m,m,C),l.vec2.add(s,v,m)}u.vec3.set(c,0,0,0)}u.vec3.set(a,p[0]*s[0]+d[0]*s[1],p[1]*s[0]+d[1]*s[1],p[2]*s[0]+d[2]*s[1]),this.vertexAttributePosition[3*t+0]=o[0]+a[0]+c[0]*h,this.vertexAttributePosition[3*t+1]=o[1]+a[1]+c[1]*h,this.vertexAttributePosition[3*t+2]=o[2]+a[2]+c[2]*h;var M=b;l.vec2.set(M,this.builder.profileVertexAndNormalData[4*t+2],this.builder.profileVertexAndNormalData[4*t+3]),this.vertexAttributeNormal[3*t+0]=p[0]*M[0]+d[0]*M[1]+c[0]*f,this.vertexAttributeNormal[3*t+1]=p[1]*M[0]+d[1]*M[1]+c[1]*f,this.vertexAttributeNormal[3*t+2]=p[2]*M[0]+d[2]*M[1]+c[2]*f}},t.prototype.createGeometryData=function(){var e={};if(e[v.VertexAttrConstants.POSITION]=this.builder.vertexIndices,e[v.VertexAttrConstants.NORMAL]=this.builder.normalIndices,this.vertexAttributeColor){var t=e[v.VertexAttrConstants.POSITION].length;e[v.VertexAttrConstants.COLOR]=new Uint32Array(t)}var r={};return r[v.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition},r[v.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal},this.vertexAttributeColor&&(r[v.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor}),new h.GeometryData(r,e,"triangle")},t.prototype.onPathChanged=function(){e.prototype.onPathChanged.call(this),this.bake(this.size)},t.prototype.intersect=function(e,t,r){var n=this.builder.vertexIndices,i={size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},o=n.length/3;y.intersectTriangles(e,t,0,o,n,i,void 0,void 0,r)},t}(z);e.StaticPathGeometry=U;var B=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;o.sizeAttributeValue=r,o.colorAttributeValue=n,o.opacityAttributeValue=i,o.vvData=null,o.baked=new U(t),o.vvData=new Float32Array(4*o.builder.path.vertices.length);for(var a=0;a<o.builder.path.vertices.length;++a){o.vvData[4*a+0]=r,o.vvData[4*a+1]=n,o.vvData[4*a+2]=i;var s=0===a||a===o.builder.path.vertices.length-1;o.vvData[4*a+3]=s?1:0}return o}return r.__extends(t,e),t.prototype.createGeometryData=function(){var e={};e[m.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices,e[m.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices,e[m.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices,e[m.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices,e[m.PathVertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var t={};return t[m.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData},t[m.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData},t[m.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData},t[m.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData},t[m.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData},new h.GeometryData(t,e,"triangle")},t}(z);e.FastUpdatePathGeometry=B}(g||(g={}));var _=p.vec3f64.create(),b=c.vec2f64.create(),x=c.vec2f64.create(),w=c.vec2f64.create(),S=p.vec3f64.create(),P=p.vec3f64.create(),T=p.vec3f64.create(),O=p.vec3f64.create(),C=p.vec3f64.create(),M=g.makeFrame(),A=s.mat4f64.create();return g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1734)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat2f64=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n){return[e,t,r,n]},t.createView=function(e,t){return new Float64Array(e,t,4)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(193),r(340),r(317),r(443),r(535),r(344),r(195),r(1258),r(1219),r(592),r(249),r(249),r(372)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){var y=u.assert,g=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.techniqueConfig=new p.PathTechniqueConfiguration,i.params=v.copyParameters(r,b),i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i}return r.__extends(t,e),t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,0===e&&(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=this.params.receiveSSAO),this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.isVisibleInPass=function(e){return 3!==e||this.params.castShadows},t.prototype.isVisible=function(){var t=this.params;return!!e.prototype.isVisible.call(this)&&t.opacity>0},t.prototype.setParameterValues=function(e){f.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,o,a,s,l){var c=e;if(c.metadata){var u=c.metadata.pathGeometry,p=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var d=this.params.vvSizeOffset,h=this.params.vvSizeFactor,f=this.params.vvSizeMinSize,m=this.params.vvSizeMaxSize,y=u.sizeAttributeValue;p[0]*=n.clamp(d[0]+y*h[0],f[0],m[0]),p[1]*=n.clamp(d[2]+y*h[2],f[2],m[2])}var g=Math.max(p[0],p[1]),_=i.fromValues(e.boundingInfo.bbMin[0]-g,e.boundingInfo.bbMin[1]-g,e.boundingInfo.bbMin[2]-g,e.boundingInfo.bbMax[0]+g,e.boundingInfo.bbMax[1]+g,e.boundingInfo.bbMax[2]+g),b=[s[0]-a[0],s[1]-a[1],s[2]-a[2]],x=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),w=[x/b[0],x/b[1],x/b[2]];v.intersectAabbInvDir(_,a,w,o.tolerance)&&(u.baked.size&&u.baked.size[0]===p[0]&&u.baked.size[1]===p[1]||u.baked.bake(p),u.baked.intersect(a,s,l))}},t.prototype.computeAttachmentOrigin=function(e,t){var r=e.data,n="getVertexAttr"in r?r.getVertexAttr():"vertexAttr"in r?r.vertexAttr:null;if(!n)return null;var i=n[p.PathVertexAttrConstants.POSITION];return s.computeAttachmentOriginLines(i,null,!1,t)},t.prototype.createBufferWriter=function(){return new x(this.vertexBufferLayout)},t.prototype.createRenderer=function(e,t){return new m(e,t,this,p.pathVertexAttributeLocations)},t.prototype.getGLMaterial=function(e){if(0===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.params.castShadows)return new _(e)},t.getVertexBufferLayout=function(e){var t=a.newLayout().vec3f(p.PathVertexAttrConstants.POSITION).vec4f(p.PathVertexAttrConstants.PROFILERIGHT).vec4f(p.PathVertexAttrConstants.PROFILEUP).vec4f(p.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(p.PathVertexAttrConstants.FEATUREVALUE)),t},t}(c.Material),_=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(p.PathTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return e===(this.technique.configuration.transparent?5:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype._updateShadowState=function(e){e.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&(this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&(this._updateShadowState(e),this._updateOccludeeState(e))},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t}(l.GLMaterial),b=r.__assign({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},d.Default),x=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[p.PathVertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n){var i=function(e){if(e in t.vertexAttr){var i=t.vertexAttr[e],a=t.indices[e];y(4===i.size);var s=r.getField(e,o.BufferViewVec4f);if(!s)throw new Error("unable to acquire view for "+e);h.writeBufferVec4(a,i.data,s,n)}};i(p.PathVertexAttrConstants.PROFILERIGHT),i(p.PathVertexAttrConstants.PROFILEUP),i(p.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(p.PathVertexAttrConstants.FEATUREVALUE)&&i(p.PathVertexAttrConstants.FEATUREVALUE),h.writeDefaultAttributes(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n)},e}();return g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(182),r(152),r(171),r(538),r(185),r(193),r(495),r(277),r(346),r(814),r(418),r(419),r(262),r(1246),r(940),r(356),r(417),r(451),r(195),r(1737),r(808),r(1250),r(944)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O){Object.defineProperty(t,"__esModule",{value:!0});var C=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o._hasOutline=!1,o}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.ensureMaterials=function(){this.ensureFillMaterial(),this.ensureOutlineMaterial()},t.prototype.ensureFillMaterial=function(){if(!o.isSome(this._material)){var e=o.get(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=new S({color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat")),this._context.stage.add(3,this._material)}},t.prototype.ensureOutlineMaterial=function(){var e,t,r,n=this,s=this.symbolLayer.outline;!o.isSome(this._outlineMaterial)&&this._isValidOutline(s)&&(this._hasOutline=!0,this._outlineMaterial=(e=a.pt2px(s.size),t=s.stipplePattern?P.createStipplePattern(s.stipplePattern.map(a.pt2px)):null,r=s.stippleOffColor?i.toUnitRGBA(s.stippleOffColor):null,e>1.5?new O({width:e,color:n._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:n._context.slicePlaneEnabled,isClosed:!0,stipplePattern:t,stippleIntegerRepeats:!0,stippleOffColor:r},n._getIdHint("_outline_ribbonlinemat")):new T({color:n._getOutlineColor(),slicePlaneEnabled:n._context.slicePlaneEnabled,width:e,stipplePattern:t,stippleIntegerRepeats:!0,stippleOffColor:r},n._getIdHint("_outline_nativelinemat"))),this._context.stage.add(3,this._outlineMaterial))},t.prototype._isValidOutline=function(e){return o.isSome(e)&&e.size&&e.size>0&&o.isSome(e.color)},t.prototype.destroy=function(){e.prototype.destroy.call(this),o.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null),o.isSome(this._outlineMaterial)&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)},t.prototype.createGraphics3DGraphic=function(e){var r=e.graphic;if(!this._validateGeometryType(r.geometry,t.validGeometryTypes,this.symbolLayer.type))return null;if(!this._validateGeometry(r.geometry))return null;var n="graphic"+r.uid,i=this._getVertexOpacityAndColor(e.renderingInfo,Uint8Array,255),o=this.setGraphicElevationContext(r,new d.ElevationContext);return this.ensureDrapedStatus("on-the-ground"===o.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(r,i,n):this._createAs3DShape(r,i,o,n)},t.prototype.layerOpacityChanged=function(){if(o.isSome(this._material)){var e=this._material.getParameters().color,t=o.get(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameterValues({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(o.isSome(this._outlineMaterial)){var n=this._outlineMaterial.getParameters().color;this._outlineMaterial.setParameterValues({color:[n[0],n[1],n[2],this._getOutlineOpacity()]})}return!0},t.prototype.layerElevationInfoChanged=function(e,r,n){var i=this._elevationContext.mode,o=p.elevationModeChangeUpdateType(t.elevationModeChangeTypes,n,i);if(o!==p.SymbolUpdateType.UPDATE)return o;var a=p.needsElevationUpdates2D(i);return this.updateGraphics3DGraphicElevationInfo(e,r,(function(){return a}))},t.prototype.slicePlaneEnabledChanged=function(){if(o.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),o.isSome(this._outlineMaterial)){var e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(e)}return!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype._createAs3DShape=function(e,t,r,n){var i=g.geometryAsPolygon(e.geometry);if(o.isNone(i))return null;if(A.renderData=g.geometryToRenderInfo(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),A.idHint=n,A.color=t,A.outNum=0,A.outGeometries=[],A.outTransforms=[],A.outMaterials=[],this._createAs3DShapeFill(A),this._hasOutline&&this._createAs3DShapeOutline(A),this._logGeometryCreationWarnings(A.renderData,i.rings,"rings","FillSymbol3DLayer"),0===A.outNum)return null;var a=new b({geometries:A.outGeometries,materials:A.outMaterials,transformations:A.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid},idHint:n}),s=u.perVertexElevationAligner,l=new f(this,a,A.outGeometries,null,null,s,r);return l.alignedSampledElevation=A.renderData.sampledElevation,l.needsElevationUpdates=p.needsElevationUpdates2D(r.mode),l},t.prototype._createAs3DShapeFill=function(e){for(var t=e.renderData.polygons,r=0;r<t.length;++r){var n=t[r],i=n.position,a=n.mapPosition,u=n.holeIndices;if(!o.isSome(this._context.clippingExtent)||(c.empty(M),c.expandWithBuffer(M,a),c.intersectsClippingArea(M,this._context.clippingExtent))){var p=s.earcut(a,u,3);if(0!==p.length){var d=new Uint32Array(p),h=g.createColorGeometryData({indices:d,attributeData:{position:i,color:e.color,mapPosition:a}}),f=new _(h,e.idHint);e.outGeometries.push(f),e.outMaterials.push(o.unwrap(this._material)),e.outTransforms.push(l.mat4f64.IDENTITY),e.outNum++}}}},t.prototype._createAs3DShapeOutline=function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=this._outlineMaterial instanceof T,n=0;n<t.length;++n){var i=t[n],a=i.mapPosition,s=i.position;if(!o.isSome(this._context.clippingExtent)||(c.empty(M),c.expandWithBuffer(M,a),c.intersectsClippingArea(M,this._context.clippingExtent))){var u=y.createGeometryData({removeDuplicateStartEnd:r?0:1,attributeData:{position:s,mapPosition:a}}),p=u.vertexAttributes[w.VertexAttrConstants.POSITION];p.data===s&&(p.data=new Float64Array(s));var d=new _(u,e.idHint+"outline"+n);e.outGeometries.push(d),e.outMaterials.push(o.unwrap(this._outlineMaterial)),e.outTransforms.push(l.mat4f64.IDENTITY),e.outNum++}}},t.prototype._createAsOverlay=function(e,t,r){var n=g.geometryAsPolygon(e.geometry);return o.isNone(n)?null:(o.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,o.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),E.renderData=g.geometryToRenderInfoDraped(n,this._context.overlaySR),E.idHint=r,E.color=t,E.outNum=0,E.outGeometries=[],E.outBoundingBox=c.empty(),E.layerUid=this._context.layer.uid,E.graphicsUid=e.uid,this._createAsOverlayFill(E),this._hasOutline&&this._createAsOverlayOutline(E),this._logGeometryCreationWarnings(E.renderData,n.rings,"rings","FillSymbol3DLayer"),E.outNum>0?new h(this,E.outGeometries,E.outBoundingBox):null)},t.prototype._createAsOverlayFill=function(e){for(var t=e.renderData.polygons,r=0;r<t.length;++r){var n=t[r],i=n.position,a=n.holeIndices;if(c.empty(M),c.expandWithBuffer(M,i),c.intersectsClippingArea(M,this._context.clippingExtent)){var l=s.earcut(i,a,3);if(0!==l.length){c.expand(e.outBoundingBox,M);var u=new Uint32Array(l),p=g.createColorGeometryData({indices:u,attributeData:{position:i,color:e.color}}),d=new x(p);d.data.layerUid=e.layerUid,d.data.graphicUid=e.graphicsUid,d.material=o.unwrap(this._material);var h=M;d.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0],d.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1])),e.outGeometries.push(d),e.outNum++}}}},t.prototype._createAsOverlayOutline=function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=0;r<t.length;++r){var n=t[r].position;if(c.empty(M),c.expandWithBuffer(M,n),c.intersectsClippingArea(M,this._context.clippingExtent)){c.expand(e.outBoundingBox,M);var i=this._outlineMaterial instanceof T,a=y.createGeometryData({removeDuplicateStartEnd:i?0:1,attributeData:{position:n}}),s=new x(a);s.data.layerUid=e.layerUid,s.data.graphicUid=e.graphicsUid,s.material=o.unwrap(this._outlineMaterial);var l=M;s.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0],s.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1])),e.outGeometries.push(s),e.outNum++}}},t.prototype._getOutlineOpacity=function(){var e=o.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(o.isSome(e)?e.a:0)},t.prototype._getOutlineColor=function(){var e=o.get(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return m.mixinColorAndOpacity(o.isSome(e)?n.toUnitRGB(e):null,t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{createAsOverlay:function(t,r,n){return e._createAsOverlay(t,r,n)},createAs3DShape:function(t,r,n,i){return e._createAs3DShape(t,r,n,i)}}},enumerable:!0,configurable:!0}),t.validGeometryTypes=["polyline","polygon","extent"],t.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE},t}(v.default);t.Graphics3DPolygonFillSymbolLayer=C;var M=c.create(),A={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},E={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};t.default=C}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(535),r(344),r(543),r(249),r(249),r(372),r(1738)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){var u=function(e){function t(t,r){var n=e.call(this,r)||this;return n.supportsEdges=!0,n.techniqueConfig=new c.ColorMaterialTechniqueConfiguration,n.params=s.copyParameters(t,d),n}return r.__extends(t,e),t.prototype.setParameterValues=function(e){a.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.getPassParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,n,i,o,a){s.intersectTriangleGeometry(e,t,n,i,o,void 0,a)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new p(e):void 0},t.prototype.createBufferWriter=function(){return new o.DefaultBufferWriter(o.PositionColorLayout)},t.prototype.createRenderer=function(e,t){return new l(e,t,this)},t}(i.Material),p=function(e){function t(t){var r=e.call(this,t)||this;return r.updateParameters(),r}return r.__extends(t,e),t.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(c.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(n.GLMaterial),d={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(223),r(256),r(253),r(257),r(260),r(228),r(373),r(1261),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new d(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),c.Default3D)},t.prototype.bindPass=function(e,t,r){this.program.setUniform4fv("eColor",t.color)},t.prototype.bindDraw=function(e){o.Transform.bindUniforms(this.program,e),i.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=h.separateBlendingParams(770,1,771,771),r=0===e.output?e.transparent&&t:null,n=function(t){return h.makePipelineState({blending:r,polygonOffset:e.polygonOffset&&v,culling:(n=e.cullFace,0!==n&&{face:1===n?1028:1029,mode:2305}),depthTest:u.depthCompareLess,depthWrite:e.writeDepth&&h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null});var n};return this._occludeeState=n(!0),n(!1)},Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),t.shader=new a.ReloadableShaderModule(p,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1261)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.ColorMaterialTechnique=f;var v={factor:1,units:1},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return n.__extends(t,e),n.__decorate([l.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([l.parameter({count:3})],t.prototype,"cullFace",void 0),n.__decorate([l.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([l.parameter()],t.prototype,"sliceHighlightDisabled",void 0),n.__decorate([l.parameter()],t.prototype,"vertexColors",void 0),n.__decorate([l.parameter()],t.prototype,"transparent",void 0),n.__decorate([l.parameter()],t.prototype,"polygonOffset",void 0),n.__decorate([l.parameter()],t.prototype,"writeDepth",void 0),n.__decorate([l.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(l.ShaderTechniqueConfiguration);t.ColorMaterialTechniqueConfiguration=m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(154),r(152),r(230),r(171),r(216),r(628),r(495),r(277),r(346),r(418),r(419),r(262),r(807),r(356),r(326),r(442),r(953),r(1740),r(652)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x){Object.defineProperty(t,"__esModule",{value:!0});var w=[0,0,1],S=function(e){function t(t,r,n,a){var s=e.call(this,t,r,n,a)||this;return s._geometryDataPool=new o(y.GeometryData,(function(e,t,r){var n=t.translation,o=i.isSome(r)?[r.displayWidth,r.displayHeight]:[0,0],a=t.centerOffset;if(0===e.indexCount){var s=w;g.createPointGeometry(s,n,null,o,a,[0,0],null,e)}else g.updatePointGeometry(null,n,null,o,a,null,null,e)})),s._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},s.ensureDrapedStatus(!1),s}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){if(!this._drivenProperties.size&&(e=f.validateSymbolLayerSize(this.symbolLayer.size)))throw new n("graphics3dtextsymbollayer:invalid-size",e);return this._createTextRenderParameters(),[2]}))}))},t.prototype._createTextRenderParameters=function(){var e=this._context.layerView.view.pixelRatio;this._textRenderParameters=_.default.fromSymbol(this.symbolLayer,e)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._geometryDataPool.destroy()},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic,r=v.placePointOnGeometry(t.geometry);if(i.isNone(r))return this.logger.warn("unsupported geometry type for text symbol: "+t.geometry.type),null;var n=this.symbolLayer.text;if(!n)return null;var o=l.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,r,n,o)},t.prototype.onRemoveGraphic=function(e){this._geometryDataPool.release(e.stageObject.geometries[0].data)},t.prototype.createLabel=function(e,t,r,n){var o=e.graphic,a=v.placePointOnGeometry(o.geometry);if(i.isNone(a))return this.logger.warn("unsupported geometry type for label: "+o.geometry.type),null;var s=t.text;return!s||/^\s+$/.test(s)?null:this._createAs3DShape(o,a,s,t,t,r,n)},t.prototype.setGraphicElevationContext=function(t,r,n){void 0===n&&(n=0);var i=e.prototype.setGraphicElevationContext.call(this,t,r);return i.addOffsetRenderUnits(n),i},t.prototype.layerOpacityChanged=function(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1},t.prototype.layerElevationInfoChanged=function(e,t){var r=this;return P(e,t,(function(e,t){r.updateGraphicElevationContext(t,e)})),u.SymbolUpdateType.UPDATE},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return P(e,t,(function(e){for(var t=0,n=e.stageObject.geometryRecords;t<n.length;t++)n[t].material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})})),!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!1},t.prototype.updateGraphicElevationContext=function(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=u.needsElevationUpdates2D(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode},t.prototype._defaultElevationInfoNoZ=function(){return T},t.prototype._createAs3DShape=function(e,t,r,n,o,l,h){void 0===o&&(o=O);var y=this.setGraphicElevationContext(e,new p.ElevationContext,o.elevationOffset),g=this._context.layer.id+"_label_"+e.uid,_="polyline"===i.get(e.geometry,"type"),w=e.uid,S=this._context.stage.renderView.renderingContext,P=o.anchor in f.namedAnchorToHUDMaterialAnchorPos?o.anchor:"center",T=f.namedAnchorToHUDMaterialAnchorPos[P],C=i.isNone(h)?new b(S,r,this._textRenderParameters,g):null,M={occlusionTest:!0,screenOffset:o.screenOffset,anchorPos:T,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:o.centerOffsetUnits,debugDrawBorder:o.debugDrawBorder,drawInSecondSlot:!0};if(i.isSome(C)&&(M.textureId=C.id,M.texCoordScale=C.texcoordScale),i.isSome(h)&&(M.textureId=h.textureId),i.isSome(n)&&i.isSome(n.verticalOffset)){var A=n.verticalOffset,E=A.screenLength,I=A.minWorldLength,R=A.maxWorldLength;M.verticalOffset={screenLength:a.pt2px(E),minWorldLength:I||0,maxWorldLength:null!=R?R:1/0}}if(this._context.screenSizePerspectiveEnabled){var D=this._context.sharedResources,L=D.screenSizePerspectiveSettings,j=D.screenSizePerspectiveSettingsLabels;M.screenSizePerspective=j.overridePadding(this._textRenderParameters.haloSize),M.screenSizePerspectiveAlignment=L}_&&(M.shaderPolygonOffset=1e-4),M.slicePlaneEnabled=this._context.slicePlaneEnabled;var V=null;if(i.isSome(l)){var F=JSON.stringify(M);null==(V=l.getMaterial(F))&&(V=new x.default(M,g),l.addMaterial(F,V))}else V=new x.default(M,g);var N=[V],k=this._geometryDataPool.acquire(o,C),z=[new m(k,g)],U=this._context.layer.uid,B=v.createStageObjectForHUD(this._context,t,z,N,null,null,y,g,U,w);if(null===B)return null;var G=c.perObjectElevationAligner,H=new d(this,B.object,z,i.isNone(l)?N:null,i.isSome(C)?[C]:null,G,y);H.alignedSampledElevation=B.sampledElevation,H.needsElevationUpdates=u.needsElevationUpdates2D(y.mode)||"absolute-height"===y.mode;var q=i.isSome(C)?C:o,W=q.displayWidth,J=q.displayHeight;H.getScreenSize=function(e){return void 0===e&&(e=s.vec2f64.create()),e[0]=W,e[1]=J,e};var Z={labelText:r,elevationOffset:o.elevationOffset};return H.metadata=Z,v.extendPointGraphicElevationContext(H,t,this._context.elevationProvider),H},t}(h.default);function P(e,t,r){e&&e.forEach((function(e){var n=t(e);i.isSome(n)&&r(n,e.graphic)}))}t.Graphics3DTextSymbolLayer=S;var T={mode:"relative-to-ground",offset:0},O={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};t.default=S}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(190),r(168),r(152),r(1262),r(358),r(299),r(496)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var c=function(){function e(e,t,n,i){this._idHint=i,this._glTexture=null,this.events=new r,this._requiresPowerOfTwo=!l.default(e.gl),this._renderer=new o.default(t,n)}return Object.defineProperty(e.prototype,"id",{get:function(){return null==this._id&&(this._id=a.idGen.gen(this._idHint)),this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._renderer.renderedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._renderer.renderedHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){var e=this.width;return this._requiresPowerOfTwo?n.nextHighestPowerOfTwo(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){var e=this.height;return this._requiresPowerOfTwo?n.nextHighestPowerOfTwo(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}},e.prototype.load=function(e){if(i.isSome(this._glTexture))return this._glTexture;var t=o.getTextHelperCanvas(u,this.textureWidth,this.textureHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new s(e,this.createDescriptor(e),t),r.restore(),this._glTexture},e.prototype.unload=function(){i.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")},e}(),u={canvas:null};return c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(152),r(200),r(538),r(185),r(205),r(216),r(245),r(412),r(193),r(173),r(495),r(277),r(346),r(814),r(418),r(419),r(940),r(356),r(417),r(451),r(1742),r(1263)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T){Object.defineProperty(t,"__esModule",{value:!0});var O=function(e){function t(t,r,n,i){return e.call(this,t,r,n,i)||this}return r.__extends(t,e),t.prototype.doLoad=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),i.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var r=e.graphic;if(!this._validateGeometryType(r.geometry,t.validGeometryTypes,this.symbolLayer.type))return null;if(!this._validateGeometry(r.geometry))return null;var n="graphic"+r.uid,i=this.setGraphicElevationContext(r,new m.ElevationContext);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(r,n):this._createAs3DShape(r,i,n,r.uid)},t.prototype.ensureMaterial=function(){if(!i.isSome(this._material)){var e=r.__assign({},T.defaultWaterMaterialParameters),o=this.symbolLayer.color;i.isSome(o)&&(e.color=n.toUnitRGBA(o));var a=this._getCombinedOpacity(o,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],a],e.transparent=a<1||this.needsDrivenTransparentPass,e.waveDirection=i.isSome(this.symbolLayer.waveDirection)?t.headingVectorFromAngle(this.symbolLayer.waveDirection):c.vec2f64.fromValues(0,0);var s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,l=T.wavePresets[s];e.waveStrength=l.waveStrength,e.waveTextureRepeat=l.textureRepeat,e.waveVelocity=l.waveVelocity,e.flowStrength=l.perturbationStrength,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new P.WaterMaterial(e,"water"),this._context.stage.add(3,this._material)}},t.prototype.layerOpacityChanged=function(){if(i.isNone(this._material))return!0;var e=this._material.getParameters().color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameterValues({color:[e[0],e[1],e[2],t],transparent:r}),!0},t.prototype.layerElevationInfoChanged=function(e,r,n){var i=this._elevationContext.mode,o=v.elevationModeChangeUpdateType(t.elevationModeChangeTypes,n,i);if(o!==v.SymbolUpdateType.UPDATE)return o;var a=v.needsElevationUpdates2D(i);return this.updateGraphics3DGraphicElevationInfo(e,r,(function(){return a}))},t.prototype.slicePlaneEnabledChanged=function(){return i.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.physicalBasedRenderingChanged=function(){return!0},t.prototype.pixelRatioChanged=function(){return!0},t.prototype._createAs3DShape=function(e,t,r,n){var o=b.geometryAsPolygon(e.geometry);if(i.isNone(o))return null;I.renderData=b.geometryToRenderInfo(o,this._context.elevationProvider,this._context.renderCoordsHelper,t);var a=I.renderData.position.length/3;if(I.uvCoords=new Float64Array(2*a),I.idHint=r,I.outNum=0,I.outGeometries=[],I.outTransforms=[],I.outMaterials=[],this._create3DShapeGeometries(I),this._logGeometryCreationWarnings(I.renderData,o.rings,"rings","WaterSymbol3DLayer"),0===I.outNum)return null;this._createUVCoordsFromVertices(I.uvCoords,I.renderData.mapPosition,a,this._context.elevationProvider.spatialReference);var s=new w({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:n},idHint:r}),l=f.perVertexElevationAligner,c=new g(this,s,I.outGeometries,null,null,l,t);return c.alignedSampledElevation=I.renderData.sampledElevation,c.needsElevationUpdates=v.needsElevationUpdates2D(t.mode),c},t.prototype._createUVCoordsFromVertices=function(e,r,n,i){var a=o.getMetersPerUnitForSR(i);h.empty(M);for(var s=0;s<n;s++)l.vec2.set(A,r[3*s+0],r[3*s+1]),h.expandPointInPlace(M,A);u.vec4.scale(M,M,a);var c=M[0]%t.unitSizeOfTexture,p=M[1]%t.unitSizeOfTexture;for(C[0]=M[0]-c,C[1]=M[1]-p,s=0;s<n;s++)e[2*s+0]=(r[3*s+0]*a-C[0])/t.unitSizeOfTexture,e[2*s+1]=(r[3*s+1]*a-C[1])/t.unitSizeOfTexture},t.prototype._create3DShapeGeometries=function(e){for(var t=e.renderData.polygons,r=e.uvCoords,n=0,o=t;n<o.length;n++){var l=o[n],c=l.count,u=l.index,p=l.position,h=l.mapPosition,f=l.holeIndices;if(!i.isSome(this._context.clippingExtent)||(d.empty(E),d.expandWithBuffer(E,h),d.intersectsClippingArea(E,this._context.clippingExtent))){var v=a.earcut(h,f,3);if(0!==v.length){var m=new Uint32Array(v),y=new Float64Array(r.buffer,2*u*r.BYTES_PER_ELEMENT,2*c),g=b.createWaterGeometryData({indices:m,attributeData:{position:p,uv0:y,mapPosition:h}}),_=new x(g,e.idHint);e.outGeometries.push(_),e.outMaterials.push(i.unwrap(this._material)),e.outTransforms.push(s.mat4f64.IDENTITY),e.outNum++}}}},t.prototype._createAsOverlay=function(e,t){var r=b.geometryAsPolygon(e.geometry);if(i.isNone(r))return null;i.unwrap(this._material).renderPriority=this._renderPriority,R.renderData=b.geometryToRenderInfoDraped(r,this._context.overlaySR),R.idHint=t;var n=R.renderData.position.length/3;return R.uvCoords=new Float64Array(2*n),R.outNum=0,R.outGeometries=[],R.outBoundingBox=d.empty(),R.layerUid=this._context.layer.uid,R.graphicsUid=e.uid,this._createAsOverlayWater(R),this._logGeometryCreationWarnings(R.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===R.outNum?null:(this._createUVCoordsFromVertices(R.uvCoords,R.renderData.position,n,r.spatialReference),R.outNum>0?new y(this,R.outGeometries,R.outBoundingBox):null)},t.prototype._createAsOverlayWater=function(e){for(var t=e.uvCoords,r=0,n=e.renderData.polygons;r<n.length;r++){var o=n[r],s=o.position,l=o.holeIndices,c=o.index,u=o.count;if(d.empty(E),d.expandWithBuffer(E,s),d.intersectsClippingArea(E,this._context.clippingExtent)){d.expand(e.outBoundingBox,E);var p=a.earcut(s,l,3);if(0!==p.length){var h=new Uint32Array(p),f=new Float64Array(t.buffer,2*c*t.BYTES_PER_ELEMENT,2*u),v=b.createWaterGeometryData({indices:h,attributeData:{position:s,uv0:f}}),m=new S(v);m.data.layerUid=e.layerUid,m.data.graphicUid=e.graphicsUid,m.material=i.unwrap(this._material);var y=E;m.center=[.5*(y[0]+y[3]),.5*(y[1]+y[4]),0],m.bsRadius=.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1])),e.outGeometries.push(m),e.outNum++}}}},t.headingVectorFromAngle=function(e){var t=c.vec2f64.create(),r=p.toRadian(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{create3DShape:function(t){return e._createAs3DShape(t.graphic,t.elevationContext,t.idHint,t.graphicUid)},ensureMaterial:function(){return e.ensureMaterial()}}},enumerable:!0,configurable:!0}),t.validGeometryTypes=["polyline","polygon","extent"],t.unitSizeOfTexture=100,t.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.RECREATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE},t}(_.default);t.Graphics3DWaterSymbolLayer=O;var C=c.vec2f64.create(),M=h.create(),A=c.vec2f64.create(),E=d.create(),I={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},R={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};t.default=O}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1743),r(344),r(1201),r(1202),r(543),r(249),r(1263),r(372)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(t,r){var i=e.call(this,r)||this;return i.animation=new n.AnimationTimer,i.techniqueConfig=new a.WaterTechniqueConfiguration,i.params=l.copyParameters(t,c.defaultWaterMaterialParameters),i}return r.__extends(t,e),t.prototype.setParameterValues=function(e){this.params=r.__assign(r.__assign({},this.params),e),this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.useSSR=this.params.ssrEnabled,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig},t.prototype.update=function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);return this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*t<d,this.animation.advance(e.dt),this.animation.enabled},t.prototype.intersect=function(e,t,r,n,i,o,a){l.intersectTriangleGeometry(e,t,n,i,o,void 0,a)},t.prototype.getGLMaterial=function(e){if(2===e.output)return new o.WaterGLMaterial(e);if(0===e.output){if(this.params.isDraped){var t=e;return t.output=5,new o.WaterGLMaterial(t)}return new o.WaterGLMaterial(e)}},t.prototype.createBufferWriter=function(){return new s.DefaultBufferWriter(s.PositionUVLayout)},t.prototype.createRenderer=function(e,t){return new u(e,t,this)},t}(i.Material);t.WaterMaterial=p;var d=35e3}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(235)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=!0),this.enabled=e,this._time=0}return Object.defineProperty(e.prototype,"time",{get:function(){return r.isSome(this._forcedTime)?this._forcedTime:n.Milliseconds(this._time)},enumerable:!0,configurable:!0}),e.prototype.advance=function(e){this.enabled&&(this._time+=e)},e.prototype.stopAtTime=function(e){this._forcedTime=e},e}();t.AnimationTimer=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(156),r(152),r(216),r(162),r(160),r(201),r(193),r(1211),r(652)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=n.getLogger("esri.views.3d.layers.graphics.labelPlacement");function h(e){var t=e.graphics3DGraphic.graphics3DSymbol,r=u.getGraphics3DSymbol(t);return i.isSome(r)?r.symbol.symbolLayers.getItemAt(0):null}function f(e,t){return"the requested label placement '"+e+"' is currently unsupported for "+t+" in SceneView"}function v(e){var t=e.graphics3DGraphic.graphic.geometry;if(i.isNone(t))return null;var n=t.type;switch(n){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":var o=h(e);return i.isSome(o)&&"extrude"===o.type?g["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case"point":case"mesh":return g["above-center"];default:return void r.neverReached(n)}}function m(e,t,r){var n=r.graphics3DGraphic._graphics[0],o=i.isSome(n)?n.getBoundingBoxObjectSpace(P):P,l=s.vec3f64.fromValues(o[3]-o[0],o[4]-o[1],o[5]-o[2]),c=Math.sqrt(l[0]*l[0]+l[1]*l[1]);e.centerOffset[0]=c/2*t.normalizedOffset[0];var u=e.translation[2],p=l[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=u+p;var d=a.vec3.length(l);e.centerOffset[2]=d/2*t.normalizedOffset[2]}function y(e){return{screenLength:e.screenLength,minWorldLength:e.minWorldLength,maxWorldLength:e.maxWorldLength}}t.get=function(e){var t=function(e){var t=e.labelClass.labelPlacement,r=e.labelSymbol,n=e.graphics3DGraphic,o=u.getGraphics3DSymbol(n.graphics3DSymbol),a=i.isSome(o)?o.symbol:null,s=g[t]||v(e);return"point-3d"===a.type&&a.supportsCallout()&&a.hasVisibleVerticalOffset()&&!n.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(a.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||"point-3d"===a.type&&a.supportsCallout()&&a.verticalOffset&&!n.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:function(e){switch(e){case"above-center":return!0;default:return!1}}(s.placement)?{placement:"above-center",verticalOffset:y(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,s.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(d.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null)}(e);if(i.isNone(t))return null;var n=function(e,t){if(t.anchor)return t;var n=e.labelClass.labelPlacement,o=g[n],a=o||v(e);return n&&!o&&d.warnOncePerTick("the requested label placement '"+n+"' is not currently supported in SceneView"),function(e,t){var n=t.graphics3DGraphic.graphic.geometry;if(i.isNone(n))return null;if(i.isSome(t.disablePlacement))return t.labelClass.labelPlacement?(d.warnOncePerTick(f(e.placement,t.disablePlacement.logEntityDescription)),v(t)):e;var o=n.type;switch(o){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return d.warnOncePerTick(f(e.placement,"'"+o+"' geometries")),v(t);break;case"point":case"mesh":return e;default:r.neverReached(o)}return e}(a,e)}(e,t);if(i.isNone(n))return null;var a=n.anchor,_=!!t.hasLabelVerticalOffset;return function(e,t,r){var n=r.graphics3DGraphic.graphic.geometry;if(i.isNone(n))return null;switch(n.type){case"point":!function(e,t,r){var n=h(r);if(!i.isNone(n))switch(r.graphics3DGraphic.getCenterObjectSpace(e.translation),n.type){case"icon":case"text":!function(e,t,r){var n=r.graphics3DGraphic,o=n._graphics[0],a=i.isSome(o)?o.getScreenSize():null;if(!n.isDraped&&i.isSome(a)){var s=function(e,t){void 0===t&&(t=S);var r=e.graphics3DGraphic._graphics[0],n=i.isSome(r)?r.stageObject.geometryRecords[0].material:null;if(n&&n instanceof p.default){var o=n.getParameters().anchorPos;t[0]=2*(o[0]-.5),t[1]=2*(o[1]-.5)}else t[0]=0,t[1]=0;return t}(r);w[0]=a[0]/2*(t.normalizedOffset[0]-s[0]),w[1]=a[1]/2*(t.normalizedOffset[1]-s[1]),e.screenOffset[0]=w[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=w[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=w[1]}else e.hasLabelVerticalOffset||"center"===e.anchor||(g[r.labelClass.labelPlacement]&&d.warnOncePerTick("the requested placement '"+t.placement+"' is currently unsupported for draped graphics"),e.anchor="center")}(e,t,r);break;case"object":m(e,t,r)}}(e,t,r);break;case"polygon":!function(e,t,r){var n=h(r);if(!i.isNone(n))switch(n.type){case"extrude":var o=r.graphics3DGraphic._graphics[0];i.isSome(o)&&o.getBoundingBoxObjectSpace(P),c.center(P,e.translation),e.translation[2]=c.height(P)/2,m(e,t,r)}}(e,t,r);break;case"mesh":m(e,t,r)}return e}({anchor:a,verticalOffset:t.verticalOffset,screenOffset:o.vec2f64.create(),centerOffset:l.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:s.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:_},n,e)};var g={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},_={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]},b=function(e){var t=_[e],r=g[e];t.forEach((function(e){g[e]=r}))};for(var x in _)b(x);Object.freeze&&(Object.freeze(g),Object.keys(g).forEach((function(e){Object.freeze(g[e]),Object.freeze(g[e].normalizedOffset)})));var w=[0,0],S=[0,0],P=c.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this.materials={},this.stage=e}return e.prototype.getMaterial=function(e){return this.materials[e]},e.prototype.addMaterial=function(e,t){this.materials[e]=t,this.stage.add(3,t)},e.prototype.dispose=function(){for(var e in this.materials)this.stage.remove(3,this.materials[e].id);this.materials={}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(190),r(210),r(168),r(152),r(151),r(358),r(211),r(299)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var r=e.call(this,t)||this;return r.events=new i,r.glTexture=null,r.dirty=!1,r.needsClear=!1,r.elementsToAddOrUpdate=new Map,r.elementsToRemove=new Map,r.elementsToRender=new Map,r.elements=new Map,r.stageObjects=new Map,r}var n;return r.__extends(t,e),n=t,t.prototype.initialize=function(){this.id=c.idGen.gen(this.idHint),this.stage=this.view._stage,this.canvas=this.create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(4,this);var e=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(e),this.update2DCanvasSize(),this.resetAtlasCursor()},t.prototype.unload=function(){s.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),this.events.emit("unloaded")},Object.defineProperty(t.prototype,"width",{get:function(){return this.atlas.size.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.atlas.size.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.createDescriptor=function(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}},t.prototype.load=function(e){var t=this;if(s.isSome(this.glTexture))return this.glTexture;this.glTexture=new p(e,this.createDescriptor(e),this.canvas);var r=this.view.resourceController.scheduler;return this.frameWorker=r.registerTask(u.Task.TEXT_TEXTURE_ATLAS,(function(e){return t.run(t.makeRunContext(e))}),(function(){return t.dirty})),this.setDirty(),this.glTexture},t.prototype.dispose=function(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null),this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null},t.prototype.create2DCanvas=function(){var e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",512..toString()),e.setAttribute("height",512..toString()),e},t.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())},t.prototype.createAtlasRegion=function(e){void 0===e&&(e=512),this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}},t.prototype.computeAtlasResolution=function(e,t){var r=Math.max(e,t);return r+=256,r=a.nextHighestPowerOfTwo(r),Math.min(r,4096)},t.prototype.resizeAtlas=function(e,t){t=t||e;var r=this.atlas;r.size.width=e,r.size.height=t,s.isSome(this.glTexture)&&this.glTexture.resize(e,t),this.update2DCanvasSize()},t.prototype.resetAtlasCursor=function(){var e=this.atlas;e.cursor.x=h,e.cursor.y=h+f,e.lineHeight=0,this.needsClear=!0},t.prototype.getAtlasUsage=function(){var e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)},t.prototype.getExpectedAtlasUsage=function(){var e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,r=this.elements.size;return this.getAtlasUsage()/r*(r+t-e)},t.prototype.addAtlasElement=function(e,t,r,n){var i=this.atlas,o=e.textRenderer,a=o.renderedWidth,s=o.renderedHeight,l=o.displayWidth,c=o.displayHeight;e.placement.offset.x=i.cursor.x,e.placement.offset.y=i.cursor.y,e.placement.size.width=a,e.placement.size.height=s,e.placement.size.displayWidth=l,e.placement.size.displayHeight=c,e.placement.uvMinMax=[e.placement.offset.x/i.size.width,1-(e.placement.offset.y+s)/i.size.height,(e.placement.offset.x+a)/i.size.width,1-e.placement.offset.y/i.size.height],i.cursor.x+=r,i.lineHeight=Math.max(i.lineHeight,n),this.elements.set(t,e)},t.prototype.removeAtlasElement=function(e){if(e&&this.elements.has(e.textId)){var t=e.placement.offset,r=e.placement.size;this.ctx.clearRect(t.x,t.y,r.width,r.height),this.elements.delete(e.textId)}},t.prototype.ensureStageObjects=function(e){var t=this.stageObjects.get(e);if(t)return t;var r=new Set;return this.stageObjects.set(e,r),r},t.prototype.addStageObject=function(e,t){this.ensureStageObjects(e).add(t)},t.prototype.removeStageObject=function(e,t){var r=this.stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),t.geometryVertexAttrsUpdated(0))},t.prototype.processAdditionRequest=function(e,t){var r=this.atlas,n=e.textId,i=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=i+h,s=o+h+f,l=t.repackingEnabled;if(r.cursor.x+a<r.size.width&&r.cursor.y+s<r.size.height)this.addAtlasElement(e,n,a,s),this.elementsToRender.set(n,e),this.elementsToAddOrUpdate.delete(n);else{if(!(r.cursor.y+s+r.lineHeight<r.size.height)){var c=this.getExpectedAtlasUsage(),u=c>.85&&r.size.width<4096;return u&&this.resizeAtlas(2*r.size.width,2*r.size.height),!l||!u&&c>.95&&4096===r.size.width?(this.processRemovals(),0):(this.repack(),1)}r.cursor.x=h,r.cursor.y+=r.lineHeight,r.lineHeight=0,this.addAtlasElement(e,n,a,s),this.elementsToRender.set(n,e),this.elementsToAddOrUpdate.delete(n)}return 0},t.prototype.processRemovals=function(){var e=this;this.elementsToRemove.forEach((function(t,r){var n=e.stageObjects.get(r);n&&0!==n.size||e.removeAtlasElement(t),n&&0===n.size&&e.stageObjects.delete(r)})),this.elementsToRemove.clear()},t.prototype.repack=function(){var e=this;this.processRemovals(),this.elements.forEach((function(t,r){t.rendered=!1,e.elementsToAddOrUpdate.set(r,t)})),this.elements.clear(),this.resetAtlasCursor(),this.elementsToRender.clear()},t.prototype.processRenderingRequest=function(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);var t=this.stageObjects.get(e.textId);t&&t.forEach((function(t){t.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(e.placement.uvMinMax),t.geometries[0].data.vertexAttributes.size.data=new Float32Array([e.placement.size.displayWidth,e.placement.size.displayHeight]),t.geometryVertexAttrsUpdated(0)})),e.rendered=!0},t.prototype.run=function(e){var t=this;if(this.glTexture){var r=e.budget,i=!1;if(o.someMap(this.elementsToAddOrUpdate,(function(r,n){var o=t.elements.get(n);if(o&&o.rendered){var a=t.stageObjects.get(n);return a&&a.forEach((function(e){var r=e.geometries[0].data.vertexAttributes,i=t.elements.get(n);r.uv0.data=new Float32Array(i.placement.uvMinMax),r.size.data=new Float32Array([i.placement.size.displayWidth,i.placement.size.displayHeight]),e.geometryVertexAttrsUpdated(0)})),t.elementsToAddOrUpdate.delete(n),!1}return 1===t.processAdditionRequest(t.elementsToAddOrUpdate.get(n),e)&&(i=!0,!0)})),i)return e.budget=null,e.repackingEnabled=!1,void this.run(e);var a=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),o.someMap(this.elementsToRender,(function(e,n){return t.processRenderingRequest(e),t.elementsToRender.delete(n),a=!0,!(!r||(r.madeProgress(),!r.done))})),a&&s.isSome(this.glTexture)&&this.glTexture.setData(this.canvas),this.dirty=this.elementsToRender.size>0,this.dirty||(n.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}},t.prototype.makeRunContext=function(e){return void 0===e&&(e=null),v.budget=e,v.repackingEnabled=!0,v},t.prototype.addTextTexture=function(e,t){var r=e.key;this.elementsToAddOrUpdate.has(r)||this.elementsToAddOrUpdate.set(r,{textId:r,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this.addStageObject(r,t),this.elementsToRemove.delete(r),this.setDirty()},t.prototype.removeTextTexture=function(e,t){var r=e.key;this.elementsToRemove.set(r,this.elements.get(r)),this.removeStageObject(r,t)},Object.defineProperty(t.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.dirty&&!!this.frameWorker},enumerable:!0,configurable:!0}),t.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))},Object.defineProperty(t.prototype,"test",{get:function(){var e=this.elements,t=this.stageObjects,r=this.elementsToRemove,n=this.atlas,i=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:n,resizeAtlas:function(e,t){return i.resizeAtlas(e,t)},run:function(e){return i.run(e)}}},enumerable:!0,configurable:!0}),t.prototype.repackOrdered=function(){if(0!==this.elements.size){var e=[];this.elements.forEach((function(t,r){return e.push({element:t,key:r})}));for(var t=!0,r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((function(e,t){return e.key.localeCompare(t.key)})),this.elements.clear();for(var n=0,i=e;n<i.length;n++){var o=i[n],a=o.element,s=o.key;this.elements.set(s,a)}this.repack(),this.setDirty()}}},t.test={orderedRepackingEnabled:!1},r.__decorate([l.property({constructOnly:!0})],t.prototype,"idHint",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([l.property({type:Boolean,readOnly:!0})],t.prototype,"updating",null),n=r.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],t)}(n);t.TextTextureAtlas=d;var h=2,f=2,v={budget:null,repackingEnabled:!0};t.default=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(167),r(759),r(152),r(153),r(1253),r(1254),r(1256)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new n}return e.prototype.loadGLTF=function(e,t){var r="gltf:"+e;return this.fromCache(this.gltfCache,r,(function(t){return l.load(new s.DefaultLoadingContext(t.streamDataRequester),e,t)}),t)},e.prototype.loadWOSR=function(e,t){var r="wosr:"+e+":"+t.disableTextures;return this.fromCache(this.wosrCache,r,(function(t){return c.load(e,t)}),t)},e.prototype.destroy=function(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this.wosrCache.size+this.gltfCache.size},enumerable:!0,configurable:!0}),e.prototype.fromCache=function(e,t,n,i){var s=this;return a.create((function(l,c){if(a.isAborted(i))c(a.createAbortError());else{var u=a.onAbort(i,(function(){s.remove(e,t),c(a.createAbortError())})),p=e.get(t);if(p)return s.evictHandles.remove(t),p.refCount++,void p.item.then(l,c);var d=a.createAbortController(),h=r.__assign(r.__assign({},i),{signal:d.signal}),f={refCount:1,abortController:d,item:n(h).then((function(r){return f.abortController=null,r.remove=function(){return s.remove(e,t)},r}))};e.set(t,f),f.item.then((function(e){o.isSome(u)&&u.remove(),l(e)}),(function(e){o.isSome(u)&&u.remove(),c(e)}))}}))},e.prototype.remove=function(e,t){var r=e.get(t);r&&(r.refCount--,0===r.refCount&&this.evictHandles.add(i.timeoutHandle((function(){e.delete(t),o.isSome(r.abortController)&&r.abortController.abort()}),p),t))},e}();t.ObjectResourceCache=u;var p=1e4;t.test={overrideEvictDelay:function(e){return p=e,{remove:function(){p=1e4}}}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(167),r(156),r(214),r(157),r(151),r(173),r(1265),r(1749),r(192),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=a.getLogger("esri.views.3d.layers.support.FeatureTileTree3D"),m=function(e){function t(t){var r=e.call(this,t)||this;return r.tiles=new i,r.tileSize=512,r._idToTile=new Map,r._handles=new o,r._clients=new Set,r._dirty=!1,r._newTiles=new s,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"tilingScheme",{get:function(){var e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(!e||e.spatialReference.equals(this.viewState.spatialReference)){var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this._setDirty()}}else v.error("#extent","extent spatial reference needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;var e=u.create();return h.extentToBoundingRect(this.filterExtent,e,this.tilingScheme.spatialReference),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{set:function(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._handles.add(this.watch(["tilingScheme","tileSize"],(function(){return e._reset()}),!0)),this._handles.add(l.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],(function(){return e._setDirty()}),!0)),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(f.Task.FEATURE_TILE_TREE,(function(t){return e._update(t)}),(function(){return e.updating})))},t.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.addClient=function(){var e=this,t=y++;return this._clients.add(t),1===this._clients.size&&this._setDirty(),{remove:function(){return e._removeClient(t)}}},t.prototype._removeClient=function(e){this._clients.delete(e),this._hasClients||this._clear()},Object.defineProperty(t.prototype,"_hasClients",{get:function(){return this._clients.size>0},enumerable:!0,configurable:!0}),t.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(f.noBudget))},t.prototype._clear=function(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")},t.prototype._update=function(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker&&(this._frameWorker.task=f.Task.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=f.Task.FEATURE_TILE_TREE),this.notifyChange("updating")},t.prototype._startUpdate=function(){if(!this.suspended)if(this.tilingScheme){this._tileMeasurements||(this._tileMeasurements=new d.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:_}));var e=this.viewState.camera,t=this.cameraOnSurface.location;this._tileMeasurements.begin(e,this.focus?this.focus.locationOnSurface:t,t.z),this._pendingTiles=this._getRootTiles()}else this._clear()},t.prototype._reset=function(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()},t.prototype._getRootTiles=function(){var e=this;return this.rootTileIds.map((function(t){return new p.FeatureTileDescriptor3D(t[0],t[1],t[2],e.tilingScheme)}))},t.prototype._purgeHorizonTiles=function(e){e.sort((function(e,t){var r=e.measures.screenRect,n=t.measures.screenRect;return r[1]+r[3]-(n[1]+n[3])})),u.empty(g);for(var t=0;t<e.length;t++)if(u.expand(g,e.data[t].measures.screenRect),u.height(g)>_)return e.data.slice(t,e.length);return[]},t.prototype._subdivideTilesForView=function(e){var t;if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){var r=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!u.intersects(this.filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),0!==r.measures.visibility&&(r.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(r.lij[0]+1),(t=this._pendingTiles).push.apply(t,r.getChildren())):this._newTiles.push(r)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}},t.prototype._updateTiles=function(e){for(var t=this,r=0,n=this.tiles.items;r<n.length;r++)n[r].used=!1;var i=e.filter((function(e){var r=t._idToTile.get(e.id);return r?(r.copyMeasurementsFrom(e),r.used=!0):t._idToTile.set(e.id,e),!r})),o=this.tiles.items.filter((function(e){return!e.used&&(t._idToTile.delete(e.id),!0)}));this.tiles.removeMany(o),this.tiles.addMany(i),this.sortTiles()},t.prototype.sortTiles=function(){this.tiles.sort((function(e,t){return e.measures.visibility!==t.measures.visibility?2===e.measures.visibility?-1:1:e.measures.distance-t.measures.distance})),this.tiles.forEach((function(e,t){return e.loadPriority=t}))},r.__decorate([c.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"renderCoordsHelper",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"tilingSchemeOwner",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"cameraOnSurface",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"focus",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"viewState",void 0),r.__decorate([c.property()],t.prototype,"tiles",void 0),r.__decorate([c.property()],t.prototype,"tileSize",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],t.prototype,"tilingScheme",null),r.__decorate([c.property()],t.prototype,"filterExtent",null),r.__decorate([c.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],t.prototype,"filterExtentRect",null),r.__decorate([c.property({readOnly:!0,dependsOn:["filterExtentRect"]})],t.prototype,"rootTileIds",null),r.__decorate([c.property({value:!1})],t.prototype,"suspended",null),r.__decorate([c.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([c.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],t)}(n);t.FeatureTileTree3D=m;var y=0,g=u.create(),_=10;t.default=m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(171),r(162),r(160),r(173),r(1750),r(203),r(288)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.camera=new l.default,this.pointOfInterestInMap=[0,0],this.screenRect=o.create(),this.tileSize=e.tileSize,this.maxVerticalScreenSize=e.maxVerticalScreenSize,this.renderCoordsHelper=e.renderCoordsHelper,this.tilingScheme=e.tilingScheme,this.visibility=new a.FeatureTileVisibility3D({renderCoordsHelper:e.renderCoordsHelper})}return e.prototype.begin=function(e,t,r){this.camera.copyFrom(e),this.z=r,this.pointOfInterestInMap[0]=t.x,this.pointOfInterestInMap[1]=t.y,o.fromValues(0,0,e.fullWidth,e.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)},e.prototype.end=function(){this.visibility.end()},e.prototype.updateTile=function(e){e.measures.visibility=this.visibility.calculate(e),0!==e.measures.visibility&&this.updateScreenMeasure(e),this.updateDistanceMeasure(e)},e.prototype.updateDistanceMeasure=function(e){e.measures.distance=o.distance(e.extent,this.pointOfInterestInMap)},e.prototype.updateScreenMeasure=function(e){var t=d,r=1<<t,n=e.measures.screenRect;o.empty(n);for(var i=0,a=e.lij[0]+t,s=e.lij[1]<<t,l=e.lij[2]<<t,c=this.tileSizeWithBias(e),u=c*c,p=!1,h=0;h<r;h++){for(var f=0;f<r&&!(p=(i+=this.computeScreenArea(e,a,s+h,l+f,n).area)>u&&o.height(n)>this.maxVerticalScreenSize);f++);if(p)break}e.measures.shouldSplit=i>u},e.prototype.tileSizeWithBias=function(e){return 1===e.measures.visibility?this.tileSize*h:this.tileSize},e.prototype.computeScreenArea=function(e,t,r,n,i){var a=1===e.measures.visibility,l=f.points;this.projectToScreen(t,r,n,a,l),o.empty(u);for(var c=0;c<4;c++)o.expandPointInPlace(u,l[c]);return o.expand(i,u),o.intersection(u,this.screenRect,p),f.screenOverlap=o.area(p)/o.area(u),f.area=s.triangle.areaPoints2d(l[0],l[1],l[2])+s.triangle.areaPoints2d(l[0],l[2],l[3]),f},e.prototype.projectToScreen=function(e,t,r,n,i){this.tilingScheme.ensureMaxLod(e),this.tilingScheme.getExtent(e,t,r,v),this.toRenderCoords(v,0,3,y[0]),this.toRenderCoords(v,2,3,y[1]),this.toRenderCoords(v,2,1,y[2]),this.toRenderCoords(v,0,1,y[3]),n&&(this.projectToPlane(y,this.camera.frustum.planes[4]),this.projectToPlane(y,this.camera.frustum.planes[3]),this.projectToPlane(y,this.camera.frustum.planes[2]));for(var o=0;o<4;o++)this.camera.projectPoint(y[o],_),this.camera.renderToScreen(_,i[o])},e.prototype.projectToPlane=function(e,t){for(var r=0;r<4;r++)g[r]=s.plane.signedDistance(t,e[r]);var i=Math.max(g[0],g[1],g[2],g[3]);if(i>0){var o=n.vec3.scale(m,s.plane.normal(t),-i);for(r=0;r<4;r++)n.vec3.add(e[r],e[r],o)}},e.prototype.toRenderCoords=function(e,t,r,n){return m[0]=e[t],m[1]=e[r],m[2]=this.z,this.renderCoordsHelper.toRenderCoords(m,this.tilingScheme.spatialReference,n),n},e}();t.FeatureTileMeasurements3D=c;var u=o.create(),p=o.create(),d=2,h=5,f={points:[r.createScreenPointArray(),r.createScreenPointArray(),r.createScreenPointArray(),r.createScreenPointArray()],area:0,screenOverlap:0},v=o.create(),m=i.vec3f64.create(),y=[i.vec3f64.create(),i.vec3f64.create(),i.vec3f64.create(),i.vec3f64.create()],g=[0,0,0,0],_=r.createRenderScreenPointArray3();t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(230),r(162),r(160),r(1265),r(1266),r(661),r(203)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.surfaceElevation=0,this.cache=new Map;var t=e.renderCoordsHelper;this.frustum=new s.Frustum({renderCoordsHelper:t}),this.extendedFrustum=new s.Frustum({renderCoordsHelper:t}),this.intersector=new l.FrustumExtentIntersection({renderCoordsHelper:t}),this.renderCoordsHelper=t}return e.prototype.begin=function(e,t){this.surfaceElevation=t,this.aboveGround=this.renderCoordsHelper.getAltitude(e.eye)>t,this.frustum.update(e),this.shortenFrustumFarPlane(this.frustum),this.updateExtendedFrustum(e,t)},e.prototype.end=function(){this.cache.clear()},e.prototype.calculate=function(e){if(this.allTilesInvisible)return 0;var t="global"===this.renderCoordsHelper.type&&e.lij[0]>=p&&e.lij[0]<d,r=this.getOrCalculateSingleTileVisibility(e,!t);return 0!==r&&t?this.calculateAggregatedChildrenVisibility(e):r},e.prototype.shortenFrustumFarPlane=function(e){for(var t=s.Frustum.nearFarLineIndices,r=e.mutablePoints,n=0,o=t;n<o.length;n++){var a=o[n],l=a[0],c=a[1],u=r[l],p=r[c];i.vec3.subtract(v,p,u),i.vec3.scale(v,v,f),i.vec3.add(r[c],u,v)}e.updatePoints(r)},e.prototype.calculateAggregatedChildrenVisibility=function(e){var t=0,r=this.cache.get(e.id);if(null!=r)return r;var n=g.acquire();e.getChildren(n);for(var i=0,o=n;i<o.length;i++){var a=o[i],s=this.calculate(a);if(0!==s&&(t=s,2===s))break}return g.release(n),this.cache.set(e.id,t),t},e.prototype.getOrCalculateSingleTileVisibility=function(e,t){var r=this.cache.get(e.id);if(null!=r)return r;var n=this.calculateSingleTileVisibility(e);return t&&this.cache.set(e.id,n),n},e.prototype.calculateSingleTileVisibility=function(e){return!this.aboveGround&&"global"===this.renderCoordsHelper.type&&e.lij[0]<h?0===this.calculateSingleTileVisibilitySided(e,!1)?this.calculateSingleTileVisibilitySided(e,!0):void 0:this.calculateSingleTileVisibilitySided(e,this.aboveGround)},e.prototype.calculateSingleTileVisibilitySided=function(e,t){return this.intersector.update(e.extent,e.tilingScheme.spatialReference,this.surfaceElevation,t),this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0},e.prototype.updateExtendedFrustum=function(e,t){var n,o,a=this.renderCoordsHelper;this.extendedFrustum.update(e),this.shortenFrustumFarPlane(this.extendedFrustum);var s=this.renderCoordsHelper.worldUpAtPosition(e.eye,v);this.aboveGround||i.vec3.negate(s,s);var l=r.acosClamped(-i.vec3.dot(s,e.viewForward));if(this.allTilesInvisible=l>(Math.PI+e.fovY)/2,!this.allTilesInvisible&&(this.hasExtendedFrustum=l>e.fovY/2,this.hasExtendedFrustum)){for(var u=this.extendedFrustumParameters(t),p=this.extendedFrustum.mutablePoints,d=0;d<4;d++){var h=u.pointIndices[d],f=p[h],g=a.getAltitude(f);if(u.needsAltitudeAdjustment(g)){switch(this.renderCoordsHelper.worldUpAtPosition(f,v),h){case 4:case 7:case 0:case 3:c.plane.projectVector(this.extendedFrustum.planes[0],v,v);break;case 5:case 6:case 1:case 2:c.plane.projectVector(this.extendedFrustum.planes[1],v,v)}i.vec3.scale(v,v,u.direction),this.renderCoordsHelper.intersectInfiniteManifold(c.ray.wrap(f,v),u.zWithMargin,f)}}if(this.extendedFrustum.updatePoints(p),c.plane.fromPoints(p[0],p[1],p[2],m),c.plane.fromPoints(p[1],p[2],p[3],y),i.vec3.dot(c.plane.normal(m),c.plane.normal(y))<0){var _=this.extendedFrustum.mutablePoints;this.aboveGround?(n=[_[1],_[0]],_[0]=n[0],_[1]=n[1]):(o=[_[2],_[3]],_[3]=o[0],_[2]=o[1]),this.extendedFrustum.updatePoints(_)}}},e.prototype.extendedFrustumParameters=function(e){return this.aboveGround?this.extendedFrustumParametersAboveSurface(e,1):this.extendedFrustumParametersBelowSurface(e,1)},e.prototype.extendedFrustumParametersAboveSurface=function(e,t){var r=e-t;return{zWithMargin:r,pointIndices:s.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(e){return e>r}}},e.prototype.extendedFrustumParametersBelowSurface=function(e,t){var r=e+t;return{zWithMargin:r,pointIndices:s.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(e){return e<r}}},e}();t.FeatureTileVisibility3D=u;var p=2,d=6,h=12,f=.95,v=o.vec3f64.create(),m=c.plane.create(),y=c.plane.create(),g=new n(Array,(function(e){4!==e.length&&(e[0]=new a.FeatureTileDescriptor3D,e[1]=new a.FeatureTileDescriptor3D,e[2]=new a.FeatureTileDescriptor3D,e[3]=new a.FeatureTileDescriptor3D)}),(function(e){e[0].release(),e[1].release(),e[2].release(),e[3].release()}));t.default=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(190),r(152),r(151),r(855),r(160),r(530),r(645),r(924),r(799),r(238),r(498),r(288)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v){Object.defineProperty(t,"__esModule",{value:!0});var m=function(e){function t(t){var r=e.call(this,t)||this;return r.propertiesPool=new f.default({camera:v.default},r),r.lastSeenCameraProjectionValues=new v.default,r.events=new i,r._cameraChanged=!1,r.updateQueue=new Array,r.processingUpdates=!1,r}return r.__extends(t,e),t.prototype.destroy=function(){this.cameraController=null,this.propertiesPool=o.destroyMaybe(this.propertiesPool)},t.prototype.normalizeCtorArgs=function(e){return{camera:this.createInitialCamera(e.viewingMode),mode:e.viewingMode,spatialReference:e.spatialReference,constraints:new u.default({mode:e.viewingMode})}},Object.defineProperty(t.prototype,"animation",{get:function(){return this.cameraController instanceof p.AnimationController&&o.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._get("camera")},set:function(e){var t=this;e!==y&&y.copyFrom(e),y.markViewDirty(),y.computeUp(this.mode),g.camera=y,this.events.emit("before-camera-change",g);var r=this._get("camera");if(this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,y)&&(this.lastSeenCameraProjectionValues.copyFrom(y),_.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",_)),(!r||!r.equals(y))&&(this._set("camera",this.propertiesPool.get("camera").copyFrom(y)),this._cameraChanged=!r||!r.almostEquals(y),this._cameraChanged))var n=s.afterDispatch((function(){t._cameraChanged=!1,n.remove()}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stationary",{get:function(){return!this._cameraChanged&&!this.navigating},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(e){var t=this;this.stopActiveCameraController()?(e&&(e.watch("state",(function(r){r!==d.State.Finished&&r!==d.State.Stopped||(t._set("cameraController",null),t.updateCamera((function(t){return e.onControllerEnd(t)})))}),!0),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=d.State.Rejected)},enumerable:!0,configurable:!0}),t.prototype.switchCameraController=function(e){return this.cameraController=e,e.state!==d.State.Rejected},t.prototype.stopActiveCameraController=function(){return!(this.cameraController&&!this.cameraController.stopController())},t.prototype.updateCamera=function(e){this.updateQueue.push(e),this.processUpdateQueue()},t.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var e=this.updateQueue.shift();y.copyFrom(this._get("camera")),e(y),this.camera=y,this.processingUpdates=!1,this.processUpdateQueue()}},t.prototype.createInitialCamera=function(e){return"global"===e?new v.default(l.vec3f64.fromValues(4*h.earthRadius,0,0),l.vec3f64.fromValues(h.earthRadius,0,0),l.vec3f64.fromValues(0,0,1)):new v.default(l.vec3f64.fromValues(0,0,100),l.vec3f64.fromValues(0,0,0),l.vec3f64.fromValues(0,1,0))},t.prototype.cameraProjectionChanged=function(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[0]!==t.padding[0]||e.padding[1]!==t.padding[1]||e.padding[2]!==t.padding[2]||e.padding[3]!==t.padding[3]},r.__decorate([a.property({readOnly:!0,type:c,dependsOn:["cameraController"]})],t.prototype,"animation",null),r.__decorate([a.property({type:v.default})],t.prototype,"camera",null),r.__decorate([a.property({constructOnly:!0})],t.prototype,"constraints",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"events",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["isLocal"]})],t.prototype,"isGlobal",null),r.__decorate([a.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"isLocal",null),r.__decorate([a.property({constructOnly:!0})],t.prototype,"mode",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["cameraController"]})],t.prototype,"navigating",null),r.__decorate([a.property({readOnly:!0,dependsOn:["navigating","_cameraChanged"]})],t.prototype,"stationary",null),r.__decorate([a.property()],t.prototype,"_cameraChanged",void 0),r.__decorate([a.property()],t.prototype,"cameraController",null),r.__decorate([a.subclass("esri.views.3d.state.ViewState")],t)}(n);t.ViewState=m;var y=new v.default,g={camera:null},_={camera:null};t.default=m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(638),r(369),r(158),r(154),r(167),r(156),r(152),r(153),r(231),r(171),r(157),r(151),r(245),r(201),r(184),r(202),r(197),r(342),r(533),r(1753),r(1266),r(923),r(1756),r(925),r(498),r(1757),r(288),r(589)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E){Object.defineProperty(t,"__esModule",{value:!0});var I=l.getLogger("esri.views.3d.state.ViewStateManager"),R=function(e){function t(t){var r=e.call(this,t)||this;return r.propertiesPool=new C.default({frustum:S.default},r),r.handles=new s,r.cameraSetByUser=!1,r.internalSetOrder=[],r.immediateGoToController=null,r.animatedGoToController=null,r.ready=!1,r.updateDevicePixelRatio=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"camera",{get:function(){if(!this.ready)return this._get("camera");var e=O.internalToExternal(this.view,this.view.state.camera),t=this._get("camera");return e&&t&&e.equals(t)?t:e},set:function(e){this.updatePropertyBeforeReady("camera",e)||this.setStateCamera(O.externalToInternal(this.view,e),{applyConstraints:!1})||I.error("#camera=","Invalid camera",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(e){this.updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this.centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():I.error("#center=","Invalid center",e):I.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):I.error("#center=","Center may not be null or undefined"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.ready?O.toExtent(this.view,this.view.state.camera,this.view.pointsOfInterest.centerOnContent.renderLocation):this._get("extent")},set:function(e){this.updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this.extentToCamera(e),{applyConstraints:!0})||I.error("#extent=","Invalid extent",e):I.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):I.error("#extent=","Extent may not be null or undefined"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frustum",{get:function(){var e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var e=this.view.pointsOfInterest.centerOnContent;return O.distanceToScale(this.view,e.distance,e.location.latitude)},set:function(e){this.updatePropertyBeforeReady("scale",e)||this.setStateCamera(this.scaleToCamera(e),{applyConstraints:!0})||I.error("#scale=","Invalid scale",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var e=this.view.state.camera,t=e.padding,r=e.pixelRatio,n=this._get("padding"),i=Math.round(t[0]/r),o=Math.round(t[1]/r),a=Math.round(t[2]/r),s=Math.round(t[3]/r);return null!=n&&n.top===i&&n.right===o&&n.bottom===a&&n.left===s?n:{top:i,right:o,bottom:a,left:s}},set:function(e){this.updatePropertyBeforeReady("padding",e)||(this.paddingToArray(e,this.view.state.camera.pixelRatio,N),this.view.state.updateCamera((function(e){return e.padding=N})))},enumerable:!0,configurable:!0}),t.prototype.paddingToArray=function(e,t,r){e?v.vec4.set(r,e.top||0,e.right||0,e.bottom||0,e.left||0):v.vec4.set(r,0,0,0,0);for(var n=0;n<4;n++)r[n]=Math.round(r[n]*t)},Object.defineProperty(t.prototype,"screenCenter",{get:function(){var e=this.padding;return d.createScreenPoint((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewpoint",{get:function(){return this.ready?M.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(e){if(!this.updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this.viewpointToCamera(e),{applyConstraints:!e.camera})||I.error("#viewpoint=","Invalid viewpoint",e);else{var t=e.camera?e.camera.position:e.targetGeometry,r=t&&t.spatialReference;I.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else I.error("#viewpoint=","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{get:function(){return this.ready?O.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(e){this.updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this.zoomToCamera(e),{applyConstraints:!0})||I.error("#zoom=","Invalid zoom",e)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add([this.view.watch("state.camera",(function(t){return e.cameraChangedSync(t)}),!0),h.on(this.view,"state.events","before-camera-change",(function(t){return e.updateElevation(t.camera)}))]),h.once(this.view,"state.camera",(function(t){return e.updateElevation(t)}),!0),this.handles.add(p.addFrameTask({prepare:function(){return e.prepareFrame()}})),this.handles.add(this.view.watch("state.cameraController",(function(){e.cameraSetByUser=!0,e.handles.remove(k),e.cancelImmediateGoTo()}))),this.handles.add(h.on(this.view,"state.events","camera-projection-changed",(function(){return e.notifyChange("scale")})))},t.prototype.destroy=function(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)},t.prototype.init=function(){var e=this;this.constraintsManager=new w.default({view:this.view}),this.prepareFrame();var t=this.getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(var r=0,n=t;r<n.length;r++){var i=n[r];this.set(i.name,i.value)}if(!this.cameraSetByUser){var o=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;o&&this.isCompatible(o)?this.setInitialView(o):"local"===this.view.state.mode&&this.handles.add(h.whenOnce(this.view.basemapTerrain,"ready",(function(){e.handles.remove(k),e.setInitialView(e.view.groundExtent)})),k)}},t.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(k),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))},t.prototype.goTo=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(i){return(n=r.__assign({animate:!0},t)).animate?[2,this.goToAnimated(e,n)]:[2,this.goToImmediate(e,n)]}))}))},t.prototype.debugSetCameraOnContent=function(){this.setStateCamera(x.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})},t.prototype.step=function(e){var t=this.view.state,r=t&&this.view.state.cameraController;r&&(t.updateCamera((function(t){r.stepController(e,t)})),r.steppingFinished&&r.finishController())},t.prototype.cancelImmediateGoTo=function(){var e=this.immediateGoToController;c.isSome(e)&&(this.immediateGoToController=null,e.abort())},t.prototype.cancelAnimatedGoTo=function(){var e=this.animatedGoToController;c.isSome(e)&&(this.animatedGoToController=null,e.abort())},t.prototype.getInitialProperties=function(){for(var e=new Set,t=[],r=0,n=L;r<n.length;r++){var i=n[r],o=i.propertyName,a=i.overrides,s=e.has(o),l=this._isOverridden(o);!s&&l&&t.push({name:o,value:this._get(o)}),this._clearOverride(o),(s||l)&&a.forEach((function(t){return e.add(t)}))}return t},t.prototype.setInitialView=function(e){if(e&&!this.cameraSetByUser)if(e instanceof n)this.setStateCamera(O.externalToInternal(this.view,e),{applyConstraints:!1});else if(e instanceof i){if(e.targetGeometry instanceof y){var t=O.fromExtent(this.view,e.targetGeometry,0,.5,0);return void this.setStateCamera(O.externalToInternal(this.view,t),{applyConstraints:!0})}var r={applyConstraints:!e.camera},o=this.viewpointToCamera(e);this.setStateCamera(o,r)}else{var a=O.fromExtent(this.view,e,0,.5,0);this.setStateCamera(O.externalToInternal(this.view,a),{applyConstraints:!0})}},t.prototype.updatePropertyBeforeReady=function(e,t){if(!this.ready){this._override(e,t);var r=this.internalSetOrder.indexOf(e);return-1!==r&&(this.internalSetOrder=this.internalSetOrder.splice(r,1)),t&&(this.internalSetOrder.push(e),-1!==D.indexOf(e)&&this._override("hasInitialView",!0)),!0}return!1},t.prototype.isCompatible=function(e){return!!e&&(e instanceof i?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof n?this.isCompatible(e.position):e.spatialReference&&_.canProject(e.spatialReference,this.view.spatialReference))},t.prototype.getPreservingHeadingTilt=function(e){return void 0===e&&(e=j),this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e},t.prototype.centerPointAtDistanceToCamera=function(e,t,r){void 0===r&&(r=F);var n=this.getPreservingHeadingTilt(),i=n.heading,o=n.tilt,a=O.getObserverForPointAtDistance(this.view,i,o,e,t,1);return a?(r.copyFrom(this.view.state.camera),r.eye=a.eye,r.center=a.center,r.up=a.up,r):null},t.prototype.centerToCamera=function(e){var t=this.view.pointsOfInterest.centerOnContent;t.update();var r=t.distance;return this.centerPointAtDistanceToCamera(e,r)},t.prototype.extentToCamera=function(e){var t=this.getPreservingHeadingTilt(),r=t.heading,n=t.tilt,i=O.fromExtent(this.view,e,r,n,1,V);return O.externalToInternal(this.view,i)},t.prototype.scaleToCamera=function(e){if(null==e)return null;var t=this.view.pointsOfInterest.centerOnContent;t.update();var r=t.renderLocation,n=t.location.latitude,i=O.scaleToDistance(this.view,e,n);return this.centerPointAtDistanceToCamera(r,i)},t.prototype.zoomToCamera=function(e){return this.scaleToCamera(O.zoomToScale(this.view,e))},t.prototype.viewpointToCamera=function(e){var t=M.toCamera(this.view,e);return t?O.externalToInternal(this.view,t):null},t.prototype.setStateCamera=function(e,t){var r=this;return!(!e||!this.view.state.stopActiveCameraController()||(this.cameraSetByUser=!0,this.cancelImmediateGoTo(),this.view.state.updateCamera((function(n){t.positionAndOrientationOnly?(n.eye=e.eye,n.center=e.center,n.up=e.up):n.copyFrom(e),t.applyConstraints&&b.applyAll(r.view,n)})),t.applyConstraints||(this.view.state.cameraController=new T.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:e})),0))},t.prototype.prepareFrame=function(){var e=this.view,t=e.container,r=e.canvas;if(t&&r){c.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var n=this.view.pixelRatio,i=Math.round(t.clientWidth*n),o=Math.round(t.clientHeight*n);if(0!==i&&0!==o&&(r.width===i&&r.height===o||(r.width=i,r.height=o),this.view.state)){var a=this.view.state.camera;a.fullWidth===i&&a.fullHeight===o&&a.pixelRatio===n||(F.copyFrom(a),F.pixelRatio!==n&&(this.paddingToArray(this.padding,n,N),F.padding=N),F.fullWidth=i,F.fullHeight=o,F.pixelRatio=n,this.view.state.camera=F)}}},t.prototype.updateElevation=function(e){var t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=this.view.renderCoordsHelper.getAltitude(e.eye),n=t?x.surfaceElevationBelowEye(this.view,e):0;e.relativeElevation=r-n},t.prototype.cameraChangedSync=function(e){e&&this.view._stage&&this.view._stage.setCamera(e)},t.prototype.createGoToCamera=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,s,l,c,p,d,f,v;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,h.whenOnce(this,"ready",t.signal,!0)];case 1:return r.sent(),u.throwIfAborted(t),[4,M.create(this.view,e,t.signal)];case 2:if(o=r.sent(),s=!!(e instanceof i&&e.camera||e instanceof n),l=o.camera,!this.isCompatible(l))throw c=l.position,p=c&&c.spatialReference,d=p?p.wkid:"none",f=this.view.spatialReference.wkid,new a("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+d+", view: "+f+")",{camera:l});if(!(v=O.externalToInternal(this.view,l)))throw new a("goto:invalid-camera","Resulting camera is invalid");return[2,{viewpoint:o,camera:v,isFullySpecified:s}]}}))}))},t.prototype.cancellableGoTo=function(e,t){var r,n=this;return u.create((function(i,o){r={resolve:i,reject:o},e.asyncResult=r,u.onAbort(t,(function(){n.view.state.cameraController===e&&e.active&&e.asyncResult===r&&e.stopController()}))}))},t.prototype.goToImmediate=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s=this;return r.__generator(this,(function(l){return this.cancelAnimatedGoTo(),this.cancelImmediateGoTo(),n=u.createAbortController(),u.onAbort(t,(function(){return n.abort()})),i=this.createGoToCamera(e,r.__assign(r.__assign({},t),{signal:n.signal})),o=function(){s.immediateGoToController===n&&(s.immediateGoToController=null)},this.immediateGoToController=n,[2,i.then((function(e){o(),s.setStateCamera(e.camera,{applyConstraints:!e.isFullySpecified,positionAndOrientationOnly:!0})})).catch((function(e){throw o(),!u.isAbortError(e)&&e instanceof a&&e.message&&I.error("#goTo()","Failed to create camera from target, "+e.message[0].toLowerCase()+e.message.slice(1)),e}))]}))}))},t.prototype.goToAnimatedBeforeReady=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(i){switch(i.label){case 0:return this.cancelAnimatedGoTo(),n=u.createAbortController(),u.onAbort(t,(function(){return n.abort()})),this.animatedGoToController=n,t=r.__assign(r.__assign({},t),{signal:n.signal}),[4,h.whenOnce(this.view,"ready",n.signal)];case 1:return i.sent(),this.animatedGoToController=null,[2,this.goToAnimated(e,t)]}}))}))},t.prototype.goToAnimated=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,l,p,d=this;return r.__generator(this,(function(h){return this.cancelAnimatedGoTo(),this.ready?((n=this.view.state.cameraController)instanceof P.PointToPointAnimationController&&(n.updateStateFromViewAnimation(),n.active&&(i=n)),null==i&&(i=new P.PointToPointAnimationController({view:this.view,mode:"animation"})),o=i.viewAnimation,c.isNone(o)?(I.warn("Unreachable code in ViewStateManager"),[2]):(s=this.createGoToCamera(e,t),o.update(s.then((function(e){return e.viewpoint}))),i===n||this.view.state.switchCameraController(i)?(l=o.target,p=function(){return d.view.state.cameraController===i&&c.isSome(i.viewAnimation)&&i.viewAnimation.target===l&&i.active},s.then((function(e){var n=e.viewpoint,a=e.camera,s=e.isFullySpecified;return r.__awaiter(d,void 0,void 0,(function(){var e,u,d=this;return r.__generator(this,(function(r){switch(r.label){case 0:return p()?(c.isSome(i.viewAnimation)&&(i.viewAnimation.update(n),l=i.viewAnimation.target),s?(e=new T.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}),b.applySurfaceCollisionConstraint(this.view,a,1)):b.applyAll(this.view,a),i.begin(a,this.internalAnimateOptions(t)),u=function(){var t=d.view.state.cameraController;e&&(t&&t.active?t instanceof P.PointToPointAnimationController&&c.isSome(t.viewAnimation)&&t.viewAnimation.target===l&&(d.view.state.cameraController=e):c.isSome(i.viewAnimation)&&i.viewAnimation.target===l&&"finished"===i.state&&(d.view.state.cameraController=e))},[4,o.when(u,u)]):[2];case 1:return r.sent(),[2]}}))}))})).catch((function(e){if(!u.isAbortError(e)&&e instanceof a&&e.message&&I.error("#goTo()","Failed to create camera from target, "+e.message[0].toLowerCase()+e.message.slice(1)),p())throw d.view.state.cameraController.stopController(),e})),[2,this.cancellableGoTo(i,t)]):(o.stop(),I.error("#goTo()","Cannot start an animation while interacting"),[2,u.reject(new a("view:goto-cannot-interrupt","Cannot start an animation while interacting"))]))):[2,this.goToAnimatedBeforeReady(e,t)]}))}))},t.prototype.internalAnimateOptions=function(e){var t={};return e&&(null!=e.speedFactor&&(t.speedFactor=e.speedFactor),null!=e.duration&&(t.duration=e.duration/1e3),null!=e.maxDuration&&(t.maxDuration=e.maxDuration/1e3),null!=e.easing&&("string"==typeof e.easing?t.easing=E.named[e.easing]:t.easing=e.easing)),t},r.__decorate([f.property({type:n,dependsOn:["view.state.camera","ready"]})],t.prototype,"camera",null),r.__decorate([f.property({type:g,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],t.prototype,"center",null),r.__decorate([f.property({type:y,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],t.prototype,"extent",null),r.__decorate([f.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],t.prototype,"frustum",null),r.__decorate([f.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],t.prototype,"hasInitialView",null),r.__decorate([f.property({readOnly:!0,type:Boolean})],t.prototype,"ready",void 0),r.__decorate([f.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],t.prototype,"scale",null),r.__decorate([f.property({dependsOn:["view.state.camera","ready"]})],t.prototype,"padding",null),r.__decorate([f.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],t.prototype,"screenCenter",null),r.__decorate([f.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([f.property({type:i,dependsOn:["camera","ready"]})],t.prototype,"viewpoint",null),r.__decorate([f.property({type:Number,dependsOn:["scale"]})],t.prototype,"zoom",null),r.__decorate([f.property({constructOnly:!0})],t.prototype,"updateDevicePixelRatio",void 0),r.__decorate([f.subclass("esri.views.3d.state.ViewStateManager")],t)}(o);t.ViewStateManager=R;var D=["camera","viewpoint","extent","scale","center","zoom"],L=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],j={heading:0,tilt:0},V=new n,F=new A.default,N=m.vec4f64.create(),k="pending-initial-view";t.default=R}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(168),r(157),r(151),r(342),r(533),r(1754),r(1755)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new i,r.nearFarHeuristic=u.createNearFarHeuristic(t.view.state.mode,t.view.basemapTerrain,t.view.renderCoordsHelper.spatialReference),r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],(function(){return e.handleClipDistanceNearFarChanged()})),this.view.watch("constraints.clipDistance.mode",(function(){return e.handleClipDistanceModeChanged()})),this.view.state.events.on("before-camera-change",(function(t){return e.cameraUpdateNearFar(t.camera)})),this.view.watch("dataExtent",(function(){return e.updateNearFar()}),!0)]),this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],(function(){return e.handleAltitudeMinMaxChanged()}),!0)]),this.handles.add([this.view.watch("constraints.tilt.max",(function(){return e.handleTiltMaxChanged()}),!0),this.view.watch("constraints.tilt.mode",(function(){return e.handleTiltModeChanged()}),!0),this.view.watch("state.camera",(function(){return e.tiltAutoUpdateMax()}),!0)]),this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],(function(){return e.updateCollision()}),!0)),this.view.state.isLocal&&this.handles.add(a.init(this.view,"dataExtent",(function(t){return e.updateLocalSurfaceDistance(t)}))),this.updateNearFar(),"local"!==this.view.state.mode&&this.updateAltitude(),this.updateTilt(),this.updateCollision(),this._set("surfaceCollisionConstraint",new p.default({view:this.view}))},t.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))},t.prototype.handleClipDistanceNearFarChanged=function(){var e=this,t=this.view.constraints&&this.view.constraints.clipDistance;t&&"auto"!==t.mode&&this.view.state.updateCamera((function(r){return e.cameraUpdateNearFarManual(r,t),!0}))},t.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()},t.prototype.updateNearFar=function(){var e=this;this.view.state.updateCamera((function(t){return e.cameraUpdateNearFar(t),!0}))},t.prototype.cameraUpdateNearFar=function(e){var t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?this.cameraUpdateNearFarManual(e,t):this.cameraUpdateNearFarAuto(e,t)},t.prototype.cameraUpdateNearFarAuto=function(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.dataExtent,c.surfaceElevationBelowEye(this.view,e),e),t&&t.autoUpdate(e.near,e.far)},t.prototype.cameraUpdateNearFarManual=function(e,t){t&&(e.near=t.near,e.far=t.far)},t.prototype.updateCollision=function(){var e=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,t=this.view.constraints&&this.view.constraints.collision.enabled,r=e?"stay-above"===e.type:t,n=this.view.state.constraints.collision;if(r!==n.enabled){n.enabled=r,r&&this.reapplyConstraints(8);var i=this.view.constraints&&this.view.constraints.tilt;i&&"auto"!==i.mode||this.updateTiltAuto()}},t.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()},t.prototype.updateAltitude=function(){var e=this.view.constraints&&this.view.constraints.altitude;e&&"local"!==this.view.state.mode?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this.reapplyConstraints()},t.prototype.handleTiltModeChanged=function(){this.updateTilt()},t.prototype.handleTiltMaxChanged=function(){var e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this.updateTiltManual(e),this.reapplyConstraints())},t.prototype.updateTilt=function(){var e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this.updateTiltManual(e):this.updateTiltAuto(),this.reapplyConstraints()},t.prototype.updateTiltManual=function(e){var t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(o.deg2rad(e.max))},t.prototype.updateTiltAuto=function(){var e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this.tiltAutoUpdateMax()},t.prototype.tiltAutoUpdateMax=function(){var e=this.view.constraints&&this.view.constraints.tilt;if(e&&"auto"===e.mode){var t=this.view.state.constraints;if(t.tilt){var r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(o.rad2deg(r))}}},t.prototype.updateLocalSurfaceDistance=function(e){var t=Math.max(e.width,e.height);if(!(t<=0)){e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));var r=this.view.state,n=3*t/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}},t.prototype.reapplyConstraints=function(e){var t=this;void 0===e&&(e=15),this.view.state.updateCamera((function(r){return l.applyAll(t.view,r,{selection:e,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})}))},r.__decorate([s.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"surfaceCollisionConstraint",void 0),r.__decorate([s.subclass("esri.views.3d.state.ConstraintsManager")],t)}(n);t.ConstraintsManager=d,t.default=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(168),r(200),r(162),r(160),r(238)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createNearFarHeuristic=function(e,t,r){return"global"===e?new c:new l(t,r)};var l=function(){function e(e,t){this.elevationProvider=e,this.unitInMeters=i.getMetersPerUnitForSR(t)}return e.prototype.compute=function(e,t,i,a,l){l||(l={near:0,far:0});var c=e[2]*this.unitInMeters,d=c,y=c-a,g=this.elevationProvider?this.elevationProvider.elevationBounds:null;g&&(c=y>=0?d-this.unitInMeters*g.min:this.unitInMeters*g.max-d);var _={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},b=Math.max(_.x,_.y,_.z);o.vec3.subtract(m,t,e),v[0]=m[0]>0?i.xmax:i.xmin,v[1]=m[1]>0?i.ymax:i.ymin,v[2]=m[2]>0?b/2:-b/2,o.vec3.subtract(v,v,e),o.vec3.normalize(m,m);var x=1.1*o.vec3.dot(v,m)*this.unitInMeters,w=Math.sqrt(c*(c+2*s.earthRadius)),S=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),P=S*h*this.unitInMeters,T=S*f*this.unitInMeters,O=r.clamp((c-T)/(P-T),0,1);O*=O*O;var C=n.lerp(w,x,O);return C*=Math.max(Math.log(Math.abs(y)),1),C=Math.min(C,Math.max(34064e4,b)),u(C/=this.unitInMeters,p,this.unitInMeters,l)},e}(),c=function(){function e(){}return e.prototype.compute=function(e,t,n,i,a){a||(a={near:0,far:0});var l=o.vec3.length(e)-s.earthRadius,c=s.earthRadius+Math.min(0,i),p=Math.abs(l-i),d=Math.max(p,Math.abs(l));return u(1.2*Math.sqrt(d*(d+2*c)),r.clamp(2e4-(Math.log(d)-7.983)/9.011*19e3,1e3,2e4),1,a)},e}();function u(e,t,r,n){var i=d/r;return e/t>i?(n.far=e,n.near=n.far/t):(n.near=i,n.far=n.near*t),n}var p=2e4,d=2,h=.001,f=1e-4,v=a.vec3f64.create(),m=a.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(151),r(342),r(533)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new i,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",(function(t){return e.handleElevationChangeEvent(t)})))},t.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.handleElevationChangeEvent=function(e){if(!this.view.state.cameraController){var t=this.view.state.camera;s.eyeWithinExtent(this.view,t,e.extent,e.spatialReference)&&this.applyToCurrentCamera()}},t.prototype.applyToCurrentCamera=function(){var e=this;this.view.state.updateCamera((function(t){a.applySurfaceCollisionConstraint(e.view,t,1)}))},r.__decorate([o.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([o.subclass("esri.views.3d.state.ElevationCollisionConstraint")],t)}(n);t.SurfaceCollisionConstraint=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(167),r(151),r(342),r(533),r(799)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new n,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"desiredCamera",{set:function(e){this._set("desiredCamera",e.clone())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0}),t.prototype.onControllerStart=function(){var e=this;this.state=s.State.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",(function(t){return e.handleElevationChangeEvent(t)}))),this.applyCorrection()},t.prototype.onControllerEnd=function(){this.handles.removeAll()},t.prototype.stepController=function(){},t.prototype.handleElevationChangeEvent=function(e){a.eyeWithinExtent(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this.applyCorrection()},t.prototype.applyCorrection=function(){var e=this;this.view.state.updateCamera((function(t){t.copyViewFrom(e.desiredCamera),o.applySurfaceCollisionConstraint(e.view,t,1)||e.constraintEnabled||(e.state=s.State.Stopped)}))},r.__decorate([i.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([i.property({constructOnly:!0})],t.prototype,"desiredCamera",null),r.__decorate([i.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],t)}(s.CameraController);t.SurfaceCollisionCorrectionController=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(638),r(159),r(174),r(369),r(226),r(177),r(154),r(152),r(153),r(272),r(276),r(185),r(162),r(160),r(193),r(173),r(197),r(533),r(925),r(644),r(203),r(251),r(192)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T){function O(e){return 360-P.cyclicalDeg.normalize(e)}function C(e){return P.cyclicalDeg.normalize(360-e)}function M(e,t){return e&&e.resolver&&(null==t?e.resolver.reject():e.resolver.resolve(t)),t}function A(e,t,r,n){if(!t)return M(n);var o=e.spatialReference||i.SpatialReference.WGS84;if(t.camera){var a=t.get("camera.position.spatialReference");if(!_.canProject(a,o))return M(n);var s=t.camera.clone();return a.equals(o)||(s.position=_.project(s.position,o)),M(n,s)}var l=t.get("targetGeometry.spatialReference");if(l&&!_.canProject(l,o))return M(n);var c=x.internalToExternal(e,e.state.camera),u=1;if(null!=t.rotation&&(c.heading=O(t.rotation),u=0),null!=r&&(c.tilt=r),"point"===t.targetGeometry.type){var p,d=t.targetGeometry,h=t.targetGeometry.clone();return p=null!=t.scale?x.scaleToDistance(e,t.scale,d.latitude):e.state.camera.distance,x.fromCenterDistance(e,h,p,c,u,n)}var f=t.targetGeometry.extent;return x.fromExtent(e,f,c.heading,c.tilt,u,n)}function E(e,t){return null==t.scale&&null!=t.zoom?x.zoomToScale(e,t.zoom):t.scale}function I(e,t){var r=!1;return null!=t.heading?(e.heading=t.heading,r=!0):null!=t.rotation&&(e.heading=O(t.rotation),r=!0),null!=t.tilt&&(e.tilt=t.tilt,r=!0),null!=t.fov&&(e.fov=t.fov),r}function R(e,t,r){var n=e.spatialReference||i.SpatialReference.WGS84;return t=t||x.externalToInternal(e,r.camera),r.targetGeometry=T.vectorToPoint(t.center,e.renderSpatialReference,n),r.scale=x.computeScale(e,t),r.rotation=C(r.camera.heading),r}function D(e,t,r){if(t){if(!_.canProject(t.spatialReference,e.spatialReference))throw new c("viewpointutils:incompatible-spatialreference","Spatial reference ("+(t.spatialReference?t.spatialReference.wkid:"unknown")+") is incompatible with the view ("+e.spatialReference.wkid+")",{geometry:t});var n=[];if(!t.hasZ&&e.basemapTerrain){var i=void 0;switch(t.type){case"point":i=t;break;case"multipoint":case"polyline":case"mesh":i=t.extent.center;break;case"extent":i=t.center;break;case"polygon":i=t.centroid;break;default:l.neverReached(t)}i&&_.canProject(i,e.basemapTerrain.spatialReference)?q[2]=w.getElevationAtPoint(e.elevationProvider,i)||0:q[2]=0}(0,te[t.type])(t,(function(e){n.push(e[0],e[1],e[2])}),q);var o=n.length/3;if(0!==o){var a=new Array(n.length);if(T.bufferToBuffer(n,t.spatialReference,0,a,e.spatialReference,0,o)){t.hasZ&&(r.hasZ=!0);for(var s=0;s<a.length;s+=3)t.hasZ?(q[0]=a[s+0],q[1]=a[s+1],q[2]=a[s+2]):(q[0]=a[s+0],q[1]=a[s+1]),y.expand(r.boundingBox,q)}}}}function L(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,a,l,c,p,d;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,s.result(e.whenViewForGraphic(t))];case 1:return!1!==(o=r.sent()).ok&&!u.isNone(o.value)&&"whenGraphicBounds"in o.value?(a=o.value,[4,s.result(a.whenGraphicBounds(t,{minDemResolution:n}))]):(D(e,t.geometry,i),[2]);case 2:return!1===(l=r.sent()).ok?(D(e,t.geometry,i),[2]):(c=l.value,p=c.screenSpaceObjects,d=c.boundingBox,y.expand(i.boundingBox,d),p&&p.forEach((function(e){i.screenSpaceObjects.push(e)})),isFinite(d[2])&&(i.hasZ=!0),[2])}}))}))}function j(e,t,n,a){return r.__awaiter(this,void 0,void 0,(function(){var s,l;return r.__generator(this,(function(r){switch(r.label){case 0:return Array.isArray(t)&&2===t.length&&(s=t[0],l=t[1],"number"==typeof s&&"number"==typeof l)?(ee.x=s,ee.y=l,ee.z=void 0,ee.spatialReference=e.spatialReference.isGeographic?e.spatialReference:i.SpatialReference.WGS84,D(e,ee,a),[2]):t&&"function"==typeof t.map?[4,p.eachAlways(t.map((function(t){return j(e,t,n,a)})))]:[3,2];case 1:return r.sent(),[2];case 2:return t instanceof i.BaseGeometry?(D(e,t,a),[3,5]):[3,3];case 3:return t instanceof o?[4,L(e,t,n,a)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}function V(e,t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l;return r.__generator(this,(function(r){switch(r.label){case 0:return t.camera?[2,F(e,t.camera,o)]:(o.scale=t.scale,o.rotation=t.rotation,o.targetGeometry=t.targetGeometry?t.targetGeometry.clone():null,o.camera=null,null!=n.heading?o.rotation=C(n.heading):null!=n.rotation&&(o.rotation=n.rotation),null!=(a=E(e,n))&&(o.scale=a),s=x.createAsyncContext(i),A(e,o,n.tilt,s),l=o,[4,s.resolver.promise]);case 1:return l.camera=r.sent(),[2,o]}}))}))}function F(e,t,r){r.camera=t.clone(),r.camera.fov=e.camera.fov;var n=e.spatialReference,i=r.camera.position.spatialReference;return _.canProject(i,n)?(i.equals(n)||(r.camera.position=_.project(r.camera.position,n)),R(e,null,r)):null}function N(e,t,r,n,o){var a=e.renderSpatialReference;return T.pointToVector(r.position,Q,a),T.pointToVector(t,K,a),o.targetGeometry=new i.Point(t),o.camera.position=new i.Point(r.position),v.vec3.subtract(Y,K,Q),x.directionToHeadingTilt(e,Q,Y,n.up,o.camera),o.scale=x.distanceToScale(e,v.vec3.distance(Q,K),o.targetGeometry.latitude),o.rotation=C(o.camera.heading),o}function k(e,t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u,p,d;return r.__generator(this,(function(r){switch(r.label){case 0:if(!n)throw new c("createfromcenter","invalid point");return o.targetGeometry=n.clone(),a=b.cameraOnContentAlongViewDirection(e),t.position?[2,N(e,o.targetGeometry,t,a,o)]:(t.zoomFactor&&(s=a.distance/t.zoomFactor,l=v.vec3.scale(q,a.viewForward,-s),v.vec3.add(a.eye,a.center,l),a.markViewDirty(),o.scale=x.distanceToScale(e,s,n.latitude)),x.internalToExternal(e,a,o.camera),u=I(o.camera,t)?0:1,t.zoomFactor?[3,2]:(o.scale=E(e,t),null==o.scale&&(T.pointToVector(n,q,e.renderSpatialReference),S.frustum.intersectsPoint(a.frustum.planes,q)?o.scale=x.distanceToScale(e,v.vec3.distance(a.eye,q),n.latitude):o.scale=x.computeScale(e,a)),p=x.createAsyncContext(i),x.fromCenterScale(e,o.targetGeometry,o.scale,o.camera,u,p),d=o,[4,p.resolver.promise]));case 1:d.camera=r.sent(),r.label=2;case 2:return[2,o]}}))}))}function z(e,t,r){var n=b.cameraOnContentAlongViewDirection(e);return v.vec3.copy(Y,n.viewForward),x.directionToHeadingTilt(e,n.eye,Y,n.up,$),r.camera.position=new i.Point(t.position),r.camera.heading=null!=t.heading?t.heading:$.heading,r.camera.tilt=null!=t.tilt?t.tilt:$.tilt,R(e,null,r)}function U(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,a;return r.__generator(this,(function(r){return o=b.cameraOnContentAlongViewDirection(e),a=T.vectorToPoint(o.center,e.renderSpatialReference,ee,e.spatialReference),[2,k(e,t,a,n,i)]}))}))}function B(e,t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:return o.targetGeometry=n.clone(),a=b.cameraOnContentAlongViewDirection(e),x.internalToExternal(e,a,o.camera),s=I(o.camera,t)?0:1,l=x.createAsyncContext(i),x.fromExtent(e,n,o.camera.heading,o.camera.tilt,s,l),c=o,[4,l.resolver.promise];case 1:return c.camera=r.sent(),[2,o]}}))}))}function G(e,t,n,i,o,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,p,h;return r.__generator(this,(function(r){switch(r.label){case 0:return s.targetGeometry=n.clone(),l=b.cameraOnContentAlongViewDirection(e),c=function(e,t,r,n,i){var o=0;r.hasZ?o=r.z:e.basemapTerrain&&(o=w.getElevationAtPoint(e.elevationProvider,r)),v.vec3.set(q,r.x,r.y,o),T.computeLinearTransformation(e.spatialReference,q,W,e.renderSpatialReference),d.mat3.fromMat4(J,W),d.mat3.transpose(J,J),y.empty(Z);for(var a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],s=0;s<a.length;s++){var l=a[s],c=n[l[2]];isFinite(c)||(c=o),v.vec3.set(q,n[l[0]],n[l[1]],c),T.vectorToVector(q,e.spatialReference,q,e.renderSpatialReference),y.expand(Z,v.vec3.transformMat3(q,q,J))}var u=y.width(Z),p=y.height(Z),h=y.depth(Z),f=1/Math.tan(t.fovX/2),m=1/Math.tan(t.fovY/2),g=.5*Math.sqrt(u*u+h*h)*Math.max(m,f)+.5*p,_=.5*p*m+.5*Math.max(u,h);return Math.max(g,_)/i}(e,l,n,i,o),x.internalToExternal(e,l,s.camera),u=I(s.camera,t)?0:1,s.scale=x.distanceToScale(e,c,s.targetGeometry.latitude),p=x.createAsyncContext(a),x.fromCenterScale(e,s.targetGeometry,s.scale,s.camera,u,p),h=s,[4,p.resolver.promise];case 1:return h.camera=r.sent(),[2,s]}}))}))}function H(e){return e&&(e.rotation=C(e.camera.heading)),e}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FRAME_COVERAGE=.66,t.rotationToHeading=O,t.headingToRotation=C,t.toCamera=A,t.fromInternalCamera=function(e,t,r){return r||(r=new a({camera:new n})),x.internalToExternal(e,t,r.camera),R(e,t,r)},t.fromCamera=function(e,t,r){return r||(r=new a),r.camera=t.clone(),R(e,null,r)},t.create=function(e,o,s){return r.__awaiter(this,void 0,void 0,(function(){var l,u,p,d,h,f,v,m,_,b,w,S;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(l=function(e,t){if(!t||!e.spatialReference)return null;var r={target:null};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(var n in t)r[n]=t[n];t.center&&!r.target&&(r.target=t.center)}return r}(e,o)))throw new c("viewpointutils-create:no-target","Missing target for creating viewpoint");return u=new a({camera:new n({fov:e.camera.fov})}),l.target instanceof a?[4,V(e,l.target,l,s,u)]:[3,2];case 1:return[2,H(r.sent())];case 2:return l.target instanceof n?[2,H(F(e,l.target,u))]:(p=null!=l.scale||null!=l.zoom,l.target instanceof i.Extent?(m=l.target.xmin===l.target.xmax||l.target.ymin===l.target.ymax,p||m?(d=H,[4,k(e,l,l.target.center,s,u)]):[3,4]):[3,6]);case 3:return[2,d.apply(void 0,[r.sent()])];case 4:return h=H,[4,B(e,l,l.target,s,u)];case 5:return[2,h.apply(void 0,[r.sent()])];case 6:return f={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]},v=p?function(e,t){return x.scaleToResolution(e,E(e,t))}(e,l):void 0,[4,j(e,l.target,v,f)];case 7:return r.sent(),isFinite(f.boundingBox[0])?(y.center(f.boundingBox,q),ee.x=q[0],ee.y=q[1],ee.z=q[2],ee.spatialReference=e.spatialReference,m=void 0,isFinite(ee.z)&&f.hasZ?m=y.isPoint(f.boundingBox):(ee.z=void 0,m=g.isPoint(y.toRect(f.boundingBox,X))),p||m?(_=H,[4,k(e,l,ee,s,u)]):[3,9]):[3,11];case 8:return[2,_.apply(void 0,[r.sent()])];case 9:return b=function(e,r){var n=t.DEFAULT_FRAME_COVERAGE;if(!r.length)return n;for(var i=Number.NEGATIVE_INFINITY,o=0;o<r.length;o++){var a=r[o].screenSpaceBoundingRect;i=Math.max(i,Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2]),Math.abs(a[3]))}return n-i/Math.min(e.width,e.height)*2}(e,f.screenSpaceObjects),w=H,[4,G(e,l,ee,f.boundingBox,b,s,u)];case 10:return[2,w.apply(void 0,[r.sent()])];case 11:return l.position?[2,H(z(e,l,u))]:(S=H,[4,U(e,l,s,u)]);case 12:return[2,S.apply(void 0,[r.sent()])]}}))}))};var q=m.vec3f64.create(),W=f.mat4f64.create(),J=h.mat3f64.create(),Z=y.create(),X=g.create(),Y=m.vec3f64.create(),Q=m.vec3f64.create(),K=m.vec3f64.create(),$={heading:0,tilt:0},ee=new i.Point,te={point:function(e,t,r){r[0]=e.x,r[1]=e.y,e.hasZ&&(r[2]=e.z),t(r)},polygon:function(e,t,r){for(var n=e.hasZ,i=0;i<e.rings.length;i++)for(var o=e.rings[i],a=0;a<o.length;a++)r[0]=o[a][0],r[1]=o[a][1],n&&(r[2]=o[a][2]),t(r)},polyline:function(e,t,r){for(var n=e.hasZ,i=0;i<e.paths.length;i++)for(var o=e.paths[i],a=0;a<o.length;a++)r[0]=o[a][0],r[1]=o[a][1],n&&(r[2]=o[a][2]),t(r)},multipoint:function(e,t,r){for(var n=e.points,i=e.hasZ,o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)},extent:function(e,t,r){e.hasZ?(t(v.vec3.set(r,e.xmin,e.ymin,e.zmin)),t(v.vec3.set(r,e.xmax,e.ymin,e.zmin)),t(v.vec3.set(r,e.xmin,e.ymax,e.zmin)),t(v.vec3.set(r,e.xmax,e.ymax,e.zmin)),t(v.vec3.set(r,e.xmin,e.ymin,e.zmax)),t(v.vec3.set(r,e.xmax,e.ymin,e.zmax)),t(v.vec3.set(r,e.xmin,e.ymax,e.zmax)),t(v.vec3.set(r,e.xmax,e.ymax,e.zmax))):(t(v.vec3.set(r,e.xmin,e.ymin,r[2])),t(v.vec3.set(r,e.xmax,e.ymin,r[2])),t(v.vec3.set(r,e.xmin,e.ymax,r[2])),t(v.vec3.set(r,e.xmax,e.ymax,r[2])))},mesh:function(e,t,r){var n=e.vertexAttributes&&e.vertexAttributes.position;if(n)for(var i=0;i<n.length;i+=3)t(v.vec3.set(r,n[i+0],n[i+1],n[i+2]))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(214),r(171),r(162),r(160),r(203),r(355),r(390),r(391)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p,d=function(){function e(e,t,r){this.viewingMode=e,this.layerProvider=t,this.view=r,this.externalIntersectionHandlers=new n,this.tolerance=c.Intersector.DEFAULT_TOLERANCE,this.tmpRay=s.ray.create(),this.validateHUDIntersector=new c.Intersector(this.viewingMode),this.validateHUDIntersector.options.hud=!1}return e.prototype.intersectScreen=function(e,t){return this.intersectRay(this.getPickRay(e,this.tmpRay),f(this.viewingMode),t)},e.prototype.intersectScreenFreePointFallback=function(e,t){return this.intersectRayFreePointFallback(this.getPickRay(e,this.tmpRay),t)},e.prototype.intersectRayFreePointFallback=function(e,t){return this.intersectRay(e,f(this.viewingMode),t)||this.intersectRayFreePointLocal(e,t)},e.prototype.intersectRay=function(e,t,r,n){return t.options.selectionMode=!1,t.options.store=0,this.computeIntersection(e,t,n),!!t.results.min&&t.results.min.getIntersectionPoint(r)},e.prototype.getCenterRayWithSubpixelOffset=function(e,t,r,n){return void 0===r&&(r=.5),void 0===n&&(n=.5),e.getRenderCenter(y,r,n),y[0]+=.0466,y[1]-=.0123,s.ray.fromRenderAtEye(e,y,t)},e.prototype.intersectIntersectorScreen=function(e,t,r){this.computeIntersection(this.getPickRay(e,this.tmpRay),t,r)},e.prototype.intersectToolIntersectorScreen=function(e,t,r){var n=this.getPickRay(e,this.tmpRay);this.intersectToolIntersectorRay(n,t,r)},e.prototype.intersectToolIntersectorRay=function(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);var n=t.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||n.hasIntersectionPoint&&"TerrainRenderer"!==n.intersector||(t.options.selectionMode=!1,this.computeIntersection(e,t,r))},e.prototype.setTolerance=function(e){void 0===e&&(e=c.Intersector.DEFAULT_TOLERANCE),this.tolerance=e},e.prototype.addIntersectionHandler=function(e){this.externalIntersectionHandlers.push(e),this.externalIntersectionHandlers.sort((function(e,t){return"Terrain"===e.type?1:"Terrain"===t.type?-1:0}))},e.prototype.removeIntersectionHandler=function(e){this.externalIntersectionHandlers.removeUnordered(e),this.externalIntersectionHandlers.sort((function(e,t){return"Terrain"===e.type?1:"Terrain"===t.type?-1:0}))},e.prototype.getPickRay=function(e,t){void 0===t&&(t=s.ray.create());var r=this.view.state.camera;return s.ray.fromScreen(r,e,t)},e.prototype.intersectRayFreePointLocal=function(e,t){if("local"!==this.viewingMode)return!1;var r=this.view.dataExtent,n={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},i=Math.max(n.x,n.y,n.z);if(0===i)return o.vec3.add(t,e.origin,o.vec3.normalize(l.sv3d.get(),e.direction)),!0;var a=this.view.state.camera,s=Math.max(0,r.xmin-a.eye[0],a.eye[0]-r.xmax),c=Math.max(0,r.ymin-a.eye[1],a.eye[1]-r.ymax),u=Math.sqrt(s*s+c*c),p=Math.abs(a.relativeElevation)+Number.MIN_VALUE,d=Math.pow(Math.max(0,Math.log(i/p)),2),h=i/Math.max(1,d);h=Math.max(h,Math.min(u,i));var f=o.vec3.scale(l.sv3d.get(),e.direction,h/o.vec3.length(e.direction));return o.vec3.add(t,e.origin,f),!0},e.prototype.intersectElevationFromScreen=function(e,t,r){return void 0===r&&(r=0),this.intersectElevation(this.getPickRay(e,this.tmpRay),t,r)},e.prototype.intersectElevation=function(e,t,n){void 0===n&&(n=0);var a=r.isSome(t)?t.mode:"absolute-height",s=r.isSome(t)?r.unwrapOr(t.offset,0):0,p="on-the-ground"!==a?s+n:0,d=p/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===a){if(this.view.renderCoordsHelper.intersectManifold(e,p,m)){var h=this.view.computeMapPointFromVec3d(m);return h.z-=s,h}return null}var f=this.view.state.camera,y=i.castRenderScreenPointArray3(l.sv3d.get());f.projectPoint(e.origin,y);var g=this.prepareFilters(null,v),_=this.view.slicePlane,b=r.isSome(_)?u.sliceFilterPredicate(_):null,x=new c.Intersector(this.viewingMode);x.options.store=0,x.options.verticalOffset=d;var w=e.origin,S=o.vec3.add(l.sv3d.get(),w,e.direction);switch(x.reset(w,S),x.point=y,x.camera=f,x.filterPredicate=null,a){case"relative-to-scene":x.intersect(g.layers,y,f,this.tolerance,null,(function(e){return e.metadata&&e.metadata.isElevationSource})),this.externalIntersectionHandlers.forEach((function(e){if("I3S"===e.type||"Terrain"===e.type){var t=e.slicePlane?b:null;e.intersect(x,t,x.rayBeginPoint,x.rayEndPoint,y)}}));break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forEach((function(e){if(e.isGround){var t=e.slicePlane?b:null;e.intersect(x,t,x.rayBeginPoint,x.rayEndPoint,y)}}))}if(x.results.min.getIntersectionPoint(m)){var P=this.view.computeMapPointFromVec3d(m);return P.z=n,P}return null},e.prototype.computeIntersection=function(e,t,n){var a=this,s=this.view.state.camera,c=i.castRenderScreenPointArray3(l.sv3d.get());s.projectPoint(e.origin,c);var p=this.prepareFilters(n,v);t.options.storeTerrainResults=p.filterLayerUid(u.TERRAIN_ID),t.options.selectOpaqueTerrainOnly=!n||!("include"in n||"exclude"in n);var d=e.origin,h=o.vec3.add(l.sv3d.get(),e.origin,e.direction);t.reset(d,h),t.intersect(p.layers,c,s,this.tolerance);var f=this.view.slicePlane,m=r.isSome(f)?u.sliceFilterPredicate(f):null;t.intersect(p.sliceableLayers,c,s,this.tolerance,m);var y=n&&(n.terrainLocationFeedbackEnabled||n.enableDraped);this.externalIntersectionHandlers.forEach((function(e){if(e.intersectionHandlerId===u.TERRAIN_ID){if(!y&&!p.filterLayerUid(u.TERRAIN_ID))return}else if(!p.filterLayerUid(e.intersectionHandlerId))return;var r=e.slicePlane?m:null;e.intersect(t,r,d,h,c)}));var g=l.sv3d.get();if(n&&n.enableDraped&&t.results.ground.getIntersectionPoint(g)){var _=this.view.basemapTerrain.overlayManager.renderer,b=this.view.renderCoordsHelper.spatialReference,x=l.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(g,x,this.view.spatialReference),x[2]=this.view.elevationProvider.getElevation(g[0],g[1],g[2],b)||0,_.intersect(t,x,p.filterRenderGeometry)}t.sortResults();var w=t.results.hud;if(w.hasIntersectionPoint){var S=i.castRenderScreenPointArray3(l.sv3d.get()),P=l.sv3d.get(),T=l.sv3d.get();this.unprojectHUDResultRay(w.center,S,P,T);var O=o.vec3.distance(w.center,P)/o.vec3.distance(P,T)*.99;this.validateHUDIntersector.reset(P,T),this.validateHUDIntersector.intersect(p.layers,S,s,this.tolerance),this.validateHUDIntersector.intersect(p.sliceableLayers,S,s,this.tolerance,m),this.externalIntersectionHandlers.forEach((function(e){if(p.filterLayerUid(e.intersectionHandlerId)){var t=e.slicePlane?m:null;e.intersect(a.validateHUDIntersector,t,P,T,S)}}));var C=this.validateHUDIntersector.results.min;(null==C.dist||O<=C.dist)&&(t.results.min.copyFrom(w),t.results.all.splice(0,0,w))}},e.prototype.prepareFilters=function(e,t){var r=[],n=[];return this.layerProvider.forEachLayer((function(e){e.isPickable&&(e.isSliceable?n:r).push(e)})),t.include=e&&e.include,t.exclude=e&&e.exclude,t.layers.length=0,t.sliceableLayers.length=0,h(r,t.filterLayer,t.layers),h(n,t.filterLayer,t.sliceableLayers),t},e.prototype.unprojectHUDResultRay=function(e,t,r,n){var o=this.view.state.camera;o.projectPoint(e,t);var a=i.castRenderScreenPointArray3(l.sv3d.get());a[0]=t[0],a[1]=t[1],a[2]=0,o.unprojectPoint(a,r),a[2]=1,o.unprojectPoint(a,n)},e}();function h(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];t&&!t(o)||r.push(o)}return r}function f(e){return p||(p=new c.Intersector(e)),p.viewingMode=e,p}t.SceneIntersectionHelper=d;var v={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:function(e){return v.filterLayerUid(e.apiLayerUid)},filterLayerUid:function(e){var t=v.include,n=v.exclude;return r.isNone(e)?null==t&&null==n:(null==t||t.has(e))&&(null==n||!n.has(e))},filterRenderGeometry:function(e){return v.filterLayerUid(e.data.layerUid)}},m=a.vec3f64.create(),y=i.createRenderScreenPointArray()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(190),r(153),r(151),r(1267)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var r=e.call(this,t)||this;return r.providers={im:new Array,ground:new Array,scene:new Array},r.handles=new Map,r}return r.__extends(t,e),t.prototype.getElevation=function(e,t,r,n,i){var o=null;return null==(o=this._updateElevation(o,this.providers.im,e,t,r,n,i))&&(o=this._updateElevation(o,this.providers.ground,e,t,r,n,i)),"scene"===i&&(o=this._updateElevation(o,this.providers.scene,e,t,r,n,i)),o},t.prototype._updateElevation=function(e,t,r,n,i,o,a){for(var s=0,l=t;s<l.length;s++){var c=l[s].getElevation(r,n,i,o,a);null!=c&&(e=null!=e?Math.max(c,e):c)}return e},t.prototype.queryElevation=function(e,t,r,n,i,a,l){var c=this;void 0===i&&(i=null),void 0===a&&(a=0),this._elevationService||(this._elevationService=new s.ElevationQuery(this.view.spatialReference,(function(){return c.view.map&&c.view.map.ground}),{maximumAutoTileRequests:4}));var u=o.createResolver();return this._elevationService.queryElevation(e,t,i,a).then((function(i){"scene"===l&&(i=c._updateElevation(i,c.providers.scene,e,t,r,n,l)),u.resolve(i)})).catch((function(i){o.isAbortError(i)?u.reject(i):u.resolve(c.getElevation(e,t,r,n,l))})),u.promise},t.prototype.register=function(e,t){var r=this;this.handles.set(t,t.on("elevation-change",(function(e){return r.emit("elevation-change",e)}))),this.providers[e].push(t)},t.prototype.unregister=function(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(var t=0,r=Object.keys(this.providers);t<r.length;t++){var n=r[t],i=this.providers[n].indexOf(e);i>-1&&this.providers[n].splice(i,1)}},r.__decorate([a.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],t.prototype,"spatialReference",void 0),r.__decorate([a.subclass("esri.views.3d.support.CombinedElevationProvider")],t)}(i.EventedMixin(n));t.CombinedElevationProvider=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(164)],void 0===(i=function(e,t,r){var n=function(){function e(){}return e.isValidProfile=function(t){return t in e.profiles},e.getDefaultProfile=function(){return r("trident")||r("esri-iPhone")?"low":"medium"},e.apply=function(t,r){var n=e.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=n.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=n.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=n.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=n.graphics3D.polylineLodFactor,r.sceneService["3dObject"].lodFactor=n.sceneService["3dObject"].lodFactor,r.sceneService.point.lodFactor=n.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=n.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=n.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=n.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=n.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=n.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=n.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=n.tiledSurface.textureFadeDuration,r.antialiasingEnabled=n.antialiasingEnabled,r.physicallyBasedRenderingEnabled=n.physicalBasedRenderingEnabled,r.memoryLimit=n.memoryLimit,r.additionalCacheMemory=n.additionalCacheMemory,r.frameRate=n.frameRate,r.maximumRenderResolution=n.maximumRenderResolution,r.maximumPixelRatio=n.maximumPixelRatio},e.debug={reset:function(){var t=i();for(var r in t)e.profiles[r]=t[r]}},e}();function i(){var e=!!r("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!r("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!r("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}return function(e){e.profiles=i()}(n||(n={})),n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(158),r(152),r(151),r(374)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=new n([0,255,255]),t.haloColor=null,t.haloOpacity=1,t.fillOpacity=.25,t}return r.__extends(t,e),t.toEngineOptions=function(e){var t=n.toUnitRGBA(e.color),r=o.isSome(e.haloColor)?n.toUnitRGBA(e.haloColor):t;return{color:s.vec4f32.fromValues(t[0],t[1],t[2],t[3]),haloColor:s.vec4f32.fromValues(r[0],r[1],r[2],r[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity}},r.__decorate([a.property({type:n})],t.prototype,"color",void 0),r.__decorate([a.property({type:n})],t.prototype,"haloColor",void 0),r.__decorate([a.property()],t.prototype,"haloOpacity",void 0),r.__decorate([a.property()],t.prototype,"fillOpacity",void 0),r.__decorate([a.subclass("esri.views.3d.support.HighlightOptions")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(){return new Float32Array(4)}function n(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function i(){return r()}function o(){return n(1,1,1,1)}function a(){return n(1,0,0,0)}function s(){return n(0,1,0,0)}function l(){return n(0,0,1,0)}function c(){return n(0,0,0,1)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=n,t.createView=function(e,t){return new Float32Array(e,t,4)},t.zeros=i,t.ones=o,t.unitX=a,t.unitY=s,t.unitZ=l,t.unitW=c,t.ZEROS=i(),t.ONES=o(),t.UNIT_X=a(),t.UNIT_Y=s(),t.UNIT_Z=l(),t.UNIT_W=c()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(231),r(151),r(1268),r(1269),r(815),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updating=!1,t}return r.__extends(t,e),r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([a.subclass("esri.views.3d.support.ResourceController")],t)}(n);t.ResourceControllerMaster=d,t.newResourceController=function(e,t){return void 0===t&&(t=function(){return performance.now()}),new p.ResourceController({view:e,now:t})},function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._scheduler=null,t._memoryController=null,t._streamDataLoader=null,t._cameraChangeTime=0,t._handles=new i,t._frameTask=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._cameraChangeTime=this.now(),this._scheduler=u.newScheduler(this.now),this._memoryController=l.newMemoryController(this.view),this._streamDataLoader=new c.default,this._streamDataLoader.setup(s.maxDownloadSlots,s.downloadSlotsPerClient,this._scheduler),this._handles.add([this.view.watch("state.camera",(function(t,r){return e._cameraChangedHandler(t,r)}),!0),this.view.watch("stationary",(function(){return e._stationaryChangedHandler()})),this._memoryController.events.on("updating-changed",(function(){return e.notifyChange("updating")}))]),this._frameTask=o.addFrameTask({update:function(t){return e.frame(t)}})},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null),this._memoryController.destroy(),this._memoryController=null,this._scheduler.destroy(),this._scheduler=null},Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryController",{get:function(){return this._memoryController},enumerable:!0,configurable:!0}),t.prototype.createStreamDataRequester=function(e){var t=this._streamDataLoader;return{request:function(r,n,i){return t.request(r,n,e,i)},get busy(){return t.busy}}},t.prototype.frame=function(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(e.deltaTime/1e3),!this._scheduler)||(this._scheduler.state=this.state,this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())},t.prototype._cameraChangedHandler=function(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)},t.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()},Object.defineProperty(t.prototype,"state",{get:function(){var e=this.view;return e.animation?0:e.interacting||this._scheduler.now-this._cameraChangeTime<=n?1:2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{getQueueStats:function(t){return e._streamDataLoader.test.loadQueue.getStatsForType(t)},state:this.state}},enumerable:!0,configurable:!0}),r.__decorate([a.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"now",void 0),r.__decorate([a.property()],t.prototype,"_streamDataLoader",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],t.prototype,"updating",null),r.__decorate([a.subclass("esri.views.3d.support.ResourceController")],t)}(d);e.ResourceController=t;var n=300}(p||(p={}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1271)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n,i,o){var a=e.call(this,i)||this;return a.url=t,a.options=r,a.docType=n,a.key=o,a.result=null,a.status=1,a.request=null,a.abortController=null,a.resolvers=new Array,a.startTime=0,a}return r.__extends(t,e),t}(n.BaseTask);t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(154),r(200),r(359),r(954)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t,r){void 0===r&&(r=null),this.spatialReference=t,this.unitInMeters=o.getMetersPerUnitForSR(this.spatialReference),this._geometryServicePromise=this.loadGeometryService(e,r)}return e.prototype.loadGeometryService=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:if(t)return[2,t];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.create(e&&e.get("portalItem"))];case 2:return[2,r.sent()];case 3:throw r.sent(),new i("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");case 4:return[2]}}))}))},e.prototype.toGeographic=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,o,a,l,c,u,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._geometryServicePromise];case 1:return t=r.sent(),i=!0,Array.isArray(e[0])&&"number"!=typeof e[0]?o=e:(o=[e],i=!1),a=o.map((function(e){return e instanceof n.Point?e:new n.Point(e,p.spatialReference)})),l=new s({geometries:a,outSpatialReference:n.SpatialReference.WGS84}),[4,t.project(l)];case 2:return c=r.sent(),u=c.map((function(e){return"point"===e.type?[e.x,e.y]:void 0})),[2,i?u:u[0]]}}))}))},e}();t.MapCoordsHelper=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(163)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new r.default({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});t.generalizeToRESTParameters=function(e){var t=e.toJSON(),r=t.geometries,o=t.deviationUnit,a={maxDeviation:t.maxDeviation};return r&&r.length&&(a.geometries=JSON.stringify({geometryType:n.getJsonType(r[0]),geometries:r}),a.sr=JSON.stringify(r[0].spatialReference)),i.write(o,a,"deviationUnit"),a}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r.default({preserveShape:"preserve-shape"});t.lengthsToRESTParameters=function(e){var t=e.toJSON(),r=t.polylines,i=t.lengthUnit,o=t.geodesic,a=t.calculationType,s={};s.polylines=JSON.stringify(r);var l=e.polylines[0].spatialReference;return s.sr=l.wkid?l.wkid:JSON.stringify(l.toJSON()),i&&(s.lengthUnit=i),o&&(s.geodesic=o),a&&(s.calculationType=n.toJSON(a)),s}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(163)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new r.default({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),o=new r.default({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});t.offsetToRESTParameters=function(e){var t=e.toJSON(),r=t.geometries,a=t.bevelRatio,s=t.offsetDistance,l=t.offsetHow,c=t.offsetUnit,u={bevelRatio:a,offsetDistance:s};return r&&r.length&&(u.geometries=JSON.stringify({geometryType:n.getJsonType(r[0]),geometries:r}),u.sr=JSON.stringify(r[0].spatialReference)),l&&(u.offsetHow=i.toJSON(l)),c&&(u.offsetUnit=o.toJSON(c)),u}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166),r(163)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new r.default({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});t.relationToRESTParameters=function(e){var t=e.toJSON(),r=t.geometries1,o=t.geometries2,a=t.relation,s=t.relationParameter,l={};if(r&&r.length){l.geometries1=JSON.stringify({geometryType:n.getJsonType(r[0]),geometries:r});var c=r[0].spatialReference;l.sr=c.wkid?c.wkid:JSON.stringify(c)}return o&&o.length>0&&(l.geometries2=JSON.stringify({geometryType:n.getJsonType(o[0]),geometries:o})),a&&(l.relation=i.toJSON(a)),s&&(l.relationParam=s),l}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(166)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r.default({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});t.trimExtendToRESTParameters=function(e){var t=e.toJSON(),r=t.extendHow,i=t.polylines,o=t.trimExtendTo,a={};return a.extendHow=n.toJSON(r),i&&i.length&&(a.polylines=JSON.stringify(i),a.sr=JSON.stringify(i[0].spatialReference)),o&&(a.trimExtendTo=JSON.stringify(o)),a}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(179),r(163)],void 0===(i=function(e,t,r,n,i,o,a){var s=function(e){function t(t){var r=e.call(this,t)||this;return r.deviationUnit=null,r.geometries=null,r.maxDeviation=null,r}return r.__extends(t,e),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"deviationUnit",void 0),r.__decorate([i.property({json:{read:{reader:function(e){return e?e.map((function(e){return a.fromJSON(e)})):null}},write:{writer:function(e,t){t.geometries=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"geometries",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maxDeviation",void 0),r.__decorate([i.subclass("esri.tasks.support.GeneralizeParameters")],t)}(n.JSONSupport);return s.from=o.default(s),s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(155),r(151),r(179),r(163)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.calculationType=null,r.geodesic=null,r.lengthUnit=null,r.polylines=null,r}return r.__extends(t,e),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"calculationType",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"geodesic",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"lengthUnit",void 0),r.__decorate([o.property({type:[n.Polyline],json:{read:{reader:function(e){return e?e.map((function(e){return s.fromJSON(e)})):null}},write:{writer:function(e,t){t.polylines=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"polylines",void 0),r.__decorate([o.subclass("esri.tasks.support.LengthsParameters")],t)}(i.JSONSupport);return l.from=a.default(l),l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(179),r(163)],void 0===(i=function(e,t,r,n,i,o,a){var s=function(e){function t(t){var r=e.call(this,t)||this;return r.bevelRatio=null,r.geometries=null,r.offsetDistance=null,r.offsetHow=null,r.offsetUnit=null,r}return r.__extends(t,e),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"bevelRatio",void 0),r.__decorate([i.property({json:{read:{reader:function(e){return e?e.map((function(e){return a.fromJSON(e)})):null}},write:{writer:function(e,t){t.geometries=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"geometries",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"offsetDistance",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"offsetHow",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"offsetUnit",void 0),r.__decorate([i.subclass("esri.tasks.support.OffsetParameters")],t)}(n.JSONSupport);return s.from=o.default(s),s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(155),r(151),r(179),r(163)],void 0===(i=function(e,t,r,n,i,o,a){var s=function(e){function t(t){var r=e.call(this,t)||this;return r.geometries1=null,r.geometries2=null,r.relation=null,r.relationParameter=null,r}return r.__extends(t,e),r.__decorate([i.property({json:{read:{reader:function(e){return e?e.map((function(e){return a.fromJSON(e)})):null}},write:{writer:function(e,t){t.geometries1=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"geometries1",void 0),r.__decorate([i.property({json:{read:{reader:function(e){return e?e.map((function(e){return a.fromJSON(e)})):null}},write:{writer:function(e,t){t.geometries2=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"geometries2",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"relation",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"relationParameter",void 0),r.__decorate([i.subclass("esri.tasks.support.RelationParameters")],t)}(n.JSONSupport);return s.from=o.default(s),s}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(159),r(155),r(151),r(179),r(163)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r.extendHow="default-curve-extension",r.polylines=null,r.trimExtendTo=null,r}return r.__extends(t,e),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"extendHow",void 0),r.__decorate([o.property({type:[n.Polyline],json:{read:{reader:function(e){return e?e.map((function(e){return s.fromJSON(e)})):null}},write:{writer:function(e,t){t.polylines=e.map((function(e){return e.toJSON()}))}}}})],t.prototype,"polylines",void 0),r.__decorate([o.property({json:{read:{reader:function(e){return e?s.fromJSON(e):null}},write:{writer:function(e,t){t.trimExtendTo=e.toJSON()}}}})],t.prototype,"trimExtendTo",void 0),r.__decorate([o.subclass("esri.tasks.support.TrimExtendParameters")],t)}(i.JSONSupport);return l.from=a.default(l),l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(151)],void 0===(i=function(e,t,r,n,i){var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minTotalNumberOfFeatures=2e3,t.maxTotalNumberOfFeatures=5e4,t.maxTotalNumberOfPrimitives=17e5,t.polygonLodFactor=1,t.polylineLodFactor=1,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"minTotalNumberOfFeatures",void 0),r.__decorate([i.property()],t.prototype,"maxTotalNumberOfFeatures",void 0),r.__decorate([i.property()],t.prototype,"maxTotalNumberOfPrimitives",void 0),r.__decorate([i.property()],t.prototype,"polygonLodFactor",void 0),r.__decorate([i.property()],t.prototype,"polylineLodFactor",void 0),r.__decorate([i.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],t)}(n),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lodFactor=1,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"lodFactor",void 0),r.__decorate([i.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],t)}(n),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t["3dObject"]=new a,t.point=new a,t.integratedMesh=new a,t.pointCloud=new a,t.uncompressedTextureDownsamplingEnabled=!1,t}return r.__extends(t,e),r.__decorate([i.property({type:a})],t.prototype,"3dObject",void 0),r.__decorate([i.property({type:a})],t.prototype,"point",void 0),r.__decorate([i.property({type:a})],t.prototype,"integratedMesh",void 0),r.__decorate([i.property({type:a})],t.prototype,"pointCloud",void 0),r.__decorate([i.property()],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),r.__decorate([i.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],t)}(n),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lodBias=0,t.angledSplitBias=1,t.reduceTileLevelDifferences=!0,t.textureFadeDuration=500,t}return r.__extends(t,e),r.__decorate([i.property()],t.prototype,"lodBias",void 0),r.__decorate([i.property()],t.prototype,"angledSplitBias",void 0),r.__decorate([i.property()],t.prototype,"reduceTileLevelDifferences",void 0),r.__decorate([i.property()],t.prototype,"textureFadeDuration",void 0),r.__decorate([i.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],t)}(n);return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.graphics3D=new o,t.sceneService=new s,t.tiledSurface=new l,t.antialiasingEnabled=!0,t}return r.__extends(t,e),r.__decorate([i.property({type:o})],t.prototype,"graphics3D",void 0),r.__decorate([i.property({type:s})],t.prototype,"sceneService",void 0),r.__decorate([i.property({type:l})],t.prototype,"tiledSurface",void 0),r.__decorate([i.property()],t.prototype,"antialiasingEnabled",void 0),r.__decorate([i.property()],t.prototype,"physicallyBasedRenderingEnabled",void 0),r.__decorate([i.property()],t.prototype,"memoryLimit",void 0),r.__decorate([i.property()],t.prototype,"additionalCacheMemory",void 0),r.__decorate([i.property()],t.prototype,"frameRate",void 0),r.__decorate([i.property()],t.prototype,"maximumRenderResolution",void 0),r.__decorate([i.property()],t.prototype,"maximumPixelRatio",void 0),r.__decorate([i.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(200),r(189),r(162),r(170),r(207),r(238),r(203),r(192),r(355),r(1189)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e,t,r,n){this.type=e,this.spatialReference=t,this.unitInMeters=r,this.coordinateSystem=n,this.tmpCoordinateSystem=d.create(n)}return Object.defineProperty(e.prototype,"extent",{set:function(e){e&&d.setExtent(this.coordinateSystem,e,this.coordinateSystem)},enumerable:!0,configurable:!0}),e.prototype.getAltitude=function(e){return d.altitudeAt(this.coordinateSystem,e)},e.prototype.setAltitude=function(e,t){d.setAltitudeAt(this.coordinateSystem,t,e,t)},e.prototype.setAltitudeOfTransformation=function(e,t){d.setAltitudeOfTransformation(this.coordinateSystem,t,e,t)},e.prototype.worldUpAtPosition=function(e,t){return d.normalAt(this.coordinateSystem,e,t)},e.prototype.worldBasisAtPosition=function(e,t,r){return d.axisAt(this.coordinateSystem,e,t,r)},e.prototype.basisMatrixAtPosition=function(e,t){var r=this.worldBasisAtPosition(e,0,p.sv3d.get()),n=this.worldBasisAtPosition(e,1,p.sv3d.get()),o=this.worldBasisAtPosition(e,2,p.sv3d.get());return i.mat4.set(t,r[0],r[1],r[2],0,n[0],n[1],n[2],0,o[0],o[1],o[2],0,0,0,0,1),t},e.prototype.intersectManifoldClosestSilhouette=function(e,t,r){return d.elevate(this.coordinateSystem,t,this.tmpCoordinateSystem),d.intersectRayClosestSilhouette(this.tmpCoordinateSystem,e,r),r},e.prototype.intersectManifold=function(e,t,r){d.elevate(this.coordinateSystem,t,this.tmpCoordinateSystem);var n=p.sv3d.get();return!!d.intersectRay(this.tmpCoordinateSystem,e,n)&&(o.vec3.copy(r,n),!0)},e.prototype.intersectInfiniteManifold=function(e,t,r){if("global"===this.type)return this.intersectManifold(e,t,r);d.elevate(this.coordinateSystem,t,this.tmpCoordinateSystem);var n=this.tmpCoordinateSystem.value,i=p.sv3d.get();return!!c.plane.intersectRay(n.plane,e,i)&&(o.vec3.copy(r,i),!0)},e.prototype.toRenderCoords=function(e,t,r){return s.isPoint(e)?u.pointToVector(e,t,this.spatialReference):u.vectorToVector(e,t,r,this.spatialReference)},e.prototype.fromRenderCoords=function(e,t,r){return s.isPoint(t)?u.vectorToPoint(e,this.spatialReference,t,r):t instanceof a?u.vectorToPoint(e,this.spatialReference,t):u.vectorToVector(e,this.spatialReference,t,r)},e.createGlobal=function(t){return new e("global",t,1,d.fromValues(c.sphere,c.sphere.fromValues(l.earthRadius,[0,0,0])))},e.createLocal=function(t){var r=d.fromValues(c.boundedPlane,c.boundedPlane.fromValues([0,0,0],[f,0,0],[0,f,0]));return new e("local",t,n.getMetersPerUnitForSR(t),r)},e.createMode=function(t,n){switch(t){case"local":return e.createLocal(n);case"global":return e.createGlobal(n);default:return void r.neverReached(t)}},e}();t.RenderCoordsHelper=h;var f=Math.pow(2,50)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1270),r(1779),r(375)],void 0===(i=function(e,t,r,n,i){return function(e){var t=this;this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;var o=e.resourceController.memoryController;this.totalMemory=1024*o.maxMemory*1024,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=o.memoryFactor,this.load=e.resourceController.scheduler.load,this.terrainMemory=e.basemapTerrain?e.basemapTerrain.getUsedMemory():0;var a=e._stage&&e._stage.renderView&&e._stage.renderView.edgeView;this.edgesMemory=a?a.getUsedMemory():0,e.allLayerViews.items.forEach((function(o){(r.isMemoryManagedLayerView(o)||i.isSurfaceLayerView(o))&&t.layerPerformanceInfos.push(new n(o,e))})),this.layerPerformanceInfos.sort((function(e,t){return t.memory-e.memory}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1780),r(375)],void 0===(i=function(e,t,r,n){return function(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=n.isSurfaceLayerView(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),r.isPerformanceInfoLayerView(e)){var i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isPerformanceInfoLayerView=function(e){return"performanceInfo"in e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(165),r(154),r(164),r(156),r(153)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=a.getLogger("esri.layers.support.SpriteSource"),c=function(){function e(e,t){this.baseURL=e,this.devicePixelRatio=t,this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded"}return Object.defineProperty(e.prototype,"spriteNames",{get:function(){var e=[];for(var t in this._spritesData)e.push(t);return e.sort(),e},enumerable:!0,configurable:!0}),e.prototype.getSpriteInfo=function(e){return this._spritesData[e]},e.prototype.load=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:if(s.throwIfAborted(e),this.loadStatus="loading",!this.baseURL)return[2,s.resolve(this)];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._loadSprites(e)];case 2:return t.sent(),this.loadStatus="loaded",[3,4];case 3:return t.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}}))}))},e.prototype._loadSprites=function(e){var t=this;this._isRetina=this.devicePixelRatio>1.15;var a=this.baseURL,c=this._isRetina?"@2x":"",u=""+a+c+".png";return s.all([n(a+c+".json",e),n(u,r.__assign({responseType:"image"},e))]).then((function(e){var r=e[0],n=e[1],c=Object.keys(r.data);if(!c||0===c.length||1===c.length&&"_ssl"===c[0]||!n||!n.data)return t._spritesData=t.image=null,t.width=t.height=0,s.resolve(null);t._spritesData=r.data;var u=n.data,p=Math.max(o("esri-webgl-max-texture-size"),4096);if(u.width>p||u.height>p){var d="Sprite resource for style "+a+" is bigger than the maximum allowed of "+p+" pixels}";throw l.error(d),new i("SpriteSource",d)}t.width=u.width,t.height=u.height;var h=document.createElement("canvas"),f=h.getContext("2d");h.width=u.width,h.height=u.height,f.drawImage(u,0,0,u.width,u.height);for(var v,m=f.getImageData(0,0,u.width,u.height),y=new Uint8Array(m.data),g=0;g<y.length;g+=4)v=y[g+3]/255,y[g]=y[g]*v,y[g+1]=y[g+1]*v,y[g+2]=y[g+2]*v;t.image=y}))},e}();t.default=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(100),r(165),r(153),r(172),r(1783)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=n.defaults&&n.defaults.io.corsEnabledServers;function c(e){if(e){var t=a.getOrigin(e);l&&-1===l.indexOf(t)&&l.push(t)}}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=0;n<e.length;++n)if(a.isProtocolRelative(e[n])){if(r){var i=r.split("://")[0];r=i+":"+e[n].trim()}}else r=a.isAbsolute(e[n])?e[n]:a.join(r,e[n]);return a.removeTrailingSlash(r)}function p(e,t,n,s,l){return r.__awaiter(this,void 0,void 0,(function(){var u,p,v,m,y,g;return r.__generator(this,(function(_){switch(_.label){case 0:return o.throwIfAborted(l),"string"!=typeof n?[3,2]:(c(m=a.normalize(n)),y=a.urlToObject(m),[4,i(y.path,r.__assign({query:{f:"json"},responseType:"json"},l))]);case 1:return v=_.sent(),u=m,p=m,[3,3];case 2:v={data:n},u=n.jsonUrl||null,p=s,_.label=3;case 3:return g=v.data,v.ssl&&(u&&(u=u.replace(/^http:/i,"https:")),p&&(p=p.replace(/^http:/i,"https:"))),d(g)?(e.styleUrl=u||null,[2,h(e,g,p,l)]):d(g)?[2,o.reject("You must specify the URL or the JSON for a service or for a style.")]:e.sourceUrl?[2,f(e,g,p,!1,t,l)]:(e.sourceUrl=u||null,[2,f(e,g,p,!0,t,l)])}}))}))}function d(e){return!!e.sources}function h(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var s,l,d,h,f,v;return r.__generator(this,(function(r){switch(r.label){case 0:return s=n?a.removeFile(n):a.appBaseUrl,e.styleBase=s,e.style=t,e.styleUrl&&c(e.styleUrl),l=[],t.sources&&t.sources.esri?(d=t.sources.esri).url?[4,p(e,"esri",u(s,d.url),void 0,i)]:[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:l.push(p(e,"esri",d,s,i)),r.label=3;case 3:for(h=0,f=Object.keys(t.sources);h<f.length;h++)"esri"!==(v=f[h])&&"vector"===t.sources[v].type&&(t.sources[v].url?l.push(p(e,v,u(s,t.sources[v].url),void 0,i)):l.push(p(e,v,t.sources[v],s,i)));return[4,o.all(l)];case 4:return r.sent(),[2]}}))}))}function f(e,t,n,i,l,d){return r.__awaiter(this,void 0,void 0,(function(){var h,f,v,m;return r.__generator(this,(function(r){if(h=n?a.removeTrailingSlash(n)+"/":a.appBaseUrl,f=function(e,t){if(e.hasOwnProperty("tileInfo"))return e;for(var r={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100}},n=78271.51696400007,i=295828763.7957775,o=[],a=e.hasOwnProperty("minzoom")?parseFloat(e.minzoom):0,s=e.hasOwnProperty("maxzoom")?parseFloat(e.maxzoom):22,l=0;l<=s;l++)l>=a&&o.push({level:l,scale:i,resolution:n}),n/=2,i/=2;for(var p=0,d=e.tiles;p<d.length;p++){c(u(t,d[p]))}return{capabilities:"TilesOnly",initialExtent:r,fullExtent:r,minScale:0,maxScale:0,tiles:e.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:o,spatialReference:{wkid:102100}}}}(t,h),v=new s(l,h,f),!i&&e.primarySourceName in e.sourceNameToSource){if(!(m=e.sourceNameToSource[e.primarySourceName]).isCompatibleWith(v))return[2,o.resolve()];null!=v.fullExtent&&(null!=m.fullExtent?m.fullExtent.union(v.fullExtent):m.fullExtent=v.fullExtent.clone()),m.tileInfo.lods.length<v.tileInfo.lods.length&&(m.tileInfo=v.tileInfo)}return i?(e.sourceBase=h,e.source=t,e.validatedSource=f,e.primarySourceName=l,e.sourceUrl&&c(e.sourceUrl)):c(h),e.sourceNameToSource[l]=v,e.style?[2]:null==t.defaultStyles?[2,o.reject()]:"string"==typeof t.defaultStyles?[2,p(e,"",u(h,t.defaultStyles,"root.json"),void 0,d)]:[2,p(e,"",t.defaultStyles,u(h,"root.json"),d)]}))}))}t.loadMetadata=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,l,d;return r.__generator(this,(function(r){switch(r.label){case 0:return n={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:""},i="string"==typeof e?[e,null]:[null,e.jsonUrl],s=i[1],l=(o=i[0])?a.urlToObject(o):null,[4,p(n,"esri",e,s,t)];case 1:return r.sent(),c((d={layerDefinition:n.validatedSource,url:o,parsedUrl:l,serviceUrl:n.sourceUrl,style:n.style,styleUrl:n.styleUrl,spriteUrl:n.style.sprite&&u(n.styleBase,n.style.sprite),glyphsUrl:n.style.glyphs&&u(n.styleBase,n.style.glyphs),sourceNameToSource:n.sourceNameToSource,primarySourceName:n.primarySourceName}).spriteUrl),c(d.glyphsUrl),[2,d]}}))}))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(118),r(172),r(184),r(903),r(636),r(955)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(){function e(e,t,r){this.tileMapURL="",this.tilemapCache=null,this.parsedUrl=null,this.tileInfo=null,this.capabilities=null,this.tileIndex=null,this.fullExtent=null,this.name=e,this.sourceUrl=t,t&&(this.parsedUrl=i.urlToObject(this.sourceUrl));var c=n.clone(r),u=c.tiles;t&&u.forEach((function(e,r){i.isAbsolute(e)||(u[r]=i.join(t,e))})),this.tileServers=u,r.tileMap&&(this.tileMapURL=i.join(t,r.tileMap));var p=r.capabilities&&r.capabilities.split(",").map((function(e){return e.toLowerCase().trim()})),d=!!r.exportTilesAllowed,h=!!p&&-1!==p.indexOf("tilemap"),f=d&&r.hasOwnProperty("maxExportTilesCount")?r.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:d,supportsTileMap:h},exportTiles:d?{maxExportTilesCount:+f}:null},this.tileInfo=a.readServiceTileInfo(c.tileInfo,c,null,{ignoreMinMaxLOD:!0}),h&&(this.type="vector-tile",this.tilemapCache=new s.TilemapCache({layer:this}),this.tilemapCache&&(this.tileIndex=new l(this.tilemapCache))),this.fullExtent=o.fromJSON(r.fullExtent)}return e.prototype.getRefKey=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return this.tileIndex?[2,this.tileIndex.dataKey(e,t)]:[2,e]}))}))},e.prototype.getSourceTileUrl=function(e,t,r){var n=this.tileServers[t%this.tileServers.length];return n.replace(/\{z\}/gi,e.toString()).replace(/\{y\}/gi,t.toString()).replace(/\{x\}/gi,r.toString())},e.prototype.isCompatibleWith=function(e){var t=this.tileInfo,r=e.tileInfo;if(!t.spatialReference.equals(r.spatialReference))return!1;if(!t.origin.equals(r.origin))return!1;if(Math.round(t.dpi)!==Math.round(r.dpi))return!1;for(var n=t.lods,i=r.lods,o=Math.min(n.length,i.length),a=0;a<o;a++){var s=n[a],l=i[a];if(s.level!==l.level||Math.round(s.scale)!==Math.round(l.scale))return!1}return!0},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(237)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.areSchemasOverlapping=function(e,t){if(e===t)return!0;if(!e&&null!=t)return!1;if(null!=e&&!t)return!1;if(!e.spatialReference.equals(t.spatialReference)||e.dpi!==t.dpi)return!1;var r,n,i=e.origin,o=t.origin;if(Math.abs(i.x-o.x)>=1e-6||Math.abs(i.y-o.y)>=1e-6)return!1;e.lods[0].scale>t.lods[0].scale?(r=e,n=t):(n=e,r=t);for(var a=r.lods[0].scale;a>=n.lods[n.lods.length-1].scale-1e-6;a/=2)if(Math.abs(a-n.lods[0].scale)<1e-6)return!0;return!1},t.unionTileInfos=function(e,t){if(e===t)return e;if(!e&&null!=t)return t;if(null!=e&&!t)return e;for(var n=e.size[0],i=e.format,o=e.dpi,a={x:e.origin.x,y:e.origin.y},s=e.spatialReference.toJSON(),l=e.lods[0].scale>t.lods[0].scale?e.lods[0]:t.lods[0],c=e.lods[e.lods.length-1].scale<=t.lods[t.lods.length-1].scale?e.lods[e.lods.length-1]:t.lods[t.lods.length-1],u=l.scale,p=l.resolution,d=c.scale,h=[],f=u,v=p,m=0;f>d;)h.push({level:m,resolution:v,scale:f}),m++,f/=2,v/=2;return new r({size:[n,n],dpi:o,format:i||"pbf",origin:a,lods:h,spatialReference:s})}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(t,r,n){this._op=t,"$type"===r?(this._val=n instanceof Array?n.map((function(t){return e._types.indexOf(t)})):e._types.indexOf(n),this._op+=11):(this._key=r,this._val=n)}return e.prototype.filter=function(e){switch(this._op){case 0:return this._val;case 1:return e.values[this._key]===this._val;case 2:return e.values[this._key]!==this._val;case 3:return e.values[this._key]<this._val;case 4:return e.values[this._key]>this._val;case 5:return e.values[this._key]<=this._val;case 6:return e.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(e.values[this._key]);case 8:return-1===this._val.indexOf(e.values[this._key]);case 9:for(var t=0,r=this._val;t<r.length;t++)if(r[t].filter(e))return!0;return!1;case 10:for(var n=0,i=this._val;n<i.length;n++)if(!i[n].filter(e))return!1;return!0;case 11:for(var o=0,a=this._val;o<a.length;o++)if(a[o].filter(e))return!1;return!0;case 12:return e.type===this._val;case 13:return e.type!==this._val;case 14:return e.type<this._val;case 15:return e.type>this._val;case 16:return e.type>=this._val;case 17:return e.type<=this._val;case 18:return-1!==this._val.indexOf(e.type);case 19:return-1===this._val.indexOf(e.type);case 20:return void 0!==e.values[this._key];case 21:return void 0===e.values[this._key]}},e.createFilter=function(t){if(!t)return new e(0,void 0,!0);var r=t[0];if(t.length<=1)return new e(0,void 0,"any"!==r);switch(r){case"==":return new e(1,t[1],t[2]);case"!=":return new e(2,t[1],t[2]);case">":return new e(4,t[1],t[2]);case"<":return new e(3,t[1],t[2]);case">=":return new e(6,t[1],t[2]);case"<=":return new e(5,t[1],t[2]);case"in":return new e(7,t[1],t.slice(2));case"!in":return new e(8,t[1],t.slice(2));case"any":return new e(9,void 0,t.slice(1).map(e.createFilter.bind(this)));case"all":return new e(10,void 0,t.slice(1).map(e.createFilter.bind(this)));case"none":return new e(11,void 0,t.slice(1).map(e.createFilter.bind(this)));case"has":return new e(20,t[1],void 0);case"!has":return new e(21,t[1],void 0);default:throw new Error("invalid operator: "+r)}},e._types=["Unknown","Point","LineString","Polygon"],e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}},e.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}},e.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},e.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:"center"},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:["horizontal"]}},e.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}},e.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},e.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}},e.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1}},e.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}},e.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},e.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}},e}();t.StyleDefinition=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(182),r(499)],void 0===(i=function(e,t,r,n){return function(){function e(t,r){var n;switch(this.isDataDriven=!1,t.type){case"number":n=!0;break;case"color":n=!0,r=e._parseColor(r);break;case"array":n="number"===t.value;break;default:n=!1}null==r&&(r=t.default),n&&"interval"===r.type&&(n=!1);var i=r&&r.stops&&r.stops.length>0;if(i)for(var o=0,a=r.stops;o<a.length;o++){var s=a[o];s[1]=this._validate(s[1],t)}if(this.isDataDriven=!!r&&!!r.property,this.isDataDriven)if(void 0!==r.default&&(r.default=this._validate(r.default,t)),i)switch(r.type){case"identity":this.getValue=this._buildIdentity(r,t);break;case"categorical":this.getValue=this._buildCategorical(r,t);break;default:this.getValue=n?this._buildInterpolate(r,t):this._buildInterval(r,t)}else this.getValue=this._buildIdentity(r,t);else i?this.getValue=n?this._buildZoomInterpolate(r):this._buildZoomInterval(r):(r=this._validate(r,t),this.getValue=this._buildSimple(r))}return e.prototype._validate=function(e,t){if("number"===t.type){if(e<t.minimum)return t.minimum;if(e>t.maximum)return t.maximum}return e},e.prototype._buildSimple=function(e){return function(){return e}},e.prototype._buildIdentity=function(t,r){var n=this;return function(i,o){var a;return o&&(a=o.values[t.property],"color"===r.type&&(a=e._parseColor(a))),void 0===a&&(a=t.default),void 0!==a?n._validate(a,r):r.default}},e.prototype._buildCategorical=function(e,t){var r=this;return function(n,i){var o;return i&&(o=i.values[e.property]),void 0!==(o=r._categorical(o,e.stops))?o:void 0!==e.default?e.default:t.default}},e.prototype._buildInterval=function(e,t){var r=this;return function(n,i){var o;return i&&(o=i.values[e.property]),"number"==typeof o?r._interval(o,e.stops):void 0!==e.default?e.default:t.default}},e.prototype._buildInterpolate=function(e,t){var r=this;return function(n,i){var o;return i&&(o=i.values[e.property]),"number"==typeof o?r._interpolate(o,e.stops,e.base||1):void 0!==e.default?e.default:t.default}},e.prototype._buildZoomInterpolate=function(e){var t=this;return function(r){return t._interpolate(r,e.stops,e.base||1)}},e.prototype._buildZoomInterval=function(e){var t=this;return function(r){return t._interval(r,e.stops)}},e.prototype._categorical=function(e,t){for(var r=t.length,n=0;n<r;n++)if(t[n][0]===e)return t[n][1]},e.prototype._interval=function(e,t){for(var r=t.length,n=0,i=0;i<r&&t[i][0]<=e;i++)n=i;return t[n][1]},e.prototype._interpolate=function(e,t,r){for(var i,o,a=t.length,s=0;s<a;s++){var l=t[s];if(!(l[0]<=e)){o=l;break}i=l}if(i&&o){var c=o[0]-i[0],u=e-i[0],p=1===r?u/c:(Math.pow(r,u)-1)/(Math.pow(r,c)-1);if(Array.isArray(i[1])){var d=i[1],h=o[1],f=[];for(s=0;s<d.length;s++)f.push(n.interpolate(d[s],h[s],p));return f}return n.interpolate(i[1],o[1],p)}return i?i[1]:o?o[1]:void 0},e._isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e._parseColor=function(t){if(Array.isArray(t))return t;if("string"==typeof t){var n=new r(t);return this._isEmpty(n)?void 0:r.toUnitRGBA(n)}return t&&t.default&&(t.default=e._parseColor(t.default)),t&&t.stops&&(t.stops=t.stops.map((function(t){return[t[0],e._parseColor(t[1])]}))),t},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.type=e};t.RenderBucket=n;var i=function(e){function t(){var t=e.call(this,2)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return r.__extends(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(n);t.LineRenderBucket=i;var o=function(e){function t(){var t=e.call(this,1)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t.outlineElementStart=0,t.outlineElementCount=0,t}return r.__extends(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0||this.outlineElementCount>0},t.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3},t}(n);t.FillRenderBucket=o;var a=function(e){function t(){var t=e.call(this,3)||this;return t.iconPerPageElementsMap=new Map,t.glyphPerPageElementsMap=new Map,t.isSDF=!1,t}return r.__extends(t,e),t.prototype.hasData=function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0},t.prototype.triangleCount=function(){var e=0;return this.iconPerPageElementsMap.forEach((function(t){e+=t[1]})),this.glyphPerPageElementsMap.forEach((function(t){e+=t[1]})),e/3},t}(n);t.SymbolRenderBucket=a;var s=function(e){function t(){var t=e.call(this,4)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return r.__extends(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(n);t.CircleRenderBucket=s;var l=function(e){function t(){return e.call(this,0)||this}return r.__extends(t,e),t.prototype.hasData=function(){return!0},t.prototype.triangleCount=function(){return 2},t}(n);t.BackgroundRenderBucket=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(162),r(160),r(173),r(415),r(588)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=i.vec3f64.create(),c=i.vec3f64.create(),u=i.vec3f64.create(),p=i.vec3f64.create();function d(e,t,r,i){n.vec3.copy(l,r),l[i]=t[i];var o,a=n.vec3.subtract(l,l,t),s=n.vec3.subtract(c,e,t),u=n.vec3.dot(s,a),p=n.vec3.dot(a,a);o=u<=0?t:p<=u?r:n.vec3.add(l,t,n.vec3.scale(a,a,u/p));var d=n.vec3.subtract(l,e,o);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}t.isInsideExtent=function(e,t,r){void 0===r&&(r=0);var n=e.extent;if(0===r)return o.containsPoint(n,t);var i=Math.min(n[2]-n[0],n[3]-n[1]);return o.containsPointWithMargin(n,t,r*i)},t.tiltOnEdge=d,t.tiltToExtentEdge=function(e,t){var r=e.elevationBounds,n=e.extent,i=.5*(r.min+r.max);u[0]=n[0],u[1]=n[1],u[2]=i,p[0]=n[2],p[1]=n[3],p[2]=i;var o=1/0,a=1/0;return t[0]<u[0]?o=d(t,u,p,0):t[0]>p[0]&&(o=d(t,p,u,0)),t[1]<u[1]?a=d(t,u,p,1):t[1]>p[1]&&(a=d(t,p,u,1)),Math.min(o,a)},t.checkIfTileInfoSupportedForViewSR=function(e,t,n){if(e.spatialReference.isGeographic)return new r("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var i=s.checkUnsupported(e);return i||(function(e,t){var n=e.lods,i=n[0].resolution*Math.pow(2,n[0].level),l=[i*e.size[0],i*e.size[1]],c=[e.origin.x,e.origin.y],u=o.fromExtent(t),p=o.create();s.computeRowColExtent(u,l,c,p);var d=(p[2]-p[0])*(p[3]-p[1]);if(d>a.MAX_ROOT_TILES){var h=n[0].scale*Math.pow(2,n[0].level),f=Math.max((u[3]-u[1])/e.size[1],(u[2]-u[0])/e.size[0])*h/i,v=Math.floor(Math.log(f)/Math.log(10));return f=Math.ceil(f/Math.pow(10,v))*Math.pow(10,v),new r("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(h).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:h,suggestedLevel0Scale:f,requiredNumRootTiles:d,allowedNumRootTiles:a.MAX_ROOT_TILES})}return null}(e,n)||(t&&!e.spatialReference.equals(t)?new r("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(192),r(588)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isInsideExtent=function(){return!0},t.tiltToExtentEdge=function(){return 0},t.checkIfTileInfoSupportedForViewSR=function(e,t){var o=e.lods.length-1;if(e.spatialReference.isWebMercator){if(!i.makeWebMercatorAuxiliarySphere(o).compatibleWith(e))return new r("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n.canProjectToWGS84ComparableLonLat(e.spatialReference))return new r("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!i.makeGCSWithTileSize(e.spatialReference,e.size[0],o).compatibleWith(e))return e.spatialReference.isWGS84?new r("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new r("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}if(t&&!e.spatialReference.equals(t))return new r("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(167),r(1792),r(651)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.stage=e.stage,this.pointsOfInterest=e.pointsOfInterest,this.resourceController=e.resourceController,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=this.resourceController.createStreamDataRequester(3),this.textures=new i.default(this.streamDataRequester,e.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),this.screenSizePerspectiveSettings=o.getSettings(e.viewingMode),this.screenSizePerspectiveSettingsLabels=o.getLabelSettings(e.viewingMode)}return e.prototype.destroy=function(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null},e.prototype.addGraphicsOwner=function(e){var t=this;if(!e)return{remove:function(){}};this.graphicsOwners.push(e);var n="layer"in e?e.watch("layer.screenSizePerspectiveEnabled",(function(){return t.updateScreenSizePerspectiveEnabled()})):null;return this.updateScreenSizePerspectiveEnabled(),{remove:function(){n&&(n.remove(),r.removeUnordered(t.graphicsOwners,e),t.updateScreenSizePerspectiveEnabled())}}},e.prototype.updateScreenSizePerspectiveEnabled=function(){var e=this,t=this.graphicsOwners.some((function(e){return!0===e.get("layer.screenSizePerspectiveEnabled")}));if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new n;var r=function(){return e.updateScreenSizePerspectiveSettings()};this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",r,!0),this.viewState.events.on("camera-projection-changed",r)]),this.updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)},e.prototype.updateScreenSizePerspectiveSettings=function(){var e=this.pointsOfInterest;s.distance=e.centerOnSurfaceInfrequent.distance,s.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(s),this.screenSizePerspectiveSettingsLabels.update(s),this.stage.renderView.setNeedsRender()},e}();t.SharedSymbolResources=a;var s={distance:0,fovY:0};t.default=a}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(153),r(231),r(172),r(358)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t,r,n){void 0===n&&(n=o.schedule),this._streamDataRequester=e,this._stage=t,this._textureOptions=r,this._schedule=n,this._textureRequests=new Map}return e.prototype.destroy=function(){var e=this;this._textureRequests.forEach((function(t){return e.releaseTextureRequest(t)})),this._textureRequests=null},e.prototype.fromUrl=function(e,t,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,c,u,p=this;return r.__generator(this,(function(r){return i.throwIfAborted(o),a=n.isSome(o)&&o.signal,s=this.makeUid(e,t),(l=this._textureRequests.get(s))||(c=i.createAbortController(),u=this._streamDataRequester.request(e,"image",{uid:s,signal:c.signal}),l={referenceCount:0,texture:null,textureAsync:null,abortController:c},this._textureRequests.set(s,l),l.textureAsync=u.then((function(r){var n=p.createTexture(e,r,t);return l.texture=n,l.abortController=null,p.addToStage(n),{uid:s,texture:n}}),(function(e){throw l.abortController=null,e}))),l.referenceCount++,[2,i.create((function(e,t){i.onAbort(a,(function(){t(i.createAbortError())})),l.textureAsync.then(e,t)})).catch((function(e){throw p.release(s),e}))]}))}))},e.prototype.fromData=function(e,t){var r=this.makeUid(e),n=this._textureRequests.get(r);return n||(n={referenceCount:0,texture:t(),textureAsync:null,abortController:null},this.addToStage(n.texture),this._textureRequests.set(r,n)),n.referenceCount++,{uid:r,texture:n.texture}},e.prototype.release=function(e){var t=this;if(this._textureRequests){var r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._schedule((function(){return t.releaseNow(e)}))):console.warn("TextureCollection: texture doesn't exist: '"+e+"'")}},Object.defineProperty(e.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0}),e.prototype.releaseNow=function(e){if(this._textureRequests){var t=this._textureRequests.get(e);!t||t.referenceCount>0||(this.releaseTextureRequest(t),this._textureRequests.delete(e))}},e.prototype.releaseTextureRequest=function(e){e.texture?this.removeFromStage(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)},e.prototype.createTexture=function(e,t,n){if(a.isSVG(e)&&(n||0===t.width&&0===t.height)){var i=t.width?t.height/t.width:1;n=n||64,i>1?(t.width=Math.round(n/i),t.height=n):(t.width=n,t.height=Math.round(n*i))}var o=r.__assign(r.__assign({},this._textureOptions),{width:t.width,height:t.height,powerOfTwoResizeMode:2});return new s(t,"symbol",o)},e.prototype.addToStage=function(e){this._stage.add(4,e)},e.prototype.removeFromStage=function(e){this._stage.remove(4,e.id)},e.prototype.makeUid=function(e,t){return null!=t?e+"."+t+"px":e},e}();t.TextureCollection=l,t.default=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(198),r(151),r(162),r(160),r(498),r(649),r(1794),r(1795),r(1796),r(1276),r(1797),r(1798),r(1799),r(390),r(391),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){function t(t){var r=e.call(this,t)||this;return r.handles=new i,r.surfaceAltitudeAtCenter=0,r.surfaceAltitudeAtCenterDirty=!0,r.surfaceAltitudeAtCenterWithContent=0,r.surfaceAltitudeAtCenterWithContentDirty=!0,r.propertiesPool=new c.PropertiesPool({renderPointOfView:w},r),r.renderPointOfView=l.vec3f64.create(),r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.view,n=t.state,i=t.basemapTerrain,a=t.renderCoordsHelper,s=t.map;this.surfaceIntersector=new g.Intersector(n.mode),n.isGlobal?this.surfaceIntersector.options.backfacesTerrain=!1:this.surfaceIntersector.options.backfacesTerrain=!0,this.surfaceIntersector.options.invisibleTerrain=!1,this.contentIntersector=new g.Intersector(n.mode),this.contentIntersectorOptions={exclude:o.SetFromValues([_.TERRAIN_ID])};var l=function(){return e.estimateSurfaceAltitudeAtCenter()},c={state:n,scheduler:this.view.resourceController.scheduler,surface:i,renderCoordsHelper:a};this._set("centerOnSurfaceInfrequent",new d.default(r.__assign(r.__assign({},c),{task:b.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:l}))),this._set("centerOnSurfaceFrequent",new d.default(r.__assign(r.__assign({},c),{task:b.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:l}))),this._set("centerOnContent",new d.default(r.__assign(r.__assign({},c),{task:b.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:function(){return e.estimateSurfaceAltitudeAtCenterWithContent()}}))),this._set("cameraOnSurface",new p.default(r.__assign(r.__assign({},c),{task:b.Task.POINT_OF_INTEREST_INFREQUENT,map:s}))),this._set("surfaceGeometryUpdates",new y.default(r.__assign(r.__assign({},c),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new h.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:a})),this._set("surfaceOrigin",new m.default({view:this.view})),this._set("focus",new v.default({state:n,surface:i,renderCoordsHelper:a,centerOnSurface:this.centerOnSurfaceFrequent})),this.handles.add([n.watch("camera",(function(t){return e.cameraChanged(t)}),!0),i.watch("extent",(function(){return e.updateCenterPointsOfInterest()})),this.surfaceGeometryUpdates.events.on("request-update",(function(){return e.updateCenterPointsOfInterest()})),this.contentGeometryUpdates.events.on("request-update",(function(){return e.updateCenterOnContent()}))]),this.cameraChanged(this.view.state.camera),this.centerOnContent.update(),this.centerOnSurfaceFrequent.update(),this.centerOnSurfaceInfrequent.update(),this.cameraOnSurface.update()},t.prototype.destroy=function(){f.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")},Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||this.cameraOnSurface&&this.cameraOnSurface.updating||this.focus&&this.focus.updating)},enumerable:!0,configurable:!0}),t.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var e=this.view.state.camera,t=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,P);return this.view.sceneIntersectionHelper.intersectRay(t,this.contentIntersector,S,this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(S):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(t),this.surfaceAltitudeAtCenterWithContent},t.prototype.estimateSurfaceAltitudeAtCenter=function(e){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var t=this.view.state.camera;e||(e=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(t,P));var r=e.origin,n=s.vec3.add(S,e.origin,e.direction);return this.surfaceIntersector.resetWithRay(e),this.surfaceIntersector.intersect(null,null,t),this.view.basemapTerrain.intersect(this.surfaceIntersector,null,r,n),this.surfaceIntersector.results.min.getIntersectionPoint(S)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(S)),this.surfaceAltitudeAtCenter},t.prototype.cameraChanged=function(e){this.updateCenterPointsOfInterest();var t=e.eye;s.vec3.exactEquals(this.renderPointOfView,t)||this._set("renderPointOfView",s.vec3.copy(this.propertiesPool.get("renderPointOfView"),t))},t.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterDirty=!0,this.surfaceAltitudeAtCenterWithContentDirty=!0,this.centerOnSurfaceFrequent.updateRenderLocation(),this.centerOnSurfaceInfrequent.updateRenderLocation(),this.cameraOnSurface.updateRenderLocation(),this.focus.updateRenderLocation(),this.centerOnContent.updateRenderLocation()},t.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0,this.centerOnContent.updateRenderLocation()},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(){e.surfaceGeometryUpdates.update(),e.centerOnSurfaceFrequent.update(),e.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0}),r.__decorate([a.property({readOnly:!0})],t.prototype,"centerOnContent",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"centerOnSurfaceFrequent",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"centerOnSurfaceInfrequent",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"cameraOnSurface",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"focus",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"renderPointOfView",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"surfaceOrigin",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"contentGeometryUpdates",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"surfaceGeometryUpdates",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["surfaceGeometryUpdates.updating","centerOnContent.updating","centerOnSurfaceInfrequent.updating","centerOnSurfaceFrequent.updating","cameraOnSurface.updating","focus.updating"]})],t.prototype,"updating",null),r.__decorate([a.subclass("esri.views.3d.support.PointsOfInterest")],t)}(n);t.PointsOfInterest=x;var w=Array,S=l.vec3f64.create(),P=u.create();t.default=x}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(153),r(157),r(151),r(162),r(160),r(202),r(498),r(959)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=Array,d=function(e){function t(t){var r=e.call(this,t)||this;return r._dirty=!1,r._propertiesPool=new c.default({location:l,renderLocation:p},r),r._estimatedSurfaceAltitude=0,r._pendingElevationQueryController=null,r.renderLocation=s.vec3f64.create(),r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;if(this.handles.add(this.scheduler.registerTask(this.task,(function(){return e._measureSurfaceAltitude()}),(function(){return e._needsUpdate()}))),this._measureSurfaceAltitude(),this.map){var t=function(){return e._setDirty()};this.handles.add([i.on(this.map,"ground.layers","change",t,t,t)])}},t.prototype.destroy=function(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null},Object.defineProperty(t.prototype,"location",{get:function(){var e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0}),t.prototype.updateRenderLocation=function(){this._setDirty(),this._updateRenderLocation()},t.prototype.update=function(){this._measureSurfaceAltitude(),this._updateRenderLocation()},t.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))},t.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&this._dirty},t.prototype._cancelPendingRequest=function(){var e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))},t.prototype._measureSurfaceAltitude=function(){var e=this;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,f,this.state.spatialReference);var t=n.createAbortController();this.map.ground.queryElevation(f,{signal:t.signal}).then((function(t){return e._updateSurfaceAltitude(t.geometry.z)})).catch((function(t){n.isAbortError(t)||e._updateSurfaceAltitude(0)})).catch((function(){})).then((function(){e._pendingElevationQueryController===t&&(e._pendingElevationQueryController=null,e.notifyChange("updating")),t=null})),this._pendingElevationQueryController=t}else this._updateSurfaceAltitude(0)},t.prototype._updateSurfaceAltitude=function(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())},t.prototype._updateRenderLocation=function(){a.vec3.copy(h,this.state.camera.eye),this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,h),a.vec3.exactEquals(this._get("renderLocation"),h)||this._set("renderLocation",a.vec3.copy(this._propertiesPool.get("renderLocation"),h))},r.__decorate([o.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"task",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["renderLocation"]})],t.prototype,"location",null),r.__decorate([o.property({constructOnly:!0})],t.prototype,"map",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"renderLocation",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([o.subclass("esri.views.3d.support.CameraOnSurface")],t)}(u.PointOfInterest);t.CameraOnSurface=d;var h=s.vec3f64.create(),f=new l;t.default=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(151),r(162),r(160),r(202),r(261),r(238),r(498),r(959)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=Array,h=function(e){function t(t){var r=e.call(this,t)||this;return r.propertiesPool=new u.default({location:s,renderLocation:d},r),r.currentSurfaceAltitude=0,r.latestSurfaceAltitude=0,r.distance=0,r.renderLocation=a.vec3f64.create(),r.updating=!1,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._frameWorker=this.scheduler.registerTask(this.task,(function(){return e._measureSurfaceAltitude()}),(function(){return e.updating})),this._measureSurfaceAltitude()},t.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this.propertiesPool.destroy(),this.propertiesPool=null},Object.defineProperty(t.prototype,"location",{get:function(){var e=this.propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e},enumerable:!0,configurable:!0}),t.prototype.updateRenderLocation=function(){this._set("updating",!0),this._updateRenderLocation()},t.prototype.update=function(){this._measureSurfaceAltitude(),this._updateRenderLocation()},Object.defineProperty(t.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0}),t.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this._set("updating",!1)},t.prototype._updateRenderLocation=function(){var e=v,t=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,e),r=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!t&&r&&(t=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,e))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);var n=m;if(t&&this.latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(o.vec3.copy(e,n),this.currentSurfaceAltitude=this.latestSurfaceAltitude),t){var i=o.vec3.distance(this.state.camera.eye,e);i!==this._get("distance")&&this._set("distance",i)}else{var a=this.state.camera;o.vec3.scale(e,a.viewForward,this._get("distance")),o.vec3.add(e,e,a.eye)}o.vec3.exactEquals(this._get("renderLocation"),e)||this._set("renderLocation",o.vec3.copy(this.propertiesPool.get("renderLocation"),e))},t.prototype.calculateSurfaceIntersection=function(e,t){var r=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){var i=c.earthRadius+e,a=o.vec3.squaredLength(r.eye),s=a<i*i,l=o.vec3.distance(r.eye,t);if(s&&l>c.earthRadius/4){var u=i-Math.sqrt(a);return o.vec3.scale(t,r.viewForward,u),o.vec3.add(t,t,r.eye),!0}}else{var p=this.surface.ready&&this.surface.extent;p&&(t[0]=n.clamp(t[0],p[0],p[2]),t[1]=n.clamp(t[1],p[1],p[3]))}return!0},t.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(e,t){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==e)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,t)){var r=this.state.camera.eye,n=o.vec3.distance(r,e),i=o.vec3.distance(r,t),a=Math.abs(i-n);if(l.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;if(a/n>f)return!0}return!1},r.__decorate([i.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([i.property({constructOnly:!0})],t.prototype,"task",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"distance",void 0),r.__decorate([i.property({constructOnly:!0})],t.prototype,"estimateSurfaceAltitudeAtCenter",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["renderLocation"]})],t.prototype,"location",null),r.__decorate([i.property({readOnly:!0})],t.prototype,"renderLocation",void 0),r.__decorate([i.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([i.subclass("esri.views.3d.support.CenterOnSurface")],t)}(p.PointOfInterest);t.CenterOnSurface=h;var f=.05,v=a.vec3f64.create(),m=a.vec3f64.create();t.default=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(190),r(167)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.handles=new n,this.events=new r,this.contentLayerViews=e.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",(function(e){return t.layerViewsChanged(e)}))),this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}return e.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},e.prototype.layerViewsChanged=function(e){var t=this;e.added.forEach((function(e){"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&t.handles.add(e.on("visible-geometry-changed",(function(){return t.contentChanged()})),e.uid)})),e.removed.forEach((function(e){return t.handles.remove(e.uid)}))},e.prototype.contentChanged=function(){this.events.emit("request-update",o)},e}();t.ContentGeometryUpdates=i;var o={};t.default=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(171),r(151),r(162),r(160),r(202),r(203),r(498),r(959)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=Array,h=function(e){function t(t){var r=e.call(this,t)||this;return r.propertiesPool=new u.default({locationOnSurface:l,renderLocationOnSurface:d},r),r.centerOnSurface=null,r}return r.__extends(t,e),t.prototype.destroy=function(){this.propertiesPool.destroy(),this.propertiesPool=null},Object.defineProperty(t.prototype,"locationOnSurface",{get:function(){var e=this.propertiesPool.get("locationOnSurface");return this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,e,this.state.spatialReference),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderLocationOnSurface",{get:function(){var e=this.centerOnSurface.renderLocation,t=this.renderCoordsHelper,r=this.calculateScreenHorizontalEdgeOnSurface(y);a.vec3.subtract(f,e,this.state.camera.eye),a.vec3.normalize(f,f),t.worldUpAtPosition(e,v);var i=Math.abs(Math.acos(a.vec3.dot(v,f))-.5*Math.PI),o=this.propertiesPool.get("renderLocationOnSurface"),s=1-n.clamp(i/(.5*Math.PI),0,1),l=s*s*s;return a.vec3.lerp(o,e,r,l),o},enumerable:!0,configurable:!0}),t.prototype.calculateScreenHorizontalEdgeOnSurface=function(e){var t=this.state.camera,r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),n=this.renderCoordsHelper.getAltitude(t.eye)>=r,o=t.getRenderCenter(i.createRenderScreenPointArray3());o[1]=n?t.padding[2]:t.fullHeight-t.padding[0],t.unprojectPoint(o,m),a.vec3.subtract(m,m,t.eye);var s=a.vec3.normalize(m,m);return this.renderCoordsHelper.intersectManifold(c.ray.wrap(t.eye,s),r,e)||(a.vec3.copy(e,t.eye),this.renderCoordsHelper.setAltitude(r,e)),e},t.prototype.updateRenderLocation=function(){},r.__decorate([o.property({constructOnly:!0})],t.prototype,"centerOnSurface",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],t.prototype,"locationOnSurface",null),r.__decorate([o.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],t.prototype,"renderLocationOnSurface",null),r.__decorate([o.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],t.prototype,"updating",void 0),r.__decorate([o.subclass("esri.views.3d.support.CenterOnSurface")],t)}(p.PointOfInterest);t.Focus=h;var f=s.vec3f64.create(),v=s.vec3f64.create(),m=s.vec3f64.create(),y=s.vec3f64.create();t.default=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(153),r(157),r(151),r(160),r(202),r(173)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(t){var r=e.call(this,t)||this;return r.location=null,r._updateController=null,r._handles=new i,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"renderLocation",{get:function(){if(!this.location)return null;var e=l.vec3f64.create();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],(function(){return e._update()})),a.on(this,"surface.layers","change",(function(){return e._update()}))]),this._update())},t.prototype.destroy=function(){this._handles.destroy()},t.prototype._update=function(){var e=this;if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var t=u.center(this.surfaceView.extent),r=new c({x:t[0],y:t[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=o.createAbortController(),this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal}).then((function(t){e._updateController=null,e._set("location",t.geometry)})).catch((function(e){o.isAbortError(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)}))):this._set("location",r)}else this._set("location",null)},r.__decorate([s.property({constructOnly:!0})],t.prototype,"view",void 0),r.__decorate([s.property({readOnly:!0,aliasOf:"view.map.ground"})],t.prototype,"surface",void 0),r.__decorate([s.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],t.prototype,"surfaceView",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"location",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["location"]})],t.prototype,"renderLocation",null),r.__decorate([s.subclass("esri.views.3d.terrain.StableSurfaceCenter")],t)}(n);t.StableSurfaceCenter=p,t.default=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(190),r(167),r(151),r(160),r(173),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handles=new o,t._tileGeometryUpdateExtent=l.empty(),t._tileGeometryUpdateSpatialReference=null,t.events=new i,t.updating=!1,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.handles.add([this.surface.on("elevation-change",(function(t){return e._tileGeometryChanged(t)})),this.scheduler.registerTask(c.Task.SURFACE_GEOMETRY_UPDATES,(function(){return e.update()}),(function(){return e.updating}))])},t.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",p),l.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))},t.prototype._tileGeometryChanged=function(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,l.expand(this._tileGeometryUpdateExtent,e.tile.extent),this._set("updating",!0)},t.prototype._furthestCenterOnSurface=function(){for(var e=this.centerOnSurfaces[0],t=1;t<this.centerOnSurfaces.length;t++){var r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e},t.prototype._centerIntersectsExtent=function(e,t){var r=this.state.camera.eye,n=f,i=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,d,t),this.renderCoordsHelper.fromRenderCoords(i.renderLocation,h,t),d[0]<h[0]?(n[0]=d[0],n[2]=h[0]):(n[0]=h[0],n[2]=d[0]),d[1]<h[1]?(n[1]=d[1],n[3]=h[1]):(n[1]=h[1],n[3]=d[1]),l.intersects(n,e)},r.__decorate([a.property({constructOnly:!0})],t.prototype,"state",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"centerOnSurfaces",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"renderCoordsHelper",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"surface",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([a.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],t)}(n);t.SurfaceGeometryUpdates=u;var p={},d=s.vec3f64.create(),h=s.vec3f64.create(),f=l.empty();t.default=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(158),r(180),r(226),r(487),r(190),r(167),r(156),r(168),r(230),r(214),r(153),r(157),r(151),r(189),r(185),r(162),r(160),r(201),r(173),r(492),r(1273),r(1277),r(261),r(203),r(192),r(1279),r(1280),r(1281),r(1282),r(1801),r(1802),r(1805),r(1806),r(1807),r(415),r(1808),r(375),r(960),r(454),r(1825),r(211),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D,L,j,V,F,N,k,z,U,B,G,H,q){var W=p.getLogger("esri.views.3d.terrain.TerrainSurface"),J=function(e){function t(t){var r=e.call(this,t)||this;return r._clippingExtent=null,r._dataExtent=null,r._elevationBounds=new E.ElevationBounds,r._rootExtent=S.create(),r._iteratorPool=new h(G.IteratorPreorder),r._postorderIterator=new G.IteratorPostorder,r._visible=!1,r._pendingUpdates=!1,r._asyncWorkItems=0,r._usedMemory=X,r._isFrameProcessing=!1,r._viewChangeUpdateDirty=!1,r._overlayOpacity=1,r._eyePosRenderSR=x.vec3f64.create(),r._eyePosSurfaceSR=x.vec3f64.create(),r._splitLimits=new B.SplitLimits,r._snapLevel=1/0,r._frustum=M.frustum.create(),r._viewProjectionMatrix=_.mat4f64.create(),r._layerViews=[new Array,new Array],r._layerIndexByLayerViewId=[new Map,new Map],r._basemapLayerViewHandles=new Map,r._handles=new u,r._allTiles=new f,r._upsampleInfoPool=new h(H.UpsampleInfo),r._visibleLevels=new f({deallocator:null}),r._getElevationData={spatialReference:null,rootTiles:null},r.maxTextureScale=1.2,r.rootTiles=null,r.backgroundImage=k.DEFAULT_TILE_BACKGROUND,r.backgroundColor=null,r._layerViewsDirty=!1,r}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this._stage=this.view._stage,this._lercDecoder=T.acquireInstance(this.view.resourceController.scheduler),this._tilePool="planar"===this.manifold?new h(j.PlanarPatch):new h(V.SphericalPatch),this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",(function(e){return e.unloadMapData()})),this._set("overlayManager",new L.OverlayManager({terrainSurface:this,view:this.view})),this._handles.add([this.watch("overlayManager.hasHighlights",(function(t){return e._renderer.setNeedsHighlight(t)})),this.watch("overlayManager.rendersOccluded",(function(t){return e._renderer.setRenderOccludedOverlay(t)}))],"overlayManager"),this._renderer=new z({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer}),this._renderer.install(this.view._stage),this._handles.add([m.init(this,"baseOpacity",(function(t){e._handleLayerViewChanges(),e._updateBaseOpacity(t)}),!0),m.init(this,"_background",(function(){e._handleLayerViewChanges(),e._renderer.setTileBackground(e._background)}),!0),this.view.watch("pointsOfInterest",(function(t){return e._renderer.pointsOfInterest=t})),m.whenTrue(C,"TERRAIN_DEBUG_POPUP",(function(){new Promise((function(e,t){r.e(193).then(function(){var t=[r(2164)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(t){var r=new t.TerrainDebugPopupOpener({surface:e});m.whenFalseOnce(C,"TERRAIN_DEBUG_POPUP",(function(){return r.destroy()}))}))}))]);var t={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new F.SurfaceExtentHelperGlobal(t):new F.SurfaceExtentHelperLocal(t),this._handles.add(m.init(this.extentHelper,"stencilEnabledExtents",(function(t){return e._renderer.setStencilEnabledLayerExtents(t)})),"extentHelper");var n=this.view.defaultsFromMap?new l({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(e){return e.layers}}):this.view.map.allLayers,i=new N({layers:n,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",(function(){return e._updateTilingSchemeAndExtent()}),!0),this.tilingSchemeLogic.watch("extent",(function(){return e._updateTilingSchemeAndExtent()}),!0)],"tilingSchemeLogic"),this._updateTilingSchemeAndExtent(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);var o=this.view.resourceController.scheduler;this._handles.add(o.registerTask(q.Task.TERRAIN_SURFACE,(function(t){return e._frame(t)}),(function(){return e.updating}))),this.view.resourceController.memoryController.events.on("quality-changed",(function(){return e._viewChangeUpdate()})),this._handles.add([this.view.on("resize",(function(){return e._viewChangeUpdate()})),this.view.watch("state.camera",(function(){return e._viewChangeUpdate()}),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",(function(){return e._viewChangeUpdate()})),m.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",(function(t){return e._renderer.textureFadingEnabled=t>0})),this.view.watch("lodSnapping",(function(){return e._viewChangeUpdate()})),this.view.watch("clippingArea",(function(){return e._clippingChanged()}))]),this._handles.add(this.view.allLayerViews.on("after-changes",(function(){return e._setLayerViewsDirty()}))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._updateClippingExtent(),this.notifyChange("extent")},t.prototype.destroy=function(){var e=this;this._handles.destroy(),T.releaseInstance(this._lercDecoder),this._lercDecoder=null,this._removeAllTiles(),this._upsampleMapCache.destroy(),this._upsampleMapCache=null,this.tilingSchemeLogic.destroy(),this._set("tilingSchemeLogic",null),this.extentHelper.destroy(),this.extentHelper=null,this._basemapLayerViewHandles.forEach((function(t,r){return e._unregisterTiledLayerView(r)})),this._elevationDataRequester=null,this._mapDataRequester=null,this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null)),this._tilePool.destroy(),this._tilePool=null,R.Pool.prune(0),D.Pool.prune(0),this._renderer.uninstall(this._stage),this._renderer.destroy(),this._renderer=null,this._iteratorPool.destroy(),this._iteratorPool=null,this._set("view",null),this._stage=null,this._upsampleInfoPool.destroy(),this._upsampleInfoPool=null},Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upsampleMapCache",{get:function(){return this._upsampleMapCache},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this.overlayManager.updating||this._layerViewsDirty)||!this.ready||this.suspended)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderOrder",{set:function(e){this._renderer.renderOrder=e,this._set("renderOrder",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skirtScale",{get:function(){return this._renderer.skirtScale},set:function(e){this._renderer.skirtScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=e,e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slicePlaneEnabled",{set:function(e){this._renderer.slicePlane=e,this._set("slicePlaneEnabled",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velvetOverground",{set:function(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)},enumerable:!0,configurable:!0}),t.prototype.isOpaque=function(){return this._renderer.opaque},Object.defineProperty(t.prototype,"suspended",{set:function(e){this._set("suspended",e),this._viewChangeUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodSnapping",{get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?0:1},enumerable:!0,configurable:!0}),t.prototype.intersect=function(e,t,r,n){this._renderer.intersect(e,t,r,n)},t.prototype.getElevation=function(e,t,r,n){var i=this._getElevationData.rootTiles;if(!i||!i.length)return null;if(0===i[0].layerInfo[0].length)return null;var o=Y;if(o[0]=e,o[1]=t,o[2]=r,!A.vectorToVector(o,n,o,this._getElevationData.spatialReference))return W.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var a=0,s=i;a<s.length;a++){var l=s[a];if(l.containsPoint(o)){for(;l&&!l.rendered&&!l.isLeaf;){var c=0;o[0]>.5*(l.extent[0]+l.extent[2])&&(c+=1),o[1]<.5*(l.extent[1]+l.extent[3])&&(c+=2),l=l.children[c]}var u=l.renderData,p=u&&u.geometryState?u.geometryState.samplerData:null;return p?I.ElevationData.sample(o[0],o[1],p):null}}return null},Object.defineProperty(t.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0}),t.prototype.getScale=function(e){if(this.tilingScheme){if(!A.pointToVector(e,Y,this.spatialReference))return W.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;var t=this.rootTiles;if(t)for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.containsPoint(Y)){for(;null!=i.children[0];){var o=0;Y[0]>i.children[0].extent[2]&&(o+=1),Y[1]<i.children[0].extent[1]&&(o+=2),i=i.children[o]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100},t.prototype.queryVisibleScaleRange=function(e,t,r,n){var i=t?this.tilingScheme.levelAtScale(t):0,o=r?this.tilingScheme.levelAtScale(r):1/0,a=this.lodBias;this._renderer.queryVisibleLevelRange(e,i+a,o+a,n)},t.prototype._updateBaseOpacity=function(e){var t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this.allTransparentSurfaceLayers();var r=t!==this._renderer.opaque;this._updateTileTextures(r)},t.prototype._updateTilingSchemeAndExtent=function(){var e=this.tilingSchemeLogic.extent,t=e&&!S.equals(e,this._dataExtent);t&&(this._dataExtent?S.set(this._dataExtent,e):this._dataExtent=S.create(e));var r=this.tilingSchemeLogic.tilingScheme,n=r!==this.tilingScheme;n&&(U.weakAssert(!!r,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",r),this._updateClippingExtent(),r&&(this._updateTiledLayers(),this._renderer.setTileSize(r.pixelSize),this.overlayManager.setSpatialReference(r.spatialReference,"spherical"===this.manifold))),(t||n)&&this._updateRootTiles()},t.prototype._acquireTile=function(e,t,r,n){var i=this._tilePool.acquire();return K[0]=e,K[1]=t,K[2]=r,i.init(K,n,this),i},t.prototype._updateRootTiles=function(){var e=this,t=this._clippingExtent||this._dataExtent,r=this.tilingScheme;if(t&&r){var n=Q,i=r.rootTilesInExtent(t,n,5*k.MAX_ROOT_TILES),o=function(t){var r=e._acquireTile(0,t[1],t[2],null);return 2===r.shouldSplit(e._splitLimits,e._eyePosRenderSR,e.lodSnapping)&&r.setPendingUpdate(2),e._loadTile(r),r};if(this.rootTiles){if(i.length>k.MAX_ROOT_TILES)return void W.warn(k.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);var s=this.rootTiles.map((function(e){return e.lij})),l=a.difference(s,i,Z);if(l.removed.length>0||l.added.length>0){var c=this.rootTiles.filter((function(t){return!(a.findIndex(l.removed,Z.bind(null,t.lij))>-1&&(e._purgeTile(t),1))}));l.added.forEach((function(e){return c.push(o(e))})),this._setRootTiles(c)}}else i.length>k.MAX_ROOT_TILES&&(W.warn(k.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),i=r.rootTilesInExtent(t,n,k.MAX_ROOT_TILES)),this._setRootTiles(i.map((function(e){return o(e)})));S.equals(n,this._rootExtent)||(this._rootExtent=S.create(n),this._hasFixedExtent()||this.notifyChange("extent")),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setOverlayPlacementDirty(),this.notifyChange("ready")}},t.prototype._setRootTiles=function(e){if(this._set("rootTiles",e),this._allTiles.clear(),e){var t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());this._iteratorPool.release(t)}this._getElevationData.rootTiles=e,this._renderer.setRootTiles(this.rootTiles),this._updateTiles(e)},t.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())},t.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))},t.prototype._updateClippingStatus=function(e){e.updateClippingStatus(this._clippingExtent)&&e.resetPendingUpdate(32)&&this._updateTileGeometry(e)},t.prototype._updateTiles=function(e){if(e){var t,r,n=this._iteratorPool.acquire();for(n.reset(e),G.hasVisibleSiblings(e)?(t=this._elevationBounds.min,r=this._elevationBounds.max):(t=1/0,r=-1/0);!n.done;){var i=n.next();if(this._updateClippingStatus(i),i.updateVisibility(),i.setPendingUpdate(16),i.visible){i.updateScreenDepth(this._viewProjectionMatrix),i.renderData&&(t=Math.min(i.elevationBounds[0],t),r=Math.max(i.elevationBounds[1],r));var o=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===o){i.resetPendingUpdate(8),i.isLeaf&&(i.setPendingUpdate(2),n.skipSubtree());continue}i.resetPendingUpdate(2)&&i.updateAgentSuspension(),4===o&&i.updateAgents(0)}if(n.skipSubtree(),!i.isLeaf){i.setPendingUpdate(8),i.resetPendingUpdate(2);var a=this._iteratorPool.acquire();a.resetOne(i);for(var s=a.next();!a.done;s=a.next())this._updateClippingStatus(s),s.updateVisibility(),s.visible&&s.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(a)}}this._iteratorPool.release(n),this.setPendingUpdates(),isFinite(t)&&isFinite(r)&&(this._elevationBounds.min===t&&this._elevationBounds.max===r||(this._elevationBounds.min=t,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}},t.prototype._updateViewDependentParameters=function(){var e=this.view.state.camera,t=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,i=Math.pow(2,-this.lodBias)*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=t,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*i,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*i,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,M.frustum.copy(e.frustum,this._frustum),g.mat4.multiply(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),b.vec3.copy(this._eyePosRenderSR,e.eye),A.vectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)},t.prototype._updateSnapLevel=function(){if(1!==this.lodSnapping){var e=this._findSnapLevel();if(!(Math.abs(this._snapLevel-e)<.1)){var t=this.snapLevel;this._snapLevel=e,t!==this.snapLevel&&this._updateTiles(this.rootTiles)}}},t.prototype._findSnapLevel=function(){if(this._visibleLevels.length<=0)return this._snapLevel;var e=Math.abs(this.view.camera.tilt-90)/90*.4+.3,t=this._visibleLevels,r=Math.round(t.length*e);if(r>=t.length)return this._snapLevel;t.sort((function(e,t){return e-t}));for(var n=0,i=r;i<t.length;++i)n+=t.getItemAt(i);var o=t.getItemAt(Math.round(.95*t.length)-1),a=n/(t.length-r);return d.clamp(a,o-1,this._splitLimits.maxLod)},t.prototype._updateSkirts=function(){var e=this.view.state.camera,t=this.view.state.constraints.collision.enabled?0:1.11*e.near;U.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this.spatialReference,t)},t.prototype._updateRenderData=function(e){e.rendered&&!e.shouldRender&&(function e(t){return!t.isLeaf&&(t.children[0].shouldRender||t.children[1].shouldRender||t.children[2].shouldRender||t.children[3].shouldRender||e(t.children[0])||e(t.children[1])||e(t.children[2])||e(t.children[3]))}(e)?this._loadChildren(e):function(e){return e.isLeaf&&e.parent&&e.parent.shouldRender}(e)&&this._loadParent(e))},t.prototype._updateTileGeometry=function(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._elevationUpdate(e),this._usedMemory=X},t.prototype._elevationUpdate=function(e){ee.spatialReference=this.spatialReference,ee.tile=e,ee.extent=e.extent,this.emit("elevation-change",ee),S.containsPoint(e.extent,this._eyePosSurfaceSR)&&this._updateSkirts()},t.prototype._frame=function(e){var t=this;this._handleLayerViewChanges(),this._isFrameProcessing=!0,this._frameTraversal(e),e.run((function(){return t._processElevation(e)})),e.run((function(){return t._processTextures(e)})),0!==this._asyncWorkItems&&this.setPendingUpdates(),this._isFrameProcessing=!1,this._runViewChangeUpdateIfDirty()},t.prototype._frameTraversal=function(e){var t=this;if(!this.suspended&&this._pendingUpdates){this._resetPendingUpdates();for(var r=this._eyePosRenderSR,n=0,i=!1,o=!1,a=0===this.lodSnapping?function(e){var n=e.shouldSplit(t._splitLimits,r,1);e.visible&&2!==n&&e.parent&&2===e.parent.shouldSplit(t._splitLimits,r,1)&&(1===n?t._visibleLevels.fill(e.level+1,4):t._visibleLevels.push(e.level))}:function(){};!e.done;){this._visibleLevels.clear();var s=!this._allTiles.some((function(r){return n+=r.usedMemory,a(r),r.resetPendingUpdate(8)?(t._mergeTile(r),i=!0,e.madeProgress()):r.resetPendingUpdate(2)&&(t._splitTile(r),i=!0,e.madeProgress()),r.resetPendingUpdate(16)&&(t._updateRenderData(r),e.madeProgress()),o=o||r.updating,e.done}));if(s?this._updateSnapLevel():o=!0,i)o=!0,i=!1,G.sortTiles(this._renderer.renderOrder,this._allTiles);else if(s){this._usedMemory=n;break}}o&&this.setPendingUpdates(),this._visibleLevels.clear()}},t.prototype._processElevation=function(e){var t=this;return this._allTiles.some((function(r){return r.resetPendingUpdate(32)&&(t._updateTileGeometry(r),e.madeProgress()),e.done})),e.hasProgressed},t.prototype._processTextures=function(e){var t=this;return this._allTiles.some((function(r){return r.resetPendingUpdate(64)&&(t._renderer.updateTileTexture(r),t._usedMemory=X,e.madeProgress()),e.done})),e.hasProgressed},t.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var e=S.create(),t=null;return A.extentToBoundingRect(this.view.clippingArea,e,this.spatialReference)&&(t=e),!S.equals(t,this._clippingExtent)&&(this._clippingExtent=t,this._renderer.clippingExtent=t,this.notifyChange("extent"),this.updateTileOverlayParams(),this.overlayManager.setOverlayPlacementDirty(),!0)},t.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()},Object.defineProperty(t.prototype,"lodBias",{get:function(){var e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*k.MAX_MEMORY_LOD_BIAS},enumerable:!0,configurable:!0}),t.prototype._getLodBiasCorrectedScale=function(e){var t=this.tilingScheme.levels,r=d.clamp(e-this.lodBias,0,t.length-1),n=r-Math.floor(r);return t[Math.floor(r)].scale*(1-n)+t[Math.ceil(r)].scale*n},t.prototype._removeAllTiles=function(){var e=this;this.rootTiles&&(this.rootTiles.forEach((function(t){return e._purgeTile(t)})),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1},t.prototype._purgeChildTiles=function(e){if(e.isLeaf)return!1;var t=this._purgeTile(e.children[0]);return t=this._purgeTile(e.children[1])||t,t=this._purgeTile(e.children[2])||t,t=this._purgeTile(e.children[3])||t,e.unsetChildren(),t},t.prototype._purgeTile=function(e){var t=this._purgeChildTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),e.unload(this._renderer),this._tilePool.release(e),t},t.prototype._splitTile=function(e){U.weakAssert(e.isLeaf,"tile that is already split should not be split again!");var t=e.level+1,r=2*e.lij[1],n=2*e.lij[2];return e.setChildren(this._createTile(t,r,n,e),this._createTile(t,r,n+1,e),this._createTile(t,r+1,n,e),this._createTile(t,r+1,n+1,e)),e.setPendingUpdate(16),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this.setPendingUpdates(),this._emitTileScaleChange(e,t),e.children[0].hasPendingUpdate(2)||e.children[1].hasPendingUpdate(2)||e.children[2].hasPendingUpdate(2)||e.children[3].hasPendingUpdate(2)},t.prototype._emitTileScaleChange=function(e,t){void 0===t&&(t=e.level),te.spatialReference=this.spatialReference,te.extent=e.extent,te.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",te)},t.prototype._createTile=function(e,t,r,n){U.weakAssert(!!n,"_createTile sanity check");var i=this._acquireTile(e,t,r,n);return i.updateClippingStatus(this._clippingExtent),i.visible&&(i.updateScreenDepth(this._viewProjectionMatrix),2===i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&i.setPendingUpdate(2)),i},t.prototype._mergeTile=function(e){U.weakAssert(!e.hasPendingUpdate(2),"_mergeTile sanity check"),this._purgeChildTiles(e)&&(U.weakAssert(!e.renderData,"_mergeTile sanity check"),this._loadTile(e)),this.setPendingUpdates(),this._emitTileScaleChange(e)},t.prototype._loadChildren=function(e){U.weakAssert(e.rendered,"parent should be rendered"),e.unload(this._renderer),this._loadTile(e.children[0]),this._loadTile(e.children[1]),this._loadTile(e.children[2]),this._loadTile(e.children[3])},t.prototype._loadParent=function(e){var t=e.parent;this._unloadChildren(t),this._loadTile(t)},t.prototype._unloadChildren=function(e){e.isLeaf||(this._unloadChildren(e.children[0]),e.children[0].unload(this._renderer),this._unloadChildren(e.children[1]),e.children[1].unload(this._renderer),this._unloadChildren(e.children[2]),e.children[2].unload(this._renderer),this._unloadChildren(e.children[3]),e.children[3].unload(this._renderer))},t.prototype._loadTile=function(e){e.load(this._renderer),e.setPendingUpdate(16),this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setTileParameters(e,e.renderData,this._overlayOpacity),this._elevationUpdate(e)},t.prototype._elevationDataArrived=function(e,t,r){var n=new I.ElevationData(e.lij,e.extent,r);e.dataArrived(t,0,n);var i=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(i);!a.done;){var s=a.next();s.findElevationBoundsForLayer(t,o),s.computeElevationBounds()}this._iteratorPool.release(a),this._updateTiles(i)},t.prototype._setLayerViewsDirty=function(){this._layerViewsDirty=!0},t.prototype._handleLayerViewChanges=function(){var e=this;if(this._layerViewsDirty){this._layerViewsDirty=!1;for(var t=!1,r=new Set,n=-1,i=0,o=this.view.allLayerViews.items;i<o.length;i++){var a=o[i];if(r.add(a.uid),U.isSurfaceLayerView(a))if(this._basemapLayerViewHandles.has(a.uid)){var s=this.layerClassFromLayerView(a),l=this._layerIndexByLayerViewId[s].get(a.uid);l<n&&(t=!0),n=l}else this._registerTiledLayerView(a),a.layer.loaded&&(t=!0)}this._basemapLayerViewHandles.forEach((function(n,i){r.has(i)||(e._unregisterTiledLayerView(i),t=!0)})),this.overlayManager&&this.overlayManager.updateLayerViews(r),t&&this._updateTiledLayers(),this._renderer.isTransparent=this.allTransparentSurfaceLayers()}},t.prototype.allTransparentSurfaceLayers=function(){for(var e=0===this.view.map.ground.opacity,t=0,r=this.view.allLayerViews.items;t<r.length;t++){var n=r[t];if(U.isSurfaceLayerView(n)&&!U.isElevationLayerView(n)&&!P.isBaseLayer(n.layer)&&0!==n.fullOpacity)return!1}return e},t.prototype.layerClassFromLayerView=function(e){return U.isElevationLayerView(e)?0:1},t.prototype._registerTiledLayerView=function(e){var t=this,r=[],n=this.layerClassFromLayerView(e);r.push(e.watch("suspended",(function(){return t._updateTiledLayers()}))),r.push(e.watch("fullOpacity",(function(){return t._updateTileTextures(!1)}))),r.push(e.layer.watch("scaleRangeId",(function(){return t._restartAllAgents(n)}))),e.on("data-changed",(function(){var r=t._layerIndexByLayerViewId[n].get(e.uid);null!=r&&t._invalidateLayerData(r,n)})),this._basemapLayerViewHandles.set(e.uid,r)},t.prototype._unregisterTiledLayerView=function(e){var t=this._basemapLayerViewHandles.get(e);if(t){for(var r=0;r<t.length;r++)t[r].remove();this._basemapLayerViewHandles.delete(e)}},t.prototype._updateTiledLayers=function(){var e=this;if(this.tilingScheme&&!this.view.suspended){var t=this.view.allLayerViews,r=[[],[]],n=null,i=S.empty();t.forEach((function(t){var o=t.layer;if(o&&!t.suspended&&U.isSurfaceLayerView(t)){var a=t.fullExtent;if(a)if(e.tilingScheme.compatibleWith(t.tileInfo)){S.expand(i,a);var s=e.layerClassFromLayerView(t);if(1===s){var l=t.displayLevelRange;l.maxLevel!==1/0&&(null===n||l.maxLevel>n)&&(n=l.maxLevel)}r[s].push(t)}else W.warn("Terrain: tiling scheme of layer "+o.id+" is incompatible with other tiled layers, will not be drawn");else W.warn("Terrain: Map or elevation layer does not have fullExtent: "+o.id)}}));for(var o=0;o<2;o++){var a=this._layerViews[o],s=r[o];s.reverse();var l=s.length,c=a.length!==l,u=new Array(l),p=new Array(a.length);this._layerIndexByLayerViewId[o].clear();for(var d=0;d<l;d++){var h=s[d].uid;this._layerIndexByLayerViewId[o].set(h,d);var f=a.indexOf(s[d]);u[d]=f,d!==f&&(c=!0),f>-1&&(p[f]=d)}if(c){var v=this._postorderIterator;for(v.reset(this.rootTiles);!v.done;)v.next().modifyLayers(p,u,o);this._layerViews[o]=s,this._restartAllAgents(o),this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(n)&&this._viewChangeUpdate()}},t.prototype._restartAllAgents=function(e){var t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){var r=t.next();r.restartAgents(e),0===e&&r.computeElevationBounds()}},t.prototype._hasFixedExtent=function(){return!!this._clippingExtent},t.prototype.layerViewByIndex=function(e,t){return this._layerViews[t][e]},t.prototype.numLayers=function(e){return this._layerViews[e].length},t.prototype._updateTileTextures=function(e){var t=this;this._allTiles.forEach((function(r){r.updateAgents(1),e?t.renderer.updateTileTexture(r):r.updateRenderData(1)})),this._renderer.isTransparent=this.allTransparentSurfaceLayers()},t.prototype._invalidateLayerData=function(e,t){this._allTiles.forEach((function(r){return r.removeLayerAgent(e,t)})),this._allTiles.forEach((function(r){return r.invalidateLayerData(e,t)}))},t.prototype.requestRender=function(e){void 0===e&&(e=1),this.renderer.setNeedsRender(e)},t.prototype.setPendingUpdates=function(){this._pendingUpdates||(this._pendingUpdates=!0,this.notifyChange("updating"))},t.prototype._resetPendingUpdates=function(){this._pendingUpdates&&(this._pendingUpdates=!1,this.notifyChange("updating"))},t.prototype.requestTileData=function(e,t,r,i){return n.__awaiter(this,void 0,void 0,(function(){var o,a,l;return n.__generator(this,(function(c){switch(c.label){case 0:return o=this.layerViewByIndex(t,r),!(a=o.layer).tilemapCache||U.isVectorTileLayerView(o)?[3,2]:(++this._asyncWorkItems,[4,s.result(a.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],n.__assign(n.__assign({},i),{timeout:6e3})))]);case 1:if(l=c.sent(),--this._asyncWorkItems,!1===l.ok)throw v.isAbortError(l.error)||this._dataMissing(e,r,o,{notInTilemap:!0}),l.error;c.label=2;case 2:return[2,this._requestTileData(e,r,o,i)]}}))}))},t.prototype._requestTileData=function(e,t,r,n){return 0===t?this._requestElevationTileData(e,r,n):this._requestMapTileData(e,r,n)},t.prototype._requestElevationTileData=function(e,t,r){var n=this;if(U.isElevationLayerView(t)){var i=function(i){if(--n._asyncWorkItems,!v.isAborted(r)){var o=n._layerIndexByLayerViewId[0].get(t.uid);null!=o?(n._usedMemory=X,n.setPendingUpdates(),n._elevationDataArrived(e,o,i)):W.warn("TerrainSurface: received data from unknown layer %d %s",0,e.lij.toString())}},o=function(r){--n._asyncWorkItems,v.isAbortError(r)||n._dataMissing(e,0,t,r)};if(++this._asyncWorkItems,U.useFetchTileForLayer(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:k.ELEVATION_NODATA_VALUE,signal:r.signal}).then((function(e){if(v.isAborted(r))return W.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(v.createAbortError());i(e)}),o);var a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(a,"binary",r).then((function(e){return n._lercDecoder.decode(e,{noDataValue:k.ELEVATION_NODATA_VALUE},r.signal)})).then((function(e){i({values:e.pixelData,width:e.width,height:e.height,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})}),o)}U.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")},t.prototype._requestMapTileData=function(e,t,r){var n=this;if(t instanceof O)return v.reject();++this._asyncWorkItems;var i=function(i){--n._asyncWorkItems,v.isAborted(r)||n._dataArrived(e,1,t,i)},o=function(i){--n._asyncWorkItems,v.isAborted(r)||n._dataMissing(e,1,t,i)};if(U.isVectorTileLayerView(t)){var a=t.schemaHelper.getLevelRowColumn(e.lij);return t.tileHandler.getVectorTile(a[0],a[1],a[2],r).then(i,o)}if(U.isImageryTileLayerView(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(i,o);if(U.useFetchTileForLayer(t.layer)&&U.isTileLayerView(t))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then((function(e){if(v.isAborted(r))return W.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(v.createAbortError());i(e)}),o);var s=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);(function(e){return null!=e.refreshInterval})(t)&&t.refreshTimestamp&&(s+=(s.indexOf("?")>-1?"&":"?")+"_ts="+t.refreshTimestamp);var l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(s,l,r).then(i,o)},t.prototype._dataArrived=function(e,t,r,n){var i=this._layerIndexByLayerViewId[t].get(r.uid);null!=i?e.dataArrived(i,t,n):W.warn("TerrainSurface: received data from unknown layer")},t.prototype._dataMissing=function(e,t,r,n){var i=this._layerIndexByLayerViewId[t].get(r.uid);null!=i?e.dataMissing(i,t,n):W.warn("TerrainSurface: received data from unknown layer")},t.prototype.updateTileOverlayParams=function(){var e=this;this.rootTiles&&(this._allTiles.forEach((function(t){t.renderData&&e.overlayManager&&e.overlayManager.setTileParameters(t,t.renderData,e._overlayOpacity)})),this._renderer.setNeedsRender())},t.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var e=this._eyePosSurfaceSR[2],t=this.overlayManager.updateOpacity(e);isNaN(t)||t===this._overlayOpacity||(this._allTiles.forEach((function(e){return e.renderData&&(e.renderData.overlayOpacity=t)})),this._overlayOpacity=t,this._renderer.setNeedsRender())}},t.prototype.getStats=function(){var e={numNodes:this._allTiles.length,numLeaves:0,numVisible:0,numRendered:0,numRenderedPerLevel:new Array,numLoadedPerLevel:new Array};return this._allTiles.forEach((function(t){t.isLeaf&&e.numLeaves++;var r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))})),e},t.prototype.getUsedMemory=function(){var e=this;return this.tilingScheme?(this._usedMemory===X&&(this._usedMemory=0,this._allTiles.forEach((function(t){return e._usedMemory+=t.usedMemory}))),this._usedMemory):0},t.prototype.getUsedMemoryForLayerView=function(e){var t=0,r=this.layerClassFromLayerView(e),n=this._layerIndexByLayerViewId[r].get(e.uid);return this._allTiles.forEach((function(e){return t+=e.getUsedMemoryForLayer(r,n)})),t},t.prototype.getTile=function(e){var t=e.split("/").map((function(e){return+e}));if(0===t[0])return a.find(this.rootTiles,(function(e){return e.lij[1]===t[1]&&e.lij[2]===t[2]}));var r,n=Math.pow(2,t[0]),i=Math.floor(t[1]/n),o=Math.floor(t[2]/n);if(this.rootTiles.some((function(e){return e.lij[1]===i&&e.lij[2]===o&&(r=e,!0)})),r){for(var s=1<<t[0]-1;r.lij[0]<t[0];){var l=t[1]&s?2:0;if((t[2]&s)>0&&l++,!r.children[l])return null;r=r.children[l],s>>=1}return U.weakAssert(r.lij[0]===t[0]&&r.lij[1]===t[1]&&r.lij[2]===t[2],"not the right tile?"),r}return null},t.prototype.getRenderedTiles=function(){return $.clear(),this._allTiles.forEach((function(e){e.visible&&e.rendered&&$.push(e)})),G.sortTiles(this.renderOrder,$),$.toArray()},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{renderer:this._renderer,lercDecoder:this._lercDecoder,mergeTile:function(t){return e._mergeTile(t)},updateTiles:function(t){return e._updateTiles(t)},getTiles:function(){return e._allTiles.toArray()}}},enumerable:!0,configurable:!0}),n.__decorate([y.property()],t.prototype,"_renderer",void 0),n.__decorate([y.property({constructOnly:!0})],t.prototype,"view",void 0),n.__decorate([y.aliasOf("_renderer.cullBackFaces")],t.prototype,"cullBackFaces",void 0),n.__decorate([y.property({readOnly:!0})],t.prototype,"extent",null),n.__decorate([y.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_layerViewsDirty","overlayManager.updating"]})],t.prototype,"updating",null),n.__decorate([y.property({aliasOf:"view.map.ground.opacity"})],t.prototype,"baseOpacity",void 0),n.__decorate([y.property({readOnly:!0})],t.prototype,"overlayManager",void 0),n.__decorate([y.property({constructOnly:!0})],t.prototype,"manifold",void 0),n.__decorate([y.property()],t.prototype,"maxTextureScale",void 0),n.__decorate([y.property({readOnly:!0})],t.prototype,"ready",null),n.__decorate([y.property({value:1})],t.prototype,"renderOrder",null),n.__decorate([y.property({readOnly:!0})],t.prototype,"rootTiles",void 0),n.__decorate([y.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],t.prototype,"spatialReference",null),n.__decorate([y.property()],t.prototype,"backgroundImage",void 0),n.__decorate([y.property({type:i,aliasOf:"view.map.ground.surfaceColor"})],t.prototype,"backgroundColor",void 0),n.__decorate([y.property({dependsOn:["backgroundColor","backgroundImage"]})],t.prototype,"_background",null),n.__decorate([y.property({value:!1})],t.prototype,"slicePlaneEnabled",null),n.__decorate([y.property({readOnly:!0})],t.prototype,"tilingScheme",void 0),n.__decorate([y.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],t.prototype,"tilingSchemeLocked",void 0),n.__decorate([y.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],t.prototype,"tilingSchemeDone",void 0),n.__decorate([y.property({readOnly:!0})],t.prototype,"tilingSchemeLogic",void 0),n.__decorate([y.property({value:!0})],t.prototype,"velvetOverground",null),n.__decorate([y.aliasOf("_renderer.wireframe")],t.prototype,"wireframe",void 0),n.__decorate([y.property({value:!1})],t.prototype,"suspended",null),n.__decorate([y.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],t.prototype,"lodSnapping",null),n.__decorate([y.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],t.prototype,"textureFadeDuration",void 0),n.__decorate([y.property()],t.prototype,"_layerViewsDirty",void 0),n.__decorate([y.aliasOf("_renderer.renderPatchBorders")],t.prototype,"renderPatchBorders",void 0),n.__decorate([y.aliasOf("_renderer.renderingDisabled")],t.prototype,"renderingDisabled",void 0),n.__decorate([y.subclass("esri.views.3d.terrain.TerrainSurface")],t)}(c.EventedMixin(o));function Z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var X=-1,Y=w.vec4f64.create(),Q=S.create(),K=[0,0,0],$=new f,ee={spatialReference:null,tile:null,extent:null,context:"ground"},te={spatialReference:null,extent:null,scale:0};return J}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(174),r(158),r(167),r(164),r(168),r(168),r(231),r(151),r(205),r(162),r(160),r(245),r(201),r(202),r(173),r(235),r(780),r(922),r(1283),r(261),r(238),r(203),r(251),r(192),r(657),r(390),r(943),r(1284),r(211)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I){Object.defineProperty(t,"__esModule",{value:!0});var R,D=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new o,t._overlaySR=null,t._renderSR=null,t._overlaySREqualsRenderSR=!0,t._drapeSources=new Map,t._drapeTargets=new Set,t._overlays=null,t._drapeSourceTypes=[0,0],t._drapeTargetTypes=[0,0],t._renderedAltitude=0,t._placementDirty=!1,t._drawTexturesDirty=!1,t._drawTexturesAnimateDirty=!1,t._hasUnusedRenderTargets=!1,t._isSpherical=!1,t._longitudeCyclical=null,t._latestOriginId=0,t._maxResolution=a("esri-mobile")?2048:4096,t._animationTimeLast=0,t._forceAnimation=!1,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()||this.renderer.updating},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasHighlights",{get:function(){return this.renderer.hasHighlights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendersOccluded",{get:function(){return this.renderer.rendersOccluded},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._stage=this.view._stage,this.renderer=new C.OverlayRenderer({renderView:this._stage.renderView}),this._stage.renderView.updateLogicClients.add(this.renderer),this._drapeTargetTypes[0]++,this.renderer.onHasHighlightsChanged=function(){e.setDrawTexturesDirty(),e.notifyChange("hasHighlights")},this.renderer.onRendersOccludedChanged=function(){e.setDrawTexturesDirty(),e.notifyChange("rendersOccluded")},this.renderer.onContentChanged=function(){e.setDrawTexturesDirty()},this.groundIntersector=new M.Intersector(this.view.viewingMode),this.groundIntersector.options.backfacesTerrain=!0,this.groundIntersector.options.invisibleTerrain=!0,this.groundIntersector.options.hud=!1,this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],(function(){return e.setOverlayPlacementDirty()})),this.terrainSurface.on("elevation-change",(function(){return e.setOverlayPlacementDirty()})),this.view.on("resize",(function(){return e.setOverlayPlacementDirty()})),c.addFrameTask({preRender:function(t){e.renderer.commitChanges(),e.hasOverlays()&&(e._dispatchRendererUpdate(t),e._drawOverlayTextures()),e._hasUnusedRenderTargets&&e._collectUnusedRenderTargetMemory()}}),this.view.resourceController.scheduler.registerTask(I.Task.OVERLAY_MANAGER,(function(){return e.updateOverlays()}),(function(){return e.needsUpdate()})),this.view._stage.renderView.events.on("force-camera-for-screenshot",(function(t){e.updateOverlays(t),e._drawOverlayTextures()}))])},t.prototype.destroy=function(){var e=this;this._drapeSources.forEach((function(t,r){return e._unregisterDrapeSource(r)})),this._drapeTargets.forEach((function(t,r){return e._unregisterDrapeTarget(r)})),this._drapeTargetTypes[0]--,this._disposeOverlays(),this._stage.renderView.updateLogicClients.remove(this.renderer),this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.hasOverlays=function(){return!!this._overlays},t.prototype.setSpatialReference=function(e,t){this._overlaySR=e,this._longitudeCyclical=null,e?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._isSpherical=t,t&&(this._longitudeCyclical=e.isWebMercator?new T.Cyclical(-20037508.342787,20037508.342787):new T.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical)):this._disposeOverlays(),this.notifyChange("updating")},t.prototype.getGpuMemoryUsage=function(){return this.renderer.getGpuMemoryUsage()},t.prototype.updateLayerViews=function(e){for(var t=this,r=0,n=this.view.allLayerViews.items;r<n.length;r++){var i=n[r];"drapeSourceType"in i&&!this._drapeSources.has(i)&&this._registerDrapeSource(i),"drapeTargetType"in i&&!this._drapeTargets.has(i)&&this._registerDrapeTarget(i)}this._drapeSources.forEach((function(r,n){e.has(n.uid)||t._unregisterDrapeSource(n)})),this._drapeTargets.forEach((function(r){e.has(r.uid)||t._unregisterDrapeTarget(r)})),this.renderer.updateLayerOrder(),this.setDrawTexturesDirty()},t.prototype._registerDrapeSource=function(e){var t=this,r=e.on("draped-data-change",(function(){return t.setOverlayContentDirty()}));this._drapeSourceTypes[e.drapeSourceType]++,this._drapeSources.set(e,[r]),this._overlays&&e.setDrapingExtent&&this._overlays.forEach((function(r,n){return t._updateDrapeSource(e,n,r)})),this.setOverlayContentDirty()},t.prototype._updateDrapeSource=function(e,t,r){e.setDrapingExtent&&e.setDrapingExtent(t,r.extent,this._overlaySR,r.resolution,r.renderLocalOrigin,r.pixelRatio)},t.prototype._unregisterDrapeSource=function(e){if(this._drapeSources.has(e)){var t=this._drapeSources.get(e);t&&t.forEach((function(e){return e.remove()})),this._drapeSourceTypes[e.drapeSourceType]--,this._drapeSources.delete(e),this.setOverlayContentDirty()}},t.prototype._registerDrapeTarget=function(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this._drapeTargetTypes[e.drapeTargetType]++},t.prototype._updateDrapeTarget=function(e){var t=this;this._overlays&&this._overlays.forEach((function(r,n){var i=r.renderTargets,o=t.needsColorWithoutRasterImage()?i.colorWithoutRasterImage:t.hasDrapedFeatures()?i.color:null,a=i.highlight,s=i.water;e.setDrapingTextures(n,r.extent,o&&o.valid?t.renderer.getRenderTargetTexture(o.id):null,a.valid?t.renderer.getRenderTargetTexture(a.id):null,s.valid?t.renderer.getRenderTargetTexture(s.id):null)}))},t.prototype._unregisterDrapeTarget=function(e){this._drapeTargets.delete(e),this._drapeTargetTypes[e.drapeTargetType]--},t.prototype.setOverlayContentDirty=function(){this.setOverlayPlacementDirty(),this.setDrawTexturesDirty()},t.prototype.setOverlayPlacementDirty=function(){this._placementDirty=!0,this.notifyChange("updating")},t.prototype.updateOverlays=function(e){if(void 0===e&&(e=this.view.state.camera),this._overlaySR){var t,r,n,i=(t=e.fullWidth,r=e.fullHeight,n=Math.max(t,r)+256,s.nextHighestPowerOfTwo(n)),o=Math.min(i,this._maxResolution);this._computeOverlayExtents(e,i,z);var a=y.width(z.inner)/y.width(z.outer);this._initOverlays();var l=this._updateOverlay(0,z.inner,o,1),c=this._updateOverlay(1,z.outer,o,a);(l||c)&&(this.terrainSurface.updateTileOverlayParams(),this.setDrawTexturesDirty()),this._placementDirty=!1,this.terrainSurface.updateOverlayOpacity(),this.notifyChange("updating")}},t.prototype._updateOverlay=function(e,t,r,n){var i=this,o=this._overlays[e];if(!function(e,t){for(var r=w.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]),n=0;n<4;n++)if(Math.abs(t[n]-e[n])>r)return!0;return!1}(t,o.extent)&&r===o.resolution&&o.pixelRatio===n)return!1;y.set(o.extent,t),o.resolution=r,o.pixelRatio=n;var a=y.center(o.extent);return o.renderLocalOrigin=A.fromValues(a[0],a[1],0,"OV_"+this._latestOriginId++),this._drapeSources.forEach((function(t,r){return i._updateDrapeSource(r,e,o)})),!0},t.prototype.needsUpdate=function(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||w.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready},t.prototype.updateOpacity=function(e){return this._overlays?this._getAltitudeBasedOpacity(e,this._renderedAltitude):1},t.prototype._getAltitudeBasedOpacity=function(e,t){if(3.5*e<t){var r=(e-t/10)/(t/3.5-t/10);return Math.sqrt(s.clamp(r,0,1))}return 1},t.prototype.setTileParameters=function(e,t,r){if(this._overlays){var n=this._overlays[0],i=this._overlays[1],o=y.intersection(e.extent,e.surface.extent,U);this._rectInsideRect(o,n.extent)?(this._setTileOverlayData(o,n,t.overlays[0]),this._invalidateTileOverlayData(t.overlays[1])):this._rectanglesOverlap(o,n.extent)?(this._setTileOverlayData(o,n,t.overlays[0]),this._setTileOverlayData(o,i,t.overlays[1])):this._rectanglesOverlap(o,i.extent)?(this._setTileOverlayData(o,i,t.overlays[0]),this._invalidateTileOverlayData(t.overlays[1])):(this._invalidateTileOverlayData(t.overlays[0]),this._invalidateTileOverlayData(t.overlays[1]))}else this._invalidateTileOverlayData(t.overlays[0]),this._invalidateTileOverlayData(t.overlays[1]);t.overlayOpacity=void 0!==r?r:1},t.prototype.overlayPixelSizeInMapUnits=function(e){if(!this._overlays)return 0;var t=this._overlays[0],r=this._overlays[1],n=this._pointIsInExtent(e,t.extent)?t:r;return(n.extent[2]-n.extent[0])/n.resolution},t.prototype._setTileOverlayData=function(e,t,r){var n=t.extent;r.texScale[0]=(e[2]-e[0])/(n[2]-n[0]),r.texScale[1]=(e[3]-e[1])/(n[3]-n[1]);var i=e[0];if(this._longitudeCyclical){i=this._longitudeCyclical.minimalMonotonic(n[0],i);var o=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);i>o&&(i=o-(e[2]-e[0]))}r.texOffset[0]=(i-n[0])/(n[2]-n[0]),r.texOffset[1]=(e[1]-n[1])/(n[3]-n[1]);var a=t.renderTargets;r.renderTargetIds.color=a.color.valid?a.color.id:null,r.renderTargetIds.highlight=a.highlight.valid?a.highlight.id:null,r.renderTargetIds.water=a.water.valid?a.water.id:null,r.renderTargetIds.occluded=a.occluded.valid?a.occluded.id:null},t.prototype._invalidateTileOverlayData=function(e){e.renderTargetIds.color=null,e.renderTargetIds.highlight=null,e.renderTargetIds.water=null,e.renderTargetIds.occluded=null},t.prototype._createEmptyOverlay=function(e){return{extent:y.create(),resolution:0,renderTargets:{color:{id:this.renderer.createRenderTarget("overlay"+e,!0),valid:!1,lastUsed:1/0},colorWithoutRasterImage:{id:this.renderer.createRenderTarget("overlayWithoutRasterImage"+e,!0),valid:!1,lastUsed:1/0},highlight:{id:this.renderer.createRenderTarget("overlayHighlight"+e,!1),valid:!1,lastUsed:1/0},water:{id:this.renderer.createRenderTarget("overlayWaterMask"+e,!0),valid:!1,lastUsed:1/0},occluded:{id:this.renderer.createRenderTarget("overlayOccluded"+e,!0),valid:!1,lastUsed:1/0}},renderLocalOrigin:A.fromValues(0,0,0,"O"),pixelRatio:1}},t.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),this._createEmptyOverlay(1)])},t.prototype._disposeOverlays=function(){var e=this;this._overlays&&(this._overlays.forEach((function(t){e.renderer.disposeRenderTarget(t.renderTargets.color.id),e.renderer.disposeRenderTarget(t.renderTargets.colorWithoutRasterImage.id),e.renderer.disposeRenderTarget(t.renderTargets.highlight.id),e.renderer.disposeRenderTarget(t.renderTargets.water.id),e.renderer.disposeRenderTarget(t.renderTargets.occluded.id)})),this._overlays=null)},t.prototype.hotReloadShaders=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return E.removeLoadedShaderModules(),[4,this.renderer.hotReloadShaders()];case 1:return e.sent(),this.updateOverlays(),this.needsUpdate(),[2]}}))}))},t.prototype.stopAnimationsAtTime=function(e){this.renderer.stopAnimationsAtTime(e),this._forceAnimation=!0},t.prototype._dispatchRendererUpdate=function(e){var t=g.Milliseconds(e.time-this._animationTimeLast);t<x.DESIRED_DRAPED_ANIMATION_MS&&!this._forceAnimation||(this._animationTimeLast=e.time,this.renderer.updateLogic({dt:t,camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))},t.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()},t.prototype._intersectGroundFromView=function(e,t,r,n){var i=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,G,t,r),o=i.origin,a=d.vec3.add(k,i.origin,i.direction);return this.groundIntersector.reset(o,a),this.groundIntersector.intersect([],null,e),this.view.basemapTerrain.intersect(this.groundIntersector,null,o,a),this.groundIntersector.results.min.getIntersectionPoint(n)},t.prototype._findHorizonBasedPointOfInterest=function(e,t,r){var n=.5;if("global"===this.view.viewingMode){var i=h.vec3f64.clone(e.eye);d.vec3.normalize(i,i),d.vec3.negate(i,i);var o=d.vec3.length(t),a=Math.asin(o/d.vec3.length(e.eye)),l=Math.acos(d.vec3.dot(e.viewForward,i)),c=a-(l-.5*e.fovY),u=s.clamp(c/e.fovY,0,1),p=-a-(l-.5*e.fovY),m=s.clamp(p/e.fovY,0,1);n=1===u&&0===m?.5:m+.55*(u-m)}else{var y=.5*Math.PI-Math.acos(-e.viewForward[2]),g=Math.tan(y),_=v.vec4f64.fromValues(0,g,1,0),b=f.vec4.transformMat4(_,_,e.projectionMatrix)[1],x=s.clamp(.5+.5*b,0,1);n=1===x||0===x?.5:e.eye[2]>0?.55*x:1-.55*(1-x)}return!!this._intersectGroundFromView(e,.5,n,r)},t.prototype._computeOverlayExtents=function(e,t,r){var i=this.terrainSurface.extent,o=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,a=h.vec3f64.create();this._findHorizonBasedPointOfInterest(e,o,a)||d.vec3.copy(a,o),this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(e.eye);var s=d.vec3.distance(e.eye,a),c=b.viewAngle(this.view.renderCoordsHelper,o,e.eye),u=Math.PI/2-Math.abs(c-Math.PI/2);if(w.OVERLAY_SHOW_CENTER){var v=new _({color:[255,0,0],outline:{color:[255,255,255],width:2}}),g=new m;O.vectorToPoint(a,this._renderSR,g,this._overlaySR);var x=new n({geometry:g,symbol:v});void 0!==R&&this.view.graphics.remove(R),this.view.graphics.add(x),R=x}this._overlaySREqualsRenderSR||O.vectorToVector(a,this._renderSR,a,this._overlaySR);var P=t*e.perRenderPixelRatio*s/2,T=!1,C=1/0;this._isSpherical&&(this._overlaySR.isWebMercator?(P/=Math.cos(O.webMercator.y2lat(a[1])),C=this.terrainSurface.extent[3]):(T=!0,P/=S.metersPerDegree,C=90),P>=C&&(P=C,a[1]=0,this._overlaySR.isWebMercator&&(a[0]=0)));var M=1;T&&P*(M=1/Math.max(.2,Math.cos(Math.abs(l.deg2rad(a[1])))))>180&&(M=180/P);var A=Math.log(2)/12,E=(P=Math.exp(Math.round(Math.log(P)/A)*A))*M,I=.5*t/(32*E),L=.5*t/(32*P);a[0]=Math.round(a[0]*I)/I,a[1]=Math.round(a[1]*L)/L;var j=r.inner;j[0]=a[0]-E,j[1]=a[1]-P,j[2]=a[0]+E,j[3]=a[1]+P,this._isSpherical&&this._shiftExtentToFitBounds(j,1/0,C);var V=r.outer;if(y.set(V,j),6*E>i[2]-i[0])y.set(V,i);else if(u<=.25*Math.PI)V[0]-=E,V[1]-=P,V[2]+=E,V[3]+=P;else{O.vectorToVector(e.eye,this._renderSR,k,this._overlaySR),p.vec2.subtract(N,a,k);var F=-Math.atan2(N[1],N[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);var z=Math.floor(F/(.25*Math.PI));f.vec4.scale(N,D[z],2*P),N[0]*=M,N[2]*=M,f.vec4.add(V,V,N)}if(this._isSpherical&&(V[0]=this._longitudeCyclical.clamp(V[0]),V[2]=this._longitudeCyclical.clamp(V[2]),V[1]=Math.max(V[1],-C),V[3]=Math.min(V[3],C)),!this._isSpherical&&i){var G=y.intersection(j,i,U),H=y.intersection(V,i,B);y.contains(G,H)&&(V[2]=V[0],V[3]=V[1])}},t.prototype._drawOverlayTextures=function(){var e=this;if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var t=this._drawOverlay(0),r=this._drawOverlay(1);0!==t&&0!==r||this.terrainSurface.updateTileOverlayParams(),this._collectUnusedRenderTargetMemory(),this._drapeTargets.forEach((function(t){return e._updateDrapeTarget(t)})),this._drawTexturesDirty?(this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(),this.terrainSurface.setPendingUpdates()):(this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(0))}},t.prototype._setupGeometryViewsCyclical=function(e,t,r){this._setupGeometryViewsDirect(e,t,r);var n=.001*this._longitudeCyclical.range;if(t[0]-n<=this._longitudeCyclical.min){var i=e.views[e.numViews++];f.vec4.set(i.viewport,0,0,r,r),y.offset(t,this._longitudeCyclical.range,0,i.extent)}t[2]+n>=this._longitudeCyclical.max&&(i=e.views[e.numViews++],f.vec4.set(i.viewport,0,0,r,r),y.offset(t,-this._longitudeCyclical.range,0,i.extent))},t.prototype._setupGeometryViewsDirect=function(e,t,r){e.numViews=1;var n=e.views[0];y.set(n.extent,t),f.vec4.set(n.viewport,0,0,r,r)},t.prototype._drawOverlay=function(e){var t=this._overlays[e],r=j(t),n=t.extent,i=t.resolution,o=t.pixelRatio;this._longitudeCyclical?this._setupGeometryViewsCyclical(F,n,i):this._setupGeometryViewsDirect(F,n,i),F.width=i,F.height=i,F.pixelRatio=o*this.view.state.camera.pixelRatio,F.index=e;var a=this.renderer,s=t.renderTargets;return s.color.valid=a.draw(s.color.id,F),s.highlight.valid=a.drawHighlights(s.highlight.id,F),s.water.valid=a.drawNormals(s.water.id,F),s.occluded.valid=a.drawOccluded(s.occluded.id,F),s.colorWithoutRasterImage.valid=this.needsColorWithoutRasterImage()&&a.drawWithoutRasterImage(s.colorWithoutRasterImage.id,F),r^j(t)?0:1},t.prototype.needsColorWithoutRasterImage=function(){return this._drapeSourceTypes[0]>0&&this._drapeSourceTypes[1]>0&&this._drapeTargetTypes[1]>0},t.prototype.hasDrapedFeatures=function(){return this._drapeSourceTypes[1]>0},t.prototype._collectUnusedRenderTargetMemory=function(){var e=performance.now();this._hasUnusedRenderTargets=!1;for(var t=0,r=this._overlays;t<r.length;t++){var n=r[t];for(var i in n.renderTargets){var o=n.renderTargets[i];o.valid?o.lastUsedTimestamp=e:e-o.lastUsedTimestamp>V?(this.renderer.disposeRenderTargetMemory(o.id),o.lastUsedTimestamp=1/0):o.lastUsedTimestamp<1/0&&(this._hasUnusedRenderTargets=!0)}}},t.prototype._rectanglesOverlap=function(e,t){return this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):y.intersects(e,t)},t.prototype._rectInsideRect=function(e,t){return this._longitudeCyclical?this._longitudeCyclical.contains(t[0],t[2],e[0])&&this._longitudeCyclical.contains(t[0],t[2],e[2])&&e[1]>t[1]&&e[3]<t[3]:y.contains(t,e)},t.prototype._pointIsInExtent=function(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];var r=e.x,n=e.y;return r>t[0]&&r<t[2]&&n>t[1]&&n<t[3]},t.prototype._shiftExtentToFitBounds=function(e,t,r){var n=0,i=0;e[0]<-t?n=e[0]+t:e[2]>t&&(n=t-e[2]),e[1]<-r?i=e[1]+r:e[3]>r&&(i=r-e[3]),y.offset(e,n,i)},Object.defineProperty(t.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this.renderer}},enumerable:!0,configurable:!0}),r.__decorate([u.property()],t.prototype,"renderer",void 0),r.__decorate([u.property()],t.prototype,"view",void 0),r.__decorate([u.property()],t.prototype,"terrainSurface",void 0),r.__decorate([u.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],t.prototype,"suspended",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["terrainSurface.ready","suspended","renderer.updating"]})],t.prototype,"updating",null),r.__decorate([u.property({type:Boolean})],t.prototype,"hasHighlights",null),r.__decorate([u.property({type:Boolean})],t.prototype,"rendersOccluded",null),r.__decorate([u.subclass("esri.views.3d.terrain.OverlayManager")],t)}(i);function j(e){var t=e.renderTargets;return+t.color.valid|+t.colorWithoutRasterImage.valid<<1|+t.highlight.valid<<2|+t.water.valid<<3|+t.occluded.valid<<4}t.OverlayManager=L;var V=1e3,F={width:0,height:0,pixelRatio:0,views:[{viewport:y.create(),extent:y.create()},{viewport:y.create(),extent:y.create()},{viewport:y.create(),extent:y.create()}],numViews:0,index:0},N=v.vec4f64.create(),k=h.vec3f64.create(),z={inner:y.create(),outer:y.create()},U=y.create(),B=y.create(),G=P.ray.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(193),r(203),r(817),r(960)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(r,n,i){var o=e.call(this,t.NumSubdivisionsAtLevel)||this;return void 0!==r&&o.init(r,n,i),o}return r.__extends(t,e),t.prototype.init=function(t,r,i){e.prototype.init.call(this,t,r,i),this._edgeLen=this.extent[2]-this.extent[0],this._edgeLen2=this._edgeLen*this._edgeLen,this.centerAtSeaLevel[0]=n.lerp(this.extent[0],this.extent[2],.5),this.centerAtSeaLevel[1]=n.lerp(this.extent[1],this.extent[3],.5),this.centerAtSeaLevel[2]=0,this.updateRadiusAndCenter()},t.prototype.updateRadiusAndCenter=function(){this._updateCenter();var e=(this.extent[2]-this.extent[0])*Math.SQRT1_2,t=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(e*e+t*t)},t.prototype._isVisible=function(){return this.intersectsClippingArea&&o.frustum.intersectsAABB(this.surface.frustum.planes,i.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))},t.prototype.createGeometry=function(e,t){a.createPlanarGlobePatch(e,this.extent,t,this.renderData),this.setMemoryDirty()},t.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2],t}(s.Tile);t.PlanarPatch=l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(214)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map}return e.prototype.acquire=function(t){if(!e.test.disabled){var r=this._pool.get(t);if(r&&0!==r.length)return r.pop()}try{return this._factoryCallback(t)}catch(e){var n=window.performance&&window.performance.memory,i="";throw n&&(i="\n  totalJSHeapSize: "+n.totalJSHeapSize+", usedJSHeapSize: "+n.usedJSHeapSize+", jsHeapSizeLimit: "+n.jsHeapSizeLimit),console.log("Array allocation of size "+t+" failed: "+e+i),e}},e.prototype.release=function(t){if(!e.test.disabled){var n=this._lengthCallback(t),i=this._pool.get(n);i||(i=new r({shrink:!0}),this._pool.set(n,i)),i.push(t)}},e.prototype.clear=function(){this._pool.clear()},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this._pool.size}},enumerable:!0,configurable:!0}),e.test={disabled:!1},e}();t.BufferPool=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(816),r(454)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._pool=t,this.waitingAgents=[],this.data=null,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0,this.elevationBounds=void 0,this.init(e)}return e.prototype.init=function(e){this.waitingAgents.length=0,this.data=null,this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0,0===e&&(this.elevationBounds=null)},e.prototype.invalidateSourceData=function(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()},e.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestPromise=null,this.requestAbort=null)},e.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==r.TILE_AGENT_DONE&&this.loadingAgent.dispose(),this.loadingAgent=null,this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this.disposeData()},e.prototype.disposeData=function(){this.data&&!(this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data instanceof ImageData)&&this.data.release(),this.data=null},Object.defineProperty(e.prototype,"upsampleInfo",{get:function(){return this._upsampleInfo},enumerable:!0,configurable:!0}),e.prototype._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)},e.prototype.setUpsampleInfo=function(e,t){if(e!==t&&null!=t){if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),n.computeUpsampleInfo(e,t,this._upsampleInfo)}else this._unsetUpsampleInfo()},e.makeEmptyLayerInfo=function(t,r,n){return n?(n.init(t),n):new e(t,r)},e}();t.TilePerLayerInfo=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(162),r(160),r(238),r(203),r(192),r(648),r(817),r(960)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t,r,n){var i=e.call(this,h)||this;i.obb=new Array(8),i.isWebMercator=!1;for(var a=0;a<8;a++)i.obb[a]=o.vec3f64.create();return void 0!==t&&i.init(t,r,n),i}return r.__extends(t,e),t.prototype.init=function(t,r,s){e.prototype.init.call(this,t,r,s),this.isWebMercator=s.tilingScheme.spatialReference.isWebMercator;var c=this.extentInRadians[0],u=this.extentInRadians[1],p=this.extentInRadians[2],d=this.extentInRadians[3],h=t[0],f=n.lerp(u,d,.5),v=n.lerp(c,p,.5),m=0===h?0:Math.min(Math.abs(u),Math.abs(d));this._edgeLen=(p-c)*Math.cos(m)*a.earthRadius,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=a.earthRadius-Math.sqrt(a.earthRadius*a.earthRadius-this._edgeLen2/4),l.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,v,f,0);var y=o.vec3f64.fromArray(this.centerAtSeaLevel);i.vec3.normalize(y,y),this.up=y,this._updateOBB(),this.updateRadiusAndCenter()},t.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])i.vec3.set(this._center[0],0,0,0),i.vec3.set(this._center[1],0,0,0),i.vec3.set(this._center[2],0,0,0),this._radius=a.earthRadius+this.elevationBounds[1];else{this._updateCenter();var e=Math.max(i.vec3.squaredDistance(this._center[0],this.obb[0]),i.vec3.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(e)}},t.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var e=this.lij[0],t=this.surface.frustum.planes;if(e<10)return s.frustum.intersectsSphere(t,s.sphere.wrap(this._radius,this._center[0]));for(var r=this.obb,n=0;n<6;n++){var i=t[n];4===n&&(i=c.copy(i,f),f[3]-=this.surface.view.state.camera.near);var o=void 0;for(o=0;o<8&&!c.isPointOutside(i,r[o]);o++);if(8===o)return!1}return!0},t.prototype.computeElevationBounds=function(){e.prototype.computeElevationBounds.call(this),this._updateOBB()},t.prototype.createGeometry=function(e,t){var r=this._isPole(this.lij[1],this.lij[0]);u.createSphericalGlobePatch(e,this.extent,t,this.renderData,this.extentInRadians,this.isWebMercator,r),this.setMemoryDirty()},t.prototype._updateOBB=function(){for(var e=this.extentInRadians,t=this.obb,r=0;r<2;r++){var n=this.elevationBounds[r],o=4*r;l.wgs84ComparableLonLatToECEF(t[o++],e[0],e[1],n),l.wgs84ComparableLonLatToECEF(t[o++],e[0],e[3],n),l.wgs84ComparableLonLatToECEF(t[o++],e[2],e[3],n),l.wgs84ComparableLonLatToECEF(t[o++],e[2],e[1],n)}if(this.isWebMercator){var s=this._isPole(this.lij[1],this.lij[0]);2===s?(i.vec3.set(t[1],0,0,a.earthRadius),i.vec3.set(t[2],0,0,a.earthRadius),i.vec3.set(t[5],0,0,a.earthRadius),i.vec3.set(t[6],0,0,a.earthRadius)):1===s&&(i.vec3.set(t[0],0,0,-a.earthRadius),i.vec3.set(t[3],0,0,-a.earthRadius),i.vec3.set(t[4],0,0,-a.earthRadius),i.vec3.set(t[7],0,0,-a.earthRadius))}},t.prototype._isPole=function(e,t){var r=0;return e===(1<<t)-1&&(r+=1),0===e&&(r+=2),r},t}(p.Tile);t.SphericalPatch=d;var h=[128,64,32,16,16,8,8,4],f=c.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151),r(173),r(197),r(492),r(415),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new i,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([this.layerViews.on("change",(function(){return e.notifyChange("stencilEnabledExtents")}))])},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{set:function(e){this.tilingScheme||this._set("spatialReference",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tilingScheme",{set:function(e){this._set("tilingScheme",e),this._set("spatialReference",e.spatialReference)},enumerable:!0,configurable:!0}),t.prototype._computeStencilEnabledExtents=function(e,t){for(var r=[],n=0,i=e.items;n<i.length;n++){var o=i[n].layer;if("IntegratedMeshLayer"===o.operationalLayerType&&null!=t){var a=v(o.fullExtent,t);null!=a&&r.push(s.fromExtent(a))}}return r},r.__decorate([a.property({readOnly:!0})],t.prototype,"layerViewsExtent",null),r.__decorate([a.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],t.prototype,"tiledLayersExtent",null),r.__decorate([a.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"stencilEnabledExtents",null),r.__decorate([a.property()],t.prototype,"spatialReference",null),r.__decorate([a.property()],t.prototype,"tilingScheme",null),r.__decorate([a.property()],t.prototype,"defaultTiledLayersExtent",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"layers",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"layerViews",void 0),r.__decorate([a.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],t)}(n),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()},t.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()},t.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?u.WEBMERCATOR_WORLD_EXTENT:u.GEOGRAPHIC_WORLD_EXTENT},r.__decorate([a.property({dependsOn:["spatialReference"]})],t.prototype,"layerViewsExtent",void 0),r.__decorate([a.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],t)}(d);t.SurfaceExtentHelperGlobal=h;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add([this.layers.on("change",(function(t){return e._handleLayersChanged(t)})),this.layerViews.on("change",(function(){return e.notifyChange("layerViewsExtent")}))])},t.prototype._handleLayersChanged=function(e){for(var t=this,r=0,n=e.removed;r<n.length;r++){var i=n[r];this._handles.remove(i.uid)}for(var a=0,s=e.added;a<s.length;a++){var l=s[a];this._handles.add(o.init(l,"loaded",(function(){return t.notifyChange("tiledLayersExtent")})),l.uid)}},t.prototype._computeLayerViewsExtent=function(){var e=s.empty(),t=this.spatialReference;this.layerViews.forEach((function(r){if(r.isResolved()){var n=v("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);n&&s.expand(e,n)}}));var r=s.allFinite(e)?e:null,n=this._get("layerViewsExtent");return s.equals(r,n)?n:r},t.prototype._computeTiledLayersExtent=function(){var e=this.tilingScheme;if(!e)return null;var t=this.spatialReference,r=s.empty();this.layers.forEach((function(n){if(n.loaded&&c.isTiledLayer(n)){var i=p.getTiledLayerInfo(n,t,"local"),o=i.tileInfo,a=i.fullExtent;(o&&"imagery-tile"===n.type&&a||o&&e.compatibleWith(o)&&a&&a.spatialReference.equals(t))&&s.expand(r,a)}})),this.defaultTiledLayersExtent&&s.expand(r,this.defaultTiledLayersExtent);var n=s.allFinite(r)?r:null,i=this._get("tiledLayersExtent");return s.equals(n,i)?i:n},r.__decorate([a.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],t)}(d);function v(e,t){return e&&!e.spatialReference.equals(t)&&(e=l.canProject(e.spatialReference,t)?l.project(e,t):null),e}t.SurfaceExtentHelperLocal=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(151),r(492),r(192),r(375),r(588)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r._changeHandles=new i,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._changeHandles.add(this.layers.on("change",(function(){return e._update()}))),this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",(function(){return e._setAdHocTilingScheme()}))),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()},t.prototype.destroy=function(){this._changeHandles.destroy(),this._changeHandles=null},t.prototype._update=function(){var e,t=this;if(this._waitTask=null,!this.tilingSchemeLocked)if(this._set("tilingSchemeDone",!1),this.layers.some((function(r){return!(!a.isTiledLayer(r)||r.isRejected()||r.isFulfilled()&&!function(e,t,r){return!!l.getTiledLayerInfo(e,t,r).tileInfo}(r,t.viewSpatialReference,t.manifold)||(e=r,"vector-tile"===r.type||"imagery-tile"===r.type))})),e)if(e.isResolved()){var r=e,n=l.getTiledLayerInfo(r,this.viewSpatialReference,this.manifold).tileInfo,i=new c(n);this._set("tilingSchemeDone",!0),this._lockTilingScheme(i)}else this._updateWhen(e);else this._set("tilingSchemeDone",!0)},t.prototype._updateWhen=function(e){var t=this,r=e.when().catch((function(e){return e})).then((function(){r===t._waitTask&&t._update()}));this._waitTask=r},t.prototype._lockTilingScheme=function(e){var t=this;if("spherical"===this.manifold){var r=e.levels.length-1;e.spatialReference.isWebMercator?e=c.makeWebMercatorAuxiliarySphere(r):s.canProjectToWGS84ComparableLonLat(e.spatialReference)&&(e=c.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._changeHandles.removeAll(),this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",(function(){return t._updateTiledLayerExtent()})))},t.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent},t.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var e=this.extentHelper.spatialReference;e.isWebMercator?this.tilingScheme=c.WebMercatorAuxiliarySphere:s.canProjectToWGS84ComparableLonLat(e)&&(this.tilingScheme=c.makeGCSWithTileSize(e,256)),this.extent=this.extentHelper.layerViewsExtent}else{var t=this.extentHelper.layerViewsExtent;t&&(this.tilingScheme=c.fromExtent(t,this.extentHelper.spatialReference),this.extent=t)}},r.__decorate([o.property()],t.prototype,"tilingScheme",void 0),r.__decorate([o.property()],t.prototype,"extent",void 0),r.__decorate([o.property({value:!1})],t.prototype,"tilingSchemeLocked",void 0),r.__decorate([o.property({readOnly:!0,value:!1})],t.prototype,"tilingSchemeDone",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"viewSpatialReference",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"layers",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"extentHelper",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"manifold",void 0),r.__decorate([o.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],t)}(n)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(182),r(158),r(177),r(152),r(230),r(214),r(151),r(189),r(185),r(216),r(162),r(160),r(245),r(201),r(193),r(493),r(340),r(657),r(817),r(1809),r(1811),r(454),r(223),r(802),r(416),r(391),r(651),r(1287),r(249),r(1821)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R){var D=d.vec2f64.create(),L=y.create(),j=m.vec4f64.create(),V=m.vec4f64.create(),F=m.vec4f64.create(),N=function(){this.extent=m.vec4f64.create(),this.minLevel=0,this.maxLevel=0,this.callback=null},k=function(e){function t(t){var r=e.call(this,t)||this;return r.type="Terrain",r.isGround=!0,r.tileSize=256,r.rctx=null,r._isTransparent=!1,r.renderDataPool=new s(w.PatchRenderData),r.patchGroups=new l({allocator:function(e){return e||{root:null,origin:null,patches:new l}},deallocator:function(e){return e.root=null,e.origin=null,e.patches.clear(),e}}),r.patchGroupsDirty=!0,r.patchGroupsMap=new Map,r.tileIterator=new P.IteratorPreorder,r.highestVisibleLODTile=null,r.visible=!0,r._opaque=!0,r._skirtScale=1,r._velvetOverground=!0,r.castShadows=!0,r._ssrEnabled=!1,r.emptyTex=null,r.tileRenderer=null,r.tileBackgroundInitialized=!1,r.tileBackgroundUpdating=!1,r.stencilEnabledLayerExtents=[],r.numTrianglesRendered=0,r.numTilesRendered=0,r.numTilesCulled=0,r.numOriginsRendered=0,r.clippingExtent=null,r.needsHighlight=!1,r.renderOccludedFlags=1,r.visibleScaleRangeQueries=new l({initialSize:10}),r.visibleScaleRangeQueriesInvPtr=0,r.visibleScaleRangeQueryQueue=new l({initialSize:30}),r.visibleScaleRangeQueryPool=new s(N),r}return r.__extends(t,e),t.prototype.destroy=function(){x.clearCaches()},t.prototype.install=function(e){e.addRenderPlugin([2,7,9],this)},t.prototype.uninstall=function(e){e.removeRenderPlugin(this)},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingDisabled",{set:function(e){this._set("renderingDisabled",!!e),this.setNeedsRender()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opaque",{get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needsLinearDepth",{get:function(){return this.overlayRenderer.hasWater},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skirtScale",{get:function(){return this._skirtScale},set:function(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderPatchBorders",{get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullBackFaces",{get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderOrder",{set:function(e){this._set("renderOrder",e),this.setNeedsRender()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velvetOverground",{set:function(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intersectionHandlerId",{get:function(){return M.TERRAIN_ID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slicePlane",{get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureFadingEnabled",{set:function(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())},enumerable:!0,configurable:!0}),t.prototype.setDebugScreenSizePerspective=function(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())},t.prototype.setRootTiles=function(e){this.rootTiles=e,this.setNeedsRender()},t.prototype.setNeedsHighlight=function(e){this.needsHighlight=e,this.setNeedsRender()},t.prototype.setRenderOccludedOverlay=function(e){this.renderOccludedFlags=e?b.overlayRenderOccludedFlag:1,this.setNeedsRender()},t.prototype.setStencilEnabledLayerExtents=function(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()},t.prototype.setTileSize=function(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()},t.prototype.loadTile=function(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e)},t.prototype.queryVisibleLevelRange=function(e,t,r,n){var i=this.visibleScaleRangeQueryPool.acquire();v.vec4.copy(i.extent,e),i.minLevel=t||-Number.MAX_VALUE,i.maxLevel=null!=r?r:Number.MAX_VALUE,i.callback=n,this.visibleScaleRangeQueryQueue.push(i),this.setNeedsRender()},t.prototype.updateTileTexture=function(e){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e),this.setNeedsRender(),e.resetPendingUpdate(64))},t.prototype.updateTileGeometry=function(e){for(var t=0,r=e.layerInfo[0];t<r.length;t++)r[t].pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()},t.prototype.unloadTile=function(e){e.renderData&&(this.releaseTileGeometry(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())},t.prototype._getLocalOriginOfTile=function(e){var t=Math.max(0,7*Math.floor((e.lij[0]-3)/7));if("spherical"===this.manifold&&0===t)return f.vec3f64.ZEROS;for(;e.parent&&e.lij[0]>t;)e=e.parent;return e.centerAtSeaLevel},t.prototype.setVisibility=function(e){this.visible=e,this.setNeedsRender()},t.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}},Object.defineProperty(t.prototype,"wireframe",{set:function(e){var t=this;this._get("wireframe")!==e&&(this._set("wireframe",e),this.rootTiles&&(P.traverseTilesPreorder(this.rootTiles,(function(r){r.renderData&&r.renderData.updateGeometry(t.rctx,e)})),this.setNeedsRender()))},enumerable:!0,configurable:!0}),t.prototype.setNeedsRender=function(e){void 0===e&&(e=1),this.patchGroupsDirty=!0,this.initContext.requestRender(e)},t.prototype.setTileBackground=function(e){this.tileBackground=e,this._updateTileBackground()},t.prototype.initializeRenderContext=function(e){this.initContext=e,this.rctx=e.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new R.TerrainTechniqueConfiguration,this.tileRenderer=new S(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=C.createEmptyTexture(this.rctx)},t.prototype.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)},t.prototype.intersect=function(e,t,r,n){if(this.rootTiles&&(!e.options.selectOpaqueTerrainOnly||!e.options.selectionMode||this._opaque)){var i=G,o=H;h.vec3.subtract(i,n,r),h.vec3.set(o,1/i[0],1/i[1],1/i[2]);var s=e.results.min,l=e.results.max,c=e.results.ground,u=0===e.options.store,d=!!e.results.ground.target,f=null,v=this.clippingExtent,m=this.tileIterator;m.reset(this.rootTiles);for(var g=M.getVerticalOffsetTerrain(e.verticalOffset),b=function(){var b=m.next();if(null===b.renderData||d&&w._useStencilForTile(b))return"continue";if(e.options.invisibleTerrain){if(!b.visible&&v&&!b.intersectsExtent(v))return"continue"}else if(!b.visible)return"continue";var S=b.renderData.geometryInfo,T=b.renderData.localOrigin,O=-w._skirtScale*S.skirtLength;if(y.set(L,S.boundingBox),a.isSome(g)&&(g.localOrigin=T,g.applyToAABB(L)),0!==O){var C=b.up;y.expandWithOffset(L,O*C[0],O*C[1],O*C[2])}var A=L;h.vec3.subtract(q,r,T);var E=u&&null!=s.dist?s.dist:1/0;if(!I.intersectAabbInvDirBefore(A,q,o,e.tolerance,E))return"continue";var R=function(e,t,r,n){e.set(void 0,P.tile2str(t),r,n,p.mat4f64.IDENTITY,void 0),e.intersector=J,e.target={type:"external",metadata:{tile:t}}},D=function(o,u){if(o>=0&&(e.options.backfacesTerrain||h.vec3.dot(u,i)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(r,n,o))){if((null==c.dist||o<c.dist)&&R(c,b,o,u),!e.options.storeTerrainResults)return;2===e.options.store&&(a.isNone(f)?(f=new M.IntersectorResult(e.ray),R(f,b,o,u),e.results.all.push(f)):o<f.dist&&R(f,b,o,u)),(null==s.dist||o<s.dist)&&R(s,b,o,u),0!==e.options.store&&(null==l.dist||o>l.dist)&&R(l,b,o,u)}},j=W;h.vec3.subtract(j,n,T);var V=S.indices,F=S.vertexAttributes,N={data:F.getField("position",_.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:F.stride/4},k=S.numWithoutSkirtIndices/3;if(I.intersectTriangles(q,j,0,k,V,N,null,g,D),0!==O){var z="spherical"===w.manifold?function(e){return h.vec3.scale(e,e,O/h.vec3.length(e))}:function(e){return h.vec3.set(e,0,0,O)},U=V.length/3;x.intersectSkirts(q,j,k,U,V,F,z,g,D)}},w=this;!m.done;)b()}},t.prototype.render=function(e){if(9===e.slot){if(0==(e.renderOccludedMask&b.overlayRenderOccludedFlag))return!1}else{var t=this.opaque?2:7;if(e.slot!==t)return!1}E.trace("# BEGIN RENDER TERRAIN");var r=e.pass,n=1===e.scenelightingData.globalFactor,i=this._updatePatchGroups();switch(r){case 0:var o=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==o&&(this.shaderTechniqueConfig.receiveShadows=o);var a=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==a&&(this.shaderTechniqueConfig.overlayMode=a);var s=9===e.slot?"occluded":"colorAndWater";this._renderMaterialPass(e,0,i,s);break;case 3:this.castShadows&&n&&this._renderAuxiliaryPass(e,3,i,"none");break;case 1:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,1,i,"none");break;case 2:this._renderAuxiliaryPass(e,2,i,"none");break;case 4:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,i,"highlight"),e.rctx.clearSafe(256))}return E.trace("# END RENDER TERRAIN"),0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender(),!0},t.prototype._renderMaterialPass=function(e,t,r,n){var i=this,o=e.rctx,a=e.camera;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,"occluded"===n);var s=this.shaderTechnique.program;e.rctx.bindProgram(s),o.bindProgram(s),"colorAndWater"===n&&e.ssrParams&&(e.ssrParams.lastFrameColorTextureID=9,e.ssrParams.linearDepthTextureID=8,O.ScreenSpaceReflections.bindUniforms(s,o,e.ssrParams)),e.shadowMap&&e.shadowMap.bind(s,7),e.ssaoHelper&&e.ssaoHelper.setUniforms(s,6),s.setUniform1i("tex",0),s.setUniform1i("texNext",1),this._bindOverlayUniforms(s),s.setUniformMatrix4fv("viewNormal",a.viewInverseTransposeMatrix),s.setUniformMatrix4fv("proj",a.projectionMatrix),e.scenelightingData.setUniforms(s,!0);var l=a.viewMatrix;h.vec3.set(B,l[12],l[13],l[14]),h.vec3.normalize(B,B),s.setUniform3fv("viewDirection",B),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._prepareScaleRangeQueries(),this.opaque?this._renderPatchGroups(e,s,r,n):e.offscreenRenderingHelper.renderToTargets((function(){return i._renderPatchGroups(e,s,r,n)}),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._processScaleRangeQueries()},t.prototype._renderAuxiliaryPass=function(e,t,r,n){this._setTerrainTechnique(t,"occluded"===n);var i=this.shaderTechnique.program;if(e.rctx.bindProgram(i),4===e.pass){var o=e.offscreenRenderingHelper;e.rctx.bindTexture(o.depthTexture,6),i.setUniform1i("depthTex",6),i.setUniform4f("highlightViewportPixelSz",0,0,1/o.width,1/o.height)}else i.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),1!==e.pass&&3!==e.pass||(D[0]=e.camera.near,D[1]=e.camera.far,i.setUniform2fv("nearFar",D));this._renderPatchGroupsAuxiliary(e,i,r,n)},t.prototype._updateTileBackground=function(){var e=this;if(this.tileRenderer){this.tileBackgroundUpdating=!0;var t=function(){e.tileBackgroundInitialized=!0,e.tileBackgroundUpdating=!1,e.rootTiles&&P.traverseTilesPreorder(e.rootTiles,(function(t){e.tileRenderer.updateTileTexture(t),e.setNeedsRender()})),e.setNeedsRender()};if("string"==typeof this.tileBackground){var r=this.tileBackground;g.requestImage(r).then((function(n){r===e.tileBackground&&e.tileRenderer&&(e.tileRenderer.setBackground(n),t())}))}else{var i=this.tileBackground?n.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(i),t()}}},t.prototype._updatePatchGroups=function(){var e=this,t=this.patchGroups;if(!this.patchGroupsDirty)return t;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(t),0!==this.renderOrder){for(var r=0;r<t.length;r++)P.sortTiles(this.renderOrder,t.data[r].patches);t.sort((function(t,r){return function(e,t,r){return 0===e.patches.length?-r:0===t.patches.length?r:P.compareTiles(e.patches.data[0],t.patches.data[0],r)}(t,r,e.renderOrder)}))}return this.patchGroupsDirty=!1,t},t.prototype._renderCollectOrigins=function(e){var t=this.rootTiles,r="spherical"===this.manifold;e.clear();for(var n=0,i=t;n<i.length;n++){var o=i[n],a=e.pushNew();a.root=o,a.origin=r?f.vec3f64.ZEROS:o.centerAtSeaLevel,a.patches.clear(),this._renderCollectOriginsForRoot(e,a)}e.filterInPlace((function(e){return e.patches.length>0}))},t.prototype._renderCollectOriginsForRoot=function(e,t){var r=this.tileIterator;r.resetOne(t.root);var n=this.patchGroupsMap;for(n.clear(),n.set(t.origin,t);!r.done;){var i,o=r.next(),a=o.renderData;if(!a||o.visible)o.lij[0]%7==0&&((i=e.pushNew()).root=o,i.origin=o.centerAtSeaLevel,n.set(o.centerAtSeaLevel,i),i.patches.clear()),o.rendered?a&&((i=n.get(a.localOrigin))&&i.patches.push(o),(!this.highestVisibleLODTile||o.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=o),r.skipSubtree()):this.numTilesCulled++;else this.numTilesCulled++,r.skipSubtree()}},t.prototype._scaleQueriesForTile=function(e){for(var t=e.extent,r=e.lij[0],n=0;n<this.visibleScaleRangeQueriesInvPtr;){var i=this.visibleScaleRangeQueries.data[n],o=i.extent;r>=i.minLevel&&r<=i.maxLevel&&o[0]<=t[2]&&o[2]>=t[0]&&o[1]<=t[3]&&o[3]>=t[1]?(this.visibleScaleRangeQueries.swapElements(n,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):n++}},t.prototype._useStencilForTile=function(e){for(var t=0,r=this.stencilEnabledLayerExtents;t<r.length;t++){var n=r[t];if(e.intersectsExtent(n))return!0}return!1},t.prototype._renderPatchGroupsAuxiliary=function(e,t,r,n){this.shaderTechnique.bindPipelineState(e.rctx);var i=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.setUniform1f("skirtScale",this._skirtScale),"none"!==n&&this._bindOverlayUniforms(t);for(var o=0;o<r.length;o++){var a=r.data[o];this._bindViewForPatchGroup(t,a,e.camera.eye,e.camera.viewMatrix);for(var s=0;s<a.patches.length;s++)this._renderPatch(e.rctx,t,a.patches.data[s],4,i,n)}e.rctx.bindVAO(null)},t.prototype._renderPatchGroups=function(e,t,r,n){var i=e.rctx,o=e.camera,s=o.viewMatrix;if(this.shaderTechnique.bindPipelineState(i),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var l=A.getSettings("spherical"===this.manifold?"global":"local"),c=this.pointsOfInterest.centerOnSurfaceFrequent.distance;l.update({distance:c,fovY:o.fovY}),I.bindScreenSizePerspective(l,t,"screenSizePerspective")}var u=this.stencilEnabledLayerExtents.length>0,p="occluded"===n;p&&(i.bindTexture(this.emptyTex,0),t.setUniform1f("blend",1),t.setUniform4fv("texOffsetAndScale",m.vec4f64.ZEROS));var d=p?0:this._skirtScale;t.setUniform1f("skirtScale",d);for(var h=this.wireframe?1:4,f=0;f<r.length;f++){var v=r.data[f],y=v.patches;if(0!==y.length){this._bindViewForPatchGroup(t,v,o.eye,s);var g=e.sliceHelper&&e.sliceHelper.plane;T.Slice.bindUniforms(t,this.shaderTechnique.configuration,g,v.origin),e.shadowMap&&e.shadowMap.bindView(t,v.origin),this.numOriginsRendered++;for(var _=0;_<y.length;_++){var b=y.data[_],x=b.renderData.textureReference;if(!a.isNone(x)){if(E.trace("# RENDER TILE "+P.tile2str(b)+", screenDepth:"+b.screenDepth),!p){this._scaleQueriesForTile(b),z(b.renderData.geometryInfo.uvOffsetAndScale,x.offsetAndScale,F),t.setUniform4fv("texOffsetAndScale",F),i.bindTexture(x.texture.texture,0);var w=b.renderData.textureFadeFactor,S=w<1?b.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&a.isSome(S)?(z(b.renderData.geometryInfo.uvOffsetAndScale,S.offsetAndScale,F),t.setUniform1f("textureFadeFactor",w),t.setUniform4fv("nextTexOffsetAndScale",F),i.bindTexture(S.texture.texture,1)):(t.setUniform1f("textureFadeFactor",1),i.bindTexture(this.emptyTex,1)),b.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform1f("opacity",b.renderData.opacity)}var O=this._renderPatch(i,t,b,h,u,n);b.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=O/3}}}}i.bindVAO(null)},t.prototype._renderPatch=function(e,t,r,n,i,o){"none"!==o&&(this._bindOverlayTextures(t,r.renderData.overlays,o),t.setUniform1f("overlayOpacity",r.renderData.overlayOpacity)),i&&(this._useStencilForTile(r)?this.stencilShaderTechnique.bindPipelineState(e):this.shaderTechnique.bindPipelineState(e));var a=0===this._skirtScale?r.renderData.geometryInfo.numWithoutSkirtIndices:r.renderData.vao.indexBuffer.size;return e.bindVAO(r.renderData.vao),t.assertCompatibleVertexAttributeLocations(r.renderData.vao),e.drawElements(n,a,r.renderData.vao.indexBuffer.indexType,0),a},t.prototype._bindViewForPatchGroup=function(e,t,r,n){e.setUniform3fv("origin",t.origin),u.mat4.translate(U,n,t.origin),e.setUniformMatrix4fv("view",U),e.setUniform3f("camPos",r[0]-t.origin[0],r[1]-t.origin[1],r[2]-t.origin[2])},t.prototype._bindOverlayUniforms=function(e){e.setUniform1i("ovInnerColorTex",2),e.setUniform1i("ovOuterColorTex",3),e.setUniform1i("ovInnerWaterTex",4),e.setUniform1i("ovOuterWaterTex",5)},t.prototype._bindOverlayTextures=function(e,t,r){for(var n=0;n<2;n++){var i=2*n,a=t[n],s=void 0,l=void 0;switch(r){case"colorAndWater":s=a.renderTargetIds.color,l=a.renderTargetIds.water;break;case"highlight":s=a.renderTargetIds.highlight;break;case"occluded":s=a.renderTargetIds.occluded;break;case"none":break;default:o.neverReached(r)}if(s){j[i]=a.texOffset[0],j[i+1]=a.texOffset[1],V[i]=a.texScale[0],V[i+1]=a.texScale[1];var c=this.overlayRenderer.getRenderTargetTexture(s);if(this.rctx.bindTexture(c,2+n),l){var u=this.overlayRenderer.getRenderTargetTexture(l);this.rctx.bindTexture(u,4+n)}else this.rctx.bindTexture(this.emptyTex,4+n)}else j[i]=0,j[i+1]=0,V[i]=0,V[i+1]=0,this.rctx.bindTexture(this.emptyTex,2+n),this.rctx.bindTexture(this.emptyTex,4+n)}e.setUniform4fv("overlayTexOffset",j),e.setUniform4fv("overlayTexScale",V)},t.prototype._setTerrainTechnique=function(e,t){if(this.shaderTechniqueConfig.output=e,0===e){var r="spherical"===this.manifold;this.shaderTechniqueConfig.atmosphere=r&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled}this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(R.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique),this.shaderTechniqueConfig.stencilEnabled=!0,this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(R.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)},t.prototype.releaseTileGeometry=function(e){e.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e)},t.prototype._prepareScaleRangeQueries=function(){for(var e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryQueue;e.length<e.data.length&&t.length>0;){var r=t.pop();e.push(r)}this.visibleScaleRangeQueriesInvPtr=e.length},t.prototype._processScaleRangeQueries=function(){for(var e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryPool,r=0;r<e.length;r++){var n=e.data[r];t.release(n),n.callback(r>=this.visibleScaleRangeQueriesInvPtr),n.callback=null}e.clear()},Object.defineProperty(t.prototype,"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0}),r.__decorate([c.property()],t.prototype,"tileBackgroundInitialized",void 0),r.__decorate([c.property()],t.prototype,"tileBackgroundUpdating",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"manifold",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"overlayRenderer",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],t.prototype,"updating",null),r.__decorate([c.property({value:!1})],t.prototype,"renderingDisabled",null),r.__decorate([c.property()],t.prototype,"renderPatchBorders",null),r.__decorate([c.property()],t.prototype,"cullBackFaces",null),r.__decorate([c.property({value:1})],t.prototype,"renderOrder",null),r.__decorate([c.property()],t.prototype,"wireframe",null),r.__decorate([c.subclass("esri.views.3d.terrain.TerrainRenderer")],t)}(i);function z(e,t,r){var n=e[0]*t[2]+t[0],i=e[1]*t[3]+t[1],o=e[2]*t[2],a=e[3]*t[3];v.vec4.set(r,n,i,o,a)}var U=p.mat4f64.create(),B=f.vec3f64.create(),G=f.vec3f64.create(),H=f.vec3f64.create(),q=f.vec3f64.create(),W=f.vec3f64.create(),J="TerrainRenderer";return k}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(168),r(152),r(205),r(216),r(201),r(193),r(371),r(817),r(415),r(1810),r(454),r(228),r(307),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m){Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(){var e=this;this.overlayTexOffset=a.vec2f64.create(),this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:l.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:s.vec4f64.create()},this._textureRef=new d.default((function(){return e.tile.surface.textureFadeDuration}))}return e.prototype.init=function(e){this.tile=e,this.clear();var t=this.geometryInfo;if(t.indices=null,t.vertexAttributes=null,l.empty(t.boundingBox),t.numSurfaceIndices=0,t.numSkirtIndices=0,t.numWithoutSkirtIndices=0,t.numVertsPerRow=0,this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},this.opacity=1,this.overlays)for(var r=0,n=this.overlays;r<n.length;r++){var i=n[r];i.renderTargetIds.color=null,i.renderTargetIds.highlight=null,i.renderTargetIds.water=null,i.renderTargetIds.occluded=null,o.vec2.set(i.texScale,1,1),o.vec2.set(i.texOffset,0,0)}else{this.overlays=[null,null];for(var a=0;a<2;a++)this.overlays[a]={renderTargetIds:{color:null,highlight:null,water:null,occluded:null},texScale:[1,1],texOffset:[0,0]}}this.overlayOpacity=1,this.localOrigin=null},e.prototype.clear=function(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear()},e.prototype.updateGeometry=function(e,t){return!!this._updateGeometryState(t)&&(this._releaseGeometry(),this._createGeometry(e),!0)},e.prototype.releaseGeometry=function(){return!!this._releaseGeometry()&&(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0)},e.prototype.ensureTexture=function(e,t){return i.isSome(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture||(this._texture=t(),this.tile.setMemoryDirty()),this._texture},e.prototype.releaseTexture=function(){i.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())},e.prototype._updateGeometryState=function(e){var t=this._getElevationInfo(),i=this.tile.level,o=i<8?this.tile.numSubdivisionsAtLevel[i]+1:2;if(t.samplerData){var a=this.tile.vlevel-i,s=Math.max(i-t.maxTileLevel,p.ELEVATION_DESIRED_RESOLUTION_LEVEL-a),l=this.tile.maxTesselation;o=n.clamp(1+(l>>s),2,l+1)}var c=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(c=null);var u=this.geometryState,d=!1;return u.numVertsPerRow!==o&&(u.numVertsPerRow=o,d=!0),t.changed&&(u.samplerData=t.samplerData,d=!0),r.equals(u.clippingArea,c)||(u.clippingArea=c,d=!0),u.wireframe!==e&&(u.wireframe=e,d=!0),d},e.prototype._createGeometry=function(e){this.tile.createGeometry(this.geometryState,this.localOrigin);var t=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,n=e.gl;this._vao=new m(e,f.Default3D,{geometry:c.glLayout(t.layout)},{geometry:v.createVertex(e,n.STATIC_DRAW,t.buffer)},v.createIndex(e,n.STATIC_DRAW,r))},e.prototype._releaseGeometry=function(){return!!this._vao&&(this._vao.dispose(),this._vao=null,u.releaseGeometry(this.geometryInfo),!0)},Object.defineProperty(e.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0}),e.prototype.setTextureReference=function(e,t,r,n,i){void 0===i&&(i=0),e!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t,r,n,i)},Object.defineProperty(e.prototype,"textureReference",{get:function(){return this._textureRef.current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextTextureReference",{get:function(){return this._textureRef.next},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFadeFactor",{get:function(){return this._textureRef.fadeFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureIsFading",{get:function(){return this._textureRef.isFading},enumerable:!0,configurable:!0}),e.prototype._getElevationInfo=function(){for(var e=this.geometryState.samplerData,t=this.tile.layerInfo[0],r=t.length,n=new Array(r),i=0,o=0,a=!1,s=0;s<r;s++){var l=t[s];if(l.upsampleInfo){var c=l.upsampleInfo.tile,u=(d=c.layerInfo[0][s].data)&&d.samplerData;e&&e[i]===u||(a=!0),n[i++]=u,o=Math.max(o,c.lij[0])}else if(l.data){var p=this.tile.surface.layerViewByIndex(s,0);if(h.fallsWithinLayer(this.tile,p.layer,!1)){var d=l.data;e&&e[i]===d.samplerData||(a=!0),n[i++]=d.samplerData,o=this.tile.lij[0]}}}return e&&e.length!==i&&(a=!0),i>0?n.length=i:n=null,{changed:a,samplerData:n,maxTileLevel:o}},Object.defineProperty(e.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureDescriptor",{get:function(){return i.isSome(this._texture)?this._texture.descriptor:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"test",{get:function(){return{hasTexture:null!=this._texture}},enumerable:!0,configurable:!0}),e}();t.PatchRenderData=y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(201)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}return e.prototype.clear=function(){this._current=r.destroyMaybe(this._current),this._next=r.destroyMaybe(this._next),this._waiting=r.destroyMaybe(this._waiting),this._delayed=r.destroyMaybe(this._delayed)},Object.defineProperty(e.prototype,"current",{get:function(){if(r.isNone(this._current))return null;if(!this._isFading){var e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}var t=performance.now();if(r.isSome(this._delayed)&&t>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null),r.isSome(this._next)){var n=this._fadeDuration;t-this._fadeStart>=n&&(r.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=t)}return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fadeFactor",{get:function(){if(r.isNone(this._next))return 1;var e=performance.now()-this._fadeStart,t=this._fadeDuration;return e>t?0:1-e/t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFading",{get:function(){return r.isSome(this._next)||r.isSome(this._delayed)},enumerable:!0,configurable:!0}),e.prototype.push=function(e,t,n,i,a){void 0===a&&(a=0),this._delayed=r.destroyMaybe(this._delayed);var s=r.isSome(e)?new o(e,t,n,i):null;this._push(s,a)},e.prototype._push=function(e,t){if(this._isFading||this.clear(),!r.isNone(this._current)){var n=performance.now();return 0!==t?(this._delayed=e,void(this._delayedTime=n+t)):r.isNone(this._next)?(this._next=e,void(this._fadeStart=n)):void(r.isNone(e)||(r.destroyMaybe(this._waiting),this._waiting=e))}this._current=e},Object.defineProperty(e.prototype,"_fadeDuration",{get:function(){return r.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isFading",{get:function(){return this._getFadeDuration()>0},enumerable:!0,configurable:!0}),e}();t.default=i;var o=function(){function e(e,t,r,i){this.texture=e,e.retain(),this.offsetAndScale=n.vec4f64.fromValues(t,r,i,i)}return e.prototype.destroy=function(){this.texture.release()},e}();t.TextureReference=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(152),r(205),r(216),r(492),r(204),r(1812),r(815),r(1813),r(1814),r(375),r(375),r(958),r(1819),r(796),r(416),r(665),r(341)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_){var b=function(){function e(e,t,r){this._rctx=e,this.tileSize=t,this._backgroundTexture=null,this._blackTex=null,this._vectorTileHelper=new l.VectorTileRendererHelper3D,this._rctx.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy),this._vaoQuad=y.createQuadVAO(this._rctx,m.Pos2Tex);var n=new u.BlendLayersTechniqueConfiguration;n.mode=2,this._blendLayersTechnique=r.acquireAndReleaseExisting(u.BlendLayersTechnique,n,this._blendLayersTechnique),n.mode=1,this._applyOpacityTechnique=r.acquireAndReleaseExisting(u.BlendLayersTechnique,n,this._applyOpacityTechnique),this._techniqueRep=r,this._blackTex=new f.TileTexture(y.createColorTexture(this._rctx,[0,0,0,1])),this._fboPool=new v.FBOPool(this._rctx)}return e.prototype.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null),this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null),n.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null),this._blackTex&&(this._blackTex.release(),this._blackTex=null),this._blendLayersTechnique&&(this._blendLayersTechnique.dispose(),this._blendLayersTechnique=null),this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null),this._rasterColorizerTechnique&&(this._rasterColorizerTechnique.dispose(),this._rasterColorizerTechnique=null),this._vectorTileHelper&&(this._vectorTileHelper.dispose(),this._vectorTileHelper=null)},e.prototype.updateTileTexture=function(e){for(var t=e.layerInfo[1],i=0,o=t;i<o.length;i++)o[i].pendingUpdates&=-65;if(e.renderData){for(var s=e.surface,l=s.baseOpacity,c=0,u=0,p=this.tileSize,h=!1,f=s.view.pixelRatio,v=t.length,m=0;m<t.length&&!h;m++){var y=s.layerViewByIndex(m,1),g=y.fullOpacity;if(w[m]=g,a.isBaseLayer(y.layer)&&v>=t.length&&(v=m),0!==g){++u;var _=x(e,m,S);_&&(d.isVectorTileLayerView(y)?p=Math.max(p,this.tileSize*f):1===l&&1===g&&(y.isOpaque||this._dataToTexture(_)&&n.isSome(_.sourceLayerInfo.data)&&_.sourceLayerInfo.data.descriptor.isOpaque)&&(h=!0),++c)}}this._cleanupFBOPool(f,t.length);var b=(p=function(e){var t=r.nextHighestPowerOfTwo(e),n=t*t,i=e*e;if(n===i)return e;var o=t/2;return n-i<i-o*o?t:o}(p))/this.tileSize,P=m-1;if(0===c){var T=0;(e.surface.view.layerViewManager.updating||u>0)&&(T=5e3),this._backgroundTexture&&n.isNone(e.renderData.textureReference)&&(T=0),this._useBackgroundTexture(e,T)}else 1===c&&h?this._useLayerTexture(e,P):this._composeMapLayers(e,P,v,h,w,p,b)}},e.prototype.setBackground=function(e){n.isSome(this._backgroundTexture)&&this._backgroundTexture.release(),e instanceof HTMLImageElement?this._backgroundTexture=this._buildTexture(e):this._backgroundTexture=new f.TileTexture(y.createColorTexture(this._rctx,e))},e.prototype._buildTexture=function(e){if(n.isNone(e))return null;var t,r={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},i=this._rctx;if("number"==typeof e)r.width=r.height=e,t=new f.TileTexture(new s.Texture(i,r));else if(e instanceof c.ImageWithType)r.isOpaque=e.isOpaque,t=new f.TileTexture(new s.Texture(i,r,e.image)),e.release();else try{t=new f.TileTexture(new s.Texture(i,r,e))}catch(e){t=new f.TileTexture(y.createEmptyTexture(i)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}return i.bindTexture(t.texture),t.generateMipmap(),t},e.prototype._drawQuad=function(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(5,0,_.vertexCount(this._vaoQuad,"geometry"))},e.prototype._drawRasterData=function(e,t,r,i,o){if(void 0===o&&(o=1),!n.isNone(t)){var a=this._rctx,s=e.program;a.setPipelineState(e.pipeline),a.bindProgram(s),a.bindTexture(t,0),s.setUniform1i("tex",0),s.setUniform1f("scale",r),s.setUniform2f("offset",i[0],i[1]),s.setUniform1f("opacity",o),this._drawQuad(s)}},e.prototype._drawImageryTileData=function(e,t){void 0===t&&(t=1);var r=e.sourceLayerInfo.data;if(!n.isNone(r)&&r.source){e.tile.surface.layerViewByIndex(e.layerIndex,1).ensureSymbolizerParameters(r);var i=this._getRasterColorizerTechnique(r.symbolizerParameters.type,!!r.symbolizerParameters.colormap),o=this._rctx,a=i.program;if(o.setPipelineState(i.pipeline),o.bindProgram(a),r.bind(o)){r.opacity=t,r.scale=e.scale,r.offset=e.offset;var s=r.getTextures(),l=s.names,c=s.textures;g.setTextures(o,a,l,c);var u=r.getUniforms();i.bindPass(o,u),this._drawQuad(a),o.bindVAO()}}},e.prototype._getRasterColorizerTechnique=function(e,t){var r=["stretch","lut","hillshade"].indexOf(e);return this._rasterColorizerConfig||(this._rasterColorizerConfig=new p.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.colorizerType=r,this._rasterColorizerConfig.applyColormap=t,this._rasterColorizerTechnique=this._techniqueRep.acquireAndReleaseExisting(p.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique},e.prototype._drawVectorData=function(e,t,r,i,o,a,s){var l=t.sourceLayerInfo.data;if(n.isNone(l))return s;var c,u=this._rctx,p=t.tile.surface.layerViewByIndex(t.layerIndex,1);u.setPipelineState(e.pipeline);var d=i<1;return d?(c=this._fboPool.acquire(o),u.bindFramebuffer(c),u.setClearColor(1,1,1,0),u.clearSafe(16640)):s&&u.clearSafe(256),this._vectorTileHelper.render(u,t.sourceLod,l,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/t.scale),t.offset,this.tileSize,r),!d||(u.bindFramebuffer(a),this._drawRasterData(e,c.colorTexture,1,[0,0],i),this._fboPool.release(c),s)},e.prototype._useBackgroundTexture=function(e,t){e.renderData.opacity=e.surface.baseOpacity,e.renderData.setTextureReference(this._backgroundTexture,0,0,1,t)},e.prototype._useLayerTexture=function(e,t){e.renderData.opacity=e.surface.baseOpacity;var r=x(e,t,S);if(this._dataToTexture(r)){var n=r.offset;e.renderData.setTextureReference(r.sourceLayerInfo.data,n[0],n[1],r.scale)}},e.prototype._composeMapLayers=function(e,t,r,i,a,s,l){var c=this,u=e.renderData.ensureTexture(s,(function(){return c._buildTexture(s)}));if(!n.isNone(u)){var p=this._rctx,h=this._fboPool.acquire(s);p.bindFramebuffer(h),p.setViewport(0,0,s,s),p.setClearColor(0,0,0,0),p.setClearDepth(1),p.clearSafe(16640);var f=!1;!i&&n.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,o.vec2f64.ZEROS);for(var v=e.surface.baseOpacity,m=!1,y=t;y>=0;y--){var g=x(e,y,S);g&&(y<r&&v<1&&!m&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,o.vec2f64.ZEROS,v),m=!0),0!==a[y]&&(d.isVectorTileRenderInfo(g)?f=this._drawVectorData(this._blendLayersTechnique,g,l,a[y],s,h,f):d.isImageryTileRenderInfo(g)?this._drawImageryTileData(g,a[y]):this._dataToTexture(g)&&n.isSome(g.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,g.sourceLayerInfo.data.texture,g.scale,g.offset,a[y])))}p.bindTexture(u.texture);var _=u.descriptor;p.gl.copyTexImage2D(p.gl.TEXTURE_2D,0,_.pixelFormat,0,0,_.width,_.height,0),u.generateMipmap(),p.bindFramebuffer(null),this._fboPool.release(h),e.renderData.opacity=m?1:v,e.renderData.setTextureReference(u,0,0,1)}},e.prototype._dataToTexture=function(e){return h.isRasterTileRenderInfo(e)&&this._rasterDataToTexture(e),d.isTextureTileRenderInfo(e)},e.prototype._rasterDataToTexture=function(e){var t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty()},e.prototype._cleanupFBOPool=function(e,t){e===this._lastPixelRatio&&t===this._lastNumLayers||(this._fboPool.clear(),this._lastPixelRatio=e,this._lastNumLayers=t)},e}();function x(e,t,r){r.layerIndex=t;var n=e.layerInfo[1][t];if(n.data)return i.vec2.set(r.offset,0,0),r.tile=e,r.scale=1,r.sourceLod=e.lij,r.sourceLayerInfo=n,r;var o=n.upsampleInfo;if(o){var a=o.tile.layerInfo[1][t];return r.tile=o.tile,i.vec2.copy(r.offset,o.offset),r.scale=o.scale,r.sourceLod=o.tile.lij,r.sourceLayerInfo=a,r}return null}var w=new Array,S={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return b}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(159),r(369),r(914)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.renderParams={context:null,drawPhase:1,state:new i({viewpoint:new n({targetGeometry:new r.Point(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerId:-1,painter:null,glyphMosaic:null,spriteMosaic:null,fadeRecorder:null,driverTestResult:null,profiler:null,renderingOptions:null,timeDelta:-1,timeline:null,hasClipping:!1,blendMode:null}}return e.prototype.dispose=function(){this.renderParams=null},e.prototype.render=function(e,t,r,n,i,o,a,s,l,c){var u=o.adjustLevel(t[0]),p=this.renderParams;p.context=e,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.fadeRecorder=n.fadeRecorder,p.pixelRatio=c,p.displayLevel=u,p.requiredLevel=u,n.setContext(e);var d=o.getScale(t[0]),h=o.getShift(t,a*d),f=h[0],v=h[1],m=.125*a*d/l,y=r.transforms.dvs;y[0]=m,y[4]=-m,y[6]=-1-f-s[0]*a*2,y[7]=1+v+(1-s[1])*a*2-2,p.state.size[0]=l,p.state.size[1]=l,r.stage||r.attachWithContext(e),r.triangleCount=0,n.drawTile(p,r,i)},e}();t.VectorTileRendererHelper3D=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1285),r(253),r(257),r(260),r(228),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build();return new c(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){var e=2===this.configuration.mode?u.simpleBlendingParams(1,771):1===this.configuration.mode?u.simpleBlendingParams(0,770):null;return u.makePipelineState({blending:e,colorWrite:u.defaultColorWriteParams})},t.shader=new o.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1285)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(a.ShaderTechnique);t.BlendLayersTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mode=0,t}return n.__extends(t,e),n.__decorate([s.parameter({count:3})],t.prototype,"mode",void 0),t}(s.ShaderTechniqueConfiguration);t.BlendLayersTechniqueConfiguration=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(1286),r(253),r(257),r(260),r(228),r(242),r(665),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"uniformLocationInfos",{get:function(){return this._uniformLocationInfos||(this._uniformLocationInfos=p.getUniformLocationInfos(this._context,this.program)),this._uniformLocationInfos},enumerable:!0,configurable:!0}),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.colorizerType,applyColormap:n.applyColormap});return this._context=e.rctx,new u(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),c.Default3D)},t.prototype.initializePipeline=function(){var e=2===this.configuration.mode?d.simpleBlendingParams(1,771):1===this.configuration.mode?d.simpleBlendingParams(0,770):null;return d.makePipelineState({blending:e,colorWrite:d.defaultColorWriteParams})},t.prototype.bindPass=function(e,t){p.setUniforms(this.program,this.uniformLocationInfos,t.basic),p.setUniforms(this.program,this.uniformLocationInfos,t.common),i.isSome(t.colormap)&&p.setUniforms(this.program,this.uniformLocationInfos,t.colormap),0===this.configuration.colorizerType&&i.isSome(t.stretch)?p.setUniforms(this.program,this.uniformLocationInfos,t.stretch):2===this.configuration.colorizerType&&i.isSome(t.hillshade)&&p.setUniforms(this.program,this.uniformLocationInfos,t.hillshade)},t.shader=new a.ReloadableShaderModule(o,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1286)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.RasterColorizerTechnique=h;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mode=2,t.colorizerType=0,t.applyColormap=!0,t}return n.__extends(t,e),n.__decorate([l.parameter({count:3})],t.prototype,"mode",void 0),n.__decorate([l.parameter({count:3})],t.prototype,"colorizerType",void 0),n.__decorate([l.parameter()],t.prototype,"applyColormap",void 0),t}(l.ShaderTechniqueConfiguration);t.RasterColorizerTechniqueConfiguration=f}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.BasicGrid=function(e){e.attributes.add("position","vec2"),e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("u_scale","float"),e.vertex.uniforms.add("u_offset","vec2"),e.varyings.add("v_texcoord","vec2"),e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    void main(void) {\n      v_texcoord = uv0 * u_scale + u_offset;\n      gl_Position = vec4(position, 0.0, 1.0);\n    }\n  "],["\n    void main(void) {\n      v_texcoord = uv0 * u_scale + u_offset;\n      gl_Position = vec4(position, 0.0, 1.0);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Colormap=function(e){e.fragment.uniforms.add("u_colormap","sampler2D"),e.fragment.uniforms.add("u_colormapOffset","float"),e.fragment.uniforms.add("u_colormapMaxIndex","float"),e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {\n        result = vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color = texture2D(u_colormap, clrPosition);\n        result = vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "],["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {\n        result = vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color = texture2D(u_colormap, clrPosition);\n        result = vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1818),r(175)],void 0===(i=function(e,t,r,n,i){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Common=function(e){e.include(n.Projection),e.fragment.uniforms.add("u_image","sampler2D"),e.fragment.uniforms.add("u_isFloatTexture","bool"),e.fragment.uniforms.add("u_flipY","bool"),e.fragment.uniforms.add("u_applyTransform","bool"),e.fragment.uniforms.add("u_opacity","float"),e.fragment.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "],["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=function(e){e.fragment.uniforms.add("u_transformGrid","sampler2D"),e.fragment.uniforms.add("u_transformSpacing","vec2"),e.fragment.uniforms.add("u_transformGridSize","vec2"),e.fragment.uniforms.add("u_targetImageSize","vec2"),e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image = floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location = index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s <= pos.t) {\n        vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "],["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image = floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location = index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s <= pos.t) {\n        vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(230),r(392)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.renderingContext=e,this._pools=new Map}return e.prototype.acquire=function(e){return this.getPool(e).acquire()},e.prototype.release=function(e){this.getPool(e.width).release(e)},e.prototype.clear=function(){this._pools.forEach((function(e){e.destroy()})),this._pools.clear()},e.prototype.getPool=function(e){var t=this._pools.get(e);if(!t){var i=n.bind(n,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:e,height:e});t=new r(i),this._pools.set(e,t)}return t},e}();t.FBOPool=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(){var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},t=null,r=null;function n(e){if(null==t)for(var n in t={},r={},e)"number"==typeof e[n]&&(t[e[n]]=n,r[n]=e[n])}function i(){if(null==t)throw"WebGLDebugUtils.init(ctx) not called"}function o(e){i();var r=t[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function a(t,n,i,a){var s;if(void 0!==(s=e[t])&&void 0!==(s=s[n])&&s[i]){if("object"==typeof s[i]&&void 0!==s[i].enumBitwiseOr){for(var l=s[i].enumBitwiseOr,c=0,u=[],p=0;p<l.length;++p){var d=r[l[p]];0!=(a&d)&&(c|=d,u.push(o(d)))}return c===a?u.join(" | "):o(a)}return o(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function s(e,t,r){e.__defineGetter__(r,(function(){return t[r]})),e.__defineSetter__(r,(function(e){t[r]=e}))}function l(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var n=0;n<t;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0);e.deleteBuffer(r);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<i;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:n,mightBeEnum:function(e){return i(),void 0!==t[e]},glEnumToString:o,glFunctionArgToString:a,glFunctionArgsToString:function(e,t){for(var r="",n=t.length,i=0;i<n;++i)r+=(0==i?"":", ")+a(e,n,i,t[i]);return r},makeDebugContext:function e(t,r,i,l){l=l||t,n(t),r=r||function(e,t,r){for(var n="",i=r.length,s=0;s<i;++s)n+=(0==s?"":", ")+a(t,i,s,r[s]);!function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)}("WebGL error "+o(e)+" in "+t+"("+n+")")};var c={};function u(e,t){return function(){i&&i(t,arguments);var n=e[t].apply(e,arguments),o=l.getError();return 0!=o&&(c[o]=!0,r(o,t,arguments)),n}}var p={};for(var d in t)if("function"==typeof t[d])if("getExtension"!=d)p[d]=u(t,d);else{var h=u(t,d);p[d]=function(){var n=h.apply(t,arguments);return e(n,r,i,l)}}else s(p,t,d);return p.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},p},makeLostContextSimulatingCanvas:function(e){var t,r,n=[],i=[],o={},a=1,c=!1,u=[],p=0,d=0,h=!1,f=0,v={};function m(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(r=e.getContext,function(){var n=r.apply(e,arguments);if(n instanceof WebGLRenderingContext){if(n!=t){if(t)throw"got different context";o=w(t=n)}return o}return n});var y=function(e){n.push(m(e))},g=function(e){i.push(m(e))};function _(){++d,c||p==d&&e.loseContext()}function b(e,t){var r=e[t];return function(){if(_(),!c){var t=r.apply(e,arguments);return t}}}function x(e){return{statusMessage:e,preventDefault:function(){h=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":y(n);break;case"webglcontextrestored":g(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!c){for(c=!0,p=0,++a;t.getError(););!function(){for(var e=Object.keys(v),t=0;t<e.length;++t)delete v[e]}(),v[t.CONTEXT_LOST_WEBGL]=!0;var r=x("context lost"),i=n.slice();setTimeout((function(){for(var t=0;t<i.length;++t)i[t](r);f>=0&&setTimeout((function(){e.restoreContext()}),f)}),0)}},e.restoreContext=function(){c&&i.length&&setTimeout((function(){if(!h)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<u.length;++e){var r=u[e];r instanceof WebGLBuffer?t.deleteBuffer(r):r instanceof WebGLFramebuffer?t.deleteFramebuffer(r):r instanceof WebGLProgram?t.deleteProgram(r):r instanceof WebGLRenderbuffer?t.deleteRenderbuffer(r):r instanceof WebGLShader?t.deleteShader(r):r instanceof WebGLTexture&&t.deleteTexture(r)}}(),l(t),c=!1,d=0,h=!1;for(var e=i.slice(),r=x("context restored"),n=0;n<e.length;++n)e[n](r)}),0)},e.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";p=d+e},e.getNumCalls=function(){return d},e.setRestoreTimeout=function(e){f=e},e;function w(e){for(var r in e)"function"==typeof e[r]?o[r]=b(e,r):s(o,e,r);o.getError=function(){if(_(),!c)for(;e=t.getError();)v[e]=!0;for(var e in v)if(v[e])return delete v[e],e;return o.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],i=0;i<n.length;++i)o[d=n[i]]=function(t){return function(){if(_(),c)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=a,u.push(r),r}}(e[d]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(i=0;i<l.length;++i)o[d=l[i]]=function(t){return function(){return _(),c?null:t.apply(e,arguments)}}(o[d]);var p=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(i=0;i<p.length;++i){var d;o[d=p[i]]=function(t){return function(){return _(),!c&&t.apply(e,arguments)}}(o[d])}return o.checkFramebufferStatus=function(t){return function(){return _(),c?o.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(t){return function(){return _(),c?-1:t.apply(e,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(t){return function(){return _(),c?0:t.apply(e,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return c},o}},resetToInitialState:l}}.apply(null,[]))||(e.exports=n)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1288),r(253),r(257),r(260),r(228),r(373),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({overlayMode:n.overlayMode,output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:n.textureFadingEnabled&&!n.renderOccluded,receiveShadows:n.receiveShadows&&!n.renderOccluded,receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:n.atmosphere,tileBorders:n.tileBorders,screenSizePerspective:n.screenSizePerspective,pbrMode:0,ssrEnabled:n.ssrEnabled,highStepCount:!1});return new u(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),l.Default3D)},t.prototype.initializePipeline=function(){var e=this.configuration,t=e.backfaceCullingEnabled&&!e.renderOccluded;return p.makePipelineState({blending:e.renderOccluded?p.simpleBlendingParams(1,771):null,culling:t&&p.backFaceCullingParams,depthTest:!e.renderOccluded&&{func:513},depthWrite:!e.renderOccluded&&p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams,stencilTest:e.stencilEnabled?c.renderWhenBitIsNotSet(1):null})},t.shader=new o.ReloadableShaderModule(i,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1288)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(a.ShaderTechnique);t.TerrainTechnique=d;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.overlayMode=0,t.atmosphere=!1,t.receiveShadows=!1,t.slicePlaneEnabled=!1,t.backfaceCullingEnabled=!1,t.stencilEnabled=!1,t.textureFadingEnabled=!1,t.renderOccluded=!1,t.ssrEnabled=!1,t.tileBorders=!1,t.screenSizePerspective=!1,t}return n.__extends(t,e),n.__decorate([s.parameter({count:7})],t.prototype,"output",void 0),n.__decorate([s.parameter({count:3})],t.prototype,"overlayMode",void 0),n.__decorate([s.parameter()],t.prototype,"atmosphere",void 0),n.__decorate([s.parameter()],t.prototype,"receiveShadows",void 0),n.__decorate([s.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([s.parameter()],t.prototype,"backfaceCullingEnabled",void 0),n.__decorate([s.parameter()],t.prototype,"stencilEnabled",void 0),n.__decorate([s.parameter()],t.prototype,"textureFadingEnabled",void 0),n.__decorate([s.parameter()],t.prototype,"renderOccluded",void 0),n.__decorate([s.parameter()],t.prototype,"ssrEnabled",void 0),n.__decorate([s.parameter()],t.prototype,"tileBorders",void 0),n.__decorate([s.parameter()],t.prototype,"screenSizePerspective",void 0),t}(s.ShaderTechniqueConfiguration);t.TerrainTechniqueConfiguration=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexTangent=function(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),0===t.viewingMode?e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent = normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent = normalize(cross(n, tbnTangent));\n      }\n    "])))):e.vertex.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent = vec3(1.0, 0.0, 0.0);\n        tbnBiTangent = normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent = vec3(1.0, 0.0, 0.0);\n        tbnBiTangent = normalize(cross(n, tbnTangent));\n      }\n    "])))),e.fragment.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "],["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Skirts=function(e){e.vertex.code.add(n.glsl(i||(i=r.__makeTemplateObject(['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength = 0.0;\n\n      if (uv.x >= 2.0) {\n        skirtLength = uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x = vec2(uv.x) - vec2(3.5, 4.5);\n        uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    '],['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength = 0.0;\n\n      if (uv.x >= 2.0) {\n        skirtLength = uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x = vec2(uv.x) - vec2(3.5, 4.5);\n        uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    ']))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainTexture=function(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add("texOffsetAndScale","vec4"),e.fragment.uniforms.add("tex","sampler2D"),t.textureFadingEnabled&&(e.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add("texNext","sampler2D"),e.fragment.uniforms.add("textureFadeFactor","float")),e.vertex.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "],["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "])),t.textureFadingEnabled?n.glsl(i||(i=r.__makeTemplateObject(["nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"],["nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"]))):n.glsl(o||(o=r.__makeTemplateObject([""],[""]))))),e.fragment.code.add(n.glsl(c||(c=r.__makeTemplateObject(["\n  vec4 getTileColor() {\n    ","\n  }\n  "],["\n  vec4 getTileColor() {\n    ","\n  }\n  "])),t.textureFadingEnabled?n.glsl(s||(s=r.__makeTemplateObject(["return textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"],["return textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"]))):n.glsl(l||(l=r.__makeTemplateObject(["return texture2D(tex, vtc);"],["return texture2D(tex, vtc);"])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(216)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.offset=r.vec2f64.create(),this.scale=0,this.tile=null}return e.prototype.init=function(e,t,r,n){this.tile=e,this.offset[0]=t,this.offset[1]=r,this.scale=n},e.prototype.dispose=function(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0},e}();t.UpsampleInfo=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(152),r(151),r(162),r(160),r(536),r(1186),r(797),r(1827),r(1830)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.model=new p.Model,t._viewContent=[],t._mainLightDirection=s.vec3f64.fromValues(0,1,0),t}var n;return r.__extends(t,e),n=t,t.prototype.initialize=function(){this._set("renderView",new d.RenderView(this.container,this,this.options)),this.setLighting({lights:[new u.MainLight(s.vec3f64.fromValues(.7,.7,.7)),new u.AmbientLight(s.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})},t.prototype.destroy=function(){c.pool.prune(0),this.dispose()},Object.defineProperty(t.prototype,"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lighting",{get:function(){return this._lighting},enumerable:!0,configurable:!0}),t.prototype.setLighting=function(e){a.vec3.set(this._mainLightDirection,0,0,0);for(var t=0,r=e.lights;t<r.length;t++){var n=r[t];if(n instanceof u.MainLight){a.vec3.negate(this._mainLightDirection,n.direction);break}}this._lighting=e,this.renderView.setNeedsRender()},t.prototype.stopAnimationsAtTime=function(e){this.getAll(3).forEach((function(t){i.applySome(t.animation,(function(t){return t.stopAtTime(e)}))})),this.renderView.setNeedsRender()},t.prototype.add=function(e,t){this.model.add(e,t),f(t)&&t.addParentStage(this),this.renderView.setNeedsRender()},t.prototype.remove=function(e,t){this.renderView.setNeedsRender();var r=this.model.remove(e,t);return f(r)&&r.removeParentStage(this),r},t.prototype.notifyDirty=function(e,t,r){this.model.notifyDirty(e,t,r),this.renderView.setNeedsRender()},t.prototype.processDirty=function(){var e=this.model.getDirtySet();if(e.hasDirtyGeometryRecords()){n.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var t=e.commitLayers(this._viewContent);t[0].length+t[1].length+t[2].length>0&&this.renderView.modify(t[0],t[1],t[2]),n.DebugSettings.logDirtySet&&(console.log("RGs add: "+t[0].map((function(e){return e.uniqueName}))),console.log("RGs remove: "+t[1].map((function(e){return e.uniqueName})))),e.commit(),this.renderView.setNeedsRender()}},t.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet().commitLayers([e]);t[0].length+t[1].length+t[2].length>0&&this.renderView.modify(t[0],t[1],t[2]),this.renderView.setNeedsRender()},t.prototype.getContent=function(e,t){return this.model.get(e,t)},t.prototype.getAll=function(e){return this.model.getAll(e)},t.prototype.getCount=function(e){return this.model.getAll(e).size},t.prototype.getCamera=function(){return this.renderView.getCamera()},t.prototype.setCamera=function(e){this.renderView.setCamera(e)},t.prototype.getLayers=function(){return this.model.getAll(0)},t.prototype.getViewContent=function(){return this._viewContent.slice(0)},t.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var n=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.renderView.modify(n,[],[]),this._viewContent.push.apply(this._viewContent,t)}},t.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,n=[],i=0;i<e.length;i++){var o=r.indexOf(e[i]);o>-1&&(r[o]=r[r.length-1],r.pop(),n.push(e[i]))}var a=t.getResidentRenderGeometriesFilteredByLayers(n);this.renderView.modify([],a,[])},t.prototype.addRenderPlugin=function(e,t){"intersect"in t&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.renderView.renderPlugins.add(e,t)},t.prototype.removeRenderPlugin=function(e){"intersect"in e&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)},t.prototype.getCombinedStats=function(){return{renderView:this.renderView.getCombinedStats(),model:this.model.getStats()}},t.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},r.__decorate([o.property({constructOnly:!0})],t.prototype,"options",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"sceneIntersectionHelper",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"viewingMode",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"container",void 0),r.__decorate([l.autoDispose(),o.property()],t.prototype,"renderView",void 0),n=r.__decorate([o.subclass("esri.views.3d.webgl-engine.Stage")],t)}(l.AutoDisposableMixin(n));function f(e){return"function"==typeof e.addParentStage&&"function"==typeof e.removeParentStage}t.Stage=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(251),r(943),r(1828),r(1829),r(451),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=s.assert,c=s.logWithBase,u=function(){function e(){var e=this;this.dirtySet=new o(this),this._id2origin={},this._content=new Map,i.allModelContentTypes.forEach((function(t){return e._content.set(t,new Map)}))}return e.prototype.getAll=function(e){var t=this._content.get(e);return l(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e).get(t)},e.prototype.add=function(e,t){var r=this._content.get(e);l(void 0!==r);var n=t.id;l(!r.has(n),"Model/Stage already contains object to be added"),r.set(n,t),0===e&&this.notifyDirty(t,"layerAdded")},e.prototype.remove=function(e,t){var r=this._content.get(e);l(void 0!==r);var n=r.get(t);return l(void 0!==n,"Model/Stage doesn't contain object to be removed"),r.delete(t),4===e&&n.unload(),0===e&&this.notifyDirty(n,"layerRemoved"),n},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r){this.dirtySet.handleUpdate(e,t,r)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var i=0,o=t*r/1e4;o>1&&(i=Math.ceil(c(o,2)));var a=1e4*Math.pow(2,i),s=Math.round(e[0]/a),l=Math.round(e[1]/a),u=Math.round(e[2]/a),p=i+"_"+s+"_"+l+"_"+u,d=this._id2origin[p];return null==d&&(d=n.fromValues(s*a,l*a,u*a,p),this._id2origin[p]=d),d},e.prototype.getGeometryRenderGeometries=function(e,t,n){var i=t.geometry,o=e.getCombinedStaticTransformation(t),s=r.maxScale(o),l=t.origin,c=new a(i.data,i.boundingInfo,t.material,o,t.shaderTransformation,s,e.castShadow);c.uniqueName=t.id,c.origin=l||this.getOrigin(c.center,c.bsRadius),c.instanceParameters=t.instanceParameters,n.push(c)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){var n=e.getCombinedStaticTransformation(t,r.transformation);r.updateTransformation(n);var i=this.getOrigin(r.center,r.bsRadius);return r.origin!==i},e.prototype.getStats=function(){var e=this;return{contentTypes:i.allModelContentTypes.reduce((function(t,r){return t[r]=e.getAll(r).size,t}),{}),dirtySet:this.dirtySet.formatDebugInfo()}},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var n=t[r];l(null!=this.get(2,n.geometry.id)),l(null!=this.get(3,n.material.id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var n=this.get(1,t[r].id);l(null!=n)}},e}();t.Model=u}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.allModelContentTypes=[0,1,2,3,4],t.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(210),r(195)],void 0===(i=function(e,t,r,n,i){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach((function(t){e+=t.size})),e},enumerable:!0,configurable:!0}),e.prototype.hasDirtyGeometryRecords=function(){return n.someMap(this._dirtyGeomRecords,(function(e){return n.someMap(e,(function(e){return e&&e.size>0}))}))},e.prototype.handleUpdate=function(e,t,r){return i.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach((function(e,r){var n=t._model.get(1,r);n&&n.hasVolativeTransformation()&&e.forEach((function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()}))}))},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],n=[],o=[],a=function(a){var l=e[a],c=s._dirtyGeomRecords.get(l);if(!c)return"continue";c.forEach((function(e,a){var s=t._ensureGeomRecord(l,a);e.forEach((function(e,l){var c,u=e[0],p=e[1],d=e[2],h=!1;if(2&p)if(c=s.get(l)){var f=c[1];if(4&d)for(var v=t._model.get(1,a),m=0,y=f;m<y.length;m++){var g=y[m];if(t._model.updateRenderGeometryTransformation(v,u,g)){h=!0;break}}if(!h)for(var _=0,b=f;_<b.length;_++)g=b[_],o.push({renderGeometry:g,updateType:d})}else i.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update");if((4&p||h)&&((c=s.get(l))?n.push.apply(n,c[1]):4===p&&i.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),c&&s.delete(l)),1&p||h){var x=[u,[]];v=t._model.get(1,a),t._model.getGeometryRenderGeometries(v,u,x[1]),r.push.apply(r,x[1]),s.set(l,x)}})),0===s.size&&t._residentGeomRecords.get(l).delete(a)})),0===s._residentGeomRecords.get(l).size&&s._residentGeomRecords.delete(l),s._dirtyGeomRecords.delete(l)},s=this,l=0;l<e.length;l++)a(l);return[r,n,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=this._residentGeomRecords.get(n);i&&i.forEach((function(e){e.forEach((function(e){t.push.apply(t,e[1])}))}))}return t},e.prototype._objectStateChanged=function(e,t,r,n){if(null!=r)this._componentPropertyChanged(t,r,n,e);else for(var i=0,o=t.geometryRecords;i<o.length;i++){var a=o[i];this._componentPropertyChanged(t,a,n,e)}},e.prototype.visibilityChanged=function(e,t,r){this._objectStateChanged(1,e,t,r)},e.prototype.highlightChanged=function(e,t,r){this._objectStateChanged(8,e,t,r)},e.prototype.occlusionChanged=function(e,t,r){this._objectStateChanged(16,e,t,r)},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,2)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layerObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layerObjectRemoved(e,t[r])},e.prototype.layerObjectAdded=function(e,t){for(var r=e.id,n=t.geometryRecords,i=0;i<n.length;i++)this.objGeometryAdded(t,n[i],r)},e.prototype.layerObjectRemoved=function(e,t){for(var r=e.id,n=t.geometryRecords,i=0;i<n.length;i++)this.objGeometryRemoved(t,n[i],r)},e.prototype.layObjectReplaced=function(e,t){this.layerObjectRemoved(e,t[0]),this.layerObjectAdded(e,t[1])},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach((function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,0,2,5,4)}))},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,n){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,n)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,n,o,a,s,l,c){r=r||this._getParentLayerId(e);var u=e.id,p=t.id,d=this._ensureDirtyRecord(r,u),h=d.get(p);if(h){var f=h[1];f&o?d.delete(p):f&a?(h[1]=n,h[2]=c):f&s?h[2]|=c:f&l||i.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else d.set(p,[t,n,c])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(){var e=["ADD","UPD",void 0,"REM"],t="";return this._dirtyGeomRecords.forEach((function(r,n){r.forEach((function(r,i){t.length>0&&(t+="\n"),t+=n+"."+i;var o=[];r.forEach((function(e){var t=e[1];o[t]||(o[t]=[]),o[t].push(e[0].geometry.id)}));for(var a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(var s=0;s<o[a].length;s++)t+=o[a][s]+", "}}))})),t},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(169),r(190),r(164),r(156),r(152),r(231),r(157),r(151),r(160),r(235),r(1283),r(1831),r(1850),r(1215),r(1216),r(536),r(288),r(1853),r(1217),r(1855),r(1887),r(1287),r(1232),r(808),r(1888),r(1284),r(1889),r(849),r(1227)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R){Object.defineProperty(t,"__esModule",{value:!0});var D=s.getLogger("esri.views.3d.webgl-engine.parts.View"),L=a("esri-debug-messages"),j=function(e){function t(t,r,n){var a=e.call(this)||this;return a._stage=r,a.events=new o,a.updateLogicClients=new i,a._camera=new b.default(d.vec3f64.fromValues(0,100,-100)),a._stippleTextureRepository=new C.StippleTextureRepository,a.waterTextureRepository=new M.WaterTextureRepository,a._commonUniformStore=new y.CommonUniformStore,a._componentObjectCollection=null,a._needsUpdate=!0,a._needsRender=!0,a._idleSuspend=!0,a._logicUpdateLast=0,a._stats={renderTimeTotal:0,renderTimeLast:0,frameCount:0},a._container=t,a._initializeContext(n),u.init(a.waterTextureRepository,"loadingState",(function(){return a.setNeedsRender()})),a._shaderTechniqueRepository=new g.ShaderTechniqueRepository({rctx:a._rctx,viewingMode:"local"===n.viewingMode?1:0,commonUniformStore:a._commonUniformStore,stippleTextureRepository:a._stippleTextureRepository,waterTextureRepository:a.waterTextureRepository}),a._textureRepository=new P.TextureRepository(a._stage.getAll(4),a._shaderTechniqueRepository,a._rctx),a._textureRepository.events.on("changed",(function(e){return a.setNeedsRender(e.requestType)})),a._materialRepository=new w(a._textureRepository,a._shaderTechniqueRepository,(function(){return a.setNeedsRender()})),a._compositingHelper=new x.default(a._rctx,a._shaderTechniqueRepository),a._initializeViewportCamera(),a._renderer=new S(a._materialRepository,a._textureRepository,a._shaderTechniqueRepository,a._rctx,a._compositingHelper,(function(e){return void 0===e&&(e=1),a.setNeedsRender(e)}),a._stage),a.updateLogicClients.add(a._renderer),a._screenshotManager=new E.ScreenshotManager(a._rctx,(function(e,t,r){return a._render(e,t,r)}),(function(){return a.setNeedsRender()}),n.screenshot.renderOverlay,(function(e){return a.events.emit("force-camera-for-screenshot",e)})),a._renderPassManager=new m.RenderPassManager(a,a._rctx,a._shaderTechniqueRepository),a.renderPlugins.add(a._renderPassManager.slots(),a._renderPassManager),a._registerFrameTask(),a}return r.__extends(t,e),t.prototype.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._shaderTechniqueRepository.dispose(),this._shaderTechniqueRepository=null,O.clearTestWebGLDriver(this._rctx),e.prototype.dispose.call(this),this._rctx=null},t.prototype.getCombinedStats=function(){var e=this._rctx.gl;return r.__assign(r.__assign({},this._stats),{scene:this._renderer.getStats(),textureMemory:void 0!==e.getUsedTextureMemory?e.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==e.getUsedRenderbufferMemory?e.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==e.getUsedVBOMemory?e.getUsedVBOMemory():void 0})},t.prototype.setNeedsRender=function(e){void 0===e&&(e=1),1===e?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0},Object.defineProperty(t.prototype,"canRender",{get:function(){var e=this._camera;return e.fullWidth>0&&e.fullHeight>0&&this._renderer.canRender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||this._textureRepository.loadingCount>0||this.waterTextureRepository.updating||this._stage.dirty},enumerable:!0,configurable:!0}),t.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()},Object.defineProperty(t.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureRepository",{get:function(){return this._textureRepository},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"compositingHelper",{get:function(){return this._compositingHelper},enumerable:!0,configurable:!0}),t.prototype.setRenderParameters=function(e){this.setNeedsRender(),void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),void 0!==e.shadowMap&&(this._renderPassManager.shadowCastingEnabled=e.shadowMap),void 0!==e.ssrEnable&&(this._renderPassManager.screenSpaceReflectionsEnabled=e.ssrEnable),this._renderer.setRenderParams(e)},t.prototype.getRenderParameters=function(){var e=this._renderer.getRenderParams();return e.anisotropicFiltering=this._rctx.parameters.maxMaxAnisotropy,e.idleSuspend=this._idleSuspend,e},Object.defineProperty(t.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},t.prototype.modify=function(e,t,r){this._renderer.modify(e,e.length,t,t.length,r,r.length)},t.prototype.setCamera=function(e){this._camera.copyFrom(e),this.setNeedsRender()},t.prototype.getCamera=function(){return this._camera},t.prototype.getCanvas=function(){return this._canvas},t.prototype.takeScreenshot=function(e){return this._screenshotManager.takeScreenshot(e)},Object.defineProperty(t.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0}),t.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()},t.prototype.hotReloadShaders=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return A.removeLoadedShaderModules(),[4,this._shaderTechniqueRepository.hotReload()];case 1:return e.sent(),this.setNeedsRender(),[2]}}))}))},t.prototype._registerFrameTask=function(){var e=this,t={viewCamera:this._camera,frameHasSlicePlane:!1},r={preRender:function(t){T.begin();var r=!1;e._stage.processDirty();var n=h.Milliseconds(t.time-e._logicUpdateLast);if(n>f.DESIRED_ANIMATION_MS){var i={camera:e._stage.getCamera(),dt:n};e.updateLogicClients.forEach((function(e){e.updateLogic(i)&&(r=!0)})),e._logicUpdateLast=t.time}r&&e.setNeedsRender(0)},render:function(){(e.needsUpdate||e._needsRender||!e._idleSuspend)&&e.canRender&&(e._needsRender=!1,e._needsUpdate=!1,e._render(null,e._camera,!1))},postRender:function(){e.notifyChange("updating"),T.end()},update:function(){t.viewCamera=e._camera,t.frameHasSlicePlane=e._renderer.hasSlicePlane,e._textureRepository.update(),e._screenshotManager.update(t)}};this._frameTask=c.addFrameTask(r)},t.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this.setCamera(t)},t.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil,powerPreference:"high-performance"},r=T.instrumentContext(I.createContextOrErrorHTML(this._canvas,t,e.renderContext)),n={disabledExtensions:e.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.debugWebGLExtensions||{}};this._rctx=new R(r,n),null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,8)),this._loadShaderOnlyExtensions(this._rctx),!e.alpha&&this._rctx.contextAttributes.alpha&&D.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&a("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)},t.prototype._render=function(e,t,r){var n;L&&(n=performance.now()),this._renderer.setLighting(this._stage.lighting),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._renderer.render({fbo:e,camera:t,disableSlice:r,lightDirection:this._stage.mainLightDirection}),L&&(this._stats.renderTimeLast=performance.now()-n,this._stats.renderTimeTotal+=this._stats.renderTimeLast,this._stats.frameCount++)},t.prototype._loadShaderOnlyExtensions=function(e){var t=e.capabilities;t.standardDerivatives,t.shaderTextureLOD},Object.defineProperty(t.prototype,"componentObjectCollection",{get:function(){return l.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new v.ComponentObjectCollection(this._renderPassManager)),this._componentObjectCollection},enumerable:!0,configurable:!0}),r.__decorate([p.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],t.prototype,"updating",null),r.__decorate([_.autoDispose()],t.prototype,"_rctx",void 0),r.__decorate([_.autoDispose()],t.prototype,"_container",void 0),r.__decorate([_.autoDispose()],t.prototype,"_canvas",void 0),r.__decorate([_.autoDispose()],t.prototype,"_stippleTextureRepository",void 0),r.__decorate([_.autoDispose(),p.property()],t.prototype,"waterTextureRepository",void 0),r.__decorate([_.autoDispose()],t.prototype,"_textureRepository",void 0),r.__decorate([_.autoDispose()],t.prototype,"_commonUniformStore",void 0),r.__decorate([_.autoDispose()],t.prototype,"_compositingHelper",void 0),r.__decorate([_.autoDispose()],t.prototype,"_renderer",void 0),r.__decorate([_.autoDispose()],t.prototype,"_screenshotManager",void 0),r.__decorate([_.autoDispose()],t.prototype,"componentObjectCollection",null),r.__decorate([_.autoDispose()],t.prototype,"_componentObjectCollection",void 0),r.__decorate([p.subclass("esri.views.3d.webgl-engine.parts.RenderView")],t)}(_.AutoDisposableMixin(n));t.RenderView=j}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(156),r(152),r(120),r(272),r(413),r(162),r(160),r(245),r(374),r(193),r(596),r(289),r(340),r(371),r(317),r(1834),r(1835),r(961),r(1837),r(1838),r(962),r(1845),r(818),r(536),r(1846),r(443),r(195),r(819),r(249),r(307),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D){Object.defineProperty(t,"__esModule",{value:!0});var L=n.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection"),j=function(){function e(e){this._renderManager=e,this._objects=new P.BucketedObjectStore,this._renderSubmit=new _.RenderSubmitSystem(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new E.BufferManager(e.rctx)}return e.prototype.dispose=function(){A.assert(0===this.count,"ObjectCollection should be empty upon disposal")},e.prototype.createObject=function(e){var t=new U;return t.toMapSpace=e.toMapSpace.slice(),t.transform=e.transform,t.obb=f.clone(e.obb),t.components=new V(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new F(e.geometry.positionData,t.components),this._objects.add(e.visible?Z:0,t),t},e.prototype.destroyObject=function(e){var t=e;this._objects.remove(t),t.dispose(),this._notifyDirty()},e.prototype.setObjectVisibility=function(e,t){var r=e;if(t!==r.visible){var n=t?r.bucketKey|Z:r.bucketKey&~Z;this._objects.updateKey(r,n),this._notifyDirty()}},Object.defineProperty(e.prototype,"count",{get:function(){return this._objects.count},enumerable:!0,configurable:!0}),e.prototype.preSubmit=function(e){var t=e.camera.eye;this._objects.forEach((function(e,r){r&Z&&e.forEach((function(e){var r=l.vec3.squaredDistance(t,e.obb.center);e.renderable.meta.cameraDepthSquared=r}))}))},e.prototype.updateMaterial=function(e,t){var r=e.renderable.material;t(r),r.dirty&&this._notifyDirty()},e.prototype.setAllComponentVisibilities=function(e,t){var r=e;r.components.visibility.reset(t),r.components.visibilityDirty(),this._notifyDirty()},e.prototype.forEachVisibleComponent=function(e,t){return e.components.visibility.forEachComponent(t)},e.prototype.getComponentCount=function(e){var t=e,r=t.components.visibility.componentCount();return{visible:r,invisible:t.components.count-r}},e.prototype.setComponentData=function(e,t){var r=e,n=r.renderable.material;if(g.isVaryingComponentParameters(t)){for(var i=r.components,o=i.materialDataBuffer,a=i.materialDataIndices,s={castShadows:!0,pickable:!0,externalColor:p.vec4f32.create(),externalColorMixMode:1},l=o.textureBuffer,c=new Uint8Array(4),u=new Uint32Array(c.buffer),d=0,f=0,v=0,m=!1,y=0,_=0;_<i.count;_++)t(_,s),d+=+(s.externalColor[3]<1),f+=+(3===s.externalColorMixMode&&1===s.externalColor[3]),v+=+s.castShadows,h.encodeSymbolColor(s.externalColor,s.externalColorMixMode,c),c[2]=254&c[2]|+s.castShadows,l.setData(a[_],0,c[0],c[1],c[2],c[3]),m=m||_>0&&y!==u[0],y=u[0],s.pickable!==C.getVisibility(i.pickability,_)&&(i.pickability=C.updateVisibilityWithCount(i.pickability,i.count,_,s.pickable));m?(n.componentParameters=new w.ComponentParametersVarying,n.componentParameters.castShadows=B(v,i.count),n.componentParameters.transparent=B(d,i.count),n.componentParameters.opaqueOverride=B(f,i.count),n.componentParameters.texture=l,l.updateTexture()):(n.componentParameters=new w.ComponentParametersUniform,n.componentParameters.castShadows=s.castShadows?0:2,n.componentParameters.externalColor=s.externalColor,n.componentParameters.externalColorMixMode=s.externalColorMixMode)}else n.componentParameters=new w.ComponentParametersUniform,n.componentParameters.castShadows=t.castShadows?0:2,n.componentParameters.externalColor=t.externalColor,n.componentParameters.externalColorMixMode=t.externalColorMixMode;this._notifyDirty()},e.prototype.getComponentAABB=function(e,t,r){return e.intersectionGeometry.getComponentAABB(t,r)},e.prototype.getObjectTransform=function(e){return e.transform},e.prototype.getComponentPositions=function(e,t,r){return e.intersectionGeometry.getComponentPositions(t,r)},e.prototype.intersect=function(e,t,r,n,o,s){var c=e;i.isSome(o)&&(o.localOrigin=c.transform.position);var u=a.mat3.invert(G,c.transform.rotationScale);l.vec3.sub(q,t,c.transform.position),l.vec3.sub(W,r,c.transform.position),l.vec3.transformMat3(q,q,u),l.vec3.transformMat3(W,W,u);var p=a.mat3.transpose(G,u);return c.intersectionGeometry.intersect(q,W,n,p,o,s)},e.prototype.addEdges=function(e,t,r,n){var i=e,o=i.intersectionGeometry,a=o.indices,s=o.positions,l=i.components.offsets;return t.addComponentObject(e,i.transform,i.obb.center,s,a,l,r,n)},e.prototype.addComponentHighlight=function(e,t){var r=e.components;i.isNone(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),0==r.highlightCounts[t]++&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++},e.prototype.removeComponentHighlight=function(e,t){var r=e.components;if(i.isNone(r.highlightCounts))L.warn("Removing non-existing highlight.");else{var n=r.highlightCounts[t],o=r.highlightCounts[r.count];if(0!==n){if(n>1)return r.highlightCounts[t]=n-1,void(r.highlightCounts[r.count]=o-1);r.highlightCounts[t]=0,r.highlightsDirty(),this._notifyDirty(),1===o?r.highlightCounts=null:r.highlightCounts[r.count]=o-1}else L.warn("Removing non-existing highlight.")}},e.prototype.clearHighlights=function(e){var t=e.components;i.isSome(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())},e.prototype.getObjectMemoryUsageGPU=function(e){return e.renderable.meta.gpuMemoryEstimate},Object.defineProperty(e.prototype,"visibleObjects",{get:function(){return this._objects.getBucket(Z)},enumerable:!0,configurable:!0}),e.prototype._createRenderable=function(e,t){for(var r=this._renderManager.rctx,n=e.geometry,o=n.vertices.layoutParameters,c=R.createVertex(r,35044,n.vertices.data),p=i.applySome(n.indices,(function(e){return R.createIndex(r,35044,e)})),d=m.glLayout(b.createVertexBufferLayout(o)),h=new Uint16Array(n.vertices.count),f=0;f<t.count;f++){var v=t.offsets[f],y=t.offsets[f+1],g=t.materialDataIndices[f];if(i.isSome(n.indices))for(var _=v;_<y;_++)h[n.indices[_]]=g;else for(_=v;_<y;_++)h[_]=g}var x=R.createVertex(r,35044,h.buffer),P=new T.TwoVectorPosition(e.transform.position),O=s.mat3f32.clone(e.transform.rotationScale);a.mat3.invert(O,O),a.mat3.transpose(O,O);var C=new S.ComponentDrawParameters;l.vec3.copy(C.worldFromModel_TL,P.low),l.vec3.copy(C.worldFromModel_TH,P.high),a.mat3.copy(C.worldFromModel_RS,e.transform.rotationScale),a.mat3.copy(C.transformNormal_GlobalFromModel,O),u.vec4.copy(C.toMapSpace,e.toMapSpace);var M=new w.ComponentMaterial,A=new D(r,M.attributeLocations,{data:d,componentIndices:z},{data:c,componentIndices:x},i.unwrap(p)),E=new k;return E.material=M,E.drawParameters=C,E.geometry=new N(A,n.primitiveType,o,i.isSome(p)),E.meta.cameraDepthSquared=.5,E.meta.gpuMemoryEstimate=c.byteSize+x.byteSize+(i.isSome(p)?p.byteSize:0),E},e.prototype._notifyDirty=function(){this._renderManager.notifyDirty()},e}();t.ComponentObjectCollection=j;var V=function(e){function t(t,r){var n=e.call(this)||this;n.pickability=null,n.highlightCounts=null,n.cachedGeometryRanges=null,n.cachedHighlightRanges=null,n.offsets=o.slice(r);var i=n.count;n.visibility=new x.ComponentRangeRunLengthEncoded(i),n.materialDataBuffer=t.getBuffer(i),n.materialDataIndices=new Uint16Array(i);for(var a=0;a<i;a++)n.materialDataIndices[a]=n.materialDataBuffer.acquireIndex();return n}return r.__extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])},Object.defineProperty(t.prototype,"count",{get:function(){return this.offsets.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryRanges",{get:function(){return i.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightRanges",{get:function(){return i.isNone(this.highlightCounts)?null:(i.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=function(e,t,r){var n=[],i=r.length;return t.forEachComponent((function(t){return e[t]>0&&(i!==t-1&&(n.length&&n.push(r[i+1]-n[n.length-1]),n.push(r[t])),i=t),!0})),n.length&&n.push(r[i+1]-n[n.length-1]),n}(this.highlightCounts,this.visibility,this.offsets)),this.cachedHighlightRanges)},enumerable:!0,configurable:!0}),t.prototype.highlightsDirty=function(){this.cachedHighlightRanges=null},t.prototype.visibilityDirty=function(){this.cachedGeometryRanges=null,this.cachedHighlightRanges=null},t}(O.AutoDisposable),F=function(){function e(e,t){this._indices=i.isSome(e.indices)?e.indices:M.generateDefaultIndexArray(e.positions.length/3),this._positions=new v.BufferViewVec3f(e.positions),this._components=t}return e.prototype.getComponentAABB=function(e,t){if(i.isSome(this._perComponentAABBs)){for(var r=0;r<6;r++)t[r]=this._perComponentAABBs[6*e+r];return t}return this._computePerComponentAABBs(),this.getComponentAABB(e,t)},e.prototype.getComponentPositions=function(e,t){t.indices=this._indices,t.data=this._positions.typedBuffer,t.stride=this._positions.typedBufferStride,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]},e.prototype.intersect=function(e,t,r,n,o,a){var s=this,c={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},u=this._indices,p=this._components.offsets,d=I.computeInvDir(e,t,H);this._components.visibility.forEachComponent((function(h){if(!C.getVisibility(s._components.pickability,h))return!0;var f=s.getComponentAABB(h,J);if(i.isSome(o)&&o.applyToAABB(f),!I.intersectAabbInvDir(f,e,d,r))return!0;var v=p[h]/3,m=p[h+1]/3;return I.intersectTriangles(e,t,v,m,u,c,void 0,o,(function(e,t,r){return a(h,e,l.vec3.transformMat3(t,t,n),r)})),!0}))},e.prototype._computePerComponentAABBs=function(){var e=this._components.count;this._perComponentAABBs=new Float32Array(6*e);for(var t=0;t<e;t++)this._computeAABB(t)},e.prototype._computeAABB=function(e){for(var t=this._indices,r=this._positions,n=this._components.offsets,i=n[e],o=n[e+1],a=[0,0,0],s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0],u=i;u<o;u++){var p=t[u];r.getVec(p,a),l.vec3.min(s,s,a),l.vec3.max(c,c,a)}var d=6*e;this._perComponentAABBs[d++]=s[0],this._perComponentAABBs[d++]=s[1],this._perComponentAABBs[d++]=s[2],this._perComponentAABBs[d++]=c[0],this._perComponentAABBs[d++]=c[1],this._perComponentAABBs[d]=c[2]},Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),e}(),N=function(e){function t(t,r,n,i){var o=e.call(this)||this;return o.vao=t,o.primitiveType=r,o.parameters=n,o.indexed=i,o}return r.__extends(t,e),r.__decorate([O.autoDispose()],t.prototype,"vao",void 0),t}(O.AutoDisposable);t.RenderGeometry=N;var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meta={cameraDepthSquared:0,gpuMemoryEstimate:0},t}return r.__extends(t,e),r.__decorate([O.autoDispose()],t.prototype,"geometry",void 0),t}(O.AutoDisposable);t.Renderable=k;var z=m.glLayout(y.newLayout().u16("componentIndex")),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"visible",{get:function(){return!!(this.bucketKey&Z)},enumerable:!0,configurable:!0}),r.__decorate([O.autoDispose()],t.prototype,"renderable",void 0),r.__decorate([O.autoDispose()],t.prototype,"components",void 0),t}(P.BucketStorable);function B(e,t){return e===t?0:0===e?2:1}t.ComponentObject=U;var G=s.mat3f32.create(),H=c.vec3f64.create(),q=c.vec3f64.create(),W=c.vec3f64.create(),J=d.create(),Z=1}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){var e=new Float32Array(4);return e[3]=1,e},t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.createView=function(e,t){return new Float32Array(e,t,4)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=[0,0,0],n=[0,0,0];t.computeOBB=function(e,t){var f=e.data,v=e.strideIdx,m=f.length/v;if(!(m<=0)){var y=new V(e);k(r,y.minProj,y.maxProj),U(r,r,.5),z(n,y.maxProj,y.minProj);var g=N(n),_=new F;_.quality=g,m<14&&(e={data:new Float64Array(y.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var w=[0,0,0],P=[0,0,0],T=[0,0,0],O=[0,0,0],A=[0,0,0],R=[0,0,0],D=[0,0,0];switch(function(e,t,r,n,i,o,a,s,l,c){return function(e,t,r){for(var n=W(e.maxVert[0],e.minVert[0]),i=0,o=1;o<7;++o){var a=W(e.maxVert[o],e.minVert[o]);a>n&&(n=a,i=o)}B(t,e.minVert[i]),B(r,e.maxVert[i])}(e,n,i),W(n,i)<1e-6?1:(z(a,n,i),H(a,a),function(e,t,r,n){for(var i=e.data,o=e.offsetIdx,a=e.strideIdx,s=Number.NEGATIVE_INFINITY,l=0,c=o;c<i.length;c+=a){d[0]=i[c]-t[0],d[1]=i[c+1]-t[1],d[2]=i[c+2]-t[2];var u=r[0]*d[0]+r[1]*d[1]+r[2]*d[2],p=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=d[0]*d[0]+d[1]*d[1]+d[2]*d[2]-u*u/p;h>s&&(s=h,l=c)}return B(n,i,l),s}(t,n,a,o)<1e-6?2:(z(s,i,o),H(s,s),z(l,o,n),H(l,l),G(r,s,a),H(r,r),b(t,r,a,s,l,c),0))}(y,e,D,w,P,T,O,A,R,_)){case 1:return void S(r,n,t);case 2:return void E(e,O,t)}!function(e,t,r,n,d,f,v,m,y){(function(e,t,r,n,i){!function(e,t,r,n,i){var o=e.data,a=e.offsetIdx,s=e.strideIdx;B(n,o,a),B(i,n),r[0]=J(x,t),r[1]=r[0];for(var l=a+s;l<o.length;l+=s){var c=o[l]*t[0]+o[l+1]*t[1]+o[l+2]*t[2];c<r[0]&&(r[0]=c,B(n,o,l)),c>r[1]&&(r[1]=c,B(i,o,l))}}(e,t,h,i,n);var o=J(r,t);h[1]-1e-6<=o&&(n[0]=void 0),h[0]+1e-6>=o&&(i[0]=void 0)})(e,t,r,i,o),void 0!==i[0]&&(z(a,i,r),H(a,a),z(s,i,n),H(s,s),z(l,i,d),H(l,l),G(c,s,f),H(c,c),G(u,l,v),H(u,u),G(p,a,m),H(p,p),b(e,c,f,s,a,y),b(e,u,v,l,s,y),b(e,p,m,a,l,y)),void 0!==o[0]&&(z(a,o,r),H(a,a),z(s,o,n),H(s,s),z(l,o,d),H(l,l),G(c,s,f),H(c,c),G(u,l,v),H(u,u),G(p,a,m),H(p,p),b(e,c,f,s,a,y),b(e,u,v,l,s,y),b(e,p,m,a,l,y))}(e,D,w,P,T,O,A,R,_),I(e,_.b0,_.b1,_.b2,C,M);var L=[0,0,0];z(L,M,C),_.quality=N(L),_.quality<g?j(_.b0,_.b1,_.b2,C,M,L,t):S(r,n,t)}};var i=[0,0,0],o=[0,0,0],a=[0,0,0],s=[0,0,0],l=[0,0,0],c=[0,0,0],u=[0,0,0],p=[0,0,0],d=[0,0,0],h=[0,0],f=[0,0,0],v=[0,0,0],m=[0,0,0],y=[0,0,0],g=[0,0,0],_=[0,0,0];function b(e,t,r,n,i,o){if(!(q(t)<1e-6)){G(f,r,t),G(v,n,t),G(m,i,t),w(e,t,h),g[1]=h[0],y[1]=h[1],_[1]=y[1]-g[1];for(var a=[r,n,i],s=[f,v,m],l=0;l<3;++l){w(e,a[l],h),g[0]=h[0],y[0]=h[1],w(e,s[l],h),g[2]=h[0],y[2]=h[1],_[0]=y[0]-g[0],_[2]=y[2]-g[2];var c=N(_);c<o.quality&&(B(o.b0,a[l]),B(o.b1,t),B(o.b2,s[l]),o.quality=c)}}}var x=[0,0,0];function w(e,t,r){var n=e.data,i=e.offsetIdx,o=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var a=i;a<n.length;a+=o){var s=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function S(e,t,r){B(r.center,e),U(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}var P=[0,0,0],T=[0,0,0],O=[0,0,0],C=[0,0,0],M=[0,0,0],A=[0,0,0];function E(e,t,r){B(P,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?P[0]=0:Math.abs(t[1])>Math.abs(t[2])?P[1]=0:P[2]=0,q(P)<1e-6&&(P[0]=P[1]=P[2]=1),G(T,t,P),H(T,T),G(O,t,T),H(O,O),I(e,t,T,O,C,M),z(A,M,C),j(t,T,O,C,M,A,r)}function I(e,t,r,n,i,o){w(e,t,h),i[0]=h[0],o[0]=h[1],w(e,r,h),i[1]=h[0],o[1]=h[1],w(e,n,h),i[2]=h[0],o[2]=h[1]}var R=[0,0,0],D=[1,0,0,0,1,0,0,0,1],L=[0,0,0];function j(e,t,r,n,i,o,a){D[0]=e[0],D[1]=e[1],D[2]=e[2],D[3]=t[0],D[4]=t[1],D[5]=t[2],D[6]=r[0],D[7]=r[1],D[8]=r[2],function(e,t){var r=t[0]+t[4]+t[8];if(r>0){var n=Math.sqrt(r+1);e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n}else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[a]=(t[3*a+i]+t[3*i+a])*n}}(a.quaternion,D),k(L,n,i),U(L,L,.5),U(a.center,e,L[0]),U(R,t,L[1]),k(a.center,a.center,R),U(R,r,L[2]),k(a.center,a.center,R),U(a.halfSize,o,.5)}var V=function(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);var t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(var r=0;r<7;++r)this.minVert[r]=new Float64Array(this.buffer,t,3),t+=24;for(r=0;r<7;++r)this.maxVert[r]=new Float64Array(this.buffer,t,3),t+=24;for(r=0;r<7;++r)this.minProj[r]=Number.POSITIVE_INFINITY,this.maxProj[r]=Number.NEGATIVE_INFINITY;var n=new Array(7),i=new Array(7),o=e.data,a=e.offsetIdx,s=e.strideIdx;for(r=a;r<o.length;r+=s){var l=o[r];l<this.minProj[0]&&(this.minProj[0]=l,n[0]=r),l>this.maxProj[0]&&(this.maxProj[0]=l,i[0]=r),(l=o[r+1])<this.minProj[1]&&(this.minProj[1]=l,n[1]=r),l>this.maxProj[1]&&(this.maxProj[1]=l,i[1]=r),(l=o[r+2])<this.minProj[2]&&(this.minProj[2]=l,n[2]=r),l>this.maxProj[2]&&(this.maxProj[2]=l,i[2]=r),(l=o[r]+o[r+1]+o[r+2])<this.minProj[3]&&(this.minProj[3]=l,n[3]=r),l>this.maxProj[3]&&(this.maxProj[3]=l,i[3]=r),(l=o[r]+o[r+1]-o[r+2])<this.minProj[4]&&(this.minProj[4]=l,n[4]=r),l>this.maxProj[4]&&(this.maxProj[4]=l,i[4]=r),(l=o[r]-o[r+1]+o[r+2])<this.minProj[5]&&(this.minProj[5]=l,n[5]=r),l>this.maxProj[5]&&(this.maxProj[5]=l,i[5]=r),(l=o[r]-o[r+1]-o[r+2])<this.minProj[6]&&(this.minProj[6]=l,n[6]=r),l>this.maxProj[6]&&(this.maxProj[6]=l,i[6]=r)}for(r=0;r<7;++r){var c=n[r];B(this.minVert[r],o,c),c=i[r],B(this.maxVert[r],o,c)}},F=function(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0};function N(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function k(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function z(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function U(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function B(e,t,r){void 0===r&&(r=0),e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function G(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2];e[0]=i*l-o*s,e[1]=o*a-n*l,e[2]=n*s-i*a}function H(e,t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){var n=1/Math.sqrt(r);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}}function q(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function W(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function J(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isVaryingComponentParameters=function(e){return"function"==typeof e}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1836)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._objects=e}return e.prototype.submit=function(e,t){this._objects.preSubmit(t);for(var r=this._objects.visibleObjects,n=0;n<r.length;n++){var i=r[n];i.renderable.material.submit(e,i)}},e.prototype.queryShadowCasterDepthRange=function(e){return this._objects.visibleObjects.length?r.computeDepthRange(e,this._objects.visibleObjects):null},e}();t.RenderSubmitSystem=n}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(214),r(272),r(276),r(444),r(647),r(162),r(160),r(289),r(648),r(667)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0}),t.computeDepthRange=function(e,t){for(var r=p.empty(),i=e.eye,a=e.viewForward,l=e.frustum.planes,u=0;u<t.length;u++){var v=t[u].obb,_=s.vec3.dot(s.vec3.sub(A,v.center,i),a),x=c.projectedRadius(v,a);if(!p.within(r,_-x)||!p.within(r,_+x)){var w=O(v,l);if(-1!==w)if(0!==w){var S=d.pushNew();S.near=_-x,S.far=_+x,S.mask=w,S.object=t[u]}else h.far=_+x,h.near=_-x,p.union(r,h)}}var L=function(e){var t=d.data[e];if(p.within(r,t.near)&&p.within(r,t.far))return"continue";h.far=t.far,h.near=1/0,0===function(e,t,r,i){o.quat.conjugate(M,e.quaternion),s.vec3.sub(A,t,e.center),s.vec3.transformQuat(A,A,M);var a=8*((A[0]<-e.halfSize[0]?-1:A[0]>e.halfSize[0]?1:0)+3*(A[1]<-e.halfSize[1]?-1:A[1]>e.halfSize[1]?1:0)+9*(A[2]<-e.halfSize[2]?-1:A[2]>e.halfSize[2]?1:0)+13),l=P[a];if(0===l)return l;n.mat3.fromQuat(C,e.quaternion),n.mat3.scale(C,C,e.halfSize);var c=function(t,r){var n=P[a+r+1];return s.vec3.set(t,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),s.vec3.transformMat3(t,t,C),s.vec3.add(t,e.center,t)};return r.length=0,b(r,c(E,0)),b(r,c(I,1)),b(r,c(A,2)),b(r,c(R,3)),i(r),1===l?l:(r.length=0,b(r,E),b(r,R),b(r,c(A,4)),b(r,c(D,5)),i(r),2===l||(r.length=0,b(r,E),b(r,D),b(r,c(A,6)),b(r,I),i(r)),l)}(t.object.obb,i,m,(function(e){for(var r=y,n=0;n<T&&e.length>0;n++)if(0!=(t.mask&1<<n)){g(l[n],e,r);var o=e;e=r,r=o}for(var c=0;c<e.length;c+=3){s.vec3.set(f,e.data[c+0],e.data[c+1],e.data[c+2]);var u=s.vec3.dot(s.vec3.sub(f,f,i),a);h.near=Math.min(h.near,u)}}))&&(h.near=0),p.union(r,h)};for(u=0;u<d.length;u++)L(u);return d.length=0,r};var d=new r({allocator:function(e){return e||{near:1/0,far:-1/0,mask:0,object:null}},deallocator:function(e){return e.object=null,e}}),h=p.empty(),f=l.vec3f64.create(),v=l.vec3f64.create(),m=new r({deallocator:null}),y=new r({deallocator:null});function g(e,t,r){r.length=0;var n=t.length-3;_(f,t,n);var i=u.signedDistance(e,f);i<=0&&(r.push(f[0]),r.push(f[1]),r.push(f[2]));for(var o=0,a=i;o<n;o+=3){_(v,t,o);var l=u.signedDistance(e,v);if(a*l<0){var c=l/(l-a);s.vec3.lerp(f,v,f,c),b(r,f)}l<=0&&b(r,v),a=l,s.vec3.copy(f,v)}a*i<0&&(_(v,t,n),c=i/(i-a),s.vec3.lerp(f,v,f,c),b(r,f))}function _(e,t,r){return s.vec3.set(e,t.data[r+0],t.data[r+1],t.data[r+2])}function b(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}var x,w,S,P=(x=new Int8Array(216),w=0,(S=function(e){for(var t=0;t<e.length;t++)x[w+t]=e[t];w+=8})([3,0,6,2,3,1,5,4]),S([2,0,2,3,1,5,4,0]),S([3,1,0,2,3,7,5,4]),S([2,0,1,3,2,6,4,0]),S([1,0,1,3,2,0,0,0]),S([2,1,5,7,3,2,0,0]),S([3,2,0,1,3,7,6,4]),S([2,2,0,1,3,7,6,0]),S([3,3,0,1,5,7,6,2]),S([2,0,1,5,4,6,2,0]),S([1,0,1,5,4,0,0,0]),S([2,1,3,7,5,4,0,0]),S([1,0,2,6,4,0,0,0]),S([0,0,0,0,0,0,0,0]),S([1,1,3,7,5,0,0,0]),S([2,2,3,7,6,4,0,0]),S([1,2,3,7,6,0,0,0]),S([2,3,1,5,7,6,2,0]),S([3,4,0,1,5,7,6,2]),S([2,5,7,6,4,0,1,0]),S([3,5,0,1,3,7,6,4]),S([2,4,5,7,6,2,0,0]),S([1,4,5,7,6,0,0,0]),S([2,5,1,3,7,6,4,0]),S([3,6,0,2,3,7,5,4]),S([2,6,2,3,7,5,4,0]),S([3,7,6,2,3,1,5,4]),x),T=4;function O(e,t){for(var r=0,n=0;n<T;n++){var i=c.intersectPlane(e,t[n]);if(i>0)return-1;0===i&&(r|=1<<n)}return r}var C=i.mat3f64.create(),M=a.quatf64.create(),A=l.vec3f64.create(),E=l.vec3f64.create(),I=l.vec3f64.create(),R=l.vec3f64.create(),D=l.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._totalCount=e,this._indexRanges=[0,e]}return e.prototype.componentCount=function(){for(var e=this._indexRanges,t=0,r=0;r<e.length;r+=2)t+=e[r+1];return t},e.prototype.reset=function(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function(e){var t=new Array;if(0===e.length)return t;for(var r=e[0],n=1,i=1;i<e.length;i++){var o=e[i];r+n===o?n+=1:(t.push(r),t.push(n),r=o,n=1)}return t.push(r),t.push(n),t}(e)},e.prototype.forEachComponent=function(e){for(var t=this._indexRanges,r=0;r<t.length;r+=2)for(var n=t[r],i=n+t[r+1],o=n;o<i;o++)if(!e(o))return!1;return!0},e.prototype.forEachComponentRange=function(e){for(var t=this._indexRanges,r=0;r<t.length;r+=2){var n=t[r];if(!e(n,n+t[r+1]))return!1}return!0},e.prototype.computeOffsetRanges=function(e){for(var t=new Array(this._indexRanges.length),r=this._indexRanges,n=0;n<r.length;n+=2){var i=r[n],o=i+r[n+1],a=e[i],s=e[o];t[n]=a,t[n+1]=s-a}return t},e}();t.ComponentRangeRunLengthEncoded=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(162),r(389),r(245),r(374),r(201),r(962),r(963),r(1844),r(319)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.baseColor=s.vec4f32.fromValues(1,1,1,1),t.usePBR=!1,t.mrrFactors=o.vec3f32.fromValues(1,1,.5),t.emissiveFactor=o.vec3f32.fromValues(0,0,0),t.baseColorTexture=null,t.metallicRoughnessTexture=null,t.emissionTexture=null,t.occlusionTexture=null,t.normalTexture=null,t.overlayTexOffset=l.vec4f64.fromValues(-1,-1,-1,-1),t.overlayTexScale=l.vec4f64.fromValues(0,0,0,0),t.overlayColorInner=null,t.overlayColorOuter=null,t.overlayHighlightInner=null,t.overlayHighlightOuter=null,t.overlayNormalInner=null,t.overlayNormalOuter=null,t.objectOpacity=1,t.commonMaterialParameters=new f,t.componentParameters=new v,t.alphaCutoff=d.defaultMaskAlphaCutoff,t.alphaDiscardMode=1,t.isIntegratedMesh=!1,t.polygonOffsetEnabled=!1,t.sceneHasOcludees=!1,t._techniqueConfig=new c.ComponentTechniqueConfiguration,t}return r.__extends(t,e),t.prototype.dispose=function(e){this._technique&&(e.release(this._technique),this._technique=void 0),this.baseColorTexture=null},t.prototype.getTechnique=function(e,t,r){var i=this._techniqueConfig;if(i.hasVertexColors=r.colors,i.hasNormals=r.normals,i.vertexTextureCoordinates=r.textureCoordinates,i.usePBR=this.usePBR,i.hasMetalnessAndRoughnessTexture=n.isSome(this.metallicRoughnessTexture),i.hasEmissionTexture=n.isSome(this.emissionTexture),i.hasOcclusionTexture=n.isSome(this.occlusionTexture),i.hasNormalTexture=n.isSome(this.normalTexture),this.dirty){i.componentData=this.componentParameters.type,i.cullFace=this.commonMaterialParameters.cullFace,i.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,i.baseColorTexture=n.isSome(this.baseColorTexture);var o=this._computeWhichMaterialPass();i.blendingEnabled=1===o||2===o,i.alphaDiscardMode=this.alphaDiscardMode,i.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,i.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return i.slicePlaneEnabled=t.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===t.identifier?(i.output=3,i.vertexDiscardMode=0):2===t.identifier?(i.output=4,i.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?i.vertexDiscardMode=t.transparent?2:1:i.vertexDiscardMode=0,i.output=function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 7}}(t.subPass),0===t.subPass?(i.receiveAmbientOcclusion=t.ambientOcclusionEnabled,i.sceneHasOcludees=t.sceneHasOcludees,i.receiveShadows=t.shadowsEnabled,i.ssrEnabled=t.ssrParams.ssrEnabled):(i.receiveAmbientOcclusion=!1,i.receiveShadows=!1)),this._technique=e.repository.acquireAndReleaseExisting(c.ComponentTechnique,i,this._technique),this._technique},t.prototype.submit=function(e,t){var r=t.renderable.geometry,i=t.components,o=t.renderable.drawParameters,a=t.renderable.meta.cameraDepthSquared,s=i.geometryRanges,l=i.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,r,s,o,a);break;case 1:e.materialTransparent.submitDraw(this,r,s,o,a);break;case 2:e.materialOpaque.submitDraw(this,r,s,o,a),e.materialTransparent.submitDraw(this,r,s,o,a);break;case 3:e.materialIntegratedMesh.submitDraw(this,r,s,o,a),(this.overlayHighlightInner||this.overlayHighlightOuter)&&e.highlightIntegratedMesh.submitDraw(this,r,s,o,a)}n.isSome(e.shadowMap)&&2!==this.componentParameters.castShadows&&e.shadowMap.submitDraw(this,r,s,o,a),n.isSome(e.highlight)&&n.isSome(l)&&e.highlight.submitDraw(this,r,l,o,a)},Object.defineProperty(t.prototype,"attributeLocations",{get:function(){return u.attributeLocations},enumerable:!0,configurable:!0}),t.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2},r.__decorate([p.parameter({vectorOps:a.vec4})],t.prototype,"baseColor",void 0),r.__decorate([p.parameter()],t.prototype,"usePBR",void 0),r.__decorate([p.parameter({vectorOps:i.vec3})],t.prototype,"mrrFactors",void 0),r.__decorate([p.parameter({vectorOps:i.vec3})],t.prototype,"emissiveFactor",void 0),r.__decorate([p.parameter({dispose:!0})],t.prototype,"baseColorTexture",void 0),r.__decorate([p.parameter({dispose:!0})],t.prototype,"metallicRoughnessTexture",void 0),r.__decorate([p.parameter({dispose:!0})],t.prototype,"emissionTexture",void 0),r.__decorate([p.parameter({dispose:!0})],t.prototype,"occlusionTexture",void 0),r.__decorate([p.parameter({dispose:!0})],t.prototype,"normalTexture",void 0),r.__decorate([p.parameter({vectorOps:{equals:a.vec4.exactEquals,copy:a.vec4.copy}})],t.prototype,"overlayTexOffset",void 0),r.__decorate([p.parameter({vectorOps:{equals:a.vec4.exactEquals,copy:a.vec4.copy}})],t.prototype,"overlayTexScale",void 0),r.__decorate([p.parameter()],t.prototype,"overlayColorInner",void 0),r.__decorate([p.parameter()],t.prototype,"overlayColorOuter",void 0),r.__decorate([p.parameter()],t.prototype,"overlayHighlightInner",void 0),r.__decorate([p.parameter()],t.prototype,"overlayHighlightOuter",void 0),r.__decorate([p.parameter()],t.prototype,"overlayNormalInner",void 0),r.__decorate([p.parameter()],t.prototype,"overlayNormalOuter",void 0),r.__decorate([p.parameter()],t.prototype,"objectOpacity",void 0),r.__decorate([p.parameterBlock()],t.prototype,"commonMaterialParameters",void 0),r.__decorate([p.parameterBlock()],t.prototype,"componentParameters",void 0),r.__decorate([p.parameter()],t.prototype,"alphaCutoff",void 0),r.__decorate([p.parameter()],t.prototype,"alphaDiscardMode",void 0),r.__decorate([p.parameter()],t.prototype,"isIntegratedMesh",void 0),r.__decorate([p.parameter()],t.prototype,"polygonOffsetEnabled",void 0),r.__decorate([p.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(p.MaterialBase);t.ComponentMaterial=h;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.doubleSided=!1,t.cullFace=2,t.slicePlaneEnabled=!0,t}return r.__extends(t,e),r.__decorate([p.parameter()],t.prototype,"doubleSided",void 0),r.__decorate([p.parameter()],t.prototype,"cullFace",void 0),r.__decorate([p.parameter()],t.prototype,"slicePlaneEnabled",void 0),t}(p.MaterialParameterBlock);t.CommonMaterialParameters=f;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.externalColor=s.vec4f32.fromValues(1,1,1,1),t.externalColorMixMode=1,t.castShadows=0,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"transparent",{get:function(){return this.externalColor[3]<1?0:2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this.externalColor[3]>0?0:2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return 0},enumerable:!0,configurable:!0}),r.__decorate([p.parameter({vectorOps:a.vec4})],t.prototype,"externalColor",void 0),r.__decorate([p.parameter()],t.prototype,"externalColorMixMode",void 0),r.__decorate([p.parameter()],t.prototype,"castShadows",void 0),t}(p.MaterialParameterBlock);t.ComponentParametersUniform=v;var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.texture=null,t.transparent=2,t.opaqueOverride=2,t.castShadows=2,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return 1},enumerable:!0,configurable:!0}),r.__decorate([p.parameter()],t.prototype,"texture",void 0),r.__decorate([p.parameter()],t.prototype,"transparent",void 0),r.__decorate([p.parameter()],t.prototype,"opaqueOverride",void 0),r.__decorate([p.parameter()],t.prototype,"castShadows",void 0),t}(p.MaterialParameterBlock);t.ComponentParametersVarying=m}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(1237),r(175)],void 0===(i=function(e,t,r,n,i){var o,a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentData=function(e,t){1===t.componentData&&(e.vertex.uniforms.add("uComponentColorTex","sampler2D"),e.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),e.attributes.add("componentIndex","float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(n.DecodeSymbolColor),e.vertex.code.add(i.glsl(o||(o=r.__makeTemplateObject(["\n      vec4 _readComponentColor() {\n        float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord = vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor = _readComponentColor() * 255.0;\n\n        float shadowFlag = mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -= shadowFlag;\n        castShadows = shadowFlag >= 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;\n        vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "],["\n      vec4 _readComponentColor() {\n        float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord = vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor = _readComponentColor() * 255.0;\n\n        float shadowFlag = mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -= shadowFlag;\n        castShadows = shadowFlag >= 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;\n        vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "])))),e.fragment.code.add(i.glsl(a||(a=r.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor = vExternalColor;\n        externalColorMixMode = int(vExternalColorMixMode);\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor = vExternalColor;\n        externalColorMixMode = int(vExternalColorMixMode);\n      }\n    "]))))),0===t.componentData&&(e.vertex.uniforms.add("uExternalColor","vec4"),e.fragment.uniforms.add("uExternalColorMixMode","int"),e.varyings.add("vExternalColor","vec4"),e.vertex.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor = uExternalColor;\n        castShadows = true;\n        return uExternalColor;\n      }\n    "],["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor = uExternalColor;\n        castShadows = true;\n        return uExternalColor;\n      }\n    "])))),e.fragment.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor = vExternalColor;\n        externalColorMixMode = uExternalColorMixMode;\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor = vExternalColor;\n        externalColorMixMode = uExternalColorMixMode;\n      }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.VertexDiscardByOpacity=function(e,t){var l=e.vertex;switch(l.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "],["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "])))),t.vertexDiscardMode){case 0:l.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "]))));break;case 2:l.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))));break;case 1:l.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(594),r(951),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ComputeMaterialColor=function(e,t){e.include(n.VertexColor,t),e.include(i.MixExternalColor,{stages:1});var c=e.fragment;c.uniforms.add("uBaseColor","vec4"),c.uniforms.add("uObjectOpacity","float"),t.attributeColor?c.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "],["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "])))):c.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "],["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "])))),c.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor = _baseColor();\n      float baseOpacity = _baseOpacity();\n\n      vec3 color = mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity = uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "],["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor = _baseColor();\n      float baseOpacity = _baseOpacity();\n\n      vec3 color = mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity = uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(659),r(449),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l,c,u,p,d,h;Object.defineProperty(t,"__esModule",{value:!0}),t.ComputeShadingNormal=function(e,t){var f=e.fragment;0===t.doubleSidedMode?f.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "])))):1===t.doubleSidedMode?(e.include(i.VertexPosition,t),f.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),f.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) > 0.0 ? -normal : normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) > 0.0 ? -normal : normal;\n      }\n    "]))))):2===t.doubleSidedMode&&f.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "])))),0===t.normalType||1===t.normalType?(e.include(n.VertexNormal,t),f.code.add(o.glsl(c||(c=r.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal = normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal = normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))))):3===t.normalType?(e.extensions.add("GL_OES_standard_derivatives"),e.include(i.VertexPosition,t),f.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "],["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "]))))):2===t.normalType&&(0===t.viewingMode?(e.include(i.VertexPosition,t),f.code.add(o.glsl(p||(p=r.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "]))))):1===t.viewingMode&&f.code.add(o.glsl(d||(d=r.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "])))),e.extensions.add("GL_OES_standard_derivatives"),f.code.add(o.glsl(h||(h=r.__makeTemplateObject(["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "],["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "])))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(950),r(1233),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ReadBaseColorTexture=function(e,t){var c=e.fragment;t.baseColorTexture?(e.include(n.VertexTextureCoordinates,t),c.uniforms.add("uBaseColorTexture","sampler2D"),c.uniforms.add("uBaseColorTextureSize","vec2"),2===t.attributeTextureCoordinates?(e.include(i.TextureAtlasLookup),c.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "]))))):c.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "]))))):c.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "],["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._dirty=!0}return e.prototype._setDirty=function(){this._dirty=!0},e.prototype._setClean=function(){this._dirty=!1;for(var e=0,t=this.__proto__.__parameterBlocks||[];e<t.length;e++)this[t[e]]._setClean()},Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty||this._checkParameterBlocksDirty()},enumerable:!0,configurable:!0}),e.prototype._checkParameterBlocksDirty=function(){for(var e=0,t=this.__proto__.__parameterBlocks||[];e<t.length;e++)if(this[t[e]].dirty)return!0;return!1},e}();t.MaterialBase=r;var n=function(){function e(){this._dirty=!0}return e.prototype._setDirty=function(){this._dirty=!0},e.prototype._setClean=function(){this._dirty=!1},Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),e}();t.MaterialParameterBlock=n,t.parameter=function(e){return void 0===e&&(e={}),function(t,r){t.__materialParameters=t.__materialParameters||[],t.__materialParameters.push(r);var n="_"+r;if(e.vectorOps){var i=e.vectorOps;Object.defineProperty(t,r,{get:function(){return this[n]},set:function(e){if(this[n]){if(i.equals(this[n],e))return;i.copy(this[n],e)}else this[n]=e;this._setDirty()}})}else Object.defineProperty(t,r,{get:function(){return this[n]},set:function(t){this[n]!==t&&(e.dispose&&this[n]&&this[n].dispose(),this[n]=t,this._setDirty())}})}},t.parameterBlock=function(){return function(e,t){e.__parameterBlocks=e.__parameterBlocks||[],e.__parameterBlocks.push(t);var r="_"+t;Object.defineProperty(e,t,{get:function(){return this[r]},set:function(e){this[r]!==e&&(this[r]=e,this._setDirty())}})}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(536)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"bucketKey",{get:function(){return this._bucket.key},enumerable:!0,configurable:!0}),t}(n.AutoDisposable);t.BucketStorable=i;var o=function(){function e(){this._buckets=new Map,this._count=0}return e.prototype.add=function(e,t){var r=this._getBucket(e);t._bucket=r,t._bucketIndex=r.count,r._data.push(t),this._count++},e.prototype.remove=function(e){var t=e._bucket._data,r=t[t.length-1];t[e._bucketIndex]=r,r._bucketIndex=e._bucketIndex,t.pop(),this._count--},e.prototype.updateKey=function(e,t){this.remove(e),this.add(t,e)},e.prototype.getBucket=function(e){return this._getBucket(e).data},e.prototype.forEach=function(e){this._buckets.forEach((function(t){e(t.data,t.key)}))},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype._getBucket=function(e){var t=this._buckets.get(e);if(t)return t;var r=new a(e);return this._buckets.set(e,r),r},e}();t.BucketedObjectStore=o;var a=function(){function e(e){this.key=e,this._data=new Array}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return void 0===e&&(e=!0),{isVisibleBit:!e,data:new Uint32Array(0)}}function n(e){return 8*e.BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0}),t.updateVisibilityWithCount=function(e,t,i,o){if(i>=t)return e;null==e&&(e=r());var a=e.isVisibleBit,s=e.data,l=n(s),c=i/l|0,u=i-l*c,p=(t-1)/l|0,d=s,h=o===a;if(!(i<d.length*l)&&h){var f=c+1,v=Math.ceil(1.5*d.length),m=p+1,y=Math.max(f,v);y=Math.min(y,m),(s=new Uint32Array(y)).set(d)}return c<s.length&&(s[c]=function(e,t,r){return e&~(1<<t)|(r?1:0)<<t}(s[c],u,h)),e.data=s,e},t.getVisibility=function(e,t){if(null==e)return!0;var r=e.isVisibleBit,i=e.data,o=n(i);return t<i.length*o?function(e,t,r,n){var i=r/n|0,o=r-i*n;return function(e,t){return 0!=(e&1<<t)}(t[i],o)===e}(r,i,t,o):!e.isVisibleBit},t.defaultVisibilities=r;for(var i=[],o=0;o<65;o++)i.push(Math.pow(2,o)-1)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1848),r(1849)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var i=function(){function e(e,i){void 0===i&&(i=1),this.textureBuffer=new n.TextureBackedBuffer(e,i),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.acquireIndex=function(){var e=this.indexManager.acquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.acquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(299)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new n(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,n,i,o){var a=e*this.fieldCount+t;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,n),this.data.set(a,2,i),this.data.set(a,3,o)},e.prototype.setDataElement=function(e,t,r,n){var i=e*this.fieldCount+t;this.dirty=!0,this.data.set(i,r,n)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var n=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new r.BufferViewVec4u8(new ArrayBuffer(4*n));i.typedBuffer.set(this.data.typedBuffer),this.data=i}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(272),r(276),r(189),r(205),r(162),r(160),r(245),r(203),r(1851),r(1852),r(818),r(667)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t,r){this._renderView=e,this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParams=new p.MaterialPassesParameters,this._shadowPassParams=new p.ShadowMapPassParameters,this._highlightPassParams=new p.HighlightPassParameters,this._systems=new Set,this._passes=new Array,this._shadowMapPass=this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository)),this.passes={materialOpaque:this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new d.RenderPass(t,this.shaderTechniqueRepository))}}return e.prototype.register=function(e){this._systems.add(e)},e.prototype.prepareRender=function(){var e=this;this._passes.forEach((function(e){return e.prepareSubmit()}));var t={camera:this._renderView.getCamera()};this._systems.forEach((function(r){r.submit(e.passes,t)})),this._passes.forEach((function(e){return e.finishSubmit()})),this.shaderTechniqueRepository.frameUpdate()},e.prototype.render=function(e){if(4===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1,this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 4:this.passes.highlight.dispatch(this._highlightPassParams);break;case 3:this._shadowMapPass.dispatch(this._shadowPassParams)}if(6===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1,this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===e.slot)switch(this._configure(e),e.pass){case 0:this._materialPassParams.subPass=0,this._configureMaterialColorPass(e),this._materialPassParams.ssrParams=e.ssrParams,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 4:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0},e.prototype.notifyDirty=function(){this._renderView.setNeedsRender()},e.prototype.slots=function(){return[4,6,1]},e.prototype.initializeRenderContext=function(){},e.prototype.uninitializeRenderContext=function(){},e.prototype.queryDepthRange=function(e){var t={near:1/0,far:-1/0};return this._systems.forEach((function(n){var i=n.queryShadowCasterDepthRange(e);r.isSome(i)&&f.union(t,i,t)})),t},Object.defineProperty(e.prototype,"shadowCastingEnabled",{get:function(){return r.isSome(this.passes.shadowMap)},set:function(e){e?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenSpaceReflectionsEnabled",{get:function(){return r.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(e){this._materialPassParams.ssrParams.ssrEnabled=!!e},enumerable:!0,configurable:!0}),e.prototype._configureMaterialColorPass=function(e){var t=this;this._materialPassParams.shadowMap={bind:function(r,n){e.shadowMap.bind(r,n);var i=t._materialPassParams.viewTransform;s.vec3.add(m,i.worldFromView_TL,i.worldFromView_TH),e.shadowMap.bindView(r,m)}},this._materialPassParams.ambientOcclusion={bind:function(t,r){e.ssaoHelper.setUniforms(t,r)}},this._materialPassParams.ambientOcclusionEnabled=e.ssaoHelper.enabled,this._materialPassParams.sceneHasOcludees=e.hasOccludees},e.prototype._configure=function(e){var t=3===e.pass?this._shadowPassParams:4===e.pass?this._highlightPassParams:this._materialPassParams;this._updateParameters(e,t)},e.prototype._updateParameters=function(e,t){var r=e.camera,i=r.viewInverseTransposeMatrix;s.vec3.set(m,i[3],i[7],i[11]),g.set(m),s.vec3.copy(t.viewTransform.worldFromView_TH,g.high),s.vec3.copy(t.viewTransform.worldFromView_TL,g.low),n.mat3.fromMat4(t.viewTransform.viewFromCameraRelative_RS,r.viewMatrix),o.mat4.copy(t.viewTransform.projFromView,r.projectionMatrix),0===t.identifier?(this._materialPassParams.transparent=6===e.slot,this._materialPassParams.integratedMesh=1===e.slot,this._materialPassParams.lighting=e.scenelightingData,n.mat3.transpose(y,t.viewTransform.viewFromCameraRelative_RS),n.mat3.invert(t.transformNormal_ViewFromGlobal,y),a.vec2.set(t.cameraNearFar,r.near,r.far)):1===t.identifier?a.vec2.set(t.cameraNearFar,r.near,r.far):2===t.identifier&&(t.highlightDepthTexture=e.highlightDepthTexture,c.vec4.copy(t.viewport,r.fullViewport)),u.boundedPlane.copy(e.sliceHelper.plane,t.slicePlane),s.vec3.subtract(t.slicePlane.origin,t.slicePlane.origin,m),t.slicePlaneEnabled=e.sliceHelper.isEnabled},e.prototype._registerPass=function(e){return this._passes.push(e),e},Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this.passes.highlight.count>0||this.passes.highlightIntegratedMesh.count>0},enumerable:!0,configurable:!0}),e}();t.RenderPassManager=v;var m=l.vec3f64.create(),y=i.mat3f64.create(),g=new h.TwoVectorPosition}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(276),r(216),r(201),r(203),r(449)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});t.MaterialPassesParameters=function(){this.identifier=0,this.transparent=!1,this.integratedMesh=!1,this.viewTransform=new a.VertexPosition.ViewProjectionTransform,this.transformNormal_ViewFromGlobal=r.mat3f64.create(),this.cameraNearFar=n.vec2f64.create(),this.slicePlane=o.boundedPlane.create(),this.slicePlaneEnabled=!0,this.ambientOcclusionEnabled=!0,this.shadowsEnabled=!0,this.sceneHasOcludees=!1};t.ShadowMapPassParameters=function(){this.identifier=1,this.viewTransform=new a.VertexPosition.ViewProjectionTransform,this.cameraNearFar=n.vec2f64.create(),this.slicePlane=o.boundedPlane.create()};t.HighlightPassParameters=function(){this.identifier=2,this.viewTransform=new a.VertexPosition.ViewProjectionTransform,this.slicePlane=o.boundedPlane.create(),this.viewport=i.vec4f64.create()}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(214)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){void 0===n&&(n=0),this._rctx=e,this._techniqueRepository=t,this._sorting=n,this._draws=new r({initialSize:32,allocator:function(e){return e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}return e.prototype.submitDraw=function(e,t,r,n,i){var o=this._draws.pushNew();o.geometry=t,o.geometryRanges=r,o.material=e,o.bindDrawParams=n,o.depthSquaredHint=i,o.indexType=t.indexed?t.vao.indexBuffer.indexType:0},e.prototype.dispatch=function(e){var t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();for(var r=null,n={repository:this._techniqueRepository},o=this._draws.length,a=0;a<o;a++){var s=this._draws.data[a],l=s.geometry,c=s.material.getTechnique(n,e,l.parameters);if(this._passBoundTechniques.has(c)||(c.bindPass(t,e),this._passBoundTechniques.add(c)),t.bindVAO(l.vao),c!==r&&(t.bindProgram(c.program),t.setPipelineState(c.pipeline),r=c),this._previouslyBoundMaterials.get(c)!==s.material&&(c.bindMaterial(t,s.material,e),this._previouslyBoundMaterials.set(c,s.material)),this._previouslyBoundDraw.get(c)!==s.bindDrawParams&&(c.bindDraw(s.bindDrawParams,s.material,e),this._previouslyBoundMaterials.set(c,s.material)),0!==s.indexType)for(var u=i.get(s.indexType),p=0;p<s.geometryRanges.length;p+=2){var d=s.geometryRanges[p],h=s.geometryRanges[p+1];t.drawElements(l.primitiveType,h,s.indexType,d*u)}else for(p=0;p<s.geometryRanges.length;p+=2)d=s.geometryRanges[p],h=s.geometryRanges[p+1],t.drawArrays(l.primitiveType,d,h)}},e.prototype.prepareSubmit=function(){this._draws.clear()},e.prototype.finishSubmit=function(){var e=0===this._sorting?1:-1;this._draws.sort((function(t,r){var n=e*(t.depthSquaredHint-r.depthSquaredHint);return 0!==n?n:t.geometry.vao.size-r.geometry.vao.size}))},Object.defineProperty(e.prototype,"count",{get:function(){return this._draws.length},enumerable:!0,configurable:!0}),e}();t.RenderPass=n;var i=new Map;i.set(5121,1),i.set(5123,2),i.set(5125,4)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(416),r(1854),r(341)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this._rctx=e,this._techniqueRepository=t,this._techniques=new Set}return e.prototype.dispose=function(){var e=this;this._techniques.forEach((function(t){return e._techniqueRepository.release(t)})),this._techniques.clear(),r.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)},e.prototype.composite=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1),this.compositeInternal(e,t,r,0)},e.prototype.compositeSpecial=function(e,t){this.compositeInternal(e,0,1,t)},e.prototype.compositeInternal=function(e,t,r,n){var a=this._rctx;s.alphaMode=t,s.function=n,s.hasOpacityFactor=1!==r;var l=this._techniqueRepository.acquire(i.CompositingTechnique,s);a.bindProgram(l.program),l.bindPipelineState(a),l.program.setUniform1i("tex",1),s.hasOpacityFactor&&l.program.setUniform1f("opacity",r),a.bindTexture(e,1);var c=this.ensureVAO();a.bindVAO(c),a.drawArrays(5,0,o.vertexCount(c,"geometry")),a.bindVAO(null),this._techniqueRepository.release(l)},e.prototype.ensureVAO=function(){return r.isNone(this._vao)&&(this._vao=n.createQuadVAO(this._rctx)),this._vao},e}();t.default=a;var s=new i.CompositingTechniqueConfiguration}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(253),r(257),r(260),r(228),r(1290),r(242),r(217),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build(this.configuration);return new c(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),s.Default3D)},t.prototype.initializePipeline=function(){if(2===this.configuration.function)return p.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return p.makePipelineState({colorWrite:p.defaultColorWriteParams});case 1:return p.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),colorWrite:p.defaultColorWriteParams});default:return p.makePipelineState({blending:u.simpleBlendingParams(1,771),colorWrite:p.defaultColorWriteParams})}},t.shader=new i.ReloadableShaderModule(l,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1290)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.CompositingTechnique=d;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.function=0,t.alphaMode=0,t.hasOpacityFactor=!1,t}return n.__extends(t,e),n.__decorate([a.parameter({count:3})],t.prototype,"function",void 0),n.__decorate([a.parameter({count:3})],t.prototype,"alphaMode",void 0),n.__decorate([a.parameter()],t.prototype,"hasOpacityFactor",void 0),t}(a.ShaderTechniqueConfiguration);t.CompositingTechniqueConfiguration=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(177),r(167),r(210),r(152),r(1856),r(157),r(189),r(185),r(216),r(261),r(805),r(1210),r(288),r(667),r(1857),r(1858),r(416),r(1859),r(344),r(1861),r(1222),r(1223),r(1863),r(931),r(1864),r(1865),r(1866),r(1867),r(1870),r(1226),r(652),r(1886)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A,E,I,R,D){var L=function(){function e(e,t,r,i,o,a,l){var c=this;this._materialRep=e,this._rctx=i,this._compositingHelper=o,this.requestRender=a,this._stage=l,this._materialRenderers=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._lighting=new I.SceneLighting,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._stats=new T.RenderStatsAggregator,this._antialiasing=1,this._edgeView=null,this._handles=new n,this._cameraPrevious=new f.default,this._cameraCurrent=new f.default,this.renderHiddenTransparentEdges=function(){},this._shaderTechniqueRepository=r,this._fxaaPass=new y(this._rctx),this._smaaPass=new M(this._rctx),this._bindParameters={slot:null,view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1},this._offscreenRendering=new x(this._rctx,this._compositingHelper),this._sliceHelper=new C,this._shadowMap=new O(this._rctx,r.viewingMode),this._ssaoHelper=new A(r,this._rctx,(function(){return c.requestRender()})),this._highlightHelper=new _(r,this._rctx),this._renderPlugins=new P.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:r,textureRep:t,materialRep:this._materialRep,requestRender:this.requestRender}),this._renderContext=new w(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.ssrParams={nearFar:null,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1},this._handles.add(s.init(p,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",(function(e){c.renderHiddenTransparentEdges=e?function(){return c.renderEdges(1)}:function(){},c.requestRender()})))}return e.prototype.dispose=function(){this._handles.destroy(),this._fxaaPass.disable(),this._smaaPass.disable(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers=null,this._edgeView&&(this._edgeView.destroy(),this._edgeView=null),this._offscreenRendering.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose()),this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose()),this._highlightHelper&&(this._highlightHelper.enabled=!1),h.tmpIndices.prune(),this._content.clear(),this._content=null},Object.defineProperty(e.prototype,"updating",{get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.ensureEdgeView=function(){var e=this;return null==this._edgeView&&(this._edgeView=new E.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:function(){return e.requestRender()}}),this._edgeView.initialize()),this._edgeView},Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._shadowMap.maxCascades=e.shadowMapMaxCascades),this._highlightHelper.enabled=!0,void 0!==e.ssao&&(this._ssaoHelper.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._ssaoHelper.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._ssaoHelper.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._ssaoHelper.samples=e.ssaoSamples),e.background&&(this._offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._antialiasing=e.antialiasingEnabled?1:0),void 0!==e.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._sliceHelper.plane=o.unwrap(e.slicePlane)),void 0!==e.waterReflectionEnabled&&(this._waterReflectionEnabled=this._rctx.parameters.maxTextureImageUnits>=10&&e.waterReflectionEnabled),this.requestRender()},Object.defineProperty(e.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0}),e.prototype.getRenderParams=function(){var e={};return this._shadowMap&&(e.shadowMap=this._shadowMap.enabled,e.shadowMapMaxCascades=this._shadowMap.maxCascades),this._ssaoHelper&&this._ssaoHelper.isSupported&&(e.ssao=this._ssaoHelper.enabled,e.ssaoAttenuation=this._ssaoHelper.attenuation,e.ssaoRadius=this._ssaoHelper.radius,e.ssaoFilterRadius=this._ssaoHelper.filterRadius,e.ssaoSamples=this._ssaoHelper.samples),this._waterReflectionEnabled&&(e.waterReflectionEnabled=this._waterReflectionEnabled),e},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRender",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getStats=function(){return this._stats.getAggregatedStats()},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._offscreenRendering.colorTexture;case"hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case"linearDepth":return this._offscreenRendering.linearDepthTexture;case"normals":return this._offscreenRendering.normalTexture;case"highlight":return this._offscreenRendering.highlightTexture;default:return r.neverReached(e),null}},e.prototype.isEmpty=function(){return 0===this._materialRenderers.size},e.prototype.modify=function(e,t,r,n,o,a){var s=this;void 0===t&&(t=e?e.length:0),void 0===n&&(n=r?r.length:0),void 0===a&&(a=o?o.length:0),this._isRendering&&console.warn("Renderer.modify called while rendering");for(var l=0;l<n;++l)this._content.delete(r[l].uniqueName);for(l=0;l<t;++l)this._content.set(e[l].uniqueName,e[l]);if(t||n||a){var c=S.splitRenderGeometryChangeSetByMaterial({toAdd:e,numToAdd:t,toRemove:r,numToRemove:n,toUpdate:o,numToUpdate:a}),u=!1;c.forEach((function(e,t){var r=s._materialRenderers.get(t);!r&&e.toAdd.length>0&&(r=t.createRenderer(s._rctx,s._materialRep),s._materialRenderers.set(t,r)),r&&(r.modify(e),r.isEmpty&&(u=!0))})),u&&this._materialRenderers.forEach((function(e,t){e.isEmpty&&(s._materialRenderers.delete(t),e.dispose())})),this._hasHighlights=i.someMap(this._materialRenderers,(function(e){return e.hasHighlights})),this._hasOccludees=i.someMap(this._materialRenderers,(function(e){return e.hasOccludees})),this._hasWater=i.someMap(this._materialRenderers,(function(e){return e.hasWater})),this.requestRender()}},e.prototype.updateLogic=function(e){var t=!1;return this._materialRenderers.forEach((function(r){r.updateLogic&&(t=r.updateLogic(e)||t)})),t},e.prototype.render=function(e){this.renderScene(e),this.onPostRender&&this.onPostRender()},e.prototype.renderScene=function(e){var t=this;this._isRendering=!0;var r=this._rctx,n=this._offscreenRendering,i=e.camera,o=e.fbo;n.needLastFrameColorTexture=this._waterReflectionEnabled,n.advanceCurrentRenderTarget(),this._waterReflectionEnabled?this.setBindParametersSSR(i):this.removeBindParametersSSR();var a=this._sliceHelper.plane;e.disableSlice&&(this._sliceHelper.plane=null),this._renderPlugins.prepareRender(i),this.renderShadowMap(e),n.enabled=!0,n.initializeFrame(i),this.renderLinearDepth(i),this.renderNormal(i),this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(i,n.linearDepthTexture,n.normalTexture),this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository),this._stats.reset(),this.updateGlobalUniforms(i.projectionMatrix),this._renderContext.pass=0,this._renderContext.camera=i,this._renderContext.hasOccludees=this._hasOccludees,n.bindFramebuffer(),this._renderPlugins.render(0,this._renderContext),this.renderOpaqueGeometry(this._renderContext),this.renderEdges(2),this.renderHiddenTransparentEdges(),this.renderTransparentGeometry(this._renderContext),this.renderEdges(1);var s={hudVisibility:!1,transparentTerrain:!1};s.hudVisibility=this.renderHUDVisibility(this._renderContext),this.renderInternalSlot(20,this._renderContext),s.transparentTerrain=this.renderTransparentTerrain(this._renderContext),s.transparentTerrain&&s.hudVisibility&&(n.compositeTransparentTerrainOntoHUDVisibility(),n.renderToTargets((function(){return t.renderHUD(d.HUD.TransparentRenderStyle.OCCLUDED)}),n.currentColorTarget,n.tmpDepth,void 0,!0,!0)),s.transparentTerrain&&n.compositeTransparentTerrainOntoMain(),n.renderToTargets((function(){t.renderInternalSlot(8,t._renderContext),t._renderPlugins.render(15,t._renderContext),t._renderPlugins.render(16,t._renderContext)}),n.currentColorTarget,n.mainDepth),this._renderPlugins.needsLaserlineWithContrastControl&&n.renderAndComposite((function(){t._renderPlugins.render(17,t._renderContext)}),2),this.renderOccluded(),this.renderAntiAliasing(o,this._antialiasing),r.bindFramebuffer(o),r.clearSafe(256),this.renderHUD(d.HUD.TransparentRenderStyle.NOTOCCLUDED),this.renderHighlights(i,o),this._sliceHelper.plane=a,this._isRendering=!1},e.prototype.renderEdges=function(e){var t=this,r=this._edgeView;r&&r.shouldRender()&&this._offscreenRendering.renderAndComposite((function(){return r.render(t._bindParameters,e)}),1)},e.prototype.renderShadowMap=function(e){var t=this._shadowMap;if(t.enabled){p.ENABLE_PROFILE_DEPTH_RANGE&&a.begin("depthRange");var r=e.camera,n=e.fbo,i=e.lightDirection,o=this.computeDepthRange(r);p.ENABLE_PROFILE_DEPTH_RANGE&&a.end("depthRange"),t.prepare(r,i,o);for(var s=t.getCascades(),l=0;l<s.length;++l){var c=s[l];c.camera.setGLViewport(this._rctx),this.renderGeometryPass(3,c.camera)}e.camera=r,t.finish(n),r.setGLViewport(this._rctx)}t.bindToAllPrograms(this._shaderTechniqueRepository)},e.prototype.renderLinearDepth=function(e){var t=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled?this._offscreenRendering.renderToTargets((function(){return t.renderGeometryPass(1,e)}),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)},e.prototype.renderNormal=function(e){var t=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets((function(){t.renderGeometryPass(2,e)}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)},e.prototype.computeDepthRange=function(e){var t=m.depthRangeFromScene(e,this._content,this._stage.getLayers());return v.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e.prototype.renderGeometryPass=function(e,t){this.updateGlobalUniforms(t.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=t,this.renderOpaqueGeometry(this._renderContext),this.renderTransparentGeometry(this._renderContext),this.renderTransparentTerrain(this._renderContext)},e.prototype.renderOpaqueGeometry=function(e){this._renderPlugins.render(1,e),this._renderPlugins.render(2,e),this.renderInternalSlot(3,e),this._renderPlugins.render(4,e),e.ssaoHelper&&e.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository),this._renderPlugins.render(14,this._renderContext)},e.prototype.renderTransparentGeometry=function(e){this.renderInternalSlot(5,e),this._renderPlugins.render(6,e),e.ssaoHelper&&e.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(7,e)},e.prototype.renderHUDVisibility=function(e){var t=this,r=R.default.shouldRenderVisibilityDuringRenderPass(e.pass),n=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,i=!1;return r&&n&&e.offscreenRenderingHelper.renderHUDVisibility((function(){i=t.renderInternalSlot(12,e)})),i},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(21,this._renderContext),this.renderInternalSlot(18,this._renderContext),this.renderInternalSlot(19,this._renderContext)},e.prototype.renderHighlights=function(e,t){var r=this,n=this._highlightHelper;if(n&&n.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight)){var i=null;n.profilingCallback&&(i=D.startMeasurement(this._renderContext.rctx));var o=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;var a=o.renderToTargets((function(){r.renderGeometryPass(4,e),r._rctx.clearSafe(256),r.renderHUD(d.HUD.TransparentRenderStyle.BOTH)}),o.highlight,o.tmpDepth,[0,0,0,0],!0,!0);n.render(e,a,t),null!==i&&n.profilingCallback&&i.stop((function(e){n.profilingCallback&&n.profilingCallback(e)}))}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)},e.prototype.renderOccluded=function(){var e=this,t=0;this._materialRenderers.forEach((function(e,r){r&&r.isVisible()&&8===r.renderOccluded&&(t|=r.renderOccluded,N.push(r))}));var r=this._offscreenRendering,n=this._renderContext,i=function(e,n,i,o,s){void 0===i&&(i=function(){return a(n)}),void 0===o&&(o=!0),void 0===s&&(s=!0),0!=(t&n)&&(r.renderToTargets(i,r.tmpColor,r.mainDepth,[0,0,0,0],o,s),r.compositeOccludedOntoMain(e))};0!==N.length&&(this.renderInternalSlot(10,n,N),i(.2,8,(function(){return e.renderInternalSlot(11,n,N)}),!1,!1),N.length=0),this._materialRenderers.forEach((function(e,r){r&&r.isVisible()&&(4===r.renderOccluded||2===r.renderOccluded||32===r.renderOccluded||16===r.renderOccluded)&&(t|=r.renderOccluded,F.push(r))}));var o=this._renderPlugins.renderOccludedFlags;if(t|=o){var a=function(t){n.renderOccludedMask=t,o>1&&e._renderPlugins.render(9,n),e.renderInternalSlot(3,n,F),e.renderInternalSlot(5,n,F),e.renderInternalSlot(8,n,F),n.resetRenderOccludedMask()};n.pass=0,i(.5,4,(function(){return a(4)}),!0,2),i(.5,2,(function(){return a(2)}),!0,2),i(1,48,(function(){a(16),a(32)}),!0,2),F.length=0}},e.prototype.renderAntiAliasing=function(e,t){var r=this;switch(t){case 1:this._smaaPass.loadResources((function(){return r.requestRender()})),this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},e)):(this._rctx.bindFramebuffer(e),this._offscreenRendering.composite());break;case 2:this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},e)):(this._rctx.bindFramebuffer(e),this._offscreenRendering.composite());break;default:this._rctx.bindFramebuffer(e),this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}},e.prototype.renderInternalSlot=function(e,t,r){this._bindParameters.slot=e,this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,j[0]=t.camera.near,j[1]=t.camera.far;var n=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=j,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.camera.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hasOccludees=t.hasOccludees,this._bindParameters.linearDepthTextureID=3,this._bindParameters.lastFrameColorTextureID=4,this._bindParameters.hudVisibilityTexture=n?n.hudVisibilityTexture:null,this._bindParameters.highlightDepthTexture=n&&n.depthTexture||this.getFallbackDepthTexture(),this.renderInternalSlotMaterials(e,t,r)},e.prototype.renderInternalSlotMaterials=function(e,t,r){var n=this,i=0===t.pass?this._stats:null,a=!1;return o.isSome(r)?r.forEach((function(r){if(b.materialPredicate(r,t)){var i=n._materialRenderers.get(r);o.isSome(i)&&(a=i.render(e,t,n._bindParameters)||a)}})):this._materialRenderers.forEach((function(r,o){if(b.materialPredicate(o,t)){var s=i?i.getMaterialRenderStatsObject(r.type):null;a=r.render(e,t,n._bindParameters,s)||a}})),a},e.prototype.updateGlobalUniforms=function(e){for(var t=this._shaderTechniqueRepository.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting)for(t=this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection"),r=0;r<t.length;r++)this._lighting.setUniforms(t[r])},e.prototype.getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=g.createEmptyDepthTexture(this._rctx)),this._fallbackDepthStencilTexture},e.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}},Object.defineProperty(e.prototype,"test",{get:function(){return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,materialRenderers:this._materialRenderers}},enumerable:!0,configurable:!0}),e.prototype.setBindParametersSSR=function(e){this._cameraCurrent.copyFrom(e),this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture,l.mat4.translate(k,this._cameraPrevious.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),l.mat4.translate(U,this._cameraCurrent.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),l.mat4.invert(U,U),l.mat4.invert(z,this._cameraCurrent.projectionMatrix),l.mat4.multiply(B,U,z),l.mat4.multiply(B,k,B),l.mat4.multiply(B,this._cameraPrevious.projectionMatrix,B),this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=B,this._renderContext.ssrParams.ssrViewMat=this._bindParameters.ssrViewMat=e.viewMatrix,this._renderContext.ssrParams.rpProjectionMat=this._bindParameters.rpProjectionMat=e.projectionMatrix,V[0]=e.near,V[1]=e.far,this._renderContext.ssrParams.nearFar=V,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=!0,this._cameraPrevious.copyFrom(this._cameraCurrent)},e.prototype.removeBindParametersSSR=function(){this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=!1},e}(),j=u.vec2f64.create(),V=u.vec2f64.create(),F=[],N=[],k=c.mat4f64.create(),z=c.mat4f64.create(),U=c.mat4f64.create(),B=c.mat4f64.create();return L}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){var t={},r={};function n(r){return r in t||(t[r]=new e(r)),t[r]}function i(e){console.log(n(e).toJSON())}e.get=n,e.begin=function(e){n(e).begin()},e.end=function(e,t){void 0===t&&(t=!0),n(e).end();var o=performance.now();!t||e in r&&!(o>=r[e]+1e3)||(i(e),r[e]=o)},e.log=i,e.logAll=function(){for(var e in t)i(e)}}(r||(r={})),r}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(214),r(189),r(185),r(162),r(160),r(245),r(201),r(203),r(251),r(667),r(195)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d){function h(e,t){if(t.isVisible){var r=p.empty(),n=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var n=t.eye,i=t.viewForward,o=t.frustum,a=function(e){return e.isVisible},s=r.objectCount;if(s<500)p.set(w,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(n,i,"front-to-back",w,(function(r,n){f(e,t,r),w.far=e.near,n.setRange(w)}),o,a),p.set(w,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(n,i,"back-to-front",w,(function(r,n){f(e,t,r),w.near=e.far,n.setRange(w)}),o,a);else{var l=Math.max(Math.min(s,500),Math.ceil(.1*s)),c=r.findClosest(i,"front-to-back",o,a,l),u=r.findClosest(i,"back-to-front",o,a,l);c&&u&&(v(e,t,c.getCenter(),c.getBSRadius()),v(e,t,u.getCenter(),u.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){S.clear(),r.forEach((function(e){e.isVisible&&S.add(e)})),S.empty||(S.sort(t),p.set(w,t.near,Math.min(e.near,t.far)),S.forEachInDepthRange(w,"front-to-back",(function(r,n){n<e.near&&f(e,t,r)})),p.set(w,Math.max(e.far,t.near),t.far),S.forEachInDepthRange(w,"back-to-front",(function(t,r,n){e.far=Math.max(e.far,n)})))}(r,e,n),r}}function f(e,t,r){if(r.isVisible&&c.frustum.intersectsSphere(t.frustum.planes,c.sphere.wrap(r.getBSRadius(),r.getCenter()))){var i=r.objectTransformation,a=x;r.geometryRecords.forEach((function(r){n.mat4.multiply(a,i,r.getShaderTransformation());var s=u.maxScale(a);!function e(t,r,n,i,a){var s=r.eye,l=r.viewForward;o.vec3.transformMat4(b,n.center,i);var u=l[0]*(b[0]-s[0])+l[1]*(b[1]-s[1])+l[2]*(b[2]-s[2]),p=n.bsRadius*a;if(!(u-p>t.near&&u+p<t.far)&&c.frustum.intersectsSphere(r.frustum.planes,c.sphere.wrap(p,b)))if(n.bsRadius>100&&n.getChildren())for(var d=n.getChildren(),h=0;h<8;++h)d[h]&&e(t,r,d[h],i,a);else T.unionDepthRangeWithAABB(t,r.viewProjectionMatrix,i,n.bbMin,n.bbMax)}(e,t,r.geometry.boundingInfo,a,s)}))}}function v(e,t,r,n){var i=t.eye,o=t.viewForward,a=(r[0]-i[0])*o[0]+(r[1]-i[1])*o[1]+(r[2]-i[2])*o[2];e.near=Math.min(e.near,a-n),e.far=Math.max(e.far,a+n)}Object.defineProperty(t,"__esModule",{value:!0}),t.depthRangeFromScene=function(e,t,r){if(t.size<1e4)return P.compute(e,t);var n=p.empty();return r.forEach((function(t){t.isVisible&&p.union(n,h(e,t))})),n},t.depthRangeFromLayer=h;var m=function(){function e(){this._items=new r({allocator:function(e){return e||{obj:null,distance:0,near:0,far:0}},deallocator:function(e){return e.obj=null,e.distance=0,e.near=0,e.far=0,e}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach((function(e){var n=e.obj,i=n.getCenter(),o=n.getBSRadius(),a=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=a,e.near=a-o,e.far=a+o})),this._items.sort((function(e,t){return e.distance-t.distance}))},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var n=0;n<this._items.length;++n)(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far);else for(n=this._items.length-1;n>=0;--n){var i;(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}},e}(),y=function(){function e(){this.view=i.mat4f64.create(),this.viewProj=i.mat4f64.create(),this.frustum=c.frustum.create(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),n.mat4.copy(this.view,e.viewMatrix),n.mat4.multiply(this.viewProj,e.projectionMatrix,this.view),c.frustum.copy(e.frustum,this.frustum);var i=this.view,o=i[2],a=i[6],s=i[10],l=i[14],u=this.range,p=0;if(t.forEach((function(e){if(e.instanceParameters.visible&&e.castShadow){var t,n;e.hasShaderTransformation?(t=e.getBoundingSphere(e.getShaderTransformation(),1,b),n=b):(t=e.bsRadius,n=e.center);var i=o*n[0]+a*n[1]+s*n[2]+l,c=i-t,u=i+t;r.geometries[p]=e,r.near[p]=-u,r.far[p]=-c,++p}})),0===this.geometries.length)return u;for(var d=0;d<this.geometries.length;++d)this.near[d]>u.far&&(u.far=this.near[d]),this.near[d]>2&&this.far[d]<u.near&&(u.near=this.far[d]);var h=this.looseRange;h.near=Math.max(.5*u.near,2),h.far=2*u.far;var f=0,v=0;for(d=0;d<this.geometries.length;++d)this.near[d]<u.near&&(this.near[d]>=h.near?u.near=this.near[d]:this.nearCandidates[f++]=d),this.far[d]>u.far&&(this.far[d]<=h.far?u.far=this.far[d]:this.farCandidates[v++]=d);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return u;for(this.nearCandidates.sort((function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0})),this.farCandidates.sort((function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0})),d=0;d<this.nearCandidates.length;++d){var m=this.nearCandidates[d];if(this.near[m]<u.near){var y=(g=this.geometries[m]).boundingInfo;this.includeNearBoundingInfoRec(y,g.getShaderTransformation())}}for(d=0;d<this.farCandidates.length;++d){var g;if(m=this.farCandidates[d],this.far[m]>u.far)y=(g=this.geometries[m]).boundingInfo,this.includeFarBoundingInfoRec(y,g.getShaderTransformation())}return u},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();o.vec3.transformMat4(b,n,t);var i=u.maxScale(t),a=b[0],s=b[1],l=b[2];r*=i;var c=this.frustum.planes;if(!(c[0][0]*a+c[0][1]*s+c[0][2]*l+c[0][3]>r||c[1][0]*a+c[1][1]*s+c[1][2]*l+c[1][3]>r||c[2][0]*a+c[2][1]*s+c[2][2]*l+c[2][3]>r||c[3][0]*a+c[3][1]*s+c[3][2]*l+c[3][3]>r)){var p=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14],d=p+r;if(!(-(p-r)<2||-d>=this.range.near))if(-d>this.looseRange.near)this.range.near=-d;else{if(r>100){var h=e.getChildren();if(void 0!==h){for(var f=0;f<8;++f)void 0!==h[f]&&this.includeNearBoundingInfoRec(h[f],t);return}}T.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();o.vec3.transformMat4(b,n,t);var i=u.maxScale(t),a=b[0],s=b[1],l=b[2];r*=i;var c=this.frustum.planes;if(!(c[0][0]*a+c[0][1]*s+c[0][2]*l+c[0][3]>r||c[1][0]*a+c[1][1]*s+c[1][2]*l+c[1][3]>r||c[2][0]*a+c[2][1]*s+c[2][2]*l+c[2][3]>r||c[3][0]*a+c[3][1]*s+c[3][2]*l+c[3][3]>r)){var p=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14]-r;if(!(-p<=this.range.far))if(-p<this.looseRange.far)this.range.far=-p;else{if(r>100){var d=e.getChildren();if(void 0!==d){for(var h=0;h<8;++h)void 0!==d[h]&&this.includeFarBoundingInfoRec(d[h],t);return}}T.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var g=function(){function e(){this.modelViewProj=i.mat4f64.create(),this.clipPosition=[l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,i,o){var a=this.modelViewProj;n.mat4.multiply(a,t,r);for(var s=!1,l=0;l<8;++l){var c=this.clipPosition[l],u=0===l||3===l||4===l||7===l?i[0]:o[0],p=0===l||1===l||4===l||5===l?i[1]:o[1],d=l<4?i[2]:o[2];c[0]=a[0]*u+a[4]*p+a[8]*d+a[12],c[1]=a[1]*u+a[5]*p+a[9]*d+a[13],c[2]=a[2]*u+a[6]*p+a[10]*d+a[14],c[3]=a[3]*u+a[7]*p+a[11]*d+a[15]}for(l=0;l<12;++l){for(var h=this.clipPosition[_[l][0]],f=this.clipPosition[_[l][1]],v=this.clipPosition[_[l][2]],m=this.clipTriangle(h,f,v),y=!0,g=0;g<m.length;++g)if((b=m[g][3])>=2){y=!1;break}if(!y)for(s=!0,g=0;g<m.length;++g){var b;(b=m[g][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void d.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),s.vec4.lerp(l.vec4f64.create(),e,t,n)},e.prototype.clipTriangle=function(e,t,r){for(var n=[e,t,r],i=0;i<4;++i){var o=n;n=[];for(var a=0;a<o.length;++a){var s=o[a],l=o[(a+1)%o.length];this.inside(l,i)?(this.inside(s,i)||n.push(this.intersect(s,l,i)),n.push(l)):this.inside(s,i)&&n.push(this.intersect(s,l,i))}}return n},e}(),_=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],b=a.vec3f64.create(),x=i.mat4f64.create(),w=p.empty(),S=new m,P=new y,T=new g}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(796),r(307),r(242),r(217),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.rctx=e}return e.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new o(e,c.shader.vertex,c.shader.fragment,this.vertexAttributeLocations),this.pipelineState=a.makePipelineState({colorWrite:a.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new s(e,this.vertexAttributeLocations,{geometry:n.Pos2},{geometry:new i(e,34962,35044,t)}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var n=this.rctx;n.bindVAO(this.vao),n.bindFramebuffer(t);var i={x:0,y:0,width:0,height:0};r.isSome(t)?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=n.gl.canvas.width,i.height=n.gl.canvas.height),n.bindProgram(this.program),n.setPipelineState(this.pipelineState),n.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/i.width,1/i.height),n.drawArrays(4,0,3)},e}(),c={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return l}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(245),r(374),r(201),r(261),r(228),r(796),r(416),r(195),r(1860),r(307),r(392),r(341),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=i.vec4f64.create(),this.defaultOptions={color:n.vec4f32.fromValues(1,0,1,1),haloColor:n.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};var r=new u.HighlightCompositionTechniqueConfiguration,o=function(t,r){return e.acquireAndReleaseExisting(u.HighlightCompositionTechnique,t,r)};r.highlightStage=0,r.gridOptimization=!1,this.blurTechnique=o(r,this.blurTechnique),r.highlightStage=0,r.gridOptimization=!0,this.blurGridTechnique=o(r,this.blurGridTechnique),r.highlightStage=1,r.gridOptimization=!1,this.applyTechnique=o(r,this.applyTechnique),r.highlightStage=1,r.gridOptimization=!0,this.applyGridTechnique=o(r,this.applyGridTechnique),r.highlightStage=2,r.gridOptimization=!1,this.downsampleTechnique=o(r,this.downsampleTechnique)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return o.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t,n){var i=e.pixelRatio,a=!o.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,s=this._rctx;c.assert(this.enabled),r.vec4.copy(this.viewportToRestore,e.fullViewport);var l=e.fullWidth,u=e.fullHeight,p=Math.ceil(l/i),d=Math.ceil(u/i);this.blur0Fbo.resize(p,d),this.blur1Fbo.resize(p,d),s.bindVAO(this.quadVAO);var f=null,v=null;a&&(this._gridUpdateResources(t,32),this._gridComputeMipmap()),a?(f=this._grid.vao,v=this.blurGridTechnique,s.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),v.program.setUniform1i("coverageTex",1)):(f=this.quadVAO,v=this.blurTechnique),v.bindPipelineState(s),s.bindProgram(v.program),s.bindVAO(f),s.bindFramebuffer(this.blur0Fbo),s.setViewport(0,0,p,d),s.setClearColor(0,0,0,0),s.clear(16384),v.program.setUniform1i("tex",0),s.bindTexture(t.colorTexture,0),v.program.setUniform2f("blurSize",1/p,0),s.drawArrays(v.primitiveType,0,h.vertexCount(f,"geometry")),s.bindFramebuffer(this.blur1Fbo),s.clear(16384),s.bindTexture(this.blur0Fbo.colorTexture,0),v.program.setUniform2f("blurSize",0,1/d),s.drawArrays(v.primitiveType,0,h.vertexCount(f,"geometry"));var m=a?this.applyGridTechnique:this.applyTechnique;if(s.bindFramebuffer(n),m.bindPipelineState(s),s.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),s.bindProgram(m.program),s.bindTexture(this.blur1Fbo.colorTexture,0),s.bindTexture(t.colorTexture,1),a){var y=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;s.bindTexture(y,2)}m.bindApplyPass(this.defaultOptions),s.drawArrays(m.primitiveType,0,h.vertexCount(f,"geometry")),s.bindVAO(null)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=l.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new d(this._rctx,e,t),this.blur1Fbo=new d(this._rctx,e,t)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,n=this._grid,i=!1;if(null===n.coverageMipmap&&(n.coverageMipmap=[e],i=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(i=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==t&&(n.cellPixelSize=t,i=!0),i){for(var o=1;o<n.coverageMipmap.length;o++)n.coverageMipmap[o].dispose();for(n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1,o=0;o<n.mipmapLevels;o++){var l=n.coverageMipmap[o],c={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},u={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},h=new d(r,u,c);n.coverageMipmap[o+1]=h}}var v=Math.ceil(e.height/n.cellPixelSize),m=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==v||n.horizontalCellCount!==m){n.verticalCellCount=v,n.horizontalCellCount=m;for(var y=v+1,g=m+1,_=1/v,b=1/m,x=new Float32Array(24*y*g),w=0,S=0;S<y;S++)for(var P=0;P<g;P++)x[w+0]=(P-.5)*b*2-1,x[w+1]=(S-.5)*_*2-1,x[w+2]=P*b,x[w+3]=S*_,x[w+4]=(P+.5)*b*2-1,x[w+5]=(S-.5)*_*2-1,x[w+6]=P*b,x[w+7]=S*_,x[w+8]=(P-.5)*b*2-1,x[w+9]=(S+.5)*_*2-1,x[w+10]=P*b,x[w+11]=S*_,x[w+12]=(P-.5)*b*2-1,x[w+13]=(S+.5)*_*2-1,x[w+14]=P*b,x[w+15]=S*_,x[w+16]=(P+.5)*b*2-1,x[w+17]=(S-.5)*_*2-1,x[w+18]=P*b,x[w+19]=S*_,x[w+20]=(P+.5)*b*2-1,x[w+21]=(S+.5)*_*2-1,x[w+22]=P*b,x[w+23]=S*_,w+=24;n.vao&&n.vao.dispose(!0),n.vao=new f(r,a.Default3D,{geometry:s.Pos2Tex},{geometry:p.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(e),e.bindVAO(this.quadVAO);for(var n=0;n<t.mipmapLevels;n++){e.bindFramebuffer(t.coverageMipmap[n+1]),e.bindTexture(t.coverageMipmap[n].colorTexture,0);var i=t.coverageMipmap[n+1].width,o=t.coverageMipmap[n+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/i,1/o),e.setViewport(0,0,i,o),e.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"))}},e.prototype.getGpuMemoryUsage=function(){var e=h.getGpuMemoryUsage(this.blur0Fbo)+h.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var t=0,r=this._grid.coverageMipmap;t<r.length;t++){var n=r[t];e+=h.getGpuMemoryUsage(n)}return e},Object.defineProperty(e.prototype,"test",{get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(253),r(257),r(260),r(228),r(1291),r(242),r(217),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get().build(this.configuration);return new c(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),s.Default3D)},t.prototype.bindApplyPass=function(e){this.program.setUniform1i("tex",0),this.program.setUniform1i("origin",1),this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",2),this.program.setUniform4fv("color",e.color),this.program.setUniform4fv("haloColor",e.haloColor),this.program.setUniform1f("outlineSize",8.6),this.program.setUniform1f("blurSize",.4),this.program.setUniform4f("opacities",e.haloOpacity,e.haloOpacityOccluded,e.fillOpacity,e.fillOpacityOccluded)},t.prototype.initializePipeline=function(){return 1===this.configuration.highlightStage?p.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),colorWrite:p.defaultColorWriteParams}):p.makePipelineState({colorWrite:p.defaultColorWriteParams})},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return this.configuration.gridOptimization?4:5},enumerable:!0,configurable:!0}),t.shader=new i.ReloadableShaderModule(l,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1291)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.HighlightCompositionTechnique=d;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.highlightStage=0,t.gridOptimization=!1,t}return n.__extends(t,e),n.__decorate([a.parameter({count:3})],t.prototype,"highlightStage",void 0),n.__decorate([a.parameter()],t.prototype,"gridOptimization",void 0),t}(a.ShaderTechniqueConfiguration);t.HighlightCompositionTechniqueConfiguration=h}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1862),r(195)],void 0===(i=function(e,t,r,n){var i=function(){function e(e,t){this._rctx=e,this._compositingHelper=t,this._currentRenderTarget=0,this.dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._enabled=!1,this._background={type:"color",color:[0,0,0,1]};var n=this._rctx;this.renderTargetHelper=new r.RenderTargetHelper(n);var i=this.renderTargetHelper;this.mainColorTarget0=i.registerColorTarget({name:"mainColorTarget0"}),this.mainColorTarget1=i.registerColorTarget({name:"mainColorTarget1"}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:9728}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",dataType:32819}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"})}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentRenderTarget",{get:function(){return this._currentRenderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.currentColorTarget,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastFrameColorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mainColorTexture",{get:function(){return this.getColorTexture(this.currentColorTarget)},enumerable:!0,configurable:!0}),e.prototype.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0},e.prototype.initializeFrame=function(e){n.assert(this.enabled);var t=this._rctx;this.dimensions.width=e.fullWidth,this.dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);var r=this._background.color;t.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),t.clearSafe(17664)},e.prototype.composite=function(){this._compositingHelper.composite(this.colorTexture,0)},e.prototype.renderAndComposite=function(e,t){this.renderToTargets(e,this.tmpColor,this.mainDepth,o),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),t)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,a)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this;this.renderToTargets((function(){e._compositingHelper.compositeSpecial(e.getColorTexture(e.tmpColor),2)}),this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)},e.prototype.compositeOccludedOntoMain=function(e){this.bindFramebuffer(),this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){e(this.bindTarget(this.currentColorTarget)),this.bindTarget(this.currentColorTarget,this.mainDepth)},e.prototype.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)},e.prototype.enable=function(){this.enabled||(this._enabled=!0)},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.dispose())},Object.defineProperty(e.prototype,"needLastFrameColorTexture",{get:function(){return this._needLastFrameColorTexture},set:function(e){!e&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1)),this._needLastFrameColorTexture=e},enumerable:!0,configurable:!0}),e.prototype.renderToTargets=function(e,t,r,n,i,o){var a=this._rctx,s=this.bindTarget(t,r),l=0;if(n){var c=Math.max(1e-13,n[3]);a.setClearColor(n[0],n[1],n[2],c),l|=16384}return i&&(l|=256),o&&(l|=1024),a.clearSafe(l,!0===o?255:!1===o?0:o),e(s),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),s},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);return this._rctx.bindFramebuffer(r),r},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e.prototype.getGpuMemoryUsage=function(){var e=0;return this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage()),e},e}(),o=[0,0,0,0],a=[0,1,0,1];return i}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(392),r(947),r(299),r(341)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s={dataType:5121},l={},c=function(){function e(e){this.rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this._nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.dispose=function(){this._depthBuffers.forEach((function(e){return e.dispose()})),this._depthBuffers.clear(),this._depthTextures.forEach((function(e){return e.dispose()})),this._depthTextures.clear(),this._colorTextures.forEach((function(e){return e.dispose()})),this._colorTextures.clear(),this._framebuffers.forEach((function(e){return e.dispose()})),this._framebuffers.clear()},e.prototype.disposeTargetResource=function(e){var t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this._depthTextures.has(t)&&(this._depthTextures.get(t).dispose(),this._depthTextures.delete(t)),this._depthBuffers.has(t)&&(this._depthBuffers.get(t).dispose(),this._depthBuffers.delete(t)),this._colorTextures.has(t)&&(this._colorTextures.get(t).dispose(),this._colorTextures.delete(t)))},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this._depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}},e.prototype.getAllocatedDepthTexture=function(e){return this._depthTextures.get(e.id)},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var n=this._depthBuffers.get(e.id);return n?n.descriptor.width===t.width&&n.descriptor.height===t.height||n.resize(t.width,t.height):(n=new i(this.rctx,r.__assign({internalFormat:34041},t)),this._depthBuffers.set(e.id,n),this._activeTargets.add(e.id)),n}},e.prototype.getColorTexture=function(e,t){var r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:null!=e.samplingMode?e.samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r},e.prototype.getAllocatedColorTexture=function(e){return this._colorTextures.get(e.id)},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this._nextId++;return r.__assign(r.__assign({id:t},l),e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this._nextId++;return r.__assign(r.__assign({id:t},s),e)},e.prototype.getFramebuffer=function(e,t,r){var i=this.getKey(t,r),o=this._framebuffers.get(i),a=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a||o.depthStencilTexture!==s)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilTexture(s)),o):(o=r?new n(this.rctx,{colorTarget:0,depthStencilTarget:4},a,s):new n(this.rctx,{colorTarget:0,depthStencilTarget:0},a),this._framebuffers.set(i,o),o)}var l=r?this.getDepthBuffer(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a)&&(o.detachColorTexture(),o.detachDepthStencilBuffer(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilBuffer(l)),o):(o=new n(this.rctx,{colorTarget:0,depthStencilTarget:r?3:0},a,l),this._framebuffers.set(i,o),o)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e.prototype.getGpuMemoryUsage=function(){var e=0,t=new Set,r=function(r){t.has(r)||(t.add(r),e+=a.getGpuMemoryUsage(r))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),this._framebuffers.forEach(r),e},e}();t.RenderTargetHelper=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(667),r(195)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.pluginContext=e,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<23;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var n=e[r];this.slots[n].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginContext.requestRender()},e.prototype.remove=function(e){var t=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter((function(t){return t!==e})),n.assert(this.renderPlugins.length<t,"Removing non-added render plugin");for(var r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter((function(t){return t!==e}));e.uninitializeRenderContext(),this.pluginContext.requestRender()},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var n=r[t];n.prepareRender&&n.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,n=0,i=this.slots[e];n<i.length;n++){var o=i[n];o.canRender&&o.render(t)&&(r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=o;t.near=1/0,t.far=-1/0;for(var n=0,i=this.renderPlugins;n<i.length;n++){var a=i[n];if(a.queryDepthRange){var s=a.queryDepthRange(e);s&&r.union(t,s,t)}}return t},Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this.renderPlugins.some((function(e){return e.needsHighlight}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsLinearDepth",{get:function(){return this.renderPlugins.some((function(e){return e.needsLinearDepth}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsLaserlineWithContrastControl",{get:function(){var e=this.slots[17];return!!e&&e.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccludedFlags",{get:function(){var e=0;return this.renderPlugins.forEach((function(t){t.renderOccludedFlags&&(e|=t.renderOccludedFlags)})),e},enumerable:!0,configurable:!0}),e}();t.RenderPluginManager=i;var o={near:0,far:0}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(276),r(189),r(185),r(205),r(216),r(162),r(160),r(245),r(201),r(288),r(801),r(416),r(195),r(392),r(299),r(341)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g){for(var _=function(){this.camera=new d.default,this.lightMat=o.mat4f64.create()},b=function(){function e(e,t){this.rctx=e,this.viewingMode=t,this._enabled=!1,this.textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.emptyTexture=f.createEmptyTexture(this.rctx),this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(var r=0;r<4;++r)this.cascades.push(new _)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null,this.discardDepthTexture()},Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=r.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,e||this.discardDepthTexture()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)V[e]=this.cascades[e];return V.length=this.numCascades,V},e.prototype.prepare=function(e,t,n){v.assert(this.enabled),this.textureSize=this.computeTextureSize(e.fullWidth,e.fullHeight),this.assertDepthTexture(),i.mat4.multiply(w,e.projectionMatrix,e.viewMatrix);var o=n.near,a=n.far;o<2&&(o=2),a<2&&(a=2),o>=a&&(o=2,a=4),this.numCascades=Math.min(1+Math.floor(v.logWithBase(a/o,4)),this.maxNumCascades);for(var s=(a-o)/this.numCascades,c=Math.pow(a/o,1/this.numCascades),p=o,d=o,h=0;h<this.numCascades+1;++h)this.cascadeDistances[h]=r.lerp(p,d,this.splitSchemeLambda),p*=c,d+=s;i.mat4.invert(S,w);var f=0===this.viewingMode?e.eye:l.vec3.set(j,0,0,1);i.mat4.lookAt(L,[0,0,0],[-t[0],-t[1],-t[2]],f);var m=e.viewMatrix,y=e.projectionMatrix;for(h=0;h<this.numCascades;++h){var g=this.cascades[h],_=-this.cascadeDistances[h],b=-this.cascadeDistances[h+1],O=(y[10]*_+y[14])/Math.abs(y[11]*_+y[15]),V=(y[10]*b+y[14])/Math.abs(y[11]*b+y[15]);v.assert(O<V);for(var F=0;F<8;++F){var N=F%4==0||F%4==3?-1:1,k=F%4==0||F%4==1?-1:1,z=F<4?O:V;u.vec4.set(P,N,k,z,1),u.vec4.transformMat4(T[F],P,S);for(var U=0;U<3;++U)T[F][U]/=T[F][3]}for(l.vec3.negate(j,T[0]),i.mat4.translate(x,L,j),g.camera.viewMatrix=x,F=0;F<8;++F)l.vec3.transformMat4(T[F],T[F],g.camera.viewMatrix);for(l.vec3.copy(C,T[0]),l.vec3.copy(M,T[0]),F=1;F<8;++F)for(U=0;U<3;++U)C[U]=Math.min(C[U],T[F][U]),M[U]=Math.max(M[U],T[F][U]);if(C[2]-=200,M[2]+=200,g.camera.near=-M[2],g.camera.far=-C[2],this.warp){o=1/T[0][3],a=1/T[4][3],v.assert(o<a);var B=o+Math.sqrt(o*a),G=Math.sin(r.acosClamped(m[2]*t[0]+m[6]*t[1]+m[10]*t[2]));X(T,B/=G,G,A,E,I,R,D),te(A,E,R,D,g.camera.projectionMatrix),g.camera.projectionMatrix[10]=2/(C[2]-M[2]),g.camera.projectionMatrix[14]=-(C[2]+M[2])/(C[2]-M[2])}else i.mat4.ortho(g.camera.projectionMatrix,C[0],M[0],C[1],M[1],g.camera.near,g.camera.far);i.mat4.multiply(g.lightMat,g.camera.projectionMatrix,g.camera.viewMatrix);var H=this.textureSize/2;g.camera.viewport[0]=h%2==0?0:H,g.camera.viewport[1]=0===Math.floor(h/2)?0:H,g.camera.viewport[2]=H,g.camera.viewport[3]=H}this.lastOrigin=null;var q=this.rctx;q.bindFramebuffer(this.fbo),q.bindTexture(null,7),q.setClearColor(1,1,1,1),q.clearSafe(16640)},e.prototype.finish=function(e){v.assert(this.enabled),this.rctx.bindFramebuffer(e)},e.prototype.bind=function(e,t){var r=this.rctx;r.bindTexture(this.enabled?this.depthTexture:this.emptyTexture,t),r.bindProgram(e),e.setUniform1i("depthTex",t),e.setUniform1f("depthHalfPixelSz",this.enabled?.5/this.textureSize:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.numCascades>1?this.cascadeDistances[1]:1/0,this.numCascades>2?this.cascadeDistances[2]:1/0,this.numCascades>3?this.cascadeDistances[3]:1/0)},e.prototype.bindToAllPrograms=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r],h.DefaultTextureUnits.SHADOW_MAP)},e.prototype.bindView=function(e,t){if(this.enabled){var r=this.lastOrigin;if(!r||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]){this.lastOrigin=this.lastOrigin||c.vec3f64.create(),l.vec3.copy(this.lastOrigin,t);for(var n=0;n<this.numCascades;++n){i.mat4.translate(F,this.cascades[n].lightMat,t);for(var o=0;o<16;++o)N[16*n+o]=F[o]}}e.setUniformMatrix4fv("shadowMapMatrix",N)}},e.prototype.computeTextureSize=function(e,t){var r=.5*Math.log(e*e+t*t)*Math.LOG2E,n=Math.pow(2,Math.round(r+.35));return Math.min(this.maxTextureSize,2*n)},e.prototype.assertDepthTexture=function(){if(null==this.depthTexture||this.depthTexture.descriptor.width!==this.textureSize){this.discardDepthTexture();var e={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize};this.depthTexture=new y(this.rctx,e),this.fbo=new m(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this.depthTexture)}},e.prototype.discardDepthTexture=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null),this.depthTexture&&(this.depthTexture.dispose(),this.depthTexture=null)},e.prototype.getGpuMemoryUsage=function(){return g.getGpuMemoryUsage(this.fbo)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,set splitSchemeLambda(t){e.splitSchemeLambda=t},get splitSchemeLambda(){return e.splitSchemeLambda},set warp(t){e.warp=t},get warp(){return e.warp}}},enumerable:!0,configurable:!0}),e}(),x=o.mat4f64.create(),w=o.mat4f64.create(),S=o.mat4f64.create(),P=p.vec4f64.create(),T=[],O=0;O<8;++O)T.push(p.vec4f64.create());var C=c.vec3f64.create(),M=c.vec3f64.create(),A=s.vec2f64.create(),E=s.vec2f64.create(),I=s.vec2f64.create(),R=s.vec2f64.create(),D=s.vec2f64.create(),L=o.mat4f64.create(),j=c.vec3f64.create(),V=[],F=o.mat4f64.create(),N=new Float32Array(64),k=s.vec2f64.create(),z=s.vec2f64.create(),U=[s.vec2f64.create(),s.vec2f64.create(),s.vec2f64.create(),s.vec2f64.create()],B=s.vec2f64.create(),G=s.vec2f64.create(),H=s.vec2f64.create(),q=s.vec2f64.create(),W=s.vec2f64.create(),J=s.vec2f64.create(),Z=s.vec2f64.create();function X(e,t,r,n,i,o,s,l){a.vec2.set(k,0,0);for(var c=0;c<4;++c)a.vec2.add(k,k,e[c]);for(a.vec2.scale(k,k,.25),a.vec2.set(z,0,0),c=4;c<8;++c)a.vec2.add(z,z,e[c]);a.vec2.scale(z,z,.25),a.vec2.lerp(U[0],e[4],e[5],.5),a.vec2.lerp(U[1],e[5],e[6],.5),a.vec2.lerp(U[2],e[6],e[7],.5),a.vec2.lerp(U[3],e[7],e[4],.5);var u=0,p=a.vec2.squaredDistance(U[0],k);for(c=1;c<4;++c){var d=a.vec2.squaredDistance(U[c],k);d<p&&(p=d,u=c)}a.vec2.subtract(B,U[u],e[u+4]);var h,f,m=B[0];for(B[0]=-B[1],B[1]=m,a.vec2.subtract(G,z,k),a.vec2.dot(G,B)<0&&a.vec2.negate(B,B),a.vec2.lerp(B,B,G,r),a.vec2.normalize(B,B),h=f=a.vec2.dot(a.vec2.subtract(H,e[0],k),B),c=1;c<8;++c){var y=a.vec2.dot(a.vec2.subtract(H,e[c],k),B);y<h?h=y:y>f&&(f=y)}a.vec2.copy(n,k),a.vec2.scale(H,B,h-t),a.vec2.add(n,n,H);var g=-1,_=1,b=0,x=0;for(c=0;c<8;++c){a.vec2.subtract(q,e[c],n),a.vec2.normalize(q,q);var w=B[0]*q[1]-B[1]*q[0];w>0?w>g&&(g=w,b=c):w<_&&(_=w,x=c)}v.verify(g>0,"leftArea"),v.verify(_<0,"rightArea"),a.vec2.scale(W,B,h),a.vec2.add(W,W,k),a.vec2.scale(J,B,f),a.vec2.add(J,J,k),Z[0]=-B[1],Z[1]=B[0];var S=v.rayRay2D(n,e[x],J,a.vec2.add(H,J,Z),1,i),P=v.rayRay2D(n,e[b],J,H,1,o),T=v.rayRay2D(n,e[b],W,a.vec2.add(H,W,Z),1,s),O=v.rayRay2D(n,e[x],W,H,1,l);v.verify(S,"rayRay"),v.verify(P,"rayRay"),v.verify(T,"rayRay"),v.verify(O,"rayRay")}function Y(e,t){return 3*t+e}var Q=s.vec2f64.create();function K(e,t){return a.vec2.set(Q,e[t],e[t+3]),Q}var $=s.vec2f64.create(),ee=n.mat3f64.create();function te(e,t,r,n,i){a.vec2.subtract($,r,n),a.vec2.scale($,$,.5),ee[0]=$[0],ee[1]=$[1],ee[2]=0,ee[3]=$[1],ee[4]=-$[0],ee[5]=0,ee[6]=$[0]*$[0]+$[1]*$[1],ee[7]=$[0]*$[1]-$[1]*$[0],ee[8]=1,ee[Y(0,2)]=-a.vec2.dot(K(ee,0),e),ee[Y(1,2)]=-a.vec2.dot(K(ee,1),e);var o=a.vec2.dot(K(ee,0),r)+ee[Y(0,2)],s=a.vec2.dot(K(ee,1),r)+ee[Y(1,2)],l=a.vec2.dot(K(ee,0),n)+ee[Y(0,2)],c=a.vec2.dot(K(ee,1),n)+ee[Y(1,2)];o=-(o+l)/(s+c),ee[Y(0,0)]+=ee[Y(1,0)]*o,ee[Y(0,1)]+=ee[Y(1,1)]*o,ee[Y(0,2)]+=ee[Y(1,2)]*o,o=1/(a.vec2.dot(K(ee,0),r)+ee[Y(0,2)]),s=1/(a.vec2.dot(K(ee,1),r)+ee[Y(1,2)]),ee[Y(0,0)]*=o,ee[Y(0,1)]*=o,ee[Y(0,2)]*=o,ee[Y(1,0)]*=s,ee[Y(1,1)]*=s,ee[Y(1,2)]*=s,ee[Y(2,0)]=ee[Y(1,0)],ee[Y(2,1)]=ee[Y(1,1)],ee[Y(2,2)]=ee[Y(1,2)],ee[Y(1,2)]+=1,o=-.5*((o=a.vec2.dot(K(ee,1),t)+ee[Y(1,2)])/(s=a.vec2.dot(K(ee,2),t)+ee[Y(2,2)])+(l=a.vec2.dot(K(ee,1),r)+ee[Y(1,2)])/(c=a.vec2.dot(K(ee,2),r)+ee[Y(2,2)])),ee[Y(1,0)]+=ee[Y(2,0)]*o,ee[Y(1,1)]+=ee[Y(2,1)]*o,ee[Y(1,2)]+=ee[Y(2,2)]*o,o=a.vec2.dot(K(ee,1),t)+ee[Y(1,2)],l=-(s=a.vec2.dot(K(ee,2),t)+ee[Y(2,2)])/o,ee[Y(1,0)]*=l,ee[Y(1,1)]*=l,ee[Y(1,2)]*=l,i[0]=ee[0],i[1]=ee[1],i[2]=0,i[3]=ee[2],i[4]=ee[3],i[5]=ee[4],i[6]=0,i[7]=ee[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=ee[6],i[13]=ee[7],i[14]=0,i[15]=ee[8]}return b}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(203)],void 0===(i=function(e,t,r){var n=r.boundedPlane.create();return function(){function e(){this._worldPlane=n}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.plane!==n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||n},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(152),r(153),r(493),r(307),r(392),r(242),r(217),r(299),r(318),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p){return function(){function e(e){this.resourceLoadingPromise=null,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;if(!this.data||!this.textureArea||!this.textureSearch){var r=this.resourceLoadingPromise||this.loadDataModule().then((function(){return t.loadTextures()}));return e&&r.then(e),this.resourceLoadingPromise||(this.resourceLoadingPromise=r,r.then((function(){return t.resourceLoadingPromise=null}))),!1}return!0},e.prototype.loadDataModule=function(){var e=this;return this.data?i.resolve():new Promise((function(e,t){r.e(195).then(function(){var t=[r(2165)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(t){e.data=t}))},e.prototype.loadTextures=function(){var e=this;return i.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then((function(t){var r=t[0],n=t[1];e.textureArea=r,e.textureSearch=n}))},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new l(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new l(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new l(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations),this.pipelineState=c.makePipelineState({colorWrite:c.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new p(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new a(e,34962,35044,t)}),this.tmpFramebufferEdges=new s(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this.tmpFramebufferBlend=new s(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,i={x:0,y:0,width:0,height:0};n.isSome(t)?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setPipelineState(this.pipelineState),r.setViewport(i.x,i.y,i.width,i.height),this.tmpFramebufferEdges.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(16384),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(16384),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(16384),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3)},e.prototype.loadTextureFromBase64=function(e,t,r){var n=new u(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return o.requestImage(e).then((function(e){return n.resize(e.width,e.height),n.setData(e),n}))},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(156),r(216),r(162),r(245),r(201),r(493),r(801),r(416),r(1868),r(195),r(392),r(299),r(341),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u,p,d,h,f,v){var m=n.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=s.vec4f64.create(),this._rctx=t,this._techniqueRep=e,this._requestRender=r,this._ssaoTechniqueConfig=new p.SSAOTechniqueConfiguration,this._emptyTexture=u.createColorTexture(t,[1,1,1,1])}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r){if(this._noiseTexture){d.assert(this.enabled);var n=this._rctx,i=e.fullViewport,s=i[2],l=i[3],c=s/this._BLUR_F,p=l/this._BLUR_F;this._ssaoFBO.resize(s,l),this._blur0FBO.resize(c,p),this._blur1FBO.resize(c,p);var h=1*s,f=1*l;n.bindFramebuffer(this._ssaoFBO),a.vec4.copy(this._viewportToRestore,e.fullViewport),n.setViewport(0,0,s,l);var m=this._ssaoTechnique.program,y=this._blurTechnique.program;n.bindProgram(m),n.setPipelineState(this._ssaoTechnique.pipeline),m.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height),m.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64);var b=this._data.minDiscrepancy,x=this._samples<b.length?b[this._samples]:5779;m.setUniform1f("numSpiralTurns",x);var w=_,S=g;d.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,w,S),m.setUniform4fv("projInfo",w),m.setUniform2fv("zScale",S),m.setUniform2f("nearFar",e.near,e.far);var P=1/e.computeRenderPixelSizeAtDist(1);m.setUniform1f("projScale",1*P),m.setUniform2f("screenDimensions",h,f);var T=2*this._radius,O=o.vec3.distance(e.eye,e.center);T=20*e.computeRenderPixelSizeAtDist(O),T=Math.max(.1,T),m.setUniform1f("radius",T),m.setUniform1f("intensity",4*this._attenuation/Math.pow(T,6)),m.setUniform1i("rnm",0),m.setUniform1i("normalMap",1),m.setUniform1i("depthMap",2),n.bindTexture(this._noiseTexture,0),n.bindTexture(r,1),n.bindTexture(t,2);var C=u.createQuadVAO(this._rctx);n.bindVAO(C),n.drawArrays(5,0,v.vertexCount(C,"geometry")),n.bindTexture(this._ssaoFBO.colorTexture,0),n.setViewport(0,0,h/this._BLUR_F,f/this._BLUR_F),n.bindFramebuffer(this._blur0FBO),n.bindProgram(y),y.setUniform2f("screenDimensions",h,f),y.setUniform1i("tex",0),y.setUniform1i("normalMap",1),y.setUniform1i("depthMap",2),y.setUniform2f("blurSize",0,1*this._BLUR_F/f),y.setUniform1i("radius",4),y.setUniform1f("g_BlurFalloff",.08),y.setUniform2f("nearFar",e.near,e.far),O>5e4&&(P=Math.max(0,P-(O-5e4))),y.setUniform1f("projScale",P),y.setUniform2f("zScale",1,0),n.drawArrays(5,0,v.vertexCount(C,"geometry")),y.setUniform2f("blurSize",1*this._BLUR_F/h,0),n.bindFramebuffer(this._blur1FBO),n.bindTexture(this._blur0FBO.colorTexture,0),n.drawArrays(5,0,v.vertexCount(C,"geometry")),n.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),C.dispose(!0)}},e.prototype.setUniforms=function(e,t){var r=this.enabled&&this._noiseTexture,n=this._rctx;n.bindTexture(r?this._blur1FBO.colorTexture:this._emptyTexture,t),n.setActiveTexture(0),e.setUniform1i("ssaoTex",t),r?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindToAllPrograms=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r],c.DefaultTextureUnits.SSAO)},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoTechniqueConfig.samples=e,this._ssaoTechniqueConfig.radius=4,this._ssaoTechniqueConfig.output=0,this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(p.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=1,this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(p.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)},e.prototype.enable=function(){var e=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources((function(){e._enabled&&e.initialize()}))):m.warn("SSAO is not supported for this browser or hardware"))},e.prototype.loadResources=function(e){var t=this;this._data?e():new Promise((function(e,t){r.e(194).then(function(){var t=[r(2166)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){t._data=r,e()}))},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new h(this._rctx,r,t),this._blur0FBO=new h(this._rctx,r,t),this._blur1FBO=new h(this._rctx,r,t),l.requestImage(this._data.noiseTexture).then((function(t){e._enabled&&(e._noiseTexture=new f(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())})),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e.prototype.getGpuMemoryUsage=function(){return v.getGpuMemoryUsage(this._blur0FBO)+v.getGpuMemoryUsage(this._blur1FBO)+v.getGpuMemoryUsage(this._ssaoFBO)},Object.defineProperty(e.prototype,"test",{get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}},enumerable:!0,configurable:!0}),e}(),g=i.vec2f64.create(),_=s.vec4f64.create();return y}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(253),r(257),r(260),r(228),r(1292),r(242),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,i=r.build({output:n.output,samples:n.samples,radius:n.radius});return new c(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),s.Default3D)},t.prototype.initializePipeline=function(){return u.makePipelineState({colorWrite:u.defaultColorWriteParams})},t.shader=new i.ReloadableShaderModule(l,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1292)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(o.ShaderTechnique);t.SSAOTechnique=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.samples=64,t.radius=4,t}return n.__extends(t,e),n.__decorate([a.parameter({count:2})],t.prototype,"output",void 0),n.__decorate([a.parameter()],t.prototype,"samples",void 0),n.__decorate([a.parameter()],t.prototype,"radius",void 0),t}(a.ShaderTechniqueConfiguration);t.SSAOTechniqueConfiguration=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSpace=function(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(180),r(168),r(153),r(120),r(305),r(272),r(276),r(189),r(185),r(162),r(160),r(952),r(449),r(818),r(941),r(1293),r(1871),r(417),r(964),r(1294),r(1295),r(1875),r(1884),r(1885),r(819),r(307),r(318)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f,v,m,y,g,_,b,x,w,S,P,T,O,C,M,A){Object.defineProperty(t,"__esModule",{value:!0});var E=function(){function e(e,t,r){this.rctx=e,this.techniqueRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new _.LocalOriginManager(new y),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new S,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=h.vec3f64.create(),this.tmpCameraPosition=h.vec3f64.create(),this.componentColorManager=new C.BufferManager(this.rctx,2)}return e.prototype.initialize=function(){var e=this;s.open("EdgeProcessingWorker").then((function(t){e.destroyed?t.close():e.workerThread=t}));for(var t=x.VertexLayout.createBuffer(4),r=0;r<4;r++)t.sideness.set(r,0,0===r||3===r?0:1),t.sideness.set(r,1,0===r||1===r?0:1);this.verticesBufferObject=M.createVertex(this.rctx,35044,t.buffer)},e.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.perObjectData.clear(),this.renderers.clear(),this.destroyed=!0)},e.prototype.getUsedMemory=function(){return this.gpuMemoryUsage},Object.defineProperty(e.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),e.prototype.shouldRender=function(){return this.renderers.size>0},e.prototype.addComponentObject=function(e,t,n,i,a,s,l,c){return r.__awaiter(this,void 0,void 0,(function(){var u,p;return r.__generator(this,(function(r){switch(r.label){case 0:return this.hasObject(e)?[2]:(p={loaded:o.create((function(e){return u=e})),renderables:[],center:n},this.perObjectData.set(e,p),[4,this.addComponentGeometry(t,p,i,a,s,l,c)]);case 1:return r.sent(),this.callbacks.setNeedsRender(),u(),[2]}}))}))},e.prototype.addOrUpdateObject=function(e,t,i,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,p,d,h,f,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(l=new Array,u={loaded:o.create((function(e){return c=e})),renderables:[]},p=this.perObjectData.get(e),this.perObjectData.set(e,u),s&&s.mergeGeometries&&e.geometries.length>1&&function(e){for(var t=null,r=null,i=0;i<e.geometries.length;i++){var o=e.geometryRecords[i];if(o.material.supportsEdges){if(t){if(!n.equals(t,o.transformation))return!1}else t=o.transformation;if(!r&&o.origin)r=o;else if(r&&o.origin&&r.origin.id!==o.origin.id)return!1}}return!0}(e))l.push(this.addObjectMergedGeometries(e,u,t,i));else for(d=0;d<e.geometries.length;d++)h=e.geometries[d],(f=e.geometryRecords[d]).material.supportsEdges&&l.push(this.addGeometryData(e,u,h.data,f,t[0],i,a));return[4,o.all(l)];case 1:return r.sent(),p&&p.loaded.then((function(){p.renderables.forEach((function(e){return v.removeRenderable(e)})),v.callbacks.setNeedsRender()})),this.callbacks.setNeedsRender(),c(),[2]}}))}))},e.prototype.hasObject=function(e){return this.perObjectData.has(e)},e.prototype.updateAllComponentOpacities=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=t instanceof Array?function(e){return t[e]}:function(){return t},[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach((function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var o=n(r),a=e.components.meta[r],s=a.index;a.material.opacity=o,e.components.buffer.textureBuffer.setDataElement(s,1,3,255*o)}i.updateTransparency(e)})),this.callbacks.setNeedsRender(),[2]}}))}))},e.prototype.updateAllComponentMaterials=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,c=this;return r.__generator(this,(function(r){switch(r.label){case 0:return o=e instanceof b,a=!!n.slicePlaneEnabled,s=O.determineRendererType(t),l=P.EdgeRenderer.getKey(s,a,o),[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach((function(e){if(l!==e.rendererKey){var r=c.renderers.get(e.rendererKey),n=c.acquireRenderer(s,a,o);r.removeRenderable(e),r.refCount.decrement(),e.rendererKey=l,n.addRenderable(e)}for(var u=0;u<t.length;u++)e.components.meta[u].material=t[u];i&&c.updateComponentBuffer(e.components),c.updateTransparency(e)})),this.callbacks.setNeedsRender(),[2]}}))}))},e.prototype.updateObjectVisibility=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach((function(e){return e.visible=t})),this.callbacks.setNeedsRender(),[2]}}))}))},e.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then((function(){r.renderables.forEach((function(e){return t.removeRenderable(e)})),t.callbacks.setNeedsRender()})))},e.prototype.getObjectEntry=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=this.perObjectData.get(e)))throw"no object";return[4,t.loaded];case 1:return r.sent(),[2,t]}}))}))},e.prototype.removeAll=function(){var e=this;this.perObjectData.forEach((function(t,r){e.removeObject(r)}))},e.prototype.render=function(e,t){var r=this;this.localOrigins.updateViewMatrices(e.view);var n=e.viewInvTransp,i=h.vec3f64.create(),o=new m.TwoVectorPosition,a=new v.VertexPosition.ViewProjectionTransform,s=c.mat3f64.create();d.vec3.set(i,n[3],n[7],n[11]),o.set(i),d.vec3.copy(a.worldFromView_TH,o.high),d.vec3.copy(a.worldFromView_TL,o.low),l.mat3.fromMat4(a.viewFromCameraRelative_RS,e.view),u.mat4.copy(a.projFromView,e.proj);var p=c.mat3f64.create();l.mat3.transpose(p,a.viewFromCameraRelative_RS),l.mat3.invert(s,p),this.renderers.forEach((function(e){0===e.refCount.value&&(r.renderers.delete(e.key),e.dispose())})),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var f=0,y=0;if(this.renderers.forEach((function(e){return e.forEachRenderable((function(e){f+=e.statistics.averageEdgeLength,y++}),t)})),0!==y){var g=e.view,_={distanceFalloffFactor:40*f/y,minimumEdgeLength:O.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5*e.pixelRatio),transparency:t,viewProjectionTransform:a,transformNormal_ViewFromGlobal:s};this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach((function(t){r.renderRegularEdges(t,e,_),r.renderSilhouetteEdges(t,e,_)})),e.view=g}},e.prototype.updateTransparency=function(e){var t=O.determineEdgeTransparency(e.components.meta),r=O.determineObjectTransparency(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this.renderers.get(e.rendererKey).setRenderablesDirty())},e.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var n=d.vec3.set(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.acquire(n)}return g.applyToModelMatrix(t.origin.vec3,r),r},e.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,n=0;n<t.length;n++){var o=t[n].material,a=t[n].index,s=i.clamp(Math.round(o.size*P.LINE_WIDTH_FRACTION_FACTOR),0,255),l=i.clamp(o.extensionLength,-P.EXTENSION_LENGTH_OFFSET,255-P.EXTENSION_LENGTH_OFFSET)+P.EXTENSION_LENGTH_OFFSET,c="solid"===o.type?0:1,u=255*o.opacity,p=o.color,d=255*p[0],h=255*p[1],f=255*p[2],v=255*p[3];r.textureBuffer.setData(a,0,d,h,f,v),r.textureBuffer.setData(a,1,s,l,c,u)}},e.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),n=0;n<e.length;n++){var i=e[n],o=r.acquireIndex();t.push({index:o,material:i})}var a={meta:t,buffer:r};return this.updateComponentBuffer(a),a},e.prototype.extractEdges=function(e,t,r,n,i){return this.worker.process({data:t,originalIndices:i,writerSettings:e,skipDeduplicate:r},n?null:this.workerThread)},e.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new A(this.rctx,x.EdgeShaderAttributeLocations,{vertices:x.glVertexLayout,instances:w.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:M.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}return e.silhouette.lodInfo.lengths.length>0&&(r=new A(this.rctx,x.EdgeShaderAttributeLocations,{vertices:x.glVertexLayout,instances:w.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:M.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)}),t.silhouette={vao:r,lod:e.silhouette.lodInfo}),t},e.prototype.addGeometryData=function(e,t,n,i,o,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,d;return r.__generator(this,(function(r){return l=n.getAttribute("position"),c=this.computeModelTransformWithLocalOrigin(e,i,p.mat4f64.create()),u=i.origin,d={position:l,indices:n.getIndices("position"),modelTransform:c,origin:u},[2,this.addPositionData(t,d,o,a,s)]}))}))},e.prototype.addPositionData=function(e,t,n,i,o){return void 0===o&&(o=!1),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,c,u,p,d,h,f,v,m,y,g,_,b;return r.__generator(this,(function(r){switch(r.label){case 0:for(a=this.acquireRenderer(n.type,i.slicePlaneEnabled||!1),s=t.modelTransform,l=t.origin,c=t.indices,u=t.position,p=u.data.length/u.strideIdx,d=x.EdgeInputBufferLayout.createBuffer(p),h=0;h<p;h++)d.position.set(h,0,u.data[u.offsetIdx+h*u.strideIdx+0]),d.position.set(h,1,u.data[u.offsetIdx+h*u.strideIdx+1]),d.position.set(h,2,u.data[u.offsetIdx+h*u.strideIdx+2]);return f=this.createComponentBuffers([n]),O.fillComponenBufferIndices(f.meta,[0,d.componentIndex.count],d.componentIndex),[4,this.extractEdges(a.writerSettings,d,!1,o,c)];case 1:return v=r.sent(),m=this.createEdgeResources(v),y=m.regular,g=m.silhouette,_=(y?y.vao.size:0)+(g?g.vao.size:0),b={regular:y,silhouette:g,transform:{modelMatrix:s,origin:l},statistics:{gpuMemoryUsage:_,averageEdgeLength:v.averageEdgeLength},components:f,visible:!0,edgeTransparency:O.determineEdgeTransparency(f.meta),objectTransparency:O.determineObjectTransparency(f.meta),distanceToCamera:0,rendererKey:a.key},e.renderables.push(b),a.addRenderable(b),this.gpuMemoryUsage+=_,[2]}}))}))},e.prototype.addComponentGeometry=function(e,t,n,i,o,a,s){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,p,d,h,v,m,y,g,_;return r.__generator(this,(function(r){switch(r.label){case 0:return l=O.determineRendererType(a),c=this.acquireRenderer(l,s.slicePlaneEnabled||!1,!1),u=x.EdgeInputBufferLayout.createBuffer(n.count),f.vec3.copy(u.position,n),p=this.createComponentBuffers(a),O.fillComponenBufferIndices(p.meta,o,u.componentIndex,i),d=c.writerSettings,[4,this.extractEdges(d,u,!0,!1,i)];case 1:return h=r.sent(),v=this.createEdgeResources(h),m=v.regular,y=v.silhouette,g=(m?m.vao.size:0)+(y?y.vao.size:0),_={regular:m,silhouette:y,transform:e,statistics:{gpuMemoryUsage:g,averageEdgeLength:h.averageEdgeLength},components:p,visible:!0,edgeTransparency:O.determineEdgeTransparency(p.meta),objectTransparency:O.determineObjectTransparency(p.meta),distanceToCamera:0,rendererKey:c.key},t.renderables.push(_),c.addRenderable(_),this.gpuMemoryUsage+=g,[2]}}))}))},e.prototype.addObjectMergedGeometries=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,l,c,u,d,h,f,v,m,y,g,_,b,x,w,S,P,T;return r.__generator(this,(function(r){switch(r.label){case 0:for(o=new Map,s=0,l=null,c=null,P=0;P<e.geometries.length;P++)v=e.geometries[P],(u=e.geometryRecords[P]).material.supportsEdges&&(!c&&u.origin&&(c=u),y=v.data.getIndices("position"),s+=y?y.length:0,(y&&null==l||l===Uint16Array)&&(l=a.isUint16Array(y)?Uint16Array:Uint32Array));for(d=s?new l(s):null,h=[],f=0,P=0;P<e.geometries.length;P++)if(v=e.geometries[P],e.geometryRecords[P].material.supportsEdges){if(m=v.data.getAttribute("position"),y=v.data.getIndices("position"),null==(g=o.get(m.data))){for(g=h.length/3,_=m.offsetIdx;_<m.data.length;_+=m.strideIdx)h.push(m.data[_+0]),h.push(m.data[_+1]),h.push(m.data[_+2]);o.set(m.data,g)}if(y)for(b=0;b<y.length;b++)d[f++]=g+y[b]}for(x=c||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,x,p.mat4f64.create()),S=x.origin,P=0;P<e.geometryRecords.length;P++)e.geometryRecords[P].origin=S;return T={position:{data:h,offsetIdx:0,strideIdx:3},indices:d,modelTransform:w,origin:S},[4,this.addPositionData(t,T,n[0],i)];case 1:return r.sent(),[2]}}))}))},e.prototype.acquireRenderer=function(e,t,r){void 0===r&&(r=!0);var n=P.EdgeRenderer.getKey(e,t,r),i=this.renderers.get(n);return this.strokesTexture||(this.strokesTexture=T.generateStrokesTexture(this.rctx)),i||(i=new P.EdgeRenderer(this.rctx,this.techniqueRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture,legacy:r}),this.renderers.set(n,i)),i.refCount.increment(),i},e.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}(e),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,n=e.components.meta;r<n.length;r++){var i=n[r];e.components.buffer.releaseIndex(i.index)}}},e.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;d.vec3.set(this.tmpCameraPosition,r[3],r[7],r[11]),this.perObjectData.forEach((function(e,r){var n="getCenter"in r?r.getCenter():e.center,i=d.vec3.distance(n,t.tmpCameraPosition);e.renderables.forEach((function(e){return e.distanceToCamera=i}))}))},e.prototype.renderRegularEdges=function(e,t,r){var n=this;e.bindRegularEdges(t,r);var i=r.transparency;e.forEachRenderable((function(i){if(i.visible&&i.regular){var o=O.computeEdgeCount(i.regular.lod.lengths,i.distanceToCamera,r);"origin"in i.transform&&(t.view=n.localOrigins.getViewMatrix(i.transform.origin)),e.renderRegularEdges(i,t,o),n.numberOfRenderedEdges+=o}}),i)},e.prototype.renderSilhouetteEdges=function(e,t,r){var n=this;e.bindSilhouetteEdges(t,r);var i=r.transparency;e.forEachRenderable((function(i){if(i.visible&&i.silhouette){var o=O.computeEdgeCount(i.silhouette.lod.lengths,i.distanceToCamera,r);"origin"in i.transform&&(t.view=n.localOrigins.getViewMatrix(i.transform.origin)),e.renderSilhouetteEdges(i,t,o),n.numberOfRenderedEdges+=o}}),i)},e}();t.EdgeView=E}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(189),r(185),r(1293)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.acquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:n.mat4f64.create(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&(t.refCount--,0===t.refCount&&this.originData.delete(e.id))},e.prototype.updateViewMatrices=function(e){this.originData.forEach((function(t){r.mat4.copy(t.viewMatrix,e),i.applyToViewMatrix(t.origin.vec3,t.viewMatrix)}))},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=o}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeNeighbors=function(e,t){for(var r=e.length/3,n=new Uint32Array(t+1),i=new Uint32Array(t+1),o=function(e,t){e<t?n[e+1]++:i[t+1]++},a=0;a<r;a++){var s=e[3*a],l=e[3*a+1],c=e[3*a+2];o(s,l),o(l,c),o(c,s)}var u=0,p=0;for(a=0;a<t;a++){var d=n[a+1],h=i[a+1];n[a+1]=u,i[a+1]=p,u+=d,p+=h}var f=new Uint32Array(6*r),v=n[t],m=function(e,t,r){if(e<t){var o=n[e+1]++;f[2*o]=t,f[2*o+1]=r}else o=i[t+1]++,f[2*v+2*o]=e,f[2*v+2*o+1]=r};for(a=0;a<r;a++)s=e[3*a],l=e[3*a+1],c=e[3*a+2],m(s,l,a),m(l,c,a),m(c,s,a);var y=function(e,t){for(var r=2*e,n=t-e,i=1;i<n;i++){for(var o=f[r+2*i],a=f[r+2*i+1],s=i-1;s>=0&&f[r+2*s]>o;s--)f[r+2*s+2]=f[r+2*s],f[r+2*s+3]=f[r+2*s+1];f[r+2*s+2]=o,f[r+2*s+3]=a}};for(a=0;a<t;a++)y(n[a],n[a+1]),y(v+i[a],v+i[a+1]);var g=new Int32Array(3*r),_=function(t,r){return t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1},b=function(e,t){var r=_(e,t);g[3*t+r]=-1},x=function(e,t,r,n){var i=_(e,t);g[3*t+i]=n;var o=_(r,n);g[3*n+o]=t};for(a=0;a<t;a++){for(var w=n[a],S=n[a+1],P=i[a],T=i[a+1];w<S&&P<T;){var O=f[2*w];O===(C=f[2*v+2*P])?(x(a,f[2*w+1],C,f[2*v+2*P+1]),w++,P++):O<C?(b(a,f[2*w+1]),w++):(b(C,f[2*v+2*P+1]),P++)}for(;w<S;)b(a,f[2*w+1]),w++;for(;P<T;){var C;b(C=f[2*v+2*P],f[2*v+2*P+1]),P++}}return g}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(340),r(317)],void 0===(i=function(e,t,r,n,i){function o(e){var t=new Array;return e.fields.forEach((function(e,n){var i=r.__assign(r.__assign({},e),{constructor:l(e.constructor)});t.push([n,i])})),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function a(e){var t=i.newLayout();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach((function(e){return t.fields.set(e[0],r.__assign(r.__assign({},e[1]),{constructor:(n=e[1].constructor,c.get(n))}));var n})),t}Object.defineProperty(t,"__esModule",{value:!0}),t.packInterleavedBuffer=function(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:o(e.layout)}},t.unpackInterleavedBuffer=function(e){return a(e.layout).createView(e.buffer)},t.packLayout=o,t.unpackLayout=a;var s=[n.BufferViewFloat,n.BufferViewVec2f,n.BufferViewVec3f,n.BufferViewVec4f,n.BufferViewMat3f,n.BufferViewMat4f,n.BufferViewFloat64,n.BufferViewVec2f64,n.BufferViewVec3f64,n.BufferViewVec4f64,n.BufferViewMat3f64,n.BufferViewMat4f64,n.BufferViewUint8,n.BufferViewVec2u8,n.BufferViewVec3u8,n.BufferViewVec4u8,n.BufferViewUint16,n.BufferViewVec2u16,n.BufferViewVec3u16,n.BufferViewVec4u16,n.BufferViewUint32,n.BufferViewVec2u32,n.BufferViewVec3u32,n.BufferViewVec4u32,n.BufferViewInt8,n.BufferViewVec2i8,n.BufferViewVec3i8,n.BufferViewVec4i8,n.BufferViewInt16,n.BufferViewVec2i16,n.BufferViewVec3i16,n.BufferViewVec4i16,n.BufferViewInt32,n.BufferViewVec2i32,n.BufferViewVec3i32,n.BufferViewVec4i32];function l(e){return e.ElementType+"_"+e.ElementCount}var c=new Map;s.forEach((function(e){return c.set(l(e),e)}))}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(168),r(120),r(162),r(160),r(251)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){return e.cosAngle<t}function c(e,t){return e.cosAngle>t}function u(e,t){var r=n.acosClamped(e.cosAngle),i=p.fwd,a=p.ortho;return s.directionFromTo(i,e.position1,e.position0),r*(o.vec3.dot(o.vec3.cross(a,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}Object.defineProperty(t,"__esModule",{value:!0}),t.extractEdges=function(e,t,a,s){void 0===s&&(s=h);var f=e.vertices.position,v=e.vertices.componentIndex,m=n.deg2rad(s.anglePlanar),y=n.deg2rad(s.angleSignificantEdge),g=Math.cos(y),_=Math.cos(m),b=p.edge,x=b.position0,w=b.position1,S=b.faceNormal0,P=b.faceNormal1,T=function(e){for(var t=e.faces.length/3,r=e.vertices.position,n=e.faces,i=d.v0,a=d.v1,s=d.v2,l=new Float32Array(3*t),c=0;c<t;c++){var u=n[3*c+0],p=n[3*c+1],h=n[3*c+2];r.getVec(u,i),r.getVec(p,a),r.getVec(h,s),o.vec3.subtract(a,a,i),o.vec3.subtract(s,s,i),o.vec3.cross(i,a,s),o.vec3.normalize(i,i),l[3*c+0]=i[0],l[3*c+1]=i[1],l[3*c+2]=i[2]}return l}(e),O=function(e){for(var t=e.faces.length/3,r=e.faces,n=e.neighbors,i=0,o=0;o<t;o++){var a=n[3*o+0],s=n[3*o+1],l=n[3*o+2],c=r[3*o+0],u=r[3*o+1],p=r[3*o+2];i+=-1===a||c<u?1:0,i+=-1===s||u<p?1:0,i+=-1===l||p<c?1:0}var d=new Int32Array(4*i),h=0;for(o=0;o<t;o++)a=n[3*o+0],s=n[3*o+1],l=n[3*o+2],c=r[3*o+0],u=r[3*o+1],p=r[3*o+2],(-1===a||c<u)&&(d[h++]=c,d[h++]=u,d[h++]=o,d[h++]=a),(-1===s||u<p)&&(d[h++]=u,d[h++]=p,d[h++]=o,d[h++]=s),(-1===l||p<c)&&(d[h++]=p,d[h++]=c,d[h++]=o,d[h++]=l);return d}(e),C=O.length/4,M=t.allocate(C),A=0,E=C,I=a.allocate(E),R=0,D=0,L=0,j=r.range(0,C),V=new Float32Array(C);i.forEach(V,(function(e,t,r){f.getVec(O[4*t+0],x),f.getVec(O[4*t+1],w),r[t]=o.vec3.distance(x,w)})),j.sort((function(e,t){return V[t]-V[e]}));for(var F=new Array,N=new Array,k=0;k<C;k++){var z=j[k],U=V[z],B=O[4*z+0],G=O[4*z+1],H=O[4*z+2],q=O[4*z+3],W=-1===q;if(f.getVec(B,x),f.getVec(G,w),W)o.vec3.set(S,T[3*H+0],T[3*H+1],T[3*H+2]),o.vec3.copy(P,S),b.componentIndex=v.get(B),b.cosAngle=o.vec3.dot(S,P);else{if(o.vec3.set(S,T[3*H+0],T[3*H+1],T[3*H+2]),o.vec3.set(P,T[3*q+0],T[3*q+1],T[3*q+2]),b.componentIndex=v.get(B),b.cosAngle=o.vec3.dot(S,P),c(b,_))continue;b.cosAngle<-.9999&&o.vec3.copy(P,S)}D+=U,L++,W||l(b,g)?(t.write(M,A++,b),F.push(U)):u(b,m)&&(a.write(I,R++,b),N.push(U))}var J=new Float32Array(F.reverse()),Z=new Float32Array(N.reverse());return{regular:{instancesData:t.trim(M,A),lodInfo:{lengths:J}},silhouette:{instancesData:a.trim(I,R),lodInfo:{lengths:Z}},averageEdgeLength:D/L}};var p={edge:{position0:a.vec3f64.create(),position1:a.vec3f64.create(),faceNormal0:a.vec3f64.create(),faceNormal1:a.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:a.vec3f64.create(),fwd:a.vec3f64.create()},d={v0:a.vec3f64.create(),v1:a.vec3f64.create(),v2:a.vec3f64.create()},h={anglePlanar:4,angleSignificantEdge:35}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(168),r(214),r(272),r(413),r(162),r(160),r(962),r(223),r(449),r(541),r(818),r(1876)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c,u,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var v={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0},m=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),y={solid:0,sketch:1,uber:2},g=function(){function e(t,n,o){var a,s,l;this.rctx=t,this.shaderTechniqueRepository=n,this.config=new f.EdgeShaderTechnique.Configuration,this.technique=null,this.refCount=new m,this.renderables=new Set,this.sortedRenderables=((a={})[1]=((s={})[1]=new i,s[2]=new i,s),a[2]=((l={})[1]=new i,l[2]=new i,l),a),this.renderablesDirty=!1,this.settings=r.__assign(r.__assign({},v),o),this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);var c=this.settings.strokesTexture.variants;this.writerSettings={variants:c},this.config.legacy=this.settings.legacy,this.config.mode=y[this.settings.type],this.config.silhouette=!1,this.config.antialiasing=!!this.rctx.capabilities.blendMinMax,this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled,this.config.doublePrecisionRequiresObfuscation=d.doublePrecisionRequiresObfuscation(t)}return e.prototype.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)},e.prototype.addRenderable=function(e){this.renderables.add(e),this.renderablesDirty=!0},e.prototype.removeRenderable=function(e){this.renderables.delete(e),this.renderablesDirty=!0},e.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0},e.prototype.forEachRenderable=function(e,t){this.renderablesDirty&&this.sortRenderables(),this.sortedRenderables[t][1].forEach(e),this.sortedRenderables[t][2].forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.config.silhouette=!1,this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(f.EdgeShaderTechnique,this.config,this.technique),this.technique.bindPass(this.rctx,{renderParameters:e,edgeRenderParameters:t}),this.rctx.setPipelineState(this.technique.pipeline),this.rctx.bindProgram(this.technique.program)},e.prototype.bindSilhouetteEdges=function(e,t){this.config.silhouette=!0,this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(f.EdgeShaderTechnique,this.config,this.technique),this.technique.bindPass(this.rctx,{renderParameters:e,edgeRenderParameters:t}),this.rctx.setPipelineState(this.technique.pipeline),this.rctx.bindProgram(this.technique.program)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.technique.program,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.technique.program,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,n,i){this.setUniforms(e,t,n),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,i)},e.prototype.setUniforms=function(e,r,n){if(r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),"origin"in r.transform)e.setUniformMatrix4fv("uView",n.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix),u.Slice.bindUniforms(e,this.settings,n.slicePlane,r.transform.origin.vec3);else{var i=new h.TwoVectorPosition(r.transform.position),a=o.mat3.transpose(_,o.mat3.invert(_,r.transform.rotationScale)),l=new c.ComponentDrawParameters;s.vec3.copy(l.worldFromModel_TL,i.low),s.vec3.copy(l.worldFromModel_TH,i.high),o.mat3.copy(l.worldFromModel_RS,r.transform.rotationScale),o.mat3.copy(l.transformNormal_GlobalFromModel,a),p.VertexPosition.bindModelTransform(e,l),e.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",l.transformNormal_GlobalFromModel);var d=n.viewInvTransp,f=s.vec3.set(b,d[3],d[7],d[11]);u.Slice.bindUniforms(e,this.settings,n.slicePlane,f)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(n.fovY/2)/(n.viewport[3]/2))},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",n.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.sortRenderables=function(){var e=this;this.renderablesDirty=!1,this.sortedRenderables[1][1].clear(),this.sortedRenderables[1][2].clear(),this.sortedRenderables[2][1].clear(),this.sortedRenderables[2][2].clear(),this.renderables.forEach((function(t){0!==t.objectTransparency&&0!==t.edgeTransparency&&e.sortedRenderables[t.objectTransparency][t.edgeTransparency].push(t)}));var t=function(e,t){return"origin"in e.transform&&"origin"in t.transform?e.transform.origin.id<t.transform.origin.id?-1:e.transform.origin.id>t.transform.origin.id?1:0:0};this.sortedRenderables[1][1].sort(t),this.sortedRenderables[1][2].sort(t),this.sortedRenderables[2][1].sort(t),this.sortedRenderables[2][2].sort(t)},e.getKey=function(e,t,r){return"edges-t:"+e+":"+t+":"+r},e}();t.EdgeRenderer=g,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2};var _=a.mat3f32.create(),b=l.vec3f64.create()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(204),r(449),r(253),r(257),r(260),r(1296),r(217),r(161)],void 0===(i=function(e,t,n,i,o,a,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.bindPass=function(e,t){var r=this.program,n=t.edgeRenderParameters,i=t.renderParameters;o.VertexPosition.bindViewProjTransform(r,n.viewProjectionTransform),r.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",n.transformNormal_ViewFromGlobal),r.setUniformMatrix4fv("uProj",i.proj),r.setUniform2f("uDepthBias",.5,-4e-4),r.setUniform2f("uPixelToNDC",2/i.viewport[2],2/i.viewport[3]),r.setUniform2f("uNDCToPixel",i.viewport[2]/2,i.viewport[3]/2),r.setUniform1f("uDistanceFalloffFactor",n.distanceFalloffFactor),r.setUniform2f("uViewportDimInv",1/i.viewport[2],1/i.viewport[3]),r.setUniform1f("uPixelRatio",i.pixelRatio||1)},t.prototype.initializeProgram=function(e){var r=t.shader.get(),n=this.configuration,o=r.build({slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,silhouette:n.silhouette,legacy:n.legacy,antialiasing:n.antialiasing,mode:n.mode,doublePrecisionRequiresObfuscation:n.doublePrecisionRequiresObfuscation});return new i.Program(e.rctx,o.generateSource("vertex"),o.generateSource("fragment"),r.attributeLocations)},t.prototype.initializePipeline=function(e){var t=e.rctx.capabilities.blendMinMax;return t?u.makePipelineState({blending:u.separateBlendingParams(1,1,0,1,32774,t.MAX),depthTest:{func:515},colorWrite:u.defaultColorWriteParams}):u.makePipelineState({depthTest:{func:515},depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})},t.shader=new a.ReloadableShaderModule(c,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1296)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.EdgeShaderTechnique=p,function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.silhouette=!1,t.legacy=!1,t.antialiasing=!1,t.mode=0,t.doublePrecisionRequiresObfuscation=!1,t}return n.__extends(t,e),n.__decorate([l.parameter()],t.prototype,"slicePlaneEnabled",void 0),n.__decorate([l.parameter()],t.prototype,"sliceHighlightDisabled",void 0),n.__decorate([l.parameter()],t.prototype,"silhouette",void 0),n.__decorate([l.parameter()],t.prototype,"legacy",void 0),n.__decorate([l.parameter()],t.prototype,"antialiasing",void 0),n.__decorate([l.parameter({count:3})],t.prototype,"mode",void 0),n.__decorate([l.parameter()],t.prototype,"doublePrecisionRequiresObfuscation",void 0),t}(l.ShaderTechniqueConfiguration);e.Configuration=t}(p=t.EdgeShaderTechnique||(t.EdgeShaderTechnique={})),t.EdgeShaderTechnique=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(449),r(1878),r(175)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.AdjustProjectedPosition=function(e,t){e.include(i.IsNaN),e.include(n.VertexPosition,t);var c=e.vertex;c.uniforms.add("uDepthBias","vec2"),c.uniforms.add("uViewportDimInv","vec2"),t.legacy?(c.uniforms.add("uView","mat4"),c.uniforms.add("uProj","mat4")):c.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),t.legacy?c.code.add(o.glsl(a||(a=r.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY = uDepthBias.x;\n        float offsetZ  = uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY = uDepthBias.x;\n        float offsetZ  = uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))):c.code.add(o.glsl(s||(s=r.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY = uDepthBias.x;\n        float offsetZ  = uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY = uDepthBias.x;\n        float offsetZ  = uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))),c.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ = uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n        projPos.xy += offsetXY;\n      }\n\n      projPos.z += _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "],["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ = uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n        projPos.xy += offsetXY;\n      }\n\n      projPos.z += _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.IsNaN=function(e){var t=n.glsl(i||(i=r.__makeTemplateObject(["\n    bool isNaN( float val )\n    {\n      return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n    }\n  "],["\n    bool isNaN( float val )\n    {\n      return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.DiscardByCoverage=function(e,t){var a=e.fragment;a.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01),t.antialiasing?a.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { if (coverage < COVERAGE_TEST_THRESHOLD) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { if (coverage < COVERAGE_TEST_THRESHOLD) discard; }\n    "])))):a.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage < coverageLimit) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage < coverageLimit) discard; }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DiscardNonSilhouetteEdges=function(e,t){var l=e.vertex;t.silhouette?(l.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible = dot(viewDir, normalA);\n        float faceBVisible = dot(viewDir, normalB);\n        return faceAVisible * faceBVisible < 0.0;\n      }\n    "],["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible = dot(viewDir, normalA);\n        float faceBVisible = dot(viewDir, normalB);\n        return faceAVisible * faceBVisible < 0.0;\n      }\n    "])))),t.legacy?l.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA = _modelToViewNormal(normalA);\n          vec3 viewNormalB = _modelToViewNormal(normalB);\n          vec3 viewDir = -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA = _modelToViewNormal(normalA);\n          vec3 viewNormalB = _modelToViewNormal(normalB);\n          vec3 viewDir = -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "])))):l.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA = _modelToWorldNormal(normalA);\n          vec3 worldNormalB = _modelToWorldNormal(normalB);\n          vec3 viewDir = -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA = _modelToWorldNormal(normalA);\n          vec3 worldNormalB = _modelToWorldNormal(normalB);\n          vec3 viewDir = -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "]))))):l.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "],["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "]))))}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175)],void 0===(i=function(e,t,r,n){var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.DiscardShortEdges=function(e,t){var s=e.vertex;switch(t.mode){case 1:s.code.add(n.glsl(i||(i=r.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 2:s.code.add(n.glsl(o||(o=r.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 0:s.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "]))))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(175),r(820),r(965)],void 0===(i=function(e,t,r,n,i,o){var a,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.LineAmplitude=function(e,t){var c=e.vertex;switch(e.include(o.UnpackAttributes,t),i.EdgeUtil.usesSketchLogic(t)&&c.uniforms.add("uStrokesAmplitude","float"),t.mode){case 0:c.code.add(n.glsl(a||(a=r.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "]))));break;case 1:c.code.add(n.glsl(s||(s=r.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "]))));break;case 2:c.code.add(n.glsl(l||(l=r.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type = unpackedAttributes.type;\n\n          if (type <= 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type = unpackedAttributes.type;\n\n          if (type <= 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "]))))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(494),r(175),r(820),r(965)],void 0===(i=function(e,t,r,n,i,o,a){var s,l,c,u,p,d,h,f;Object.defineProperty(t,"__esModule",{value:!0}),t.LineOffset=function(e,t){var v=e.vertex;e.include(a.UnpackAttributes,t);var m=e.fragment;switch(e.include(n.RgbaFloatEncoding),o.EdgeUtil.usesSketchLogic(t)&&(v.uniforms.add("uStrokesTextureScale","vec2"),v.uniforms.add("uStrokesLog2Resolution","float"),v.uniforms.add("uStrokeVariants","float"),e.varyings.add("vStrokeUV","vec2"),m.uniforms.add("uStrokesTexture","sampler2D"),m.uniforms.add("uStrokesNormalizationScale","float"),v.code.add(i.glsl(s||(s=r.__makeTemplateObject(["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x += variantOffset;\n      }\n    "],["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x += variantOffset;\n      }\n    "])))),m.code.add(i.glsl(l||(l=r.__makeTemplateObject(["\n      float calculateLineOffsetSketch() {\n        float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "],["\n      float calculateLineOffsetSketch() {\n        float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "]))))),t.mode){case 0:v.code.add(i.glsl(c||(c=r.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "])))),m.code.add(i.glsl(u||(u=r.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "],["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "]))));break;case 1:v.code.add(i.glsl(p||(p=r.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "])))),m.code.add(i.glsl(d||(d=r.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "],["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "]))));break;case 2:e.varyings.add("vType","float"),v.code.add(i.glsl(h||(h=r.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType = unpackedAttributes.type;\n\n          if (unpackedAttributes.type <= 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType = unpackedAttributes.type;\n\n          if (unpackedAttributes.type <= 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "])))),m.code.add(i.glsl(f||(f=r.__makeTemplateObject(["\n        float calculateLineOffset() {\n          if (vType <= 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType <= 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "],["\n        float calculateLineOffset() {\n          if (vType <= 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType <= 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "]))))}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(168),r(195),r(299)],void 0===(i=function(e,t,r,n,i){function o(e,t){if(!e)return null;for(var r=e.length/2,n=a*r,i=new Array(r),o=0,l=1===t,c=0;c<e.length;c+=2){var u=(e[c]+e[c+1])/2;i[o++]=l?Math.min(n,1-(1-u)*s):Math.min(n,u*s)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var a=t.strokesDefinition.resolution,s=a/2,l=new Uint8Array(4*a*a),c=4*a*s,u=t.strokesDefinition.amplitude,p=2*u,d=4*a,h=r.log2(a)+1,f=t.strokesDefinition.strokes.length,v=(h-1)*f*d,m=0,y=t.strokesDefinition.strokes;m<y.length;m++){for(var g=y[m],_=g.distance,b=g.pressure,x=v,w=0;w<h;w++){0!==w&&(_=o(_,0),b=o(b,1));for(var S=0;S<t.strokesDefinition.resolution;S++){var P=.5+(_?_[S%_.length]/p:0),T=b?b[S%b.length]:1;n.packFloatRGBA(P,l,x),n.packFloatRGBA(T,l,x+c),x+=4}x-=d*(f+1)}v+=d}return{resolution:a,texture:new i(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:a,height:a,wrapMode:10497},l),normalizationScale:p,amplitude:u,variants:f}},t.rasterizeStrokes=function(){var e=t.strokesDefinition.resolution,n=r.log2(e)+1,i=t.strokesDefinition.strokes.length,a=t.strokesDefinition.amplitude,s=Math.ceil(2*a+.5),l=function(){for(var t=0,r=e;r>=1;)t+=r,r/=2;return t}()+6*(n+1),c=i*s,u=new Uint8ClampedArray(4*l*c),p=4*l;u.fill(255);for(var d=24,h=0,f=t.strokesDefinition.strokes;h<f.length;h++){for(var v=f[h],m=v.distance,y=v.pressure,g=d,_=0;_<n;_++){0!==_&&(m=o(m,0),y=o(y,1));for(var b=0;b<m.length;b++){for(var x=m?m[b]:0,w=y?r.clamp(y[b],0,1):1,S=g,P=-a;P<s-a;P++){var T=Math.abs(P-x+.5)-.5*w,O=255-255*r.clamp(1-T,0,1);u[S+0]=O,u[S+1]=O,u[S+2]=O,u[S+3]=255,S+=p}g+=4}g+=24}d+=s*p}return new ImageData(u,l,c)};var a=.1,s=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(180),r(152),r(120)],void 0===(i=function(e,t,r,n,i){function o(e){return e.size*e.color[3]*e.opacity>0}function a(e,t){var n=r.binaryIndexOf(e,t,!0);return-1===n?t<e[0]?0:e.length:n}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRendererType=function(e){for(var t=null,r=0,i=e;r<i.length;r++){var a=i[r],s=a.type;if(o(a))if(n.isNone(t))t=s;else if(t!==s)return"uber"}return n.isSome(t)?t:"solid"},t.determineEdgeTransparency=function(e){for(var t=0,r=0,n=e;r<n.length;r++){var i=n[r].material;if(o(i)){if(i.color[3]*i.opacity<1)return 1;t=2}}return t},t.determineObjectTransparency=function(e){for(var t=0,r=0,n=e;r<n.length;r++){var i=n[r].material;if(o(i)){switch(i.objectTransparency){case 1:case 0:return 1;case 2:if(i.opacity<1)return 1}t=2}}return t},t.cloneIndices=function(e){if(Uint16Array.from)return i.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=i.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,n){return r*(n/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=a,t.computeEdgeCount=function(e,t,r){return e.length-a(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i].index,a=t[i],s=t[i+1];if(n)for(var l=a;l<s;l++){var c=n[l];r.set(c,o)}else for(l=a;l<s;l++)r.set(l,o)}}}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var n=e.capabilities.disjointTimerQuery;if(!n)return!1;if(n.timestampBits()<=0)return!1;var i=n.createQuery();n.createTimestamp(i);var o=function(){var e=n.resultAvailable(i),a=n.disjoint();if(!e||a)a?t():setTimeout(o,r);else{var s=n.getResult(i);t(s/1e6)}};return o(),!0},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(190),r(156),r(152),r(153),r(231),r(1224),r(195),r(299)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=n.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository"),p=function(){function e(e,t,n){this._textures=e,this.rctx=n,this._idToRefCountedTexture=new Map,this._textureTechniqueConfig=new s.TextureTechniqueConfiguration,this._loadingCount=0,this._frameUpdates=new Map,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256),this._texturesToUnload=new Array,this.events=new r,this._textureTechnique=t.acquireAndReleaseExisting(s.TextureTechnique,this._textureTechniqueConfig,this._textureTechnique);for(var i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy}}return e.prototype.dispose=function(){i.isSome(this._unloadDeferredHandle)&&(this._unloadDeferredHandle.remove(),this._unloadDeferredHandle=null,this._unloadDeferred()),i.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null),i.isSome(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null),this._textures.forEach((function(e){return e.unload()}))},e.prototype.acquire=function(e,t,r){var n=this._getOrCreateRef(e,t,r);return n.ref(),n},e.prototype.update=function(){var e=this,t=!1;this._frameUpdates.forEach((function(r){var n=r.texture.frameUpdate(e.rctx,e._textureTechnique,r.previousToken);n>=0&&n!==r.previousToken&&(r.previousToken=n,t=!0)})),t&&this.events.emit("changed",{requestType:0})},e.prototype._getOrCreateRef=function(e,t,r){return this._idToRefCountedTexture.get(e)||this._createNewRef(e,t,r)},e.prototype._createNewRef=function(e,t,r){var n=this,i=this._textures.get(e);l.assert(void 0!==i);var a=i.events.on("unloaded",(function(){a.remove(),n._onTextureUnloaded(e)})),s=!0===t,c=new d;this._idToRefCountedTexture.set(e,c);var p=i.load(this.rctx,this._textureTechnique);this._loadingCount++;var h=function(t){return n._loadingCount--,n._updateGLTexture(c,t),r&&r(c),i.requiresFrameUpdates&&n._frameUpdates.set(e,{texture:i,previousToken:-1}),c};return o.isThenable(p)?(this._updateGLTexture(c,s?this.fallbackTextureTransparent:this.fallbackTexture),p.then(h,(function(e){n._loadingCount--,o.isAbortError(e)||u.error(e)}))):h(p),c},e.prototype._updateGLTexture=function(e,t){e.glTexture=t,this.events.emit("changed",{requestType:1})},e.prototype.release=function(e){var t=this,r=this._idToRefCountedTexture.get(e);r&&(r.unref(),r.isUnreferenced&&(this._texturesToUnload.push(e),i.isNone(this._unloadDeferredHandle)&&(this._unloadDeferredHandle=a.schedule((function(){return t._unloadDeferred()})))))},e.prototype._unloadDeferred=function(){for(var e=0,t=this._texturesToUnload;e<t.length;e++){var r=t[e],n=this._textures.get(r),i=this._idToRefCountedTexture.get(r);n&&i&&i.isUnreferenced&&n.unload()}this._texturesToUnload.length=0,this._unloadDeferredHandle=null},e.prototype.getTexture=function(e){return this._textures.get(e)},Object.defineProperty(e.prototype,"loadingCount",{get:function(){return this._loadingCount},enumerable:!0,configurable:!0}),e.prototype._onTextureUnloaded=function(e){this._idToRefCountedTexture.delete(e),this._frameUpdates.delete(e)},Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){return i.isNone(this._fallbackTexture)&&(this._fallbackTexture=new c(this.rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){return i.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=new c(this.rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent},enumerable:!0,configurable:!0}),e}();t.TextureRepository=p;var d=function(){function e(){this._refCount=0,this.glTexture=null}return Object.defineProperty(e.prototype,"isUnreferenced",{get:function(){return 0===this._refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(){++this._refCount},e.prototype.unref=function(){0!==this._refCount?--this._refCount:u.error("Cannot dereference texture that has no references!")},e}();t.RefCountedTexture=d}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(271),r(158),r(156),r(153),r(151),r(493),r(299)],void 0===(i=function(e,t,r,n,i,o,a,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=o.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");t.waveAndPertubationTextureUrls=[n.getAssetUrl("esri/images/materials/water/normals.jpg"),n.getAssetUrl("esri/images/materials/water/perturbation.jpg")];var p=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=[],t.loadingState=0,t}return r.__extends(n,e),n.prototype.dispose=function(){this.loadingState=0,this.data.forEach((function(e){e.dispose(),e=null})),this.data=null},n.prototype.getTextureProps=function(e,t,r){return void 0===r&&(r=!1),{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:r,maxAnisotropy:8,width:e,height:t}},Object.defineProperty(n.prototype,"updating",{get:function(){return 1===this.loadingState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ready",{get:function(){return 2===this.loadingState},enumerable:!0,configurable:!0}),n.prototype.loadTextures=function(e){var r=this;this.loadingState=1,a.all(t.waveAndPertubationTextureUrls.map((function(e){return l.requestImage(e)}))).then((function(t){t.forEach((function(t,n){r.data[n]=new c(e,r.getTextureProps(t.width,t.height,!0),t)})),r.loadingState=2})).catch((function(e){u.error("Failed to load textures for water material.",e),r.loadingState=0}))},n.prototype.bindRepo=function(e){for(var t=0;t<this.data.length;t++)e.bindTexture(this.data[t],t)},r.__decorate([s.property()],n.prototype,"loadingState",void 0),r.__decorate([s.property({type:Boolean,readOnly:!0,dependsOn:["loadingState"]})],n.prototype,"updating",null),r.__decorate([s.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],n)}(i);t.WaterTextureRepository=p}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(152),r(153),r(201),r(536),r(643),r(392)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r,n,i,o,a){void 0===i&&(i=null),void 0===a&&(a=!0);var s=e.call(this)||this;return s._rctx=t,s._renderScene=r,s._requestRenderScene=n,s._renderOverlay=i,s.forceCameraHook=o,s.supersample=a,s._screenshotQueue=[],s}return r.__extends(t,e),t.prototype.dispose=function(){this._rctx=null},t.prototype.takeScreenshot=function(e){this._requestRenderScene();var t=i.createResolver();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise},t.prototype.update=function(e){if(0!==this._screenshotQueue.length){for(var t=0,n=this._screenshotQueue;t<n.length;t++){var i=n[t];if(this.isDisposed)i.resolver.reject();else{var o=r.__assign(r.__assign({},i.settings),{pixelRatio:i.settings.pixelRatio*e.viewCamera.pixelRatio}),a=this._ensureScreenshotEncodeCanvas(),l=this._renderScreenshot(e,o),c=s.encodeResult(l,o,a,{flipY:!0,premultipliedAlpha:!0});i.resolver(c)}}this._screenshotQueue=[]}},t.prototype._renderScreenshotOverlay=function(e,t,r){if(!n.isNone(this._renderOverlay)){e.width=t.width,e.height=t.height;var i=e.getContext("2d"),o=r.pixelRatio;i.save(),i.translate(0,t.height),i.scale(1,-1),r.region&&i.translate(-r.region.x,-r.region.y),i.scale(o,o),this._renderOverlay(e,t),i.restore()}},t.prototype._readbackScreenshot=function(e){return e.resample?this._readbackScreenshotResampled(e):this._readbackScreenshotImmediate(e)},t.prototype._readbackScreenshotResampled=function(e){var t=e.framebufferWidth,n=e.framebufferHeight,i=e.region,o=e.resample,a=this._ensureScreenshotEncodeCanvas(),l=s.createEmptyImageData(t,n,a);this._rctx.gl.readPixels(0,0,t,n,6408,5121,new Uint8Array(l.data.buffer)),this._renderScreenshotOverlay(a,l,r.__assign(r.__assign({},e),{region:null}));var c=s.createEmptyImageData(i.width,i.height,a);return s.resampleHermite(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)},t.prototype._readbackScreenshotImmediate=function(e){var t=e.framebufferHeight,r=e.region,n=this._ensureScreenshotEncodeCanvas(),i=s.createEmptyImageData(r.width,r.height,n);return this._rctx.gl.readPixels(r.x,t-(r.y+r.height),r.width,r.height,6408,5121,new Uint8Array(i.data.buffer)),this._renderScreenshotOverlay(n,i,e),i},t.prototype._renderScreenshot=function(e,t){var r=null,n=e.viewCamera,i=t.framebufferWidth,a=t.framebufferHeight,s=!1,c=e.frameHasSlicePlane&&t.disableSlice,u=i!==n.fullWidth||a!==n.fullHeight,p=t.ignorePadding&&n.pixelRatio!==t.pixelRatio,d=u||c||p;if(d){var h=n.clone();if(t.ignorePadding){for(var f=o.vec4f64.clone(h.padding),v=0;v<4;v++)f[v]=Math.round(f[v]/h.pixelRatio*t.pixelRatio);h.padding=f}h.fullWidth=i,h.fullHeight=a,h.pixelRatio=t.pixelRatio;var m=n.fovX-h.fovX,y=n.fovY-h.fovY;m<0&&m<y?h.fovX=n.fovX:y<0&&y<m&&(h.fovY=n.fovY),this.forceCameraHook(h),s=!0,r=new l(this._rctx,{width:h.fullWidth,height:h.fullHeight,colorTarget:0,depthStencilTarget:3}),this._renderScene(r,h,t.disableSlice)}var g=this._readbackScreenshot(t);if(d&&!this._rctx.contextAttributes.alpha)for(v=3;v<g.data.length;v+=4)g.data[v]=255;return r&&r.dispose(),this._rctx.bindFramebuffer(null),s&&this.forceCameraHook(n),g},t.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},t}(a.AutoDisposable);t.ScreenshotManager=c}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(151),r(1160)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.components=["attribution","zoom","navigation-toggle","compass"],r}return r.__extends(t,e),r.__decorate([n.property()],t.prototype,"components",void 0),r.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],t)}(i)}.apply(null,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(117),r(158),r(167),r(157),r(151)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r._viewpointHandle=null,r._handles=new i,r.group=null,r}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this._handles.add(o.on(this,"view.ui","expand",(function(t){var r=t.target;r&&r!==e&&r.expanded&&r.group&&r.group===e.group&&e._collapse()})))},t.prototype.destroy=function(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null},Object.defineProperty(t.prototype,"autoCollapse",{set:function(e){this._set("autoCollapse",e),this._watchViewpoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expanded",{set:function(e){var t=!!e;this._set("expanded",t);var r=this.get("view.ui");r&&r.emit("expand",{target:this}),this._viewpointHandleChange(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{set:function(e){var t=this;this._get("view")!==e&&(this._set("view",e),e&&o.whenTrueOnce(e,"ready",(function(){t.view===e&&t._watchViewpoint()})))},enumerable:!0,configurable:!0}),t.prototype._viewpointHandleChange=function(e){var t=this;this._viewpointHandle&&(e?o.whenTrueOnce(this.view,"stationary",(function(){return t._viewpointHandle.resume()})):this._viewpointHandle.pause())},t.prototype._watchViewpoint=function(){var e=this;this._handles.remove("viewpoint"),this._viewpointHandle=null;var t=this.autoCollapse,r=this.view;if(r&&t){var n="3d"===r.type?"camera":"viewpoint",i=o.pausable(r,n,(function(){return e._collapse()}));this._handles.add(i,"viewpoint"),this._viewpointHandle=i}},t.prototype._collapse=function(){this.expanded=!1},r.__decorate([a.property({value:!1})],t.prototype,"autoCollapse",null),r.__decorate([a.property({value:!1})],t.prototype,"expanded",null),r.__decorate([a.property()],t.prototype,"group",void 0),r.__decorate([a.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null),r.__decorate([a.property({value:null})],t.prototype,"view",null),r.__decorate([a.subclass("esri.widgets.Expand.ExpandViewModel")],t)}(n)}.apply(null,n))||(e.exports=i)}])]);
//# sourceMappingURL=4.js.map